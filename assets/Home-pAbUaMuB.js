const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Header-4nwlqpqx.js","./common-0X47MWYd.js","./index-FdyGBlLz.js","./index-BnngHmlw.css","./Header-BxfOm9FJ.css"])))=>i.map(i=>d[i]);
import{m as l,e as c,n as d,_ as h}from"./index-FdyGBlLz.js";import{C as p,g as u,a as m,_ as g}from"./ChatList-BPiMFRqF.js";const _={name:"ChatPage",components:{ChatList:p},props:{visible:{type:Boolean,default:!1}},data(){return{qaMap:new Map,sessionList:[],currentSessionId:"",parentChatSessionId:"",chatGroup:new Map,modelRecordList:[],modelRecordTemp:{},modelRecord:{},searchInternet:!0,currentController:null,sidebarVisible:!0}},computed:{...l("app",["showChatDialog"]),showDialog:{get(){return this.visible},set(t){this.SET_SHOW_CHAT_DIALOG(t)}}},watch:{showChatDialog(t){var e;t&&((e=this.$refs.listComponent)==null||e.initSpeechHelper(),this.$nextTick(async()=>{await this.getModelRecord(),this.$refs.listComponent.initModel(this.modelRecordList)}))}},created(){localStorage.setItem("appCode","AI-THIRD-APP-OWE"),sessionStorage.removeItem("chatId")},beforeDestroy(){sessionStorage.removeItem("chatId")},methods:{...c("app",["SET_SHOW_CHAT_DIALOG"]),scrollToBottom(){this.$nextTick(()=>{var t;(t=this.$refs.listComponent)==null||t.scrollToBottom()})},getCurrentFormattedTime(t=0){const e=new Date;e.setDate(e.getDate()-t);const s=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return`${s}-${o}-${i} ${a}:${r}:${n}`},createNewChat(){var t;(t=this.currentController)==null||t.abort(),this.currentSessionId="",this.qaMap=new Map,sessionStorage.removeItem("chatId")},async getChatList(){},selectChat(t){console.log("Selected chat:",t)},async getModelRecord(){var e;const t=await u();return t.code===200&&(this.modelRecord=t.data.find(s=>s.isDefault==="Y")||t.data[0]||{},this.modelRecordTemp={...this.modelRecord},this.modelRecordList=t.data.filter(s=>s.value!==this.modelRecord.value)||[],this.searchInternet=((e=this.modelRecord)==null?void 0:e.isInternetAble)!=="N"),Promise.resolve()},async onModelSwitch(t){var e;sessionStorage.removeItem("chatId"),this.parentChatSessionId="",t?this.modelRecord=t:this.modelRecord={...this.modelRecordTemp},this.searchInternet=((e=this.modelRecord)==null?void 0:e.isInternetAble)!=="N"},sendQuestion(t,e,s){console.log("sendQuestion",t,e,s);const{sessionId:o,controller:i}=m(t,this.modelRecord.value,this.searchInternet,this.qaMap,e,this.parentChatSessionId,s,a=>{this.currentController=i;const r=this.qaMap.get(a.sessionId);if(!r){this.parentChatSessionId="";return}if(r&&r.status==="stoped"||!r)return;a.type==="error"&&console.log("error",a),r.answers.push(a);const n=new Map(this.qaMap);n.set(a.sessionId,r),this.qaMap=n,a.references&&(r.references=a.references),a.knowledgeRetrieval&&(r.knowledgeRetrieval=a.knowledgeRetrieval),a.type==="finished"&&(this.currentSessionId="",r.collapseState=null,r.status="finished"),this.scrollToBottom()});this.currentSessionId=o,this.parentChatSessionId||(this.parentChatSessionId=o,this.getChatList()),this.qaMap.has(o)||this.qaMap.set(o,{prompt:t,answers:[],collapseState:"1",fileList:e.map(a=>{var r;return{name:a.name,file:{size:((r=a.file)==null?void 0:r.size)||0},fileId:a.fileId,url:a.url,type:a.type,status:a.status}}),chatSessionId:o,knowledgeRetrieval:[]}),this.scrollToBottom()},stopAnswering(){console.log("stopAnswering")}}};var f=function(){var e=this,s=e._self._c;return s("el-dialog",{directives:[{name:"elDraggable",rawName:"v-elDraggable"}],attrs:{visible:e.showDialog,width:"800px",modal:!1,"custom-class":"chat-dialog-wrap"},on:{"update:visible":function(o){e.showDialog=o}}},[s("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[s("img",{staticClass:"w-24px h-24px mr-8px",attrs:{src:g,alt:""}}),s("span",[e._v("海上风电AI助手")])]),s("div",{staticClass:"chat-wrap flex"},[s("div",{staticClass:"chat-container flex-1 flex h-full px-20px"},[!e.qaMap.size&&!e.parentChatSessionId?s("div",{staticClass:"tip-column"},[s("h1",{staticClass:"w-full text-[18px] text-center leading-11"},[e._v("Hi，我是海上风电AI平台，很高兴遇见您！")]),s("div",{staticClass:"w-full text-[14px] text-center text-[#FFFFFFB2] leading-6 mt-0px mb-10px"},[e._v("我是海上风电小助手“阿广”，为了向您提供高质量的问答服务，请简述您想了解的内容")])]):e._e(),s("ChatList",{ref:"listComponent",attrs:{"render-mode":"multiple","message-map":e.qaMap,currentSessionId:e.currentSessionId},on:{"update:currentSessionId":function(o){e.currentSessionId=o},"update:current-session-id":function(o){e.currentSessionId=o},send:e.sendQuestion,stop:e.stopAnswering,onModelSwitch:e.onModelSwitch}})],1)])])},S=[],w=d(_,f,S,!1,null,"93ff04eb");const v=w.exports,C=""+new URL("chat-icon-2-BBPwe2Zv.png",import.meta.url).href,I={name:"AppHome",components:{ChatPageDialog:v,PageHeader:()=>h(()=>import("./Header-4nwlqpqx.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)},data(){return{showHeader:!0}},computed:{...l("app",["showChatDialog"]),lang(){return`lang_${this.$root.$i18n.locale}`}},methods:{...c("app",["SET_SHOW_CHAT_DIALOG"]),handleShow(){this.SET_SHOW_CHAT_DIALOG(!0)}}};var R=function(){var e=this,s=e._self._c;return s("div",{staticClass:"home",class:[e.lang]},[e.showHeader?s("PageHeader"):e._e(),s("router-view",{staticClass:"container-inner",on:{"toggle-header":function(o){e.showHeader=o}}}),s("div",{directives:[{name:"auth",rawName:"v-auth",value:["AIbtn"],expression:"['AIbtn']"},{name:"draggable",rawName:"v-draggable"}],staticClass:"chat",on:{click:e.handleShow}},[s("img",{staticClass:"w-full h-full",attrs:{src:C,alt:""}})]),s("ChatPageDialog",{attrs:{visible:e.showChatDialog}})],1)},x=[],M=d(I,R,x,!1,null,"32c57173");const b=M.exports;export{b as default};
