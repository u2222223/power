const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ChartByComm-CfNMYcyq.js","./index-FdyGBlLz.js","./index-BnngHmlw.css","./ChartByComm-CxJ2tzVq.css"])))=>i.map(i=>d[i]);
import{h as p,f as h,i as y}from"./store-BeJ4ml9q.js";import{n as l,_ as v,c2 as w,a2 as u,bX as C,c3 as $,bI as g,c4 as b}from"./index-FdyGBlLz.js";import{M as m}from"./mqtt-P3cO-H_W.js";import{D as I}from"./DatePick-Di8kk-Xx.js";import{c as x,g as T}from"./utils-HQ9PplOD.js";import{d as F,a as D}from"./data-CG0ZN9yq.js";import{c as L}from"./common-Da9OqttM.js";import{W as B}from"./WindTabs-BMmxF3K0.js";import"./common-0X47MWYd.js";import"./mqttConfig-DcruBXJ7.js";const M={name:"StatusEchart",props:{chartData:{type:Array,default:()=>[]}},components:{ChartByComm:()=>v(()=>import("./ChartByComm-CfNMYcyq.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)},data(){return{series:[]}},computed:{comProps(){return{chartData:{unit:` ${this.$t("unit.set")}`,series:this.chartData.map(s=>({name:s.name,color:s.color,y:s.value,h:0}))}}}}};var N=function(){var t=this,a=t._self._c;return a("ChartByComm",{staticClass:"chart-wrap",attrs:{cName:"PieForHighchart",comProps:t.comProps}})},S=[],P=l(M,N,S,!1,null,"0dd67d20");const V=P.exports,k={props:{params:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]},selectName:{type:String,default:"本日"},value:{type:String,default:"day"},chartData:{type:Array,default:()=>[]}},components:{DatePick:I,StatusEchart:V},data(){return{infoList:[{code:"electricity_generation",unit_code:"electric_stat",text:"发电量",unit:this.$t("unit.electric_stat")},{code:"economic_benefits",unit_code:"money_stat",text:"经济效益",unit:this.$t("unit.money_stat")},{code:"coal_savings",unit_code:"weight_stat",text:"节省标煤量",unit:this.$t("unit.weight_stat")},{code:"co2_reduction",unit_code:"weight_stat",text:"CO₂减排量",unit:this.$t("unit.weight_stat")}]}}};var A=function(){var t=this,a=t._self._c;return a("div",{staticClass:"wrap",class:{"wrap-eng":t.$root.$i18n.locale==="en-GB"}},[a("div",{staticClass:"realTime-data"},[a("div",{staticClass:"title"},[a("div",{staticClass:"title-zh"},[t._v(" "+t._s(t.$t("MatrixData.real_time_wind_farm_data"))+" ")]),a("div",{staticClass:"title-en"})]),a("div",{staticClass:"info-list",class:{"info-list-eng":t.$root.$i18n.locale==="en-GB"}},[a("div",{staticClass:"info-item"},[a("div",{staticClass:"item-value"},[t._v(" "+t._s(t.$t("currency.MW",[t.params.capacity]))),a("span",{staticClass:"unit"},[t._v(t._s(t.$t("unit.MW")))])]),a("div",{staticClass:"item-label"},[t._v(" "+t._s(t.$t("MatrixData.installed_capacity"))+" ")])]),a("div",{staticClass:"info-item"},[a("div",{staticClass:"item-value"},[t._v(" "+t._s(t.params.fanNum)),a("span",{staticClass:"unit"},[t._v(t._s(t.$t("unit.set")))])]),a("div",{staticClass:"item-label"},[t._v(" "+t._s(t.$t("MatrixData.number_of_installed_units"))+" ")])]),a("div",{staticClass:"info-item"},[a("div",{staticClass:"item-value"},[t._v(" "+t._s(t.$t("currency.MW",[(Number(t.params.power/1e4)+t.params.randomP).toFixed(2)]))),a("span",{staticClass:"unit"},[t._v(t._s(t.$t("unit.MW")))])]),a("div",{staticClass:"item-label"},[t._v(" "+t._s(t.$t("MatrixData.total_power"))+" ")])]),a("div",{staticClass:"info-item"},[a("div",{staticClass:"item-value"},[t._v(" "+t._s(Number(t.params.speedAver+t.params.randomS).toFixed(2))),a("span",{staticClass:"unit"},[t._v("m/s")])]),a("div",{staticClass:"item-label"},[t._v(" "+t._s(t.$t("MatrixData.average_wind_speed"))+" ")])])])]),a("div",{staticClass:"total-data"},[a("div",{staticClass:"title"},[a("div",{staticClass:"title-zh"},[t._v(" "+t._s(t.$t("MatrixData.wind_farm_statistics"))+" ")]),a("div",{staticClass:"title-en"})]),a("div",{staticClass:"total-content"},[a("DatePick",{attrs:{value:t.value},on:{input:function(e){return t.$emit("input",e)}}}),a("div",{staticClass:"info-list",class:{"info-list-eng":t.$root.$i18n.locale==="en-GB"}},t._l(t.infoList,function(e,i){return a("div",{key:i,staticClass:"info-item"},[a("div",{staticClass:"item-value"},[a("span",[t._v(t._s(e.unit_code==="money_stat"?t.$t("unit.rmb"):""))]),t._v(t._s(t.$n(t.$t(`currency.${e.unit_code}`,[t.items[i]])))),a("span",{staticClass:"unit"},[t._v(t._s(e.unit))])]),a("div",{staticClass:"item-label"},[t._v(t._s(t.selectName)+" "+t._s(t.$t(`MatrixData.${e.code}`)))])])}),0)],1)]),a("div",{staticClass:"status-data"},[a("div",{staticClass:"title"},[a("div",{staticClass:"title-zh"},[t._v(" "+t._s(t.$t("MatrixData.wind_farm_wind_turbine_status_statistics"))+" ")]),a("div",{staticClass:"title-en"})]),a("StatusEchart",{attrs:{chartData:t.chartData}})],1)])},R=[],W=l(k,A,R,!1,null,"1181010d");const O=W.exports,q=""+new URL("fan-bw-1-jVosNH_5.png",import.meta.url).href,j=""+new URL("fan-bw-2-DzTAZtW3.png",import.meta.url).href,E=""+new URL("fan-bw-3-CFyAp8Zx.png",import.meta.url).href,G=""+new URL("fan-bw-4-Dw95Rwxt.png",import.meta.url).href,U=""+new URL("fan-bw-5-BKMWYpjm.png",import.meta.url).href,K=""+new URL("fan-bw-6-CCdRm4Cl.png",import.meta.url).href,z=""+new URL("fan-bw-7-D7Q9qdnN.png",import.meta.url).href,H=""+new URL("fan-bw-8-D8mw4UNE.png",import.meta.url).href,J={props:{list:{type:Array,default:()=>[]},pointList:{type:Array,default:()=>[]},treeOpen:{type:Boolean,default:!1}},filters:{formmartValue(s){let t=s||0;return Math.ceil(t)!=t&&(t=parseFloat(t).toFixed(2)),t}},data(){return{rotIndex:1,runningType:["Startup","GridConnected","Speedup","PowerRationing"],fanBwIcons:{1:q,2:j,3:E,4:G,5:U,6:K,7:z,8:H}}},computed:{lang(){return`lang_${this.$root.$i18n.locale}`}},mounted(){this.rotFn()},methods:{async rotFn(){for(;;)this.rotIndex++,this.rotIndex>8&&(this.rotIndex=1),await this.sleep(125)},sleep(s){return new Promise(t=>setTimeout(t,s))}}};var Z=function(){var t=this,a=t._self._c;return a("div",{class:["fj-list",t.$props.treeOpen?"":"is-expand"]},[t.lang==="lang_en-GB"?t._l(t.list,function(e){return a("div",{key:e.entityId,staticClass:"fj-item-wrap"},[a("div",{staticClass:"fj-item",class:e.statusCode,on:{click:function(i){return t.$emit("onClickFans",e)}}},[a("div",{staticStyle:{"padding-left":"35%","text-align":"right"}},[t._v(" "+t._s(e.code)+" ")]),t._l(t.pointList,function(i,n){return[t.pointList.length>0&&n<2?a("div",{key:n,staticClass:"field"},[a("span",[t._v(t._s(i.name))]),a("span",[t._v(t._s(t._f("formmartValue")(e[i.pointId]))+" "+t._s(i.clunit))])]):t._e()]}),a("div",{staticClass:"item-title"},[a("span",[t._v(t._s(t.$t(`custom_wind_turbine_code.${e.statusCode}`)))])]),t.runningType.includes(e.statusCode)?a("div",{staticClass:"fan-bg"},[a("img",{attrs:{src:t.fanBwIcons[t.rotIndex]}})]):t._e()],2)])}):t._l(t.list,function(e){return a("div",{key:e.entityId,staticClass:"fj-item-wrap"},[a("div",{staticClass:"fj-item",class:e.statusCode,on:{click:function(i){return t.$emit("onClickFans",e)}}},[a("div",{staticStyle:{height:"26px","padding-left":"35%","text-align":"right"}},[t._v(" "+t._s(e.manufacturer||"--")+" ")]),t._l(t.pointList,function(i,n){return[t.pointList.length>0&&n<2?a("div",{key:n,staticClass:"field"},[a("span",[t._v(t._s(i.name))]),a("span",[t._v(t._s(t._f("formmartValue")(e[i.pointId]))+" "+t._s(i.clunit))])]):t._e()]}),a("div",{staticClass:"item-title"},[a("span",[t._v(t._s(e.code))]),a("span",[t._v(t._s(t.$t(`custom_wind_turbine_code.${e.statusCode}`)))])]),t.runningType.includes(e.statusCode)?a("div",{staticClass:"fan-bg"},[a("img",{attrs:{src:t.fanBwIcons[t.rotIndex]}})]):t._e()],2)])})],2)},Q=[],X=l(J,Z,Q,!1,null,"8ec64d48");const Y=X.exports,tt={mixins:[L],components:{Statistics:O,FanCardList:Y,WindTabs:B},props:{treeOpen:{type:Boolean,default:!1}},data(){return{list:[],listTemplate:[],windBtnVal:"总计",fans:{speedCode:"wind-speed",powerCode:"wind-power",statusCode:"wind-stat",speed:0,speedAver:0,power:0,capacity:0,randomP:0,randomS:0},selectedKey:"day",windFarm:{},tableLoading:!1,myChart:null,chartData:[]}},computed:{pointList(){return[{name:this.$t("MatrixData.wind_speed"),pointId:"wind-speed",clunit:"m/s"},{name:this.$t("MatrixData.power"),pointId:"wind-power",clunit:"kw"},{name:this.$t("MatrixData.status"),pointId:"wind-stat",clunit:""}]},infoShowText(){let s=F.find(({key:t})=>this.selectedKey===t);return s?this.$tc(`Date.${s.key}`,2):""},infoDataVal(){return x(this.windFarm[`power-${this.selectedKey}`],!0)},StatisticsParams(){let{capacity:s,randomP:t,randomS:a,speedCode:e,powerCode:i}=this.fans;return{randomP:t,randomS:a,capacity:s,fanNum:this.list.length,power:+(this.windFarm[i]||0),speedAver:+(this.windFarm[e]||0)}}},created(){setInterval(()=>{this.fans.randomP=Number((Math.random()*(.3-.1)+.1).toFixed(2)),this.fans.randomS=Number((Math.random()*(.3-.1)+.1).toFixed(2))},2e3)},watch:{windBtnVal(){this.init(!1)}},methods:{init(s=!0){this.list=[],this.fans.capacity=0,this.entityInfo.entityId&&this.entityInfo.entityId!==""&&(s&&this.$refs.WindTabs&&this.$refs.WindTabs.getTypes(this.entityInfo),this._GetListData(this.entityInfo.entityId),this.fans.capacity=p.document?p.document.etattr_capacity:0),this._GetMqttTopicFan()},initChart(s){const t=s.map(e=>Object.assign({},{...e},{itemStyle:{color:e.color},label:{color:e.color,width:350}}));let a={tooltip:{trigger:"item",formatter:"{b}"},series:[{name:"风机台数",type:"pie",top:"5%",bottom:"2%",radius:["66%","80%"],data:t}]};if(this.myChart!==null)this.myChart.setOption(a);else{let e=document.getElementById("statusChart");this.myChart=this.$echarts.init(e),this.myChart.setOption(a)}},async _GetListData(s){this.listTemplate=[],this.list=[],this.tableLoading=!0;let t={entityId:+s,needAttr:!0};this.windBtnVal!=="总计"&&(t.manufacturer=this.windBtnVal||void 0);let{result:a}=await w(t);this.tableLoading=!1,this.$nextTick(()=>{this.listTemplate=a?a.filter(e=>e.code.includes("#")).map(e=>{var i;return{manufacturer:(i=e.document)==null?void 0:i.etattr_Manufacturer,...e,statusCode:"initialization","wind-stat":"initialization"}}):[],this._GetMqttTopic(this.listTemplate)})},async _GetMqttTopic(s){let a={dynamicType:1,dynamicPoint:s.map(e=>({topic:this.entityInfo.topicName+"/"+e.entityId+"/#",points:this.pointList.map(i=>i.pointId).join(",")})),needData:!0,fanType:this.windBtnVal};try{let{result:e}=await u(a);this.$nextTick(()=>{let i=e.dynamicTopicName;h(i),this.tableLoading=!0,this.subAllFanMqtt(e.data),m(i,!0,"_12",this.subAllFanMqtt),this.tableLoading=!1})}catch{this.list=this.listTemplate}},subAllFanMqtt(s){if(this.tableLoading=!1,!s){this.list=this.listTemplate;return}this.list=this.listTemplate.map(t=>{let{code:a,entityId:e,manufacturer:i}=t,n=s[`${this.entityInfo.topicName}/${e}`],r={code:a,entityId:e,manufacturer:i};this.pointList.forEach(({pointId:d})=>{n[d]!=="NaN"&&(r[d]=n[d])});let{text:o,image:c,color:_,code:f}=T(r["wind-stat"]);return{text:o,image:c,color:_,statusCode:f,...r}})},async _GetMqttTopicFan(){let a={dynamicType:1,dynamicPoint:[{points:(await C({entityId:this.entityInfo.entityId,pageSize:100,fanType:this.windBtnVal})).result.records.map(n=>n.pointId).join(","),topic:this.entityInfo.topicName}],needData:!0,fanType:this.windBtnVal},{result:e}=await u(a),i=e.dynamicTopicName;this.subFanWindFarm(e.data),m(i,!0,"_11",this.subFanWindFarm)},isNumberOrStringNumber(s){return!isNaN(parseFloat(s))&&isFinite(s)},subFanWindFarm(s){if(!s)return;let t=s[this.entityInfo.topicName];const a=n=>this.isNumberOrStringNumber(t[n])?t[n]:this.windFarm[n]||0;this.windFarm={...t,"wind-speed":a("wind-speed"),"wind-power":a("wind-power")};let e=JSON.parse(t["wind-stat"]||"{}"),i=[];D.map(n=>{let r=0;Object.keys(e).map(o=>{n.includes.includes(o)&&(r+=e[o])}),i.push({name:this.$t(`wind_farm_status_model.${n.code}`),color:n.color,value:r,code:n.code})}),i=i.filter(n=>n.value>0),this.chartData=i},onClickFans(s){$({entityId:s.entityId,fanType:this.windBtnVal}).then(t=>{if(t.success){let a=t.result.reverse().filter(e=>e);Promise.all([g({id:s.entityId,needAttr:!0,needDoc:!0,fanType:this.windBtnVal}),b({entityId:s.entityId,fanType:this.windBtnVal})]).then(e=>{let i=e[0],n=e[1],o=(n&&n.result&&n.result.records?n.result.records:[]).filter(c=>c.needShow);this.destroyAll(),y(),this.$parent.$parent.$refs.ele.$refs.comp.loadAsyncTree({parentIds:a}),this.$parent.$parent.handleJumpPage({checked:!0,result:i.result,entityId:s.entityId,pageList:o})})}})}}};var at=function(){var t=this,a=t._self._c;return a("div",{staticClass:"comBox"},[a("div",{staticClass:"left-box"},[a("a-spin",{staticClass:"spin",attrs:{spinning:t.tableLoading,tip:this.$t("placeholder.loading")}},[a("FanCardList",{attrs:{list:t.list,pointList:t.pointList,treeOpen:t.treeOpen},on:{onClickFans:t.onClickFans}})],1)],1),a("div",{staticClass:"right-box"},[a("WindTabs",{ref:"WindTabs",staticStyle:{position:"absolute",right:"24px",top:"-4.6vh"},attrs:{entityInfo:t.entityInfo},on:{getWindBtnVal:e=>t.windBtnVal=e}}),a("Statistics",{attrs:{selectName:t.infoShowText,params:t.StatisticsParams,items:t.infoDataVal,chartData:t.chartData},model:{value:t.selectedKey,callback:function(e){t.selectedKey=e},expression:"selectedKey"}})],1)])},et=[],st=l(tt,at,et,!1,null,"c166ef70");const _t=st.exports;export{_t as default};
