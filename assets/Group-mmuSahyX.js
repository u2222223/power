import{h as l,ci as c,cj as u,ck as d,cl as p,cm as m,n as v}from"./index-FdyGBlLz.js";import f from"./chartTitle-D0Yz7hG9.js";import D from"./tabs-CBGXczMl.js";import y from"./ChartByComm-CfNMYcyq.js";import{N as g,R as C,T as _}from"./NoDataWind-CCWavxhx.js";import x from"./dateSelect-DhXXZ-Gf.js";import{W as b}from"./WindTabs-BMmxF3K0.js";const w={components:{ChartByComm:y,ChartTitle:f,DateSelection:x,Tabs:D,NoData:g,ReadModal:C,WindTabs:b},mixins:[_],props:["treeOpen"],data(){return{active:0,dateType:"",windBtnVal:"总计",animation:!1,tabArr:[{label:"累计值",value:0},{label:"均值",value:1}],color:[{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#63B0FF"},{offset:1,color:"#00366D"}],global:!1},{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#01EEC5"},{offset:1,color:"#02505B"}],global:!1},{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#EFDB01"},{offset:1,color:"#5C5703"}],global:!1}],chartType:["BarChart","LineChart"],sortType:["排名","趋势"],powerGenerationSort:0,utilizationRateSort:0,generationDurationSort:0,lossPower:19,windData:null,runData:null,hourData:null,rateData:null,generationData:null,fenShowData:null,showReadModal:!1,flag:!0,cache:{}}},computed:{dateFormat(){return this.dateType===3?"YYYY-MM":"YYYY-MM-DD"},dateFormat2(){return this.dateType===3?"YYYY-MM":"YYYY-MM-DD"},ltLineProps(){let s=[],t=[];return this.generationData&&this.generationData.dayList.forEach(a=>{s.push(a.date),t.push(a.value)}),{chartData:{unit:"kWh",xAxisData:s,series:[{name:"发电量",color:"#63B0FF",needArea:!0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,right:8})}},beforeSetOptions:a=>{let i=this.getAxis(a,this.ltBarProps.chartData.unit);return i.yAxis[0].name=`发电量(${a.yAxis[0].name})`,a.series.map(e=>{e.showSymbol=e.data.length===1}),i.series.forEach(e=>{e.animation=this.animation}),i}}},ltBarProps(){let s=[],t=[];this.generationData&&this.generationData.totalList.forEach(e=>{s.push(e.name),t.push(e.value)});let a=this,i="ltBarProps";return{chartData:{unit:"kWh",xAxisData:s,series:[{name:"发电量",itemStyle:{},needArea:!0,barGap:0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,bottom:10})},color:[{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#63B0FF"},{offset:1,color:"#00366D"}],global:!1}]},initedChart(e){e.on("datazoom",r=>{a.updateCache(i,r)})},beforeSetOptions:e=>(e=this.getAxis(e,this.ltBarProps.chartData.unit),e.yAxis.name=`发电量(${e.yAxis.name})`,e.series.forEach(r=>{r.barWidth=16,r.animation=this.animation}),e.dataZoom=this.getDataZoom(e.xAxis.data.length,this.treeOpen?22:30,a.cache[i]),e)}},topicName(){return this.$store.state.entityInfo.topicName},titleUnit(){return this.dateType!==1?"天":"小时"},unit(){return""},ltLineProps2(){let s=[],t=[];return this.rateData&&this.rateData.dayList.forEach(a=>{s.push(a.date),t.push(this.strip(a.value*100))}),{chartData:{unit:"%",xAxisData:s,series:[{name:"可利用率",color:"#00FFF0",needArea:!0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,right:8})}},beforeSetOptions:a=>{let i=this.getAxis(a,this.ltBarProps2.chartData.unit);return i.series.map(e=>{e.showSymbol=e.data.length===1}),i.yAxis[0].name=`可利用率(${a.yAxis[0].name})`,i.yAxis[0].max=100,i.yAxis[0].min=0,i.yAxis[0].splitNumber=6,i.series.forEach(e=>{e.animation=this.animation}),i}}},ltBarProps2(){let s=[],t=[],a=this,i="ltBarProps2";return this.rateData&&this.rateData.totalList.forEach(e=>{s.push(e.name),t.push(this.strip(e.value*100))}),{chartData:{unit:"%",xAxisData:s,series:[{name:"可利用率",itemStyle:{},needArea:!0,barGap:0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,bottom:10})},color:[{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#01EEC5"},{offset:1,color:"#02505B"}],global:!1}]},initedChart(e){e.on("datazoom",r=>{a.updateCache(i,r)})},beforeSetOptions:e=>(this.getAxis(e,this.ltBarProps2.chartData.unit),e.yAxis.name=`可利用率(${e.yAxis.name})`,e.yAxis.max=100,e.yAxis.min=0,e.yAxis.splitNumber=6,e.series.forEach(r=>{r.barWidth=16,r.animation=this.animation}),e.dataZoom=this.getDataZoom(e.xAxis.data.length,this.treeOpen?22:30,a.cache[i]),e)}},ltLineProps3(){let s=[],t=[];return this.hourData&&this.hourData.dayList.forEach(a=>{s.push(a.status),t.push(a.time)}),{chartData:{unit:"h",xAxisData:s,series:[{name:"发电小时",color:"#EFDB01",needArea:!0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,right:8})}},beforeSetOptions:a=>(this.getAxis(a,this.ltBarProps3.chartData.unit),a.yAxis[0].name=`小时(${a.yAxis[0].name})`,a.series.map(i=>{i.showSymbol=i.data.length===1}),a.series.forEach(i=>{i.animation=this.animation}),a)}},ltBarProps3(){let s=[],t=[],a=this,i="ltBarProps3";return this.hourData&&this.hourData.totalList.forEach(e=>{s.push(e.name),t.push(e.value)}),{chartData:{unit:"h",xAxisData:s,series:[{name:"发电小时",itemStyle:{},needArea:!0,barGap:0,data:t}]},otherOptions:{grid:{...this.getGrid({top:30,bottom:10})},color:[{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#EFDB01"},{offset:1,color:"#5C5703"}],global:!1}]},initedChart(e){e.on("datazoom",r=>{a.updateCache(i,r)})},beforeSetOptions:e=>(this.getAxis(e,this.ltBarProps3.chartData.unit),e.series.forEach(r=>{r.barWidth=16,r.animation=this.animation}),e.dataZoom=this.getDataZoom(e.xAxis.data.length,this.treeOpen?22:30,a.cache[i]),e.yAxis.name=`小时(${e.yAxis.name})`,e)}},entityInfo(){return this.$store.state.entityInfo},targetType(){return[{label:"风机可利用率",value:this.windData&&this.windData.avgAvailableRate?this.strip(this.windData.avgAvailableRate*100):0,unit:"%"},{label:"平均风速",value:this.windData&&this.windData.avgSpeed,unit:"m/s"},{label:"等效发电小时数",value:this.windData&&this.windData.eqGenerateHour,unit:"h"}]},lossPoserData(){const s=n=>+n.toFixed(2);let t=this.windData&&this.windData.lostGenerationList&&this.windData.lostGenerationList.length?this.windData.lostGenerationList:[],a=t.find(n=>n.status==="限电"),i=t.find(n=>n.status==="故障"),e=t.find(n=>n.status==="维护"),r=a?a.time:0,o=i?i.time:0,h=e?e.time:0;return{total:{label:"总损失发电量",value:s(o+h+r),unit:"MW"},error:{label:"故障",value:o,unit:"MW"},service:{label:"维护",value:h,unit:"MW"},limit:{label:"限电",value:r,unit:"MW"}}},tableData(){if(this.runData&&this.runData.length){let s={};return this.runData.forEach((t,a)=>{s[a]=`${t.time}${this.unit}`}),[s]}else return[]},allTime(){return this.runData&&this.runData.length?this.runData[this.runData.length-1].time:0},comProps3(){let s=[],t=["#34D631","#F4A460","#FF6464","#B0C4DE","#44FFC9","#DDAFFF","#239E7F","#BC8F8F","#FF78AB","#2398ff","#C9AB19","#1DD1FF","#FF63FA","#EF2E0F","#FFBA19","#1376DB","#AC4F87","#E4FF98","#8C24D9"];return this.runData&&this.runData.length&&(s=this.runData.map((a,i)=>({name:a.status,y:a.time,color:t[i]})).filter(a=>a.name!=="有效时长"&&a.y!==0)),{chartData:{unit:this.titleUnit,series:s},maxItem:30,otherOptions:{grid:{...this.getGrid()},plotOptions:{pie:{showInLegend:!1,center:["50%","40%"],size:90,depth:40,innerSize:"60%"}}},beforeSetOptions:a=>(Object.assign(a.series[0],{size:170}),a)}},columns(){let s=19;if(this.runData&&this.runData.length){let t=this.runData.map((i,e)=>({label:i.status,key:e,type:"popup",style:{width:`${(100-s)/(this.runData.length-1)}%`,padding:"0px",flexShrink:1,textAlign:"center"}})),a=t.find(i=>i.label==="有效时长");return a.style.width=`${s}%`,a.labelCustomRender=()=>l("div",{class:"content",style:"font-size: 16px;"},["有效时长",l("a-popover",{attrs:{overlayClassName:"content-popup",placement:"topRight"}},[l("template",{slot:"content",class:"tips_content"},[l("div",["有效运行时长为经数据预处理后的风机各状态的时长总和。"])]),l("div",{class:"tips"})])]),t}else return[]},projectId(){return this.$store.state.entityInfo.projectId}},mounted(){this.start()},beforeDestroy(){this.flag=!1},methods:{updateCache(s,t){let a=this.cache[s]||{},i=null,e=null;if(t.end)i=t.start,e=t.end;else{let r=t.batch[0];i=r.start,e=r.end}a.start=i,a.end=e,this.cache[s]=a},async start(){for(;this.flag;)await this.sleep(10*1e3),this.flag&&(this.animation=!1,this.getData())},sleep(s){return new Promise(t=>setTimeout(t,s))},strip(s,t=12){return+parseFloat(s.toPrecision(t))},setActive(s){this.active=s,this.getRun()},getWind(){c({topicName:this.topicName,dateType:this.dateType,fanType:this.windBtnVal}).then(s=>{this.windData=s.result})},getRun(){u({entityId:this.entityInfo.entityId,dateType:this.dateType,avg:this.active===1,fanType:this.windBtnVal}).then(s=>{this.runData=s.result.data,this.fenShowData={name:s.result.name,num:s.result.num}})},getHour(){d({entityId:this.entityInfo.entityId,dateType:this.dateType,fanType:this.windBtnVal}).then(s=>{this.hourData=s.result})},getRate(){p({entityId:this.entityInfo.entityId,fanType:this.windBtnVal,dateType:this.dateType}).then(s=>{this.rateData=s.result})},getGeneration(){m({entityId:this.entityInfo.entityId,dateType:this.dateType,fanType:this.windBtnVal}).then(s=>{this.generationData=s.result})},getData(){this.getWind(),this.getRun(),this.getHour(),this.getRate(),this.getGeneration()},getTime({dateType:s}){this.dateType=s,this.animation=!0,this.getData()}}};var T=function(){var t=this,a=t._self._c;return a("div",{staticClass:"page_target_group"},[a("div",{staticClass:"left"},[a("div",{staticClass:"lt_container"},[a("ChartTitle",{attrs:{titles:["发电量排名/趋势统计"],useLongIcon:!0}}),a("div",{staticClass:"chartSort"},t._l(t.sortType,function(i,e){return a("div",{key:e,class:["li",{active:e===t.powerGenerationSort}],on:{click:function(r){t.powerGenerationSort=e}}},[t._v(" "+t._s(i)+" ")])}),0),a("div",{staticClass:"lt_chart_container"},[a("ChartByComm",{staticClass:"showChartTitle",attrs:{cName:t.chartType[t.powerGenerationSort],comProps:t.powerGenerationSort?t.ltLineProps:t.ltBarProps,"data-title":"发电量(kWh)"}})],1)],1),a("div",{staticClass:"lc_container"},[a("ChartTitle",{attrs:{titles:["风机可利用率排名/趋势统计"],useLongIcon:!0}}),a("div",{staticClass:"chartSort"},t._l(t.sortType,function(i,e){return a("div",{key:e,class:["li",{active:e===t.utilizationRateSort}],on:{click:function(r){t.utilizationRateSort=e}}},[t._v(" "+t._s(i)+" ")])}),0),a("div",{staticClass:"lc_chart_container"},[a("ChartByComm",{staticClass:"showChartTitle",attrs:{cName:t.chartType[t.utilizationRateSort],comProps:t.utilizationRateSort?t.ltLineProps2:t.ltBarProps2,"data-title":"可利用率(%)"}})],1)],1),a("div",{staticClass:"lb_container"},[a("ChartTitle",{attrs:{titles:["等效发电小时排名/趋势统计"],useLongIcon:!0}}),a("div",{staticClass:"chartSort"},t._l(t.sortType,function(i,e){return a("div",{key:e,class:["li",{active:e===t.generationDurationSort}],on:{click:function(r){t.generationDurationSort=e}}},[t._v(" "+t._s(i)+" ")])}),0),a("div",{staticClass:"lb_chart_container"},[a("ChartByComm",{staticClass:"showChartTitle",attrs:{cName:t.chartType[t.generationDurationSort],comProps:t.generationDurationSort?t.ltLineProps3:t.ltBarProps3,"data-title":"小时(h)"}})],1)],1)]),a("div",{staticClass:"right"},[a("div",{staticClass:"header"},[a("div",{staticClass:"h_right"},[a("span",{staticClass:"extend"},[a("div",{staticStyle:{display:"flex","align-items":"center"},on:{click:function(i){t.showReadModal=!0}}},[a("i",{staticClass:"tips",attrs:{"data-tile":""}}),a("i",{staticClass:"tips_desc"},[t._v("数据说明")])])]),a("DateSelection",{ref:"dateSelection",staticClass:"dateSelection",attrs:{onlyTab:!0,defaultItem:1},on:{getTime:t.getTime}})],1),a("WindTabs",{staticStyle:{position:"absolute",left:"0",top:"33px"},attrs:{entityInfo:t.entityInfo},on:{getWindBtnVal:i=>{t.windBtnVal=i,t.getData()}}})],1),a("div",{staticClass:"rt_container"},[a("ChartTitle",{attrs:{titles:["风电场指标计算统计"],useLongIcon:!1}}),a("div",{staticClass:"target_row"},t._l("012",function(i,e){return a("div",{key:e,staticClass:"li"},[a("div",{staticClass:"label"},[t._v(" "+t._s(t.targetType[e].label)+" ")]),a("div",{staticClass:"value"},[a("span",{staticClass:"value_green"},[t._v(t._s(t.targetType[e].value))]),a("span",{staticClass:"unit"},[t._v(t._s(t.targetType[e].unit))])])])}),0),a("div",{staticClass:"target_detail"},[a("div",{staticClass:"detail_l"},[a("div",{staticClass:"label"},[t._v("总损失发电量")]),a("div",{staticClass:"value"},[a("span",{staticClass:"value_red"},[t._v(t._s(t.lossPoserData.total.value))]),a("span",{staticClass:"unit"},[t._v(" "+t._s(t.lossPoserData.total.unit))]),a("span",{staticClass:"unitTime",staticStyle:{"font-size":"16px"}},[t._v("·h")])])]),a("div",{staticClass:"detail_r"},[a("div",{staticClass:"li"},[a("div",{staticClass:"label"},[t._v("故障")]),a("div",{staticClass:"value"},[a("span",{staticClass:"value_yellow"},[t._v(t._s(t.lossPoserData.error.value))]),a("span",{staticClass:"unit"},[t._v(" "+t._s(t.lossPoserData.error.unit)),a("span",{staticClass:"unitTime"},[t._v("·h")])])])]),a("div",{staticClass:"li"},[a("div",{staticClass:"label"},[t._v("维护")]),a("div",{staticClass:"value"},[a("span",{staticClass:"value_green"},[t._v(t._s(t.lossPoserData.service.value))]),a("span",{staticClass:"unit"},[t._v(" "+t._s(t.lossPoserData.service.unit)),a("span",{staticClass:"unitTime"},[t._v("·h")])])])]),a("div",{staticClass:"li"},[a("div",{staticClass:"label"},[t._v("限电")]),a("div",{staticClass:"value"},[a("span",{staticClass:"value_blue"},[t._v(t._s(t.lossPoserData.limit.value))]),a("span",{staticClass:"unit"},[t._v(" "+t._s(t.lossPoserData.limit.unit)),a("span",{staticClass:"unitTime"},[t._v("·h")])])])])])])],1),a("div",{staticClass:"rc_container"},[a("Tabs",{staticClass:"tabsBox",attrs:{tabArr:t.tabArr,active:t.active},on:{selected:i=>t.setActive(i)}}),a("SeaProTable",{attrs:{columns:t.columns,data:t.tableData,title:"各运行状态时长/"+t.titleUnit}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.comProps3.chartData.series.length,expression:"comProps3.chartData.series.length"}],staticClass:"rb_container"},[a("div",{staticClass:"pieChartTitle"},[a("span",{staticClass:"label"},[t._v("有效时长")]),a("span",{staticClass:"value"},[t._v(t._s(t.allTime))]),a("span",{staticClass:"unit"},[t._v(t._s(t.titleUnit))])]),a("ChartByComm",{staticClass:"pieBox",attrs:{cName:"PieForHighchart",comProps:t.comProps3}}),t.fenShowData&&t.fenShowData.name?a("span",{staticClass:"marker"},[t._v("注：本次统计包含风机型号："+t._s(t.fenShowData&&t.fenShowData.name.replace("null,","").replace(",null",""))+"，共"+t._s(t.fenShowData&&t.fenShowData.num)+"台")]):t._e()],1),a("NoData",{directives:[{name:"show",rawName:"v-show",value:!t.comProps3.chartData.series.length,expression:"!comProps3.chartData.series.length"}],staticStyle:{transform:"translateY(7vh) scale(0.7)"}})],1),a("ReadModal",{model:{value:t.showReadModal,callback:function(i){t.showReadModal=i},expression:"showReadModal"}})],1)},S=[],A=v(w,T,S,!1,null,"1c7db0c9");const L=A.exports;export{L as default};
