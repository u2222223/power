// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(w,E,q,F,G,H,l){class I extends H{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(c,e){const {context:g,displayLevel:m,state:v,drawPhase:J,painter:K,pixelRatio:x,spriteMosaic:n,styleLayerUID:r,requestRender:y,allowDelayedRender:L}=c;if(e.some(f=>f.layerData.get(r)?.lineIndexCount??!1)){c=c.styleLayer;var z=
c.lineMaterial,M=K.vectorTilesMaterialManager,d=c.getPaintValue("line-translate",m),b=c.getPaintValue("line-translate-anchor",m),h=c.getPaintProperty("line-pattern"),t=void 0!==h,A=t&&h.isDataDriven;if(t&&!A){h=h.getValue(m);var k=n.getMosaicItemPosition(h)}var a;h=!1;if(!t){var p=c.getPaintProperty("line-dasharray");h=(a=void 0!==p)&&p.isDataDriven;a&&!h&&(k=p.getValue(m),k=c.getDashKey(k,c.getLayoutValue("line-cap",m)),k=n.getMosaicItemPosition(k))}p=1/x;var B=J===F.WGLDrawPhase.HITTEST,u=this._programOptions;
u.id=B;u.pattern=t;u.sdf=a;a=M.getMaterialProgram(g,z,u);if(L&&null!=y&&!a.compiled)y();else{g.useProgram(a);a.setUniformMatrix3fv("u_displayViewMat3",v.displayViewMat3);a.setUniformMatrix3fv("u_displayMat3",b===E.TranslateAnchor.VIEWPORT?v.displayMat3:v.displayViewMat3);a.setUniform2fv("u_lineTranslation",d);a.setUniform1f("u_depth",c.z);a.setUniform1f("u_antialiasing",p);B&&(d=G.u32to4Xu8(r+1),a.setUniform4fv("u_id",d));k&&null!=k&&({page:d}=k,b=n.getPageSize(d),null!=b&&(n.bind(g,l.TextureSamplingMode.LINEAR,
d,q.vtlTextureBindingUnitSprites),a.setUniform2fv("u_mosaicSize",b),a.setUniform1i("u_texture",q.vtlTextureBindingUnitSprites)));d=-1;for(const f of e)if(f.layerData.has(r)&&(f.key.level!==d&&(d=f.key.level,z.setDataUniforms(a,m,c,d,n)),a.setUniform1f("u_zoomFactor",2**(m-d)/x),e=f.layerData.get(r),e.lineIndexCount&&(e.prepareForRendering(g),b=e.vao,null!=b))){g.bindVAO(b);a.setUniformMatrix3fv("u_dvsMat3",f.transforms.dvs);g.setStencilFunction(l.CompareFunction.EQUAL,f.stencilRef,255);if(A||h){b=
e.patternMap;if(!b)continue;for(const [C,D]of b)b=n.getPageSize(C),null!=b&&(n.bind(g,l.TextureSamplingMode.LINEAR,C,q.vtlTextureBindingUnitSprites),a.setUniform2fv("u_mosaicSize",b),a.setUniform1i("u_texture",q.vtlTextureBindingUnitSprites),g.drawElements(l.PrimitiveType.TRIANGLES,D[1],l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*D[0]))}else g.drawElements(l.PrimitiveType.TRIANGLES,e.lineIndexCount,l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart);f.triangleCount+=
e.lineIndexCount/3}}}}}w.WGLBrushVTLLine=I;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});