// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/mathUtils ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(u,v,C,D,p,E,F,G,H,k,I){class J extends G{constructor(){super(...arguments);this._color=D.fromValues(1,0,0,1);this._patternMatrix=C.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(a,
g){const {context:f,painter:h,styleLayerUID:K,requestRender:w,allowDelayedRender:L}=a;this._loadWGLResources(a);const l=a.displayLevel;var c=a.styleLayer,b=c.backgroundMaterial;const M=h.vectorTilesMaterialManager;var d=c.getPaintValue("background-color",l);const x=c.getPaintValue("background-opacity",l),y=c.getPaintValue("background-pattern",l),q=void 0!==y,m=d[3]*x,r=a.spriteMosaic;let z,A;const N=(window.devicePixelRatio|1)>p.vtlHighResCutoff?2:1;a=a.drawPhase===E.WGLDrawPhase.HITTEST;const t=
this._programOptions;t.id=a;t.pattern=q;b=M.getMaterialProgram(f,b,t);if(L&&null!=w&&!b.compiled)w();else{f.bindVAO(this._vao);f.useProgram(b);if(q){d=r.getMosaicItemPosition(y,!0);if(null!=d){const {tl:e,br:n,page:B}=d;z=n[0]-e[0];A=n[1]-e[1];d=r.getPageSize(B);null!=d&&(r.bind(f,k.TextureSamplingMode.LINEAR,B,p.vtlTextureBindingUnitSprites),b.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),b.setUniform2fv("u_mosaicSize",d),b.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites))}b.setUniform1f("u_opacity",
x)}else this._color[0]=m*d[0],this._color[1]=m*d[1],this._color[2]=m*d[2],this._color[3]=m,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",c.z||0);a&&(c=F.u32to4Xu8(K+1),b.setUniform4fv("u_id",c));for(const e of g)b.setUniform1f("u_coord_range",e.rangeX),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),q&&(c=N*e.width*Math.max(2**(Math.round(l)-e.key.level),1),g=c/v.nextPowerOfTwo(z),c/=v.nextPowerOfTwo(A),this._patternMatrix[0]=g,this._patternMatrix[4]=c,b.setUniformMatrix3fv("u_pattern_matrix",
this._patternMatrix)),f.setStencilFunction(k.CompareFunction.EQUAL,0,255),f.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(a){if(!this._vao){var {context:g,styleLayer:f}=a;a=f.backgroundMaterial;var h=new Int8Array([0,0,1,0,0,1,1,1]);h=H.BufferObject.createVertex(g,k.Usage.STATIC_DRAW,h);this._vao=new I.VertexArrayObject(g,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:h})}}}u.WGLBrushVTLBackground=J;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});