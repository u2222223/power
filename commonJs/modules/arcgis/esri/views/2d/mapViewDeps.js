// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define("exports ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/scheduling ../../../core/signal ../../../chunks/mat3f32 ../../../symbols/cim/CIMResourceManager ./Container ./ManagedCanvas ./webgl/BufferPool ./webgl/enums ./webgl/Painter ./webgl/Profiler ../support/Timeline ../../support/screenshotUtils ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/RenderbufferDescriptor ../../webgl/RenderingContext ../../webgl/TextureDescriptor ../../webgl/capabilities/isWebGL2Context ../../../core/imageUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B,y){class E extends b.Container{constructor(F,C){super();this._trash=new Set;this._lastFrameRenderTime=this._renderRemainingTime=0;this._renderRequested=f.signal(!1);this.stage=this;this._stationary=!0;this._canvas=new c.ManagedCanvas(F);this.context=new q.RenderingContext(this._canvas.gl,C.contextOptions??{});this.resourceManager=new a;this.painter=new k(this.context,this,this.resourceManager);v("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),
this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),F.appendChild(this._debugOutput));const A=()=>this._highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:C.timeline||new r.Timeline,renderingOptions:C.renderingOptions,requestRender:()=>this.requestRender(),
allowDelayedRender:!1,requireFBO:!1,profiler:new l.Profiler(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return A()},backgroundColor:C.backgroundColor};this._taskHandle=p.addFrameTask({render:D=>this.renderFrame(D)});this._taskHandle.pause();this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",D=>this.emit("webgl-error",{error:new g("webgl-context-lost",D.statusMessage)}));this._bufferPool=new m.BufferPool}destroy(){this.removeAllChildren();this._emptyTrash();
this._taskHandle=n.removeMaybe(this._taskHandle);this._lostWebGLContextHandle=n.removeMaybe(this._lostWebGLContextHandle);this._canvas.destroy();this._debugOutput?.parentNode?.removeChild(this._debugOutput);this._bufferPool.destroy();this.resourceManager.destroy();this.painter.dispose();this.context.dispose();this._canvas=null}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(F){this._renderParameters.backgroundColor=F;this.requestRender()}get bufferPool(){return this._bufferPool}get renderingOptions(){return this._renderingOptions}set renderingOptions(F){this._renderingOptions=
F;this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(F){this._state=F;this.requestRender()}get stationary(){return this._stationary}set stationary(F){this._stationary!==F&&(this._stationary=F,this.requestRender())}trashDisplayObject(F){this._trash.add(F);this.requestRender()}untrashDisplayObject(F){return this._trash.delete(F)}requestRender(){this._renderRemainingTime=2E3;this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(F){this._renderRemainingTime-=
this._lastFrameRenderTime?F.time-this._lastFrameRenderTime:0;0>=this._renderRemainingTime&&this._taskHandle.pause();this._lastFrameRenderTime=F.time;this._renderRequested.value=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this._renderParameters.time=F.time;this._renderParameters.deltaTime=F.deltaTime;this._renderParameters.effects=null;this.processRender(this._renderParameters);
this._emptyTrash()}_createTransforms(){return{dvs:e.create()}}renderChildren(F){for(const C of this.children)C.beforeRender(F);this._canvas.render(F,()=>this._renderChildren(this.children,F));for(const C of this.children)C.afterRender(F)}_renderChildren(F,C){const A=this.context;this.painter.textureUploadManager.upload();A.resetInfo();C.profiler.recordStart("drawLayers");C.dataUploadCounter=0;this.painter.beforeRenderPhases(C,C.backgroundColor,this.state.padding);C.drawPhase=d.WGLDrawPhase.MAP;for(const D of F)D.processRender(C);
if(this.children.some(D=>D.hasHighlight)){C.drawPhase=d.WGLDrawPhase.HIGHLIGHT;for(const D of F)D.processRender(C)}if(this.children.some(D=>D.hasLabels)){C.drawPhase=d.WGLDrawPhase.LABEL;for(const D of F)D.processRender(C)}if(v("esri-tiles-debug")){C.drawPhase=d.WGLDrawPhase.DEBUG;for(const D of F)D.processRender(C)}this.painter.afterRenderPhases(C);C.profiler.recordEnd("drawLayers");A.logInfo()}doRender(F){const C=this.context,{state:A,pixelRatio:D}=F;this._canvas.resize(F);C.setViewport(0,0,D*A.size[0],
D*A.size[1]);C.setDepthWriteEnabled(!0);C.setStencilWriteMask(255);this.renderChildren(F)}async takeScreenshot(F,C,A,D){const G=Math.round(this.state.size[0]*F.resolutionScale),J=Math.round(this.state.size[1]*F.resolutionScale);var M=F.resolutionScale,L=this.context,Q=this._state.clone();if(null!=D){const N=Q.viewpoint;Q.viewpoint.rotation=D;Q.viewpoint=N}D={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:Q,pixelRatio:M,time:performance.now(),deltaTime:0,blendMode:null,
effects:null,inFadeTransition:!1,backgroundColor:A};A=B(L.gl);M=new t.TextureDescriptor(G,J);M.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE;M.internalFormat=A?w.SizedPixelFormat.RGBA8:w.PixelFormat.RGBA;M.isImmutable=A;A=new x.FramebufferObject(L,M,new z.RenderbufferDescriptor(w.RenderbufferFormat.DEPTH_STENCIL,G,J));M=L.getBoundFramebufferObject();Q=L.getViewport();L.bindFramebuffer(A);L.setViewport(0,0,G,J);this._renderChildren(C??this.children,D);C=this._readbackScreenshot(A,{...F.cropArea,y:J-(F.cropArea.y+
F.cropArea.height)});L.bindFramebuffer(M);L.setViewport(Q.x,Q.y,Q.width,Q.height);this.requestRender();L=await C;1===F.outputScale?F=L:(F=new ImageData(Math.round(L.width*F.outputScale),Math.round(L.height*F.outputScale)),u.resampleHermite(L,F,!0));A.dispose();return F}async _readbackScreenshot(F,C){const A=y.createEmptyImageData(C.width,C.height,document.createElement("canvas"));await F.readPixelsAsync(C.x,C.y,C.width,C.height,w.PixelFormat.RGBA,w.PixelType.UNSIGNED_BYTE,new Uint8Array(A.data.buffer));
return A}_emptyTrash(){for(;0<this._trash.size;){const F=Array.from(this._trash);this._trash.clear();for(const C of F)C.processDetach()}}}h.Stage=E;h.extraRenderTime=2E3;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(h,g){class v{constructor(){this._resourceMap=new Map;this._inFlightResourceMap=new Map;this.geometryEnginePromise=this.geometryEngine=null}destroy(){this._inFlightResourceMap.clear();
this._resourceMap.clear()}getResource(n){return this._resourceMap.get(n)??null}async fetchResource(n,p){var f=this._resourceMap.get(n);if(f)return{width:f.width,height:f.height};if(f=this._inFlightResourceMap.get(n))return f.then(e=>({width:e.width,height:e.height}));f=g.getImageData(n,p);this._inFlightResourceMap.set(n,f);return f.then(e=>{this._inFlightResourceMap.delete(n);this._resourceMap.set(n,e);return{width:e.width,height:e.height}},()=>({width:0,height:0}))}deleteResource(n){this._inFlightResourceMap.delete(n);
this._resourceMap.delete(n)}loadFont(n){return h.loadFont(n)}}return v})},"esri/core/fontUtils":function(){define(["exports","../config"],function(h,g){function v(a){if(!a)return"arial-unicode-ms";a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}function n(a){a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":var b=
"-bold";break a}b=""}a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblique":var c="-italic";break a}c=""}b+=c;return v(a.family)+(0<b.length?b:"-regular")}const p=new Map,f=new Set;class e{constructor(a,b){this.fontFace=a;this.promise=b}}h.clearFonts=function(){const a=document.fonts;p.forEach(b=>{a.delete(b.fontFace)});p.clear();f.clear()};h.defaultFontFamily="arial-unicode-ms";h.getFontFamily=v;h.getFullyQualifiedFontName=n;h.isCachedFontFace=function(a){return f.has(a)};h.loadFont=
async function(a){const b=n(a),c=p.get(b);if(c)return c.promise;const m=new FontFace(a.family,`url('${g.fontsUrl}/woff2/${b}.${"woff2"}') format('${"woff2"}')`,{style:a.style,weight:a.weight}),d=document.fonts;if(d.has(m)&&"loading"===m.status)return m.loaded;a=m.load().then(()=>{d.add(m);return m});p.set(b,new e(m,a));f.add(m);return a};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Container":function(){define(["exports","../../../chunks/mat3f32","../../../layers/effects/EffectView",
"./DisplayObject","./webgl/effects/highlight/HighlightGradient"],function(h,g,v,n,p){class f extends n.DisplayObject{constructor(){super(...arguments);this._childrenSet=new Set;this._needsSort=!1;this.children=[];this._highlightGradient=this._highlightOptions=this._effectView=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e;this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e;this.children.forEach(a=>a.clips=e)}get computedEffects(){return this._effectView?.effects??
null}get effect(){return this._effectView?.effect??""}set effect(e){if(this._effectView||e)this._effectView||(this._effectView=new v.EffectView),this._effectView.effect=e,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){e?this._highlightOptions&&this._highlightOptions.equals(e)||(this._highlightOptions=e,this._highlightGradient||(this._highlightGradient=new p),this._highlightGradient.setHighlightOptions(e),this.requestRender()):(this._highlightOptions=
null,this._highlightGradient&&(this._highlightGradient.destroy(),this._highlightGradient=null,this.requestRender()))}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some(e=>e.hasHighlight)}get hasLabels(){return this.children.some(e=>e.hasLabels)}get requiresDedicatedFBO(){return this.children.some(e=>"blendMode"in e&&e.blendMode&&"normal"!==e.blendMode)}updateTransitionProperties(e,a){super.updateTransitionProperties(e,a);this._effectView&&(this._effectView.transitionStep(e,
a),this._effectView.transitioning&&this.requestRender())}doRender(e){e=this.createRenderParams(e);const {painter:a}=e;a.beforeRenderLayer(e,this._clips?.length?255:0,this.computedOpacity);this.renderChildren(e);a.afterRenderLayer(e,this.computedOpacity)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,a=this.children.length){if(!e||this.contains(e))return e;this._needsSort=!0;const b=e.parent;b&&b!==this&&b.removeChild(e);a>=this.children.length?this.children.push(e):this.children.splice(a,
0,e);this._childrenSet.add(e);e.parent=this;e.stage=this.stage;this!==this.stage&&(e.clips=this.clips);this.requestRender();return e}contains(e){return this._childrenSet.has(e)}endTransitions(){super.endTransitions();this._effectView&&(this._effectView.endTransitions(),this.requestRender())}removeAllChildren(){this._childrenSet.clear();this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?
this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(0>e||e>=this.children.length)return null;this._needsSort=!0;e=this.children.splice(e,1)[0];this._childrenSet.delete(e);this!==this.stage&&(e.clips=null);e.stage=null;e.parent=null;return e}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}beforeRender(e){super.beforeRender(e);for(const a of this.children)a.beforeRender(e)}afterRender(e){super.afterRender(e);for(const a of this.children)a.afterRender(e)}_createTransforms(){return{dvs:g.create()}}onAttach(){super.onAttach();
const e=this.stage;for(const a of this.children)a.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const a of this.children)a.processRender(e)}createRenderParams(e){return{...e,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||e.highlightGradient}}}h.Container=f;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./parser ./utils".split(" "),function(h,g,v,n,p,f,e,a,b,c,m){function d(r){r=c.parse(r)||[];var u=(u=r[0])?"type"in u:!1;return u?[{scale:-1,effects:r}]:r}function k(r,u,w){return r[0]?.effects&&
u[0]?.effects?(-1===r[0]?.scale||-1===u[0]?.scale)&&(1<r.length||1<u.length)&&0>=w?!1:m.canInterpolateEffects(r[0].effects,u[0].effects):!0}function l(r,u,w){const x=r.length>u.length?r:u;r=r.length>u.length?u:r;var z=r[r.length-1];u=z?.scale??w;z=z?.effects??[];for(let q=r.length;q<x.length;q++)r.push({scale:u,effects:[...z]});for(u=0;u<x.length;u++)r[u].scale=-1===r[u].scale?w:r[u].scale,x[u].scale=-1===x[u].scale?w:x[u].scale,m.normalizeEffects(r[u].effects,x[u].effects)}h.EffectView=class extends v{constructor(r){super(r);
this._final=this._to=this._from=null;this._current=[];this._time=0;this.duration=n("mapview-transitions-duration");this.effects=[]}set effect(r){const u=this._get("effect");r=r||"";if(u!==r){this._set("effect",r);try{this._transitionTo(d(r))}catch(w){this._transitionTo([]),f.getLogger(this).warn("Invalid Effect",{effect:r,error:w})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(r){this._updateForScale(r)}get transitioning(){return null!==this._to}canTransitionTo(r){try{return 0<
this.scale&&k(this._current,d(r),this.scale)}catch{return!1}}transitionStep(r,u){this._applyTimeTransition(r);this._updateForScale(u)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(r){0<this.scale&&k(this._current,r,this.scale)?(this._final=r,this._to=p.clone(r),l(this._current,this._to,this.scale),this._from=p.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=r);this._set("effects",this._current[0]?p.clone(this._current[0].effects):[])}_applyTimeTransition(r){if(this._to&&
this._from&&this._current&&this._final){this._time+=r;r=Math.min(1,this._time/this.duration);for(let w=0;w<this._current.length;w++){const x=this._current[w],z=this._from[w],q=this._to[w];var u=z.scale;x.scale=u+(q.scale-u)*r;for(u=0;u<x.effects.length;u++)x.effects[u].interpolate(z.effects[u],q.effects[u],r)}1===r&&(this._current=this._final,this._set("effects",this._current[0]?p.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}}_updateForScale(r){this._set("scale",r);if(0!==
this._current.length){var u=this._current,w=this._current.length-1,x,z=1;if(1===u.length||r>=u[0].scale)var q=x=u[0].effects;else if(r<=u[w].scale)q=x=u[w].effects;else for(let t=0;t<w;t++){const B=u[t],y=u[t+1];if(B.scale>=r&&y.scale<=r){z=(r-B.scale)/(y.scale-B.scale);x=B.effects;q=y.effects;break}}for(r=0;r<this.effects.length;r++)this.effects[r].interpolate(x[r],q[r],z)}}};g.__decorate([e.property()],h.EffectView.prototype,"_to",void 0);g.__decorate([e.property()],h.EffectView.prototype,"duration",
void 0);g.__decorate([e.property({value:""})],h.EffectView.prototype,"effect",null);g.__decorate([e.property({readOnly:!0})],h.EffectView.prototype,"effects",void 0);g.__decorate([e.property({readOnly:!0})],h.EffectView.prototype,"hasEffects",null);g.__decorate([e.property({value:0})],h.EffectView.prototype,"scale",null);g.__decorate([e.property({readOnly:!0})],h.EffectView.prototype,"transitioning",null);h.EffectView=g.__decorate([b.subclass("esri.layers.effects.EffectView")],h.EffectView);h.canInterpolateEffectStops=
k;h.convertEffectToStops=d;h.normalizeEffectStops=l;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(h,g,v,n){const p=1/v("mapview-transitions-duration");class f extends g{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=
this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage!==e){var a=this._stage;(this._stage=e)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):
a?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=
null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=n.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=n.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();
this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale);this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&
this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(e,a){if(this.fadeTransitionEnabled){a=this._fadeOutResolver||!this.visible?0:this.opacity;const b=this.computedOpacity;b===a?this.computedVisible=this.visible:(e*=p,this.computedOpacity=
b>a?Math.max(a,b-e):Math.min(a,b+e),this.computedVisible=0<this.computedOpacity,e=a===this.computedOpacity,this.inFadeTransition=!e,e||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}h.DisplayObject=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("../../../../../../core/Logger ../../definitions ./parameters ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f){function e(m,d){d.fillColor[0]=m.color.r/255;d.fillColor[1]=m.color.g/255;d.fillColor[2]=m.color.b/255;d.fillColor[3]=m.color.a;m.haloColor?(d.outlineColor[0]=m.haloColor.r/255,d.outlineColor[1]=m.haloColor.g/255,d.outlineColor[2]=m.haloColor.b/255,d.outlineColor[3]=m.haloColor.a):(d.outlineColor[0]=d.fillColor[0],d.outlineColor[1]=d.fillColor[1],d.outlineColor[2]=d.fillColor[2],d.outlineColor[3]=d.fillColor[3]);d.fillColor[3]*=m.fillOpacity;d.outlineColor[3]*=m.haloOpacity;
d.fillColor[0]*=d.fillColor[3];d.fillColor[1]*=d.fillColor[3];d.fillColor[2]*=d.fillColor[3];d.outlineColor[0]*=d.outlineColor[3];d.outlineColor[1]*=d.outlineColor[3];d.outlineColor[2]*=d.outlineColor[3];d.outlineWidth=v.highlightSizing.outlineWidth;d.outerHaloWidth=v.highlightSizing.outerHaloWidth;d.innerHaloWidth=v.highlightSizing.innerHaloWidth;d.outlinePosition=v.highlightSizing.outlinePosition}const a=h.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),b=[0,0,0,0];class c{constructor(){this._convertedHighlightOptions=
{fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:v.highlightSizing.outlinePosition,outlineWidth:v.highlightSizing.outlineWidth,innerHaloWidth:v.highlightSizing.innerHaloWidth,outerHaloWidth:v.highlightSizing.outerHaloWidth};this._shadeTexChanged=!0;this._texelData=new Uint8Array(4*v.shadeTextureSize);this._minMaxDistance=[0,0]}setHighlightOptions(m){function d(q,t,B){z[0]=(1-B)*q[0]+B*t[0];z[1]=(1-B)*q[1]+B*t[1];z[2]=(1-B)*q[2]+B*t[2];z[3]=(1-B)*q[3]+B*t[3]}const k=
this._convertedHighlightOptions;e(m,k);m=k.outlinePosition-k.outlineWidth/2-k.outerHaloWidth;const l=k.outlinePosition-k.outlineWidth/2,r=k.outlinePosition+k.outlineWidth/2,u=k.outlinePosition+k.outlineWidth/2+k.innerHaloWidth;var w=Math.sqrt(Math.PI/2)*v.sigma,x=Math.abs(m)>w?Math.round(10*(Math.abs(m)-w))/10:0;w=Math.abs(u)>w?Math.round(10*(Math.abs(u)-w))/10:0;x&&!w?a.error("The outer rim of the highlight is "+x+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):
!x&&w?a.error("The inner rim of the highlight is "+w+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):x&&w&&a.error("The highlight is "+Math.max(x,w)+"px away from the edge of the feature; consider reducing some width values.");const z=[void 0,void 0,void 0,void 0];({_texelData:w}=this);for(let q=0;q<v.shadeTextureSize;++q)x=m+q/(v.shadeTextureSize-1)*(u-m),x<m?(z[0]=0,z[1]=0,z[2]=0,z[3]=0):x<l?d(b,k.outlineColor,
(x-m)/(l-m)):x<r?[z[0],z[1],z[2],z[3]]=k.outlineColor:x<u?d(k.outlineColor,k.fillColor,(x-r)/(u-r)):[z[0],z[1],z[2],z[3]]=k.fillColor,w[4*q]=255*z[0],w[4*q+1]=255*z[1],w[4*q+2]=255*z[2],w[4*q+3]=255*z[3];this._minMaxDistance[0]=m;this._minMaxDistance[1]=u;this._shadeTexChanged=!0}applyHighlightOptions(m,d){if(!this._shadeTex){const k=new f.TextureDescriptor;k.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;k.width=v.shadeTextureSize;k.height=1;this._shadeTex=new p.Texture(m,k)}this._shadeTexChanged&&(this._shadeTex.updateData(0,
0,0,v.shadeTextureSize,1,this._texelData),this._shadeTexChanged=!1);m.bindTexture(this._shadeTex,g.textureBindingHighlight1);d.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose();this._shadeTex=null}}return c})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports","../../../../core/has"],function(h,g){const v=256/360;g=g("featurelayer-force-marker-text-draw-order")?.5:3;h.angleFactor256=v;h.attributeDataAnimation=1;h.attributeDataDd0=3;h.attributeDataDd1=
4;h.attributeDataFilterFlags=0;h.attributeDataGpgpu=2;h.attributeDataVv=3;h.attributeStoreTextureSize=1024;h.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}};h.bitsetFillHasPatternHeightPrecisionFactor=32;h.bitsetFillHasPatternWidthPrecisionFactor=64;h.bitsetFillHasUnresolvedReplacementColor=8;h.bitsetFillRandomPatternOffset=4;h.bitsetGenericConsiderAlphaOnly=16;h.bitsetGenericLockColor=2;h.bitsetLineScaleDash=4;h.bitsetMarkerAlignmentMap=1;h.bitsetMarkerAlignmentScreen=
0;h.bitsetMarkerOutlineAllowColorOverride=4;h.bitsetMarkerScaleSymbolsProportionally=8;h.bitsetTypeFillOutline=1;h.bufferDataMinimumSize=128;h.bufferDataPoolSize=4;h.chartMaxFields=10;h.collisionBoxPadding=16;h.collisionBucketSize=128;h.collisionEarlyRejectBucketSize=16;h.collisionMaxZoomDelta=1;h.collisionPlacementPadding=8;h.collisionTileBoxSize=4;h.compressionFactorForU16=128;h.debugLabels=!1;h.displayRecordIntPerElement=8;h.dotDensityMaxFields=8;h.effectFlag0=4;h.enableEarlyLabelDiscard=!1;h.extrudeScale=
64;h.filterFlag0=2;h.glyphSize=24;h.heuristicGlyphsPerFeature=10;h.heuristicGlyphsPerLine=50;h.highlightFlag=1;h.hittestRadius=g;h.magicLabelLineHeight=29;h.maxFilters=2;h.maxGpuUploadsPerFrame=2;h.maxRepresentableInt=16777216;h.maxSizeForU16Compression=511;h.minMaxZoomPrecisionFactor=10;h.nanMagicNumber=1E-30;h.patchPixelBufferAllocSize=500;h.patternFillRasterizationScale=2;h.pictureFillColor=4294967295;h.randomInsidePolygonTextureSize=1024;h.rasterTileSize=256;h.sdfTextureSize=124;h.spritePadding=
2;h.textPlacementPadding=8;h.textureBindingAttributeData0=1;h.textureBindingAttributeData1=2;h.textureBindingAttributeData2=3;h.textureBindingAttributeData3=4;h.textureBindingAttributeData4=5;h.textureBindingAttributeData5=6;h.textureBindingBitmap=0;h.textureBindingGlyphAtlas=0;h.textureBindingGpgpu=12;h.textureBindingHighlight0=5;h.textureBindingHighlight1=6;h.textureBindingRenderer0=5;h.textureBindingRenderer1=6;h.textureBindingSpriteAtlas=0;h.textureUploadManagerBudget=4;h.textureUploadManagerChunkSize=
128;h.thinLineHalfWidthThreshold=1.05;h.tileSize=512;h.vtlHighResCutoff=1.15;h.vtlTextureBindingUnitGlyphs=6;h.vtlTextureBindingUnitSprites=5;h.webglMaxInnerStops=6;h.webglMaxStops=8;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["exports"],function(h){h.alphaToRgbaChannelSelectorMatrix=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];h.highlightSizing={outlineWidth:1.3,outerHaloWidth:.4,innerHaloWidth:.4,outlinePosition:0};
h.rgbaToRgbaChannelSelectorMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];h.shadeTextureSize=256;h.sigma=1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ManagedCanvas":function(){define("exports ../../../core/Evented ../../../core/events ../../../core/handleUtils ../../../core/has ../../../core/mathUtils ../../../chunks/mat2d ../../../chunks/mat2df64 ../../webgl/contextUtils".split(" "),function(h,g,v,n,p,f,e,a,b){class c{constructor(m){this.events=new g;this._hasMajorPerformanceCaveat=
!1;this._lastRenderFrameCounter=0;this._canvas=document.createElement("canvas");this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const d={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};m.appendChild(this._canvas);m=b.createContextForView("2d",this._canvas,d);m||(m=b.createContextForView("2d",this._canvas,{...d,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0);this._gl=m;this._handles=n.handlesGroup([v.on(this._canvas,
"webglcontextlost",k=>this.events.emit("webgl-context-lost",k))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas);this._canvas=null;this._handles.remove();this._gl=null}get gl(){return this._gl}render(m,d){if(this._hasMajorPerformanceCaveat||p("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=p("esri-performance-mode-frames-between-render")&&(d(),this._lastRenderViewState=m.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const [k,l,r,u,w,x]=this._computeViewTransform(this._lastRenderViewState,
m.state);this._canvas.style.transform=`matrix(${k}, ${l}, ${r}, ${u}, ${w}, ${x})`}}else d()}resize(m){const d=this._canvas,k=d.style,{state:{size:l},pixelRatio:r}=m;m=l[0];const u=l[1],w=Math.round(m*r),x=Math.round(u*r);if(d.width!==w||d.height!==x)d.width=w,d.height=x;k.width=m+"px";k.height=u+"px"}_computeViewTransform(m,d){const [k,l]=m.center,[r,u]=d.center,[w,x]=m.toScreen([0,0],r,u),[z,q]=m.toScreen([0,0],k,l),t=z-w,B=q-x,y=m.scale/d.scale;m=d.rotation-m.rotation;d=a.create();e.identity(d);
e.scale(d,d,[y,y]);e.rotate(d,d,f.deg2rad(m));e.translate(d,d,[t,B]);return d}}h.ManagedCanvas=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/BufferPool":function(){define(["exports","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(h,g,v,n){const p=g("esri-2d-log-allocations");class f{constructor(b,c){this._array=b;this._pool=c}get array(){return this._array}get length(){return this._array.length}static create(b,c){b=c.acquire(b);
return new f(b,c)}expand(b){b=this._pool.acquire(b);b.set(this._array);this._pool.release(this._array);this._array=b}destroy(){this._pool.release(this._array)}set(b,c){this._array.set(b._array,c)}slice(){const b=this._pool.acquire(this._array.byteLength);b.set(this._array);return new f(b,this._pool)}}class e{constructor(){this._data=new ArrayBuffer(e.BYTE_LENGTH);this._freeList=new n.FreeList({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64E6}get buffer(){return this._data}allocate(b){const c=
this._freeList.firstFit(b);return null==c?null:new Uint32Array(this._data,c,b/Uint32Array.BYTES_PER_ELEMENT)}free(b){this._freeList.free(b.byteOffset,b.byteLength)}}class a{constructor(){this._bytesAllocated=0;this._pages=[];this._pagesByBuffer=new Map;this._addPage()}destroy(){this._pages=[];this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*e.BYTE_LENGTH}acquire(b){this._bytesAllocated+=b;p&&console.log(`Allocating ${b}, (${this._bytesAllocated} / ${this._bytesTotal})`);if(b>e.BYTE_LENGTH)return new Uint32Array(b/
Uint32Array.BYTES_PER_ELEMENT);for(const c of this._pages){const m=c.allocate(b);if(null!=m)return m}b=this._addPage().allocate(b);v.assertIsSome(b,"Expected to allocate page");return b}release(b){this._bytesAllocated-=b.byteLength;p&&console.log(`Freeing ${b.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const c=this._pagesByBuffer.get(b.buffer);c&&c.free(b)}_addPage(){const b=new e;this._pages.push(b);this._pagesByBuffer.set(b.buffer,b);return b}}h.BufferPool=a;h.TypedBuffer=f;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports"],function(h){class g{constructor(n){this.next=null;if(Array.isArray(n)){this.data=n[0];var p=this;for(let f=1;f<n.length;f++)p.next=new g([n[f]]),p=p.next}else this.data=n}*values(){let n=this;for(;n;)yield n.data,n=n.next}forEach(n){let p=this;for(;p;)n(p.data),p=p.next}find(n){return n(this.data)?this:this.next?.find(n)}max(n,p=this){p=n(this.data)>n(p.data)?this:p;return this.next?
this.next.max(n,p):p}remove(n,p=null){return this===n?p?(p.next=this.next,p):this.next:this.next?.remove(n,this)??null}get last(){return this.next?this.next.last:this}}class v{constructor(n){this._head=null;null!=n&&(this._head=new g(n))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;const n=this._head.max(p=>p.end-p.start);return n.data.end-n.data.start}firstFit(n){if(null==this._head)return null;var p=null;let f=this._head;for(;f;){const e=f.data.end-f.data.start;
if(e===n)return p?p.next=f.next:this._head=f.next,f.data.start;if(e>n)return p=f.data.start,f.data.start+=n,p;p=f;f=f.next}return null}free(n,p){const f=n+p;if(null==this._head)this._head=new g({start:n,end:f});else if(f<=this._head.data.start)if(f===this._head.data.start)this._head.data.start-=p;else{var e=new g({start:n,end:f});e.next=this._head;this._head=e}else{e=this._head;for(var a=e.next;a;){if(a.data.start>=f){if(e.data.end===n){e.data.end+=p;e.data.end===a.data.start&&(e.data.end+=a.data.end-
a.data.start,e.next=a.next);return}if(a.data.start===f){a.data.start-=p;return}n=new g({start:n,end:f});n.next=e.next;e.next=n;return}e=a;a=a.next}n===e.data.end?e.data.end+=p:(n=new g({start:n,end:f}),e.next=n)}}}h.FreeList=v;h.List=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(["exports"],function(h){h.WGLGeometryType=void 0;(function(g){g[g.FILL=0]="FILL";g[g.LINE=1]="LINE";g[g.MARKER=2]="MARKER";g[g.TEXT=3]="TEXT";g[g.LABEL=
4]="LABEL"})(h.WGLGeometryType||(h.WGLGeometryType={}));h.WGLDrawPhase=void 0;(function(g){g[g.NONE=0]="NONE";g[g.MAP=1]="MAP";g[g.LABEL=2]="LABEL";g[g.LABEL_ALPHA=4]="LABEL_ALPHA";g[g.HITTEST=8]="HITTEST";g[g.HIGHLIGHT=16]="HIGHLIGHT";g[g.CLIP=32]="CLIP";g[g.DEBUG=64]="DEBUG";g[g.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(h.WGLDrawPhase||(h.WGLDrawPhase={}));h.VVType=void 0;(function(g){g[g.SIZE=0]="SIZE";g[g.COLOR=1]="COLOR";g[g.OPACITY=2]="OPACITY";g[g.ROTATION=3]="ROTATION"})(h.VVType||(h.VVType=
{}));h.WGLVVFlag=void 0;(function(g){g[g.NONE=0]="NONE";g[g.OPACITY=1]="OPACITY";g[g.COLOR=2]="COLOR";g[g.ROTATION=4]="ROTATION";g[g.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";g[g.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";g[g.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";g[g.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(h.WGLVVFlag||(h.WGLVVFlag={}));h.WGLVVTarget=void 0;(function(g){g[g.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";g[g.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";g[g.FIELD_TARGETS_OUTLINE=
512]="FIELD_TARGETS_OUTLINE";g[g.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(h.WGLVVTarget||(h.WGLVVTarget={}));h.MosaicType=void 0;(function(g){g[g.SPRITE=0]="SPRITE";g[g.GLYPH=1]="GLYPH"})(h.MosaicType||(h.MosaicType={}));h.WGLSymbologyType=void 0;(function(g){g[g.DEFAULT=0]="DEFAULT";g[g.SIMPLE=1]="SIMPLE";g[g.DOT_DENSITY=2]="DOT_DENSITY";g[g.OUTLINE_FILL=3]="OUTLINE_FILL";g[g.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE";g[g.HEATMAP=5]="HEATMAP";g[g.PIE_CHART=6]="PIE_CHART"})(h.WGLSymbologyType||
(h.WGLSymbologyType={}));Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define("../../../../core/has ../../../../core/maybe ../brushes ../vectorTiles/shaders/VTLMaterialManager ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./TextureUploadManager ./WorldExtentClipRenderer ./effects/AnimationEffect ./effects/BlendEffect ./effects/FeatureEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/HittestEffectVTL ./effects/post-processing/EffectManager ./painter/RenderPass ../../../webgl/contextUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B,y,E){function F(D,G){switch(D){case f.WGLGeometryType.LINE:return v.brushes.line;case f.WGLGeometryType.TEXT:return v.brushes.text;case f.WGLGeometryType.LABEL:return v.brushes.label;case f.WGLGeometryType.FILL:switch(G){case f.WGLSymbologyType.DOT_DENSITY:return v.brushes.dotDensity;default:return v.brushes.fill}case f.WGLGeometryType.MARKER:switch(G){case f.WGLSymbologyType.HEATMAP:return v.brushes.heatmap;case f.WGLSymbologyType.PIE_CHART:return v.brushes.pieChart;
default:return v.brushes.marker}}}function C(D,G,J,M){return D!==f.WGLDrawPhase.LABEL_ALPHA&&D!==f.WGLDrawPhase.LABEL&&D!==f.WGLDrawPhase.HIGHLIGHT&&(1!==M||null!=G&&"normal"!==G||null!=J&&0<J.length)}class A{constructor(D,G,J){this.context=D;this._blitRenderer=new p.BitBlitRenderer;this._worldExtentRenderer=new c.WorldExtentRenderer;this._brushCache=new Map;this._lastHeight=this._lastWidth=null;this._vtlMaterialManager=new n;this._blendEffect=new d.BlendEffect;this._stencilBuf=null;this._prevBeforeLayerFBOStack=
[];this._fboPool=[];this.effects={highlight:new l,hittest:new r.HittestEffect,hittestVTL:new u.HittestEffectVTL,integrate:new m.AnimationEffect,insideEffect:new k.FeatureEffect("inside"),outsideEffect:new k.FeatureEffect("outside")};this.materialManager=new e(D);this.textureManager=new a(G,J,D.type===z.ContextType.WEBGL2);this.textureUploadManager=new b.TextureUploadManager(D,G);this._effectsManager=new w.EffectManager}dispose(){this.materialManager.dispose();this.textureManager.dispose();this.textureUploadManager.destroy();
this._blitRenderer=g.disposeMaybe(this._blitRenderer);this._worldExtentRenderer=g.disposeMaybe(this._worldExtentRenderer);this._brushCache&&(this._brushCache.forEach(D=>D.dispose()),this._brushCache.clear(),this._brushCache=null);if(this._fbos){let D;for(D in this._fbos)this._fbos[D]&&this._fbos[D].dispose()}for(const D of this._fboPool)D.dispose();this._fboPool.length=0;if(this.effects){let D;for(D in this.effects)this.effects[D]&&this.effects[D].dispose()}this._effectsManager.dispose();this._blendEffect.dispose(this.context);
this._vtlMaterialManager=g.disposeMaybe(this._vtlMaterialManager)}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getFbos(){if(!this._fbos)throw Error("InternalError: Painter FBOs not initialized");return this._fbos}acquireFbo(D,G){if(0<this._fboPool.length)var J=this._fboPool.pop();else J=new E.TextureDescriptor(D,G),J.samplingMode=q.TextureSamplingMode.NEAREST,J.wrapMode=q.TextureWrapMode.CLAMP_TO_EDGE,J=new t.FramebufferObject(this.context,
J,this._stencilBuf);J.width===D&&J.height===G||J.resize(D,G);return J}releaseFbo(D){this._fboPool.push(D)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(D,G,J){const {context:M}=D;this._worldExtentRenderer.render(D,G,J);const {width:L,height:Q}=M.getViewport();this.updateFBOs(L,Q);this._prevFBO=M.getBoundFramebufferObject();M.bindFramebuffer(this.getFbos().output);M.setColorMask(!0,!0,!0,!0);if(null!=G){const {r:N,g:U,b:Z,a:H}=G;M.setClearColor(H*N/255,H*U/255,H*Z/255,H)}else M.setClearColor(0,
0,0,0);M.setDepthWriteEnabled(!0);M.setClearDepth(1);M.clear(M.gl.COLOR_BUFFER_BIT|M.gl.DEPTH_BUFFER_BIT);M.setDepthWriteEnabled(!1)}afterRenderPhases(D){({context:D}=D);D.bindFramebuffer(this._prevFBO);D.setStencilFunction(q.CompareFunction.EQUAL,1,255);D.setStencilTestEnabled(!0);D.setDepthTestEnabled(!1);this.blitTexture(D,this.getFbos().output.colorTexture,q.TextureSamplingMode.NEAREST)}beforeRenderLayer(D,G,J){const {context:M,blendMode:L,effects:Q,drawPhase:N,requireFBO:U}=D;if(U||C(N,L,Q,J)){D=
M.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(D);const {width:Z,height:H}=M.getViewport();D=this.acquireFbo(Z,H);M.bindFramebuffer(D);M.setColorMask(!0,!0,!0,!0);M.setClearColor(0,0,0,0);M.setDepthWriteEnabled(!0);M.setClearDepth(1);M.clear(M.gl.COLOR_BUFFER_BIT|M.gl.DEPTH_BUFFER_BIT);M.setDepthWriteEnabled(!1)}M.setDepthWriteEnabled(!1);M.setDepthTestEnabled(!1);M.setStencilTestEnabled(!0);M.setClearStencil(G);M.setStencilWriteMask(255);M.clear(M.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(D,
G){const {context:J,blendMode:M,effects:L,requireFBO:Q,drawPhase:N}=D;if(Q||C(N,M,L,G)){const U=J.getBoundFramebufferObject();null!=L&&0<L.length&&N===f.WGLDrawPhase.MAP&&this._applyEffects(D,L,U);J.bindFramebuffer(this._prevBeforeLayerFBOStack.pop());J.setStencilTestEnabled(!1);J.setStencilWriteMask(0);J.setBlendingEnabled(!0);J.setBlendFunctionSeparate(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA);J.setColorMask(!0,!0,!0,!0);this._blendEffect.draw(D,
U.colorTexture,q.TextureSamplingMode.NEAREST,null==M||N===f.WGLDrawPhase.HIGHLIGHT?"normal":M,G);this.releaseFbo(U)}}getBrush(D,G){D=F(D,G);G=this._brushCache.get(D);void 0===G&&(G=new D,this._brushCache.set(D,G));return G}renderObject(D,G,J,M){if(J=v.brushes[J]){var L=this._brushCache.get(J);void 0===L&&(L=new J,this._brushCache.set(J,L));L.prepareState(D,M);L.draw(D,G,M)}}renderObjects(D,G,J,M){if(J=v.brushes[J]){var L=this._brushCache.get(J);void 0===L&&(L=new J,this._brushCache.set(J,L));L.drawMany(D,
G,M)}}registerRenderPass(D){const G=D.brushes.map(J=>{this._brushCache.has(J)||this._brushCache.set(J,new J);return this._brushCache.get(J)});return new x(G,D)}blitTexture(D,G,J,M=1){D.setBlendingEnabled(!0);D.setBlendFunctionSeparate(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA);D.setColorMask(!0,!0,!0,!0);this._blitRenderer.render(D,G,J,M)}getPostProcessingEffects(D){return this._effectsManager.getPostProcessingEffects(D)}updateFBOs(D,G){if(D!==
this._lastWidth||G!==this._lastHeight)if(this._lastWidth=D,this._lastHeight=G,this._fbos)for(var J in this._fbos)this._fbos[J].resize(D,G);else J=new E.TextureDescriptor(D,G),J.samplingMode=q.TextureSamplingMode.NEAREST,J.wrapMode=q.TextureWrapMode.CLAMP_TO_EDGE,D=new y.RenderbufferDescriptor(q.RenderbufferFormat.DEPTH_STENCIL,D,G),this._stencilBuf=new B.Renderbuffer(this.context,D),this._fbos={output:new t.FramebufferObject(this.context,J,this._stencilBuf),effect0:new t.FramebufferObject(this.context,
J,this._stencilBuf)}}_applyEffects(D,G,J){const {context:M}=D;G=this._effectsManager.getPostProcessingEffects(G);for(const {postProcessingEffect:L,effect:Q}of G)M.bindFramebuffer(J),L.draw(D,J,Q)}}return A})},"esri/views/2d/engine/brushes":function(){define("exports ./webgl/brushes/BrushBitmap ./webgl/brushes/BrushClip ./webgl/brushes/BrushOverlay ./webgl/brushes/WGLBrushDotDensity ./webgl/brushes/WGLBrushHeatmap ./webgl/brushes/WGLBrushInfo ./webgl/brushes/WGLBrushPieChart ./webgl/brushes/WGLBrushStencil ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol ./webgl/brushes/WGLGeometryBrushFill ./webgl/brushes/WGLGeometryBrushLabel ./webgl/brushes/WGLGeometryBrushLine ./webgl/brushes/WGLGeometryBrushMarker ./webgl/brushes/WGLGeometryBrushText".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z){h.brushes={marker:x,line:w,fill:r,text:z,label:u,clip:v,stencil:b,bitmap:g,overlay:n,tileInfo:e,vtlBackground:c.WGLBrushVTLBackground,vtlFill:d.WGLBrushVTLFill,vtlLine:k.WGLBrushVTLLine,vtlCircle:m.WGLBrushVTLCircle,vtlSymbol:l.WGLBrushVTLSymbol,dotDensity:p,heatmap:f,pieChart:a};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define(["../definitions","../VertexStream","./WGLBrush",
"../../../../webgl/enums"],function(h,g,v,n){const p={nearest:{defines:[],samplingMode:n.TextureSamplingMode.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:n.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:n.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};class f extends v{constructor(){super(...arguments);this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",
0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e}){e.setBlendingEnabled(!0);e.setColorMask(!0,!0,!0,!0);e.setStencilWriteMask(0);e.setStencilTestEnabled(!0)}draw(e,a){const {context:b,renderingOptions:c,painter:m,requestRender:d,allowDelayedRender:k}=e;if(a.source&&a.isReady){if("dynamic"===c.samplingMode){({state:r}=e);var l=a.resolution/a.pixelRatio/r.resolution;const z=Math.round(e.pixelRatio)!==e.pixelRatio;var r=r.rotation||1.05<l||.95>l||z||a.isSourceScaled||a.rotation?
p.bilinear:p.nearest}else r=p[c.samplingMode];l=m.materialManager.getProgram(this._desc,r.defines);if(k&&null!=d&&!l.compiled)d();else{e.timeline.begin(this.name);"additive"===a.blendFunction?b.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE,n.BlendFactor.ONE,n.BlendFactor.ONE):b.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);b.setStencilFunction(n.CompareFunction.EQUAL,a.stencilRef,255);this._quad||(this._quad=
new g(b,[0,0,1,0,0,1,1,1]));var {coordScale:u,computedOpacity:w,transforms:x}=a;a.setSamplingProfile(r);a.bind(e.context,h.textureBindingBitmap);b.useProgram(l);l.setUniformMatrix3fv("u_dvsMat3",x.dvs);l.setUniform1i("u_texture",h.textureBindingBitmap);l.setUniform2fv("u_coordScale",u);l.setUniform1f("u_opacity",w);this._quad.draw();e.timeline.end(this.name)}}}}return f})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject",
"../../../webgl/VertexElementDescriptor"],function(h,g,v,n){class p{constructor(f,e){this._rctx=f;this._vertexBuffer=h.BufferObject.createVertex(f,g.Usage.STATIC_DRAW,new Uint16Array(e));this._vao=new v.VertexArrayObject(f,new Map([["a_position",0]]),{geometry:[new n.VertexElementDescriptor("a_position",2,g.DataType.SHORT,0,4)]},{geometry:this._vertexBuffer});this._count=e.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao);
this._rctx.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,this._count)}}return p})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(h){class g{constructor(v,n,p,f,e,a=!1,b=0){this.name=v;this.count=n;this.type=p;this.offset=f;this.stride=e;this.normalized=a;this.divisor=b}}h.VertexElementDescriptor=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class h{constructor(){this.name=
this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(g,v){}draw(g,v,n){}drawMany(g,v,n){for(const p of v)p.visible&&this.draw(g,p,n)}}return h})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("../../../../../chunks/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/enums ../../../../webgl/ProgramTemplate".split(" "),function(h,g,v,n,p,f){class e extends v{constructor(){super(...arguments);this._color=h.fromValues(0,1,0,1)}dispose(){this._program&&
this._program.dispose()}prepareState({context:a}){a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setFaceCullingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(p.StencilOperation.KEEP,p.StencilOperation.KEEP,p.StencilOperation.REPLACE);a.setStencilWriteMask(255);a.setStencilFunction(p.CompareFunction.ALWAYS,0,255)}draw(a,b){const {context:c,state:m,requestRender:d,allowDelayedRender:k}=a;a=g.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:p.DataType.SHORT}]});
b=b.getVAO(c,m,a.attributes,a.bufferLayouts);null!=b.indexBuffer&&(this._program||(this._program=f.createProgram(c,n.background)),k&&null!=d&&!this._program.compiled?d():(c.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",m.displayMat3),c.bindVAO(b),c.drawElements(p.PrimitiveType.TRIANGLES,b.indexBuffer.size,p.DataType.UNSIGNED_INT,0),c.bindVAO()))}}return e})},"esri/chunks/vec4f32":function(){define(["exports"],
function(h){function g(){return new Float32Array(4)}function v(z){const q=new Float32Array(4);q[0]=z[0];q[1]=z[1];q[2]=z[2];q[3]=z[3];return q}function n(z,q,t,B){const y=new Float32Array(4);y[0]=z;y[1]=q;y[2]=t;y[3]=B;return y}function p(z,q){return new Float32Array(z,q,4)}function f(){return g()}function e(){return n(1,1,1,1)}function a(){return n(1,0,0,0)}function b(){return n(0,1,0,0)}function c(){return n(0,0,1,0)}function m(){return n(0,0,0,1)}const d=g(),k=e(),l=a(),r=b(),u=c(),w=m(),x=Object.freeze(Object.defineProperty({__proto__:null,
ONES:k,UNIT_W:w,UNIT_X:l,UNIT_Y:r,UNIT_Z:u,ZEROS:d,clone:v,create:g,createView:p,fromValues:n,ones:e,unitW:m,unitX:a,unitY:b,unitZ:c,zeros:f},Symbol.toStringTag,{value:"Module"}));h.ONES=k;h.UNIT_W=w;h.UNIT_X=l;h.UNIT_Y=r;h.UNIT_Z=u;h.ZEROS=d;h.clone=v;h.create=g;h.createView=p;h.fromValues=n;h.ones=e;h.unitW=m;h.unitX=a;h.unitY=b;h.unitZ=c;h.vec4f32=x;h.zeros=f})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ./enums ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(h,g,v,n,p,f,e){function a(L){const Q={};for(const N of L)Q[N.name]=N.strideInBytes;return Q}function b(L){switch(L){case p.WGLGeometryType.MARKER:return B;case p.WGLGeometryType.FILL:return y;case p.WGLGeometryType.LINE:return E;case p.WGLGeometryType.TEXT:return F;case p.WGLGeometryType.LABEL:return C}}function c(L){switch(L%4){case 0:case 2:return 4;case 1:case 3:return 1}}function m(L){switch(L){case f.DataType.BYTE:case f.DataType.UNSIGNED_BYTE:return 1;case f.DataType.SHORT:case f.DataType.UNSIGNED_SHORT:return 2;
case f.DataType.FLOAT:case f.DataType.INT:case f.DataType.UNSIGNED_INT:return 4}}function d(L){const Q={};for(const N in L){let U=0;Q[N]=L[N].map(Z=>{const H=new e.VertexElementDescriptor(Z.name,Z.count,Z.type,U,0,Z.normalized||!1);U+=Z.count*m(Z.type);return H});Q[N]?.forEach(Z=>Z.stride=U)}return Q}const k=v.getLogger("esri.views.2d.engine.webgl.Utils"),l=a([{name:"geometry",strideInBytes:36}]),r=a([{name:"geometry",strideInBytes:12}]),u=a([{name:"geometry",strideInBytes:36}]),w=a([{name:"geometry",
strideInBytes:24}]),x=a([{name:"geometry",strideInBytes:12}]),z=a([{name:"geometry",strideInBytes:40}]),q=a([{name:"geometry",strideInBytes:36}]),t=a([{name:"geometry",strideInBytes:36}]),B=["geometry"],y=["geometry"],E=["geometry"],F=["geometry"],C=["geometry"];v={geometry:f.Usage.STATIC_DRAW};const A=new Map,D=L=>null!=L&&L.startsWith("data:image/gif"),G=L=>null!=L&&L.startsWith("data:image/png"),J=L=>{if(!L)return!1;L=L.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(L)&&/[\dz]$/i.test(L)&&
4<L.length?!0:!1},M=L=>"fill"===L.type&&"CIMMarkerPlacementInsidePolygon"===L?.cim?.markerPlacement?.type;h.allocateTypedArrayBuffer=function(L,Q){switch(Q%4){case 0:case 2:return new Uint32Array(Math.floor(L*Q/4));case 1:case 3:return new Uint8Array(L*Q)}};h.allocateTypedArrayBufferwithData=function(L,Q){switch(Q%4){case 0:case 2:return new Uint32Array(L);case 1:case 3:return new Uint8Array(L)}};h.cVboInfo=v;h.charCodes=function(L){const Q=[];for(let N=0;N<L.length;N++)Q.push(L.charCodeAt(N));return Q};
h.copyMeshData=function(L,Q,N,U,Z,H,O){for(const X in H){var T=H[X].stride,V=c(T);const I=H[X].data,K=N[X].data;if(null==I||null==K)continue;const P=T*Z.vertexCount/V,W=T*L/V;T=T*Z.vertexFrom/V;for(V=0;V<P;++V)K[V+W]=I[V+T]}if(null!=O&&null!=U)for(N=Z.indexCount,H=0;H<N;++H)U[H+Q]=O[H+Z.indexFrom]-Z.vertexFrom+L};h.createGeometryData=function(L,Q){const N=[];for(let U=0;5>U;++U){const Z=b(U),H={};for(const O of Z)H[O]={data:Q(U,O)};N.push({data:L(U),buffers:H})}return N};h.createProgramDescriptor=
(L,Q)=>{if(!A.has(L)){const Z=d(Q);var N=Z;var U={};for(const H in N){const O=N[H];U[H]=O?.length?O[0].stride:0}N=U;U=new Map;for(const H in Q)for(const O of Q[H])U.set(O.name,O.location);A.set(L,{strides:N,bufferLayouts:Z,attributes:U})}return A.get(L)};h.forEachGeometryType=function(L){L(p.WGLGeometryType.FILL);L(p.WGLGeometryType.LINE);L(p.WGLGeometryType.MARKER);L(p.WGLGeometryType.TEXT);L(p.WGLGeometryType.LABEL)};h.getBytes=m;h.getCapType=function(L){switch(L){case "butt":return n.CapType.BUTT;
case "round":return n.CapType.ROUND;case "square":return n.CapType.SQUARE;default:return k.error(new g("mapview-invalid-type",`Cap type ${L} is not a valid option. Defaulting to round`)),n.CapType.ROUND}};h.getJoinType=function(L){switch(L){case "miter":return n.JoinType.MITER;case "bevel":return n.JoinType.BEVEL;case "round":return n.JoinType.ROUND;default:return k.error(new g("mapview-invalid-type",`Join type ${L} is not a valid option. Defaulting to round`)),n.JoinType.ROUND}};h.getNamedBuffers=
b;h.getPMSResourceSize=function(L){const Q="width"in L&&L.width||"size"in L&&L.size||0;return"maxVVSize"in L&&L.maxVVSize||Q};h.getPixelArrayCtor=function(L){switch(L){case f.PixelType.UNSIGNED_BYTE:return Uint8Array;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case f.PixelType.FLOAT:return Float32Array;default:k.error(new g("webgl-utils",`Unable to handle type ${L}`))}};h.getPixelBytes=function(L){switch(L){case f.PixelType.UNSIGNED_BYTE:return 1;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;
case f.PixelType.FLOAT:return 4;default:k.error(new g("webgl-utils",`Unable to handle type ${L}`))}};h.getStrides=function(L,Q){switch(L){case p.WGLGeometryType.MARKER:switch(Q){case p.WGLSymbologyType.HEATMAP:return r;default:return l}case p.WGLGeometryType.FILL:switch(Q){case p.WGLSymbologyType.DOT_DENSITY:return x;case p.WGLSymbologyType.SIMPLE:case p.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return w;default:return u}case p.WGLGeometryType.LINE:return z;case p.WGLGeometryType.TEXT:return q;case p.WGLGeometryType.LABEL:return t}};
h.getUrl=L=>"imageData"in L&&L.imageData&&"contentType"in L&&L.contentType?`data:${L.contentType};base64,${L.imageData}`:"url"in L?L.url:null;h.getVVType=function(L){switch(L){case "opacity":return p.VVType.OPACITY;case "color":return p.VVType.COLOR;case "rotation":return p.VVType.ROTATION;case "size":return p.VVType.SIZE;default:return k.error(`Cannot interpret unknown vv: ${L}`),null}};h.is3D=L=>L.type&&L.type.toLowerCase().includes("3d");h.isDefined=function(L){return null!=L};h.isGIF=L=>"url"in
L&&L.url&&(L.url.includes(".gif")||D(L.url))||"contentType"in L&&"image/gif"===L.contentType||"imageData"in L&&D(L.imageData);h.isGIFDataUri=D;h.isImageResource=L=>!!("url"in L&&L.url)||!!("imageData"in L&&L.imageData);h.isMarkerPlacementInsidePolygon=M;h.isNumber=function(L){return"number"===typeof L};h.isPNG=L=>"url"in L&&L.url&&(L.url.includes(".png")||G(L.url))||"contentType"in L&&"image/png"===L.contentType||"imageData"in L&&G(L.imageData);h.isPNGDataUri=G;h.isSVGResource=L=>"path"in L&&J(L.path);
h.isSimple=function(L){switch(L.type){case "line":return"CIMSolidStroke"===L.cim.type&&!L.dashTemplate;case "fill":return"CIMSolidFill"===L.cim.type;case "esriSFS":return"esriSFSSolid"===L.style||"esriSFSNull"===L.style;case "esriSLS":return"esriSLSSolid"===L.style||"esriSLSNull"===L.style;default:return!1}};h.isValidSVG=J;h.shouldRepeat=function(L){switch("cim"in L?L.cim.type:L.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":return!1;case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":return M(L);
default:return!0}};h.strideToPackingFactor=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(h){h.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.ROUND=1]="ROUND";g[g.SQUARE=2]="SQUARE";g[g.UNKNOWN=4]="UNKNOWN"})(h.CapType||(h.CapType={}));h.JoinType=void 0;(function(g){g[g.BEVEL=0]="BEVEL";g[g.ROUND=1]="ROUND";g[g.MITER=2]="MITER";g[g.UNKNOWN=4]="UNKNOWN"})(h.JoinType||(h.JoinType={}));h.Alignment=void 0;(function(g){g[g.SCREEN=
0]="SCREEN";g[g.MAP=1]="MAP"})(h.Alignment||(h.Alignment={}));h.ExternalColorMixMode=void 0;(function(g){g[g.Tint=0]="Tint";g[g.Ignore=1]="Ignore";g[g.Multiply=99]="Multiply"})(h.ExternalColorMixMode||(h.ExternalColorMixMode={}));h.ExtremityPlacement=void 0;(function(g){g.Both="Both";g.JustBegin="JustBegin";g.JustEnd="JustEnd";g.None="None"})(h.ExtremityPlacement||(h.ExtremityPlacement={}));h.FillMode=void 0;(function(g){g[g.Mosaic=0]="Mosaic";g[g.Centered=1]="Centered"})(h.FillMode||(h.FillMode=
{}));h.FontEffects=void 0;(function(g){g[g.Normal=0]="Normal";g[g.Superscript=1]="Superscript";g[g.Subscript=2]="Subscript"})(h.FontEffects||(h.FontEffects={}));h.FontEncoding=void 0;(function(g){g[g.MSSymbol=0]="MSSymbol";g[g.Unicode=1]="Unicode"})(h.FontEncoding||(h.FontEncoding={}));h.FontType=void 0;(function(g){g[g.Unspecified=0]="Unspecified";g[g.TrueType=1]="TrueType";g[g.PSOpenType=2]="PSOpenType";g[g.TTOpenType=3]="TTOpenType";g[g.Type1=4]="Type1"})(h.FontType||(h.FontType={}));h.AngleAlignment=
void 0;(function(g){g[g.Display=0]="Display";g[g.Map=1]="Map"})(h.AngleAlignment||(h.AngleAlignment={}));h.AnimatedSymbolRepeatType=void 0;(function(g){g.None="None";g.Loop="Loop";g.Oscillate="Oscillate"})(h.AnimatedSymbolRepeatType||(h.AnimatedSymbolRepeatType={}));h.DominantSizeAxis=void 0;(function(g){g[g.Z=0]="Z";g[g.X=1]="X";g[g.Y=2]="Y"})(h.DominantSizeAxis||(h.DominantSizeAxis={}));h.RotationOrder=void 0;(function(g){g[g.XYZ=0]="XYZ";g[g.ZXY=1]="ZXY";g[g.YXZ=2]="YXZ"})(h.RotationOrder||(h.RotationOrder=
{}));h.BalloonCalloutStyle=void 0;(function(g){g[g.Rectangle=0]="Rectangle";g[g.RoundedRectangle=1]="RoundedRectangle";g[g.Oval=2]="Oval"})(h.BalloonCalloutStyle||(h.BalloonCalloutStyle={}));h.BlendingMode=void 0;(function(g){g[g.None=0]="None";g[g.Alpha=1]="Alpha";g[g.Screen=2]="Screen";g[g.Multiply=3]="Multiply";g[g.Add=4]="Add"})(h.BlendingMode||(h.BlendingMode={}));h.BlockProgression=void 0;(function(g){g[g.TTB=0]="TTB";g[g.RTL=1]="RTL";g[g.BTT=2]="BTT"})(h.BlockProgression||(h.BlockProgression=
{}));h.BillBoardMode=void 0;(function(g){g[g.None=0]="None";g[g.SignPost=1]="SignPost";g[g.FaceNearPlane=2]="FaceNearPlane"})(h.BillBoardMode||(h.BillBoardMode={}));h.CGAAttributeType=void 0;(function(g){g[g.Float=0]="Float";g[g.String=1]="String";g[g.Boolean=2]="Boolean"})(h.CGAAttributeType||(h.CGAAttributeType={}));h.ClippingType=void 0;(function(g){g[g.Intersect=0]="Intersect";g[g.Subtract=1]="Subtract"})(h.ClippingType||(h.ClippingType={}));h.GeometricEffectArrowType=void 0;(function(g){g.OpenEnded=
"OpenEnded";g.Block="Block";g.Crossed="Crossed"})(h.GeometricEffectArrowType||(h.GeometricEffectArrowType={}));h.GeometricEffectControlMeasureLineRule=void 0;(function(g){g.FullGeometry="FullGeometry";g.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";g.ReversedFirstSegment="ReversedFirstSegment";g.PerpendicularToSecondSegment="PerpendicularToSecondSegment";g.SecondSegmentWithTicks="SecondSegmentWithTicks";g.DoublePerpendicular="DoublePerpendicular";g.OppositeToFirstSegment="OppositeToFirstSegment";
g.TriplePerpendicular="TriplePerpendicular";g.HalfCircleFirstSegment="HalfCircleFirstSegment";g.HalfCircleSecondSegment="HalfCircleSecondSegment";g.HalfCircleExtended="HalfCircleExtended";g.OpenCircle="OpenCircle";g.CoverageEdgesWithTicks="CoverageEdgesWithTicks";g.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";g.GapExtentMidline="GapExtentMidline";g.Chevron="Chevron";g.PerpendicularWithArc="PerpendicularWithArc";g.ClosedHalfCircle="ClosedHalfCircle";g.TripleParallelExtended="TripleParallelExtended";
g.ParallelWithTicks="ParallelWithTicks";g.Parallel="Parallel";g.PerpendicularToFirstSegment="PerpendicularToFirstSegment";g.ParallelOffset="ParallelOffset";g.OffsetOpposite="OffsetOpposite";g.OffsetSame="OffsetSame";g.CircleWithArc="CircleWithArc";g.DoubleJog="DoubleJog";g.PerpendicularOffset="PerpendicularOffset";g.LineExcludingLastSegment="LineExcludingLastSegment";g.MultivertexArrow="MultivertexArrow";g.CrossedArrow="CrossedArrow";g.ChevronArrow="ChevronArrow";g.ChevronArrowOffset="ChevronArrowOffset";
g.PartialFirstSegment="PartialFirstSegment";g.Arch="Arch";g.CurvedParallelTicks="CurvedParallelTicks";g.Arc90Degrees="Arc90Degrees"})(h.GeometricEffectControlMeasureLineRule||(h.GeometricEffectControlMeasureLineRule={}));h.GeometricEffectDonutMethod=void 0;(function(g){g.Mitered="Mitered";g.Bevelled="Bevelled";g.Rounded="Rounded";g.Square="Square";g.TrueBuffer="TrueBuffer"})(h.GeometricEffectDonutMethod||(h.GeometricEffectDonutMethod={}));h.GeometricEffectEnclosingPolygonMethod=void 0;(function(g){g.ClosePath=
"ClosePath";g.ConvexHull="ConvexHull";g.RectangularBox="RectangularBox"})(h.GeometricEffectEnclosingPolygonMethod||(h.GeometricEffectEnclosingPolygonMethod={}));h.GeometricEffectExtensionOrigin=void 0;(function(g){g.BeginningOfLine="BeginningOfLine";g.EndOfLine="EndOfLine"})(h.GeometricEffectExtensionOrigin||(h.GeometricEffectExtensionOrigin={}));h.GeometricEffectOffsetMethod=void 0;(function(g){g.Mitered="Mitered";g.Bevelled="Bevelled";g.Rounded="Rounded";g.Square="Square"})(h.GeometricEffectOffsetMethod||
(h.GeometricEffectOffsetMethod={}));h.GeometricEffectOffsetOption=void 0;(function(g){g.Fast="Fast";g.Accurate="Accurate"})(h.GeometricEffectOffsetOption||(h.GeometricEffectOffsetOption={}));h.GeometricEffectOffsetTangentMethod=void 0;(function(g){g.BeginningOfLine="BeginningOfLine";g.EndOfLine="EndOfLine"})(h.GeometricEffectOffsetTangentMethod||(h.GeometricEffectOffsetTangentMethod={}));h.GeometricEffectWaveform=void 0;(function(g){g.Sinus="Sinus";g.Square="Square";g.Triangle="Triangle";g.Random=
"Random"})(h.GeometricEffectWaveform||(h.GeometricEffectWaveform={}));h.GlyphHinting=void 0;(function(g){g[g.None=0]="None";g[g.Default=1]="Default";g[g.Force=2]="Force"})(h.GlyphHinting||(h.GlyphHinting={}));h.GradientAlignment=void 0;(function(g){g[g.Buffered=0]="Buffered";g[g.Left=1]="Left";g[g.Right=2]="Right";g[g.AlongLine=3]="AlongLine"})(h.GradientAlignment||(h.GradientAlignment={}));h.GradientFillMethod=void 0;(function(g){g[g.Linear=0]="Linear";g[g.Rectangular=1]="Rectangular";g[g.Circular=
2]="Circular";g[g.Buffered=3]="Buffered"})(h.GradientFillMethod||(h.GradientFillMethod={}));h.GradientStrokeType=void 0;(function(g){g[g.Discrete=0]="Discrete";g[g.Continuous=1]="Continuous"})(h.GradientStrokeType||(h.GradientStrokeType={}));h.GradientStrokeMethod=void 0;(function(g){g[g.AcrossLine=0]="AcrossLine";g[g.AloneLine=1]="AloneLine"})(h.GradientStrokeMethod||(h.GradientStrokeMethod={}));h.HorizontalAlignment=void 0;(function(g){g[g.Left=0]="Left";g[g.Right=1]="Right";g[g.Center=2]="Center";
g[g.Justify=3]="Justify"})(h.HorizontalAlignment||(h.HorizontalAlignment={}));h.LeaderLineStyle=void 0;(function(g){g[g.Base=0]="Base";g[g.MidPoint=1]="MidPoint";g[g.ThreePoint=2]="ThreePoint";g[g.FourPoint=3]="FourPoint";g[g.Underline=4]="Underline";g[g.CircularCW=5]="CircularCW";g[g.CircularCCW=6]="CircularCCW"})(h.LeaderLineStyle||(h.LeaderLineStyle={}));h.LineCapStyle=void 0;(function(g){g.Butt="Butt";g.Round="Round";g.Square="Square"})(h.LineCapStyle||(h.LineCapStyle={}));h.LineDashEnding=void 0;
(function(g){g.NoConstraint="NoConstraint";g.HalfPattern="HalfPattern";g.HalfGap="HalfGap";g.FullPattern="FullPattern";g.FullGap="FullGap";g.Custom="Custom"})(h.LineDashEnding||(h.LineDashEnding={}));h.LineDecorationStyle=void 0;(function(g){g[g.None=-1]="None";g[g.Custom=0]="Custom";g[g.Circle=1]="Circle";g[g.OpenArrow=2]="OpenArrow";g[g.ClosedArrow=3]="ClosedArrow";g[g.Diamond=4]="Diamond"})(h.LineDecorationStyle||(h.LineDecorationStyle={}));h.LineGapType=void 0;(function(g){g[g.ExtraLeading=0]=
"ExtraLeading";g[g.Multiple=1]="Multiple";g[g.Exact=2]="Exact"})(h.LineGapType||(h.LineGapType={}));h.LineJoinStyle=void 0;(function(g){g.Bevel="Bevel";g.Round="Round";g.Miter="Miter"})(h.LineJoinStyle||(h.LineJoinStyle={}));h.ExpressionReturnType=void 0;(function(g){g[g.Default=0]="Default";g[g.String=1]="String";g[g.Numeric=2]="Numeric"})(h.ExpressionReturnType||(h.ExpressionReturnType={}));h.MarkerPlacementType=void 0;(function(g){g[g.InsidePolygon=0]="InsidePolygon";g[g.PolygonCenter=1]="PolygonCenter";
g[g.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(h.MarkerPlacementType||(h.MarkerPlacementType={}));h.MaterialMode=void 0;(function(g){g[g.Tint=0]="Tint";g[g.Replace=1]="Replace";g[g.Multiply=2]="Multiply"})(h.MaterialMode||(h.MaterialMode={}));h.PlacementClip=void 0;(function(g){g[g.ClipAtBoundary=0]="ClipAtBoundary";g[g.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";g[g.DoNotTouchBoundary=2]="DoNotTouchBoundary";g[g.DoNotClip=3]="DoNotClip"})(h.PlacementClip||(h.PlacementClip=
{}));h.PlacementEndings=void 0;(function(g){g.NoConstraint="NoConstraint";g.WithMarkers="WithMarkers";g.WithFullGap="WithFullGap";g.WithHalfGap="WithHalfGap";g.Custom="Custom"})(h.PlacementEndings||(h.PlacementEndings={}));h.PlacementGridType=void 0;(function(g){g.Fixed="Fixed";g.Random="Random";g.RandomFixedQuantity="RandomFixedQuantity"})(h.PlacementGridType||(h.PlacementGridType={}));h.PlacementOnLineRelativeTo=void 0;(function(g){g.LineMiddle="LineMiddle";g.LineBeginning="LineBeginning";g.LineEnd=
"LineEnd";g.SegmentMidpoint="SegmentMidpoint"})(h.PlacementOnLineRelativeTo||(h.PlacementOnLineRelativeTo={}));h.PlacementPolygonCenterMethod=void 0;(function(g){g.OnPolygon="OnPolygon";g.CenterOfMass="CenterOfMass";g.BoundingBoxCenter="BoundingBoxCenter"})(h.PlacementPolygonCenterMethod||(h.PlacementPolygonCenterMethod={}));h.PlacementRandomlyAlongLineRandomization=void 0;(function(g){g[g.Low=0]="Low";g[g.Medium=1]="Medium";g[g.High=2]="High"})(h.PlacementRandomlyAlongLineRandomization||(h.PlacementRandomlyAlongLineRandomization=
{}));h.PlacementStepPosition=void 0;(function(g){g[g.MarkerCenter=0]="MarkerCenter";g[g.MarkerBounds=1]="MarkerBounds"})(h.PlacementStepPosition||(h.PlacementStepPosition={}));h.PointSymbolCalloutScale=void 0;(function(g){g[g.None=0]="None";g[g.PropUniform=1]="PropUniform";g[g.PropNonuniform=2]="PropNonuniform";g[g.DifUniform=3]="DifUniform";g[g.DifNonuniform=4]="DifNonuniform"})(h.PointSymbolCalloutScale||(h.PointSymbolCalloutScale={}));h.Simple3DLineStyle=void 0;(function(g){g.Tube="Tube";g.Strip=
"Strip";g.Wall="Wall"})(h.Simple3DLineStyle||(h.Simple3DLineStyle={}));h.SizeVariationMethod=void 0;(function(g){g[g.Random=0]="Random";g[g.Increasing=1]="Increasing";g[g.Decreasing=2]="Decreasing";g[g.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(h.SizeVariationMethod||(h.SizeVariationMethod={}));h.SymbolUnits=void 0;(function(g){g[g.Relative=0]="Relative";g[g.Absolute=1]="Absolute"})(h.SymbolUnits||(h.SymbolUnits={}));h.TextCase=void 0;(function(g){g[g.Normal=0]="Normal";g[g.LowerCase=
1]="LowerCase";g[g.Allcaps=2]="Allcaps"})(h.TextCase||(h.TextCase={}));h.TextReadingDirection=void 0;(function(g){g[g.LTR=0]="LTR";g[g.RTL=1]="RTL"})(h.TextReadingDirection||(h.TextReadingDirection={}));h.TextureFilter=void 0;(function(g){g.Draft="Draft";g.Picture="Picture";g.Text="Text"})(h.TextureFilter||(h.TextureFilter={}));h.VerticalAlignment=void 0;(function(g){g[g.Top=0]="Top";g[g.Center=1]="Center";g[g.Baseline=2]="Baseline";g[g.Bottom=3]="Bottom"})(h.VerticalAlignment||(h.VerticalAlignment=
{}));h.VerticalGlyphOrientation=void 0;(function(g){g[g.Right=0]="Right";g[g.Upright=1]="Upright"})(h.VerticalGlyphOrientation||(h.VerticalGlyphOrientation={}));h.WaterbodySize=void 0;(function(g){g[g.Small=0]="Small";g[g.Medium=1]="Medium";g[g.Large=2]="Large"})(h.WaterbodySize||(h.WaterbodySize={}));h.WaveStrength=void 0;(function(g){g[g.Calm=0]="Calm";g[g.Rippled=1]="Rippled";g[g.Slight=2]="Slight";g[g.Moderate=3]="Moderate"})(h.WaveStrength||(h.WaveStrength={}));Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(h,g){g={shaders:{vertexShader:g.resolveIncludes("background/background.vert"),fragmentShader:g.resolveIncludes("background/background.frag")},attributes:new Map([["a_pos",0]])};h.background=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],
function(h,g,v){const n=new v.ShaderCompiler(function(p){let f=g;p.split("/").forEach(e=>{f&&(f=f[e])});return f});h.resolveIncludes=function(p){return n.resolveIncludes(p)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},
bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color \x3d texture2D(u_tex, v_uv);\ngl_FragColor \x3d color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_pos , 0.0, 1.0);\nv_uv \x3d a_tex;\n}"},blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\nuniform lowp float u_inFadeOpacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\nfloat vIn \x3d rgb2v(Cb);\nvec3 hsvTint \x3d rgb2hsv(Cs);\nvec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\nreturn hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 0.0) ? 0.0 : (Cs \x3d\x3d 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 1.0) ? 1.0 : (Cs \x3d\x3d 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\nreturn (Cs \x3d\x3d 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\nif (Cs \x3c\x3d 0.5) {\nreturn Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n}\nif (Cb \x3c\x3d 0.25) {\nreturn Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n}\nreturn Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\nreturn min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\nreturn max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\nreturn dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\nreturn maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\nfloat lum \x3d lumv3(color);\nfloat mincol \x3d minv3(color);\nfloat maxcol \x3d maxv3(color);\nif (mincol \x3c 0.0) {\ncolor \x3d lum + ((color - lum) * lum) / (lum - mincol);\n}\nif (maxcol \x3e 1.0) {\ncolor \x3d lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n}\nreturn color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\nfloat lbase \x3d lumv3(cbase);\nfloat llum \x3d lumv3(clum);\nfloat ldiff \x3d llum - lbase;\nvec3 color \x3d cbase + vec3(ldiff);\nreturn clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\nfloat minbase \x3d minv3(cbase);\nfloat sbase \x3d satv3(cbase);\nfloat ssat \x3d satv3(csat);\nvec3 color;\nif (sbase \x3e 0.0) {\ncolor \x3d (cbase - minbase) * ssat / sbase;\n} else {\ncolor \x3d vec3(0.0);\n}\nreturn setLum(color, clum);\n}\nvoid main() {\nvec4 src \x3d texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\ngl_FragColor \x3d src *  u_opacity;\n#else\nvec4 dst \x3d texture2D(u_backbufferTexture, v_uv);\nvec3 Cs \x3d src.a \x3d\x3d 0.0 ? src.rgb : vec3(src.rgb / src.a);\nvec3 Cb \x3d dst.a \x3d\x3d 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\nfloat as \x3d u_opacity * src.a;\nfloat ab \x3d dst.a;\n#ifdef DESTINATION_OVER\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n#endif\n#ifdef SOURCE_IN\nvec4 color \x3d vec4(as * Cs * ab, as * ab);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef DESTINATION_IN\nvec4 color \x3d vec4(ab * Cb * as, ab * as);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef SOURCE_OUT\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n#endif\n#ifdef DESTINATION_OUT\ngl_FragColor \x3d vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n#endif\n#ifdef SOURCE_ATOP\ngl_FragColor \x3d vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n#endif\n#ifdef DESTINATION_ATOP\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n#endif\n#ifdef XOR\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\nas * (1.0 - ab) + ab * (1.0 - as));\n#endif\n#ifdef MULTIPLY\ngl_FragColor \x3d vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\nas + ab * (1.0 - as));\n#endif\n#ifdef SCREEN\ngl_FragColor \x3d vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef OVERLAY\nvec3 f \x3d vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DARKEN\ngl_FragColor \x3d vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LIGHTER\ngl_FragColor \x3d vec4(as * Cs + ab * Cb, as + ab);\n#endif\n#ifdef LIGHTEN\ngl_FragColor \x3d vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_DODGE\nvec3 f \x3d clamp(vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_BURN\nvec3 f \x3d vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HARD_LIGHT\nvec3 f \x3d vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SOFT_LIGHT\nvec3 f \x3d vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DIFFERENCE\ngl_FragColor \x3d vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef EXCLUSION\nvec3 f \x3d Cs + Cb - 2.0 * Cs * Cb;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef INVERT\ngl_FragColor \x3d vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n#endif\n#ifdef VIVID_LIGHT\nvec3 f \x3d vec3(clamp(vividLight(Cb.r, Cs.r), 0.0, 1.0),\nclamp(vividLight(Cb.g, Cs.g), 0.0, 1.0),\nclamp(vividLight(Cb.b, Cs.b), 0.0, 1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HUE\nvec3 f \x3d setLumSat(Cs,Cb,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SATURATION\nvec3 f \x3d setLumSat(Cb,Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR\nvec3 f \x3d setLum(Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LUMINOSITY\nvec3 f \x3d setLum(Cb,Cs);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef PLUS\ngl_FragColor \x3d clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n#endif\n#ifdef MINUS\ngl_FragColor \x3d vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n#endif\n#ifdef AVERAGE\nvec3 f \x3d (Cb + Cs) / 2.0;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef REFLECT\nvec3 f \x3d clamp(vec3(reflectBlend(Cb.r, Cs.r),\nreflectBlend(Cb.g, Cs.g),\nreflectBlend(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#endif\n}",
"blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_position , 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor \x3d v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position \x3d a_PositionAndFlags.xy;\nfloat flags \x3d a_PositionAndFlags.z;\nint colorIndex \x3d int(mod(flags, 4.0));\nvec4 color;\nfor (int i \x3d 0; i \x3c 4; i++) {\ncolor \x3d u_colors[i];\nif (i \x3d\x3d colorIndex) {\nbreak;\n}\n}\nint opacityIndex \x3d int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i \x3d 0; i \x3c 4; i++) {\nopacity \x3d u_opacities[i];\nif (i \x3d\x3d opacityIndex) {\nbreak;\n}\n}\nv_color \x3d color * opacity;\ngl_Position \x3d vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},
dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist \x3d length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha \x3d smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor \x3d v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON \x3d 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture \x3d mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords \x3d tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color \x3d texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth \x3d max(u_dotSize / 2., 1.) ;\nfloat z \x3d 0.;\nz +\x3d 2.0 * step(v_color.a, EPSILON);\ngl_PointSize \x3d (smoothEdgeWidth + u_dotSize);\ngl_Position \x3d vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio \x3d u_dotSize / gl_PointSize;\nv_invEdgeRatio \x3d -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *\x3d (u_pixelRatio * u_tileZoomFactor);\n}"}},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b \x3d 1.0 / 6.0;\nfloat v2 \x3d v * v;\nfloat v3 \x3d v2 * v;\nfloat w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 \x3d b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w \x3d computeWeights(v);\nfloat g0 \x3d w.x + w.y;\nfloat g1 \x3d w.z + w.w;\nfloat h0 \x3d 1.0 - (w.y / g0) + v;\nfloat h1 \x3d 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\nvec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\nvec2 texel \x3d coords * texSize - 0.5;\nvec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 \x3d coords + hgX.x * eX;\nvec2 coords00 \x3d coords - hgX.y * eX;\nvec2 coords11 \x3d coords10 + hgY.x * eY;\nvec2 coords01 \x3d coords00 + hgY.x * eY;\ncoords10 \x3d coords10 - hgY.y * eY;\ncoords00 \x3d coords00 - hgY.y * eY;\nvec4 color00 \x3d texture2D(sampler, coords00);\nvec4 color10 \x3d texture2D(sampler, coords10);\nvec4 color01 \x3d texture2D(sampler, coords01);\nvec4 color11 \x3d texture2D(sampler, coords11);\ncolor00 \x3d mix(color00, color01, hgY.z);\ncolor10 \x3d mix(color10, color11, hgY.z);\ncolor00 \x3d mix(color00, color10, hgX.z);\nreturn color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart \x3d floor(coords * texSize);\nvec2 coord0 \x3d texelStart / texSize;\nvec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 \x3d texture2D(sampler, coord0);\nvec4 color1 \x3d texture2D(sampler, coord1);\nvec4 color2 \x3d texture2D(sampler, coord2);\nvec4 color3 \x3d texture2D(sampler, coord3);\nvec2 blend \x3d fract(coords * texSize);\nvec4 color01 \x3d mix(color0, color1, blend.x);\nvec4 color23 \x3d mix(color2, color3, blend.x);\nvec4 color \x3d mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha \x3d floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor \x3d color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize \x3d 1.0 / texSize;\nvec2 texel \x3d coords * texSize;\nvec2 texel_i \x3d floor(texel);\nvec2 texel_frac \x3d fract(texel);\nvec4 colorP \x3d texture2D(sampler, texel_i * invSize);\nvec4 colorP1 \x3d vec4(colorP);\nvec4 colorP2 \x3d vec4(colorP);\nvec4 colorP3 \x3d vec4(colorP);\nvec4 colorP4 \x3d vec4(colorP);\nvec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\ncolorP1 \x3d colorA;\n}\nif (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\ncolorP2 \x3d colorB;\n}\nif (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\ncolorP3 \x3d colorC;\n}\nif (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\ncolorP4 \x3d colorD;\n}\nvec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\nvec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\nfloat flags \x3d data0.r * 255.0;\nfloat groupMinZoom \x3d data0.g * 255.0;\nfloat isVisible \x3d getFilterBit(flags, 0);\nfloat wouldClip \x3d step(groupMinZoom, u_zoomLevel);\nfloat direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\nfloat dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\nvec4 nextState \x3d vec4(texel + direction * dt);\ngl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\ngl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data \x3d texture2D(u_texture, v_uv);\nfloat density \x3d data.r * COMPRESSION_FACTOR;\ndensity *\x3d u_densityNormalization;\ndensity \x3d (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color \x3d texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}",
"heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w \x3d gauss1(i * u_direction.xy);\ntot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight +\x3d w;\n}\nvoid main(void) {\nmediump float tot \x3d 0.0;\nmediump float weight \x3d 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y \x3d texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 \x3d 0.5;\nmediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d \x3d (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d \x3d estimateDistance();\ngl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlayTexture;\nuniform bool u_maskEnabled;\nuniform bool u_overlayEnabled;\nvarying mediump vec2 v_texCoord;\nconst lowp float barrelFactor \x3d 1.1;\nlowp vec2 barrel(lowp vec2 uv) {\nlowp vec2 uvn \x3d uv * 2.0 - 1.0;\nif (uvn.x \x3d\x3d 0.0 \x26\x26 uvn.y \x3d\x3d 0.0) {\nreturn vec2(0.5, 0.5);\n}\nlowp float theta \x3d atan(uvn.y, uvn.x);\nlowp float r \x3d pow(length(uvn), barrelFactor);\nreturn r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;\n}\nvoid main(void)\n{\nlowp vec4 color \x3d texture2D(u_readbackTexture, barrel(v_texCoord));\ncolor \x3d (color + (1.0 - color.a) * u_background);\nlowp float mask \x3d u_maskEnabled ? texture2D(u_maskTexture, v_texCoord).a : 1.0;\ncolor *\x3d mask;\nlowp vec4 overlayColor \x3d u_overlayEnabled ? texture2D(u_overlayTexture, v_texCoord) : vec4(0);\ngl_FragColor \x3d overlayColor + (1.0 - overlayColor.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec4 u_drawPos;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\nv_texCoord \x3d a_pos;\ngl_Position \x3d vec4(u_drawPos.xy + vec2(a_pos - 0.5) * u_drawPos.zw, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp sampler2D u_attributeData4;\nuniform highp sampler2D u_attributeData5;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel \x3d unpackDisplayIdTexel(id);\nhighp float size \x3d float(u_attributeTextureSize);\nhighp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col \x3d mod(u32, size);\nhighp float row \x3d (u32 - col) / size;\nhighp float u \x3d col / size;\nhighp float v \x3d row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(u_attributeTextureSize));\n}\nhighp vec4 getAttributeData0(in highp vec3 id) {\nvec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData3, coords);\n}\nhighp vec4 getAttributeData4(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData4, coords);\n}\nhighp vec4 getAttributeData5(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData5, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}",
"barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary \x3d abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 \x3d mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 \x3d v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG \x3d 180.0 / 3.141592654;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION \x3d 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.00001;\nconst float EPSILON_HITTEST \x3d 0.05;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR \x3d 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY \x3d 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP \x3d 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE \x3d 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY \x3d 3;\nconst int BITSET_TYPE_FILL_OUTLINE \x3d 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET \x3d 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR \x3d 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR \x3d 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR \x3d 6;\nconst int BITSET_LINE_SCALE_DASH \x3d 2;",
fill:{"common.glsl":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\nlowp vec4 drawLine() {\nfloat v_lineWidth \x3d v_aux1.x;\nvec2  v_normal    \x3d v_aux1.yz;\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color \x3d vec4(0.);\n#ifdef HITTEST\nout_color \x3d v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr \x3d v_aux1;\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\nout_color \x3d v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY \x26\x26 !defined(HIGHLIGHT)\nvec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 \x3d step(0.0, difference0);\nvec4 isPositive1 \x3d step(0.0, difference1);\nfloat weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero \x3d step(weightSum, 0.0);\nfloat greaterThanZero \x3d 1.0 - lessThanEqZero ;\nfloat divisor \x3d (weightSum + lessThanEqZero);\nvec4 weights0 \x3d difference0 * isPositive0 / divisor;\nvec4 weights1 \x3d difference1 * isPositive1 / divisor;\nvec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax \x3d max(max4(difference0), max4(difference1));\nfloat lessThanZero \x3d step(diffMax, 0.0);\nfloat greaterOrEqZero \x3d 1.0 - lessThanZero;\nvec4 isMax0 \x3d step(diffMax, difference0);\nvec4 isMax1 \x3d step(diffMax, difference1);\nvec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color \x3d preEffectColor;\n#else\nout_color \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a \x3d 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline \x3e 0.5) {\ngl_FragColor \x3d drawLine();\n} else {\ngl_FragColor \x3d drawFill();\n}\n#else\ngl_FragColor \x3d drawFill();\n#endif\n}",
"fill.vert":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#include \x3cmaterials/fill/hittest.glsl\x3e\nconst float INV_SCALE_COMPRESSION_FACTOR \x3d 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT \x3d 16777216.0;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs \x3d buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      \x3d outputs.id;\nv_opacity \x3d outputs.opacity;\nv_aux1    \x3d vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color \x3d outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet \x3d a_bitset;\nout_color \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized \x3d mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   \x3d tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   \x3d u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   \x3d a_aux1;\nfloat a_width  \x3d a_aux2.x;\nfloat a_height \x3d a_aux2.y;\nvec2  a_offset \x3d a_aux2.zw;\nvec2  a_scale  \x3d a_aux3.xy;\nfloat a_angle  \x3d a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) \x3e 0.5) {\na_width *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) \x3e 0.5) {\na_height *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale \x3d INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width \x3d u_zoomFactor * a_width * scale.x;\nfloat height \x3d u_zoomFactor * a_height * scale.y;\nfloat angle \x3d C_256_TO_RAD * a_angle;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nfloat dx \x3d 0.0;\nfloat dy \x3d 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) \x3e 0.5) {\nfloat id \x3d rgba2float(vec4(a_id, 0.0));\ndx \x3d rand(vec2(id, 0.0));\ndy \x3d rand(vec2(0.0, id));\n}\nmat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize \x3d vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt \x3d vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection \x3d patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset \x3d u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset \x3d vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset \x3d mod(tileOffset, patternSize);\nvec2 symbolOffset \x3d u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 \x3d a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly \x3d getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) \x3e 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *\x3d (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly \x3d 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords \x3d (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) \x3e 0.5) {\nout_pos \x3d vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize \x3d 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline \x3d getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline \x3e 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  \x3d vec3(0.);\nhighp vec4 color  \x3d vec4(0.);\ndraw(color, pos);\nv_color \x3d color;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}",
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist \x3d u_hittestDist;\nfloat dist \x3d distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3c 0. || dist \x3e\x3d hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3d\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif"},
hittest:{"common.glsl":"#ifdef HITTEST\nuniform float u_hittestDist;\nuniform highp vec2 u_hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L \x3d p2 - p1;\nvec2 A \x3d p0 - p1;\nfloat projAL \x3d projectScalar(A, L);\nfloat t \x3d clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist \x3d distance(pos, vec3(u_hittestPos, 1.));\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) \x3e u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, (dist - size) \x3c 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba \x3d b - a;\nvec2 ca \x3d c - a;\nfloat crossProduct \x3d ba.x * ca.y - ca.x * ba.y;\nbool isParallel \x3d crossProduct \x3c EPSILON_HITTEST \x26\x26 crossProduct \x3e -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) \x3d\x3d 1.) {\nreturn 0.;\n}\nfloat distAB \x3d distPointSegment(p, a, b);\nfloat distBC \x3d distPointSegment(p, b, c);\nfloat distCA \x3d distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},
icon:{"common.glsl":"#include \x3cutil/encoding.glsl\x3e\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor \x3d vec4(1.0);\n#else\nlowp vec4 fillPixelColor \x3d v_color;\n#endif\nfloat d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth \x3d v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize \x3d min(outlineWidth, size);\noutlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",
heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor \x3d v_hittestResult;\n#else\nfloat radius \x3d length(v_offsetFromCenter);\nfloat shapeWeight \x3d step(radius, 1.0);\nfloat oneMinusRadiusSquared \x3d 1.0 - radius * radius;\nfloat kernelWeight \x3d oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor \x3d vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}",
"heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color \x3d vec4(0.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\nvoid main() {\nfloat filterFlags \x3d getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult \x3d vec4(0.);\nhighp vec3 out_pos \x3d vec3(0.);\nvec3 pos \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult \x3d out_hittestResult;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter \x3d sign(a_vertexOffset);\nv_fieldValue \x3d getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos \x3d centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position \x3d vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase \x3d u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 \x3d scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 \x3d scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 \x3d xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 \x3d xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 \x3d xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 \x3d a_texCoords  / u_mosaicSize;\nvec2 tex1 \x3d a_texCoords1 / u_mosaicSize;\nvec2 tex2 \x3d a_texCoords2 / u_mosaicSize;\nfloat alphaSum \x3d 0.;\nalphaSum +\x3d inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z +\x3d step(alphaSum, .05) * 2.0;\nout_color \x3d vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif",
"icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvoid main()\n{\n#ifdef HITTEST\nvec4 color \x3d v_color;\n#else\nvec4 color \x3d getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/icon/hittest.glsl\x3e\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f \x3d getSize(size.y) / size.y;\nfloat sizeFactor \x3d size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec3  pos           \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        \x3d vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize \x3d a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally \x3d getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               \x3d getMarkerScaleFactor(size, referenceSize);\nsize.xy     *\x3d scaleFactor;\noffset.xy   *\x3d scaleFactor;\noutlineSize *\x3d scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   \x3d a_texCoords / u_mosaicSize;\nfloat filterFlags \x3d getFilterFlags();\nv_color    \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  \x3d getOpacity();\nv_id       \x3d norm(a_id);\nv_pos      \x3d u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  \x3d vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   \x3d getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor \x3d v_isThin;\n#else\nv_overridingOutlineColor \x3d 0.0;\n#endif\nv_outlineWidth \x3d min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor \x3d a_outlineColor;\nv_distRatio \x3d a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color \x3d vec4(0.);\nhighp vec3 out_pos   \x3d vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color \x3d out_color;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle \x3d angle * 360.0 / 254.0;\nfloat mapAngle \x3d u_mapRotation * 360.0 / 254.0;\nfloat diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z \x3d 0.0;\nz +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\nz +\x3d 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    \x3d getMinZoom();\nfloat glyphMinZoom    \x3d a_glyphData.x;\nfloat glyphMaxZoom    \x3d a_glyphData.y;\nfloat glyphAngle      \x3d a_glyphData.z;\nfloat a_isBackground  \x3d a_glyphData.w;\nfloat a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\nfloat fontSize           \x3d a_texAndSize.z;\nfloat haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    \x3d fontSize / SDF_FONT_SIZE;\nfloat halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\nfloat animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor \x3d (isBackground + isText) * a_color;\nv_color     \x3d animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   \x3d 1.0;\nv_tex       \x3d a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset \x3d u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\ngl_Position \x3d vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist \x3d min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3e\x3d u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3c\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif",
"line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\n#ifdef HITTEST\nvoid main() {\ngl_FragColor \x3d v_color;\n}\n#else\nvoid main() {\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor \x3d shadeLine(inputs);\n}\n#endif",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/line/hittest.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\n#ifdef HITTEST\nvoid draw() {\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat a_halfWidth \x3d a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth \x3d a_aux.x / 16. ;\nvec2  a_offset \x3d a_offsetAndNormal.xy / 16.;\nfloat baseWidth \x3d getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos \x3d vec3(0.);\nLineData outputs \x3d buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              \x3d outputs.id;\nv_color           \x3d outputs.color;\nv_normal          \x3d outputs.normal;\nv_lineHalfWidth   \x3d outputs.lineHalfWidth;\nv_opacity         \x3d outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          \x3d outputs.tlbr;\nv_patternSize   \x3d outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio \x3d outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position \x3d vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},
pie:{"pie.frag":"precision mediump float;\n#include \x3cutil/atan2.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvarying float v_size;\nvarying vec2 v_offset;\nvarying vec2 v_filteredSectorToColorId[NUMBER_OF_FIELDS];\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nuniform lowp vec4 u_colors[NUMBER_OF_FIELDS];\nuniform lowp vec4 u_defaultColor;\nuniform lowp vec4 u_othersColor;\nuniform lowp vec4 u_outlineColor;\nuniform float u_donutRatio;\nuniform float u_sectorThreshold;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[NUMBER_OF_FIELDS]) {\n#if __VERSION__ \x3d\x3d 300\nmediump int colorIndex \x3d int(filteredSectorToColorId[index].y);\nreturn u_colors[colorIndex];\n#else\nmediump int colorIndex;\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d index) {\ncolorIndex \x3d int(filteredSectorToColorId[i].y);\n}\n}\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d colorIndex) {\nreturn u_colors[i];\n}\n}\nreturn u_colors[NUMBER_OF_FIELDS - 1];\n#endif\n}\nconst int OTHER_SECTOR_ID \x3d 255;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle \x3d 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle \x3c 0.0) {\nangle +\x3d 360.0;\n} else if (angle \x3e 360.0) {\nangle \x3d mod(angle, 360.0);\n}\nint numOfEntries \x3d int(v_numOfEntries);\nfloat maxSectorAngle \x3d v_maxSectorAngle;\nlowp vec4 fillColor \x3d (maxSectorAngle \x3e 0.0 || u_sectorThreshold \x3e 0.0) ? u_othersColor : u_defaultColor;\nlowp vec4 prevColor \x3d vec4(0.0);\nlowp vec4 nextColor \x3d vec4(0.0);\nfloat startSectorAngle \x3d 0.0;\nfloat endSectorAngle \x3d 0.0;\nif (angle \x3c maxSectorAngle) {\nfor (int index \x3d 0; index \x3c NUMBER_OF_FIELDS; ++index) {\nstartSectorAngle \x3d endSectorAngle;\nendSectorAngle \x3d v_filteredSectorToColorId[index].x;\nif (endSectorAngle \x3e angle) {\nfillColor \x3d getSectorColor(index, v_filteredSectorToColorId);\nprevColor \x3d u_sectorThreshold !\x3d 0.0 \x26\x26 index \x3d\x3d 0 \x26\x26 abs(360.0 - maxSectorAngle) \x3c EPSILON ? u_othersColor :\ngetSectorColor(index \x3e 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d u_sectorThreshold !\x3d 0.0 \x26\x26 abs(endSectorAngle - maxSectorAngle) \x3c EPSILON ? u_othersColor :\ngetSectorColor(index \x3c numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index \x3d\x3d numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor \x3d getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle \x3d maxSectorAngle;\nendSectorAngle \x3d 360.0;\n}\nlowp vec4 outlineColor \x3d u_outlineColor;\nfloat offset \x3d length(v_offset);\nfloat distanceSize \x3d offset * v_size;\nif (startSectorAngle !\x3d 0.0 || endSectorAngle !\x3d 360.0) {\nfloat distanceToStartSector \x3d (angle - startSectorAngle);\nfloat distanceToEndSector \x3d (endSectorAngle - angle);\nfloat sectorThreshold \x3d 0.6;\nfloat beginSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize \x3d u_donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut \x3d donutSize - v_outlineWidth;\nfloat aaThreshold \x3d 0.75;\nfloat innerCircleAlpha \x3d endOfDonut - aaThreshold \x3e 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha \x3d 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha \x3d innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline \x3d v_size - v_outlineWidth;\nif (startOfOutline \x3e 0.0 \x26\x26 v_outlineWidth \x3e 0.25) {\nfloat outlineFactor \x3d smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor \x3d donutSize - aaThreshold \x3e 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor \x3d mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d getColor();\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}",
"pie.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\nuniform float u_outlineWidth;\nuniform mediump float u_sectorThreshold;\nvarying float v_size;\nvarying vec2 v_offset;\nvarying vec2 v_filteredSectorToColorId[NUMBER_OF_FIELDS];\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};\nint filter(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[NUMBER_OF_FIELDS]) {\nif (sectorAngle \x3e u_sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle +\x3d sectorAngle;\n#if __VERSION__ \x3d\x3d 300\nfilteredSectorToColorId[filteredInfo.colorId] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n#else\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; i++) {\nif (i \x3d\x3d filteredInfo.colorId) {\nfilteredSectorToColorId[i] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n}\n}\n#endif\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[NUMBER_OF_FIELDS],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[NUMBER_OF_FIELDS]) {\nfor (int index \x3d 0; index \x3c NUMBER_OF_FIELDS; ++index) {\nfloat sectorValue \x3d sectorAngles[index];\nfilter(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\nvec2 outSize \x3d baseSize;\n#ifdef VV_SIZE\nfloat r \x3d 0.5 * getSize(referenceSize) / referenceSize;\noutSize.xy *\x3d r;\noffset.xy *\x3d r;\nfloat scaleSymbolProportionally \x3d getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       \x3d vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value !\x3d NAN_MAGIC_NUMBER \x26\x26 value \x3e 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec2  a_offset \x3d a_vertexOffset / 16.0;\nfloat outlineSize \x3d u_outlineWidth;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec2 size \x3d getMarkerSize(a_offset, a_size, outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0, a_bitSet);\nfloat filterFlags \x3d getFilterFlags();\nvec3  pos         \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nv_opacity      \x3d getOpacity();\nv_id           \x3d norm(a_id);\nv_pos          \x3d u_dvsMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       \x3d sign(a_texCoords - 0.5);\nv_size         \x3d max(size.x, size.y);\nv_outlineWidth \x3d outlineSize;\nfloat attributeData[10];\nvec4 attributeData0 \x3d getAttributeData3(a_id);\nattributeData[0] \x3d filterNaNValues(attributeData0.x);\nattributeData[1] \x3d filterNaNValues(attributeData0.y);\nattributeData[2] \x3d filterNaNValues(attributeData0.z);\nattributeData[3] \x3d filterNaNValues(attributeData0.w);\n#if (NUMBER_OF_FIELDS \x3e 4)\nvec4 attributeData1 \x3d getAttributeData4(a_id);\nattributeData[4] \x3d filterNaNValues(attributeData1.x);\nattributeData[5] \x3d filterNaNValues(attributeData1.y);\nattributeData[6] \x3d filterNaNValues(attributeData1.z);\nattributeData[7] \x3d filterNaNValues(attributeData1.w);\n#endif\n#if (NUMBER_OF_FIELDS \x3e 8)\nvec4 attributeData2 \x3d getAttributeData5(a_id);\nattributeData[8] \x3d filterNaNValues(attributeData2.x);\nattributeData[9] \x3d filterNaNValues(attributeData2.y);\n#endif\nfloat sum \x3d 0.0;\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nsum +\x3d attributeData[i];\n}\nfloat sectorAngles[NUMBER_OF_FIELDS];\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nsectorAngles[i] \x3d 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[NUMBER_OF_FIELDS];\nFilteredChartInfo filteredInfo \x3d FilteredChartInfo(0.0, 0);\nint numOfEntries \x3d filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries \x3d float(numOfEntries);\nv_maxSectorAngle \x3d filteredInfo.endSectorAngle;\n#if __VERSION__ \x3d\x3d 300\nv_filteredSectorToColorId \x3d filteredSectorToColorId;\n#else\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d numOfEntries) {\nbreak;\n}\nv_filteredSectorToColorId[i] \x3d filteredSectorToColorId[i];\n}\n#endif\n#ifdef HITTEST\nhighp vec3 out_pos \x3d vec3(0.0);\nv_color            \x3d vec4(0.0);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  pos, v_size);\ngl_PointSize \x3d 1.0;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};",
"line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth \x3d line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX \x3d fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY \x3d 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth \x3d line.lineHalfWidth;\nmediump float adjustedPatternHeight \x3d line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY \x3d fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX \x3d 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist \x3d length(line.normal) * line.lineHalfWidth;\nlowp float alpha \x3d clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color \x3d getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a \x3d step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a \x3c 1.0 / 255.0) {\ndiscard;\n}\nout_color \x3d vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}",
"line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth \x3d 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth \x3d max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat baseWidth \x3d getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nfloat z         \x3d 2.0 * step(baseWidth, 0.0);\nvec2  dist      \x3d getDist(in_offset, halfWidth);\nvec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       \x3d u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     \x3d in_color;\nfloat opacity   \x3d 1.0;\n#else\nvec4  color     \x3d getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   \x3d getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH \x3d 15.5;\nfloat scaleDash \x3d getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio \x3d (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nv_sampleAlphaOnly \x3d getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos \x3d vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},
"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;",
"hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF \x3d (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /\x3d 2.0;\n#endif\nlowp float aa \x3d v_antialiasingWidth;\nlowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\n#include \x3cmaterials/text/hittest.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r \x3d getSize(referenceSize) / referenceSize;\nbaseSize *\x3d r;\noffset.xy *\x3d r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  \x3d a_aux.y;\nfloat a_referenceSize \x3d a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        \x3d a_aux.w;\nfloat a_fontSize      \x3d a_texFontSize.z;\nvec2  a_offset        \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      \x3d getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     \x3d fontSize / SDF_FONT_SIZE;\nvec3  offset        \x3d getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  \x3d (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   \x3d u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\nv_tex     \x3d a_texCoords / u_mosaicSize;\nv_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\nv_edgeDistanceOffset \x3d u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position \x3d  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset \x3d pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\nreturn getBit(bitset, 0);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate \x3d getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r \x3d mod(rshift(u32, 0), 255.0);\nfloat g \x3d mod(rshift(u32, 8), 255.0);\nfloat b \x3d mod(rshift(u32, 16), 255.0);\nfloat a \x3d mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /\x3d 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a \x3d 12.9898;\nhighp float b \x3d 78.233;\nhighp float c \x3d 43758.5453;\nhighp float dt \x3d dot(co, vec2(a,b));\nhighp float sn \x3d mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp mat3 u_tileMat3;\nuniform highp mat3 u_viewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nuniform mediump float u_currentZoom;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef SUPPORTS_TEXTURE_FLOAT\ntarget.rgba \x3d getAttributeData2(a_id);\n#else\nvec4 data0 \x3d getAttributeData2(a_id);\nvec4 data1 \x3d getAttributeData3(a_id);\ntarget.r \x3d u88VVToFloat(data0.rg * 255.0);\ntarget.g \x3d u88VVToFloat(data0.ba * 255.0);\ntarget.b \x3d u88VVToFloat(data1.rg * 255.0);\ntarget.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   \x3d getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getAttributeData0(a_id).x * 255.0);\n#else\nreturn getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAttributeData1(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 \x3d getAttributeData0(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * u_viewMat3 * u_tileMat3 + (1.0 - isMapAligned) * u_tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef INSIDE\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(OUTSIDE)\npos.z +\x3d 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(HIGHLIGHT)\n#if !defined(HIGHLIGHT_ALL)\npos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n#endif\npos.z +\x3d 2.0 * (step(minMaxZoom.y, u_currentZoom) + (1.0 - step(minMaxZoom.x, u_currentZoom)));\nreturn pos;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\nreturn (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\ninterpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\nreturn u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\nreturn u_vvSizeFieldStopsSizes[0];\n}\nfor (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\nif (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\nfloat f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\nreturn mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n}\n}\nreturn u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\nreturn u_vvOpacities[0];\n}\nfor (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\nif (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\nfloat f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\nreturn mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n}\n}\nreturn u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (u_vvRotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (u_vvRotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * -rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\nreturn fallback;\n}\nif (colorValue \x3c\x3d u_vvColorValues[0]) {\nreturn u_vvColors[0];\n}\nfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\nif (u_vvColorValues[i] \x3e\x3d colorValue) {\nfloat f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\nreturn mix(u_vvColors[i-1], u_vvColors[i], f);\n}\n}\nreturn u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nreturn u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize \x3d getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},
overlay:{overlay:{"overlay.frag":"precision lowp float;\nuniform lowp sampler2D u_texture;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_texture, v_uv);\ngl_FragColor \x3d color *  u_opacity;\n}","overlay.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_perspective;\nvarying mediump vec2 v_uv;\nvoid main(void) {\nv_uv \x3d a_uv;\nfloat w \x3d 1.0 + dot(a_uv, u_perspective);\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0);\ngl_Position \x3d vec4(w * pos.xy, 0.0, w);\n}"}},
"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor \x3d texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor \x3d 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color \x3d u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor \x3d clamp(color, 0.0, 1.0);\n}"},
gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d float(SIGMA);\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel \x3d texture2D(u_texture, v_uv);\nvec3 luma \x3d vec3(0.299, 0.587, 0.114);\nfloat v \x3d dot(texel.xyz, luma);\nvec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor \x3d mix(outputColor, texel, alpha);\n}"}},
blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d u_sigma;\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist \x3d 1.0;\nconst float sampleStrength \x3d 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] \x3d -0.08;\nsamples[1] \x3d -0.05;\nsamples[2] \x3d -0.03;\nsamples[3] \x3d -0.02;\nsamples[4] \x3d -0.01;\nsamples[5] \x3d  0.01;\nsamples[6] \x3d  0.02;\nsamples[7] \x3d  0.03;\nsamples[8] \x3d  0.05;\nsamples[9] \x3d  0.08;\nvec2 dir \x3d 0.5 - v_uv;\nfloat dist \x3d sqrt(dir.x * dir.x + dir.y * dir.y);\ndir \x3d dir / dist;\nvec4 color \x3d texture2D(u_colorTexture,v_uv);\nvec4 sum \x3d color;\nfor (int i \x3d 0; i \x3c 10; i++) {\nsum +\x3d texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *\x3d 1.0 / 11.0;\nfloat t \x3d dist * sampleStrength;\nt \x3d clamp(t, 0.0, 1.0);\ngl_FragColor \x3d mix(color, sum, t);\n}"}},
dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor \x3d texture2D(u_minColor, vec2(0.5));\nvec4 maxColor \x3d texture2D(u_maxColor, vec2(0.5));\nvec4 color \x3d texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply \x3d minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply \x3d maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply \x3d color.rgb / color.a;\nvec3 range \x3d maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor \x3d vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}",
"min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel \x3d floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel \x3d vec2(1.0) / u_srcResolution;\nvec2 uv \x3d (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor \x3d vec4(1.0);\nvec4 maxColor \x3d vec4(0.0);\nfor (int y \x3d 0; y \x3c CELL_SIZE; ++y) {\nfor (int x \x3d 0; x \x3c CELL_SIZE; ++x) {\nvec2 offset \x3d uv + vec2(x, y) * onePixel;\nminColor \x3d min(minColor, texture2D(u_minTexture, offset));\nmaxColor \x3d max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] \x3d minColor;\ngl_FragData[1] \x3d maxColor;\n}"}},
"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset \x3d u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor \x3d texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor \x3d texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor \x3d ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},
"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 \x3d mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 \x3d mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 \x3d mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 \x3d mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 \x3d mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 \x3d mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 \x3d mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 \x3d mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 \x3d mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] \x3d g0,\nG[1] \x3d g1,\nG[2] \x3d g2,\nG[3] \x3d g3,\nG[4] \x3d g4,\nG[5] \x3d g5,\nG[6] \x3d g6,\nG[7] \x3d g7,\nG[8] \x3d g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 9; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nfloat M \x3d (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S \x3d (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor \x3d vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},
sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\ngl_FragColor \x3d vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},
"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\ngl_FragColor \x3d vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},
filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\nvec4 rgbw \x3d u_coefficients * vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a \x3d color.a;\ngl_FragColor \x3d vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"}},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor \x3d vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\n#ifdef BILINEAR\n#include \x3cfiltering/bilinear.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation \x3d projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color \x3d sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}",
"common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos * u_scale + u_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0;\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb \x3d clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}",
"getSurfaceValues.glsl":"#include \x3craster/common/mirror.glsl\x3e\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel \x3d 1.0 / srcImageSize;\nvec4 va \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve \x3d texture2D(imageTexture, mirror(texCoord));\nvec4 vf \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha \x3d va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] \x3d va.r;\nvalues[1] \x3d vb.r;\nvalues[2] \x3d vc.r;\nvalues[3] \x3d vd.r;\nvalues[4] \x3d ve.r;\nvalues[5] \x3d vf.r;\nvalues[6] \x3d vg.r;\nvalues[7] \x3d vh.r;\nvalues[8] \x3d vi.r;\nvalues[9] \x3d alpha;\n}",
"inverse.glsl":"float invertValue(float value) {\nfloat s \x3d sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 \x3d abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv \x3d texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},
flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff \x3d mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart \x3d clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist \x3e featheringStart) {\ncolor *\x3d 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",
imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled \x3d texture2D(u_texture, v_texcoord);\nfloat intensity \x3d getIntensity(sampled.r);\ngl_FragColor \x3d getColor(intensity);\ngl_FragColor.a *\x3d getOpacity(sampled.r);\ngl_FragColor.a *\x3d sampled.a;\ngl_FragColor.rgb *\x3d gl_FragColor.a;\n}",
"imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy \x3d (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\nvoid main(void) {\ngl_FragColor \x3d getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}",
"particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/vv.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nvec2 position0 \x3d a_xyts0.xy;\nfloat t0 \x3d a_xyts0.z;\nfloat speed0 \x3d a_xyts0.w;\nvec2 position1 \x3d a_xyts1.xy;\nfloat t1 \x3d a_xyts1.z;\nfloat speed1 \x3d a_xyts1.w;\nfloat type \x3d a_typeIdDurationSeed.x;\nfloat id \x3d a_typeIdDurationSeed.y;\nfloat duration \x3d a_typeIdDurationSeed.z;\nfloat seed \x3d a_typeIdDurationSeed.w;\nvec2 e0 \x3d a_extrudeInfo.xy;\nvec2 e1 \x3d a_extrudeInfo.zw;\nfloat animationPeriod \x3d duration + u_trailLength;\nfloat scaledTime \x3d u_time * u_flowSpeed;\nfloat randomizedTime \x3d scaledTime + seed * animationPeriod;\nfloat t \x3d mod(randomizedTime, animationPeriod);\nfloat fUnclamped \x3d (t - t0) / (t1 - t0);\nfloat f \x3d clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime \x3d mix(t0, t1, f);\nfloat speed \x3d mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type \x3d\x3d 2.0) {\nif (fUnclamped \x3c 0.0 || (fUnclamped \x3e 1.0 \x26\x26 t1 !\x3d duration)) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho \x3d mix(e0, e1, f);\nvec2 parallel;\nparallel \x3d normalize(position1 - position0) * 0.5;\nif (id \x3d\x3d 1.0) {\nextrude \x3d ortho;\nv_texcoord \x3d vec2(0.5, 0.0);\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -ortho;\nv_texcoord \x3d vec2(0.5, 1.0);\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d ortho + parallel;\nv_texcoord \x3d vec2(1.0, 0.0);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -ortho + parallel;\nv_texcoord \x3d vec2(1.0, 1.0);\n}\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else {\nif (fUnclamped \x3c 0.0) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id \x3d\x3d 1.0) {\nextrude \x3d e0;\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -e0;\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n}\n}\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_color.a *\x3d fadeOpacity;\nv_color.a *\x3d mix(1.0, introOpacity, u_introFade);\nv_color.rgb *\x3d v_color.a;\n}"},
streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nfloat t \x3d mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color \x3d v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *\x3d mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor \x3d getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}",
"streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nvoid main(void) {\nvec4 lineColor \x3d getColor(a_speed);\nfloat lineOpacity \x3d getOpacity(a_speed);\nfloat lineSize \x3d getSize(a_speed);\nvec2 position \x3d a_positionAndSide.xy;\nv_side \x3d a_positionAndSide.z;\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_time \x3d a_timeInfo.x;\nv_totalTime \x3d a_timeInfo.y;\nv_timeSeed \x3d a_timeInfo.z;\nv_color \x3d lineColor;\nv_color.a *\x3d lineOpacity;\nv_color.rgb *\x3d v_color.a;\nv_size \x3d lineSize;\n}"},
"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color \x3d u_color_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_color_count) {\nbreak;\n}\nfloat x1 \x3d u_color_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_color_stops[i];\nvec4 y2 \x3d u_color_values[i];\nif (x \x3c x2) {\nvec4 y1 \x3d u_color_values[i - 1];\ncolor \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor \x3d y2;\n}\n}\n}\n#else\nvec4 color \x3d u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity \x3d u_opacity_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_opacity_count) {\nbreak;\n}\nfloat x1 \x3d u_opacity_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_opacity_stops[i];\nfloat y2 \x3d u_opacity_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_opacity_values[i - 1];\nopacity \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity \x3d y2;\n}\n}\n}\n#else\nfloat opacity \x3d u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size \x3d u_size_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_size_count) {\nbreak;\n}\nfloat x1 \x3d u_size_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_size_stops[i];\nfloat y2 \x3d u_size_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_size_values[i - 1];\nsize \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize \x3d y2;\n}\n}\n}\n#else\nfloat size \x3d u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include \x3craster/lut/colorize.glsl\x3e\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv), 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy \x3d (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z \x3d (u_cosZs[0] + cosDelta) / dzd;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n} else {\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / dzd;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\ngl_FragColor \x3d overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex \x3d clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color \x3d texture2D(u_colormap, clrPosition);\nvec4 result \x3d vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nvec4 result \x3d colorize(currentPixel, 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},
magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor \x3d v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle \x3d a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle \x3d 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset \x3d vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos \x3d a_pos + offset * sizePercentage * u_symbolSize;\nv_color \x3d u_colors[int(a_vv.x)];\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_position;\ngl_Position \x3d vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},
rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nconst float pi \x3d 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *\x3d sign(abs(dzx) + abs(dzy));\nfloat aspect_rad \x3d (dzx \x3d\x3d 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},
bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index;\n#ifdef NDXI\nindex \x3d (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex \x3d nir * invertValue(red);\n#elif defined(CI)\nindex \x3d nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex \x3d (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s \x3d u_adjustments[0];\nfloat a \x3d u_adjustments[1];\nfloat x \x3d u_adjustments[2];\nfloat y \x3d -a * s + x * (1.0 + s * s);\nindex \x3d (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MAVI)\nindex \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex \x3d eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a \x3d u_adjustments[0];\nfloat b \x3d u_adjustments[1];\nfloat y \x3d sqrt(1.0 + a * a);\nindex \x3d (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex \x3d (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI2)\nfloat green \x3d pv2.b;\nfloat v \x3d pow(sqrt((2.0 * nir + 1.0), 2.0) - 6.0 * nir - 5.0 * sqrt(red) - 0.5);\nindex \x3d 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * v;\n#elif defined(RTVICORE)\nfloat green \x3d pv2.b;\nindex \x3d 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue \x3d pv2.b;\nfloat denom \x3d nir + 6.0 * red - 7.5 * blue + 1.0;\nindex \x3d  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g \x3d pv2.r;\nfloat n \x3d pv2.g;\nfloat s \x3d pv2.s;\nfloat a \x3d u_adjustments[0];\nfloat denom \x3d g + a * n + (1.0 - a) * s;\nindex \x3d (g - a * n - (1 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex \x3d invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor \x3d pv;\nreturn;\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 p0 \x3d texture2D(u_image, v_texcoord);\nvec4 p1 \x3d texture2D(u_image1, v_texcoord);\nvec4 p2 \x3d texture2D(u_image2, v_texcoord);\ngl_FragColor \x3d vec4(p0.r, p1.r, p2.r, p0.a * p1.a * p2.a);\n}"},contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/common/contrastBrightness.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d adjustContrastBrightness(pv, false) ;\ngl_FragColor \x3d vec4(result.rgb * 255.0, result.a);\n}"},
convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include \x3craster/common/mirror.glsl\x3e\nvoid main() {\nvec3 rgb \x3d vec3(0.0, 0.0, 0.0);\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha \x3d 1.0;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\nrgb +\x3d pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *\x3d pv.a;\n}\n}\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat d \x3d ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e \x3d ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature \x3d 0.0;\n#ifdef STANDARD\ncurvature \x3d -u_zlFactor * (d + e);\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f \x3d (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g \x3d (-pv[3] + pv[5]) / 2.0;\nfloat h \x3d (pv[1] - pv[7]) / 2.0;\nfloat g2 \x3d g * g;\nfloat h2 \x3d h * h;\n#ifdef PROFILE\ncurvature \x3d (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature \x3d (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n}"},
extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\ngl_FragColor \x3d vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include \x3craster/common/mirror.glsl\x3e\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count \x3d 0.0;\n#ifdef STDDEV\nvec3 sum \x3d vec3(0.0, 0.0, 0.0);\nvec3 sum2 \x3d vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nvec3 rgb \x3d currentPixel.rgb;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\ncount +\x3d pv.a;\n#ifdef MIN\nrgb \x3d min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb \x3d max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb +\x3d pv.rgb;\n#elif defined(STDDEV)\nsum +\x3d pv.rgb;\nsum2 +\x3d (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *\x3d invertValue(count);\n#elif defined(STDDEV)\nrgb \x3d sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha \x3d step(0.9999, count);\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb \x3d (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
local:{"local.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\n#endif\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef PLUS\nresult \x3d a + b;\n#elif defined(MINUS)\nresult \x3d a - b;\n#elif defined(TIMES)\nresult \x3d a * b;\n#elif defined(DIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult \x3d floor(a * invertValue(b));\nalpha *\x3d float(abs(sign(b)));\n#elif defined(SQUARE)\nresult \x3d a * a;\n#elif defined(SQRT)\nresult \x3d sqrt(a);\n#elif defined(POWER)\nresult \x3d pow(a, b);\n#elif defined(LN)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_1_0)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_2)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(EXP)\nresult \x3d exp(a);\n#elif defined(EXP_1_0)\nresult \x3d pow(10.0, a);\n#elif defined(EXP_2)\nresult \x3d pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult \x3d floor(a);\n#elif defined(ROUNDUP)\nresult \x3d ceil(a);\n#elif defined(INT)\nresult \x3d float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult \x3d mod(a, b);\n#elif defined(NEGATE)\nresult \x3d -a;\n#elif defined(ABS)\nresult \x3d abs(a);\n#elif defined(ACOS)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: acos(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult \x3d acosh(a);\n#elif defined(POLYFILLACOSH)\nresult \x3d log(a + sqrt(a * a - 1.0));\n#elif defined(ASIN)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: asin(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult \x3d asinh(a);\n#elif defined(POLYFILLASINH)\nresult \x3d log(a + sqrt(a * a + 1.0));\n#elif defined(ATAN)\nresult \x3d atan(a);\n#elif defined(ATANH)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: atanh(a);\nalpha *\x3d step(abs(a), 1.0);\n#elif defined(POLYFILLATANH)\nresult \x3d a \x3d\x3d 1.0 ? 0.0 : 0.5 * log((1.0 + a)/(1.0 -a));\n#elif defined(ATAN_2)\nresult \x3d atan(a, b);\n#elif defined(COS)\nresult \x3d cos(a);\n#elif defined(COSH)\nresult \x3d cosh(a);\n#elif defined(POLYFILLCOSH)\nfloat halfexp \x3d exp(a) / 2.0;\nresult \x3d halfexp + 1.0 / halfexp;\n#elif defined(SIN)\nresult \x3d sin(a);\n#elif defined(SINH)\nresult \x3d sinh(a);\n#elif defined(POLYFILLSINH)\nfloat halfexp \x3d exp(a) / 2.0;\nresult \x3d halfexp - 1.0 / halfexp;\n#elif defined(TAN)\nresult \x3d tan(a);\n#elif defined(TANH)\nresult \x3d tanh(a);\n#elif defined(POLYFILLTANH)\nfloat expx \x3d exp(a);\nresult \x3d (expx - 1.0 / expx) / (expx + 1.0 / expx);\n#elif defined(BITWISEAND)\nresult \x3d a \x26 b;\n#elif defined(BITWISEOR)\nresult \x3d a | b;\n#elif defined(BITWISELEFTSHIFT)\nresult \x3d a \x3c\x3c b;\n#elif defined(BITWISERIGHTSHIFT)\nresult \x3d a \x3e\x3e b;\n#elif defined(BITWISENOT)\nresult \x3d ~a;\n#elif defined(BITWISEXOR)\nresult \x3d a ^ b;\n#elif defined(BOOLEANAND)\nresult \x3d float((a !\x3d 0.0) \x26\x26 (b !\x3d 0.0));\n#elif defined(BOOLEANNOT)\nresult \x3d float(a \x3d\x3d 0.0);\n#elif defined(BOOLEANOR)\nresult \x3d float((a !\x3d 0.0) || (b !\x3d 0.0));\n#elif defined(BOOLEANXOR)\nresult \x3d float((a !\x3d 0.0) ^^ (b !\x3d 0.0));\n#elif defined(GREATERTHAN)\nresult \x3d float(a \x3e b);\n#elif defined(GREATERTHANEQUAL)\nresult \x3d float(a \x3e\x3d b);\n#elif defined(LESSTHAN)\nresult \x3d float(a \x3c b);\n#elif defined(LESSTHANEQUAL)\nresult \x3d float(a \x3c\x3d b);\n#elif defined(EQUALTO)\nresult \x3d float(a \x3d\x3d b);\n#elif defined(NOTEQUAL)\nresult \x3d float(a !\x3d b);\n#elif defined(ISNULL)\nresult \x3d float(alpha \x3d\x3d 0.0);\nalpha \x3d 1.0;\n#elif defined(SETNULL)\nfloat maskValue \x3d float(a \x3d\x3d 0.0);\nresult \x3d maskValue * b;\nalpha *\x3d maskValue;\n#elif defined(CONDITIONAL)\nfloat weight \x3d float(abs(sign(a)));\nresult \x3d weight * b + (1.0 - weight) * c;\n#endif\nbool isInvalid \x3d result \x3c u_domainRange.s || result \x3e u_domainRange.t;\nresult \x3d isInvalid ? 0.0 : result;\nalpha *\x3d float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor \x3d 1.0;\nfor (int i \x3d 0; i \x3c LEN_NODATA_VALUES; i++) {\nfactor *\x3d float(u_noDataValues[i] !\x3d bandValue);\n}\nfactor *\x3d step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat redFactor \x3d maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor \x3d maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor \x3d maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor \x3d redFactor * greenFactor * blueFactor;\ngl_FragColor \x3d pv * maskFactor;\n#else\ngl_FragColor \x3d pv * redFactor;\n#endif\n}"},
ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index \x3d (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex \x3d floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat factor \x3d 1.0;\nfloat bandValue \x3d pv.r;\nfor (int i \x3d 0; i \x3c LEN_NODATA_RANGES; i+\x3d2) {\nfloat inside \x3d 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *\x3d inside;\n}\nfloat mapValue \x3d 0.0;\nfloat includeMask \x3d 0.0;\nfor (int i \x3d 0; i \x3c LEN_REMAP_RANGES; i+\x3d3) {\nfloat stepMask \x3d step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask \x3d (1.0 - stepMask) * includeMask + stepMask;\nmapValue \x3d (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue \x3d factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask \x3d factor * max(u_unmatchMask, includeMask);\nbandValue \x3d clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},
slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat xf \x3d (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf \x3d (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run \x3d sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat percentRise \x3d rise2run * 100.0;\ngl_FragColor \x3d vec4(percentRise, percentRise, percentRise, alpha);\n#else\nfloat degree \x3d atan(rise2run) * 57.2957795;\ngl_FragColor \x3d vec4(degree, degree, degree, alpha);\n#endif\n}"},
stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval \x3d clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -\x3d step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal \x3d tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal \x3d clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor \x3d vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},
vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor \x3d vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize \x3d 0.02;\nconst float innerRadius \x3d 0.25;\nconst float outerRadius \x3d 0.42;\nconst float innerSquareLength \x3d 0.15;\nvoid main() {\nmediump float dist \x3d length(v_pos);\nmediump float fillalpha1 \x3d smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *\x3d (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 \x3d smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *\x3d (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 \x3d (abs(v_pos.x) \x3c innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) \x3c innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor \x3d (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}",
"scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size \x3d u_symbolSize * sizePercentage;\nvec2 pos \x3d a_pos + a_offset * size;\nv_pos \x3d a_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val \x3e\x3d maxCutOff) {\nreturn maxOutput;\n} else if (val \x3c\x3d minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n}\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount \x3d\x3d 1) {\nfloat grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result \x3d colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},
stencil:{"stencil.frag":"void main() {\ngl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position \x3d vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\nv_tex \x3d a_pos;\n}"},
util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 \x3d abs(x);\nt1 \x3d abs(y);\nt0 \x3d max(t3, t1);\nt1 \x3d min(t3, t1);\nt3 \x3d 1.0 / t0;\nt3 \x3d t1 * t3;\nt4 \x3d t3 * t3;\nt0 \x3d         - 0.013480470;\nt0 \x3d t0 * t4 + 0.057477314;\nt0 \x3d t0 * t4 - 0.121239071;\nt0 \x3d t0 * t4 + 0.195635925;\nt0 \x3d t0 * t4 - 0.332994597;\nt0 \x3d t0 * t4 + 0.999995630;\nt3 \x3d t0 * t3;\nt3 \x3d (abs(y) \x3e abs(x)) ? 1.570796327 - t3 : t3;\nt3 \x3d x \x3c 0.0 ?  3.141592654 - t3 : t3;\nt3 \x3d y \x3c 0.0 ? -t3 : t3;\nreturn t3;\n}",
"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/BrushOverlay":function(){define(["../definitions","../Utils","./WGLBrush","../../../../webgl/enums"],function(h,g,v,n){class p extends v{constructor(){super(...arguments);this._desc={vsPath:"overlay/overlay",
fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])}}dispose(){}prepareState({context:f}){f.setBlendingEnabled(!0);f.setColorMask(!0,!0,!0,!0);f.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setStencilWriteMask(0);f.setStencilTestEnabled(!0);f.setStencilFunction(n.CompareFunction.GREATER,255,255)}draw(f,e){const {context:a,painter:b,requestRender:c,allowDelayedRender:m}=f;if(e.isReady){var {computedOpacity:d,
dvsMat3:k,isWrapAround:l,perspectiveTransform:r,texture:u}=e;f.timeline.begin(this.name);var w=b.materialManager.getProgram(this._desc);if(m&&null!=c&&!w.compiled)c();else{var x=g.createProgramDescriptor("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:n.DataType.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:n.DataType.UNSIGNED_SHORT}]});if(e=e.getVAO(a,x.bufferLayouts,x.attributes))a.bindVAO(e),a.useProgram(w),a.bindTexture(u,h.textureBindingBitmap),w.setUniformMatrix3fv("u_dvsMat3",
k),w.setUniform1i("u_texture",h.textureBindingBitmap),w.setUniform1f("u_opacity",d),w.setUniform2fv("u_perspective",r),a.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,l?10:4),a.bindVAO(),f.timeline.end(this.name)}}}}return p})},"esri/views/2d/engine/webgl/brushes/WGLBrushDotDensity":function(){define("../../../../../core/maybe ../../../../../core/RandomLCG ../definitions ../enums ./WGLGeometryBrushFill ../techniques/utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/FramebufferObject ../../../../webgl/Renderbuffer ../../../../webgl/RenderbufferDescriptor ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l){class r extends p{constructor(){super(...arguments);this._dotTextureSize=0;this._dotTextures=null;this._dotSamplers=new Int32Array([v.textureBindingRenderer0,v.textureBindingRenderer1]);this._dotVAO=null;this._dotDesc={vsPath:"dot/dot",fsPath:"dot/dot",attributes:new Map([["a_pos",0]])}}dispose(){super.dispose();this._disposeTextures();this._dotFBO=h.disposeMaybe(this._dotFBO);this._dotVAO=h.disposeMaybe(this._dotVAO)}getGeometryType(){return n.WGLGeometryType.FILL}supportsSymbology(u){return u===
n.WGLSymbologyType.DOT_DENSITY}_drawFills(u,w,x,z,q,t){const {passOptions:B}=u;null!=B&&"hittest"===B.type?super._drawFills(u,w,x,z,q,t):(x=this._drawDotLocations(u,w,x,q,t),this._drawDotDensity(u,w,x))}_drawDotDensity(u,w,x){const {context:z,painter:q,rendererInfo:t,requestRender:B,allowDelayedRender:y}=u,E=q.materialManager.getProgram(this._dotDesc);if(y&&null!=B&&!E.compiled)B();else{var {rendererSchema:F}=t;f.assertRendererSchema(F,"dot-density");var C=this._createDotDensityMesh(z,this._dotDesc.attributes,
{geometry:[{name:"a_pos",count:2,type:a.DataType.SHORT,divisor:0,normalized:!1,offset:0,stride:4}]});z.setStencilTestEnabled(!0);z.useProgram(E);E.setUniform1f("u_tileZoomFactor",1);E.setUniform1i("u_texture",this._dotSamplers[0]);E.setUniform1f("u_dotSize",Math.max(F.dotSize,1));E.setUniform1f("u_pixelRatio",window.devicePixelRatio);this._setSharedUniforms(E,u,w);z.bindTexture(x,this._dotSamplers[0]);z.bindVAO(C);z.drawArrays(a.PrimitiveType.POINTS,0,262144)}}_drawDotLocations(u,w,x,z,q){const {context:t,
rendererInfo:B,requiredLevel:y}=u,E=t.getViewport();var {rendererSchema:F}=B;f.assertRendererSchema(F,"dot-density");const {dotScale:C,colors:A,activeDots:D,backgroundColor:G,dotValue:J}=F;t.setViewport(0,0,512,512);F=t.getBoundFramebufferObject();const M=this._createFBO(t);t.bindFramebuffer(M);t.setClearColor(0,0,0,0);t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT);t.setStencilTestEnabled(!1);w=1/2**(y-w.key.level);const L=v.tileSize,Q=L*window.devicePixelRatio*L*window.devicePixelRatio,N=
1/w*(1/w);u=C?u.state.scale/C:1;x.setUniform1f("u_tileZoomFactor",w);x.setUniform1f("u_tileDotsOverArea",Q/(v.tileSize*window.devicePixelRatio*v.tileSize*window.devicePixelRatio));x.setUniformMatrix4fv("u_dotColors",A);x.setUniform4fv("u_isActive",D);x.setUniform4fv("u_dotBackgroundColor",G);x.setUniform1f("u_dotValue",Math.max(1,J*u*N));this._bindDotDensityTextures(t,x,B,L);t.drawElements(a.PrimitiveType.TRIANGLES,z,a.DataType.UNSIGNED_INT,q);t.setViewport(E.x,E.y,E.width,E.height);t.bindFramebuffer(F);
return M.colorTexture}_createFBO(u){if(null==this._dotFBO){const w=new k.TextureDescriptor(512,512);w.samplingMode=a.TextureSamplingMode.NEAREST;w.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;const x=new c.Renderbuffer(u,new m.RenderbufferDescriptor(a.RenderbufferFormat.DEPTH_STENCIL,512,512));this._dotFBO=new b.FramebufferObject(u,w,x)}return this._dotFBO}_disposeTextures(){if(this._dotTextures){for(let u=0;u<this._dotTextures.length;u++)this._dotTextures[u].dispose();this._dotTextures=null}}_bindDotDensityTextures(u,
w,x,z){({rendererSchema:x}=x);f.assertRendererSchema(x,"dot-density");z=this._createDotDensityTextures(u,z,x.seed);w.setUniform1iv("u_dotTextures",this._dotSamplers);for(w=0;w<z.length;w++)u.bindTexture(z[w],this._dotSamplers[w])}_createDotDensityMesh(u,w,x){if(null==this._dotVAO){var z=new Int16Array(524288);for(let q=0;512>q;q++)for(let t=0;512>t;t++)z[2*(t+512*q)]=t,z[2*(t+512*q)+1]=q;z=e.BufferObject.createVertex(u,a.Usage.STATIC_DRAW,z);this._dotVAO=new l.VertexArrayObject(u,w,x,{geometry:z},
null)}return this._dotVAO}_createDotDensityTextures(u,w,x){if(this._dotTextureSize!==w||this._seed!==x)this._disposeTextures(),this._dotTextureSize=w,this._seed=x;null===this._dotTextures&&(x=new g(x),this._dotTextures=[this._allocDotDensityTexture(u,w,x),this._allocDotDensityTexture(u,w,x)]);return this._dotTextures}_allocDotDensityTexture(u,w,x){const z=new Float32Array(w*w*4);for(let q=0;q<z.length;q++)z[q]=x.getFloat();x=new k.TextureDescriptor;x.dataType=a.PixelType.FLOAT;x.samplingMode=a.TextureSamplingMode.NEAREST;
x.width=w;x.height=w;return new d.Texture(u,x,z)}}return r})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../techniques/utils ../../../../webgl/enums".split(" "),function(h,g,v,n,p,f,e){class a extends n{dispose(){}getGeometryType(){return g.WGLGeometryType.FILL}supportsSymbology(b){return b!==g.WGLSymbologyType.DOT_DENSITY}drawGeometry(b,c,m,d){const {context:k,painter:l,rendererInfo:r,
requiredLevel:u,passOptions:w,requestRender:x,allowDelayedRender:z}=b;var q=p.FillMaterialKey.load(m.materialKey),t=f.getTechniqueFromMaterialKey(q.data);const B=null!=w&&"hittest"===w.type;var y=l.materialManager;if(null==(t=t.programSpec)){t={geometry:[{location:0,name:"a_pos",count:2,type:e.DataType.SHORT},{location:1,name:"a_id",count:3,type:e.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:e.DataType.UNSIGNED_BYTE},{location:3,name:"a_color",count:4,type:e.DataType.UNSIGNED_BYTE,
normalized:!0},{location:4,name:"a_aux1",count:4,type:e.DataType.UNSIGNED_SHORT},{location:5,name:"a_aux2",count:4,type:e.DataType.SHORT},{location:6,name:"a_aux3",count:4,type:e.DataType.UNSIGNED_BYTE},{location:7,name:"a_zoomRange",count:2,type:e.DataType.UNSIGNED_SHORT}]};switch(q.symbologyType){case g.WGLSymbologyType.SIMPLE:case g.WGLSymbologyType.OUTLINE_FILL_SIMPLE:t.geometry.splice(7,1),t.geometry.splice(4,1)}t={shader:"materials/fill",vertexLayout:t}}const {shader:E,vertexLayout:F,hittestAttributes:C}=
t;t=e.PrimitiveType.TRIANGLES;var A=v.createProgramDescriptor(q.data,F);B&&(A=this._getTriangleDesc(m.materialKey,A,C),t=e.PrimitiveType.POINTS);const {attributes:D,bufferLayouts:G}=A;d=y.getMaterialProgram(b,q,E,D,d);if(z&&null!=x&&!d.compiled)x();else{k.useProgram(d);this._setSharedUniforms(d,b,c);var {row:J,col:M}=c.key;y=M*h.tileSize;A=J*h.tileSize;d.setUniform2f("u_tileOffset",y%h.maxRepresentableInt,A%h.maxRepresentableInt);d.setUniform2f("u_maxIntNumOfCrossing",Math.floor(y/h.maxRepresentableInt),
Math.floor(A/h.maxRepresentableInt));q.textureBinding&&(l.textureManager.bindTextures(k,d,q),d.setUniform1f("u_zoomFactor",1/2**(u-c.key.level)));y=1/b.pixelRatio;d.setUniform1f("u_blur",y);d.setUniform1f("u_antialiasing",y);this._setSizeVVUniforms(q,d,r,c);this._setColorAndOpacityVVUniforms(q,d,r);q=m.target.getVAO(k,G,D,B);y=m.indexCount;m=m.indexFrom*Uint32Array.BYTES_PER_ELEMENT;B&&(y/=3,m/=3);k.bindVAO(q);this._drawFills(b,c,d,t,y,m)}}_drawFills(b,c,m,d,k,l){b.context.drawElements(d,k,e.DataType.UNSIGNED_INT,
l)}}return a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define(["../definitions","./WGLBrush","../materialKey/MaterialKey","../../../../webgl/enums"],function(h,g,v,n){class p extends g{constructor(){super(...arguments);this._computeDesc=new Map}prepareState({context:f},e){e&&e.includes("hittest")?f.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE,n.BlendFactor.ONE,n.BlendFactor.ONE):f.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,
n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setBlendingEnabled(!0);f.setColorMask(!0,!0,!0,!0);f.setStencilWriteMask(0);f.setStencilTestEnabled(!0)}draw(f,e,a){var b=this.getGeometryType();e.commit(f);b=e.getGeometry(b);null!=b&&(f.timeline.begin(this.name),f.attributeView.bindTextures(f.context),f.context.setStencilFunction(n.CompareFunction.EQUAL,e.stencilRef,255),b.forEachCommand(c=>{const m=v.MaterialKeyBase.load(c.materialKey).symbologyType;this.supportsSymbology(m)&&this.drawGeometry(f,
e,c,a)}))}_setSharedUniforms(f,e,a){const {displayLevel:b,pixelRatio:c,state:m,passOptions:d}=e;null!=d&&"hittest"===d.type&&(f.setUniform2fv("u_hittestPos",d.position),f.setUniform1f("u_hittestDist",d.distance));f.setUniform1f("u_pixelRatio",c);f.setUniformMatrix3fv("u_tileMat3",a.transforms.tileMat3);f.setUniformMatrix3fv("u_viewMat3",m.viewMat3);f.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);f.setUniformMatrix3fv("u_displayViewMat3",m.displayViewMat3);f.setUniform1f("u_currentZoom",Math.floor(b*
h.minMaxZoomPrecisionFactor));f.setUniform1i("u_attributeTextureSize",e.attributeView.size);f.setUniform1i("u_attributeData0",h.textureBindingAttributeData0);f.setUniform1i("u_attributeData1",h.textureBindingAttributeData1);f.setUniform1i("u_attributeData2",h.textureBindingAttributeData2);f.setUniform1i("u_attributeData3",h.textureBindingAttributeData3);f.setUniform1i("u_attributeData4",h.textureBindingAttributeData4);f.setUniform1i("u_attributeData5",h.textureBindingAttributeData5)}_setSizeVVUniforms(f,
e,a,b){f.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",a.vvSizeMinMaxValue);f.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",a.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(b=a.getSizeVVFieldStops(b.key.level),null!=b&&(e.setUniform1fv("u_vvSizeFieldStopsValues",b.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",b.sizes)));f.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",a.vvSizeUnitValueToPixelsRatio)}_setColorAndOpacityVVUniforms(f,e,a){f.vvColor&&(e.setUniform1fv("u_vvColorValues",
a.vvColorValues),e.setUniform4fv("u_vvColors",a.vvColors));f.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",a.vvOpacityValues),e.setUniform1fv("u_vvOpacities",a.vvOpacities))}_setRotationVVUniforms(f,e,a){f.vvRotation&&e.setUniform1f("u_vvRotationType","geographic"===a.vvMaterialParameters.vvRotationType?0:1)}_getTriangleDesc(f,e,a=["a_pos"]){const b=e.bufferLayouts.geometry;a=a.map(d=>b.findIndex(k=>k.name===d));f=`${f}-${a.join("-")}`;var c=this._computeDesc.get(f);if(!c){c=e.strides;const d=e.strides.geometry,
k=new Map(e.attributes);var m=b.map(r=>({...r}));e=Math.max(...e.attributes.values());m={geometry:m};let l=0;for(const r of a)a=b[r],m.geometry.push({count:a.count,name:a.name+"1",divisor:a.divisor,normalized:a.normalized,offset:d+a.offset,stride:d,type:a.type}),m.geometry.push({count:a.count,name:a.name+"2",divisor:a.divisor,normalized:a.normalized,offset:2*d+a.offset,stride:d,type:a.type}),k.set(a.name+"1",e+ ++l),k.set(a.name+"2",e+ ++l);c={bufferLayouts:m,attributes:k,strides:c};this._computeDesc.set(f,
c)}return c}}return p})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define(["exports","../../../../../core/Error","../alignmentUtils","../enums"],function(h,g,v,n){function p(x){return x===n.WGLSymbologyType.SIMPLE||x===n.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function f(x){return x===n.WGLSymbologyType.OUTLINE_FILL||x===n.WGLSymbologyType.OUTLINE_FILL_SIMPLE}const e=Object.keys(n.WGLSymbologyType).filter(x=>"number"===typeof n.WGLSymbologyType[x]).reduce((x,z)=>({...x,[z]:n.WGLSymbologyType[z]}),
{});class a{static load(x){const z=this.shared;z.data=x;return z}constructor(x){this._data=0;this._data=x}set data(x){this._data=x??0}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(x){this.setBits(x,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(x){this.setBit(20,x)}get sdf(){return!!this.bit(11)}set sdf(x){this.setBit(11,x??!1)}get pattern(){return!!this.bit(12)}set pattern(x){this.setBit(12,x)}get textureBinding(){return this.bits(0,8)}set textureBinding(x){this.setBits(x,
0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(x){this.setBits(x,21,26)}get geometryTypeString(){switch(this.geometryType){case n.WGLGeometryType.FILL:return"fill";case n.WGLGeometryType.MARKER:return"marker";case n.WGLGeometryType.LINE:return"line";case n.WGLGeometryType.TEXT:return"text";case n.WGLGeometryType.LABEL:return"label";default:throw new g(`Unable to handle unknown geometryType: ${this.geometryType}`);}}setBit(x,z){x=1<<x;this._data=z?this._data|x:this._data&~x}bit(x){return(this._data&
1<<x)>>x}setBits(x,z,q){for(let t=z,B=0;t<q;t++,B++)this.setBit(t,0!==(x&1<<B))}bits(x,z){let q=0;for(let t=x,B=0;t<z;t++,B++)q|=this.bit(t)<<B;return q}hasVV(){return!1}setVV(x,z){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:n.WGLSymbologyType[this.symbologyType],options:e,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}}a.shared=new a(0);const b=x=>class extends x{get vvSizeMinMaxValue(){return 0!==
this.bit(16)}set vvSizeMinMaxValue(z){this.setBit(16,z)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(z){this.setBit(17,z)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(z){this.setBit(18,z)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(z){this.setBit(19,z)}hasSizeVV(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}hasVV(){return super.hasVV()||this.hasSizeVV()}setVV(z,q){super.setVV(z,
q);{var t=this.geometryType;const B=n.WGLVVFlag.SIZE_FIELD_STOPS|n.WGLVVFlag.SIZE_MINMAX_VALUE|n.WGLVVFlag.SIZE_SCALE_STOPS|n.WGLVVFlag.SIZE_UNIT_VALUE,y=(z&(n.WGLVVTarget.FIELD_TARGETS_OUTLINE|n.WGLVVTarget.MINMAX_TARGETS_OUTLINE|n.WGLVVTarget.SCALE_TARGETS_OUTLINE|n.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;q=t===n.WGLGeometryType.LINE&&q.isOutline||t===n.WGLGeometryType.FILL&&f(q.symbologyType)?B&y:B&~y}z&=q;this.vvSizeMinMaxValue=!!(z&n.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(z&n.WGLVVFlag.SIZE_FIELD_STOPS);
this.vvSizeUnitValue=!!(z&n.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(z&n.WGLVVFlag.SIZE_SCALE_STOPS)}},c=x=>class extends x{get vvRotation(){return 0!==this.bit(15)}set vvRotation(z){this.setBit(15,z)}hasVV(){return super.hasVV()||this.vvRotation}setVV(z,q){super.setVV(z,q);this.vvRotation=!q.isOutline&&!!(z&n.WGLVVFlag.ROTATION)}},m=x=>class extends x{get vvColor(){return 0!==this.bit(13)}set vvColor(z){this.setBit(13,z)}hasVV(){return super.hasVV()||this.vvColor}setVV(z,q){super.setVV(z,
q);this.vvColor=!q.isOutline&&!!(z&n.WGLVVFlag.COLOR)}},d=x=>class extends x{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(z){this.setBit(14,z)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(z,q){super.setVV(z,q);this.vvOpacity=!q.isOutline&&!!(z&n.WGLVVFlag.OPACITY)}};class k extends m(d(b(a))){static load(x){const z=this.shared;z.data=x;return z}static from(x){const {symbologyType:z,vvFlags:q}=x,t=this.load(0);t.geometryType=n.WGLGeometryType.FILL;t.symbologyType=z;z!==n.WGLSymbologyType.DOT_DENSITY&&
t.setVV(q,x);return t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}k.shared=new k(0);class l extends m(d(c(b(a)))){static load(x){const z=this.shared;z.data=x;return z}static from(x){const {symbologyType:z,vvFlags:q}=x,t=this.load(0);t.geometryType=n.WGLGeometryType.MARKER;t.symbologyType=z;
z!==n.WGLSymbologyType.HEATMAP&&t.setVV(q,x);return t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}l.shared=new l(0);class r extends m(d(b(a))){static load(x){const z=this.shared;z.data=x;return z}static from(x){const z=this.load(0);z.geometryType=n.WGLGeometryType.LINE;
z.symbologyType=x.symbologyType;z.setVV(x.vvFlags,x);return z.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}r.shared=new r(0);class u extends m(d(c(b(a)))){static load(x){const z=this.shared;z.data=x;return z}static from(x){const z=this.load(0);z.geometryType=n.WGLGeometryType.TEXT;z.symbologyType=
x.symbologyType;z.setVV(x.vvFlags,x);return z.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}u.shared=new u(0);class w extends b(a){static load(x){const z=this.shared;z.data=x;return z}static from(x){const z=this.load(0);z.geometryType=n.WGLGeometryType.LABEL;z.symbologyType=
x.symbologyType;z.setVV(x.vvFlags,x);z.mapAligned=v.isMapAligned(x.placement);return z.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0);h.FillMaterialKey=k;h.LabelMaterialKey=w;h.LineMaterialKey=r;h.MarkerMaterialKey=l;h.MaterialKeyBase=a;h.TextMaterialKey=u;h.createMaterialKey=function(x,z){switch(x){case n.WGLGeometryType.FILL:return k.from(z);
case n.WGLGeometryType.LINE:return r.from(z);case n.WGLGeometryType.MARKER:return l.from(z);case n.WGLGeometryType.TEXT:return u.from(z);case n.WGLGeometryType.LABEL:return w.from(z);default:throw Error(`Unable to createMaterialKey for unknown geometryType ${x}`);}};h.hasOutlineFillSymbology=function(x){return f(x.symbologyType)};h.hasSimpleSymbology=function(x){return p(x.symbologyType)};h.hydrateMaterialKey=function(x){switch(a.load(x).geometryType){case n.WGLGeometryType.MARKER:return new l(x);
case n.WGLGeometryType.FILL:return new k(x);case n.WGLGeometryType.LINE:return new r(x);case n.WGLGeometryType.TEXT:return new u(x);case n.WGLGeometryType.LABEL:return new w(x)}};h.isOutlineFillSymbology=f;h.isSimpleSymbology=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports"],function(h){h.HAlign=void 0;(function(g){g[g.Left=-1]="Left";g[g.Center=0]="Center";g[g.Right=1]="Right"})(h.HAlign||(h.HAlign={}));h.VAlign=
void 0;(function(g){g[g.Top=1]="Top";g[g.Center=0]="Center";g[g.Bottom=-1]="Bottom";g[g.Baseline=2]="Baseline"})(h.VAlign||(h.VAlign={}));h.getAlignmentFromPlacement=function(g){switch(g){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return[h.HAlign.Right,h.VAlign.Bottom];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return[h.HAlign.Center,h.VAlign.Bottom];case "above-right":case "esriServerPointLabelPlacementAboveRight":return[h.HAlign.Left,
h.VAlign.Bottom];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return[h.HAlign.Right,h.VAlign.Center];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return[h.HAlign.Center,h.VAlign.Center];case "center-right":case "esriServerPointLabelPlacementCenterRight":return[h.HAlign.Left,h.VAlign.Center];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return[h.HAlign.Right,h.VAlign.Top];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return[h.HAlign.Center,
h.VAlign.Top];case "below-right":case "esriServerPointLabelPlacementBelowRight":return[h.HAlign.Left,h.VAlign.Top];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return[h.HAlign.Center,h.VAlign.Center];default:return console.debug(`Found invalid placement type ${g}`),[h.HAlign.Center,h.VAlign.Center]}};h.getJustification=function(g){switch(g){case "left":return h.HAlign.Left;case "right":return h.HAlign.Right;case "center":return h.HAlign.Center}};h.getXAnchorDirection=
function(g){switch(g){case "left":return h.HAlign.Left;case "right":return h.HAlign.Right;case "center":return h.HAlign.Center}};h.getXDirection=function(g){switch(g){case h.HAlign.Right:return-1;case h.HAlign.Center:return 0;case h.HAlign.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${g}`),0}};h.getYAnchorDirection=function(g){switch(g){case "top":return h.VAlign.Top;case "middle":return h.VAlign.Center;case "baseline":return h.VAlign.Baseline;case "bottom":return h.VAlign.Bottom}};
h.getYDirection=function(g){switch(g){case h.VAlign.Top:return 1;case h.VAlign.Center:return 0;case h.VAlign.Bottom:case h.VAlign.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${g}`),0}};h.isMapAligned=function(g){switch(g){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;default:return!1}};Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/utils":function(){define("exports ../../../../../core/Error ../enums ../materialKey/MaterialKey ./Technique ./dotDensity/TechniqueDotDensity ./heatmap/TechniqueHeatmap ./pieChart/TechniquePieChart".split(" "),function(h,g,v,n,p,f,e,a){h.assertRendererSchema=function(b,c){if(b.type!==c)throw new g("material-view-model:unexpected-renderer-schema",`expected to find renderer schema of type "${c}" but found type "${b.type}"`);};h.getTechniqueFromMaterialKey=
function(b){const {geometryType:c,symbologyType:m}=n.MaterialKeyBase.load(b);switch(c){case v.WGLGeometryType.FILL:switch(m){case v.WGLSymbologyType.DOT_DENSITY:return f.DotDensityTechnique}break;case v.WGLGeometryType.MARKER:switch(m){case v.WGLSymbologyType.HEATMAP:return e.HeatmapTechnique;case v.WGLSymbologyType.PIE_CHART:return a.PieChartTechnique}}return p.Technique};h.getTechniqueFromRenderer=function(b){switch(b?.type){case "dot-density":return f.DotDensityTechnique;case "heatmap":return e.HeatmapTechnique;
case "pie-chart":return a.PieChartTechnique;default:return p.Technique}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/Technique":function(){define(["exports"],function(h){class g{static getStorageSpec(v){return null}static createOrUpdateRendererSchema(v,n){return null!=v&&"default"===v.type?v:{type:"default"}}static getVariation(v){return{}}static getVariationHash(v){return 0}}g.type="default";g.programSpec=null;h.Technique=g;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/dotDensity/TechniqueDotDensity":function(){define(["exports","../../color","../../definitions","../Technique","../../../../../webgl/enums"],function(h,g,v,n,p){class f extends n.Technique{static getStorageSpec({attributes:e}){return{visualVariables:!1,attributes:e??null}}static _createRendererSchema(){return{type:"dot-density",colors:new Float32Array(32),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),
activeDots:new Float32Array(8),seed:-1}}static createOrUpdateRendererSchema(e,a){const {attributes:b,dotValue:c,referenceScale:m,dotSize:d,dotBlendingEnabled:k,seed:l,backgroundColor:r}=a;e=null!=e&&"dot-density"===e.type?e:this._createRendererSchema();e.dotValue=c;e.dotSize=d;e.dotScale=m;e.dotBlending=k;e.seed=l;const {colors:u,activeDots:w,backgroundColor:x}=e;for(var z=0;z<v.dotDensityMaxFields;z++)g.writeColor(u,z>=b.length?null:b[z].color,4*z);for(z=0;8>z;z++)w[z]=z<a.attributes.length?1:0;
g.writeColor(x,r);return e}static getVariation(e){return{ddDotBlending:e.dotBlending}}static getVariationHash(e){return e.dotBlending?1:0}}f.type="dot-density";f.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:p.DataType.SHORT},{location:1,name:"a_id",count:3,type:p.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:p.DataType.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:p.DataType.FLOAT}]}};h.DotDensityTechnique=f;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(h,g){h.premultiplyAlpha=function(v,n=0,p=!1){const f=v[n+3];v[n]*=f;v[n+1]*=f;v[n+2]*=f;p||(v[n+3]*=255);return v};h.premultiplyAlphaRGBA=function(v){if(!v)return 0;const {r:n,g:p,b:f,a:e}=v;return g.i8888to32(n*e,p*e,f*e,255*e)};h.premultiplyAlphaRGBAArray=function(v){if(!v)return 0;const [n,p,f,e]=v;return g.i8888to32(e/255*n,e/255*p,e/255*f,e)};h.writeColor=function(v,n,
p=0){if(null==n)v[p]=0,v[p+1]=0,v[p+2]=0,v[p+3]=0;else{var {r:f,g:e,b:a,a:b}=n;v[p]=f*b/255;v[p+1]=e*b/255;v[p+2]=a*b/255;v[p+3]=b}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(h){function g(p,f,e){return Math.round(Math.max(Math.min(p,e),f))}const v=new Float32Array(1),n=new Uint32Array(v.buffer);h.i16=function(p){return g(p,-32768,32767)};h.i1616to32=function(p,f){return 65535&p|f<<16};h.i32=function(p){return g(p,
-2147483648,2147483647)};h.i8=function(p){return g(p,-128,127)};h.i8816to32=function(p,f,e){return p&255|(f&255)<<8|e<<16};h.i8888to32=function(p,f,e,a){return p&255|(f&255)<<8|(e&255)<<16|a<<24};h.numTo32=function(p){return p|0};h.toFloat32=function(p){n[0]=p;return v[0]};h.toUint32=function(p){v[0]=p;return n[0]};h.u16=function(p){return g(p,0,65535)};h.u32=function(p){return g(p,0,4294967295)};h.u32to4Xu8=function(p){return[p&255,(p&65280)>>>8,(p&16711680)>>>16,(p&4278190080)>>>24]};h.u4u4to8=
function(p,f){return 15&p|(15&f)<<4};h.u8=function(p){return g(p,0,255)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/heatmap/TechniqueHeatmap":function(){define(["exports","../../../../../../core/screenUtils","../../../../../../renderers/support/heatmapUtils","../Technique","../../../../../webgl/enums"],function(h,g,v,n,p){class f extends n.Technique{static getStorageSpec({field:e,valueExpression:a}){return{visualVariables:!1,attributes:e||
a?[{field:e,valueExpression:a}]:null}}static _createRendererSchema(){return{type:"heatmap",radius:-1,referenceScale:-1,isFieldActive:0,minDensity:-1,densityRange:-1,kernel:null,gradient:null,gradientHash:"invalid"}}static createOrUpdateRendererSchema(e,a){const {radius:b,minDensity:c,maxDensity:m,referenceScale:d,field:k,valueExpression:l,colorStops:r}=a;a=m-c;const u=k||l?1:0,w=r.map(({color:q,ratio:t})=>`${t}:${q.toString()}`).join();let x=!0,z;null!=e&&"heatmap"===e.type?(z=e,x=w!==e.gradientHash):
z=this._createRendererSchema();z.radius=g.pt2px(b);z.minDensity=c;z.densityRange=a;z.referenceScale=d;z.isFieldActive=u;x&&(z.gradient=v.generateGradient(r),z.gradientHash=w);return z}}f.type="heatmap";f.programSpec={shader:"materials/icon/heatmapAccumulate",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:p.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:p.DataType.SHORT},{location:4,name:"a_id",count:4,type:p.DataType.UNSIGNED_BYTE}]}};h.HeatmapTechnique=f;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/pieChart/TechniquePieChart":function(){define("exports ../../../../../../Color ../../../../../../core/screenUtils ../../color ../../definitions ../Technique ../../../../../webgl/enums".split(" "),function(h,g,v,n,p,f,e){class a extends f.Technique{static getStorageSpec({attributes:b}){return{visualVariables:!0,attributes:b??null}}static _createRendererSchema(){return{type:"pie-chart",colors:new Float32Array(4*p.chartMaxFields),
defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}}static createOrUpdateRendererSchema(b,c){const {attributes:m,defaultColor:d,holePercentage:k,othersCategory:l,outline:r}=c;b=null!=b&&"pie-chart"===b.type?b:this._createRendererSchema();for(c=0;c<p.chartMaxFields;c++){const u=c>=m.length?new g([0,0,0,0]):m[c].color;n.writeColor(b.colors,u,4*c)}n.writeColor(b.defaultColor,d);n.writeColor(b.othersColor,
l?.color);n.writeColor(b.outlineColor,r?.color);b.outlineWidth=v.pt2px(r?.width||0);b.holePercentage=k;b.sectorThreshold=l?.threshold||0;b.numberOfFields=m.length;return b}static getVariation(b){return{numberOfFields:b.numberOfFields}}static getVariationHash(b){return b.numberOfFields}}a.type="pie-chart";a.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:e.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:e.DataType.SHORT},{location:2,
name:"a_texCoords",count:2,type:e.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:e.DataType.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:e.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:e.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:e.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:e.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:e.DataType.UNSIGNED_SHORT}]},
hittestAttributes:["a_vertexOffset","a_texCoords"]};h.PieChartTechnique=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushHeatmap":function(){define("../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ./WGLGeometryBrushMarker ../effects/Effect ../techniques/utils ../../../../webgl/contextUtils ../../../../webgl/enums ../../../../webgl/FramebufferObject ../../../../webgl/heatmapTextureUtils ../../../../webgl/Renderbuffer ../../../../webgl/RenderbufferDescriptor ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r){function u(t,B){const {referenceScale:y,radius:E}=t;return E*(0!==y?y/B.scale:1)}const w=h.getLogger("esri.views.2d.engine.webgl.brushes.WGLBrushHeatmap");class x extends p{constructor(){super(...arguments);this.brushEffect=new q}supportsSymbology(t){return t===v.WGLSymbologyType.HEATMAP}dispose(){super.dispose();this.brushEffect.dispose();this.brushEffect=null}prepareState(){}drawGeometry(t,B,y,E){const {defines:F}=this.brushEffect.loadQualityProfile(t.context);
super.drawGeometry(t,B,y,E?[...E,...F]:F)}_drawMarkers(t,B,y,E,F,C,A){const {context:D,rendererInfo:G,state:J}=t;({rendererSchema:t}=G);e.assertRendererSchema(t,"heatmap");const {isFieldActive:M}=t;y.setUniform1f("u_radius",u(t,J));A||(y.setUniform1f("u_isFieldActive",M),D.setStencilFunction(b.CompareFunction.GEQUAL,B.stencilRef,255));D.drawElements(E,F,b.DataType.UNSIGNED_INT,C)}}const z={vsPath:"heatmap/heatmapResolve",fsPath:"heatmap/heatmapResolve",attributes:new Map([["a_position",0]])};class q extends f.Effect{constructor(){super(...arguments);
this.name=this.constructor.name}createOptions({passOptions:t}){return t}dispose(){this._prevFBO=null;null!=this._accumulateFramebuffer&&this._accumulateFramebuffer.detachDepthStencilBuffer();this._accumulateOutputStencilBuffer=g.disposeMaybe(this._accumulateOutputStencilBuffer);this._accumulateFramebuffer=g.disposeMaybe(this._accumulateFramebuffer);this._resolveGradientTexture=g.disposeMaybe(this._resolveGradientTexture);this._tileQuad=g.disposeMaybe(this._tileQuad)}bind(t){const {context:B,rendererInfo:y,
passOptions:E,state:F}=t,{rendererSchema:C}=y;null!=E&&"hittest"===E.type||"heatmap"!==C.type||(this._prevFBO=B.getBoundFramebufferObject(),this._prevViewport=B.getViewport(),e.assertRendererSchema(C,"heatmap"),this._loadResources(t),this._updateResources(B,C,F),B.bindFramebuffer(this._accumulateFramebuffer),B.setViewport(0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height),B.setStencilTestEnabled(!0),B.setBlendingEnabled(!0),B.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE),
B.setClearColor(0,0,0,0),B.clear(b.ClearBufferBit.COLOR_BUFFER_BIT))}unbind(){this._prevViewport=this._prevFBO=null}draw(t){const {context:B,painter:y,rendererInfo:E,passOptions:F}=t;({rendererSchema:t}=E);if((null==F||"hittest"!==F.type)&&"heatmap"===t.type){var {defines:C}=this.loadQualityProfile(B);C=y.materialManager.getProgram(z,C);B.useProgram(C);B.bindFramebuffer(this._prevFBO);B.setViewport(0,0,this._prevViewport.width,this._prevViewport.height);B.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA);
B.setStencilTestEnabled(!1);var {radius:A,minDensity:D,densityRange:G}=t;B.bindTexture(this._accumulateFramebuffer.colorTexture,8);B.bindTexture(this._resolveGradientTexture,9);C.setUniform1i("u_texture",8);C.setUniform1i("u_gradient",9);C.setUniform2f("u_densityMinAndInvRange",D,1/G);C.setUniform1f("u_densityNormalization",3/(A*A*Math.PI));this._tileQuad.draw()}}_loadResources({context:t,painter:B}){const {dataType:y,samplingMode:E,pixelFormat:F,internalFormat:C,requiresSharedStencilBuffer:A}=this.loadQualityProfile(t),
{width:D,height:G}=this._prevViewport;var J=A?1:.25;const M=D*J;J*=G;let L=new r.TextureDescriptor(M,J);L.pixelFormat=F;L.internalFormat=C;L.dataType=y;L.samplingMode=E;L.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;A||(this._accumulateOutputStencilBuffer??(this._accumulateOutputStencilBuffer=new d.Renderbuffer(t,new k.RenderbufferDescriptor(b.RenderbufferFormat.DEPTH_STENCIL,M,J))));this._accumulateFramebuffer??(this._accumulateFramebuffer=new c.FramebufferObject(t,L,A?B.getSharedStencilBuffer():this._accumulateOutputStencilBuffer));
L=new r.TextureDescriptor;L.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;this._resolveGradientTexture??(this._resolveGradientTexture=new l.Texture(t,L));this._tileQuad??(this._tileQuad=new n(t,[0,0,1,0,0,1,1,1]))}_updateResources(t,B,y){const {gradientHash:E,gradient:F}=B;this._prevGradientHash!==E&&(this._resolveGradientTexture.resize(F.length/4,1),this._resolveGradientTexture.setData(F),this._prevGradientHash=E);const {requiresSharedStencilBuffer:C}=this.loadQualityProfile(t);y=C?1:2>u(B,y)?1:.25;const {width:A,
height:D}=this._prevViewport;B=A*y;y*=D;const {width:G,height:J}=this._accumulateFramebuffer;if(G!==B||J!==y){const M=this._accumulateFramebuffer.depthStencil;if(C&&null!=M){const {width:L,height:Q}=M.descriptor;if(L!==B||Q!==y)w.errorOnce("Attempted to resize shared stencil buffer! Detaching instead."),this._accumulateFramebuffer.detachDepthStencilBuffer()}this._accumulateFramebuffer.resize(B,y)}C||t.blitFramebuffer(this._prevFBO,this._accumulateFramebuffer,0,0,this._prevFBO.width,this._prevFBO.height,
0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height,b.ClearBufferBit.STENCIL_BUFFER_BIT,b.TextureSamplingMode.NEAREST)}loadQualityProfile(t){if(null==this._qualityProfile){const B=m.loadHeatmapTextureConfiguration(t,w);this._qualityProfile={...B,requiresSharedStencilBuffer:t.type===a.ContextType.WEBGL1,defines:B.dataType!==b.PixelType.FLOAT?["heatmapPrecisionHalfFloat"]:[]}}return this._qualityProfile}}return x})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../techniques/utils ../../../../webgl/enums".split(" "),
function(h,g,v,n,p,f){const e={shader:"materials/icon",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:f.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:f.DataType.SHORT},{location:2,name:"a_texCoords",count:2,type:f.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:f.DataType.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:f.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:f.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,
name:"a_outlineColor",count:4,type:f.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:f.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:f.DataType.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};class a extends v{dispose(){}getGeometryType(){return h.WGLGeometryType.MARKER}supportsSymbology(b){return b!==h.WGLSymbologyType.HEATMAP&&b!==h.WGLSymbologyType.PIE_CHART}drawGeometry(b,c,m,d){const {context:k,painter:l,
rendererInfo:r,state:u,passOptions:w,requestRender:x,allowDelayedRender:z}=b;var q=n.MarkerMaterialKey.load(m.materialKey),t=p.getTechniqueFromMaterialKey(q.data);const B=null!=w&&"hittest"===w.type,{shader:y,vertexLayout:E,hittestAttributes:F}=t.programSpec??e;t=f.PrimitiveType.TRIANGLES;var C=g.createProgramDescriptor(q.data,E);B&&(C=this._getTriangleDesc(m.materialKey,C,F),t=f.PrimitiveType.POINTS);const {attributes:A,bufferLayouts:D}=C;d=l.materialManager.getMaterialProgram(b,q,y,A,d);z&&null!=
x&&!d.compiled?x():(k.useProgram(d),q.textureBinding&&l.textureManager.bindTextures(k,d,q,!0),this._setSharedUniforms(d,b,c),d.setUniformMatrix3fv("u_displayMat3",q.vvRotation?u.displayViewMat3:u.displayMat3),this._setSizeVVUniforms(q,d,r,c),this._setColorAndOpacityVVUniforms(q,d,r),this._setRotationVVUniforms(q,d,r),q=m.target.getVAO(k,D,A,B),C=m.indexCount,m=m.indexFrom*Uint32Array.BYTES_PER_ELEMENT,B&&(C/=3,m/=3),k.bindVAO(q),this._drawMarkers(b,c,d,t,C,m,B),k.bindVAO(null))}_drawMarkers(b,c,m,
d,k,l,r){b.context.drawElements(d,k,f.DataType.UNSIGNED_INT,l)}}return a})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports"],function(h){class g{constructor(){this.name=this.constructor.name}createOptions(v,n){return null}}h.Effect=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(h,g,v){class n{constructor(p,f,e,a){this.dataType=p;this.samplingMode=f;
this.pixelFormat=e;this.internalFormat=a}}h.HeatmapTextureConfiguration=n;h.loadHeatmapTextureConfiguration=function(p,f){const {textureFloat:e,colorBufferFloat:a}=p.capabilities,b=e?.textureFloat,c=e?.textureFloatLinear;var m=e?.textureHalfFloat;const d=e?.textureHalfFloatLinear,k=a?.textureFloat;var l=a?.textureHalfFloat;const r=a?.floatBlend;p=p.driverTest.floatBufferBlend.result;if(!b&&!m)throw new g("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");
if(!k&&!l)throw new g("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(r&&p||l))throw new g("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${p?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);m=m&&l;l=!!a?.R32F;const u=!!a?.R16F;if(b&&k&&r&&p&&(c||!d))return c||
f.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new n(v.PixelType.FLOAT,c?v.TextureSamplingMode.LINEAR:v.TextureSamplingMode.NEAREST,l?v.PixelFormat.RED:v.PixelFormat.RGBA,l?v.SizedPixelFormat.R32F:v.PixelFormat.RGBA);if(m)return d||f.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),new n(v.PixelType.HALF_FLOAT,d?v.TextureSamplingMode.LINEAR:v.TextureSamplingMode.NEAREST,u?v.PixelFormat.RED:v.PixelFormat.RGBA,
u?v.SizedPixelFormat.R16F:v.PixelFormat.RGBA);throw new g("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("../../../../../chunks/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/capabilities/isWebGL2Context".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d){class k extends v{constructor(){super(...arguments);this._color=h.fromValues(1,0,0,1)}dispose(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._canvas=this._tileInfoVertexArrayObject=null}prepareState({context:l}){l.setBlendingEnabled(!0);l.setBlendFunctionSeparate(e.BlendFactor.ONE,
e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);l.setColorMask(!0,!0,!0,!0);l.setStencilWriteMask(0);l.setStencilTestEnabled(!1)}draw(l,r){const {context:u,requestRender:w,allowDelayedRender:x}=l;if(r.isReady)if(this._loadWGLResources(u),!x||null==w||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){u.bindVAO(this._outlineVertexArrayObject);u.useProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);
this._outlineProgram.setUniform2f("u_coord_range",r.rangeX,r.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);u.drawArrays(e.PrimitiveType.LINE_STRIP,0,4);if(l=this._getTexture(u,r))u.bindVAO(this._tileInfoVertexArrayObject),u.useProgram(this._tileInfoProgram),u.bindTexture(l,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",
r.rangeX/r.width,r.rangeY/r.height),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",l.descriptor.width,l.descriptor.height),u.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,4);u.bindVAO()}else w()}_loadWGLResources(l){if(!this._outlineProgram||!this._tileInfoProgram){var r=a.createProgram(l,n.background),u=a.createProgram(l,p.tileInfo),w=new Int8Array([0,0,1,0,1,1,0,1]);w=f.BufferObject.createVertex(l,e.Usage.STATIC_DRAW,w);w=new m.VertexArrayObject(l,
n.background.attributes,g.Pos2b,{geometry:w});var x=new Int8Array([0,0,1,0,0,1,1,1]);x=f.BufferObject.createVertex(l,e.Usage.STATIC_DRAW,x);l=new m.VertexArrayObject(l,p.tileInfo.attributes,g.Pos2b,{geometry:x});this._outlineProgram=r;this._tileInfoProgram=u;this._outlineVertexArrayObject=w;this._tileInfoVertexArrayObject=l}}_getTexture(l,r){if(r.texture&&r.triangleCountReportedInDebug===r.triangleCount)return r.texture;r.triangleCountReportedInDebug=r.triangleCount;this._canvas||(this._canvas=document.createElement("canvas"),
this._canvas.setAttribute("id","tileCanvas2d"),this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var u=r.triangleCount;let w=r.key.id;0<r.triangleCount&&(w+=`, ${u}`);const x=this._canvas,z=x.getContext("2d");z.font="24px sans-serif";z.textAlign="left";z.textBaseline="top";z.clearRect(0,0,300,32);1E5<u?(z.fillStyle="red",z.fillRect(0,0,300,32),z.fillStyle="black"):(z.clearRect(0,0,300,32),z.fillStyle="blue");z.fillText(w,
0,0);u=new c.TextureDescriptor;u.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;u.samplingMode=e.TextureSamplingMode.NEAREST;u.isImmutable=d(l.gl);r.texture=new b.Texture(l,u,x);return r.texture}}return k})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(h,g,v){const n={geometry:[new v.VertexElementDescriptor("a_pos",2,g.DataType.BYTE,0,2)]},p={geometry:[new v.VertexElementDescriptor("a_pos",
2,g.DataType.BYTE,0,4),new v.VertexElementDescriptor("a_tex",2,g.DataType.BYTE,2,4)]};g={geometry:[new v.VertexElementDescriptor("a_pos",2,g.DataType.UNSIGNED_SHORT,0,4)]};h.Pos2b=n;h.Pos2us=g;h.PosTex2b=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports","./sources/resolver"],function(h,g){g={shaders:{vertexShader:g.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:g.resolveIncludes("tileInfo/tileInfo.frag")},
attributes:new Map([["a_pos",0]])};h.tileInfo=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(h){return window.WebGL2RenderingContext&&h instanceof window.WebGL2RenderingContext}})},"esri/views/2d/engine/webgl/brushes/WGLBrushPieChart":function(){define(["../enums","./WGLGeometryBrushMarker","../techniques/utils","../../../../webgl/enums"],function(h,g,v,n){class p extends g{supportsSymbology(f){return f===
h.WGLSymbologyType.PIE_CHART}_drawMarkers(f,e,a,b,c,m,d){({context:e}=f);({rendererInfo:f}=f);({rendererSchema:f}=f);v.assertRendererSchema(f,"pie-chart");a.setUniform4fv("u_colors",f.colors);a.setUniform4fv("u_defaultColor",f.defaultColor);a.setUniform4fv("u_othersColor",f.othersColor);a.setUniform4fv("u_outlineColor",f.outlineColor);a.setUniform1f("u_donutRatio",f.holePercentage);a.setUniform1f("u_sectorThreshold",f.sectorThreshold);a.setUniform1f("u_outlineWidth",f.outlineWidth);e.drawElements(b,
c,n.DataType.UNSIGNED_INT,m)}}return p})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("../../../../../chunks/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/VertexArrayObject".split(" "),function(h,g,v,n,p,f,e,a){class b extends v{constructor(){super(...arguments);this._color=h.fromValues(1,0,0,1);this._initialized=!1}dispose(){this._solidProgram&&
(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:c}){c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(f.StencilOperation.KEEP,f.StencilOperation.KEEP,f.StencilOperation.REPLACE);c.setStencilWriteMask(255)}draw(c,m){const {context:d,requestRender:k,allowDelayedRender:l}=
c;this._initialized||this._initialize(d);l&&null!=k&&!this._solidProgram.compiled?k():(d.setStencilFunctionSeparate(f.Face.FRONT_AND_BACK,f.CompareFunction.GREATER,m.stencilRef,255),d.bindVAO(this._solidVertexArrayObject),d.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",m.transforms.dvs),this._solidProgram.setUniform2fv("u_coord_range",[m.rangeX,m.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),d.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,
0,4),d.bindVAO())}_initialize(c){if(this._initialized)return!0;const m=e.createProgram(c,n.background);if(!m)return!1;var d=new Int8Array([0,0,1,0,0,1,1,1]);d=p.BufferObject.createVertex(c,f.Usage.STATIC_DRAW,d);c=new a.VertexArrayObject(c,n.background.attributes,g.Pos2b,{geometry:d});this._solidProgram=m;this._solidVertexArrayObject=c;return this._initialized=!0}}return b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){class d extends a{constructor(){super(...arguments);this._color=n.fromValues(1,0,0,1);this._patternMatrix=v.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(k,l){const {context:r,painter:u,styleLayerUID:w,requestRender:x,allowDelayedRender:z}=k;this._loadWGLResources(k);const q=k.displayLevel;var t=k.styleLayer,B=t.backgroundMaterial;const y=u.vectorTilesMaterialManager;var E=t.getPaintValue("background-color",
q);const F=t.getPaintValue("background-opacity",q),C=t.getPaintValue("background-pattern",q),A=void 0!==C,D=E[3]*F,G=k.spriteMosaic;let J,M;const L=(window.devicePixelRatio|1)>p.vtlHighResCutoff?2:1;k=k.drawPhase===f.WGLDrawPhase.HITTEST;const Q=this._programOptions;Q.id=k;Q.pattern=A;B=y.getMaterialProgram(r,B,Q);if(z&&null!=x&&!B.compiled)x();else{r.bindVAO(this._vao);r.useProgram(B);if(A){E=G.getMosaicItemPosition(C,!0);if(null!=E){const {tl:N,br:U,page:Z}=E;J=U[0]-N[0];M=U[1]-N[1];E=G.getPageSize(Z);
null!=E&&(G.bind(r,c.TextureSamplingMode.LINEAR,Z,p.vtlTextureBindingUnitSprites),B.setUniform4f("u_tlbr",N[0],N[1],U[0],U[1]),B.setUniform2fv("u_mosaicSize",E),B.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites))}B.setUniform1f("u_opacity",F)}else this._color[0]=D*E[0],this._color[1]=D*E[1],this._color[2]=D*E[2],this._color[3]=D,B.setUniform4fv("u_color",this._color);B.setUniform1f("u_depth",t.z||0);k&&(t=e.u32to4Xu8(w+1),B.setUniform4fv("u_id",t));for(const N of l)B.setUniform1f("u_coord_range",
N.rangeX),B.setUniformMatrix3fv("u_dvsMat3",N.transforms.dvs),A&&(t=L*N.width*Math.max(2**(Math.round(q)-N.key.level),1),l=t/g.nextPowerOfTwo(J),t/=g.nextPowerOfTwo(M),this._patternMatrix[0]=l,this._patternMatrix[4]=t,B.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),r.setStencilFunction(c.CompareFunction.EQUAL,0,255),r.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(k){if(!this._vao){var {context:l,styleLayer:r}=k;k=r.backgroundMaterial;var u=new Int8Array([0,0,1,0,
0,1,1,1]);u=b.BufferObject.createVertex(l,c.Usage.STATIC_DRAW,u);this._vao=new m.VertexArrayObject(l,k.getAttributeLocations(),k.getLayoutInfo(),{geometry:u})}}}h.WGLBrushVTLBackground=d;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("exports ../../vectorTiles/style/StyleDefinition ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(h,g,v,n,p,f){class e extends p{constructor(){super(...arguments);
this._programOptions={id:!1}}dispose(){}drawMany(a,b){const {context:c,displayLevel:m,requiredLevel:d,state:k,drawPhase:l,painter:r,spriteMosaic:u,styleLayerUID:w,requestRender:x,allowDelayedRender:z}=a;if(b.some(C=>C.layerData.get(w)?.circleIndexCount??!1)){a=a.styleLayer;var q=a.circleMaterial,t=r.vectorTilesMaterialManager,B=a.getPaintValue("circle-translate",m),y=a.getPaintValue("circle-translate-anchor",m),E=l===v.WGLDrawPhase.HITTEST,F=this._programOptions;F.id=E;t=t.getMaterialProgram(c,q,
F);if(z&&null!=x&&!t.compiled)x();else{c.useProgram(t);t.setUniformMatrix3fv("u_displayMat3",y===g.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);t.setUniform2fv("u_circleTranslation",B);t.setUniform1f("u_depth",a.z);t.setUniform1f("u_antialiasingWidth",1.2);B=-1;E&&(E=n.u32to4Xu8(w+1),t.setUniform4fv("u_id",E));for(const C of b)C.layerData.has(w)&&(C.key.level!==B&&(B=C.key.level,q.setDataUniforms(t,m,a,B,u)),b=C.layerData.get(w),b.circleIndexCount&&(b.prepareForRendering(c),E=b.vao,null!=
E&&(c.bindVAO(E),t.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs),d!==C.key.level?c.setStencilFunction(f.CompareFunction.EQUAL,C.stencilRef,255):c.setStencilFunction(f.CompareFunction.GREATER,255,255),c.drawElements(f.PrimitiveType.TRIANGLES,b.circleIndexCount,f.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*b.circleIndexStart),C.triangleCount+=b.circleIndexCount/3)))}}}}h.WGLBrushVTLCircle=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports",
"../../../../../symbols/cim/enums"],function(h,g){h.StyleLayerType=void 0;(function(n){n[n.BACKGROUND=0]="BACKGROUND";n[n.FILL=1]="FILL";n[n.LINE=2]="LINE";n[n.SYMBOL=3]="SYMBOL";n[n.CIRCLE=4]="CIRCLE"})(h.StyleLayerType||(h.StyleLayerType={}));h.Visibility=void 0;(function(n){n[n.VISIBLE=0]="VISIBLE";n[n.NONE=1]="NONE"})(h.Visibility||(h.Visibility={}));h.SymbolPlacement=void 0;(function(n){n[n.POINT=0]="POINT";n[n.LINE=1]="LINE";n[n.LINE_CENTER=2]="LINE_CENTER"})(h.SymbolPlacement||(h.SymbolPlacement=
{}));h.RotationAlignment=void 0;(function(n){n[n.MAP=0]="MAP";n[n.VIEWPORT=1]="VIEWPORT";n[n.AUTO=2]="AUTO"})(h.RotationAlignment||(h.RotationAlignment={}));h.TextJustification=void 0;(function(n){n[n.AUTO=0]="AUTO";n[n.LEFT=1]="LEFT";n[n.CENTER=2]="CENTER";n[n.RIGHT=3]="RIGHT"})(h.TextJustification||(h.TextJustification={}));h.SymbolAnchor=void 0;(function(n){n[n.CENTER=0]="CENTER";n[n.LEFT=1]="LEFT";n[n.RIGHT=2]="RIGHT";n[n.TOP=3]="TOP";n[n.BOTTOM=4]="BOTTOM";n[n.TOP_LEFT=5]="TOP_LEFT";n[n.TOP_RIGHT=
6]="TOP_RIGHT";n[n.BOTTOM_LEFT=7]="BOTTOM_LEFT";n[n.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(h.SymbolAnchor||(h.SymbolAnchor={}));h.TextTransform=void 0;(function(n){n[n.NONE=0]="NONE";n[n.UPPERCASE=1]="UPPERCASE";n[n.LOWERCASE=2]="LOWERCASE"})(h.TextTransform||(h.TextTransform={}));h.TranslateAnchor=void 0;(function(n){n[n.MAP=0]="MAP";n[n.VIEWPORT=1]="VIEWPORT"})(h.TranslateAnchor||(h.TranslateAnchor={}));h.TextWritingMode=void 0;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL";n[n.VERTICAL=1]="VERTICAL"})(h.TextWritingMode||
(h.TextWritingMode={}));class v{}v.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:h.Visibility.VISIBLE}};v.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:h.Visibility.VISIBLE}};v.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:h.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:g.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:g.JoinType.MITER},
"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};v.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:h.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:h.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},
"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:h.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",
values:["map","viewport","auto"],default:h.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:h.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",
values:["auto","left","center","right"],default:h.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",
default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:h.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:h.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[h.TextWritingMode.HORIZONTAL]}};v.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:h.Visibility.VISIBLE}};v.backgroundPaintDefinition=
{"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};v.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",
values:["map","viewport"],default:h.TranslateAnchor.MAP}};v.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:h.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};v.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",
values:["map","viewport"],default:h.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:h.TranslateAnchor.MAP}};v.rasterPaintDefinition=
{"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};v.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,
default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:h.TranslateAnchor.MAP}};
h.StyleDefinition=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("exports ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(h,g,v,n,p,f,e){const a=1/65536;class b extends f{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(c,m){const {displayLevel:d,
drawPhase:k,renderPass:l,spriteMosaic:r,styleLayerUID:u}=c;var w=!1;for(var x of m)if(x.layerData.has(u)){var z=x.layerData.get(u);if(0<z.fillIndexCount||0<z.outlineIndexCount){w=!0;break}}if(w){w=c.styleLayer;var q=w.getPaintProperty("fill-pattern");z=(x=void 0!==q)&&q.isDataDriven;if(x&&!z){var t=q.getValue(d);t=r.getMosaicItemPosition(t,!0)}q=!x&&w.getPaintValue("fill-antialias",d);var B=!0,y=1;if(!x){var E=w.getPaintProperty("fill-color"),F=w.getPaintProperty("fill-opacity");E?.isDataDriven||
F?.isDataDriven||(y=w.getPaintValue("fill-color",d),y=w.getPaintValue("fill-opacity",d)*y[3],1<=y&&(B=!1))}if(!B||"opaque"!==l){var C;k===n.WGLDrawPhase.HITTEST&&(C=p.u32to4Xu8(u+1));E=w.getPaintValue("fill-translate",d);F=w.getPaintValue("fill-translate-anchor",d);(B||"translucent"!==l)&&this._drawFill(c,u,w,m,E,F,x,t,z,C);t=!w.hasDataDrivenOutlineColor&&w.outlineUsesFillColor&&1>y;q&&"opaque"!==l&&!t&&this._drawOutline(c,u,w,m,E,F,C)}}}_drawFill(c,m,d,k,l,r,u,w,x,z){if(!u||x||null!=w){var {context:q,
displayLevel:t,state:B,drawPhase:y,painter:E,pixelRatio:F,spriteMosaic:C,requestRender:A,allowDelayedRender:D}=c;c=d.fillMaterial;var G=E.vectorTilesMaterialManager,J=F>v.vtlHighResCutoff?2:1,M=y===n.WGLDrawPhase.HITTEST,L=this._fillProgramOptions;L.id=M;L.pattern=u;G=G.getMaterialProgram(q,c,L);if(D&&null!=A&&!G.compiled)A();else{q.useProgram(G);null!=w&&({page:w}=w,L=C.getPageSize(w),null!=L&&(C.bind(q,e.TextureSamplingMode.LINEAR,w,v.vtlTextureBindingUnitSprites),G.setUniform2fv("u_mosaicSize",
L),G.setUniform1i("u_texture",v.vtlTextureBindingUnitSprites)));G.setUniformMatrix3fv("u_displayMat3",r===g.TranslateAnchor.VIEWPORT?B.displayMat3:B.displayViewMat3);G.setUniform2fv("u_fillTranslation",l);G.setUniform1f("u_depth",d.z+a);M&&G.setUniform4fv("u_id",z);l=-1;for(const Q of k)if(Q.layerData.has(m)&&(Q.key.level!==l&&(l=Q.key.level,c.setDataUniforms(G,t,d,l,C)),k=Q.layerData.get(m),k.fillIndexCount&&(k.prepareForRendering(q),r=k.fillVAO,null!=r))){q.bindVAO(r);G.setUniformMatrix3fv("u_dvsMat3",
Q.transforms.dvs);q.setStencilFunction(e.CompareFunction.EQUAL,Q.stencilRef,255);u&&G.setUniform1f("u_patternFactor",Q.rangeX/(J*Q.width*Math.max(2**(Math.round(t)-Q.key.level),1)));if(x){r=k.patternMap;if(!r)continue;for(const [N,U]of r)r=C.getPageSize(N),null!=r&&(C.bind(q,e.TextureSamplingMode.LINEAR,N,v.vtlTextureBindingUnitSprites),G.setUniform2fv("u_mosaicSize",r),G.setUniform1i("u_texture",v.vtlTextureBindingUnitSprites),q.drawElements(e.PrimitiveType.TRIANGLES,U[1],e.DataType.UNSIGNED_INT,
Uint32Array.BYTES_PER_ELEMENT*U[0]))}else q.drawElements(e.PrimitiveType.TRIANGLES,k.fillIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.fillIndexStart);Q.triangleCount+=k.fillIndexCount/3}}}}_drawOutline(c,m,d,k,l,r,u){const {context:w,displayLevel:x,state:z,drawPhase:q,painter:t,pixelRatio:B,spriteMosaic:y,requestRender:E,allowDelayedRender:F}=c;c=d.outlineMaterial;var C=t.vectorTilesMaterialManager;const A=.75/B,D=q===n.WGLDrawPhase.HITTEST,G=this._outlineProgramOptions;G.id=
D;C=C.getMaterialProgram(w,c,G);if(F&&null!=E&&!C.compiled)E();else{w.useProgram(C);C.setUniformMatrix3fv("u_displayMat3",r===g.TranslateAnchor.VIEWPORT?z.displayMat3:z.displayViewMat3);C.setUniform2fv("u_fillTranslation",l);C.setUniform1f("u_depth",d.z+a);C.setUniform1f("u_outline_width",A);D&&C.setUniform4fv("u_id",u);l=-1;for(const J of k)J.layerData.has(m)&&(J.key.level!==l&&(l=J.key.level,c.setDataUniforms(C,x,d,l,y)),k=J.layerData.get(m),k.prepareForRendering(w),k.outlineIndexCount&&(r=k.outlineVAO,
null!=r&&(w.bindVAO(r),C.setUniformMatrix3fv("u_dvsMat3",J.transforms.dvs),w.setStencilFunction(e.CompareFunction.EQUAL,J.stencilRef,255),w.drawElements(e.PrimitiveType.TRIANGLES,k.outlineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.outlineIndexStart),J.triangleCount+=k.outlineIndexCount/3)))}}}h.WGLBrushVTLFill=b;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("exports ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(h,g,v,n,p,f,e){class a extends f{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(b,c){const {context:m,displayLevel:d,state:k,drawPhase:l,painter:r,pixelRatio:u,spriteMosaic:w,styleLayerUID:x,requestRender:z,allowDelayedRender:q}=b;if(c.some(Q=>Q.layerData.get(x)?.lineIndexCount??!1)){b=b.styleLayer;var t=b.lineMaterial,B=r.vectorTilesMaterialManager,y=b.getPaintValue("line-translate",d),E=b.getPaintValue("line-translate-anchor",d),F=b.getPaintProperty("line-pattern"),
C=void 0!==F,A=C&&F.isDataDriven;if(C&&!A){F=F.getValue(d);var D=w.getMosaicItemPosition(F)}var G;F=!1;if(!C){var J=b.getPaintProperty("line-dasharray");F=(G=void 0!==J)&&J.isDataDriven;G&&!F&&(D=J.getValue(d),D=b.getDashKey(D,b.getLayoutValue("line-cap",d)),D=w.getMosaicItemPosition(D))}J=1/u;var M=l===n.WGLDrawPhase.HITTEST,L=this._programOptions;L.id=M;L.pattern=C;L.sdf=G;G=B.getMaterialProgram(m,t,L);if(q&&null!=z&&!G.compiled)z();else{m.useProgram(G);G.setUniformMatrix3fv("u_displayViewMat3",
k.displayViewMat3);G.setUniformMatrix3fv("u_displayMat3",E===g.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);G.setUniform2fv("u_lineTranslation",y);G.setUniform1f("u_depth",b.z);G.setUniform1f("u_antialiasing",J);M&&(y=p.u32to4Xu8(x+1),G.setUniform4fv("u_id",y));D&&null!=D&&({page:y}=D,E=w.getPageSize(y),null!=E&&(w.bind(m,e.TextureSamplingMode.LINEAR,y,v.vtlTextureBindingUnitSprites),G.setUniform2fv("u_mosaicSize",E),G.setUniform1i("u_texture",v.vtlTextureBindingUnitSprites)));y=-1;for(const Q of c)if(Q.layerData.has(x)&&
(Q.key.level!==y&&(y=Q.key.level,t.setDataUniforms(G,d,b,y,w)),G.setUniform1f("u_zoomFactor",2**(d-y)/u),c=Q.layerData.get(x),c.lineIndexCount&&(c.prepareForRendering(m),E=c.vao,null!=E))){m.bindVAO(E);G.setUniformMatrix3fv("u_dvsMat3",Q.transforms.dvs);m.setStencilFunction(e.CompareFunction.EQUAL,Q.stencilRef,255);if(A||F){E=c.patternMap;if(!E)continue;for(const [N,U]of E)E=w.getPageSize(N),null!=E&&(w.bind(m,e.TextureSamplingMode.LINEAR,N,v.vtlTextureBindingUnitSprites),G.setUniform2fv("u_mosaicSize",
E),G.setUniform1i("u_texture",v.vtlTextureBindingUnitSprites),m.drawElements(e.PrimitiveType.TRIANGLES,U[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*U[0]))}else m.drawElements(e.PrimitiveType.TRIANGLES,c.lineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*c.lineIndexStart);Q.triangleCount+=c.lineIndexCount/3}}}}}h.WGLBrushVTLLine=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../chunks/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../GeometryUtils ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(h,g,v,n,p,f,e,a,b,c){const m=1/65536;class d extends b{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=g.create()}dispose(){}drawMany(k,l){const {drawPhase:r,styleLayerUID:u}=k,w=k.styleLayer;let x;r===f.WGLDrawPhase.HITTEST&&(x=a.u32to4Xu8(u+1));this._drawIcons(k,w,l,x);this._drawText(k,w,l,x)}_drawIcons(k,l,r,u){const {context:w,displayLevel:x,drawPhase:z,painter:q,spriteMosaic:t,state:B,styleLayerUID:y,
requestRender:E,allowDelayedRender:F}=k,C=l.iconMaterial;var A=q.vectorTilesMaterialManager,D=!1;for(var G of r)if(G.layerData.has(y)){var J=G.layerData.get(y);if(0<J.iconPerPageElementsMap.size){D=!0;break}}if(D){D=l.getPaintValue("icon-translate",x);G=l.getPaintValue("icon-translate-anchor",x);var M=l.getLayoutValue("icon-rotation-alignment",x);M===n.RotationAlignment.AUTO&&(M=l.getLayoutValue("symbol-placement",x)===n.SymbolPlacement.POINT?n.RotationAlignment.VIEWPORT:n.RotationAlignment.MAP);
var L=M===n.RotationAlignment.MAP;L=l.getLayoutValue("icon-keep-upright",x)&&L;var Q=J.isIconSDF;J=z===f.WGLDrawPhase.HITTEST;var N=this._iconProgramOptions;N.id=J;N.sdf=Q;A=A.getMaterialProgram(w,C,N);if(F&&null!=E&&!A.compiled)E();else{w.useProgram(A);A.setUniformMatrix3fv("u_displayViewMat3",M===n.RotationAlignment.MAP?B.displayViewMat3:B.displayMat3);A.setUniformMatrix3fv("u_displayMat3",G===n.TranslateAnchor.VIEWPORT?B.displayMat3:B.displayViewMat3);A.setUniform2fv("u_iconTranslation",D);A.setUniform1f("u_depth",
l.z);A.setUniform1f("u_mapRotation",e.degToByte(B.rotation));A.setUniform1f("u_keepUpright",L?1:0);A.setUniform1f("u_level",10*x);A.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites);A.setUniform1f("u_fadeDuration",v.fadeDuration/1E3);J&&A.setUniform4fv("u_id",u);u=-1;for(const U of r)if(U.layerData.has(y)&&(U.key.level!==u&&(u=U.key.level,C.setDataUniforms(A,x,l,u,t)),J=U.layerData.get(y),0!==J.iconPerPageElementsMap.size&&(J.prepareForRendering(w),J.updateOpacityInfo(),r=J.iconVAO,null!=r))){w.bindVAO(r);
A.setUniformMatrix3fv("u_dvsMat3",U.transforms.dvs);A.setUniform1f("u_time",(performance.now()-J.lastOpacityUpdate)/1E3);for(const [Z,H]of J.iconPerPageElementsMap)this._renderIconRange(k,A,H,Z,U)}}}}_renderIconRange(k,l,r,u,w){const {context:x,spriteMosaic:z}=k;this._spritesTextureSize[0]=z.getWidth(u)/4;this._spritesTextureSize[1]=z.getHeight(u)/4;l.setUniform2fv("u_mosaicSize",this._spritesTextureSize);z.bind(x,c.TextureSamplingMode.LINEAR,u,p.vtlTextureBindingUnitSprites);this._setStencilState(k,
w);x.drawElements(c.PrimitiveType.TRIANGLES,r[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]);w.triangleCount+=r[1]/3}_drawText(k,l,r,u){const {context:w,displayLevel:x,drawPhase:z,glyphMosaic:q,painter:t,pixelRatio:B,spriteMosaic:y,state:E,styleLayerUID:F,requestRender:C,allowDelayedRender:A}=k,D=l.textMaterial,G=t.vectorTilesMaterialManager;var J=!1;for(var M of r)if(M.layerData.has(F)){var L=M.layerData.get(F);if(0<L.glyphPerPageElementsMap.size){J=!0;break}}if(J&&(L=l.getPaintProperty("text-opacity"),
!L||L.isDataDriven||0!==L.getValue(x))){L=l.getPaintProperty("text-color");var Q=!L||L.isDataDriven||0<L.getValue(x)[3];L=l.getPaintProperty("text-halo-width");J=l.getPaintProperty("text-halo-color");var N=(!L||L.isDataDriven||0<L.getValue(x))&&(!J||J.isDataDriven||0<J.getValue(x)[3]);if(Q||N){L=l.getLayoutValue("text-rotation-alignment",x);L===n.RotationAlignment.AUTO&&(L=l.getLayoutValue("symbol-placement",x)===n.SymbolPlacement.POINT?n.RotationAlignment.VIEWPORT:n.RotationAlignment.MAP);J=L===
n.RotationAlignment.MAP;J=l.getLayoutValue("text-keep-upright",x)&&J;M=z===f.WGLDrawPhase.HITTEST;var U=.8*3/B;this._glyphTextureSize||(this._glyphTextureSize=g.fromValues(q.width/4,q.height/4));var Z=l.getPaintValue("text-translate",x),H=l.getPaintValue("text-translate-anchor",x),O=this._sdfProgramOptions;O.id=M;var T=G.getMaterialProgram(w,D,O);if(A&&null!=C&&!T.compiled)C();else{w.useProgram(T);T.setUniformMatrix3fv("u_displayViewMat3",L===n.RotationAlignment.MAP?E.displayViewMat3:E.displayMat3);
T.setUniformMatrix3fv("u_displayMat3",H===n.TranslateAnchor.VIEWPORT?E.displayMat3:E.displayViewMat3);T.setUniform2fv("u_textTranslation",Z);T.setUniform1f("u_depth",l.z+m);T.setUniform2fv("u_mosaicSize",this._glyphTextureSize);T.setUniform1f("u_mapRotation",e.degToByte(E.rotation));T.setUniform1f("u_keepUpright",J?1:0);T.setUniform1f("u_level",10*x);T.setUniform1i("u_texture",p.vtlTextureBindingUnitGlyphs);T.setUniform1f("u_antialiasingWidth",U);T.setUniform1f("u_fadeDuration",v.fadeDuration/1E3);
M&&T.setUniform4fv("u_id",u);u=-1;for(const V of r)V.layerData.has(F)&&(V.key.level!==u&&(u=V.key.level,D.setDataUniforms(T,x,l,u,y)),L=V.layerData.get(F),0!==L.glyphPerPageElementsMap.size&&(L.prepareForRendering(w),L.updateOpacityInfo(),r=L.textVAO,null!=r&&(w.bindVAO(r),T.setUniformMatrix3fv("u_dvsMat3",V.transforms.dvs),this._setStencilState(k,V),r=(performance.now()-L.lastOpacityUpdate)/1E3,T.setUniform1f("u_time",r),L.glyphPerPageElementsMap.forEach((X,I)=>{this._renderGlyphRange(w,X,I,q,T,
N,Q,V)}))))}}}}_renderGlyphRange(k,l,r,u,w,x,z,q){u.bind(k,c.TextureSamplingMode.LINEAR,r,p.vtlTextureBindingUnitGlyphs);x&&(w.setUniform1f("u_halo",1),k.drawElements(c.PrimitiveType.TRIANGLES,l[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*l[0]),q.triangleCount+=l[1]/3);z&&(w.setUniform1f("u_halo",0),k.drawElements(c.PrimitiveType.TRIANGLES,l[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*l[0]),q.triangleCount+=l[1]/3)}_setStencilState(k,l){const {context:r,is3D:u,stencilSymbols:w}=
k;r.setStencilTestEnabled(!0);w?(r.setStencilWriteMask(255),r.setStencilFunction(c.CompareFunction.ALWAYS,l.stencilRef,255)):(r.setStencilWriteMask(0),u?r.setStencilFunction(c.CompareFunction.EQUAL,l.stencilRef,255):r.setStencilFunction(c.CompareFunction.GREATER,255,255))}}h.WGLBrushVTLSymbol=d;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(h){h.collisionGridCellSize=32;h.declutterBudget=
1.5;h.declutterTiles=!0;h.fadeDuration=200;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(h){function g(f,e){f%=e;return 0<=f?f:f+e}const v=128/Math.PI,n=256/360,p=1/Math.LN2;h.between=function(f,e,a){return f>=e&&f<=a||f>=a&&f<=e};h.degToByte=function(f){return g(f*n,256)};h.interpolate=function(f,e,a){return f*(1-a)+e*a};h.log2=function(f){return Math.log(f)*p};h.positiveMod=g;h.radToByte=function(f){return g(f*
v,256)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define(["../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../../../../webgl/enums"],function(h,g,v,n,p){class f extends v{dispose(){}getGeometryType(){return h.WGLGeometryType.LABEL}supportsSymbology(e){return!0}drawGeometry(e,a,b,c){const {context:m,painter:d,state:k,rendererInfo:l,requestRender:r,allowDelayedRender:u}=e,w=n.LabelMaterialKey.load(b.materialKey),
x=w.mapAligned?1:0;if(x||!(1<=Math.abs(a.key.level-Math.round(100*e.displayLevel)/100))){var {bufferLayouts:z,attributes:q}=g.createProgramDescriptor(w.data,{geometry:[{location:0,name:"a_pos",count:2,type:p.DataType.SHORT},{location:1,name:"a_id",count:4,type:p.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:p.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:p.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texAndSize",count:4,type:p.DataType.UNSIGNED_BYTE},
{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:p.DataType.UNSIGNED_BYTE},{location:6,name:"a_glyphData",count:4,type:p.DataType.UNSIGNED_BYTE},{location:7,name:"a_vertexOffset",count:2,type:p.DataType.SHORT},{location:8,name:"a_texCoords",count:2,type:p.DataType.UNSIGNED_SHORT}]});c=d.materialManager.getMaterialProgram(e,w,"materials/label",q,c);if(u&&null!=r&&!c.compiled)r();else{e.context.setStencilFunction(p.CompareFunction.EQUAL,0,255);m.useProgram(c);this._setSharedUniforms(c,
e,a);d.textureManager.bindTextures(m,c,w);var t=1===x?k.displayViewMat3:k.displayMat3;this._setSizeVVUniforms(w,c,l,a);c.setUniform1f("u_mapRotation",Math.floor(k.rotation/360*254));c.setUniform1f("u_mapAligned",x);c.setUniformMatrix3fv("u_displayMat3",t);c.setUniform1f("u_opacity",1);c.setUniform2fv("u_screenSize",e.state.size);e=b.target.getVAO(m,z,q);a=b.indexFrom*Uint32Array.BYTES_PER_ELEMENT;m.bindVAO(e);c.setUniform1f("u_isHaloPass",0);c.setUniform1f("u_isBackgroundPass",1);m.drawElements(p.PrimitiveType.TRIANGLES,
b.indexCount,p.DataType.UNSIGNED_INT,a);c.setUniform1f("u_isHaloPass",1);c.setUniform1f("u_isBackgroundPass",0);m.drawElements(p.PrimitiveType.TRIANGLES,b.indexCount,p.DataType.UNSIGNED_INT,a);c.setUniform1f("u_isHaloPass",0);c.setUniform1f("u_isBackgroundPass",0);m.drawElements(p.PrimitiveType.TRIANGLES,b.indexCount,p.DataType.UNSIGNED_INT,a);m.setStencilTestEnabled(!0);m.setBlendingEnabled(!0)}}}}return f})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define(["../enums",
"../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../../../../webgl/enums"],function(h,g,v,n,p){class f extends v{dispose(){}getGeometryType(){return h.WGLGeometryType.LINE}supportsSymbology(e){return!0}drawGeometry(e,a,b,c){const {context:m,painter:d,rendererInfo:k,displayLevel:l,passOptions:r,requestRender:u,allowDelayedRender:w}=e,x=n.LineMaterialKey.load(b.materialKey),z=null!=r&&"hittest"===r.type;var q=g.createProgramDescriptor(x.data,{geometry:[{location:0,name:"a_pos",count:2,
type:p.DataType.SHORT},{location:1,name:"a_id",count:4,type:p.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:p.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:p.DataType.BYTE},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:p.DataType.UNSIGNED_SHORT},{location:5,name:"a_tlbr",count:4,type:p.DataType.UNSIGNED_SHORT},{location:6,name:"a_segmentDirection",count:4,type:p.DataType.BYTE},{location:7,name:"a_aux",count:2,type:p.DataType.UNSIGNED_SHORT},
{location:8,name:"a_zoomRange",count:2,type:p.DataType.UNSIGNED_SHORT}]});let t=p.PrimitiveType.TRIANGLES;z&&(q=this._getTriangleDesc(b.materialKey,q),t=p.PrimitiveType.POINTS);const {attributes:B,bufferLayouts:y}=q;c=d.materialManager.getMaterialProgram(e,x,"materials/line",B,c);w&&null!=u&&!c.compiled?u():(q=1/e.pixelRatio,m.useProgram(c),this._setSharedUniforms(c,e,a),x.textureBinding&&d.textureManager.bindTextures(m,c,x),c.setUniform1f("u_zoomFactor",2**(l-a.key.level)),c.setUniform1f("u_blur",
0+q),c.setUniform1f("u_antialiasing",q),this._setSizeVVUniforms(x,c,k,a),this._setColorAndOpacityVVUniforms(x,c,k),m.setFaceCullingEnabled(!1),e=b.target.getVAO(m,y,B,z),a=b.indexCount,b=b.indexFrom*Uint32Array.BYTES_PER_ELEMENT,z&&(a/=3,b/=3),m.bindVAO(e),m.drawElements(t,a,p.DataType.UNSIGNED_INT,b))}}return f})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define(["../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../../../../webgl/enums"],function(h,
g,v,n,p){class f extends v{dispose(){}getGeometryType(){return h.WGLGeometryType.TEXT}supportsSymbology(e){return!0}drawGeometry(e,a,b,c){const {context:m,painter:d,rendererInfo:k,state:l,passOptions:r,requestRender:u,allowDelayedRender:w}=e,x=n.TextMaterialKey.load(b.materialKey),z=null!=r&&"hittest"===r.type,{bufferLayouts:q,attributes:t}=g.createProgramDescriptor(x.data,{geometry:[{location:0,name:"a_pos",count:2,type:p.DataType.SHORT},{location:1,name:"a_id",count:4,type:p.DataType.UNSIGNED_BYTE},
{location:2,name:"a_color",count:4,type:p.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:p.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:p.DataType.UNSIGNED_BYTE},{location:5,name:"a_aux",count:4,type:p.DataType.BYTE},{location:6,name:"a_zoomRange",count:2,type:p.DataType.UNSIGNED_SHORT},{location:7,name:"a_vertexOffset",count:2,type:p.DataType.SHORT},{location:8,name:"a_texCoords",count:2,type:p.DataType.UNSIGNED_SHORT}]});
c=d.materialManager.getMaterialProgram(e,x,"materials/text",t,c);if(w&&null!=u&&!c.compiled)u();else{m.useProgram(c);var B=p.PrimitiveType.TRIANGLES;z&&(B=p.PrimitiveType.POINTS);this._setSharedUniforms(c,e,a);d.textureManager.bindTextures(m,c,x);c.setUniformMatrix3fv("u_displayMat3",l.displayMat3);c.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3);this._setSizeVVUniforms(x,c,k,a);this._setColorAndOpacityVVUniforms(x,c,k);this._setRotationVVUniforms(x,c,k);e=b.target.getVAO(m,q,t);a=b.indexFrom*
Uint32Array.BYTES_PER_ELEMENT;m.bindVAO(e);c.setUniform1f("u_isHaloPass",0);c.setUniform1f("u_isBackgroundPass",1);m.drawElements(B,b.indexCount,p.DataType.UNSIGNED_INT,a);c.setUniform1f("u_isHaloPass",1);c.setUniform1f("u_isBackgroundPass",0);m.drawElements(p.PrimitiveType.TRIANGLES,b.indexCount,p.DataType.UNSIGNED_INT,a);c.setUniform1f("u_isHaloPass",0);c.setUniform1f("u_isBackgroundPass",0);m.drawElements(B,b.indexCount,p.DataType.UNSIGNED_INT,a)}}}return f})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums",
"./Programs"],function(h,g){class v{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(n=>n.dispose());this._programByKey.clear()}getMaterialProgram(n,p,f){const e=p.key<<3|this._getMaterialOptionsValue(p.type,f);if(this._programByKey.has(e))return this._programByKey.get(e);var a=this._getProgramTemplate(p.type);({shaders:a}=a);const {vertexShader:b,fragmentShader:c}=a(f);f=p.getShaderHeader();a=p.getShaderMain();f=b.replace("#pragma header",f).replace("#pragma main",a);
n=n.programCache.acquire(f,c,p.getAttributeLocations());this._programByKey.set(e,n);return n}_getMaterialOptionsValue(n,p){switch(n){case h.ShaderProgramType.BACKGROUND:return(p.pattern?1:0)<<1|(p.id?1:0);case h.ShaderProgramType.FILL:return(p.pattern?1:0)<<1|(p.id?1:0);case h.ShaderProgramType.OUTLINE:return p.id?1:0;case h.ShaderProgramType.LINE:return(p.sdf?1:0)<<2|(p.pattern?1:0)<<1|(p.id?1:0);case h.ShaderProgramType.ICON:return(p.sdf?1:0)<<1|(p.id?1:0);case h.ShaderProgramType.CIRCLE:return p.id?
1:0;case h.ShaderProgramType.TEXT:return p.id?1:0;default:return 0}}_getProgramTemplate(n){switch(n){case h.ShaderProgramType.BACKGROUND:return g.background;case h.ShaderProgramType.CIRCLE:return g.circle;case h.ShaderProgramType.FILL:return g.fill;case h.ShaderProgramType.ICON:return g.icon;case h.ShaderProgramType.LINE:return g.line;case h.ShaderProgramType.OUTLINE:return g.outline;case h.ShaderProgramType.TEXT:return g.text;default:return null}}}return v})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],
function(h){h.BucketType=void 0;(function(g){g[g.FILL=1]="FILL";g[g.LINE=2]="LINE";g[g.SYMBOL=3]="SYMBOL";g[g.CIRCLE=4]="CIRCLE"})(h.BucketType||(h.BucketType={}));h.ShaderProgramType=void 0;(function(g){g[g.BACKGROUND=0]="BACKGROUND";g[g.FILL=1]="FILL";g[g.OUTLINE=2]="OUTLINE";g[g.LINE=3]="LINE";g[g.ICON=4]="ICON";g[g.CIRCLE=5]="CIRCLE";g[g.TEXT=6]="TEXT";g[g.TILEINFO=7]="TILEINFO"})(h.ShaderProgramType||(h.ShaderProgramType={}));h.StyleUpdateType=void 0;(function(g){g[g.PAINTER_CHANGED=0]="PAINTER_CHANGED";
g[g.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";g[g.LAYER_CHANGED=2]="LAYER_CHANGED";g[g.LAYER_REMOVED=3]="LAYER_REMOVED";g[g.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(h.StyleUpdateType||(h.StyleUpdateType={}));Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(h,g,v){h.background={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id,PATTERN:n.pattern})+
g.resolveIncludes("background/background.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id,PATTERN:n.pattern})+g.resolveIncludes("background/background.frag")})};h.circle={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("circle/circle.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("circle/circle.frag")})};h.fill={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id,PATTERN:n.pattern})+g.resolveIncludes("fill/fill.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id,
PATTERN:n.pattern})+g.resolveIncludes("fill/fill.frag")})};h.icon={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id,SDF:n.sdf})+g.resolveIncludes("icon/icon.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id,SDF:n.sdf})+g.resolveIncludes("icon/icon.frag")})};h.line={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id,PATTERN:n.pattern,SDF:n.sdf})+g.resolveIncludes("line/line.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id,PATTERN:n.pattern,SDF:n.sdf})+g.resolveIncludes("line/line.frag")})};
h.outline={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("outline/outline.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("outline/outline.frag")})};h.text={shaders:n=>({vertexShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("text/text.vert"),fragmentShader:v.glslifyDefineMap({ID:n.id})+g.resolveIncludes("text/text.frag")})};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports",
"./shaderRepository","../../../../../webgl/ShaderCompiler"],function(h,g,v){const n=new v.ShaderCompiler(function(p){let f=g;p.split("/").forEach(e=>{f&&(f=f[e])});return f});h.resolveIncludes=function(p){return n.resolveIncludes(p)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("exports ../../../../core/maybe ./DefaultVertexAttributeLayouts ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/ProgramTemplate ../../../webgl/VertexArrayObject".split(" "),
function(h,g,v,n,p,f,e,a){class b{constructor(){this._initialized=!1}dispose(){this._program=g.disposeMaybe(this._program);this._vertexArrayObject=g.disposeMaybe(this._vertexArrayObject)}render(c,m,d,k){c&&(this._initialized||this._initialize(c),c.setBlendFunctionSeparate(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),c.bindVAO(this._vertexArrayObject),c.useProgram(this._program),m.setSamplingMode(d),c.bindTexture(m,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",k),c.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4),c.bindTexture(null,0),c.bindVAO())}_initialize(c){if(this._initialized)return!0;const m=e.createProgram(c,n.bitBlit);if(!m)return!1;const d=new Int8Array(16);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=1;d[5]=-1;d[6]=1;d[7]=0;d[8]=-1;d[9]=1;d[10]=0;d[11]=1;d[12]=1;d[13]=1;d[14]=1;d[15]=1;c=new a.VertexArrayObject(c,n.bitBlit.attributes,v.PosTex2b,{geometry:p.BufferObject.createVertex(c,f.Usage.STATIC_DRAW,d)});this._program=
m;this._vertexArrayObject=c;return this._initialized=!0}}h.BitBlitRenderer=b;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(h,g){g={shaders:{vertexShader:g.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:g.resolveIncludes("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};h.bitBlit=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/MaterialManager":function(){define(["./enums","./shaders/MaterialPrograms"],function(h,g){const v=({rendererInfo:f,drawPhase:e},a,b)=>`${a.getVariationHash()}-${(e===h.WGLDrawPhase.HITTEST||e===h.WGLDrawPhase.LABEL_ALPHA?1:0)|(e===h.WGLDrawPhase.HIGHLIGHT?2:0)}-${f.getVariationHash()}-${null!=b&&b.join(".")}`,n=(f,e,a,b={})=>{b={...b};e={...e.getVariation()};var c={...f.rendererInfo.getVariation()},m=f.drawPhase;b={...b,...e,...c,highlight:f.drawPhase===h.WGLDrawPhase.HIGHLIGHT,
id:m===h.WGLDrawPhase.HITTEST||m===h.WGLDrawPhase.LABEL_ALPHA};if(null!=a)for(const d of a)b[d]=!0;return b};class p{constructor(f){this._rctx=f;this._programByKey=new Map}dispose(){this._programByKey.forEach(f=>f.dispose());this._programByKey.clear()}getProgram(f,e=[]){const a=f.vsPath+"."+f.fsPath+JSON.stringify(e);if(this._programByKey.has(a))return this._programByKey.get(a);e={...e.map(d=>"string"===typeof d?{name:d,value:!0}:d).reduce((d,k)=>({...d,[k.name]:k.value}),{})};const {vsPath:b,fsPath:c,
attributes:m}=f;f=g.createProgramTemplate(b,c,m,e);f=this._rctx.programCache.acquire(f.shaders.vertexShader,f.shaders.fragmentShader,f.attributes);if(!f)throw Error("Unable to get program for key: ${key}");this._programByKey.set(a,f);return f}getMaterialProgram(f,e,a,b,c){const m=v(f,e,c);if(this._programByKey.has(m))return this._programByKey.get(m);f=n(f,e,c,{ignoresSamplerPrecision:f.context.driverTest.ignoresSamplerPrecision.result});a=g.createProgramTemplate(a,a,b,f);a=this._rctx.programCache.acquire(a.shaders.vertexShader,
a.shaders.fragmentShader,a.attributes);if(!a)throw Error("Unable to get program for key: ${key}");this._programByKey.set(m,a);return a}}return p})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(h,g,v){h.createProgramTemplate=(n,p,f,e)=>{n+=n.substring(n.lastIndexOf("/"));p+=p.substring(p.lastIndexOf("/"));const a={};for(const c in e){let m=void 0;var b=c;m=""+b[0].toUpperCase();for(let d=1;d<b.length;d++){const k=
b[d];k===k.toUpperCase()?(m+="_",m+=k):m+=k.toUpperCase()}a[m]=e[c]}e=v.glslifyDefineMap(a);return{attributes:f,shaders:{vertexShader:e+g.resolveIncludes(`${n}.vert`),fragmentShader:e+g.resolveIncludes(`${p}.frag`)}}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define("../../../../config ../../../../request ../../../../core/BidiText ../../../../core/Error ../../../../core/fontUtils ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/vec2 ../../../../chunks/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./Utils ./animatedFormats/AnimatableTextureResource ./animatedFormats/utils ./util/Result ./util/symbolUtils ../../../support/QueueProcessor ../../../webgl/enums".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B,y,E,F,C,A){function D(N){N=Math.round(c.pt2px(N)*window.devicePixelRatio);return N*(128<=N?2:4)}function G(N,U){if(!N||!U)return{width:0,height:0};const Z=N/U;if(1<Z)return N=D(N),{width:N,height:N/Z};N=D(U);return{width:N*Z,height:N}}const J=k.create(),M=e.getLogger("esri.views.2d.engine.webgl.TextureManager");class L{static fromMosaic(N,U){return new L(N,U.page,U.sdf)}constructor(N,U,Z){this.mosaicType=N;this.page=U;this.sdf=Z}}class Q{constructor(N,
U,Z){this._requestRender=N;this.resourceManager=U;this._allowNonPowerOfTwo=Z;this._invalidFontsMap=new Map;this._sdfConverter=new z(r.sdfTextureSize);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._ongoingRasterizations=new Map;this._imageRequestQueue=new C.QueueProcessor({concurrency:10,process:async(H,O)=>{b.throwIfAborted(O);try{return await g(H,{responseType:"image",signal:O})}catch(T){if(!b.isAbortError(T))throw new n("mapview-invalid-resource",`Could not fetch requested resource at ${H}`,
T);throw T;}}});this._spriteMosaic=new q(2048,2048,500);this._glyphSource=new x(`${h.fontsUrl}/{fontstack}/{range}.pbf`);this._glyphMosaic=new w(1024,1024,this._glyphSource);this._rasterizer=new l(U)}dispose(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._sdfConverter.dispose();this._sdfConverter=this._glyphMosaic=this._spriteMosaic=null;this._hashToBindingIndex.clear();this._bindingInfos=this._hashToBindingIndex=null;this._ongoingRasterizations.clear();
this._ongoingRasterizations=null;this._imageRequestQueue.clear();this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(N,U,Z,H){if(null==N)return M.error(new n("mapview-null-resource","Unable to rasterize null resource",void 0)),null;switch(N.type){case "text":case "esriTS":return N=await this._rasterizeText(N,Z,H),N.forEach(O=>this._setTextureBinding(u.MosaicType.GLYPH,O)),{glyphMosaicItems:N};default:if(t.is3D(N))return M.error(new n("mapview-invalid-type",
`MapView does not support symbol type: ${N.type}`,N)),null;N=await this._rasterizeSpriteSymbol(N,U,H);E.ok(N)&&N&&this._setTextureBinding(u.MosaicType.SPRITE,N);return{spriteMosaicItem:N}}}bindTextures(N,U,Z,H=!1){if(0!==Z.textureBinding){var O=this._bindingInfos[Z.textureBinding-1];Z=O.page;H=H?A.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:A.TextureSamplingMode.LINEAR;switch(O.mosaicType){case u.MosaicType.SPRITE:O=this.sprites.getWidth(Z);const T=this.sprites.getHeight(Z);O=d.set(J,O,T);this._spriteMosaic.bind(N,
H,Z,r.textureBindingSpriteAtlas);U.setUniform1i("u_texture",r.textureBindingSpriteAtlas);U.setUniform2fv("u_mosaicSize",O);break;case u.MosaicType.GLYPH:O=d.set(J,this.glyphs.width,this.glyphs.height);this._glyphMosaic.bind(N,H,Z,r.textureBindingGlyphAtlas);U.setUniform1i("u_texture",r.textureBindingGlyphAtlas);U.setUniform2fv("u_mosaicSize",O);break;default:M.error("mapview-texture-manager",`Cannot handle unknown type ${O.mosaicType}`)}}}_hashMosaic(N,U){return 1|N<<1|(U.sdf?1:0)<<2|U.page<<3}_setTextureBinding(N,
U){const Z=this._hashMosaic(N,U);this._hashToBindingIndex.has(Z)||(N=L.fromMosaic(N,U),this._hashToBindingIndex.set(Z,this._bindingInfos.length+1),this._bindingInfos.push(N));U.textureBinding=this._hashToBindingIndex.get(Z)}async _rasterizeText(N,U,Z){let H,O;H="cim"in N?N.fontName:p.getFullyQualifiedFontName(N.font);O=N.text;N=this._invalidFontsMap.has(H);U=U||t.charCodes(v.bidiText(O)[0]);try{return N=N?"arial-unicode-ms-regular":H,f("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(N),
await this._glyphMosaic.getGlyphItems(N,U,Z)}catch(T){return M.error(new n("mapview-invalid-resource",`Couldn't find font ${H}. Falling back to Arial Unicode MS Regular`,void 0)),this._invalidFontsMap.set(H,!0),this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",U,Z)}}async _rasterizeSpriteSymbol(N,U,Z){if(!t.isSimple(N)){U=F.keyFromSymbol(N);if(this._spriteMosaic.has(U))return this._spriteMosaic.getSpriteItem(U);if(t.isSVGResource(N)||t.isImageResource(N)&&!t.isMarkerPlacementInsidePolygon(N))return this._handleAsyncResource(U,
N,Z);if(Z=this._rasterizer.rasterizeJSONResource(N,r.patternFillRasterizationScale)){const {size:H,image:O,sdf:T,simplePattern:V,rasterizationScale:X}=Z;return this._addItemToMosaic(U,H,{type:"static",data:O},t.shouldRepeat(N),T,V,X)}return new n("TextureManager","unrecognized or null rasterized image")}}async _handleAsyncResource(N,U,Z){if(this._ongoingRasterizations.has(N))return this._ongoingRasterizations.get(N);U=t.isSVGResource(U)?this._handleSVG(U,N,Z):this._handleImage(U,N,Z);this._ongoingRasterizations.set(N,
U);try{await U,this._ongoingRasterizations.delete(N)}catch{this._ongoingRasterizations.delete(N)}return U}async _handleSVG(N,U,Z){const H=[r.sdfTextureSize,r.sdfTextureSize];N=await this._sdfConverter.draw(N.path,"cim"in N?N.cim.asFill:!0,Z);return this._addItemToMosaic(U,H,{type:"static",data:new Uint32Array(N.buffer)},!1,!0,!0)}async _handleGIFOrPNG(N,U,Z){var H=t.getUrl(N);await this.resourceManager.fetchResource(H,Z);Z=this.resourceManager.getResource(H);if(null==Z)return new n("mapview-invalid-resource",
`Could not fetch requested resource at ${H}.`);H=Z.width;var O=Z.height;if(Z instanceof HTMLImageElement){if("esriPMS"===N.type){H=Math;O=H.round;var T=t.getPMSResourceSize(N);T=Math.min(Z.width,D(T));H=O.call(H,T);O=Math.round(H/Z.width*Z.height)}const {size:V,sdf:X,image:I}=this._rasterizer.rasterizeImageResource(H,O,Z,"cim"in N?N.cim.colorSubstitutions:void 0);return this._addItemToMosaic(U,V,{type:"static",data:I},t.shouldRepeat(N),X,!1)}this._allowNonPowerOfTwo||(H=a.nextPowerOfTwo(Z.width+2*
r.spritePadding)-2*r.spritePadding,O=a.nextPowerOfTwo(Z.height+2*r.spritePadding)-2*r.spritePadding);if(H!==Z.width||O!==Z.height)Z=y.resize(Z,H,O);Z=new B.AnimatableTextureResource(Z,this._requestRender,N.animatedSymbolProperties||{},N.objectId);return this._addItemToMosaic(U,[Z.width,Z.height],{type:"animated",data:Z},t.shouldRepeat(N),!1,!1)}async _handleImage(N,U,Z){if(t.isGIF(N)||t.isPNG(N))return this._handleGIFOrPNG(N,U,Z);const H=t.getUrl(N);try{let X;const I=this.resourceManager.getResource(H);
if(null!=I&&I instanceof HTMLImageElement)X=I;else{const {data:S}=await this._imageRequestQueue.push(H,{...Z});X=S}if(m.isSVG(H))if("width"in N&&"height"in N){const {width:S,height:Y}=G(N.width,N.height);X.width=S;X.height=Y}else if("cim"in N){const S=N.cim,{width:Y,height:ba}=G(S.width??S.scaleX*S.size,S.size);X.width=Y;X.height=ba}if(!X.width||!X.height)return null;let K=X.width,P=X.height;if("esriPMS"===N.type){Z=Math;var O=Z.round,T=t.getPMSResourceSize(N);var V=Math.min(X.width,D(T));K=O.call(Z,
V);P=Math.round(K/X.width*X.height)}const {size:W,sdf:aa,image:R}=this._rasterizer.rasterizeImageResource(K,P,X,"cim"in N?N.cim.colorSubstitutions:void 0);return this._addItemToMosaic(U,W,{type:"static",data:R},t.shouldRepeat(N),aa,!1)}catch(X){if(!b.isAbortError(X))return new n("mapview-invalid-resource",`Could not fetch requested resource at ${H}. ${X.message}`)}}_addItemToMosaic(N,U,Z,H,O,T,V){return this._spriteMosaic.addSpriteItem(N,U,Z,H,O,T,V)}}return Q})},"esri/core/BidiText":function(){define(["exports",
"./BidiEngine"],function(h,g){const v=new g;h.bidiText=function(n){if(null==n)return["",!1];if(!v.hasBidiChar(n))return[n,!1];let p;p="rtl"===v.checkContextual(n)?"IDNNN":"ICNNN";return[v.bidiTransform(n,p,"VLYSN"),!0]};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(h){function g(y,E,F,C,A){var D=y;void 0===E&&(E=A.defInFormat);void 0===F&&(F=A.defOutFormat);void 0===C&&(C=A.defSwap);if(E!==F){var G=E.substring(0,
1),J=F.substring(0,1);var M=E.substring(1,4);var L=F.substring(1,4);"C"===M.charAt(0)&&(M=v(D),M="ltr"===M||"rtl"===M?M.toUpperCase():"L"===E.charAt(2)?"LTR":"RTL",E=G+M);"C"===L.charAt(0)&&(M=v(D),"rtl"===M?L="RTL":"ltr"===M?(D=D.split(""),D.reverse(),M=v(D.join("")),L=M.toUpperCase()):L="L"===F.charAt(2)?"LTR":"RTL",F=J+L)}if(E===F)return y;J=E.substring(0,1);D=E.substring(1,4);G=F.substring(0,1);L=F.substring(1,4);A.inFormat=E;A.outFormat=F;A.swap=C;if("L"===J&&"VLTR"===F){if("LTR"===D)return A.dir=
0,n(y,A);if("RTL"===D)return A.dir=1,n(y,A)}if("V"===J&&"V"===G)return A.dir="RTL"===D?1:0,f(y,A);if("L"===J&&"VRTL"===F)return A.dir="LTR"===D?0:1,y=n(y,A),f(y);if("VLTR"===E&&"LLTR"===F)return A.dir=0,n(y,A);if("V"===J&&"L"===G&&D!==L)return y=f(y),"RTL"===D?g(y,"LLTR","VLTR",C,A):g(y,"LRTL","VRTL",C,A);if("VRTL"===E&&"LRTL"===F)return g(y,"LRTL","VRTL",C,A);"L"===J&&"L"===G&&(E=A.swap,A.swap=E.substr(0,1)+"N","RTL"===D?(A.dir=1,y=n(y,A),A.swap="N"+E.substr(1,2),A.dir=0,y=n(y,A)):(A.dir=0,y=n(y,
A),A.swap="N"+E.substr(1,2),y=g(y,"VLTR","LRTL",A.swap,A)));return y}function v(y){return(y=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(y))?"z">=y[0]?"ltr":"rtl":""}function n(y,E){y=y.split("");const F=[];p(y,F,E);if(0!==E.hiLevel&&E.swap.substr(0,1)!==E.swap.substr(1,2))for(let D=0;D<y.length;D++)if(1===F[D]){var C=D;b:{let G=void 0;var A=y[D];let J=0,M=h.swapTable.length-1;for(;J<=M;)if(G=Math.floor((J+M)/2),A<h.swapTable[G][0])M=G-1;else if(A>h.swapTable[G][0])J=
G+1;else{A=h.swapTable[G][1];break b}}y[C]=A}b(2,y,F,E);b(1,y,F,E);z=F;return y.join("")}function p(y,E,F){const C=y.length;var A=F.dir?h.impTabRtl:h.impTabLtr,D=0,G=-1;const J=[],M=[];F.hiLevel=F.dir;F.lastArabic=!1;F.hasUbatAl=!1;F.hasUbatB=!1;F.hasUbatS=!1;for(var L=0;L<C;L++){var Q=L,N=y[L].charCodeAt(0);const U=h.primaryTable[N>>8];J[Q]=U<h.tbbase?U:h.unicodeTable[U-h.tbbase][N&255]}for(Q=0;Q<C;Q++){L=c(y,J,M,Q,F);M[Q]=L;D=A[D][L];N=D&240;D&=15;L=A[D][5];E[Q]=L;if(0<N){if(16===N)for(;G<Q;G++)E[G]=
1;G=-1}if(A[D][6])-1===G&&(G=Q);else if(-1<G){for(;G<Q;G++)E[G]=L;G=-1}J[Q]===h.ubatB&&(E[Q]=0);F.hiLevel|=L}if(F.hasUbatS)for(y=0;y<C;y++)if(J[y]===h.ubatS)for(E[y]=F.dir,A=y-1;0<=A;A--)if(J[A]===h.ubatWs)E[A]=F.dir;else break}function f(y,E){y=y.split("");if(E){const F=[];p(y,F,E);z=F}y.reverse();w.reverse();return y.join("")}function e(y){for(let E=0;E<h.arabicAlefBetIntervalsBegine.length;E++)if(y>=h.arabicAlefBetIntervalsBegine[E]&&y<=h.arabicAlefBetIntervalsEnd[E])return!0;return!1}function a(y,
E,F,C){for(;E*F<C&&d(y[E]);)E+=F;return E*F<C&&e(y[E])?!0:!1}function b(y,E,F,C){if(!(C.hiLevel<y))if(1!==y||1!==C.dir||C.hasUbatB){C=E.length;for(var A=0,D,G,J;A<C;){if(F[A]>=y){for(D=A+1;D<C&&F[D]>=y;)D++;for(G=D-1;A<G;A++,G--)J=E[A],E[A]=E[G],E[G]=J,J=w[A],w[A]=w[G],w[G]=J;A=D}A++}}else E.reverse(),w.reverse()}function c(y,E,F,C,A){return{UBAT_L:()=>{A.lastArabic=!1;return h.ubatL},UBAT_R:()=>{A.lastArabic=!1;return h.ubatR},UBAT_ON:()=>h.ubatOn,UBAT_AN:()=>h.ubatAn,UBAT_EN:()=>A.lastArabic?h.ubatAn:
h.ubatEn,UBAT_AL:()=>{A.lastArabic=!0;A.hasUbatAl=!0;return h.ubatR},UBAT_WS:()=>h.ubatOn,UBAT_CS:()=>{let D,G;if(1>C||C+1>=E.length||(D=F[C-1])!==h.ubatEn&&D!==h.ubatAn||(G=E[C+1])!==h.ubatEn&&G!==h.ubatAn)return h.ubatOn;A.lastArabic&&(G=h.ubatAn);return G===D?G:h.ubatOn},UBAT_ES:()=>(0<C?F[C-1]:h.ubatB)===h.ubatEn&&C+1<E.length&&E[C+1]===h.ubatEn?h.ubatEn:h.ubatOn,UBAT_ET:()=>{if(0<C&&F[C-1]===h.ubatEn)return h.ubatEn;if(A.lastArabic)return h.ubatOn;let D=C+1;const G=E.length;for(;D<G&&E[D]===
h.ubatEt;)D++;return D<G&&E[D]===h.ubatEn?h.ubatEn:h.ubatOn},UBAT_NSM:()=>{if("VLTR"===A.inFormat){for(var D=E.length,G=C+1;G<D&&E[G]===h.ubatNsm;)G++;if(G<D&&(D=y[C].charCodeAt(0),G=E[G],(1425<=D&&2303>=D||64286===D)&&(G===h.ubatR||G===h.ubatAl)))return h.ubatR}return 1>C||E[C-1]===h.ubatB?h.ubatOn:F[C-1]},UBAT_B:()=>{A.lastArabic=!0;A.hasUbatB=!0;return A.dir},UBAT_S:()=>{A.hasUbatS=!0;return h.ubatOn},UBAT_LRE:()=>{A.lastArabic=!1;return h.ubatOn},UBAT_RLE:()=>{A.lastArabic=!1;return h.ubatOn},
UBAT_LRO:()=>{A.lastArabic=!1;return h.ubatOn},UBAT_RLO:()=>{A.lastArabic=!1;return h.ubatOn},UBAT_PDF:()=>{A.lastArabic=!1;return h.ubatOn},UBAT_BN:()=>h.ubatOn}[h.typesNames[E[C]]]()}function m(y,E){for(let F=0;F<h.baseForm.length;F++)if(y===h.baseForm[F])return E[F];return y}function d(y){return"\u064b"<=y&&"\u0655">=y}function k(y){return"L"===y?"LTR":"R"===y?"RTL":"C"===y?"CLR":"D"===y?"CRL":""}function l(y,E){for(let F=0;F<h.aLefTable.length;F++)if(y===h.aLefTable[F])return E[F];return y}function r(y,
E,F,C){for(let A=0;A<y.length;A++)if(y[A]>E||!F&&y[A]===E)y[A]+=C}class u{constructor(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}bidiTransform(y,E,F){this.sourceToTarget=[];this.targetToSource=[];if(!y)return"";var C=this.sourceToTarget,A=this.targetToSource,D=y.length;w=[];z=[];for(var G=0;G<D;G++)C[G]=G,A[G]=G,w[G]=G;if(!this.checkParameters(E,F))return y;E=this.inputFormat;F=this.outputFormat;C=y;C=q;G=k(E.charAt(1));A=k(F.charAt(1));
var J="I"===E.charAt(0)?"L":E.charAt(0);D="I"===F.charAt(0)?"L":F.charAt(0);G=J+G;A=D+A;D=E.charAt(2)+F.charAt(2);C.defInFormat=G;C.defOutFormat=A;C.defSwap=D;y=g(y,G,A,D,C);C=!1;if("R"===F.charAt(1))C=!0;else if("C"===F.charAt(1)||"D"===F.charAt(1))C="rtl"===this.checkContextual(y);A=this.sourceToTarget=w;D=Array(A.length);for(G=0;G<A.length;G++)D[A[G]]=G;x=this.targetToSource=D;if(E.charAt(3)===F.charAt(3))C=y;else if("S"===F.charAt(3))if(E=C,F=!0,0===y.length)C="";else{void 0===E&&(E=!0);void 0===
F&&(F=!0);y=String(y);y=y.split("");D=0;C=1;A=y.length;E||(D=y.length-1,C=-1,A=1);var M=D;D=F;var L=0;G=[];for(J=0;M*C<A;M+=C)if(e(y[M])||d(y[M])){var Q;if(Q="\u0644"===y[M])b:{for(var N=y,U=M+C,Z=C,H=A;U*Z<H&&d(N[U]);)U+=Z;Q=" ";if(U*Z<H)for(Q=N[U],N=0;N<h.aLefTable.length;N++)if(h.aLefTable[N]===Q){Q=!0;break b}Q=!1}if(Q){y[M]=0===L?l(y[M+C],h.lamAlefInialTableFE):l(y[M+C],h.lamAlefMedialTableFE);M+=C;L=y;Q=M;N=C;for(U=A;Q*N<U&&d(L[Q]);)Q+=N;Q*N<U&&(L[Q]=" ");D&&(G[J]=M,J++);L=0}else{Q=y[M];if(1===
L){N=M;if(a(y,M+C,C,A))b:for(U=y[M],Z=0;Z<h.baseForm.length;Z++){if(U===h.baseForm[Z]){U=h.medialForm[Z];break b}}else U=m(y[M],h.finalForm);y[N]=U}else!0===a(y,M+C,C,A)?y[M]=m(y[M],h.initialForm):y[M]=m(y[M],h.isolatedForm);d(Q)||(L=1);b:{for(N=0;N<h.standAlonForm.length;N++)if(h.standAlonForm[N]===Q){Q=!0;break b}Q=!1}!0===Q&&(L=0)}}else L=0;C=G;A="";for(D=0;D<y.length;D++){if(G=F){b:{for(G=0;G<C.length;G++)if(C[G]===D)break b;G=-1}G=-1<G}G?(r(x,D,!E,-1),w.splice(D,1)):A+=y[D]}C=A}else if(E=y,F=
C,y=!0,0===E.length)C="";else for(void 0===y&&(y=!0),void 0===F&&(F=!0),E=String(E),C="",A=E.split(""),D=0;D<E.length;D++)G=!1,"\ufe70"<=A[D]&&"\ufeff">A[D]?(J=E.charCodeAt(D),"\ufef5"<=A[D]&&"\ufefc">=A[D]?(F?(0<D&&y&&" "===A[D-1]?C=C.substring(0,C.length-1)+"\u0644":(C+="\u0644",G=!0),C+=h.aLefTable[(J-65269)/2]):(C+=h.aLefTable[(J-65269)/2],C+="\u0644",D+1<E.length&&y&&" "===A[D+1]?D++:G=!0),G&&(r(x,D,!0,1),w.splice(D,0,w[D]))):C+=h.feTo06Table[J-65136]):C+=A[D];this.sourceToTarget=w;this.targetToSource=
x;this.levels=z;return C}_inputFormatSetter(y){if(!t.test(y))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=y}_outputFormatSetter(y){if(!t.test(y))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=y}checkParameters(y,E){y?this._inputFormatSetter(y):y=this.inputFormat;E?this._outputFormatSetter(E):E=this.outputFormat;return y===E?!1:!0}checkContextual(y){y=v(y);if("ltr"!==y&&"rtl"!==y){try{y=document.dir.toLowerCase()}catch(E){}"ltr"!==
y&&"rtl"!==y&&(y="ltr")}return y}hasBidiChar(y){return B.test(y)}}let w=[],x=[],z=[];const q={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},t=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,B=/[\u0591-\u06ff\ufb1d-\ufefc]/;return u})},"esri/core/bidiEngineTables":function(){define(["exports"],function(h){h.aLefTable=["\u0622","\u0623","\u0625","\u0627"];h.arabicAlefBetIntervalsBegine=
["\u0621","\u0641"];h.arabicAlefBetIntervalsEnd=["\u063a","\u064a"];h.baseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");h.feTo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
h.finalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");h.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];h.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];h.initialForm=
"\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");h.isolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
h.lamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];h.lamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];h.medialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");h.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];h.standAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");
h.swapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];
h.tbbase=100;h.typesNames="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");h.ubatAl=7;h.ubatAn=3;h.ubatB=5;h.ubatBn=18;h.ubatCs=9;h.ubatEn=2;h.ubatEs=10;h.ubatEt=11;h.ubatL=0;h.ubatLre=13;h.ubatLro=16;h.ubatNsm=12;h.ubatOn=4;h.ubatPdf=15;h.ubatR=1;h.ubatRle=14;h.ubatRlo=17;h.ubatS=6;h.ubatWs=8;h.unicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,
18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,
0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,
12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,
10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,
4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rasterizer":function(){define("../../core/mathUtils ./CIMSymbolHelper ./rasterizingUtils ./Rect ./SDFHelper ./utils".split(" "),
function(h,g,v,n,p,f){class e{constructor(a){this._resourceManager=a;this._lazyRasterizationCanvas=null}dispose(){this._lazyRasterizationCanvas=null}get _rasterizationCanvas(){null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement("canvas"),this._lazyRasterizationCanvas.getContext("2d",{willReadFrequently:!0}));return this._lazyRasterizationCanvas}rasterizeJSONResource(a,b,c){if("simple-fill"===a.type||"esriSFS"===a.type){const [q,t,B]=v.rasterizeSimpleFill(this._rasterizationCanvas,
a.style,b);return{size:[t,B],image:new Uint32Array(q.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:h.nextPowerOfTwo(Math.ceil(b))}}if("simple-line"===a.type||"esriSLS"===a.type||"line"===a.type&&a.dashTemplate){if("simple-line"===a.type||"esriSLS"===a.type)switch(b=g.slsDashToTemplateArray(a.style,a.cap),a.cap){case "butt":a="Butt";break;case "square":a="Square";break;default:a="Round"}else b=a.dashTemplate,a=a.cim.capStyle;const [q,t,B]=v.rasterizeDash(b,a);return{size:[t,
B],image:new Uint32Array(q.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,d=null,k=null,l=1;"simple-marker"===a.type||"esriSMS"===a.type||"line-marker"===a.type?(m=g.CIMSymbolHelper.fromSimpleMarker(a),k=p.getSDFInfo(m)):a.cim&&"CIMHatchFill"===a.cim.type?(m=g.CIMSymbolHelper.fromCIMHatchFill(a.cim,b),d=new n(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin),l=b):a.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===a.cim.markerPlacement.type?(m=g.CIMSymbolHelper.fromCIMInsidePolygon(a.cim),
d=new n(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=a.cim,a.avoidSDFRasterization||(k=p.getSDFInfo(m)));if(k&&!c){const [q,t,B]=p.buildSDF(k);return q?{size:[t,B],image:new Uint32Array(q.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:l}:null}const [r,u,w,x,z]=g.CIMSymbolHelper.rasterize(this._rasterizationCanvas,m,d,this._resourceManager,!c);return r?{size:[u,w],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!1,anchorX:x,anchorY:z}:
null}rasterizeImageResource(a,b,c,m){this._rasterizationCanvas.width=a;this._rasterizationCanvas.height=b;var d=this._rasterizationCanvas.getContext("2d");c instanceof ImageData?d.putImageData(c,0,0):(c.setAttribute("width",`${a}px`),c.setAttribute("height",`${b}px`),d.drawImage(c,0,0,a,b));c=d.getImageData(0,0,a,b);c=new Uint8Array(c.data);if(m)for(var k of m)if(k&&k.oldColor&&4===k.oldColor.length&&k.newColor&&4===k.newColor.length){const [l,r,u,w]=k.oldColor,[x,z,q,t]=k.newColor;if(l!==x||r!==
z||u!==q||w!==t)for(m=0;m<c.length;m+=4)l===c[m]&&r===c[m+1]&&u===c[m+2]&&w===c[m+3]&&(c[m]=x,c[m+1]=z,c[m+2]=q,c[m+3]=t)}for(m=0;m<c.length;m+=4)k=c[m+3]/255,c[m]*=k,c[m+1]*=k,c[m+2]*=k;d=c;k=a;m=b;if(512<=k||512<=m){d=k/m;1<d?(k=512,m=Math.round(512/d)):(m=512,k=Math.round(512*d));d=new Uint8Array(4*k*m);const l=new Uint8ClampedArray(d.buffer);f.resampleHermite(c,a,b,l,k,m,!1)}return{size:[k,m],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}return e})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../Color ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../support/arcadeOnDemand ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./enums ./utils ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q){function t(I,K,P){switch(K.type){case "CIMSymbolReference":return t(I,K.symbol,P);case "CIMPointSymbol":null==P&&(P={x:0,y:0});I.drawSymbol(K,P);break;case "CIMLineSymbol":null==P&&(P={paths:[[[0,0],[10,0]]]});I.drawSymbol(K,P);break;case "CIMPolygonSymbol":null==P&&(P={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});I.drawSymbol(K,P);break;case "CIMTextSymbol":I.drawSymbol(K,{x:0,y:0});break;case "CIMVectorMarker":P=new k.Placement,I.drawMarker(K,P)}return I.envelope()}
function B(I){if(!I)return 0;switch(I.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(I.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(I.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(I.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(I.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(I.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(I.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(I.offset);
case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function y(I){if(!I)return 0;switch(I.type){case "CIMGeometricEffectArrow":return Math.abs(.5*I.width);case "CIMGeometricEffectBuffer":return Math.abs(I.size);case "CIMGeometricEffectExtension":return Math.abs(I.length);case "CIMGeometricEffectJog":return Math.abs(.5*I.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(u.getValue(I.offsetX)),Math.abs(u.getValue(I.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(I.offset);
case "CIMGeometricEffectOffsetTangent":return Math.abs(I.offset);case "CIMGeometricEffectRadial":return Math.abs(I.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(I.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(I.fromWidth),Math.abs(I.toWidth));case "CIMGeometricEffectWave":return Math.abs(I.amplitude);case "CIMGeometricEffectDonut":return Math.abs(I.width);default:return 0}}
function E(I){if(!I)return 0;let K=0;for(const P of I)K+=y(P);return K}function F(I,K,P){I.effects&&null==K.geometryEngine&&(K.geometryEnginePromise?P.push(K.geometryEnginePromise):u.isGeometryEngineRequired(I.effects)&&(K.geometryEnginePromise=u.importGeometryEngine(),P.push(K.geometryEnginePromise),K.geometryEnginePromise.then(W=>K.geometryEngine=W)))}function C(I){if(!I)return null;let K=null;const {cap:P,color:W,join:aa,miterLimit:R,style:S,width:Y}=I;"solid"!==S&&"none"!==S&&"esriSLSSolid"!==
S&&"esriSLSNull"!==S&&(K=[{type:"CIMGeometricEffectDashes",dashTemplate:V(S,P),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==S&&"none"!==S?T(W):[0,0,0,0],capStyle:U(P),joinStyle:Z(aa),miterLimit:R,width:Y,effects:K}}const A=Math.PI,D=A/2,G=Math.PI/180,J=96/72,M=f.getLogger("esri.symbols.cim.CIMSymbolHelper");class L{getSymbolInflateSize(I,K,P,W,aa){I||(I=[0,0,0,0]);return K?this._getInflateSize(I,K,P,W,aa):I}static safeSize(I){const K=
Math.max(Math.abs(I[0]),Math.abs(I[2]));I=Math.max(Math.abs(I[1]),Math.abs(I[3]));return Math.sqrt(K*K+I*I)}_vectorMarkerBounds(I,K,P,W){let aa=!0;const R=b.create();if(K?.markerGraphics)for(const S of K.markerGraphics)K=[0,0,0,0],S.geometry&&(c.getBoundsXY(R,S.geometry),K[0]=0,K[1]=0,K[2]=0,K[3]=0,this.getSymbolInflateSize(K,S.symbol,P,0,W),R[0]+=K[0],R[1]+=K[1],R[2]+=K[2],R[3]+=K[3],aa?(I[0]=R[0],I[1]=R[1],I[2]=R[2],I[3]=R[3],aa=!1):(I[0]=Math.min(I[0],R[0]),I[1]=Math.min(I[1],R[1]),I[2]=Math.max(I[2],
R[2]),I[3]=Math.max(I[3],R[3])));return I}_getInflateSize(I,K,P,W,aa){return void 0!==K.symbolLayers?(I=this._getLayersInflateSize(I,K.symbolLayers,P,W,aa),K=E(K.effects),0<K&&(I[0]-=K,I[1]-=K,I[2]+=K,I[3]+=K),I):this._getTextInflatedSize(I,K,aa)}_getLayersInflateSize(I,K,P,W,aa){let R=!0;if(!K)return I;for(const fa of K)if(fa){K=[0,0,0,0];switch(fa.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var S=fa,Y=S.width;null!=Y&&(Y=S.capStyle===r.LineCapStyle.Square||S.joinStyle===
r.LineJoinStyle.Miter?Y/1.4142135623730951:Y/2,K[0]=-Y,K[1]=-Y,K[2]=Y,K[3]=Y);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":S=fa;if("CIMVectorMarker"===fa.type){if(Y=fa,K=this._vectorMarkerBounds(K,Y,P,aa),Y.frame){var ba=(Y.frame.xmin+Y.frame.xmax)/2,ca=(Y.frame.ymin+Y.frame.ymax)/2;K[0]-=ba;K[1]-=ca;K[2]-=ba;K[3]-=ca;null!=Y.size&&(Y=Y.size/(Y.frame.ymax-Y.frame.ymin),K[0]*=Y,K[1]*=Y,K[2]*=Y,K[3]*=Y)}}else"CIMPictureMarker"===fa.type?(Y=fa,ca=P.getResource(Y.url),
ba=1,null!=ca&&ca.height&&(ba=ca.width/ca.height),null!=S.size&&(K=S.size/2,Y=S.size*ba*Y.scaleX/2,K=[-Y,-K,Y,K])):null!=S.size&&(K=S.size/2,K=[-K,-K,K,K]);S.anchorPoint&&("Absolute"===S.anchorPointUnits?(Y=S.anchorPoint.x,ba=S.anchorPoint.y):(Y=S.anchorPoint.x*(K[2]-K[0]),ba=S.anchorPoint.y*(K[3]-K[1])),K[0]-=Y,K[1]-=ba,K[2]-=Y,K[3]-=ba);Y=u.getValue(S.rotation);S.rotateClockwise&&(Y=-Y);W&&(Y-=W);Y&&(ba=G*Y,Y=Math.cos(ba),ba=Math.sin(ba),ca=b.create([x.cInfinity,x.cInfinity,-x.cInfinity,-x.cInfinity]),
b.expandPointInPlace(ca,[K[0]*Y-K[1]*ba,K[0]*ba+K[1]*Y]),b.expandPointInPlace(ca,[K[0]*Y-K[3]*ba,K[0]*ba+K[3]*Y]),b.expandPointInPlace(ca,[K[2]*Y-K[1]*ba,K[2]*ba+K[1]*Y]),b.expandPointInPlace(ca,[K[2]*Y-K[3]*ba,K[2]*ba+K[3]*Y]),K=ca);Y=u.getValue(S.offsetX);ba=u.getValue(S.offsetY);if(W){var da=G*W;ca=Math.cos(da);da=Math.sin(da);const ea=Y*da+ba*ca;Y=Y*ca-ba*da;ba=ea}K[0]+=Y;K[1]+=ba;K[2]+=Y;K[3]+=ba;S=B(S.markerPlacement);0<S&&(K[0]-=S,K[1]-=S,K[2]+=S,K[3]+=S)}S=E(fa.effects);0<S&&(K[0]-=S,K[1]-=
S,K[2]+=S,K[3]+=S);R?(I[0]=K[0],I[1]=K[1],I[2]=K[2],I[3]=K[3],R=!1):(I[0]=Math.min(I[0],K[0]),I[1]=Math.min(I[1],K[1]),I[2]=Math.max(I[2],K[2]),I[3]=Math.max(I[3],K[3]))}return I}_getTextInflatedSize(I,K,P){const W=K.height??l.defaultTextHeight;I[0]=-W/2;I[1]=-W/2;I[2]=W/2;I[3]=W/2;if(!P)return I;P=P.get(K);if(!P)return I;const {text:aa,mosaicItem:R}=P;if(!R?.glyphMosaicItems?.length)return I;const {lineGapType:S,lineGap:Y}=K;P=S?l.lineGapType2LineHeight(S,Y??0,W):0;const ba=v.bidiText(aa)[1],ca=
"CIMBackgroundCallout"===K.callout?.type;K=q.shapeGlyphs(R.glyphMosaicItems,ba,{scale:W/z.glyphSize,angle:u.getValue(K.angle),xOffset:u.getValue(K.offsetX),yOffset:u.getValue(K.offsetY),hAlign:l.horizontalAlignment2HAlign(K.horizontalAlignment),vAlign:l.verticalAlignment2VAlign(K.verticalAlignment),maxLineWidth:512,lineHeight:z.magicLabelLineHeight*Math.max(.25,Math.min(P||1,4)),decoration:K.font.decoration||"none",isCIM:!0,hasBackground:ca}).boundsT;I[0]=K.x-K.halfWidth;I[1]=-K.y-K.halfHeight;I[2]=
K.x+K.halfWidth;I[3]=-K.y+K.halfHeight;return I}}class Q{static getEnvelope(I,K,P){if(!I)return null;P=new l.EnvDrawHelper(P);if(Array.isArray(I)){let W;for(const aa of I)W?W.union(t(P,aa,K)):W=t(P,aa,K);return W}return t(P,I,K)}static getTextureAnchor(I,K){I=this.getEnvelope(I,null,K);if(!I)return[0,0,0];K=I.height*J+2;return[-((I.x+.5*I.width)*J)/(I.width*J+2),-((I.y+.5*I.height)*J)/K,K]}static rasterize(I,K,P,W,aa=!0){var R=P||this.getEnvelope(K,null,W);if(!R)return[null,0,0,0,0];const S=(R.x+
.5*R.width)*J,Y=(R.y+.5*R.height)*J;I.width=R.width*J;I.height=R.height*J;P||(I.width+=2,I.height+=2);P=I.getContext("2d");R=l.Transformation.createScale(J,-J);R.translate(.5*I.width-S,.5*I.height+Y);W=new l.CanvasDrawHelper(P,W,R);switch(K.type){case "CIMPointSymbol":W.drawSymbol(K,{type:"point",x:0,y:0});break;case "CIMVectorMarker":R=new k.Placement,W.drawMarker(K,R)}K=P.getImageData(0,0,I.width,I.height);K=new Uint8Array(K.data);if(aa)for(W=0;W<K.length;W+=4)aa=K[W+3]/255,K[W]*=aa,K[W+1]*=aa,
K[W+2]*=aa;return[K,I.width,I.height,-S/I.width,-Y/I.height]}static fromTextSymbol(I){const {angle:K,color:P,font:W,haloColor:aa,haloSize:R,horizontalAlignment:S,kerning:Y,text:ba,verticalAlignment:ca,xoffset:da,yoffset:fa,backgroundColor:ea,borderLineColor:ha,borderLineSize:ia}=I;let ka,la,ma;if(W){var na=W.family;var ra=W.style;var sa=W.weight;ka=W.size;la=W.decoration}I=!1;ba&&(I=v.bidiText(ba)[1]);if(ea||ia)ma={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",
symbolLayers:[{type:"CIMSolidFill",color:T(ea)},{type:"CIMSolidStroke",color:T(ha),width:ia}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var ua=r.BlockProgression.BTT,pa=r.FontEffects.Normal,Aa=r.FontEncoding.Unicode;na=na||"Arial";b:{if(sa)switch(sa.toLowerCase()){case "bold":case "bolder":sa="bold";break b}sa=""}b:{if(ra)switch(ra.toLowerCase()){case "italic":case "oblique":ra="italic";break b}ra=""}sa=sa&&ra?`${sa}-${ra}`:`${sa}${ra}`;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",
enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:K,blockProgression:ua,depth3D:1,extrapolateBaselines:!0,fontEffects:pa,fontEncoding:Aa,fontFamilyName:na,fontStyleName:sa,fontType:r.FontType.Unspecified,haloSize:R,height:ka,hinting:r.GlyphHinting.Default,horizontalAlignment:H(S??"center"),kerning:Y,letterWidth:100,
ligatures:!0,lineGapType:"Multiple",offsetX:u.getValue(da),offsetY:u.getValue(fa),strikethrough:"line-through"===la,underline:"underline"===la,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T(P)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T(aa)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:I?r.TextReadingDirection.RTL:r.TextReadingDirection.LTR,verticalAlignment:O(ca??"baseline"),
verticalGlyphOrientation:r.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:r.BillBoardMode.FaceNearPlane,callout:ma},textString:ba}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(I){const {height:K,outline:P,width:W,xoffset:aa,xscale:R,yoffset:S,yscale:Y}=I,ba=[],ca={type:"CIMPolygonSymbol",symbolLayers:ba};if(P){var da=C(P);da&&ba.push(da)}da=I.url;"esriPFS"===I.type&&I.imageData&&(da=I.imageData);I="angle"in I?I.angle??
0:0;ba.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:r.TextureFilter.Picture,tintColor:null,url:da,height:(K??0)*(Y||1),width:(W??0)*(R||1),offsetX:u.getValue(aa),offsetY:u.getValue(S),rotation:u.getValue(-I),colorSubstitutions:null});return ca}static fromSimpleFillSymbol(I){const {color:K,style:P,outline:W}=I;I=[];const aa={type:"CIMPolygonSymbol",symbolLayers:I};if(W){var R=C(W);R&&I.push(R)}if(P&&"solid"!==P&&"none"!==P&&"esriSFSSolid"!==P&&"esriSFSNull"!==P){R={type:"CIMLineSymbol",
symbolLayers:[{type:"CIMSolidStroke",color:T(K),capStyle:r.LineCapStyle.Butt,joinStyle:r.LineJoinStyle.Miter,width:.75}]};let S=0;const Y=a.px2pt("vertical"===P||"horizontal"===P||"cross"===P||"esriSFSCross"===P||"esriSFSVertical"===P||"esriSFSHorizontal"===P?8:10);switch(P){case "vertical":case "esriSFSVertical":S=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":S=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":S=45;break;case "cross":case "esriSFSCross":S=0;break;
case "diagonal-cross":case "esriSFSDiagonalCross":S=-45}I.push({type:"CIMHatchFill",lineSymbol:R,offsetX:0,offsetY:0,rotation:S,separation:Y});"cross"===P||"esriSFSCross"===P?I.push({type:"CIMHatchFill",lineSymbol:p.clone(R),offsetX:0,offsetY:0,rotation:90,separation:Y}):("diagonal-cross"===P||"esriSFSDiagonalCross"===P)&&I.push({type:"CIMHatchFill",lineSymbol:p.clone(R),offsetX:0,offsetY:0,rotation:45,separation:Y})}else!P||"solid"!==P&&"esriSFSSolid"!==P||I.push({type:"CIMSolidFill",enable:!0,color:T(K)});
return aa}static fromSimpleLineSymbol(I){const {cap:K,color:P,join:W,marker:aa,miterLimit:R,style:S,width:Y}=I;I=null;"solid"!==S&&"none"!==S&&"esriSLSSolid"!==S&&"esriSLSNull"!==S&&(I=[{type:"CIMGeometricEffectDashes",dashTemplate:V(S,K),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const ba=[];if(aa){let ca;switch(aa.placement){case "begin-end":ca=r.ExtremityPlacement.Both;break;case "begin":ca=r.ExtremityPlacement.JustBegin;break;case "end":ca=r.ExtremityPlacement.JustEnd;
break;default:ca=r.ExtremityPlacement.None}const da=Q.fromSimpleMarker(aa,Y,P).symbolLayers[0];da.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:ca,offsetAlongLine:0};ba.push(da)}ba.push({type:"CIMSolidStroke",color:"none"!==S&&"esriSLSNull"!==S?T(P):[0,0,0,0],capStyle:U(K),joinStyle:Z(W),miterLimit:R,width:Y,effects:I});return{type:"CIMLineSymbol",symbolLayers:ba}}static fromPictureMarker(I){const {angle:K,height:P,width:W,xoffset:aa,yoffset:R}=
I;let S=I.url;"esriPMS"===I.type&&I.imageData&&(S=I.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:r.TextureFilter.Picture,tintColor:null,url:S,size:P,width:W,offsetX:u.getValue(aa),offsetY:u.getValue(R),rotation:u.getValue(-K)}]}}static fromSimpleMarker(I,K,P){var {style:W}=I;P=I.color??P;if("path"===W){K=[];if("outline"in I&&I.outline){var aa=I.outline;K.push({type:"CIMSolidStroke",enable:!0,width:a.pt2px(Math.round(a.px2pt(aa.width))),
color:T(aa.color),path:I.path})}K.push({type:"CIMSolidFill",enable:!0,color:T(P),path:I.path});const [Y,ba]=X("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:u.getValue(-I.angle),size:u.getValue(I.size||6),offsetX:u.getValue(I.xoffset),offsetY:u.getValue(I.yoffset),frame:Y,markerGraphics:[{type:"CIMMarkerGraphic",geometry:ba,symbol:{type:"CIMPolygonSymbol",symbolLayers:K}}]}]}}aa=[];let R;if("outline"in I&&I.outline&&"none"!==I.outline.style&&"esriSLSNull"!==
I.outline.style){const Y=I.outline,ba="solid"!==Y.style&&"esriSLSSolid"!==Y.style;[W,R]=ba?X(W,I.size):X(W);var S="cross"!==I.style&&"x"!==I.style||"dot"===I?.outline.style||"short-dot"===I?.outline.style?r.LineDashEnding.HalfGap:r.LineDashEnding.FullPattern;S=ba?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:V(Y.style,null).map(ca=>Y.width&&0<Y.width?ca*Y.width:ca),lineDashEnding:S,controlPointEnding:r.LineDashEnding.FullPattern}]:void 0;aa.push({type:"CIMSolidStroke",
capStyle:ba?r.LineCapStyle.Round:r.LineCapStyle.Butt,enable:!0,width:null!=Y.width&&.667<Y.width?a.pt2px(Math.round(a.px2pt(Y.width))):Y.width,color:T(Y.color),effects:S})}else!K||"line-marker"!==I.type||"cross"!==I.style&&"x"!==I.style?[W,R]=X(W):([W,R]=X(W),aa.push({type:"CIMSolidStroke",enable:!0,width:K,color:T(P)}));aa.push({type:"CIMSolidFill",enable:!0,color:T(P)});P={type:"CIMPolygonSymbol",symbolLayers:aa};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:u.getValue(-I.angle),
size:u.getValue(I.size||6*K),offsetX:u.getValue(I.xoffset),offsetY:u.getValue(I.yoffset),frame:W,markerGraphics:[{type:"CIMMarkerGraphic",geometry:R,symbol:P}]}]}}static fromCIMHatchFill(I,K){const P=K*(I.separation??l.defaultHatchFillSeparation),W=P/2;I=p.clone(I.lineSymbol);I.symbolLayers?.forEach(R=>{switch(R.type){case "CIMSolidStroke":null!=R.width&&(R.width*=K);R.effects?.forEach(S=>{"CIMGeometricEffectDashes"===S.type&&(S.dashTemplate=S.dashTemplate.map(Y=>Y*K))});break;case "CIMVectorMarker":null!=
R.size&&(R.size*=K),R=R.markerPlacement,null!=R&&"placementTemplate"in R&&(R.placementTemplate=R.placementTemplate.map(S=>S*K))}});for(var aa=this._getLineSymbolPeriod(I)||4;4>aa;)aa*=2;aa/=2;return{type:"CIMVectorMarker",frame:{xmin:-aa,xmax:aa,ymin:-W,ymax:W},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-aa,0],[aa,0]]]},symbol:I}],size:P}}static fetchResources(I,K,P){if(I&&K)switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(I=I.symbolLayers)for(const W of I)switch(F(W,
K,P),W.type){case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMCharacterMarker":case "CIMPictureMarker":"url"in W&&W.url&&P.push(K.fetchResource(W.url,null));break;case "CIMVectorMarker":if(I=W.markerGraphics)for(const aa of I)aa&&(I=aa.symbol)&&Q.fetchResources(I,K,P)}}}static fetchFonts(I,K,P){if(I&&K)if("symbolLayers"in I&&I.symbolLayers)for(const R of I.symbolLayers){if("CIMVectorMarker"===R.type&&R.markerGraphics)for(const S of R.markerGraphics)S?.symbol&&
Q.fetchFonts(S.symbol,K,P)}else if("CIMTextSymbol"===I.type){const {fontFamilyName:R,fontStyleName:S}=I;if(R&&"calcitewebcoreicons"!==R.toLowerCase()){var {style:W,weight:aa}=u.fromCIMFontStyle(S);I=u.fromCIMFontDecoration(I);I=new d({family:R,style:W,weight:aa,decoration:I});P.push(K.loadFont(I).catch(()=>{M.error(`Unsupported font ${R} in CIM symbol`)}))}}}static _getLineSymbolPeriod(I){if(I){const K=this._getEffectsRepeat(I.effects);if(K)return K;if(I.symbolLayers)for(const P of I.symbolLayers)if(P){if(I=
this._getEffectsRepeat(P.effects))return I;switch(P.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(I=this._getPlacementRepeat(P.markerPlacement))return I}}}return 0}static _getEffectsRepeat(I){if(I)for(var K of I)if(K)switch(K.type){case "CIMGeometricEffectDashes":if((I=K.dashTemplate)&&I.length){K=0;for(const P of I)K+=P;I.length&1&&(K*=2);return K}break;case "CIMGeometricEffectWave":return K.period;default:M.error(`unsupported geometric effect type ${K.type}`)}return 0}static _getPlacementRepeat(I){if(I)switch(I.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((I=
I.placementTemplate)&&I.length){let K=0;for(const P of I)K+=+P;I.length&1&&(K*=2);return K}}return 0}static fromCIMInsidePolygon(I){var K=I.markerPlacement;const P={...I,markerPlacement:null,anchorPoint:null};I=Math.abs(K.stepX);const W=Math.abs(K.stepY);var aa=(K.randomness??100)/100;let R,S;if("Random"===K.gridType){var Y=a.px2pt(z.randomInsidePolygonTextureSize);const ba=Math.max(Math.floor(Y/I),1),ca=Math.max(Math.floor(Y/W),1);Y=ba*I/2;R=ca*W/2;S=2*R;K=new e(K.seed);const da=aa*I/1.5,fa=aa*W/
1.5;aa=[];for(let ea=0;ea<ba;ea++)for(let ha=0;ha<ca;ha++){const ia=ea*I-Y+da*(.5-K.getFloat()),ka=ha*W-R+fa*(.5-K.getFloat());aa.push({x:ia,y:ka});0===ea&&aa.push({x:ia+2*Y,y:ka});0===ha&&aa.push({x:ia,y:ka+2*R})}}else!0===K.shiftOddRows?(Y=I/2,R=W,S=2*W,aa=[{x:-Y,y:0},{x:Y,y:0},{x:0,y:R},{x:0,y:-R}]):(Y=I/2,R=W/2,S=W,aa=[{x:-I,y:0},{x:0,y:-W},{x:-I,y:-W},{x:0,y:0},{x:I,y:0},{x:0,y:W},{x:I,y:W},{x:-I,y:W},{x:I,y:-W}]);I=aa.map(ba=>({type:"CIMMarkerGraphic",geometry:ba,symbol:{type:"CIMPointSymbol",
symbolLayers:[P]}}));return{type:"CIMVectorMarker",frame:{xmin:-Y,xmax:Y,ymin:-R,ymax:R},markerGraphics:I,size:S}}static getSize(I){if(I)switch(I.type){case "CIMTextSymbol":return I.height;case "CIMPointSymbol":var K=0;if(I.symbolLayers)for(var P of I.symbolLayers)if(P)switch(P.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":I=P.size,null!=I&&I>K&&(K=I)}return K;case "CIMLineSymbol":case "CIMPolygonSymbol":P=0;if(I.symbolLayers)for(K of I.symbolLayers)if(K)switch(K.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":I=
K.width;null!=I&&I>P&&(P=I);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":K.markerPlacement&&u.isCIMMarkerStrokePlacement(K.markerPlacement)&&(I=K.size,null!=I&&I>P&&(P=I))}return P}}static getMarkerScaleRatio(I){if(I)switch(I.type){case "CIMVectorMarker":if(!1!==I.scaleSymbolsProportionally&&I.frame&&null!=I.size)return I.size/(I.frame.ymax-I.frame.ymin)}return 1}}class N{static findApplicableOverrides(I,K,P){if(I&&
K){if(I.primitiveName){let W=!1;for(const aa of P)if(aa.primitiveName===I.primitiveName){W=!0;break}if(!W)for(const aa of K)aa.primitiveName===I.primitiveName&&P.push(aa)}switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(I.effects)for(const W of I.effects)N.findApplicableOverrides(W,K,P);if(I.symbolLayers)for(const W of I.symbolLayers)N.findApplicableOverrides(W,K,P);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(I.effects)for(const W of I.effects)N.findApplicableOverrides(W,
K,P);I.markerPlacement&&N.findApplicableOverrides(I.markerPlacement,K,P);if("CIMVectorMarker"===I.type){if(I.markerGraphics)for(const W of I.markerGraphics)N.findApplicableOverrides(W,K,P),N.findApplicableOverrides(W.symbol,K,P)}else"CIMCharacterMarker"===I.type?N.findApplicableOverrides(I.symbol,K,P):"CIMHatchFill"===I.type?N.findApplicableOverrides(I.lineSymbol,K,P):"CIMPictureMarker"===I.type&&N.findApplicableOverrides(I.animatedSymbolProperties,K,P)}}}static findEffectOverrides(I,K,P){if(K&&I){var W=
I.length;for(let aa=0;aa<W;aa++){const R=I[aa]?.primitiveName;if(R){let S=!1;for(const Y of P)if(Y.primitiveName===R){S=!0;break}if(!S)for(const Y of K)Y.primitiveName===R&&P.push(Y)}}}}static async resolveSymbolOverrides(I,K,P,W,aa,R,S){if(!I?.symbol)return null;let {symbol:Y,primitiveOverrides:ba}=I;I=!!ba;if(!I&&!W)return Y;Y=p.clone(Y);let ca=!0;K||(K={attributes:{}},ca=!1);I&&(ca||(ba=ba.filter(da=>!da.valueExpressionInfo?.expression.includes("$feature"))),S||(ba=ba.filter(da=>!da.valueExpressionInfo?.expression.includes("$view"))),
0<ba.length&&(I=u.attributesToFields(K.attributes),await N.evaluateOverrides(ba,K,{spatialReference:P,fields:I,geometryType:aa},R,S)),N.applyOverrides(Y,ba));W&&N.applyDictionaryTextOverrides(Y,K,W);return Y}static async evaluateOverrides(I,K,P,W,aa){if(K){var R;for(const S of I)(I=S.valueExpressionInfo)&&P?.geometryType&&(R||(R=[]),S.value=void 0,I=m.createRendererExpression(I.expression,P.spatialReference,P.fields).then(Y=>{S.value=w(Y,K,{$view:aa},P.geometryType,W)}),R.push(I));void 0!==R&&0<R.length&&
await Promise.all(R)}}static applyDictionaryTextOverrides(I,K,P,W="Normal"){if(I?.type)switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":case "CIMTextSymbol":var aa=I.symbolLayers;if(!aa)break;for(var R of aa)R&&"CIMVectorMarker"===R.type&&N.applyDictionaryTextOverrides(R,K,P,"CIMTextSymbol"===I.type?I.textCase:W);break;case "CIMVectorMarker":I=I.markerGraphics;if(!I)break;for(aa of I)aa&&N.applyDictionaryTextOverrides(aa,K,P);break;case "CIMMarkerGraphic":(R=I.textString)&&
R.includes("[")&&(P=u.analyzeTextParts(R,P),I.textString=u.assignTextValuesFromFeature(K,P,W))}}static applyOverrides(I,K,P,W){if(I.primitiveName)for(const R of K)if(R.primitiveName===I.primitiveName){var aa=(aa=R.propertyName)?aa.charAt(0).toLowerCase()+aa.substr(1):aa;W&&W.push({cim:I,nocapPropertyName:aa,value:I[aa]});R.expression&&(R.value=N.toValue(R.propertyName,R.expression));if(P){let S=!1;for(const Y of P)Y.primitiveName===I.primitiveName&&(S=!0);S||P.push(R)}null!=R.value&&(I[aa]=R.value)}switch(I.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(I.effects)for(const R of I.effects)N.applyOverrides(R,
K,P,W);if(I.symbolLayers)for(const R of I.symbolLayers)N.applyOverrides(R,K,P,W);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(I.effects)for(const R of I.effects)N.applyOverrides(R,K,P,W);if("CIMVectorMarker"===I.type&&I.markerGraphics)for(const R of I.markerGraphics)N.applyOverrides(R,K,P,W),N.applyOverrides(R.symbol,K,P,W)}}static restoreOverrides(I){for(const K of I)K.cim[K.nocapPropertyName]=K.value}static buildOverrideKey(I){let K="";for(const P of I)void 0!==P.value&&
(K+=`${P.primitiveName}${P.propertyName}${JSON.stringify(P.value)}`);return K}static toValue(I,K){return"DashTemplate"===I?K.split(" ").map(P=>Number(P)):"Color"===I?(I=(new g(K)).toRgba(),I[3]*=255,I):K}}const U=I=>{if(!I)return r.LineCapStyle.Butt;switch(I){case "butt":return r.LineCapStyle.Butt;case "square":return r.LineCapStyle.Square;case "round":return r.LineCapStyle.Round}},Z=I=>{if(!I)return r.LineJoinStyle.Miter;switch(I){case "miter":return r.LineJoinStyle.Miter;case "round":return r.LineJoinStyle.Round;
case "bevel":return r.LineJoinStyle.Bevel}},H=I=>{if(null==I)return"Center";switch(I){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},O=I=>{if(null==I)return"Center";switch(I){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},T=I=>{if(!I)return[0,0,0,0];const {r:K,g:P,b:W,a:aa}=I;return[K,P,W,255*aa]},V=(I,K)=>{const P=n("safari")?.001:0;K="butt"===K;switch(I){case "dash":case "esriSLSDash":return K?
[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return K?[4,3,1,3]:[3,4,P,4];case "dot":case "esriSLSDot":return K?[1,3]:[P,4];case "long-dash":case "esriSLSLongDash":return K?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return K?[8,3,1,3]:[7,4,P,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return K?[8,3,1,3,1,3]:[7,4,P,4,P,4];case "short-dash":case "esriSLSShortDash":return K?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return K?[4,1,1,1]:[3,2,P,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return K?
[4,1,1,1,1,1]:[3,2,P,2,P,2];case "short-dot":case "esriSLSShortDot":return K?[1,1]:[P,2];case "solid":case "esriSLSSolid":case "none":return M.error("Unexpected: style does not require rasterization"),[0,0];default:return M.error(`Tried to rasterize SLS, but found an unexpected style: ${I}!`),[0,0]}},X=(I,K=100)=>{var P=K/2,W;if("circle"===I||"esriSMSCircle"===I){var aa=Math.acos(1-.25/P);K=Math.ceil(A/aa/4);0===K&&(K=1);aa=D/K;K*=4;I=[];I.push([P,0]);for(W=1;W<K;W++)I.push([P*Math.cos(W*aa),-P*Math.sin(W*
aa)]);I.push([P,0]);aa={rings:[I]};W={xmin:-P,ymin:-P,xmax:P,ymax:P}}else"cross"===I||"esriSMSCross"===I?(aa={paths:[[[0,P],[0,-P]],[[P,0],[-P,0]]]},W={xmin:-P,ymin:-P,xmax:P,ymax:P}):"diamond"===I||"esriSMSDiamond"===I?(aa={rings:[[[-P,0],[0,P],[P,0],[0,-P],[-P,0]]]},W={xmin:-P,ymin:-P,xmax:P,ymax:P}):"square"===I||"esriSMSSquare"===I?(aa={rings:[[[-P,-P],[-P,P],[P,P],[P,-P],[-P,-P]]]},W={xmin:-P,ymin:-P,xmax:P,ymax:P}):"x"===I||"esriSMSX"===I?(aa={paths:[[[P,P],[-P,-P]],[[P,-P],[-P,P]]]},W={xmin:-P,
ymin:-P,xmax:P,ymax:P}):"triangle"===I||"esriSMSTriangle"===I?(P=.5773502691896257*K,I=-P,W=2/3*K,K=W-K,aa={rings:[[[I,K],[0,W],[P,K],[I,K]]]},W={xmin:I,ymin:K,xmax:P,ymax:W}):"arrow"===I&&(aa={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},W={xmin:-P,ymin:-P,xmax:P,ymax:P});return[W,aa]};h.CIMSymbolHelper=Q;h.CIMSymbolInflatedSizeHelper=L;h.OverrideHelper=N;h.getEffectsInflateSize=E;h.slsDashToTemplateArray=V;h.symbolToCIM=function(I){if(!I?.type)return null;let K;switch(I.type){case "cim":return I.data;
case "web-style":return I;case "simple-marker":I=Q.fromSimpleMarker(I);if(!I)return null;K=I;break;case "picture-marker":K=Q.fromPictureMarker(I);break;case "simple-line":K=Q.fromSimpleLineSymbol(I);break;case "simple-fill":K=Q.fromSimpleFillSymbol(I);break;case "picture-fill":K=Q.fromPictureFillSymbol(I);break;case "text":K=Q.fromTextSymbol(I)}return{type:"CIMSymbolReference",symbol:K}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],
function(h){class g{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(n,p){this.tx=n;this.ty=p}setTranslateZ(n){this.tz=n}setRotateCS(n,p){this.rz=void 0;this.rzCos=n;this.rzSin=p}setRotate(n){this.rz=n;this.rzSin=this.rzCos=void 0}setRotateY(n){this.ry=n}setScale(n){this.s=
n}setMeasure(n){this.m=n}}class v{next(){return null}}h.EmptyPlacementCursor=v;h.Placement=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/BidiText ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/alignmentUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B,y,E){function F(H,O=1){const T=t.fromCIMFontDecoration(H);var V=t.fromCIMFontStyle(H.fontStyleName);const X=H.fontFamilyName??v.defaultFontFamily,{weight:I,style:K}=V;V=O*(H.height||5);const P=t.fromCIMHorizontalAlignment(H.horizontalAlignment),W=t.fromCIMVerticalAlignment(H.verticalAlignment),aa=t.getFillColor(H),R=t.getFillColor(H.haloSymbol);O=R?O*(H.haloSize|0):0;var S="CIMBackgroundCallout"===H.callout?.type?H.callout.backgroundSymbol:null;
H=t.getFillColor(S);const Y=t.getStrokeWidth(S);S=t.getStrokeColor(S);return{color:aa,size:V,horizontalAlignment:P,verticalAlignment:W,font:{family:X,style:t.getFontStyle(K),weight:t.getFontWeight(I),decoration:T},halo:{size:O||0,color:R,style:K},backgroundColor:H,borderLine:null!=Y&&null!=S?{size:Y,color:S}:null,pixelRatio:1,premultiplyColors:!0}}const C=Math.PI/180,A=p.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class D{constructor(H){this._t=H}static createIdentity(){return new D([1,0,0,
0,1,0])}clone(){return new D(this._t.slice())}transform(H){const O=this._t;return[O[0]*H[0]+O[1]*H[1]+O[2],O[3]*H[0]+O[4]*H[1]+O[5]]}static createScale(H,O){return new D([H,0,0,0,O,0])}scale(H,O){const T=this._t;T[0]*=H;T[1]*=H;T[2]*=H;T[3]*=O;T[4]*=O;T[5]*=O;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(H,O){return new D([0,0,H,0,0,O])}translate(H,O){const T=this._t;T[2]+=H;T[5]+=O;return this}static createRotate(H){const O=Math.cos(H);
H=Math.sin(H);return new D([O,-H,0,H,O,0])}rotate(H){return D.multiply(this,D.createRotate(H),this)}angle(){const H=this._t[0],O=this._t[3],T=Math.sqrt(H*H+O*O);return[H/T,O/T]}static multiply(H,O,T){H=H._t;O=O._t;const V=H[1]*O[0]+H[4]*O[1],X=H[2]*O[0]+H[5]*O[1]+O[2],I=H[0]*O[3]+H[3]*O[4],K=H[1]*O[3]+H[4]*O[4],P=H[2]*O[3]+H[5]*O[4]+O[5],W=T._t;W[0]=H[0]*O[0]+H[3]*O[1];W[1]=V;W[2]=X;W[3]=I;W[4]=K;W[5]=P;return T}invert(){const H=this._t;let O=H[0]*H[4]-H[1]*H[3];if(0===O)return new D([0,0,0,0,0,0]);
O=1/O;return new D([H[4]*O,-H[1]*O,(H[1]*H[5]-H[2]*H[4])*O,-H[3]*O,H[0]*O,(H[2]*H[3]-H[0]*H[5])*O])}}class G{constructor(H,O){this._resourceManager=H;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new f(u.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(O||D.createIdentity());this._sizeTransfos.push(O?O.scaleRatio():1)}setTransform(H,O){this._transfos=[H||D.createIdentity()];this._sizeTransfos=[O||(H?H.scaleRatio():1)]}setGeomUnitsPerPoint(H){this._geomUnitsPerPoint=
H}transformPt(H){return this._transfos[this._transfos.length-1].transform(H)}transformSize(H){return H*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(H){return this._transfos[this._transfos.length-1].invert().transform(H)}reverseTransformSize(H){return H/this._sizeTransfos[this._sizeTransfos.length-1]}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-
1]}push(H,O){O=O?H.scaleRatio():1;D.multiply(H,this.back(),H);this._transfos.push(H);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*O)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(H,O,T){if(H)switch(H.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(H,O);break;case "CIMTextSymbol":this.drawTextSymbol(H,O,T)}}drawMultiLayerSymbol(H,O){if(H&&O){var T=H.symbolLayers;if(T)if((H=H.effects)&&0<H.length){if(O=
this.executeEffects(H,O))for(H=O.next();H;)this.drawSymbolLayers(T,H.asJSON()),H=O.next()}else this.drawSymbolLayers(T,O)}}executeEffects(H,O){const T=this._resourceManager.geometryEngine;O=new k.SimpleEffectCursor(a.GeometryCursor.fromJSONCIM(O));for(const V of H)(H=r.getEffectOperator(V))&&(O=H.execute(O,V,this.geomUnitsPerPoint(),null,T));return O}drawSymbolLayers(H,O){let T=H.length;for(;T--;){const X=H[T];if(X&&!1!==X.enable){var V=X.effects;if(V&&0<V.length){if(V=this.executeEffects(V,O)){let I=
null;for(;(I=V.next())&&(this.drawSymbolLayer(X,I.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(X,O);if(this._earlyReturn)break}}}drawSymbolLayer(H,O){switch(H.type){case "CIMSolidFill":this.drawSolidFill(O,H.color);break;case "CIMHatchFill":this.drawHatchFill(O,H);break;case "CIMPictureFill":this.drawPictureFill(O,H);break;case "CIMGradientFill":this.drawGradientFill(O,H);break;case "CIMSolidStroke":this.drawSolidStroke(O,H.color,H.width,H.capStyle,H.joinStyle,H.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(O,
H);break;case "CIMGradientStroke":this.drawGradientStroke(O,H);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(H,O)}}drawHatchFill(H,O){const T=this._buildHatchPolyline(O,H,this.geomUnitsPerPoint());T&&(this.pushClipPath(H),this.drawMultiLayerSymbol(O.lineSymbol,T),this.popClipPath())}drawPictureFill(H,O){}drawGradientFill(H,O){}drawPictureStroke(H,O){}drawGradientStroke(H,O){}drawMarkerLayer(H,O){var T=H.markerPlacement;if(T){var V=r.getPlacementOperator(T);
if(V){var X="CIMMarkerPlacementInsidePolygon"===T.type||"CIMMarkerPlacementPolygonCenter"===T.type&&T.clipAtBoundary;X&&this.pushClipPath(O);if(O=V.execute(a.GeometryCursor.fromJSONCIM(O),T,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(T=null;(T=O.next())&&(this.drawMarker(H,T),!this._earlyReturn););X&&this.popClipPath()}}else{X=this._placementPool.acquire();if(d.isPoint(O))X.tx=O.x,X.ty=O.y,this.drawMarker(H,X);else if(d.isPolygon(O)){if(O=m.polygonCentroid(O))[X.tx,X.ty]=
O,this.drawMarker(H,X)}else for(V of O.points)if(X.tx=V[0],X.ty=V[1],this.drawMarker(H,X),this._earlyReturn)break;this._placementPool.release(X)}}drawMarker(H,O){switch(H.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(H,O);break;case "CIMVectorMarker":this.drawVectorMarker(H,O)}}drawPictureMarker(H,O){if(H){var T=this._resourceManager.getResource(H.url),V=t.getValue(H.size,10);if(!(null==T||0>=V)){var X=T.width;T=T.height;if(X&&T){T=X/T;var I=t.getValue(H.scaleX,1);
X=D.createIdentity();var K=H.anchorPoint;if(K){var P=K.x;K=K.y;"Absolute"!==H.anchorPointUnits&&(P*=V*T*I,K*=V);X.translate(-P,-K)}T=t.getValue(H.rotation);H.rotateClockwise&&(T=-T);this._mapRotation&&(T+=this._mapRotation);T&&X.rotate(T*C);T=t.getValue(H.offsetX);I=t.getValue(H.offsetY);if(T||I){if(this._mapRotation){K=C*this._mapRotation;P=Math.cos(K);K=Math.sin(K);const W=T*K+I*P;T=T*P-I*K;I=W}X.translate(T,I)}T=this.geomUnitsPerPoint();1!==T&&X.scale(T,T);(T=O.getAngle())&&X.rotate(T);X.translate(O.tx,
O.ty);this.push(X,!1);this.drawImage(H,V);this.pop()}}}}drawVectorMarker(H,O){if(H){var T=H.markerGraphics;if(T){var V=t.getValue(H.size,10),X=H.frame,I=X?X.ymax-X.ymin:0;I=V&&I?V/I:1;V=D.createIdentity();X&&V.translate(.5*-(X.xmax+X.xmin),.5*-(X.ymax+X.ymin));var K=H.anchorPoint;if(K){var P=K.x;K=K.y;"Absolute"!==H.anchorPointUnits?X&&(P*=X.xmax-X.xmin,K*=X.ymax-X.ymin):(P/=I,K/=I);V.translate(-P,-K)}1!==I&&V.scale(I,I);X=t.getValue(H.rotation);H.rotateClockwise&&(X=-X);this._mapRotation&&(X+=this._mapRotation);
X&&V.rotate(X*C);X=t.getValue(H.offsetX);I=t.getValue(H.offsetY);if(X||I){if(this._mapRotation){K=C*this._mapRotation;P=Math.cos(K);K=Math.sin(K);const W=X*K+I*P;X=X*P-I*K;I=W}V.translate(X,I)}X=this.geomUnitsPerPoint();1!==X&&V.scale(X,X);(X=O.getAngle())&&V.rotate(X);V.translate(O.tx,O.ty);this.push(V,H.scaleSymbolsProportionally);for(const W of T)if(W?.symbol&&W.geometry||A.error("Invalid marker graphic",W),this.drawSymbol(W.symbol,W.geometry,W.textString),this._earlyReturn)break;this.pop()}}}drawTextSymbol(H,
O,T){if(H&&d.isPoint(O)&&!(0>=t.getValue(H.height,10))){var V=D.createIdentity(),X=t.getValue(H.angle);(X=-X)&&V.rotate(X*C);X=t.getValue(H.offsetX);var I=t.getValue(H.offsetY);(X||I)&&V.translate(X,I);X=this.geomUnitsPerPoint();1!==X&&V.scale(X,X);V.translate(O.x,O.y);this.push(V,!1);this.drawText(H,T);this.pop()}}_buildHatchPolyline(H,O,T){var V=t.getValue(H.separation,4)*T,X=t.getValue(H.rotation);if(0===V)return null;0>V&&(V=-V);for(var I=0,K=.5*V;I>K;)I-=V;for(;I<-K;)I+=V;I=b.create();c.getBoundsXY(I,
O);I[0]-=K;I[1]-=K;I[2]+=K;I[3]+=K;for(var P=[[I[0],I[1]],[I[0],I[3]],[I[2],I[3]],[I[2],I[1]]];180<X;)X-=180;for(;0>X;)X+=180;K=Math.cos(X*C);var W=Math.sin(X*C);X=-V*W;O=V*K;I=t.getValue(H.offsetX)*T;H=t.getValue(H.offsetY)*T;I=I*W-H*K;let aa;var R=H=Number.MAX_VALUE;aa=T=-Number.MAX_VALUE;for(var S of P){var Y=S[0];const ba=S[1];P=K*Y+W*ba;Y=-W*Y+K*ba;R=Math.min(R,P);H=Math.min(H,Y);aa=Math.max(aa,P);T=Math.max(T,Y)}H=Math.floor(H/V)*V;S=K*R-W*H-X*I/V;P=W*R+K*H-O*I/V;R=K*aa-W*H-X*I/V;I=W*aa+K*H-
O*I/V;V=1+Math.round((T-H)/V);K=[];for(W=0;W<V;W++)S+=X,P+=O,R+=X,I+=O,K.push([[S,P],[R,I]]);return{paths:K}}}class J extends G{constructor(H,O){super(H,O);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new z(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return b.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(H){!H||0<this._clipCount||(d.isPolygon(H)?this._processPath(H.rings,
0):d.isPolyline(H)?this._processPath(H.paths,0):d.isExtent(H)?(H=Q(H))&&this._processPath(H.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(H,O,T){!H||0<this._clipCount||(O=.5*this.transformSize(t.getValue(T,4)),d.isPolygon(H)?this._processPath(H.rings,O):d.isPolyline(H)?this._processPath(H.paths,O):d.isExtent(H)?(H=Q(H))&&this._processPath(H.rings,O):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(H,O){d.isPolygon(O)&&H.markerPlacement&&
("CIMMarkerPlacementInsidePolygon"===H.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===H.markerPlacement.type&&H.markerPlacement.clipAtBoundary)?this._processPath(O.rings,0):super.drawMarkerLayer(H,O)}drawHatchFill(H,O){this.drawSolidFill(H)}drawPictureFill(H,O){this.drawSolidFill(H)}drawGradientFill(H,O){this.drawSolidFill(H)}drawPictureStroke(H,O){this.drawSolidStroke(H,null,O.width)}drawGradientStroke(H,O){this.drawSolidStroke(H,null,O.width)}pushClipPath(H){this.drawSolidFill(H);this._clipCount++}popClipPath(){this._clipCount--}drawImage(H,
O){var {url:T}=H;H=t.getValue(H.scaleX,1);let V=H*O,X=O;T=this._resourceManager.getResource(T);O||null==T||(V=H*T.width,X=T.height);this._merge(this.transformPt([-V/2,-X/2]),0);this._merge(this.transformPt([-V/2,X/2]),0);this._merge(this.transformPt([V/2,-X/2]),0);this._merge(this.transformPt([V/2,X/2]),0)}drawText(H,O){if(O&&0!==O.length){this._textRasterizer||(this._textRasterizer=new q);var T=F(H),[V,X]=this._textRasterizer.computeTextSize(O,T);O=0;switch(H.horizontalAlignment){case "Left":O=V/
2;break;case "Right":O=-V/2}T=0;switch(H.verticalAlignment){case "Bottom":T=X/2;break;case "Top":T=-X/2;break;case "Baseline":T=X/6}this._merge(this.transformPt([-V/2+O,-X/2+T]),0);this._merge(this.transformPt([-V/2+O,X/2+T]),0);this._merge(this.transformPt([V/2+O,-X/2+T]),0);this._merge(this.transformPt([V/2+O,X/2+T]),0)}}_processPath(H,O){if(H)for(const T of H)if(H=T?T.length:0,1<H){this._merge(this.transformPt(T[0]),O);for(let V=1;V<H;V++)this._merge(this.transformPt(T[V]),O)}}_merge(H,O){H[0]-
O<this._xmin&&(this._xmin=H[0]-O);H[0]+O>this._xmax&&(this._xmax=H[0]+O);H[1]-O<this._ymin&&(this._ymin=H[1]-O);H[1]+O>this._ymax&&(this._ymax=H[1]+O)}}class M extends G{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(H,O,T,V,X,I){I*=e.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(I);this._searchPoint=[(H[0]+H[2])/2,(H[1]+H[3])/2];this._searchDistPoint=(H[2]-H[0])/2/I;this._textInfo=V;this._mapRotation=O&&("CIMPointSymbol"===O.type&&
"Map"!==O.angleAlignment||"CIMTextSymbol"===O.type)?X:0;this._earlyReturn=!1;this.drawSymbol(O,T);return this._earlyReturn}drawSolidFill(H,O){this._hitTestFill(H)}drawHatchFill(H,O){this._hitTestFill(H)}drawPictureFill(H,O){this._hitTestFill(H)}drawGradientFill(H,O){this._hitTestFill(H)}drawSolidStroke(H,O,T,V,X,I){this._hitTestStroke(H,T)}drawPictureStroke(H,O){this._hitTestStroke(H,O.width)}drawGradientStroke(H,O){this._hitTestStroke(H,O.width)}drawMarkerLayer(H,O){H.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===
H.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===H.markerPlacement.type&&H.markerPlacement.clipAtBoundary)?this._hitTestFill(O):super.drawMarkerLayer(H,O)}pushClipPath(H){}popClipPath(){}drawImage(H,O){var {url:T}=H;H=t.getValue(H.scaleX,1);T=this._resourceManager.getResource(T);if(null!=T&&0!==T.height&&0!==O){O*=this.geomUnitsPerPoint();H=T.width/T.height*H*O;T=this.reverseTransformPt(this._searchPoint);var V=this._searchDistPoint;Math.abs(T[0])<H/2+V&&Math.abs(T[1])<O/2+V&&(this._earlyReturn=
!0)}}drawText(H,O){if(O=this._textInfo)if(O=O.get(H)){var {text:T,mosaicItem:V}=O;if(V?.glyphMosaicItems?.length){O=t.getValue(H.height,10);var {lineGapType:X,lineGap:I}=H,K=X?Z(X,t.getValue(I),O):0,P=g.bidiText(T)[1],W="CIMBackgroundCallout"===H.callout?.type;H=E.shapeGlyphs(V.glyphMosaicItems,P,{scale:O/y.glyphSize,angle:0,xOffset:0,yOffset:0,hAlign:N(H.horizontalAlignment),vAlign:U(H.verticalAlignment),maxLineWidth:512,lineHeight:y.magicLabelLineHeight*Math.max(.25,Math.min(K||1,4)),decoration:H.font.decoration||
"none",isCIM:!0,hasBackground:W});K=this.reverseTransformPt(this._searchPoint);O=K[0];K=K[1];for(const aa of H.glyphs)if(O>aa.xTopLeft&&O<aa.xBottomRight&&K>-aa.yBottomRight&&K<-aa.yTopLeft){this._earlyReturn=!0;break}}}}_hitTestFill(H){let O=null;if(d.isExtent(H))O=[[[H.xmin,H.ymin],[H.xmin,H.ymax],[H.xmax,H.ymax],[H.xmax,H.ymin],[H.xmin,H.ymin]]];else if(d.isPolygon(H))O=H.rings;else if(d.isPolyline(H))O=H.paths;else return;H=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(H,O)&&
(this._earlyReturn=!0);if(!this._earlyReturn){const T=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(H,O,T)&&(this._earlyReturn=!0)}}_hitTestStroke(H,O){let T=null;if(d.isExtent(H))T=[[[H.xmin,H.ymin],[H.xmin,H.ymax],[H.xmax,H.ymax],[H.xmax,H.ymin],[H.xmin,H.ymin]]];else if(d.isPolygon(H))T=H.rings;else if(d.isPolyline(H))T=H.paths;else return;H=this.reverseTransformPt(this._searchPoint);O=t.getValue(O,4)*this.geomUnitsPerPoint();const V=this.reverseTransformSize(this._searchDistPoint)*
this.geomUnitsPerPoint();this._nearLine(H,T,O/2+V)&&(this._earlyReturn=!0)}_pointInPolygon(H,O){let T=0;for(const V of O){O=V.length;for(let X=1;X<O;X++){const I=V[X-1],K=V[X];I[1]>H[1]!==K[1]>H[1]&&(0<(K[0]-I[0])*(H[1]-I[1])-(K[1]-I[1])*(H[0]-I[0])?T++:T--)}}return 0!==T}_nearLine(H,O,T){for(const X of O){O=X.length;for(let I=1;I<O;I++){var V=X[I-1];const K=X[I];let P=(K[0]-V[0])*(K[0]-V[0])+(K[1]-V[1])*(K[1]-V[1]);if(0!==P&&(P=Math.sqrt(P),Math.abs(((K[0]-V[0])*(H[1]-V[1])-(K[1]-V[1])*(H[0]-V[0]))/
P)<T&&(V=((K[0]-V[0])*(H[0]-V[0])+(K[1]-V[1])*(H[1]-V[1]))/P,V>-T&&V<P+T)))return!0}}return!1}}class L extends G{constructor(H,O,T,V){super(O,T);this._applyAdditionalRenderProps=V;this._colorSubstitutionHelper=new l;this._ctx=H}drawSolidFill(H,O){if(H){if(d.isPolygon(H))this._buildPath(H.rings,!0);else if(d.isPolyline(H))this._buildPath(H.paths,!0);else if(d.isExtent(H))this._buildPath(Q(H).rings,!0);else if(d.isMultipoint(H))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;
H=this._ctx;H.fillStyle="string"===typeof O?O:"rgba("+Math.round(O[0])+","+Math.round(O[1])+","+Math.round(O[2])+","+(O[3]??255)/255+")";H.fill("evenodd")}}drawSolidStroke(H,O,T,V,X,I){if(H&&O&&0!==T){if(d.isPolygon(H))this._buildPath(H.rings,!0);else if(d.isPolyline(H))this._buildPath(H.paths,!1);else if(d.isExtent(H))this._buildPath(Q(H).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}H=this._ctx;H.strokeStyle="string"===typeof O?O:"rgba("+Math.round(O[0])+
","+Math.round(O[1])+","+Math.round(O[2])+","+(O[3]??255)/255+")";H.lineWidth=Math.max(this.transformSize(T),.5);this._setCapStyle(V);this._setJoinStyle(X);H.miterLimit=I;H.stroke()}}pushClipPath(H){this._ctx.save();if(d.isPolygon(H))this._buildPath(H.rings,!0);else if(d.isPolyline(H))this._buildPath(H.paths,!0);else if(d.isExtent(H))this._buildPath(Q(H).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(H,O){const {colorSubstitutions:T,url:V,tintColor:X}=
H;H=t.getValue(H.scaleX,1);var I=this._resourceManager.getResource(V);if(null!=I){var K=I.width/I.height*O,P=O;O||(K=I.width,P=I.height);var W=t.isSVGImage(V)||"src"in I&&t.isSVGImage(I.src);O="getFrame"in I?x.getFirstFrame(I):I;T&&(O=this._colorSubstitutionHelper.applyColorSubstituition(O,T));this._applyAdditionalRenderProps&&!W&&X&&(O=this._colorSubstitutionHelper.tintImageData(O,X));I=this.transformPt([0,0]);var [aa,R]=this.getTransformAngle();W=this.transformSize(1);var S=this._ctx;S.save();S.setTransform({m11:H*
W*aa,m12:H*W*R,m21:-W*R,m22:W*aa,m41:I[0],m42:I[1]});S.drawImage(O,-K/2,-P/2,K,P);S.restore()}}drawText(H,O){if(O&&0!==O.length&&(this._textRasterizer||(this._textRasterizer=new q),H=F(H),H.size*=this.transformSize(e.px2pt(1)),O=this._textRasterizer.rasterizeText(O,H))){var {size:T,anchorX:V,anchorY:X,canvas:I}=O;O=T[0]*(V+.5);H=T[1]*(X-.5);var K=this._ctx,P=this.transformPt([0,0]),[W,aa]=this.getTransformAngle();K.save();K.setTransform({m11:1*W,m12:1*aa,m21:-1*aa,m22:1*W,m41:P[0]-1*O,m42:P[1]+1*
H});K.drawImage(I,0,0);K.restore()}}drawPictureFill(H,O){if(H){var {colorSubstitutions:T,height:V,offsetX:X,offsetY:I,rotation:K,scaleX:P,tintColor:W,url:aa}=O;O=this._resourceManager.getResource(aa);if(null!=O){if(d.isPolygon(H))this._buildPath(H.rings,!0);else if(d.isPolyline(H))this._buildPath(H.paths,!0);else if(d.isExtent(H))this._buildPath(Q(H).rings,!0);else if(d.isMultipoint(H))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;H=this._ctx;var R=t.isSVGImage(aa)||
"src"in O&&t.isSVGImage(O.src),S="getFrame"in O?x.getFirstFrame(O):O;T&&(S=this._colorSubstitutionHelper.applyColorSubstituition(S,T));if(this._applyAdditionalRenderProps){if(R||W&&(S=this._colorSubstitutionHelper.tintImageData(S,W)),R=H.createPattern(S,"repeat"),S=this.transformSize(1),K||(K=0),X=X?S*X:0,I=I?S*I:0,V&&(V*=S),S=V?V/O.height:1,O=P&&V?P*V/O.width:1,0!==K||1!==S||1!==O||0!==X||0!==I){const Y=new DOMMatrix;Y.rotateSelf(0,0,-K).translateSelf(X,I).scaleSelf(O,S,1);R.setTransform(Y)}}else R=
H.createPattern(S,"repeat");H.save();H.fillStyle=R;H.fill("evenodd");H.restore()}}}drawPictureStroke(H,O){if(H){var {colorSubstitutions:T,capStyle:V,joinStyle:X,miterLimit:I,tintColor:K,url:P,width:W}=O;O=this._resourceManager.getResource(P);if(null!=O){if(d.isPolygon(H))var aa=H.rings;else if(d.isPolyline(H))aa=H.paths;else if(d.isExtent(H))aa=Q(H).rings;else{d.isMultipoint(H)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}W||(W=O.width);H=t.isSVGImage(P)||"src"in
O&&t.isSVGImage(O.src);var R="getFrame"in O?x.getFirstFrame(O):O;T&&(R=this._colorSubstitutionHelper.applyColorSubstituition(R,T));this._applyAdditionalRenderProps&&(H||K&&(R=this._colorSubstitutionHelper.tintImageData(R,K)));O=Math.max(this.transformSize(e.pt2px(W)),.5);H=O/R.width;var S=this._ctx;R=S.createPattern(R,"repeat-y");S.save();this._setCapStyle(V);this._setJoinStyle(X);void 0!==I&&(S.miterLimit=I);S.lineWidth=O;var Y;for(let ea of aa){ea=n.clone(ea);var ba=Y=void 0,ca=void 0;let ha=ba=
void 0;aa=ea;for(var da=aa[0],fa=1;fa<aa.length;)ha=aa[fa][0]-da[0],ba=aa[fa][1]-da[1],ba=0!==ha?ba/ha:Math.PI/2,void 0!==ca&&1E-4>=ba-ca?(aa.splice(fa-1,1),da=Y):(Y=da,da=aa[fa],fa++),ca=ba;if(ea&&!(1>=ea.length))for(aa=this.transformPt(ea[0]),ca=1;ca<ea.length;ca++)Y=this.transformPt(ea[ca]),da=180/Math.PI*Math.atan2(Y[1]-aa[1],Y[0]-aa[0]),fa=new DOMMatrix,fa.translateSelf(0,aa[1]-O/2).scaleSelf(H,H,1).rotateSelf(0,0,90-da),R.setTransform(fa),S.strokeStyle=R,S.beginPath(),S.moveTo(aa[0],aa[1]),
S.lineTo(Y[0],Y[1]),S.stroke(),aa=Y}S.restore()}}}_buildPath(H,O){const T=this._ctx;T.beginPath();if(H)for(const V of H)if(H=V?V.length:0,1<H){let X=this.transformPt(V[0]);T.moveTo(X[0],X[1]);for(let I=1;I<H;I++)X=this.transformPt(V[I]),T.lineTo(X[0],X[1]);O&&T.closePath()}}_setCapStyle(H){switch(H){case w.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case w.LineCapStyle.Round:this._ctx.lineCap="round";break;case w.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(H){switch(H){case w.LineJoinStyle.Bevel:this._ctx.lineJoin=
"bevel";break;case w.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case w.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const Q=H=>H?{spatialReference:H.spatialReference,rings:[[[H.xmin,H.ymin],[H.xmin,H.ymax],[H.xmax,H.ymax],[H.xmax,H.ymin],[H.xmin,H.ymin]]]}:null,N=H=>{switch(H){case "Left":return B.HAlign.Left;case "Right":return B.HAlign.Right;case "Center":return B.HAlign.Center;case "Justify":return A.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
B.HAlign.Center}},U=H=>{switch(H){case "Top":return B.VAlign.Top;case "Center":return B.VAlign.Center;case "Bottom":return B.VAlign.Bottom;case "Baseline":return B.VAlign.Baseline}},Z=(H,O,T)=>{switch(H){case "ExtraLeading":return 1+O/T;case "Multiple":return O;case "Exact":return O/T}};h.CIMSymbolDrawHelper=G;h.CanvasDrawHelper=L;h.EnvDrawHelper=J;h.HittestDrawHelper=M;h.Transformation=D;h.cDegToRad=C;h.defaultHatchFillSeparation=4;h.defaultMarkerSize=10;h.defaultPictureFillHeight=10;h.defaultStrokeWidth=
4;h.defaultTextHaloSize=1;h.defaultTextHeight=10;h.horizontalAlignment2HAlign=N;h.lineGapType2LineHeight=Z;h.verticalAlignment2VAlign=U;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(h,g,v,n,p){function f(d){if(n.isPolygon(d))d=[d.rings,"esriGeometryPolygon"];else if(n.isPolyline(d))d=[d.paths,"esriGeometryPolyline"];
else if(n.isMultipoint(d))d=[[d.points],"esriGeometryMultipoint"];else if(n.isExtent(d))d=[[[[d.xmin,d.ymin],[d.xmin,d.ymax],[d.xmax,d.ymax],[d.xmax,d.ymin],[d.xmin,d.ymin]]],"esriGeometryEnvelope"];else if(n.isPoint(d)){const k=[d.x,d.y];d.z&&k.push(d.z);d.m&&k.push(d.m);d=[[[k]],"esriGeometryPoint"]}else d=[[],"esriGeometryPolyline"];return d}class e{static fromOptimized(d,k,l=!1,r=!1){return(new a).initialize(d,k,l,r,1)}static fromJSON(d,k=!1,l=!1){const [r,u]=f(d);return(new b).initialize(r,u,
k,l,1)}static fromOptimizedCIM(d,k,l=!1,r=!1){return(new c).initialize(d,k,l,r,1)}static fromJSONCIM(d,k=!1,l=!1){const [r,u]=f(d);return(new m).initialize(r,u,k,l,1)}static fromFeatureSetReader(d){const k=d.readGeometryForDisplay();d=d.geometryType;return k&&d?this.fromOptimized(k,d):null}static fromFeatureSetReaderCIM(d){const k=d.readGeometryForDisplay();d=d.geometryType;return k&&d?this.fromOptimizedCIM(k,d):null}static createEmptyOptimized(d,k=!1,l=!1){return(new a).initialize(new p,d,k,l,1)}static createEmptyJSON(d,
k=!1,l=!1){return(new b).initialize([],d,k,l,1)}static createEmptyOptimizedCIM(d,k=!1,l=!1){return(new c).initialize(new p,d,k,l,1)}static createEmptyJSONCIM(d,k=!1,l=!1){return(new m).initialize([],d,k,l,1)}asJSON(){const d=v.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:d[0][0][0],ymin:d[0][0][1],xmax:d[0][2][0],ymax:d[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:d.flat()}:"esriGeometryPoint"===this.geometryType?{x:d[0][0][0],y:d[0][0][1]}:"esriGeometryPolygon"===
this.geometryType?{rings:d}:{paths:d}}getCurrentRingArea(){if(!this||3>this.pathSize)return 0;let d=0,k,l;this.seekPathStart();if(!this.nextPoint())return 0;k=this.x;l=this.y;const r=k,u=l;for(;this.nextPoint();)d+=(k-this.x)*(l+this.y),k=this.x,l=this.y;return-.5*(d+(k-r)*(l+u))}invertY(){this.yFactor*=-1}}class a extends e{constructor(){super(...arguments);this._end=-1}initialize(d,k,l,r,u){this.hasZ=l;this.hasM=r;this.geometryType=k;this._stride=2+Number(l)+Number(r);this._geometry=d;this._pathIndex=
-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=u;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(d){if(0<=d&&d<this.totalSize){if(this._pathIndex<d)for(;this._pathIndex<d&&this.nextPath(););else if(this._pathIndex>d)for(;this._pathIndex>d&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(d){d=this._pathOffset+
d*this._stride;return 0<=d&&d<this._end?(this._pointOffset=d,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){0<=this._pathIndex&&(this._pathOffset+=this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex]));this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex+1]);
return++this._pathIndex<this.totalSize}prevPath(){this._end=this._pathOffset;this._pathOffset-=this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex-1]);this._pointOffset=this._pathOffset-this._stride;return 0<=--this._pathIndex}pathLength(){const d=this._end,k=this._stride,l=this._geometry.coords;let r=0;for(let u=this._pathOffset+k;u<d;u+=k){const w=l[u]-l[u-k],x=l[u+1]-l[u-k+1];r+=Math.sqrt(w*w+x*x)}return r}startPath(){this._geometry.lengths.push(0)}pushPath(d){this.startPath();
this.pushPoints(d)}pushPoint(d){for(let k=0;k<this._stride;++k)this._geometry.coords.push(d[k]);this._geometry.lengths[this.totalSize-1]++}pushXY(d,k){this._geometry.coords.push(d,k);this._geometry.lengths[this.totalSize-1]++}pushPoints(d){for(const k of d)for(let l=0;l<this._stride;++l)this._geometry.coords.push(k[l]);this._geometry.lengths[this.totalSize-1]+=d.length}pushCursor(d){d=d.asOptimized();this._geometry.coords.push(...d.coords);this._geometry.lengths.push(...d.lengths)}asOptimized(){const d=
this._geometry.clone();if(1!==this.yFactor)for(let k=1;k<d.coords.length;k+=this._stride)d.coords[k]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(d.lengths.length=0);return d}isClosed(){const d=this._geometry.coords,k=this._pathOffset,l=this._end-this._stride;for(let r=0;r<this._stride;r++)if(d[k+r]!==d[l+r])return!1;return!0}clone(){return(new a).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.coords.length/
this._stride}get pathSize(){const {lengths:d}=this._geometry;return 0>this._pathIndex||this._pathIndex>d.length-1?0:d[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(d){this._geometry.coords[this._pointOffset]=d}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(d){this._geometry.coords[this._pointOffset+1]=this.yFactor*d}get z(){return this._geometry.coords[this._pointOffset+2]}set z(d){this._geometry.coords[this._pointOffset+
2]=d}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(d){this._geometry.coords[this._pointOffset+3]=d}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class b extends e{initialize(d,k,l,r,u){this._paths=d;this.geometryType=k;this.hasZ=l;this.hasM=r;this._pathIndex=this._pointIndex=-1;this.yFactor=u;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(d){return 0<=d&&d<this.totalSize?
(this._pathIndex=d,this._pointIndex=-1,this._currentPath=this._paths[d],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(d){return 0<=d&&d<this._currentPath.length?(this._pointIndex=d,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=
this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){this._pointIndex=-1;this._currentPath=this._paths[--this._pathIndex];return 0<=this._pathIndex}pathLength(){const d=this._currentPath.length,k=this._currentPath;let l=0;for(let u=1;u<d;u++){var r=k[u-1];const w=k[u],x=w[0]-r[0];r=w[1]-r[1];l+=Math.sqrt(x*x+r*r)}return l}startPath(){this._paths.push([])}pushPath(d){this._paths.push(d)}pushPoint(d){this._paths[this.totalSize-
1].push(d)}pushXY(d,k){this._paths[this.totalSize-1].push([d,k])}pushPoints(d){this._paths[this.totalSize-1].push(...d)}pushCursor(d){d=v.collectMultipath(d);for(const k of d)this.pushPath(k)}asOptimized(){const d=new p;if("esriGeometryPoint"===this.geometryType)d.coords.push(...this._paths[0][0]),d.lengths.length=0;else for(const k of this._paths){for(const l of k)d.coords.push(l[0]),d.coords.push(l[1]*this.yFactor),this.hasZ&&d.coords.push(l[2]),this.hasM&&d.coords.push(l[this._mIndex]);d.lengths.push(k.length)}return d}isClosed(){const d=
this._currentPath[0],k=this._currentPath[this._currentPath.length-1];for(let l=0;l<d.length;l++)if(d[l]!==k[l])return!1;return!0}clone(){return(new b).initialize(g.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(d=>d.length).reduce((d,k)=>d+k)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(d){this._currentPoint[0]=
d}get y(){return this.yFactor*this._currentPoint[1]}set y(d){this._currentPoint[1]=this.yFactor*d}get z(){return this._currentPoint[2]}set z(d){this._currentPoint[2]=d}get m(){return this._currentPoint[this._mIndex]}set m(d){this._currentPoint[this._mIndex]=d}get pathIndex(){return this._pathIndex}}class c extends a{initialize(d,k,l,r,u){super.initialize(d,k,l,r,u);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(w=>new Set));return this}startPath(){super.startPath();
this._controlPoints.push(new Set)}clone(){const d=(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);d._controlPoints=this._controlPoints;return d}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(d){this._controlPoints[this.pathIndex].add(d)}getControlPointAt(d){return this._controlPoints[this.pathIndex].has(d)}}class m extends b{initialize(d,
k,l,r,u){return super.initialize(d,k,l,r,u)}clone(){return(new m).initialize(g.clone(this._paths),this.geometryType,this.hasZ,this.hasM,1)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(d){this._paths[this.pathIndex][d][4]=1}getControlPointAt(d){return 1===this._paths[this.pathIndex][d][4]}}h.GeometryCursor=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports",
"../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(h,g,v){let n;class p{constructor(f){this._geometry=f}next(){const f=this._geometry;this._geometry=null;return f}}h.SimpleEffectCursor=p;h.clipCursorToTileExtent=function(f,e){n||(n=new v.TileClipper(0,0,0,1));var a="esriGeometryPolygon"===f.geometryType;const b=a?3:2;n.reset(a?v.GeometryType.Polygon:v.GeometryType.LineString);n.setPixelMargin(e+1);n.setExtent(512);let c;for(;f.nextPath();)if(!(f.pathSize<b)){f.nextPoint();
e=f.x;c=-f.y;for(n.moveTo(e,c);f.nextPoint();)e=f.x,c=-f.y,n.lineTo(e,c);a&&n.close()}if(a=n.result(!1)){f=g.GeometryCursor.createEmptyOptimizedCIM(f.geometryType);for(const m of a){f.startPath();for(const d of m)f.pushXY(d.x,-d.y)}f.reset();return f}return null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(h){h.GeometryType=void 0;(function(b){b[b.Unknown=0]="Unknown";b[b.Point=1]="Point";b[b.LineString=
2]="LineString";b[b.Polygon=3]="Polygon"})(h.GeometryType||(h.GeometryType={}));class g{constructor(b,c){this.x=b;this.y=c}clone(){return new g(this.x,this.y)}equals(b,c){return b===this.x&&c===this.y}isEqual(b){return b.x===this.x&&b.y===this.y}setCoords(b,c){this.x=b;this.y=c}normalize(){var b=this.x;const c=this.y;b=Math.sqrt(b*b+c*c);this.x/=b;this.y/=b}rightPerpendicular(){const b=this.x;this.x=this.y;this.y=-b}move(b,c){this.x+=b;this.y+=c}assign(b){this.x=b.x;this.y=b.y}assignAdd(b,c){this.x=
b.x+c.x;this.y=b.y+c.y}assignSub(b,c){this.x=b.x-c.x;this.y=b.y-c.y}rotate(b,c){const m=this.x,d=this.y;this.x=m*b-d*c;this.y=m*c+d*b}scale(b){this.x*=b;this.y*=b}length(){const b=this.x,c=this.y;return Math.sqrt(b*b+c*c)}static distance(b,c){const m=c.x-b.x;b=c.y-b.y;return Math.sqrt(m*m+b*b)}static add(b,c){return new g(b.x+c.x,b.y+c.y)}static sub(b,c){return new g(b.x-c.x,b.y-c.y)}}class v{constructor(b,c,m){this.ratio=b;this.x=c;this.y=m}}class n{constructor(b,c,m,d=8,k=8){this._lines=[];this._starts=
[];this.validateTessellation=!0;this._pixelRatio=d;this._pixelMargin=k;this._tileSize=512*d;this._dz=b;this._yPos=c;this._xPos=m}setPixelMargin(b){b!==this._pixelMargin&&(this._pixelMargin=b,this.setExtent(this._extent))}setExtent(b){this._extent=b;this._finalRatio=this._tileSize/b*(1<<this._dz);let c=this._pixelRatio*this._pixelMargin;c/=this._finalRatio;b>>=this._dz;c>b&&(c=b);this._margin=c;this._xmin=b*this._xPos-c;this._ymin=b*this._yPos-c;this._xmax=this._xmin+b+2*c;this._ymax=this._ymin+b+
2*c}reset(b){this._type=b;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(b,c){this._pushLine();this._prevIsIn=this._isIn(b,c);this._moveTo(b,c,this._prevIsIn);this._prevPt=new g(b,c);this._firstPt=new g(b,c);this._dist=0}lineTo(b,c){const m=this._isIn(b,c),d=new g(b,c),k=g.distance(this._prevPt,d);if(m)if(this._prevIsIn)this._lineTo(b,c,!0);else{var l=this._prevPt;var r=d;b=this._intersect(r,l);this._start=this._dist+k*(1-this._r);this._lineTo(b.x,b.y,!0);this._lineTo(r.x,r.y,
!0)}else if(this._prevIsIn)r=this._prevPt,l=d,b=this._intersect(r,l),this._lineTo(b.x,b.y,!0),this._lineTo(l.x,l.y,!1);else{const w=this._prevPt;if(!(w.x<=this._xmin&&d.x<=this._xmin||w.x>=this._xmax&&d.x>=this._xmax||w.y<=this._ymin&&d.y<=this._ymin||w.y>=this._ymax&&d.y>=this._ymax)){b=[];if(w.x<this._xmin&&d.x>this._xmin||w.x>this._xmin&&d.x<this._xmin){c=(this._xmin-w.x)/(d.x-w.x);var u=w.y+c*(d.y-w.y);u<=this._ymin?r=!1:u>=this._ymax?r=!0:b.push(new v(c,this._xmin,u))}if(w.x<this._xmax&&d.x>
this._xmax||w.x>this._xmax&&d.x<this._xmax)c=(this._xmax-w.x)/(d.x-w.x),u=w.y+c*(d.y-w.y),u<=this._ymin?r=!1:u>=this._ymax?r=!0:b.push(new v(c,this._xmax,u));if(w.y<this._ymin&&d.y>this._ymin||w.y>this._ymin&&d.y<this._ymin)c=(this._ymin-w.y)/(d.y-w.y),u=w.x+c*(d.x-w.x),u<=this._xmin?l=!1:u>=this._xmax?l=!0:b.push(new v(c,u,this._ymin));if(w.y<this._ymax&&d.y>this._ymax||w.y>this._ymax&&d.y<this._ymax)c=(this._ymax-w.y)/(d.y-w.y),u=w.x+c*(d.x-w.x),u<=this._xmin?l=!1:u>=this._xmax?l=!0:b.push(new v(c,
u,this._ymax));if(0===b.length)l?r?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):r?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<b.length&&b[0].ratio>b[1].ratio)this._start=this._dist+k*b[1].ratio,this._lineTo(b[1].x,b[1].y,!0),this._lineTo(b[0].x,b[0].y,!0);else for(this._start=this._dist+k*b[0].ratio,l=0;l<b.length;l++)this._lineTo(b[l].x,b[l].y,!0)}this._lineTo(d.x,d.y,!1)}this._dist+=k;this._prevIsIn=m;this._prevPt=d}close(){if(2<
this._line.length){var b=this._firstPt,c=this._prevPt;b.x===c.x&&b.y===c.y||this.lineTo(b.x,b.y);b=this._line;for(c=b.length;4<=c;)if(b[0].x===b[1].x&&b[0].x===b[c-2].x||b[0].y===b[1].y&&b[0].y===b[c-2].y)b.pop(),b[0].x=b[c-2].x,b[0].y=b[c-2].y,--c;else break}}result(b=!0){this._pushLine();if(0===this._lines.length)return null;this._type===h.GeometryType.Polygon&&b&&e.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==h.GeometryType.LineString)throw Error("Only valid for lines");
this._pushLine();const b=this._lines,c=b.length;if(0===c)return null;const m=[];for(let d=0;d<c;d++)m.push({line:b[d],start:this._starts[d]||0});return m}_isIn(b,c){return b>=this._xmin&&b<=this._xmax&&c>=this._ymin&&c<=this._ymax}_intersect(b,c){let m,d,k;if(c.x>=this._xmin&&c.x<=this._xmax)d=c.y<=this._ymin?this._ymin:this._ymax,k=(d-b.y)/(c.y-b.y),m=b.x+k*(c.x-b.x);else if(c.y>=this._ymin&&c.y<=this._ymax)m=c.x<=this._xmin?this._xmin:this._xmax,k=(m-b.x)/(c.x-b.x),d=b.y+k*(c.y-b.y);else{d=c.y<=
this._ymin?this._ymin:this._ymax;m=c.x<=this._xmin?this._xmin:this._xmax;const l=(m-b.x)/(c.x-b.x),r=(d-b.y)/(c.y-b.y);l<r?(k=l,d=b.y+l*(c.y-b.y)):(k=r,m=b.x+r*(c.x-b.x))}this._r=k;return new g(m,d)}_pushLine(){this._line&&(this._type===h.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===h.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===h.GeometryType.Polygon&&3<
this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(b,c,m){this._type!==h.GeometryType.Polygon?m&&(b=Math.round((b-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(b,c))):(m||(b<this._xmin&&(b=this._xmin),b>this._xmax&&(b=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),b=Math.round((b-(this._xmin+this._margin))*this._finalRatio),c=
Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(b,c)),this._isV=this._isH=!1)}_lineTo(b,c,m){if(this._type!==h.GeometryType.Polygon)if(m){b=Math.round((b-(this._xmin+this._margin))*this._finalRatio);c=Math.round((c-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(m=this._line[this._line.length-1],m.equals(b,c)))return;this._line.push(new g(b,c))}else this._line&&0<this._line.length&&this._pushLine();else if(m||(b<this._xmin&&(b=this._xmin),b>this._xmax&&
(b=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),b=Math.round((b-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){m=this._line[this._line.length-1];const d=m.x===b,k=m.y===c;d&&k||(this._isH&&d?(m.x=b,m.y=c,m=this._line[this._line.length-2],m.x===b&&m.y===c?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(m=this._line[this._line.length-2],this._isH=m.x===b,this._isV=m.y===
c)):(this._isH=m.x===b,this._isV=m.y===c)):this._isV&&k?(m.x=b,m.y=c,m=this._line[this._line.length-2],m.x===b&&m.y===c?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(m=this._line[this._line.length-2],this._isH=m.x===b,this._isV=m.y===c)):(this._isH=m.x===b,this._isV=m.y===c)):(this._line.push(new g(b,c)),this._isH=d,this._isV=k))}else this._line.push(new g(b,c))}}class p{setExtent(b){this._ratio=4096===b?1:4096/b}get validateTessellation(){return 1>this._ratio}reset(b){this._lines=
[];this._line=null}moveTo(b,c){this._line&&this._lines.push(this._line);this._line=[];const m=this._ratio;this._line.push(new g(b*m,c*m))}lineTo(b,c){const m=this._ratio;this._line.push(new g(b*m,c*m))}close(){const b=this._line;b&&!b[0].isEqual(b[b.length-1])&&b.push(b[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var f;(function(b){b[b.sideLeft=0]="sideLeft";b[b.sideRight=1]="sideRight";b[b.sideTop=2]="sideTop";b[b.sideBottom=3]="sideBottom"})(f||
(f={}));class e{static simplify(b,c,m){if(m){var d=-c,k=b+c,l=-c,r=b+c;b=[];c=[];var u=m.length;for(let w=0;w<u;++w){const x=m[w];if(!x||2>x.length)continue;let z=x[0],q;const t=x.length;for(let B=1;B<t;++B)q=x[B],z.x===q.x&&(z.x<=d&&(z.y>q.y?(b.push(w),b.push(B),b.push(f.sideLeft),b.push(-1)):(c.push(w),c.push(B),c.push(f.sideLeft),c.push(-1))),z.x>=k&&(z.y<q.y?(b.push(w),b.push(B),b.push(f.sideRight),b.push(-1)):(c.push(w),c.push(B),c.push(f.sideRight),c.push(-1)))),z.y===q.y&&(z.y<=l&&(z.x<q.x?
(b.push(w),b.push(B),b.push(f.sideTop),b.push(-1)):(c.push(w),c.push(B),c.push(f.sideTop),c.push(-1))),z.y>=r&&(z.x>q.x?(b.push(w),b.push(B),b.push(f.sideBottom),b.push(-1)):(c.push(w),c.push(B),c.push(f.sideBottom),c.push(-1)))),z=q}0!==b.length&&0!==c.length&&(e.fillParent(m,c,b),e.fillParent(m,b,c),d=[],e.calcDeltas(d,c,b),e.calcDeltas(d,b,c),e.addDeltas(d,m))}}static fillParent(b,c,m){const d=m.length,k=c.length;for(let x=0;x<k;x+=4){var l=c[x],r=c[x+1];const z=c[x+2],q=b[l][r-1];l=b[l][r];r=
8092;let t=-1;for(let B=0;B<d;B+=4){if(m[B+2]!==z)continue;var u=m[B];const y=m[B+1];var w=b[u][y-1];u=b[u][y];switch(z){case f.sideLeft:case f.sideRight:a(q.y,w.y,u.y)&&a(l.y,w.y,u.y)&&(w=Math.abs(u.y-w.y),w<r&&(r=w,t=B));break;case f.sideTop:case f.sideBottom:a(q.x,w.x,u.x)&&a(l.x,w.x,u.x)&&(w=Math.abs(u.x-w.x),w<r&&(r=w,t=B))}}c[x+3]=t}}static calcDeltas(b,c,m){const d=c.length;for(let k=0;k<d;k+=4){const l=e.calcDelta(k,c,m,[]);b.push(c[k]);b.push(c[k+1]);b.push(c[k+2]);b.push(l)}}static calcDelta(b,
c,m,d){b=c[b+3];if(-1===b)return 0;const k=d.length;if(1<k&&d[k-2]===b)return 0;d.push(b);return e.calcDelta(b,m,c,d)+1}static addDeltas(b,c){const m=b.length;let d=0;for(var k=0;k<m;k+=4){var l=b[k+3];l>d&&(d=l)}for(k=0;k<m;k+=4){l=c[b[k]];const r=b[k+1],u=d-b[k+3];switch(b[k+2]){case f.sideLeft:l[r-1].x-=u;l[r].x-=u;1===r&&(l[l.length-1].x-=u);r===l.length-1&&(l[0].x-=u);break;case f.sideRight:l[r-1].x+=u;l[r].x+=u;1===r&&(l[l.length-1].x+=u);r===l.length-1&&(l[0].x+=u);break;case f.sideTop:l[r-
1].y-=u;l[r].y-=u;1===r&&(l[l.length-1].y-=u);r===l.length-1&&(l[0].y-=u);break;case f.sideBottom:l[r-1].y+=u,l[r].y+=u,1===r&&(l[l.length-1].y+=u),r===l.length-1&&(l[0].y+=u)}}}}const a=(b,c,m)=>b>=c&&b<=m||b>=m&&b<=c;h.Point=g;h.SimpleBuilder=p;h.TileClipper=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class h{applyColorSubstituition(g,v){if(!v)return g;this._rasterizationCanvas||(this._rasterizationCanvas=
document.createElement("canvas"));const {width:n,height:p}=g,f=this._rasterizationCanvas,e=f.getContext("2d",{willReadFrequently:!0});g!==f&&(f.width=n,f.height=p,e.drawImage(g,0,0,n,p));g=e.getImageData(0,0,n,p).data;if(v)for(var a of v)if(a&&a.oldColor&&4===a.oldColor.length&&a.newColor&&4===a.newColor.length){const [b,c,m,d]=a.oldColor,[k,l,r,u]=a.newColor;if(b!==k||c!==l||m!==r||d!==u)for(v=0;v<g.length;v+=4)b===g[v]&&c===g[v+1]&&m===g[v+2]&&d===g[v+3]&&(g[v]=k,g[v+1]=l,g[v+2]=r,g[v+3]=u)}a=new ImageData(g,
n,p);e.putImageData(a,0,0);return f}tintImageData(g,v){if(!v||4>v.length)return g;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:n,height:p}=g,f=this._rasterizationCanvas,e=f.getContext("2d",{willReadFrequently:!0});g!==f&&(f.width=n,f.height=p,e.drawImage(g,0,0,n,p));g=e.getImageData(0,0,n,p);g=new Uint8Array(g.data);v=[v[0]/255,v[1]/255,v[2]/255,v[3]/255];for(let a=0;a<g.length;a+=4)g[a]*=v[0],g[a+1]*=v[1],g[a+2]*=v[2],g[a+3]*=v[3];v=new ImageData(new Uint8ClampedArray(g.buffer),
n,p);e.putImageData(v,0,0);return f}}return h})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B){h.getEffectOperator=function(y){if(!y)return null;switch(y.type){case "CIMGeometricEffectAddControlPoints":return g.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return v.EffectArrow.local();case "CIMGeometricEffectBuffer":return n.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return p.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return f.EffectCut.local();case "CIMGeometricEffectDashes":return e.EffectDashes.local();
case "CIMGeometricEffectDonut":return a.EffectDonut.local();case "CIMGeometricEffectJog":return b.EffectJog.local();case "CIMGeometricEffectMove":return c.EffectMove.local();case "CIMGeometricEffectOffset":return m.EffectOffset.local();case "CIMGeometricEffectReverse":return d.EffectReverse.local();case "CIMGeometricEffectRotate":return k.EffectRotate.local();case "CIMGeometricEffectScale":return l.EffectScale.local();case "CIMGeometricEffectWave":return r.EffectWave.local()}return null};h.getPlacementOperator=
function(y){if(!y)return null;switch(y.type){case "CIMMarkerPlacementAlongLineSameSize":return u.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return w.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return x.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return z.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return q.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return t.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return B.PlacementPolygonCenter.local()}return null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(h){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(n,p,f,e,a){return new v(n,p,f)}}g.instance=null;class v{constructor(n,p,f){this._inputGeometries=n;this._angleTolerance=void 0!==p.angleTolerance?p.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let n=this._inputGeometries.next();for(;n;){if("esriGeometryPolygon"===n.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===n.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===n.geometryType){if(this._maxCosAngle)return n;this._isClosed=!0}else{n=this._inputGeometries.next();continue}for(;n.nextPath();)this._processPath(n);n.reset();return n}return null}_processPath(n){if(n.nextPoint()){const p=
n.x,f=n.y;let e=p,a=f,b=n.pathSize,c=0,m=0,d=0,k=0,l=0,r=0;this._isClosed&&++b;for(let u=1;n.nextPoint()||u<b;++u){let w,x;this._isClosed&&u===b-1?(w=p,x=f):(w=n.x,x=n.y);const z=w-e,q=x-a,t=Math.sqrt(z*z+q*q);1<u&&0<t&&0<d&&(c*z+m*q)/t/d<=this._maxCosAngle&&n.setControlPointAt(u-1);1===u&&(k=z,l=q,r=t);0<t&&(e=w,a=x,c=z,m=q,d=t)}this._isClosed&&0<d&&0<r&&(c*k+m*l)/r/d<=this._maxCosAngle&&n.setControlPointAt(0)}}}h.EffectAddControlPoints=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(h,g,v,n,p,f){const e=f.GeometricEffectArrowType.OpenEnded;class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(c,m,d,k,l){return new b(c,m,d)}}a.instance=null;class b extends n.PathEffectCursor{constructor(c,m,d){super(c,!1,!0);this._curveHelper=new p.CurveHelper;this._width=
(void 0!==m.width?m.width:5)*d;this._arrowType=void 0!==m.geometricEffectArrowType?m.geometricEffectArrowType:void 0!==m.arrowType?m.arrowType:e;this._offsetFlattenError=p.pixelTolerance*d}processPath(c){const m=g.GeometryCursor.createEmptyOptimizedCIM(c.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(m,c,!0);break;case f.GeometricEffectArrowType.Block:this._constructSimpleArrow(m,c,!1);break;case f.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(m,c)}return m}_constructSimpleArrow(c,
m,d){var k=m.pathLength(),l=this._width;k<2*l&&(l=k/2);var r=this._curveHelper.getSubCurve(m,0,k-l);if(r&&r.nextPath()&&(r.seekPathStart(),k=l/2,!this._curveHelper.isEmpty(r)&&(r=v.collectPath(r),l=this._constructOffset(r,-k)))&&(r=this._constructOffset(r,k))){var u=this._constructArrowBasePoint(l,-k/2);u&&(k=this._constructArrowBasePoint(r,k/2))&&(m.seekInPath(m.pathSize-1),m=[m.x,m.y],c.pushPath(r),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(k),c.nextPoint(),c.setControlPoint(),c.pushPoint(m),
c.nextPoint(),c.setControlPoint(),c.pushPoint(u),c.nextPoint(),c.setControlPoint(),c.pushPoints(l.reverse()),c.setControlPoint(),d||(c.setControlPointAt(0),c.setControlPointAt(c.pathSize-1),c.pushPoint(r[0])),c.reset())}}_constructCrossedArrow(c,m){var d=m.pathLength(),k=this._width;d<3.732050807568877*k&&(k=d/3.732050807568877);m.seekPathStart();var l=this._curveHelper.getSubCurve(m,0,d-2.732050807568877*k);if(l){l.nextPath();var r=k/2;if(!this._curveHelper.isEmpty(l)){var u=v.collectPath(l);if(l=
this._constructOffset(u,r))if(u=this._constructOffset(u,-r))if(d=this._curveHelper.getSubCurve(m,0,d-k))if(d.nextPath(),!this._curveHelper.isEmpty(d)&&(d=v.collectPath(d),k=this._constructOffset(d,r))){var w=this._constructOffset(d,-r);if(w&&(d=k[k.length-1],k=this._constructArrowBasePoint(k,r/2))){var x=w[w.length-1];if(r=this._constructArrowBasePoint(w,-r/2))m.seekInPath(m.pathSize-1),m=[m.x,m.y],c.pushPath(l),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(x),c.nextPoint(),c.setControlPoint(),
c.pushPoint(r),c.nextPoint(),c.setControlPoint(),c.pushPoint(m),c.nextPoint(),c.setControlPoint(),c.pushPoint(k),c.nextPoint(),c.setControlPoint(),c.pushPoint(d),c.nextPoint(),c.setControlPoint(),c.pushPoints(u.reverse()),c.nextPoint(),c.setControlPoint(),c.reset()}}}}}_constructOffset(c,m){return this._curveHelper.offset(c,m,f.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(c,m){if(!c||2>c.length)return null;var d=c[c.length-2];c=c[c.length-1];d=[c[0]-d[0],
c[1]-d[1]];this._curveHelper.normalize(d);return[c[0]+d[1]*m,c[1]-d[0]*m]}}h.EffectArrow=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(h,g){class v{constructor(p,f=!0,e=!0,a=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!f&&"esriGeometryPolygon"===p.geometryType||!e&&"esriGeometryPolyline"===p.geometryType?null:p;this.geomUnitsPerPoint=a;this.iteratePath=!1;this.internalPlacement=
new g.Placement}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.nextPath();){this.geometryCursor.seekPathStart();const p=this.processPath(this.geometryCursor);if(p)return p}return this.geometryCursor=null}}class n{constructor(p,f,e,a=0){this.isClosed=!1;this.inputGeometries=p;this.acceptPolygon=f;this.acceptPolyline=e;this.geomUnitsPerPoint=a;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var p=this.inputGeometries.next();p&&
!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===p.geometryType||"esriGeometryEnvelope"===p.geometryType,this.multiPathCursor=p);)p=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),p=this.processPath(this.multiPathCursor))return p;this.multiPathCursor=null}}}h.PathEffectCursor=n;h.PathTransformationCursor=v;h.getId=function(p){return p[4]};h.setId=function(p,f){p[4]=f};Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(h,g,v){class n{constructor(p,f){}isEmpty(p){if(!p.nextPoint())return!0;let f,e,a,b;f=p.x;for(e=p.y;p.nextPoint();f=e,e=b)if(a=p.x,b=p.y,a!==f||b!==e)return p.seekPathStart(),!1;p.seekPathStart();return!0}normalize(p){const f=Math.sqrt(p[0]*p[0]+p[1]*p[1]);0!==f&&(p[0]/=f,p[1]/=f)}getLength(p,f,e,a){p=e-p;f=a-f;return Math.sqrt(p*p+f*f)}getSegLength(p){const [[f,
e],[a,b]]=p;return this.getLength(f,e,a,b)}getCoord2D(p,f,e,a,b){return[p+(e-p)*b,f+(a-f)*b]}getSegCoord2D(p,f){const [[e,a],[b,c]]=p;return this.getCoord2D(e,a,b,c,f)}getAngle(p,f,e,a,b){return Math.atan2(a-f,e-p)}getAngleCS(p,f,e,a,b){p=e-p;f=a-f;a=Math.sqrt(p*p+f*f);return 0<a?[p/a,f/a]:[1,0]}getSegAngleCS(p,f){const [[e,a],[b,c]]=p;return this.getAngleCS(e,a,b,c,f)}cut(p,f,e,a,b,c){b=0>=b?[p,f]:this.getCoord2D(p,f,e,a,b);p=1<=c?[e,a]:this.getCoord2D(p,f,e,a,c);return[b,p]}getSubCurve(p,f,e){const a=
g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(a,p,f,e)?a:null}appendSubCurve(p,f,e,a){p.startPath();f.seekPathStart();let b=0;var c=!0;if(!f.nextPoint())return!1;var m=f.x;let d=f.y;for(;f.nextPoint();){const k=this.getLength(m,d,f.x,f.y);if(0!==k){if(c){if(b+k>e){const l=(e-b)/k;let r=1;c=!1;b+k>=a&&(r=(a-b)/k,c=!0);(m=this.cut(m,d,f.x,f.y,l,r))&&p.pushPoints(m);if(c)break;c=!1}}else{if(b+k>a){(f=this.cut(m,d,f.x,f.y,0,(a-b)/k))&&p.pushPoint(f[1]);break}p.pushXY(f.x,
f.y)}b+=k}m=f.x;d=f.y}return!0}getCIMPointAlong(p,f){if(!p.nextPoint())return null;let e=0,a,b,c,m;a=p.x;for(b=p.y;p.nextPoint();a=c,b=m){c=p.x;m=p.y;const d=this.getLength(a,b,c,m);if(0!==d){if(e+d>f)return this.getCoord2D(a,b,c,m,(f-e)/d);e+=d}}return null}offset(p,f,e,a,b){if(!p||2>p.length)return null;var c=0,m=p[c++];for(b=c;c<p.length;){var d=p[c];if(d[0]!==m[0]||d[1]!==m[1])c!==b&&(p[b]=p[c]),m=p[b++];c++}(c=p[0][0]===p[b-1][0]&&p[0][1]===p[b-1][1])&&--b;if(b<(c?3:2))return null;d=[];m=c?p[b-
1]:null;let k=p[0];for(let x=0;x<b;x++){const z=x===b-1?c?p[0]:null:p[x+1];if(m)if(z){var l=[z[0]-k[0],z[1]-k[1]];this.normalize(l);var r=[k[0]-m[0],k[1]-m[1]];this.normalize(r);var u=r[0]*l[1]-r[1]*l[0],w=r[0]*l[0]+r[1]*l[1];if(0===u&&1===w){k=z;continue}if(0<=u===0>=f)1>w&&(l=[l[0]-r[0],l[1]-r[1]],this.normalize(l),r=Math.sqrt((1+w)/2),r>1/a&&(r=-Math.abs(f)/r,d.push([k[0]-l[0]*r,k[1]-l[1]*r])));else switch(e){case v.GeometricEffectOffsetMethod.Mitered:if(m=Math.sqrt((1+w)/2),0<m&&1/m<a){l=[l[0]-
r[0],l[1]-r[1]];this.normalize(l);r=Math.abs(f)/m;d.push([k[0]-l[0]*r,k[1]-l[1]*r]);break}case v.GeometricEffectOffsetMethod.Bevelled:d.push([k[0]+r[1]*f,k[1]-r[0]*f]);d.push([k[0]+l[1]*f,k[1]-l[0]*f]);break;case v.GeometricEffectOffsetMethod.Rounded:if(1>w){d.push([k[0]+r[1]*f,k[1]-r[0]*f]);m=Math.floor(2.5*(1-w));if(0<m){u=w=1/m;for(let q=1;q<m;q++,u+=w){const t=[r[1]*(1-u)+l[1]*u,-r[0]*(1-u)-l[0]*u];this.normalize(t);d.push([k[0]+t[0]*f,k[1]+t[1]*f])}}d.push([k[0]+l[1]*f,k[1]-l[0]*f])}break;default:0>
u?(d.push([k[0]+(r[1]+r[0])*f,k[1]+(r[1]-r[0])*f]),d.push([k[0]+(l[1]-l[0])*f,k[1]-(l[0]+l[1])*f])):(m=Math.sqrt((1+Math.abs(w))/2),l=[l[0]-r[0],l[1]-r[1]],this.normalize(l),r=f/m,d.push([k[0]-l[0]*r,k[1]-l[1]*r]))}}else l=[k[0]-m[0],k[1]-m[1]],this.normalize(l),d.push([k[0]+l[1]*f,k[1]-l[0]*f]);else l=[z[0]-k[0],z[1]-k[1]],this.normalize(l),d.push([k[0]+l[1]*f,k[1]-l[0]*f]);m=k;k=z}if(d.length<(c?3:2))return null;c&&d.push([d[0][0],d[0][1]]);return d}}h.CurveHelper=n;h.pixelTolerance=.03;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(h,g,v,n,p,f,e,a){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(m,d,k,l,r,u){return new c(m,d,k,l,r,u)}}b.instance=null;class c{constructor(m,d,k,l,r,u){this._inputGeometries=
m;this._tileKey=l;this._geometryEngine=r;this._curveHelper=new f.CurveHelper;this._size=(void 0!==d.size?d.size:1)*k;this._maxInflateSize=u*k;this._offsetFlattenError=f.pixelTolerance*k}next(){for(var m;m=this._inputGeometries.next();){if(0===this._size)return m;if("esriGeometryEnvelope"===m.geometryType)if(0<this._size){var d=v.GeometryCursor.createEmptyOptimizedCIM(m.geometryType),k=n.collectMultipath(m)[0];if(k=this._curveHelper.offset(k,this._size,e.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return d.pushPath(k),
d}else if(0>this._size&&(d=m.asJSON(),0<Math.min(d.xmax-d.xmin,d.ymax-d.ymin)+2*this._size))return v.GeometryCursor.fromJSONCIM({xmin:d.xmin-this._size,xmax:d.xmax+this._size,ymin:d.ymin-this._size,ymax:d.ymax+this._size});d=this._geometryEngine;if(null==d)break;if(m=this._tileKey?p.clipCursorToTileExtent(m,this._maxInflateSize):m)return(m=d.buffer(a.WebMercator,m.asJSON(),this._size,1))?v.GeometryCursor.fromJSONCIM(m):null}return null}}h.EffectBuffer=b;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(h,g,v,n,p){class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(a,b,c,m,d){return new e(a,b,c)}}f.instance=null;class e{constructor(a,b,c){this._defaultPointSize=20;this._inputGeometries=a;this._geomUnitsPerPoint=c;this._rule=b.rule??p.GeometricEffectControlMeasureLineRule.FullGeometry;
this._defaultSize=this._defaultPointSize*c}next(){for(var a;a=this._inputGeometries.next();)if((a=this._processGeom(v.collectMultipath(a)))&&a.length)return g.GeometryCursor.fromJSONCIM({paths:a});return null}_clone(a){return[a[0],a[1]]}_mid(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]}_mix(a,b,c,m){return[a[0]*b+c[0]*m,a[1]*b+c[1]*m]}_add(a,b){return[a[0]+b[0],a[1]+b[1]]}_add2(a,b,c){return[a[0]+b,a[1]+c]}_sub(a,b){return[a[0]-b[0],a[1]-b[1]]}_dist(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-
b[1])*(a[1]-b[1]))}_norm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}_normalize(a,b=1){b/=this._norm(a);a[0]*=b;a[1]*=b}_leftPerpendicular(a){const b=a[0];a[0]=-a[1];a[1]=b}_leftPerp(a){return[-a[1],a[0]]}_rightPerpendicular(a){const b=-a[0];a[0]=a[1];a[1]=b}_rightPerp(a){return[a[1],-a[0]]}_dotProduct(a,b){return a[0]*b[0]+a[1]*b[1]}_crossProduct(a,b){return a[0]*b[1]-a[1]*b[0]}_rotateDirect(a,b,c){const m=a[0]*c+a[1]*b;a[0]=a[0]*b-a[1]*c;a[1]=m}_makeCtrlPt(a){a=[a[0],a[1]];n.setId(a,1);return a}_addAngledTicks(a,
b,c,m){const d=this._sub(c,b);this._normalize(d);var k=this._crossProduct(d,this._sub(m,b));m=0<k?this._rightPerp(d):this._leftPerp(d);k=Math.abs(k)/2;const l=[];l.push([b[0]+(m[0]-d[0])*k,b[1]+(m[1]-d[1])*k]);l.push(b);l.push(c);l.push([c[0]+(m[0]+d[0])*k,c[1]+(m[1]+d[1])*k]);a.push(l)}_addBezier2(a,b,c,m,d){if(0===d--)a.push(m);else{var k=this._mid(b,c);c=this._mid(c,m);var l=this._mid(k,c);this._addBezier2(a,b,k,l,d);this._addBezier2(a,l,c,m,d)}}_addBezier3(a,b,c,m,d,k){if(0===k--)a.push(d);else{var l=
this._mid(b,c),r=this._mid(c,m);m=this._mid(m,d);c=this._mid(l,r);r=this._mid(r,m);var u=this._mid(c,r);this._addBezier3(a,b,l,c,u,k);this._addBezier3(a,u,r,m,d,k)}}_add90DegArc(a,b,c,m,d){m=d??0<this._crossProduct(this._sub(c,b),this._sub(m,b));d=this._mid(b,c);const k=this._sub(d,b);m?this._leftPerpendicular(k):this._rightPerpendicular(k);d[0]+=k[0];d[1]+=k[1];this._addBezier3(a,b,this._mix(b,.33333,d,.66667),this._mix(c,.33333,d,.66667),c,4)}_addArrow(a,b,c){var m=b[0],d=b[1],k=b[b.length-1],l=
this._sub(m,d);this._normalize(l);const r=this._crossProduct(l,this._sub(k,d));d=.5*r;var u=this._leftPerp(l);const w=[k[0]-u[0]*r,k[1]-u[1]*r];var x=b.length-1;k=[];k.push(c?[-u[0],-u[1]]:u);var z=[-l[0],-l[1]];for(c=1;c<x-1;c++){l=this._sub(b[c+1],b[c]);this._normalize(l);var q=this._dotProduct(l,z);u=this._crossProduct(l,z);q=Math.sqrt((1+q)/2);z=this._sub(l,z);this._normalize(z);z[0]/=q;z[1]/=q;k.push(0>u?[-z[0],-z[1]]:z);z=l}k.push(this._rightPerp(z));for(x=k.length-1;0<x;x--)a.push([b[x][0]+
k[x][0]*d,b[x][1]+k[x][1]*d]);a.push([w[0]+k[0][0]*d,w[1]+k[0][1]*d]);a.push([w[0]+k[0][0]*r,w[1]+k[0][1]*r]);a.push(m);a.push([w[0]-k[0][0]*r,w[1]-k[0][1]*r]);a.push([w[0]-k[0][0]*d,w[1]-k[0][1]*d]);for(m=1;m<k.length;m++)a.push([b[m][0]-k[m][0]*d,b[m][1]-k[m][1]*d])}_cp2(a,b,c){return 2<=a.length?a[1]:this._add2(a[0],b*this._defaultSize,c*this._defaultSize)}_cp3(a,b,c,m){if(3<=a.length)return a[2];c=this._mix(a[0],1-c,b,c);a=this._sub(b,a[0]);this._normalize(a);this._rightPerpendicular(a);return[c[0]+
a[0]*m*this._defaultSize,c[1]+a[1]*m*this._defaultSize]}_arrowPath(a){if(2<a.length)return a;const b=a[0];a=this._cp2(a,-4,0);const c=this._sub(b,a);this._normalize(c);const m=this._rightPerp(c);return[b,a,[b[0]+(m[0]-c[0])*this._defaultSize,b[1]+(m[1]-c[1])*this._defaultSize]]}_arrowLastSeg(a){var b=a[0];const c=this._cp2(a,-4,0);if(3<=a.length)b=a[a.length-1];else{a=this._sub(b,c);this._normalize(a);const m=this._rightPerp(a);b=[b[0]+(m[0]-a[0])*this._defaultSize,b[1]+(m[1]-a[1])*this._defaultSize]}return[c,
b]}_processGeom(a){if(!a)return null;const b=[];for(const c of a){if(!c||0===c.length)continue;const m=c.length;let d=c[0];switch(this._rule){case p.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const k=this._cp2(c,0,-1),l=this._cp3(c,k,.5,4),r=[];r.push(l);r.push(this._mid(d,k));b.push(r);break;case p.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const u=this._cp2(c,0,-1);b.push([u,d]);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const w=
this._cp2(c,-4,1),x=this._cp3(c,w,.882353,-1.94),z=[];z.push(this._mid(w,x));z.push(d);b.push(z);break;case p.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const q=this._cp2(c,-4,1),t=this._cp3(c,q,.882353,-1.94),B=this._sub(t,q);let y;y=0<this._crossProduct(B,this._sub(d,q))?this._rightPerp(y):this._leftPerp(B);const E=[];E.push([q[0]+(y[0]-B[0])/3,q[1]+(y[1]-B[1])/3]);E.push(q);E.push(t);E.push([t[0]+(y[0]+B[0])/3,t[1]+(y[1]+B[1])/3]);b.push(E);break;case p.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const F=
this._cp2(c,0,-1),C=this._cp3(c,F,.5,3),A=this._mid(d,F),D=this._sub(A,C);this._normalize(D);const G=this._crossProduct(D,this._sub(d,C));this._leftPerpendicular(D);const J=[];J.push(d);J.push([C[0]+D[0]*G,C[1]+D[1]*G]);b.push(J);const M=[];M.push([C[0]-D[0]*G,C[1]-D[1]*G]);M.push(F);b.push(M);break;case p.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const L=this._cp2(c,0,-1),Q=this._cp3(c,L,.5,3),N=this._mid(d,L),U=this._sub(N,Q);this._normalize(U);const Z=this._crossProduct(U,this._sub(d,
Q));this._leftPerpendicular(U);const H=[];H.push([Q[0]+U[0]*Z,Q[1]+U[1]*Z]);H.push([Q[0]-U[0]*Z,Q[1]-U[1]*Z]);b.push(H);break;case p.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const O=this._cp2(c,0,-1),T=this._cp3(c,O,.5,4),V=this._mid(d,O),X=this._sub(V,T);this._normalize(X);const I=this._crossProduct(X,this._sub(d,T));this._leftPerpendicular(X);const K=[];K.push([T[0]+X[0]*I*.8,T[1]+X[1]*I*.8]);K.push([V[0]+.8*(d[0]-V[0]),V[1]+.8*(d[1]-V[1])]);b.push(K);b.push([T,V]);const P=[];P.push([T[0]-
X[0]*I*.8,T[1]-X[1]*I*.8]);P.push([V[0]+.8*(O[0]-V[0]),V[1]+.8*(O[1]-V[1])]);b.push(P);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const W=this._cp2(c,0,-1),aa=this._cp3(c,W,.5,4),R=this._mid(d,W);let S=this._sub(W,d);const Y=Math.cos(Math.PI/18),ba=Math.sin(Math.PI/18),ca=Math.sqrt((1+Y)/2),da=Math.sqrt((1-Y)/2),fa=[];let ea;0<this._crossProduct(S,this._sub(aa,d))?(fa.push(d),S=this._sub(d,R),ea=W):(fa.push(W),S=this._sub(W,R),ea=d);this._rotateDirect(S,ca,da);S[0]/=
ca;S[1]/=ca;for(let ja=1;18>=ja;ja++)fa.push(this._add(R,S)),this._rotateDirect(S,Y,ba);fa.push(ea);b.push(fa);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const ha=this._cp2(c,0,-1),ia=this._cp3(c,ha,1,-1);let ka=this._sub(d,ha);this._normalize(ka);const la=this._crossProduct(ka,this._sub(ia,ha))/2;this._leftPerpendicular(ka);const ma=[ha[0]+ka[0]*la,ha[1]+ka[1]*la];ka=this._sub(ha,ma);const na=Math.cos(Math.PI/18);let ra=Math.sin(Math.PI/18);0<la&&(ra=-ra);const sa=
[ha];for(let ja=1;18>=ja;ja++)this._rotateDirect(ka,na,ra),sa.push(this._add(ma,ka));b.push(sa);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const ua=this._cp2(c,0,-2),pa=this._cp3(c,ua,1,-1);let Aa;if(4<=m)Aa=c[3];else{const ja=this._sub(d,ua);Aa=this._add(pa,ja)}const Ea=this._dist(ua,pa)/2/.75,hc=this._sub(ua,d);this._normalize(hc,Ea);const ic=this._sub(pa,Aa);this._normalize(ic,Ea);b.push([Aa,pa]);const Jb=[this._clone(pa)];this._addBezier3(Jb,pa,this._add(pa,ic),this._add(ua,
hc),ua,4);Jb.push(d);b.push(Jb);break;case p.GeometricEffectControlMeasureLineRule.OpenCircle:const jc=this._cp2(c,-2,0),kc=this._sub(jc,d),Oc=Math.cos(Math.PI/18),Pc=-Math.sin(Math.PI/18),lc=[jc];for(let ja=1;33>=ja;ja++)this._rotateDirect(kc,Oc,Pc),lc.push(this._add(d,kc));b.push(lc);break;case p.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Fa=this._cp2(c,0,-1);let Na;if(3<=m)Na=c[2];else{const ja=this._sub(Fa,d),oa=this._leftPerp(ja);Na=[d[0]+oa[0]-.25*ja[0],d[1]+oa[1]-.25*
ja[1]]}let pb;if(4<=m)pb=c[3];else{const ja=this._mid(d,Fa),oa=this._sub(d,Fa);this._normalize(oa);this._leftPerpendicular(oa);const ta=this._crossProduct(oa,this._sub(Na,ja));this._rightPerpendicular(oa);pb=[Na[0]+oa[0]*ta*2,Na[1]+oa[1]*ta*2]}const Ba=this._sub(Fa,d);let Oa,ya;Oa=0<this._crossProduct(Ba,this._sub(Na,d))?this._rightPerp(Ba):this._leftPerp(Ba);ya=[];ya.push(Na);ya.push(d);ya.push([d[0]+(Oa[0]-Ba[0])/3,d[1]+(Oa[1]-Ba[1])/3]);b.push(ya);Oa=0<this._crossProduct(Ba,this._sub(pb,Fa))?this._rightPerp(Oa):
this._leftPerp(Ba);ya=[];ya.push([Fa[0]+(Oa[0]+Ba[0])/3,Fa[1]+(Oa[1]+Ba[1])/3]);ya.push(Fa);ya.push(pb);b.push(ya);break;case p.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const qb=this._cp2(c,0,2),Kb=this._cp3(c,qb,0,1);let rb;if(4<=m)rb=c[3];else{const ja=this._sub(qb,d);rb=this._add(Kb,ja)}this._addAngledTicks(b,d,qb,this._mid(Kb,rb));this._addAngledTicks(b,Kb,rb,this._mid(d,qb));break;case p.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Lb=this._cp2(c,2,0),mc=
this._cp3(c,Lb,0,1);let Mb;if(4<=m)Mb=c[3];else{const ja=this._sub(Lb,d);Mb=this._add(mc,ja)}const Nb=[];Nb.push(this._mid(d,mc));Nb.push(this._mid(Lb,Mb));b.push(Nb);break;case p.GeometricEffectControlMeasureLineRule.Chevron:const nc=this._cp2(c,-1,-1);let Ob;if(3<=m)Ob=c[2];else{const ja=this._sub(nc,d);this._leftPerpendicular(ja);Ob=this._add(d,ja)}b.push([nc,this._makeCtrlPt(d),Ob]);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Xa=this._cp2(c,0,-2),oc=this._cp3(c,
Xa,.5,-1);let qa=this._sub(Xa,d);const Ya=this._norm(qa);qa[0]/=Ya;qa[1]/=Ya;const Pa=this._crossProduct(qa,this._sub(oc,d));let Za=this._dotProduct(qa,this._sub(oc,d));Za<.05*Ya?Za=.05*Ya:Za>.95*Ya&&(Za=.95*Ya);const sb=[d[0]+qa[0]*Za,d[1]+qa[1]*Za];this._leftPerpendicular(qa);let $a=[];$a.push([sb[0]-qa[0]*Pa,sb[1]-qa[1]*Pa]);$a.push([sb[0]+qa[0]*Pa,sb[1]+qa[1]*Pa]);b.push($a);const pc=[Xa[0]+qa[0]*Pa,Xa[1]+qa[1]*Pa];qa=this._sub(Xa,pc);const Qc=Math.cos(Math.PI/18);let Pb=Math.sin(Math.PI/18);
0>Pa&&(Pb=-Pb);$a=[d,Xa];for(let ja=1;9>=ja;ja++)this._rotateDirect(qa,Qc,Pb),$a.push(this._add(pc,qa));b.push($a);break;case p.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Qb=this._cp2(c,2,0),qc=this._mid(d,Qb),rc=this._sub(Qb,qc),Rc=Math.cos(Math.PI/18),Sc=Math.sin(Math.PI/18),sc=[d,Qb];for(let ja=1;18>=ja;ja++)this._rotateDirect(rc,Rc,Sc),sc.push(this._add(qc,rc));b.push(sc);break;case p.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Qa=this._cp2(c,0,-2),Rb=
this._cp3(c,Qa,1,-2),Ra=this._mid(d,Qa),za=this._sub(Rb,Qa);this._normalize(za);const tc=Math.abs(this._crossProduct(za,this._sub(Ra,Qa)))/2,ab=this._dist(Qa,Rb),uc=[Qa,d];uc.push([d[0]+za[0]*ab*.5,d[1]+za[1]*ab*.5]);b.push(uc);const bb=[];bb.push([Ra[0]-za[0]*tc,Ra[1]-za[1]*tc]);bb.push([Ra[0]+za[0]*ab*.375,Ra[1]+za[1]*ab*.375]);n.setId(bb[bb.length-1],1);bb.push([Ra[0]+za[0]*ab*.75,Ra[1]+za[1]*ab*.75]);b.push(bb);b.push([Qa,Rb]);break;case p.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const fb=
this._cp2(c,3,0),Sb=this._cp3(c,fb,.5,-1),gb=this._sub(Sb,fb);this._normalize(gb);const vc=this._crossProduct(gb,this._sub(Sb,d));this._leftPerpendicular(gb);this._addAngledTicks(b,d,fb,Sb);this._addAngledTicks(b,this._mix(d,1,gb,vc),this._mix(fb,1,gb,vc),this._mid(d,fb));break;case p.GeometricEffectControlMeasureLineRule.Parallel:const hb=this._cp2(c,3,0),Tc=this._cp3(c,hb,.5,-1),Tb=this._sub(hb,d);this._normalize(Tb);const tb=this._leftPerp(Tb),ub=this._crossProduct(Tb,this._sub(Tc,d));let ib=[d,
hb];b.push(ib);ib=[];ib.push([d[0]+tb[0]*ub,d[1]+tb[1]*ub]);ib.push([hb[0]+tb[0]*ub,hb[1]+tb[1]*ub]);b.push(ib);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const Ub=this._cp2(c,3,0),Uc=this._cp3(c,Ub,.5,-1),vb=this._mid(d,Ub),Sa=this._sub(Ub,d);this._normalize(Sa);const wb=this._crossProduct(Sa,this._sub(Uc,d));this._leftPerpendicular(Sa);const Vb=[];Vb.push([vb[0]-Sa[0]*wb*.25,vb[1]-Sa[1]*wb*.25]);Vb.push([vb[0]+Sa[0]*wb*1.25,vb[1]+Sa[1]*wb*1.25]);b.push(Vb);break;
case p.GeometricEffectControlMeasureLineRule.ParallelOffset:const cb=this._cp2(c,3,0),Vc=this._cp3(c,cb,.5,-1),wa=this._sub(cb,d);this._normalize(wa);const Ga=this._crossProduct(wa,this._sub(Vc,d));this._leftPerpendicular(wa);const Wb=[];Wb.push([d[0]-wa[0]*Ga,d[1]-wa[1]*Ga]);Wb.push([cb[0]-wa[0]*Ga,cb[1]-wa[1]*Ga]);b.push(Wb);const Xb=[];Xb.push([d[0]+wa[0]*Ga,d[1]+wa[1]*Ga]);Xb.push([cb[0]+wa[0]*Ga,cb[1]+wa[1]*Ga]);b.push(Xb);break;case p.GeometricEffectControlMeasureLineRule.OffsetOpposite:const xb=
this._cp2(c,3,0),Wc=this._cp3(c,xb,.5,-1),Ta=this._sub(xb,d);this._normalize(Ta);const yb=this._crossProduct(Ta,this._sub(Wc,d));this._leftPerpendicular(Ta);const Yb=[];Yb.push([d[0]-Ta[0]*yb,d[1]-Ta[1]*yb]);Yb.push([xb[0]-Ta[0]*yb,xb[1]-Ta[1]*yb]);b.push(Yb);break;case p.GeometricEffectControlMeasureLineRule.OffsetSame:const zb=this._cp2(c,3,0),Xc=this._cp3(c,zb,.5,-1),Ua=this._sub(zb,d);this._normalize(Ua);const Ab=this._crossProduct(Ua,this._sub(Xc,d));this._leftPerpendicular(Ua);const Zb=[];Zb.push([d[0]+
Ua[0]*Ab,d[1]+Ua[1]*Ab]);Zb.push([zb[0]+Ua[0]*Ab,zb[1]+Ua[1]*Ab]);b.push(Zb);break;case p.GeometricEffectControlMeasureLineRule.CircleWithArc:let Ha=this._cp2(c,3,0);const $b=this._cp3(c,Ha,.5,-1);let db,Bb;if(4<=m)db=c[3],Bb=0<this._crossProduct(this._sub(db,Ha),this._sub($b,Ha));else{db=Ha;Bb=0<this._crossProduct(this._sub(db,d),this._sub($b,d));const ja=24*this._geomUnitsPerPoint,oa=this._sub(db,d);this._normalize(oa,ja);const ta=Math.sqrt(2)/2;this._rotateDirect(oa,ta,Bb?ta:-ta);Ha=this._add(d,
oa)}const wc=this._sub(Ha,d),Yc=Math.cos(Math.PI/18),Zc=Math.sin(Math.PI/18),jb=[Ha];for(let ja=1;36>=ja;ja++)this._rotateDirect(wc,Yc,Zc),jb.push(this._add(d,wc));this._add90DegArc(jb,Ha,db,$b,Bb);n.setId(jb[jb.length-8],1);b.push(jb);break;case p.GeometricEffectControlMeasureLineRule.DoubleJog:let Ia=this._cp2(c,-3,1),Ja;Ja=3<=m?c[2]:this._add(d,this._sub(d,Ia));let Ca;if(4<=m)Ca=c[3];else{const ja=d;d=Ia;Ca=Ja;const oa=this._dist(d,ja),ta=this._dist(Ca,ja);let Ka=30*this._geomUnitsPerPoint;.5*
oa<Ka&&(Ka=.5*oa);.5*ta<Ka&&(Ka=.5*ta);Ia=this._mix(d,Ka/oa,ja,(oa-Ka)/oa);Ja=this._mix(Ca,Ka/ta,ja,(ta-Ka)/ta)}const xc=this._mid(d,Ia),yc=this._mid(Ca,Ja),$c=this._dist(d,Ia),ad=this._dist(Ja,Ca);let Cb=Math.min($c,ad)/8;Cb=Math.min(Cb,24*this._geomUnitsPerPoint);const La=Math.cos(Math.PI/4);let va=this._sub(d,Ia);this._normalize(va,Cb);0<this._crossProduct(va,this._sub(Ca,Ia))?this._rotateDirect(va,La,-La):this._rotateDirect(va,La,La);let xa=[];xa.push(Ia);xa.push(this._add(xc,va));xa.push(this._sub(xc,
va));xa.push(d);b.push(xa);va=this._sub(Ca,Ja);this._normalize(va,Cb);0>this._crossProduct(va,this._sub(d,Ja))?this._rotateDirect(va,La,La):this._rotateDirect(va,La,-La);xa=[];xa.push(Ja);xa.push(this._add(yc,va));xa.push(this._sub(yc,va));xa.push(Ca);b.push(xa);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Db=this._cp2(c,-4,1),zc=this._cp3(c,Db,.882353,-1.94),kb=this._sub(zc,Db);0<this._crossProduct(kb,this._sub(d,Db))?this._rightPerpendicular(kb):this._leftPerpendicular(kb);
const bd=[kb[0]/8,kb[1]/8],cd=this._sub(this._mid(Db,zc),bd);b.push([cd,d]);break;case p.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Ac=this._arrowPath(c),Bc=[];let Cc=Ac.length-2;for(;Cc--;)Bc.push(Ac[Cc]);b.push(Bc);break;case p.GeometricEffectControlMeasureLineRule.MultivertexArrow:const dd=this._arrowPath(c),Dc=[];this._addArrow(Dc,dd,!1);b.push(Dc);break;case p.GeometricEffectControlMeasureLineRule.CrossedArrow:const ed=this._arrowPath(c),Ec=[];this._addArrow(Ec,ed,!0);
b.push(Ec);break;case p.GeometricEffectControlMeasureLineRule.ChevronArrow:const [Fc,lb]=this._arrowLastSeg(c),Eb=10*this._geomUnitsPerPoint,Va=this._sub(d,Fc);this._normalize(Va);const Gc=this._crossProduct(Va,this._sub(lb,Fc)),Hc=this._leftPerp(Va),Ic=[lb[0]-Hc[0]*Gc*2,lb[1]-Hc[1]*Gc*2],Fb=[];Fb.push([lb[0]+Va[0]*Eb,lb[1]+Va[1]*Eb]);Fb.push(d);Fb.push([Ic[0]+Va[0]*Eb,Ic[1]+Va[1]*Eb]);b.push(Fb);break;case p.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [Jc,ac]=this._arrowLastSeg(c),
Da=this._sub(d,Jc);this._normalize(Da);const eb=this._crossProduct(Da,this._sub(ac,Jc));this._leftPerpendicular(Da);const mb=[ac[0]-Da[0]*eb,ac[1]-Da[1]*eb],Gb=[];Gb.push([mb[0]+Da[0]*eb*.5,mb[1]+Da[1]*eb*.5]);Gb.push(this._mid(mb,d));Gb.push([mb[0]-Da[0]*eb*.5,mb[1]-Da[1]*eb*.5]);b.push(Gb);break;case p.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [bc,cc]=this._arrowLastSeg(c),nb=this._sub(d,bc);this._normalize(nb);const Kc=this._crossProduct(nb,this._sub(cc,bc));this._leftPerpendicular(nb);
b.push([bc,[cc[0]-nb[0]*Kc,cc[1]-nb[1]*Kc]]);break;case p.GeometricEffectControlMeasureLineRule.Arch:const dc=this._cp2(c,0,-1),Hb=this._cp3(c,dc,.5,1),Lc=this._sub(d,dc),fd=this._mix(Hb,1,Lc,.55),gd=this._mix(Hb,1,Lc,-.55),ec=[d];this._addBezier2(ec,d,fd,Hb,4);this._addBezier2(ec,Hb,gd,dc,4);b.push(ec);break;case p.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Ma=this._cp2(c,-4,1),ob=this._cp3(c,Ma,.882353,-1.94),Wa=this._sub(ob,Ma);0<this._crossProduct(Wa,this._sub(d,Ma))?this._rightPerpendicular(Wa):
this._leftPerpendicular(Wa);const fc=[Wa[0]/8,Wa[1]/8],Mc=this._sub(this._mid(Ma,ob),fc),hd=this._sub(this._mix(Ma,.75,ob,.25),fc),id=this._sub(this._mix(Ma,.25,ob,.75),fc),Ib=[Ma];this._addBezier2(Ib,Ma,hd,Mc,3);this._addBezier2(Ib,Mc,id,ob,3);b.push(Ib);for(let ja=0;8>ja;ja++){const oa=Ib[2*ja+1],ta=[this._clone(oa)];ta.push(this._add(oa,[Wa[0]/4,Wa[1]/4]));b.push(ta)}break;case p.GeometricEffectControlMeasureLineRule.Arc90Degrees:const gc=this._cp2(c,0,-1),jd=this._cp3(c,gc,.5,1),Nc=[gc];this._add90DegArc(Nc,
gc,d,jd);b.push(Nc);break;default:b.push(c)}}return b}}h.EffectControlMeasureLine=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends v.PathEffectCursor{constructor(e,a,b){super(e,!0,!0);
this._curveHelper=new n.CurveHelper;this._beginCut=(void 0!==a.beginCut?a.beginCut:1)*b;this._endCut=(void 0!==a.endCut?a.endCut:1)*b;this._middleCut=(void 0!==a.middleCut?a.middleCut:0)*b;this._invert=void 0!==a.invert?a.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(e){const {_beginCut:a,_endCut:b,_middleCut:c}=this,m=e.pathLength(),d=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===
a&&0===b&&0===c)for(d.startPath();e.nextPoint();)d.pushXY(e.x,e.y);else a+b+c<m&&(0===c?this._curveHelper.appendSubCurve(d,e,a,m-b):(this._curveHelper.appendSubCurve(d,e,a,.5*(m-c)),this._curveHelper.appendSubCurve(d,e,.5*(m+c),m-b)));else if(0!==a||0!==b||0!==c)if(a+b+c>=m)for(d.startPath();e.nextPoint();)d.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(d,e,0,a),this._curveHelper.appendSubCurve(d,e,.5*(m-c),.5*(m+c)),this._curveHelper.appendSubCurve(d,e,m-b,b);return 0===d.totalSize?null:
d}}h.EffectCut=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker".split(" "),function(h,g,v,n,p,f){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(b,c,m,d,k){return new a(b,c,m)}}e.instance=null;class a extends n.PathEffectCursor{constructor(b,c,m){super(b,!0,!0);
this._firstCurve=null;this._walker=new f.GeometryWalker;this._walker.updateTolerance(m);this._endings=c.lineDashEnding;this._customDashPos=-(c.offsetAlongLine??0)*m;this._offsetAtEnd=(c.customEndingOffset??0)*m;this._pattern=new f.DashPattern;this._pattern.init(c.dashTemplate,!0);this._pattern.scale(m)}processPath(b){if(0===this._pattern.length())return this.iteratePath=!1,b=v.collectPath(b),g.GeometryCursor.fromJSONCIM({paths:[b]});if(!this.iteratePath){var c=!0;switch(this._endings){default:this._pattern.extPtGap=
0;break;case p.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case p.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case p.LineDashEnding.NoConstraint:this.isClosed||(c=!1);break;case p.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var m=b.pathLength();if(this._pattern.isEmpty()||m<.1*this._pattern.length()||!this._walker.init(b,this._pattern,c))return b=
v.collectPath(b),g.GeometryCursor.fromJSONCIM({paths:[b]})}if(this.iteratePath)b=this._pattern.nextValue();else{switch(this._endings){default:c=.5*this._pattern.firstValue();break;case p.LineDashEnding.HalfGap:c=.5*-this._pattern.lastValue();break;case p.LineDashEnding.FullGap:c=-this._pattern.lastValue();break;case p.LineDashEnding.FullPattern:c=0;break;case p.LineDashEnding.NoConstraint:case p.LineDashEnding.Custom:c=-this._customDashPos}b=c/this._pattern.length();b-=Math.floor(b);c=b*this._pattern.length();
this._pattern.reset();b=this._pattern.nextValue();for(m=!1;c>=b;)c-=b,b=this._pattern.nextValue(),m=!m;b-=c;m?(this._walker.nextPosition(b),b=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(b),b=this._pattern.nextValue(),this._walker.nextPosition(b),b=this._pattern.nextValue())}if(c=this._walker.nextCurve(b))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)c.pushXY(this._firstCurve.x,
this._firstCurve.y);this._firstCurve=null}}else b=this._pattern.nextValue(),!this._walker.nextPosition(b)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(c.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,c=this._firstCurve,this._firstCurve=null;c?.reset();return c}}h.EffectDashes=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor",
"./CurveHelper"],function(h,g,v){class n{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(a,b,c=!0){this._setEmpty();if(!a||0===a.length)return!1;for(let m=0;m<a.length;m++){let d=Math.abs(a[m]);c&&1E-7>d&&(d=1E-7);this._values.push(d);this._length+=d}b&&a.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(a){const b=
this._values?this._values.length:0;for(let c=0;c<b;++c)this._values[c]*=a;this._length*=a;this.extPtGap*=a;this.ctrlPtGap*=a}addValue(a){this._length+=a;this._values.push(a)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=
this._length=0;this._currentValue=-1;this._values.length=0}}class p{constructor(){this.pt=null;this.sa=this.ca=0}}h.EndType=void 0;(function(a){a[a.FAIL=0]="FAIL";a[a.END=1]="END";a[a.CONTINUE=2]="CONTINUE"})(h.EndType||(h.EndType={}));class f{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(a){a.segment=this.segment;a.segmentLength=this.segmentLength;a.abscissa=this.abscissa;a.isPathEnd=
this.isPathEnd;a.isPartEnd=this.isPartEnd}}class e extends v.CurveHelper{constructor(a=0,b=!1){super(a,b);this._tolerance=v.pixelTolerance;this._currentPosition=new f}updateTolerance(a){this._tolerance=v.pixelTolerance*a}init(a,b,c=!0){c?(this._patternLength=b.length(),this._partExtPtGap=b.extPtGap,this._partCtrlPtGap=b.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=a;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(a,
b=h.EndType.FAIL){const c=new f;if(!this._nextPosition(a,c,null,b))return!1;c.copyTo(this._currentPosition);return!0}curPointAndAngle(a){a.pt=this._getPoint(this._currentPosition);const [b,c]=this._getAngleCS(this._currentPosition);a.ca=b;a.sa=c}nextPointAndAngle(a,b,c=h.EndType.FAIL){const m=new f;if(!this._nextPosition(a,m,null,c))return!1;m.copyTo(this._currentPosition);b.pt=this._getPoint(m);const [d,k]=this._getAngleCS(m);b.ca=d;b.sa=k;return!0}nextCurve(a){if(0===a)return null;const b=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
b.startPath();b.nextPath();const c=new f;if(!this._nextPosition(a,c,b,h.EndType.END))return null;c.copyTo(this._currentPosition);return b}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(a){this._pathCursor.seekInPath(a);return[this._pathCursor.x,this._pathCursor.y]}getSeg(a){const b=this.getPt(a);a=this.getPt(a+1);return[b,a]}_nextPosition(a,b,c,m){if(this._currentPosition.isPathEnd)return!1;var d=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(d/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(b);b.abscissa+a*this._partLengthRatio>b.segmentLength+this._tolerance;)if(c&&(0===c.pathSize&&(0===d?(d=b.segment[0],c.pushXY(d[0],d[1])):c.pushPoint(this.getSegCoord2D(b.segment,d))),d=b.segment[1],c.pushXY(d[0],d[1])),d=0,a-=(b.segmentLength-b.abscissa)/this._partLengthRatio,this._partSegCount)b.segment=this._nextSegment(),b.segmentLength=this.getSegLength(b.segment),b.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(m===
h.EndType.FAIL)return!1;b.segmentLength=this.getSegLength(b.segment);b.isPartEnd=!0;m===h.EndType.END?(b.abscissa=b.segmentLength,b.isPathEnd=!0):b.abscissa=b.segmentLength+a;return!0}this._currentPosition.copyTo(b)}b.abscissa+=a*this._partLengthRatio;c&&(0===c.pathSize&&(0===d?c.pushPoint(b.segment[0]):c.pushPoint(this.getSegCoord2D(b.segment,d))),a=b.abscissa/b.segmentLength,1===a?c.pushPoint(b.segment[1]):c.pushPoint(this.getSegCoord2D(b.segment,a)));!this._partSegCount&&Math.abs(b.abscissa-b.segmentLength)<
this._tolerance&&(b.isPathEnd=this._partIsLast,b.isPartEnd=!0);return!0}_getPoint(a){return this.getSegCoord2D(this._currentPosition.segment,0>=a.segmentLength?0:a.abscissa/a.segmentLength)}_getAngleCS(a){return this.getSegAngleCS(this._currentPosition.segment,0>=a.segmentLength?0:a.abscissa/a.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=
0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var a=this._partSegCount;a;)this._previousSegment(),--a;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=
!1;--this._partSegCount;a=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(a);a=a+this._partSegCount+1;a>=this._pathCursor.pathSize&&(a=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(a);if(0<this._patternLength){a=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const b=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let c=Math.round((this._partLength-(a+b))/this._patternLength);0>=c&&(c=0<a+b?0:1);this._partLengthRatio=this._partLength/(a+b+c*
this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}h.DashPattern=n;h.GeometryWalker=e;h.Pos=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),
function(h,g,v,n,p,f){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(b,c,m,d,k,l){return new a(b,c,m,d,k,l)}}e.instance=null;class a{constructor(b,c,m,d,k,l){this._inputGeometries=b;this._tileKey=d;this._geometryEngine=k;this._maxInflateSize=l*m;this._width=(void 0!==c.width?c.width:2)*m;this._option=c.option}next(){for(var b;b=this._inputGeometries.next();){if("esriGeometryEnvelope"===b.geometryType&&0<this._width){var c=b.asJSON();return 0>Math.min(c.xmax-
c.xmin,c.ymax-c.ymin)-2*this._width?b:v.GeometryCursor.fromJSONCIM({paths:[[[c.xmin+this._width,c.ymin+this._width],[c.xmax-this._width,c.ymin+this._width],[c.xmax-this._width,c.ymax-this._width],[c.xmin+this._width,c.ymax-this._width],[c.xmin+this._width,c.ymin+this._width]],[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]})}if("esriGeometryPolygon"===b.geometryType){if(0===this._width)return b.clone();var m=this._geometryEngine;if(null==m)break;if(b=this._tileKey?
n.clipCursorToTileExtent(b,this._maxInflateSize):b.clone()){if(m=m.buffer(f.WebMercator,b.asJSON(),-this._width,1))for(c of m.rings)c&&b.pushPath(c.reverse());return b}}}return null}}h.EffectDonut=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,
a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends v.PathEffectCursor{constructor(e,a,b){super(e,!1,!0);this._curveHelper=new n.CurveHelper;this._length=(void 0!==a.length?a.length:20)*b;this._angle=void 0!==a.angle?a.angle:225;this._position=void 0!==a.position?a.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(e){const a=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const b=e.x,c=e.y;e.seekInPath(e.pathSize-1);const m=e.x;e=e.y;this._curveHelper.normalize([m-b,e-c]);const d=b+(m-b)*this._position/100,k=c+(e-c)*this._position/100,l=Math.cos((90-this._angle)/180*Math.PI);let r=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(r=-r);this._mirror=!this._mirror;a.pushPath([[b,c],[d-this._length/2*l,k-this._length/2*r],[d+this._length/2*l,k+this._length/2*r],[m,e]]);return a}}h.EffectJog=p;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(h){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(n,p,f,e,a){return new v(n,p,f)}}g.instance=null;class v{constructor(n,p,f){this._inputGeometries=n;this._offsetX=void 0!==p.offsetX?p.offsetX*f:0;this._offsetY=void 0!==p.offsetY?p.offsetY*f:0}next(){let n=this._inputGeometries.next();for(;n;){if(0<n.totalSize)return this._move(n.clone(),this._offsetX,
this._offsetY);n=this._inputGeometries.next()}return null}_move(n,p,f){for(;n.nextPath();)for(;n.nextPoint();)n.x+=p,n.y+=f;n.reset();return n}}h.EffectMove=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(h,g,v,n,p,f,e,a,b){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(d,k,l,r,u,w){return new m(d,k,l,r,u,w)}}c.instance=null;class m{constructor(d,k,l,r,u,w){this._inputGeometries=d;this._tileKey=r;this._geometryEngine=u;this._curveHelper=new e.CurveHelper;this._offset=(k.offset??1)*l;this._method=k.method;this._maxInflateSize=w*l;this._option=k.option;this._offsetFlattenError=e.pixelTolerance*l}next(){for(var d;d=this._inputGeometries.next();){if(0===
this._offset)return d.clone();if("esriGeometryEnvelope"===d.geometryType){if(this._method===a.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var k=n.collectPath(d);if(k=this._curveHelper.offset(k,-this._offset,this._method,4,this._offsetFlattenError))return d=v.GeometryCursor.createEmptyOptimizedCIM(d.geometryType),d.pushPath(k),d;break}k=d.asJSON();if(p.isExtent(k)&&0<Math.min(k.xmax-k.xmin,k.ymax-k.ymin)+2*this._offset)return v.GeometryCursor.fromJSONCIM({xmin:k.xmin-this._offset,xmax:k.xmax+
this._offset,ymin:k.ymin-this._offset,ymax:k.ymax+this._offset})}k=this._geometryEngine;if(null!=k&&(d=this._tileKey?f.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()))return(d=k.offset(b.WebMercator,d.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?v.GeometryCursor.fromJSONCIM(d):null}return null}}h.EffectOffset=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(h){class g{static local(){null===
g.instance&&(g.instance=new g);return g.instance}execute(n,p,f,e,a){return new v(n,p,f)}}g.instance=null;class v{constructor(n,p,f){this._inputGeometries=n;this._reverse=void 0!==p.reverse?p.reverse:!0}next(){for(var n=this._inputGeometries.next();n;){if(!this._reverse)return n;if("esriGeometryPolyline"===n.geometryType){for(n=n.clone();n.nextPath();)for(let p=0;p<n.pathSize/2;p++){n.seekInPath(p);const f=n.x,e=n.y;n.seekInPath(n.pathSize-p-1);const a=n.x,b=n.y;n.x=f;n.y=e;n.seekInPath(p);n.x=a;n.y=
b}n.reset();return n}n=this._inputGeometries.next()}return null}}h.EffectReverse=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(h,g){class v{static local(){null===v.instance&&(v.instance=new v);return v.instance}execute(p,f,e,a,b){return new n(p,f,e)}}v.instance=null;class n{constructor(p,f,e){this._inputGeometries=p;this._rotateAngle=void 0!==f.angle?f.angle*Math.PI/
180:0}next(){let p=this._inputGeometries.next();for(;p;){if(0===this._rotateAngle||"esriGeometryPoint"===p.geometryType)return p;if(0<p.totalSize){var f=g.getCursorBoundsXY(p);const e=(f[2]+f[0])/2;f=(f[3]+f[1])/2;p.reset();return this._rotate(p.clone(),e,f)}p=this._inputGeometries.next()}return null}_rotate(p,f,e){const a=Math.cos(this._rotateAngle),b=Math.sin(this._rotateAngle);for(;p.nextPath();)for(;p.nextPoint();){const c=p.x-f,m=p.y-e;p.x=f+c*a-m*b;p.y=e+c*b+m*a}p.reset();return p}}h.EffectRotate=
v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(h,g){class v{static local(){null===v.instance&&(v.instance=new v);return v.instance}execute(p,f,e,a,b){return new n(p,f,e)}}v.instance=null;class n{constructor(p,f,e){this._inputGeometries=p;this._xFactor=void 0!==f.XScaleFactor?f.XScaleFactor:1.15;this._yFactor=void 0!==f.YScaleFactor?f.YScaleFactor:1.15}next(){const p=
this._inputGeometries.next();if(p){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===p.geometryType)return p;if(0<p.totalSize){var f=g.getCursorBoundsXY(p);const e=(f[2]+f[0])/2;f=(f[3]+f[1])/2;p.reset();return this._scaleCursor(p.clone(),e,f)}}return null}_scaleCursor(p,f,e){for(;p.nextPath();)for(;p.nextPoint();)p.x=f+(p.x-f)*this._xFactor,p.y=e+(p.y-e)*this._yFactor;p.reset();return p}}h.EffectScale=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports",
"../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f{constructor(e,a,b){this._inputGeometries=e;this._height=(void 0!==a.amplitude?a.amplitude:2)*b;this._period=(void 0!==a.period?a.period:3)*b;this._style=a.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));
this._pattern=new n.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new n.GeometryWalker;this._walker.updateTolerance(b)}next(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period||(e=this._processGeom(e)))return e;e=this._inputGeometries.next()}return null}_processGeom(e){const a=g.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){a.startPath();const b=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){default:this._constructCurve(a,
b,!1);break;case v.GeometricEffectWaveform.Square:this._constructSquare(a,b);break;case v.GeometricEffectWaveform.Triangle:this._constructTriangle(a,b);break;case v.GeometricEffectWaveform.Random:this._constructCurve(a,b,!0)}else for(;e.nextPoint();)a.pushXY(e.x,e.y)}return a}_constructCurve(e,a,b){var c=Math.round(a/this._period);0===c&&(c=1);const m=this._period/16,d=1/(16*c+1);a=2*Math.PI*a/(a/c);c=2*Math.PI*Math.random();const k=2*Math.PI*Math.random(),l=2*Math.PI*Math.random(),r=.75-Math.random()/
2,u=.75-Math.random()/2,w=new n.Pos;this._walker.curPointAndAngle(w);e.pushPoint(w.pt);let x=0;for(;;)if(this._walker.nextPointAndAngle(m,w)){const z=x;x+=d;let q;if(b){const t=this._height/2*(1+.3*Math.sin(r*a*z+c));q=t*Math.sin(a*z+k);q+=t*Math.sin(u*a*z+l);q/=2}else q=.5*this._height*Math.sin(.5*a*z);e.pushXY(w.pt[0]-q*w.sa,w.pt[1]+q*w.ca)}else{e.pushPoint(this._walker.getPathEnd());break}}_constructSquare(e,a){Math.round(a/this._period);for(a=!0;;){let b=!1;if(this._walker.curPositionIsValid()){const c=
new n.Pos;this._walker.curPointAndAngle(c);const m=new n.Pos;if(this._walker.nextPointAndAngle(this._period,m)){const d=new n.Pos;this._walker.nextPointAndAngle(this._period,d)&&(a?(e.pushPoint(c.pt),a=!1):e.pushPoint(c.pt),e.pushXY(c.pt[0]-this._height/2*c.sa,c.pt[1]+this._height/2*c.ca),e.pushXY(m.pt[0]-this._height/2*m.sa,m.pt[1]+this._height/2*m.ca),e.pushXY(m.pt[0]+this._height/2*m.sa,m.pt[1]-this._height/2*m.ca),e.pushXY(d.pt[0]+this._height/2*d.sa,d.pt[1]-this._height/2*d.ca),b=!0)}}if(!b){e.pushPoint(this._walker.getPathEnd());
break}}}_constructTriangle(e,a){Math.round(a/this._period);for(a=!0;;){let b=!1;if(this._walker.curPositionIsValid()){const c=new n.Pos;this._walker.curPointAndAngle(c);const m=new n.Pos;if(this._walker.nextPointAndAngle(this._period/2,m)){const d=new n.Pos;this._walker.nextPointAndAngle(this._period,d)&&(this._walker.nextPosition(this._period/2)&&(a?(e.pushPoint(c.pt),a=!1):e.pushPoint(c.pt),e.pushXY(m.pt[0]-this._height/2*m.sa,m.pt[1]+this._height/2*m.ca),e.pushXY(d.pt[0]+this._height/2*d.sa,d.pt[1]-
this._height/2*d.ca)),b=!0)}}if(!b){e.pushPoint(this._walker.getPathEnd());break}}}}h.EffectWave=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends g.PathTransformationCursor{constructor(e,
a,b){super(e);this._geometryWalker=new n.GeometryWalker;this._geometryWalker.updateTolerance(b);this._angleToLine=a.angleToLine??!0;this._offset=(a.offset?a.offset:0)*b;this._originalEndings=a.endings;this._offsetAtEnd=(a.customEndingOffset?a.customEndingOffset:0)*b;this._position=-(a.offsetAlongLine?a.offsetAlongLine:0)*b;this._pattern=new n.DashPattern;this._pattern.init(a.placementTemplate,!1);this._pattern.scale(b);this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;
if(this.iteratePath)var a=this._pattern.nextValue();else{this._endings=this._originalEndings===v.PlacementEndings.WithFullGap&&this.isClosed?v.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let b=!0;switch(this._endings){case v.PlacementEndings.NoConstraint:a=-this._position;a=this._adjustPosition(a);b=!1;break;default:a=-this._pattern.lastValue()/2;break;case v.PlacementEndings.WithFullGap:a=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();
break;case v.PlacementEndings.WithMarkers:a=0;break;case v.PlacementEndings.Custom:a=-this._position,a=this._adjustPosition(a),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,b))return null;this._pattern.reset();for(e=0;a>e;)a-=e,e=this._pattern.nextValue();a=e-a;this.iteratePath=!0}e=new n.Pos;if(!this._geometryWalker.nextPointAndAngle(a,e)||this._endings===v.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===
v.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(e.pt[0]-this._offset*e.sa,e.pt[1]+this._offset*e.ca);this._angleToLine&&this.internalPlacement.setRotateCS(e.ca,e.sa);return this.internalPlacement}_adjustPosition(e){e/=this._pattern.length();e-=Math.floor(e);return e*this._pattern.length()}}h.PlacementAlongLineSameSize=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends g.PathTransformationCursor{constructor(e,a,b){super(e,!1,!0);this._curveHelper=new v.CurveHelper;this._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;this._offset=void 0!==a.offset?a.offset*b:0;this._type=a.extremityPlacement;this._position=void 0!==a.offsetAlongLine?a.offsetAlongLine*
b:0;this._beginProcessed=!1}processPath(e){let a;switch(this._type){default:this._beginProcessed?(a=this._atExtremities(e,this._position,!1),this.iteratePath=this._beginProcessed=!1):(a=this._atExtremities(e,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case n.ExtremityPlacement.JustBegin:a=this._atExtremities(e,this._position,!0);break;case n.ExtremityPlacement.JustEnd:a=this._atExtremities(e,this._position,!1);case n.ExtremityPlacement.None:}return a}_atExtremities(e,a,b){b||
e.seekPathEnd();if(b?e.nextPoint():e.prevPoint()){let c=0,[m,d]=[0,0],[k,l]=[e.x,e.y];for(;b?e.nextPoint():e.prevPoint();){m=k;d=l;k=e.x;l=e.y;const r=this._curveHelper.getLength(m,d,k,l);if(c+r>a){e=(a-c)/r;const [u,w]=this._curveHelper.getAngleCS(m,d,k,l,e);e=this._curveHelper.getCoord2D(m,d,k,l,e);this.internalPlacement.setTranslate(e[0]-this._offset*w,e[1]+this._offset*u);this._angleToLine&&this.internalPlacement.setRotateCS(-u,-w);return this.internalPlacement}c+=r}}return null}}h.PlacementAtExtremities=
p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(h,g,v){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(f,e,a,b,c){return new p(f,e,a)}}n.instance=null;class p extends g.PathTransformationCursor{constructor(f,e,a){super(f);this._walker=new v.GeometryWalker;this._walker.updateTolerance(a);this._angleToLine=void 0!==
e.angleToLine?e.angleToLine:!0;this._offset=void 0!==e.offset?e.offset*a:0;this._beginGap=void 0!==e.beginPosition?e.beginPosition*a:0;this._endGap=void 0!==e.endPosition?e.endPosition*a:0;this._flipFirst=void 0!==e.flipFirst?e.flipFirst:!0;this._pattern=new v.DashPattern;this._pattern.init(e.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(f){if(this._pattern.isEmpty())return null;if(this.iteratePath){f=this._pattern.nextValue()*
this._subPathLen;var e=this._beginGap+f;f=e-this._prevPos;this._prevPos=e}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=f.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(f,this._pattern,!1))return null;this._pattern.reset();f=this._pattern.nextValue()*this._subPathLen;e=this._beginGap+f;f=e-this._prevPos;this._prevPos=e;this.iteratePath=!0}e=new v.Pos;if(!this._walker.nextPointAndAngle(f,
e,v.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(e.pt[0]-this._offset*e.sa,e.pt[1]+this._offset*e.ca);f=this._isFirst&&this._flipFirst;let a;this._angleToLine?(a=e.ca,e=e.sa):(a=1,e=0);f&&(a=-a,e=-e);this.internalPlacement.setRotateCS(a,e);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}h.PlacementAtRatioPositions=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports",
"../../../core/RandomLCG","../CIMPlacements","../enums"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b,c,m)}}p.instance=null;class f{constructor(e,a,b,c,m){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(a.stepX??16)*b;this._stepY=Math.abs(a.stepY??16)*b;this._stepX=Math.round(128*
this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=a.gridType??n.PlacementGridType.Fixed;if(this._gridType===n.PlacementGridType.Random)this._randomLCG=new g(1*(a.seed??13)),this._randomness=(a.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=a.gridAngle??0;this._shiftOddRows=a.shiftOddRows??!1;this._offsetX=
(a.offsetX??0)*b;this._offsetY=(a.offsetY??0)*b;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=
this._graphicOriginX=0;if(null!=c){const [d,k,l,r]=c.split("/");a=parseFloat(d);b=parseFloat(k);c=parseFloat(l);this._graphicOriginX=512*-(parseFloat(r)*2**a+c);this._graphicOriginY=512*b;this._testInsidePolygon=!0}this._internalPlacement=new v.Placement;this._calculateMinMax(e);this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!f._randValues){f._randValues=[];for(let e=0;24>e;e++)for(let a=0;24>a;a++)f._randValues.push(this._randomLCG.getFloat()),
f._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){this._yMax=this._yMin=this._xMax=this._xMin=0;let a,b,c,m,d,k,l,r;a=b=l=d=Number.MAX_VALUE;c=m=r=k=-Number.MAX_VALUE;var u=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();){var w=e.x;var x=e.y;var z=w-this._graphicOriginX-this._offsetX;var q=x-this._graphicOriginY-this._offsetY;if(u){var t=this._cosAngle*z-this._sinAngle*q;z=this._sinAngle*z+this._cosAngle*q}else t=z,z=q;a=Math.min(a,t);c=Math.max(c,t);b=Math.min(b,
z);m=Math.max(m,z);d=Math.min(d,x);k=Math.max(k,x);l=Math.min(l,w);r=Math.max(r,w)}d=d!==Number.MAX_VALUE?d:-512-this._stepY;k=k!==-Number.MAX_VALUE?k:this._stepY;l=l!==Number.MAX_VALUE?l:-this._stepX;r=r!==-Number.MAX_VALUE?r:512+this._stepX;this._polygonMin=(this._verticalSubdivision=k-d>=r-l)?d:l;if(this._testInsidePolygon){t=0-this._graphicOriginX-this._offsetX-this._stepX;x=512-this._graphicOriginX-this._offsetX+this._stepX;w=-512-this._graphicOriginY-this._offsetY-this._stepY;z=0-this._graphicOriginY-
this._offsetY+this._stepY;if(u){u=[[t,w],[t,z],[x,w],[x,z]];t=w=Number.MAX_VALUE;x=z=-Number.MAX_VALUE;for(const B of u)u=this._cosAngle*B[0]-this._sinAngle*B[1],q=this._sinAngle*B[0]+this._cosAngle*B[1],t=Math.min(t,u),x=Math.max(x,u),w=Math.min(w,q),z=Math.max(z,q)}a=a!==Number.MAX_VALUE?Math.max(a,t):t;b=b!==Number.MAX_VALUE?Math.max(b,w):w;c=c!==-Number.MAX_VALUE?Math.min(c,x):x;m=m!==-Number.MAX_VALUE?Math.min(m,z):z}this._xMin=Math.round(a/this._stepX);this._xMax=Math.round(c/this._stepX);this._yMin=
Math.round(b/this._stepY);this._yMax=Math.round(m/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(e,l,r,d,k)}_buildAccelerationMap(e,a,b,c,m){e.reset();const d=new Map,k=this._verticalSubdivision;b=k?m-c:b-a;m=Math.ceil(b/10);if(!(1>=m)){b=Math.floor(b/m);m++;this._delta=b;var l,r;if(k){m=-512-this._stepY;var u=this._stepY;var w=c}else m=-this._stepX,u=512+this._stepX,w=a;for(;e.nextPath();)if(!(2>e.pathSize)&&e.nextPoint()){var x=e.x;for(l=e.y;e.nextPoint();x=
a,l=c){a=e.x;c=e.y;if(k){if(l===c||l<m&&c<m||l>u&&c>u)continue;var z=Math.min(l,c);var q=Math.max(l,c)}else{if(x===a||x<m&&a<m||x>u&&a>u)continue;z=Math.min(x,a);q=Math.max(x,a)}for(;z<q;){var t=r=Math.floor((z-w)/b),B=x,y=l,E=a,F=c,C=d;let A=C.get(t);A||(A=[],C.set(t,A));A.push([[B,y],[E,F]]);z+=b}z=Math.floor((q-w)/b);z>r&&(q=a,t=c,B=d,y=B.get(z),y||(y=[],B.set(z,y)),y.push([[x,l],[q,t]]))}}this._accelerationMap=d}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>
this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const a=this._currentY*this._stepY+this._offsetY;this._currentX++;let b;if(this._gridType===n.PlacementGridType.Random){const c=(this._currentX%24+24)%24,m=(this._currentY%24+24)%24;b=this._graphicOriginX+e+this._stepX*this._randomness*(.5-f._randValues[24*m+c])*2/3;e=this._graphicOriginY+a+
this._stepY*this._randomness*(.5-f._randValues[24*m+c+1])*2/3}else b=this._graphicOriginX+this._cosAngle*e+this._sinAngle*a,e=this._graphicOriginY-this._sinAngle*e+this._cosAngle*a;if(!this._testInsidePolygon||this._isInsidePolygon(b,e,this._geometryCursor))return this._internalPlacement.setTranslate(b,e),this._internalPlacement}}_isInsidePolygon(e,a,b){if(null==this._accelerationMap){var c=0,m;let l;e+=1E-6;a+=1E-6;for(b.reset();b.nextPath();)if(b.nextPoint()){var d=b.x;for(m=b.y;b.nextPoint();d=
k,m=l){var k=b.x;l=b.y;m>a!==l>a&&(0<(k-d)*(a-m)-(l-m)*(e-d)?c++:c--)}}return 0!==c}e+=1E-6;a+=1E-6;b=this._verticalSubdivision;m=this._accelerationMap.get(Math.floor(((b?a:e)-this._polygonMin)/this._delta));if(!m)return!1;d=0;for(c of m){m=c[0];k=c[1];if(b){if(m[1]>a===k[1]>a)continue;m=(k[0]-m[0])*(a-m[1])-(k[1]-m[1])*(e-m[0])}else{if(m[0]>e===k[0]>e)continue;m=(k[1]-m[1])*(e-m[0])-(k[0]-m[0])*(a-m[1])}0<m?d++:d--}return 0!==d}}h.PlacementInsidePolygon=p;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(h,g,v,n){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends g.PathTransformationCursor{constructor(e,a,b){super(e);this._curveHelper=new v.CurveHelper;this._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;this._offset=void 0!==a.offset?a.offset*b:0;
this._relativeTo=a.relativeTo;this._position=void 0!==a.startPointOffset?a.startPointOffset*b:0;this._epsilon=.001*b}processPath(e){var a=this._position;if(this._relativeTo===n.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(e.nextPoint()){let [b,c]=[e.x,e.y],[m,d]=[0,0];for(;e.nextPoint();){m=e.x;d=e.y;a=this._curveHelper.getLength(b,c,m,d);if(a<this._epsilon){b=m;c=d;continue}e=.5+this._position/a;const [k,l]=this._curveHelper.getAngleCS(b,c,m,d,e);e=this._curveHelper.getCoord2D(b,
c,m,d,e);this.internalPlacement.setTranslate(e[0]-this._offset*l,e[1]+this._offset*k);this._angleToLine&&this.internalPlacement.setRotateCS(k,l);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(e,a,this._relativeTo===n.PlacementOnLineRelativeTo.LineEnd)}onLine(e,a,b){let c=!1;switch(this._relativeTo){default:e.seekPathStart();a=e.pathLength()/2+a;break;case n.PlacementOnLineRelativeTo.LineBeginning:break;case n.PlacementOnLineRelativeTo.LineEnd:c=!0}b?e.seekPathEnd():
e.seekPathStart();let m=0;if(b?e.prevPoint():e.nextPoint()){let [d,k]=[e.x,e.y],[l,r]=[0,0];for(;b?e.prevPoint():e.nextPoint();){l=e.x;r=e.y;const u=this._curveHelper.getLength(d,k,l,r);if(m+u>a){e=(a-m)/u;const [w,x]=this._curveHelper.getAngleCS(d,k,l,r,e);e=this._curveHelper.getCoord2D(d,k,l,r,e);b=c?-this._offset:this._offset;this.internalPlacement.setTranslate(e[0]-b*x,e[1]+b*w);this._angleToLine&&(c?this.internalPlacement.setRotateCS(-w,-x):this.internalPlacement.setRotateCS(w,x));return this.internalPlacement}d=
l;k=r;m+=u}}return null}}h.PlacementOnLine=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(h,g,v){function n(e,a){const b=Math.PI;for(;Math.abs(a-e)>b+2E-15;)a=a-e>b?a-2*b:a+2*b;return(e+a)/2}class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(e,a,b,c,m){return new f(e,a,b)}}p.instance=null;class f extends g.PathTransformationCursor{constructor(e,
a,b){super(e);this._curveHelper=new v.CurveHelper;this._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;this._offset=void 0!==a.offset?a.offset*b:0;this._endPoints=void 0!==a.placeOnEndPoints?a.placeOnEndPoints:!0;this._controlPoints=void 0!==a.placeOnControlPoints?a.placeOnControlPoints:!0;this._regularVertices=void 0!==a.placeOnRegularVertices?a.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(e){this.iteratePath||(this._preparePath(e),this.iteratePath=!0);if(this._tagIterator>=
this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let a=e[0],b=e[1];if(0!==this._offset){const c=Math.cos(e[2]);a-=this._offset*Math.sin(e[2]);b+=this._offset*c}this.internalPlacement.setTranslate(a,b);this._tagIterator++;return this.internalPlacement}_preparePath(e){this._tagIterator=this._tags.length=0;e.seekPathStart();const a=e.isClosed();let b=0,c=!1,m=0,d=0;e.seekPathStart();
if(e.nextPoint()){let k=e.x,l=e.y,r=e.getControlPoint(),u=!0,w=e.nextPoint();for(;w;){const x=e.x,z=e.y,q=e.getControlPoint();if(this._angleToLine||0!==this._offset)m=this._curveHelper.getAngle(k,l,x,z,0);u?(u=!1,a?(b=m,c=r):(this._endPoints||this._controlPoints&&r)&&this._tags.push([k,l,m])):r?this._controlPoints&&this._tags.push([k,l,n(d,m)]):this._regularVertices&&this._tags.push([k,l,n(d,m)]);if(this._angleToLine||0!==this._offset)d=this._curveHelper.getAngle(k,l,x,z,1);(w=e.nextPoint())||(a?
q||c?this._controlPoints&&this._tags.push([x,z,n(d,b)]):this._regularVertices&&this._tags.push([x,z,n(d,b)]):(this._endPoints||this._controlPoints&&q)&&this._tags.push([x,z,d]));k=x;l=z;r=q}}this._tagIterator=0}}h.PlacementOnVertices=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(h,g,v,n,p,f){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(b,c,m,d,k){return new a(b,c,m)}}e.instance=null;class a{constructor(b,c,m){this._geometryCursor=b;this._offsetX=void 0!==c.offsetX?c.offsetX*m:0;this._offsetY=void 0!==c.offsetY?c.offsetY*m:0;this._method=void 0!==c.method?c.method:f.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new p.Placement}next(){const b=this._geometryCursor;this._geometryCursor=null;return b?this._polygonCenter(b):
null}_polygonCenter(b){let c=!1;switch(this._method){case f.PlacementPolygonCenterMethod.CenterOfMass:if(b=v.weightedAreaCentroid(b))this._internalPlacement.setTranslate(b[0]+this._offsetX,b[1]+this._offsetY),c=!0;break;case f.PlacementPolygonCenterMethod.BoundingBoxCenter:if(b=g.getCursorBoundsXY(b))this._internalPlacement.setTranslate((b[2]+b[0])/2+this._offsetX,(b[3]+b[1])/2+this._offsetY),c=!0;break;default:b=n.getLabelPoint(b),null!==b&&(this._internalPlacement.setTranslate(b[0]+this._offsetX,
b[1]+this._offsetY),c=!0)}return c?this._internalPlacement:null}}h.PlacementPolygonCenter=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(h,g,v,n,p,f,e){function a(r,u){let w=0,x,z,q,t;for(u.reset();u.nextPath()&&u.nextPoint();)for(x=u.x,z=u.y;u.nextPoint();x=q,z=t)q=u.x,t=u.y,z>r[1]!==t>r[1]&&(0<(q-x)*
(r[1]-z)-(t-z)*(r[0]-x)?w++:w--);return 0!==w}function b(r,u,w){if(w&&a(r,u))return{coord:r,distance:0};w=Infinity;let x=0,z=0;var q=[0,0];let t=[0,0];const B=[0,0];for(u.reset();u.nextPath()&&u.nextPoint();)if(!(2>u.pathSize))for(q[0]=u.x,q[1]=u.y;u.nextPoint();q=t)t=[u.x,u.y],f.projectPointOnLineSeg(B,r,q,t),q=d(r,B),q<w&&(w=q,x=B[0],z=B[1]);return{coord:[x,z],distance:Math.sqrt(w)}}function c(r,u,w,x){w=[u,0];let z=Infinity,q=Infinity,t=!1,B=!1;u=[[u,x[1]-1],[u,x[3]+1]];x=[0,0];const y=[0,0],E=
[0,0],F=[[0,0],[0,0]],C=v.create();for(r.reset();r.nextPath()&&r.nextPoint();)if(!(2>r.pathSize))for(F[0][0]=r.x,F[0][1]=r.y;r.nextPoint();F[0][0]=F[1][0],F[0][1]=F[1][1]){F[1][0]=r.x;F[1][1]=r.y;a:{var A=C;var D=F;if(2>D.length){A=null;break a}A||(A=v.create());const [J,M]=D[0],[L,Q]=D[1];A[0]=Math.min(J,L);A[1]=Math.min(M,Q);A[2]=Math.max(J,L);A[3]=Math.max(M,Q)}if(null!==A){y[0]=u[0][0];y[1]=u[0][1];E[0]=u[1][0];E[1]=u[1][1];a:{A=C;D=y;var G=E;let J=m(D,A),M=m(G,A);const L=A[0],Q=A[1],N=A[2],U=
A[3];if(J&M){A=0;break a}if(!(J|M)){A=4;break a}const Z=(J?1:0)|(M?2:0);do{const H=G[0]-D[0],O=G[1]-D[1];if(H>O)J&3?(J&1?(D[1]+=O*(L-D[0])/H,D[0]=L):(D[1]+=O*(N-D[0])/H,D[0]=N),J=m(D,A)):M&3?(M&1?(G[1]+=O*(L-G[0])/H,G[0]=L):(G[1]+=O*(N-G[0])/H,G[0]=N),M=m(G,A)):J?(J&4?(D[0]+=H*(Q-D[1])/O,D[1]=Q):(D[0]+=H*(U-D[1])/O,D[1]=U),J=m(D,A)):(M&4?(G[0]+=H*(Q-G[1])/O,G[1]=Q):(G[0]+=H*(U-G[1])/O,G[1]=U),M=m(G,A));else if(J&12?(J&4?(D[0]+=H*(Q-D[1])/O,D[1]=Q):(D[0]+=H*(U-D[1])/O,D[1]=U),J=m(D,A)):M&12?(M&4?(G[0]+=
H*(Q-G[1])/O,G[1]=Q):(G[0]+=H*(U-G[1])/O,G[1]=U),M=m(G,A)):J?(J&1?(D[1]+=O*(L-D[0])/H,D[0]=L):(D[1]+=O*(N-D[0])/H,D[0]=N),J=m(D,A)):(M&1?(G[1]+=O*(L-G[0])/H,G[0]=L):(G[1]+=O*(N-G[0])/H,G[0]=N),M=m(G,A)),J&M){A=0;break a}}while(J|M);A=Z}0!==A&&e.segmentIntersects(u[0],u[1],F[0],F[1],x)&&(A=x[1],z>q?A<z&&(z=A,t=!0):A<q&&(q=A,B=!0))}}t&&B?w[1]=(z+q)/2:w[0]=w[1]=NaN;return w}function m(r,u){return(r[0]<u[0]?1:0)|(r[0]>u[2]?1:0)<<1|(r[1]<u[1]?1:0)<<2|(r[1]>u[3]?1:0)<<3}function d(r,u){return(r[0]-u[0])*
(r[0]-u[0])+(r[1]-u[1])*(r[1]-u[1])}function k(r,u){if(r<u)return-1;if(r>u)return 1;if(r===u)return 0;r=isNaN(r);u=isNaN(u);return r<u?-1:r>u?1:0}class l{constructor(r,u,w,x){this.x=r;this.y=u;this.cellSize=w;this.distancefromCellCenter=f.distanceFromPointToPolygon(r,u,x);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}h.getLabelPoint=function(r){if(0===r.totalSize)return null;var u=n.getCursorBoundsXY(r);if(!u)return null;var w=8.8818E-14*(Math.abs(u[0])+Math.abs(u[2])+
Math.abs(u[1])+Math.abs(u[3])+1),x=0,z=0;r.reset();for(var q=0;r.nextPath();q++){var t=r.getCurrentRingArea();t>z&&(z=t,x=q)}r.seekPath(x);if(0===r.pathSize)return null;r.seekPathStart();t=n.getCursorPathBounds(r);if(Math.abs(z)<=2*w*w)return[(t[0]+t[2])/2,(t[1]+t[3])/2];r.seekPathStart();var B=p.ringCentroidCursorXY(r,v.create());if(null===B)return null;if(4>r.totalPoints)return B;z=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];x=[NaN,NaN,NaN,NaN];q=[NaN,NaN,NaN,NaN];var y=!1,E=b(B,r,!0);0===E.distance&&
(y=!0,z[0][0]=B[0],z[0][1]=B[1],E=b(B,r,!1));x[0]=E.distance;q[0]=0;var F=[NaN,NaN];let C=!1,A=.25,D=-1;E=NaN;do{E=NaN;var G=t[0];z[1]=c(r,G+(t[2]-G)*A,w,u);isNaN(z[1][0])||isNaN(z[1][1])||(E=b(z[1],r,!1),E=E.distance);if(!isNaN(E)&&E>w&&a(z[1],r))C=!0,x[1]=E,q[1]=d(z[1],B);else if(!isNaN(E)&&E>D&&(D=E,F[0]=z[1][0],F[1]=z[1][1]),A-=.01,.1>A)if(0<=D)C=!0,x[1]=D,z[1][0]=F[0],z[1][1]=F[1],q[1]=d(z[1],B);else break}while(!C);C=!1;A=.5;D=-1;G=.01;let J=1;do{E=NaN;var M=t[0];z[2]=c(r,M+(t[2]-M)*A,w,u);
isNaN(z[2][0])||isNaN(z[2][1])||(E=b(z[2],r,!1),E=E.distance);if(!isNaN(E)&&E>w&&a(z[2],r))C=!0,x[2]=E,q[2]=d(z[2],B);else if(!isNaN(E)&&E>D)D=E,F[0]=z[2][0],F[1]=z[2][1];else if(E>D&&(D=E,F[0]=z[2][0],F[1]=z[2][1]),A=.5+G*J,G+=.01,J*=-1,.3>A||.7<A)if(0<=D)C=!0,x[2]=D,z[2][0]=F[0],z[2][1]=F[1],q[2]=d(z[2],B);else break}while(!C);C=!1;A=.75;D=-1;do if(E=NaN,G=t[0],z[3]=c(r,G+(t[2]-G)*A,w,u),isNaN(z[3][0])||isNaN(z[3][1])||(E=b(z[3],r,!1),E=E.distance),!isNaN(E)&&E>w&&a(z[3],r))C=!0,x[3]=E,q[3]=d(z[3],
B);else if(E>D&&(D=E,F[0]=z[3][0],F[1]=z[3][1]),A+=.01,.9<A)if(0<=D)C=!0,x[3]=D,z[3][0]=F[0],z[3][1]=F[1],q[3]=d(z[3],B);else break;while(!C);r=[0,1,2,3];u=y?0:1;for(t=u;4>t;t++)for(y=u;3>y;y++)B=q[y],F=q[y+1],0<k(B,F)&&(w=r[y],r[y]=r[y+1],r[y+1]=w,q[y]=F,q[y+1]=B);q=u;for(t=w=0;4>u;u++){switch(u){case 0:t=2*x[r[u]];break;case 1:t=1.66666666*x[r[u]];break;case 2:t=1.33333333*x[r[u]];break;case 3:t=x[r[u]]}t>w&&(w=t,q=r[u])}return z[q]};h.getPolylabelPoint=function(r){if(!r.nextPath()||!r.pathSize)return null;
var u=n.getCursorPathBounds(r),w=u[2]-u[0],x=u[3]-u[1];if(0===w||0===x)return[u[0]+w/2,u[1]+x/2];const z=Math.max(Math.min(w,x)/100,1),q=new g((y,E)=>E.maxDistanceToPolygon-y.maxDistanceToPolygon);x=Math.min(w,x);w=x/2;let t=0,B=0;for(t=u[0];t<u[2];t+=x)for(B=u[1];B<u[3];B+=x)q.enqueue(new l(t+w,B+w,w,r));r.reset();r.nextPath();u=p.ringsCentroidCursor(r);if(null===u)return null;for(u=new l(u[0],u[1],0,r);0<q.size;)x=q.dequeue(),x.distancefromCellCenter>u.distancefromCellCenter&&(u=x),x.maxDistanceToPolygon-
u.distancefromCellCenter<=z||(w=x.cellSize/2,q.enqueue(new l(x.x-w,x.y-w,w,r)),q.enqueue(new l(x.x+w,x.y-w,w,r)),q.enqueue(new l(x.x-w,x.y+w,w,r)),q.enqueue(new l(x.x+w,x.y+w,w,r)));return[u.x,u.y]};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class h{constructor(v=g){this._data=[];this._compare=v}get size(){return this._data.length}enqueue(v){if(null!=v){var {_data:n,_compare:p}=this;n.push(v);v=n.length-1>>>0;for(var f=n[v];0<
v;){const e=v-1>>1,a=n[e];if(0>=p(a,f))n[e]=f,n[v]=a,v=e;else break}}}dequeue(){const {_data:v,_compare:n}=this,p=v[0];var f=v.pop();if(0===v.length)return p;v[0]=f;f=0;const e=v.length,a=v[0];let b;let c=null;for(;;){var m=2*f+1;const d=2*f+2;c=null;m<e&&(b=v[m],0<n(b,a)&&(c=m));d<e&&(m=v[d],null===c&&0>=n(m,a)||null!==c&&0>=n(m,b))&&(c=d);if(null===c)break;v[f]=v[c];v[c]=a;f=c}return p}}const g=(v,n)=>v<n?-1:v>n?1:0;return h})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(h){h.getFirstFrame=
function(g){const v=g.getFrame(0);if(v instanceof HTMLImageElement||v instanceof HTMLCanvasElement)return v;const n=document.createElement("canvas");n.width=g.width;n.height=g.height;g=n.getContext("2d");v instanceof ImageData?g.putImageData(v,0,0):g.drawImage(v,0,0);return n};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class h{constructor(g=0,v=0,n=0,p=0){this.x=g;this.y=v;this.width=n;this.height=p}get isEmpty(){return 0>=
this.width||0>=this.height}union(g){this.x=Math.min(this.x,g.x);this.y=Math.min(this.y,g.y);this.width=Math.max(this.width,g.width);this.height=Math.max(this.height,g.height)}}return h})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(h,g){function v(p){return`rgba(${p.slice(0,3).toString()},${p[3]})`}class n{constructor(p){p&&(this._textRasterizationCanvas=p)}rasterizeText(p,f){this._textRasterizationCanvas||(this._textRasterizationCanvas=
document.createElement("canvas"));const e=this._textRasterizationCanvas;var a=e.getContext("2d");this._setFontProperties(a,f);this._parameters=f;this._textLines=p.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:b,weight:c}=f.font;this._lineThroughWidthOffset=b&&"line-through"===b?.1*this._lineHeight:0;var m=(p=null!=f.backgroundColor||null!=f.borderLine)?g.backgroundPadding:0,d=this._computeTextWidth(a,f)+2*m,k=this._lineHeight*this._textLines.length+2*m;e.width=d+2*this._lineThroughWidthOffset;
e.height=k;if(0===e.width||0===e.height)return e.width=e.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:e};this._renderedLineHeight=Math.round(this._lineHeight*f.pixelRatio);this._renderedHaloSize=h.pt2px(f.halo.size)*f.pixelRatio;this._renderedWidth=d*f.pixelRatio;this._renderedHeight=k*f.pixelRatio;this._lineThroughWidthOffset*=f.pixelRatio;d=f.halo&&f.halo.color?f.halo.color:[0,0,0,0];this._fillStyle=v(f.color??[0,0,0,0]);this._haloStyle=`rgb(${d.slice(0,
3).toString()})`;d=this._renderedLineHeight;var l=this._renderedHaloSize;a.save();a.clearRect(0,0,e.width,e.height);this._setFontProperties(a,f);k=m*f.pixelRatio;m=a.textAlign;var r=this._renderedWidth-2*k;m=("center"===m?.5*r:"right"===m?r:0)+l+k;k=l+k;l=0<l;r=this._lineThroughWidthOffset;let u=0;if(p){a.save();p=f.backgroundColor??[0,0,0,0];const x=f.borderLine?.color??[0,0,0,0],z=2*h.pt2px(f.borderLine?.size??0);a.fillStyle=v(p);a.strokeStyle=v(x);a.lineWidth=z;a.fillRect(0,0,e.width,e.height);
a.strokeRect(0,0,e.width,e.height);a.restore()}l&&this._renderHalo(a,m,k,r,u,f);u+=k;r+=m;for(var w of this._textLines)l&&(a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(w,r,u),a.globalCompositeOperation="source-over"),a.fillStyle=this._fillStyle,a.fillText(w,r,u),b&&"none"!==b&&this._renderDecoration(a,r,u,b,c),u+=d;a.restore();w=this._renderedWidth+2*this._lineThroughWidthOffset;p=this._renderedHeight;a=a.getImageData(0,0,w,p);a=new Uint8Array(a.data);if(f.premultiplyColors)for(m=
0;m<a.length;m+=4)d=a[m+3]/255,a[m]*=d,a[m+1]*=d,a[m+2]*=d;switch(f.horizontalAlignment){case "left":d=-.5;break;case "right":d=.5;break;default:d=0}switch(f.verticalAlignment){case "bottom":f=-.5;break;case "top":f=.5;break;default:f=0}return{size:[w,p],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:d,anchorY:f,canvas:e}}_renderHalo(p,f,e,a,b,c){const m=this._renderedWidth,d=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));
this._haloRasterizationCanvas.width=m;this._haloRasterizationCanvas.height=d;const k=this._haloRasterizationCanvas,l=k.getContext("2d");l.clearRect(0,0,m,d);this._setFontProperties(l,c);const {decoration:r,weight:u}=c.font;l.fillStyle=this._haloStyle;l.strokeStyle=this._haloStyle;l.lineJoin="round";this._renderHaloNative(l,f,e,r,u);p.globalAlpha=this._parameters.halo.color[3];p.drawImage(k,0,0,m,d,a,b,m,d);p.globalAlpha=1}_renderHaloNative(p,f,e,a,b){const c=this._renderedLineHeight,m=this._renderedHaloSize;
for(const d of this._textLines){const k=2*m;for(let l=0;5>l;l++){const r=(.6+.1*l)*k;p.lineWidth=r;p.strokeText(d,f,e);a&&"none"!==a&&this._renderDecoration(p,f,e,a,b,r)}e+=c}}_setFontProperties(p,f){var e=f.font;e=`${e.style} ${e.weight} ${h.pt2px(Math.max(f.size,.5)*f.pixelRatio).toFixed(1)}px ${e.family}, sans-serif`;p.font=e;p.textBaseline="top";switch(f.horizontalAlignment){case "left":f="left";break;case "right":f="right";break;case "center":f="center";break;default:f="left"}p.textAlign=f}computeTextSize(p,
f){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const e=this._textRasterizationCanvas;var a=e.getContext("2d");this._setFontProperties(a,f);this._parameters=f;this._textLines=p.split(/\r?\n/);this._lineHeight=this._computeLineHeight();p=this._computeTextWidth(a,f);a=this._lineHeight*this._textLines.length;e.width=p;e.height=a;return[p*f.pixelRatio,a*f.pixelRatio]}_computeTextWidth(p,f){let e=0;for(const a of this._textLines)e=Math.max(e,p.measureText(a).width);
f=f.font;if("italic"===f.style||"oblique"===f.style||"string"===typeof f.weight&&("bold"===f.weight||"bolder"===f.weight)||"number"===typeof f.weight&&600<f.weight)e+=.3*p.measureText("w").width;e+=2*h.pt2px(this._parameters.halo.size);return Math.round(e)}_computeLineHeight(){let p=1.275*this._parameters.size;const f=this._parameters.font.decoration;f&&"underline"===f&&(p*=1.3);return Math.round(p+2*h.pt2px(this._parameters.halo.size))}_renderDecoration(p,f,e,a,b,c){const m=.9*this._lineHeight;switch(p.textAlign){case "center":f-=
this._renderedWidth/2;break;case "right":f-=this._renderedWidth}const d=p.textBaseline;if("underline"===a)switch(d){case "top":e+=m;break;case "middle":e+=m/2}else if("line-through"===a)switch(d){case "top":e+=m/1.5;break;case "middle":e+=m/3}a=c?1.5*c:Math.ceil(m*("bold"===b?.06:"bolder"===b?.09:.04));p.save();p.beginPath();p.strokeStyle=p.fillStyle;p.lineWidth=a;p.moveTo(f-this._lineThroughWidthOffset,e);p.lineTo(f+this._renderedWidth+2*this._lineThroughWidthOffset,e);p.stroke();p.restore()}}return n})},
"esri/symbols/cim/utils":function(){define(["require","exports"],function(h,g){function v(d){return"function"===typeof d}function n(d){let k=d.length;for(;k--;)if(!" /-,\n".includes(d.charAt(k)))return!1;return!0}function p(d,k){const l=[];var r=0;let u=-1;do u=d.indexOf("[",r),u>=r&&(u>r&&(r=d.substr(r,u-r),l.push([r,null,n(r)])),r=u+1,u=d.indexOf("]",r),u>=r&&(u>r&&(r=d.substr(r,u-r),(r=k[r])&&l.push([null,r,!1])),r=u+1));while(-1!==u);r<d.length-1&&(d=d.substr(r),l.push([d,null,n(d)]));return l}
function f(d,k,l){let r="",u=null;for(const w of k){const [x,z,q]=w;if(x)q?u=x:(u&&(r+=u,u=null),r+=x);else if(k=d.attributes[z])u&&(r+=u,u=null),r+=k}return e(r,l)}function e(d,k){"string"!==typeof d&&(d=String(d));switch(k){case "LowerCase":return d.toLowerCase();case "Allcaps":return d.toUpperCase();default:return d}}function a(d){return d?{r:d[0],g:d[1],b:d[2],a:d[3]/255}:{r:0,g:0,b:0,a:0}}function b(d){if(!d)return null;switch(d.type){case "CIMPolygonSymbol":if(d.symbolLayers)for(const k of d.symbolLayers)if(d=
b(k),null!=d)return d;break;case "CIMTextSymbol":return b(d.symbol);case "CIMSolidFill":return d.color}}function c(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d=d.symbolLayers)for(const k of d)if(d=c(k),null!=d)return d;break;case "CIMTextSymbol":return c(d.symbol);case "CIMSolidStroke":return d.color}}function m(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d.symbolLayers)for(const k of d.symbolLayers)if(d=m(k),void 0!==d)return d;break;case "CIMTextSymbol":return m(d.symbol);
case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return d.width}}g.adjustTextCase=e;g.analyzeTextParts=p;g.assignTextValuesFromFeature=f;g.attributesToFields=function(d){return(d?Object.keys(d):[]).map(k=>({name:k,alias:k,type:"string"===typeof d[k]?"esriFieldTypeString":"esriFieldTypeDouble"}))};g.colorToArray=function(d){return[d.r,d.g,d.b,d.a]};g.createLabelOverrideFunction=function(d,k,l){const r=p(k,d);return u=>f(u,r,l)};g.evaluateValueOrFunction=function(d,k,l,r){return v(d)?
d(k,l,r):d};g.fromCIMColor=a;g.fromCIMFontDecoration=function(d){return d.underline?"underline":d.strikethrough?"line-through":"none"};g.fromCIMFontStyle=function(d){let k="normal",l="normal";d&&(d=d.toLowerCase(),d.includes("italic")?k="italic":d.includes("oblique")&&(k="oblique"),d.includes("bold")?l="bold":d.includes("light")&&(l="lighter"));return{style:k,weight:l}};g.fromCIMHorizontalAlignment=function(d){switch(d){default:return"left";case "Right":return"right";case "Center":return"center";
case "Justify":return"center"}};g.fromCIMVerticalAlignment=function(d){switch(d){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};g.getFillColor=b;g.getFontStyle=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};g.getFontWeight=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";
default:return"normal"}};g.getStrokeColor=c;g.getStrokeWidth=m;g.getTintColor=d=>d.tintColor?a(d.tintColor):{r:255,g:255,b:255,a:1};g.getValue=(d,k=0)=>null==d||isNaN(d)?k:d;g.importGeometryEngine=function(){return new Promise((d,k)=>h(["../../geometry/geometryEngineJSON"],d,k))};g.isCIMFill=function(d){return null!=d&&("CIMGradientFill"===d.type||"CIMHatchFill"===d.type||"CIMPictureFill"===d.type||"CIMSolidFill"===d.type||"CIMWaterFill"===d.type)};g.isCIMMarker=function(d){return"CIMVectorMarker"===
d.type||"CIMPictureMarker"===d.type||"CIMBarChartMarker"===d.type||"CIMCharacterMarker"===d.type||"CIMPieChartMarker"===d.type||"CIMStackedBarChartMarker"===d.type};g.isCIMMarkerStrokePlacement=function(d){return null!=d&&("CIMMarkerPlacementAlongLineRandomSize"===d.type||"CIMMarkerPlacementAlongLineSameSize"===d.type||"CIMMarkerPlacementAlongLineVariableSize"===d.type||"CIMMarkerPlacementAtExtremities"===d.type||"CIMMarkerPlacementAtMeasuredUnits"===d.type||"CIMMarkerPlacementAtRatioPositions"===
d.type||"CIMMarkerPlacementOnLine"===d.type||"CIMMarkerPlacementOnVertices"===d.type)};g.isCIMStroke=function(d){return"CIMGradientStroke"===d.type||"CIMPictureStroke"===d.type||"CIMSolidStroke"===d.type};g.isFeatureValueFn=v;g.isGeometryEngineRequired=d=>{if(!d)return!1;for(const k of d)switch(k.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};g.isSVGImage=d=>d.includes("data:image/svg+xml");g.mapCIMSymbolToGeometryType=function(d){if(!d)return null;
switch(d.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};g.resampleHermite=function(d,k,l,r,u,w,x=!0){const z=k/u;l/=w;const q=Math.ceil(z/2),t=Math.ceil(l/2);for(let E=0;E<w;E++)for(let F=0;F<u;F++){const C=4*(F+(x?w-E-1:E)*u);var B=0;let A=0,D=0,G=0,J=0,M=0,L=0;const Q=(E+.5)*l;for(let N=Math.floor(E*l);N<(E+1)*l;N++){var y=Math.abs(Q-(N+.5))/t;const U=
(F+.5)*z;y*=y;for(let Z=Math.floor(F*z);Z<(F+1)*z;Z++){let H=Math.abs(U-(Z+.5))/q;B=Math.sqrt(y+H*H);-1<=B&&1>=B&&(B=2*B*B*B-3*B*B+1,0<B&&(H=4*(Z+N*k),L+=B*d[H+3],D+=B,255>d[H+3]&&(B=B*d[H+3]/250),G+=B*d[H],J+=B*d[H+1],M+=B*d[H+2],A+=B))}}r[C]=G/A;r[C+1]=J/A;r[C+2]=M/A;r[C+3]=L/D}};g.toCIMSymbolJSON=function(d){return d.data?.symbol??null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),
function(h,g,v,n,p,f,e,a,b,c){function m(u,w){u.forEach(x=>p.transformMat2d(x,x,w));return{upperLeft:a.i1616to32(8*u[0][0],8*u[0][1]),upperRight:a.i1616to32(8*u[1][0],8*u[1][1]),lowerLeft:a.i1616to32(8*u[2][0],8*u[2][1]),lowerRight:a.i1616to32(8*u[3][0],8*u[3][1])}}const d=Math.PI/180;class k{constructor(u,w,x,z){this._rotationT=n.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const q=x.rect,t=new Float32Array(8);u*=z;w*=z;const B=x.code?q.width*z:x.metrics.width,
y=x.code?q.height*z:x.metrics.height;this.width=B;this.height=y;t[0]=u;t[1]=w;t[2]=u+B;t[3]=w;t[4]=u;t[5]=w+y;t[6]=u+B;t[7]=w+y;this._data=t;this._setTextureCoords(q);this._scale=z;this._mosaic=x;this.x=u;this.y=w;this.maxOffset=Math.max(u+B,w+y)}get mosaic(){return this._mosaic}set angle(u){this._angle=u;v.fromRotation(this._rotationT,-u);this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets(this._data);return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:q,width:t}=this._mosaic.metrics;var u=t*this._scale,w=Math.abs(q)*this._scale,x=new Float32Array(8);x[0]=this.x;x[1]=this.y;x[2]=this.x+u;x[3]=this.y;x[4]=this.x;x[5]=this.y+w;x[6]=this.x+u;x[7]=this.y+w;u=v.multiply(n.create(),this._rotationT,this._transform);n.transformMany(x,x,u);w=u=Infinity;let B=0;var z=0;
for(let y=0;4>y;y++){const E=x[2*y],F=x[2*y+1];u=Math.min(u,E);w=Math.min(w,F);B=Math.max(B,E);z=Math.max(z,F)}x=B-u;z-=w;this._bounds=new c(u+x/2,w+z/2,x,z)}return this._bounds}setTransform(u){this._transform=u;this._offsets=null}_setOffsets(u){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const w=this._offsets,x=new Float32Array(8),z=v.multiply(n.create(),this._rotationT,this._transform);n.transformMany(x,u,z);w.upperLeft=a.i1616to32(8*x[0],8*x[1]);w.upperRight=
a.i1616to32(8*x[2],8*x[3]);w.lowerLeft=a.i1616to32(8*x[4],8*x[5]);w.lowerRight=a.i1616to32(8*x[6],8*x[7])}_setTextureCoords({x:u,y:w,width:x,height:z}){this._texcoords={upperLeft:a.i1616to32(u,w),upperRight:a.i1616to32(u+x,w),lowerLeft:a.i1616to32(u,w+z),lowerRight:a.i1616to32(u+x,w+z)}}}class l{constructor(u,w,x){this._rotation=0;this._decorate(u,w,x);this.glyphs=u;this.bounds=this._createBounds(u);this.isMultiline=1<w.length;this._hasRotation=0!==x.angle;this._transform=this._createGlyphTransform(this.bounds,
x);if((this._borderLineSize=x.borderLineSize)||x.hasBackground)[this.bounds,this.background]=this.shapeBackground(this._transform);for(const z of u)z.setTransform(this._transform)}setRotation(u){if(0!==u||0!==this._rotation){this._rotation=u;var w=this._transform;u=v.fromRotation(n.create(),u);v.multiply(w,u,w);for(const x of this.glyphs)x.setTransform(this._transform)}}_decorate(u,w,x){if(x.decoration&&"none"!==x.decoration&&u.length){var z=x.scale;x="underline"===x.decoration?30:20;var q=u[0].textureBinding;
for(const E of w){const F=E.startX*z,C=E.startY*z;w=u;var t=w.push;var B=(E.width+E.glyphWidthEnd)*z;var y=q;B={code:0,page:0,sdf:!0,rect:new b(0,0,11,8),textureBinding:y,metrics:{advance:0,height:4,width:B,left:0,top:0}};t.call(w,new k(F,C+x*z,B,1))}}}shapeBackground(u){const {xmin:w,ymin:x,xmax:z,ymax:q,x:t,y:B,width:y,height:E}=this.bounds;var F=Math.min(y,E)+16-1.5;F=(1.5+Math.min(g.pt2px(this._borderLineSize||0),F))/2;var C=this._borderLineSize?F:0;const A=[w-8,x-8],D=[z+8,x-8],G=[w-8,q+8],J=
[z+8,q+8],M=m([[A[0]-F,A[1]-F],[D[0]+F,D[1]-F],[A[0]+C,A[1]+C],[D[0]-C,D[1]+C]],u),L=m([[G[0]+C,G[1]-C],[J[0]-C,J[1]-C],[G[0]-F,G[1]+F],[J[0]+F,J[1]+F]],u),Q=m([[A[0]-F,A[1]-F],[A[0]+C,A[1]+C],[G[0]-F,G[1]+F],[G[0]+C,G[1]-C]],u);C=m([[D[0]-C,D[1]+C],[D[0]+F,D[1]-F],[J[0]-C,J[1]-C],[J[0]+F,J[1]+F]],u);u={main:m([A,D,G,J],u),top:M,bot:L,left:Q,right:C};return[new c(t,B,y+2*F,E+2*F),u]}get boundsT(){var u=this.bounds;const w=p.set(f.create(),u.x,u.y);p.transformMat2d(w,w,this._transform);return this._hasRotation?
(u=Math.max(u.width,u.height),new c(w[0],w[1],u,u)):new c(w[0],w[1],u.width,u.height)}_createBounds(u){let w=Infinity,x=Infinity,z=0;var q=0;for(const t of u)w=Math.min(w,t.xTopLeft),x=Math.min(x,t.yTopLeft),z=Math.max(z,t.xBottomRight),q=Math.max(q,t.yBottomRight);u=z-w;q-=x;return new c(w+u/2,x+q/2,u,q)}_createGlyphTransform(u,w){const x=d*w.angle,z=n.create(),q=f.create();v.translate(z,z,p.set(q,w.xOffset,-w.yOffset));w.isCIM?v.rotate(z,z,x):(v.translate(z,z,p.set(q,u.x,u.y)),v.rotate(z,z,x),v.translate(z,
z,p.set(q,-u.x,-u.y)));return z}}class r{constructor(u,w,x,z,q,t){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(w,x));this.end=Math.max(0,Math.max(w,x));this.end<u.length&&(this.glyphWidthEnd=u[this.end].metrics.width);this.width=z;this.yMin=q;this.yMax=t}}h.ShapedGlyph=k;h.ShapingInfo=l;h.shapeGlyphs=function(u,w,x){const z=x.scale,q=[],t=[];var B=1/x.scale*x.maxLineWidth;var y=w?u.length-1:0,E=w?-1:u.length;w=w?-1:1;var F=y,C=0,A=0;let D=F,G=D,J=0,M=Infinity,L=0;for(;F!==
E;){const {code:Z,metrics:H}=u[F];var Q=Math.abs(H.top);10!==Z&&32!==Z&&(M=Math.min(M,Q),L=Math.max(L,Q+H.height));10===Z?(F!==y&&(t.push(new r(u,D,F-w,C,M,L)),M=Infinity,L=0),C=0,D=F+w,G=F+w,A=0):32===Z?(G=F+w,A=0,J=H.advance,C+=H.advance):(C>B&&(G!==D?(Q=G-2*w,C-=J,t.push(new r(u,D,Q,C-A,M,L)),M=Infinity,L=0,D=G,C=A):(t.push(new r(u,D,F-w,C,M,L)),M=Infinity,L=0,G=D=F,C=0)),C+=H.advance,A+=H.advance);F+=w}B=new r(u,D,F-w,C,M,L);0<=B.start&&B.end<u.length&&t.push(B);for(B=0;B<t.length;B++);y=t[0].yMin;
B=t[t.length-1].yMax+x.lineHeight*(t.length-1)+("underline"===x.decoration?4:0)-y;const {vAlign:N,hAlign:U}=x;E=N===e.VAlign.Baseline?1:0;B=(1-E)*-y+B/2*(E?0:N-1)+-26*(E?1:0);for(y=0;y<t.length;y++){const {start:Z,end:H,width:O}=t[y];E=O/2*(U+1)*-1-3;w=y*x.lineHeight+B-3;t[y].startX=E;t[y].startY=w;for(F=Z;F<=H;F++)C=u[F],10!==C.code&&(A=new k(E+C.metrics.left,w-C.metrics.top,C,z),E+=C.metrics.advance,q.push(A))}return new l(q,t,x)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/Rect":function(){define(function(){class h{constructor(g=0,v=0,n=0,p=0){this.x=g;this.y=v;this.width=n;this.height=p}get isEmpty(){return 0>=this.width||0>=this.height}union(g){this.x=Math.min(this.x,g.x);this.y=Math.min(this.y,g.y);this.width=Math.max(this.width,g.width);this.height=Math.max(this.height,g.height)}}return h})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../chunks/vec2f32"],function(h){class g{constructor(v,n,p,f){this.center=
h.fromValues(v,n);this.centerT=h.create();this.halfWidth=p/2;this.halfHeight=f/2;this.width=p;this.height=f}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+
this.halfHeight}set x(v){this.center[0]=v}set y(v){this.center[1]=v}clone(){return new g(this.x,this.y,this.width,this.height)}serialize(v){v.writeF32(this.center[0]);v.writeF32(this.center[1]);v.push(this.width);v.push(this.height);return v}findCollisionDelta(v,n=4){return Math.log2(Math.min((v.halfWidth+this.halfWidth+n)/Math.abs(v.centerT[0]-this.centerT[0]),(v.halfHeight+this.halfHeight+n)/Math.abs(v.centerT[1]-this.centerT[1])))}extend(v){const n=Math.min(this.xmin,v.xmin),p=Math.min(this.ymin,
v.ymin),f=Math.max(this.xmax,v.xmax)-n;v=Math.max(this.ymax,v.ymax)-p;this.width=f;this.height=v;this.halfWidth=f/2;this.halfHeight=v/2;this.x=n+f/2;this.y=p+v/2}static deserialize(v){const n=v.readF32(),p=v.readF32(),f=v.readInt32();v=v.readInt32();return new g(n,p,f,v)}}return g})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(h,g,v){function n(f){const e={};switch(f){case "esriGeometryPoint":return(a,
b,c,m)=>v.unquantizePoint(b,e,a,c,m);case "esriGeometryPolygon":return(a,b,c,m)=>v.unquantizePolygon(b,e,a,c,m);case "esriGeometryPolyline":return(a,b,c,m)=>v.unquantizePolyline(b,e,a,c,m);case "esriGeometryMultipoint":return(a,b,c,m)=>v.unquantizeMultipoint(b,e,a,c,m);default:return g.getLogger("esri.views.2d.support.arcadeOnDemand").error(new h("mapview-arcade",`Unable to handle geometryType: ${f}`)),a=>a}}const p=new Map;return function(f,e,a,b,c){if(null==f)return null;if(f.referencesGeometry()&&
c){const {transform:m,hasZ:d,hasM:k}=c;p.has(b)||p.set(b,n(b));b=p.get(b)(e.geometry,m,d,k);e={...e,geometry:b}}e=f.repurposeFeature(e);try{return f.evaluate({...a,$feature:e},f.services)}catch(m){return g.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",m),null}}})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(h,g){function v({scale:C,translate:A},D){return Math.round((D-A[0])/C[0])}function n({scale:C,translate:A},
D){return Math.round((A[1]-D)/C[1])}function p(C,A,D){const G=[];let J,M,L,Q;for(let N=0;N<D.length;N++){const U=D[N];if(0<N){if(L=v(C,U[0]),Q=n(C,U[1]),L!==J||Q!==M)G.push(A(U,L-J,Q-M)),J=L,M=Q}else J=v(C,U[0]),M=n(C,U[1]),G.push(A(U,J,M))}return 0<G.length?G:null}function f(C,A,D,G){return p(C,D?G?F:E:G?E:y,A)}function e(C,A,D,G){const J=[];D=D?G?F:E:G?E:y;for(G=0;G<A.length;G++){const M=p(C,D,A[G]);M&&3<=M.length&&J.push(M)}return J.length?J:null}function a(C,A,D,G){const J=[];D=D?G?F:E:G?E:y;
for(G=0;G<A.length;G++){const M=p(C,D,A[G]);M&&2<=M.length&&J.push(M)}return J.length?J:null}function b({scale:C,translate:A},D){return D*C[0]+A[0]}function c({scale:C,translate:A},D){return A[1]-D*C[1]}function m(C,A,D){const G=Array(D.length);if(!D.length)return G;const [J,M]=C.scale;let L=b(C,D[0][0]);C=c(C,D[0][1]);G[0]=A(D[0],L,C);for(let Q=1;Q<D.length;Q++){const N=D[Q];L+=N[0]*J;C-=N[1]*M;G[Q]=A(N,L,C)}return G}function d(C,A,D){const G=Array(D.length);for(let J=0;J<D.length;J++)G[J]=m(C,A,
D[J]);return G}function k(C,A,D,G){return m(C,D?G?F:E:G?E:y,A)}function l(C,A,D,G){return d(C,D?G?F:E:G?E:y,A)}function r(C,A,D,G){return d(C,D?G?F:E:G?E:y,A)}function u(C,A,D){let [G,J]=D[0],M=Math.min(G,A[0]),L=Math.min(J,A[1]),Q=Math.max(G,A[2]);A=Math.max(J,A[3]);for(let N=1;N<D.length;N++){const [U,Z]=D[N];G+=U;J+=Z;0>U&&(M=Math.min(M,G));0<U&&(Q=Math.max(Q,G));0>Z?L=Math.min(L,J):0<Z&&(A=Math.max(A,J))}C[0]=M;C[1]=L;C[2]=Q;C[3]=A;return C}function w(C,A){if(!A.length)return null;C[0]=C[1]=Number.POSITIVE_INFINITY;
C[2]=C[3]=Number.NEGATIVE_INFINITY;for(let D=0;D<A.length;D++)u(C,C,A[D]);return C}function x(C,A,D,G,J){A.xmin=v(C,D.xmin);A.ymin=n(C,D.ymin);A.xmax=v(C,D.xmax);A.ymax=n(C,D.ymax);A!==D&&(G&&(A.zmin=D.zmin,A.zmax=D.zmax),J&&(A.mmin=D.mmin,A.mmax=D.mmax));return A}function z(C,A,D,G,J){A.points=f(C,D.points,G,J)??[];return A}function q(C,A,D,G,J){A.x=v(C,D.x);A.y=n(C,D.y);A!==D&&(G&&(A.z=D.z),J&&(A.m=D.m));return A}function t(C,A,D,G,J){C=e(C,D.rings,G,J);if(!C)return null;A.rings=C;return A}function B(C,
A,D,G,J){C=a(C,D.paths,G,J);if(!C)return null;A.paths=C;return A}const y=(C,A,D)=>[A,D],E=(C,A,D)=>[A,D,C[2]],F=(C,A,D)=>[A,D,C[2],C[3]];h.equals=function(C,A){if(C===A||null==C&&null==A)return!0;if(null==C||null==A)return!1;let D,G,J,M;C&&"upperLeft"===C.originPosition?(D=C.translate[0],G=C.translate[1],C=C.scale[0]):(D=null!=C.extent?C.extent.xmin:0,G=null!=C.extent?C.extent.ymax:0,C=C.tolerance);A&&"upperLeft"===A.originPosition?(J=A.translate[0],M=A.translate[1],A=A.scale[0]):(J=null!=A.extent?
A.extent.xmin:0,M=null!=A.extent?A.extent.ymax:0,A=A.tolerance);return D===J&&G===M&&C===A};h.getQuantizedBoundsCoordsArray=u;h.getQuantizedBoundsCoordsArrayArray=w;h.getQuantizedBoundsPaths=function(C){return w([0,0,0,0],C)};h.getQuantizedBoundsPoints=function(C){const A=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return u(A,A,C)};h.getQuantizedBoundsRings=function(C){return w([0,0,0,0],C)};h.quantizeBounds=function(C,A,D){A[0]=v(C,D[0]);
A[3]=n(C,D[1]);A[2]=v(C,D[2]);A[1]=n(C,D[3]);return A};h.quantizeExtent=x;h.quantizeGeometry=function(C,A){return C&&A?g.isPoint(A)?q(C,{},A,!1,!1):g.isPolyline(A)?B(C,{},A,!1,!1):g.isPolygon(A)?t(C,{},A,!1,!1):g.isMultipoint(A)?z(C,{},A,!1,!1):g.isExtent(A)?x(C,{},A,!1,!1):null:null};h.quantizeMultipoint=z;h.quantizePaths=a;h.quantizePoint=q;h.quantizePoints=f;h.quantizePolygon=t;h.quantizePolyline=B;h.quantizeRings=e;h.quantizeX=v;h.quantizeY=n;h.toQuantizationTransform=function(C){return C?{originPosition:"upper-left"===
C.originPosition?"upperLeft":"lower-left"===C.originPosition?"lowerLeft":C.originPosition,scale:C.tolerance?[C.tolerance,C.tolerance]:[1,1],translate:null!=C.extent?[C.extent.xmin,C.extent.ymax]:[0,0]}:null};h.unquantizeBounds=function(C,A,D){return D?(A[0]=b(C,D[0]),A[1]=c(C,D[3]),A[2]=b(C,D[2]),A[3]=c(C,D[1]),A):[b(C,A[0]),c(C,A[3]),b(C,A[2]),c(C,A[1])]};h.unquantizeCoordsArray=m;h.unquantizeCoordsArrayArray=d;h.unquantizeExtent=function(C,A,D,G,J){A.xmin=b(C,D.xmin);A.ymin=c(C,D.ymin);A.xmax=b(C,
D.xmax);A.ymax=c(C,D.ymax);A!==D&&(G&&(A.zmin=D.zmin,A.zmax=D.zmax),J&&(A.mmin=D.mmin,A.mmax=D.mmax));return A};h.unquantizeMultipoint=function(C,A,D,G,J){null!=D&&(A.points=k(C,D.points,G,J));return A};h.unquantizePaths=l;h.unquantizePoint=function(C,A,D,G,J){if(null==D)return A;A.x=b(C,D.x);A.y=c(C,D.y);A!==D&&(G&&(A.z=D.z),J&&(A.m=D.m));return A};h.unquantizePoints=k;h.unquantizePolygon=function(C,A,D,G,J){null!=D&&(A.rings=r(C,D.rings,G,J));return A};h.unquantizePolyline=function(C,A,D,G,J){null!=
D&&(A.paths=l(C,D.paths,G,J));return A};h.unquantizeRings=r;h.unquantizeX=b;h.unquantizeY=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(h){function g(a,b){a%=b;return 0<=a?a:a+b}const v=Number.POSITIVE_INFINITY,n=Math.PI,p=128/n,f=256/360,e=1/Math.LN2;h.between=function(a,b,c){return a>=b&&a<=c||a>=c&&a<=b};h.c2pi=2*n;h.cDegTo256=f;h.cDegToRad=n/180;h.cInfinity=v;h.cPi=n;h.cRadTo256=p;h.degToByte=
function(a){return g(a*f,256)};h.interpolate=function(a,b,c){return a*(1-c)+b*c};h.log2=function(a){return Math.log(a)*e};h.positiveMod=g;h.radToByte=function(a){return g(a*p,256)};h.sqr=function(a){return a*a};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/mathUtils"],function(h,g,v){h.rasterizeDash=function(n,p){var f="Butt"===p,e="Square"===p;p=!f&&!e;1===n.length%2&&(n=[...n,...n]);
var a=0;for(var b of n)a+=b;b=Math.round(15.5*a);a=new Float32Array(31*b);let c=0,m=0,d=.5,k=!0;for(var l of n){c=m;for(m+=15.5*l;d<=m;){for(n=.5;31>n;){const r=p?(n-15.5)*(n-15.5):Math.abs(n-15.5);a[(n-.5)*b+d-.5]=k?f?Math.max(Math.max(c+7.75-d,r),Math.max(d-m+7.75,r)):r:p?Math.min((d-c)*(d-c)+r,(d-m)*(d-m)+r):e?Math.min(Math.max(d-c,r),Math.max(m-d,r)):Math.min(Math.max(d-c+7.75,r),Math.max(m+7.75-d,r));n++}d++}k=!k}f=a.length;l=new Uint8Array(4*f);for(e=0;e<f;++e)g.packFloatRGBA((p?Math.sqrt(a[e]):
a[e])/15.5,l,4*e);return[l,b,31]};h.rasterizeSimpleFill=function(n,p,f){f=v.nextPowerOfTwo(Math.ceil(f));var e="vertical"===p||"horizontal"===p||"cross"===p||"esriSFSCross"===p||"esriSFSVertical"===p||"esriSFSHorizontal"===p?8*f:16*f;const a=2*f;n.width=e;n.height=e;const b=n.getContext("2d");b.strokeStyle="#FFFFFF";b.lineWidth=f;b.beginPath();if("vertical"===p||"cross"===p||"esriSFSCross"===p||"esriSFSVertical"===p)b.moveTo(e/2,-a),b.lineTo(e/2,e+a);if("horizontal"===p||"cross"===p||"esriSFSCross"===
p||"esriSFSHorizontal"===p)b.moveTo(-a,e/2),b.lineTo(e+a,e/2);if("forward-diagonal"===p||"diagonal-cross"===p||"esriSFSDiagonalCross"===p||"esriSFSForwardDiagonal"===p)b.moveTo(-a,-a),b.lineTo(e+a,e+a),b.moveTo(e-a,-a),b.lineTo(e+a,a),b.moveTo(-a,e-a),b.lineTo(a,e+a);if("backward-diagonal"===p||"diagonal-cross"===p||"esriSFSBackwardDiagonal"===p||"esriSFSDiagonalCross"===p)b.moveTo(e+a,-a),b.lineTo(-a,e+a),b.moveTo(a,-a),b.lineTo(-a,a),b.moveTo(e+a,e-a),b.lineTo(e-a,e+a);b.stroke();p=b.getImageData(0,
0,n.width,n.height);p=new Uint8Array(p.data);for(e=0;e<p.length;e+=4)f=p[e+3]/255,p[e]*=f,p[e+1]*=f,p[e+2]*=f;return[p,n.width,n.height]};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(h,g){function v(e,a=0){let b=0;for(let c=0;4>c;c++)b+=e[a+c]*p[c];return b}const n=[1,256,65536,16777216],p=[1/256,1/65536,1/16777216,1/4294967296],f=v(new Uint8ClampedArray([255,255,255,255]));h.packFloatRGBA=function(e,a,b=
0){e=g.clamp(e,0,f);for(let d=0;4>d;d++){var c=Math,m=e*n[d];a[b+d]=c.floor.call(c,256*(m-Math.floor(m)))}};h.unpackFloatRGBA=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(h,g,v,n,p){function f(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return f(a[0]);
case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)break;var b=a[0];if(!b)break;a=b.geometry;if(!a)break;b=b.symbol;if(!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==b.type||b.symbolLayers?.some(c=>!!c.effects))break;return{geom:a,asFill:"CIMPolygonSymbol"===b.type};case "sdf":return{geom:a.geom,asFill:a.asFill}}return null}function e(a){let b=Infinity,c=-Infinity,m=Infinity,d=-Infinity;for(const k of a)for(const l of k)l[0]<b&&(b=l[0]),l[0]>c&&(c=l[0]),l[1]<m&&(m=l[1]),l[1]>d&&(d=
l[1]);return[b,m,c,d]}h.buildSDF=function(a){var b=a.geom;var c=b?b.rings?b.rings:b.paths?b.paths:void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax?[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]:null:null;b=Infinity;var m=-Infinity;var d=Infinity;var k=-Infinity;for(var l of c)for(var r of l)r[0]<b&&(b=r[0]),r[0]>m&&(m=r[0]),r[1]<d&&(d=r[1]),r[1]>k&&(k=r[1]);d=new n(b,d,m-b,k-d);l=p.spritePadding;b=Math.floor(.5*(64-l));k=(128-2*(b+l))/Math.max(d.width,
d.height);l=Math.round(d.width*k)+2*b;r=Math.round(d.height*k)+2*b;m=[];for(var u of c)if(u&&1<u.length){c=[];for(var w of u){let [D,G]=w;D-=d.x;G-=d.y;D*=k;G*=k;D+=b-.5;G+=b-.5;a.asFill?c.push([D,G]):c.push([Math.round(D),Math.round(G)])}if(a.asFill){var x=c.length-1;c[0][0]===c[x][0]&&c[0][1]===c[x][1]||c.push(c[0])}m.push(c)}w=l*r;u=Array(w);c=b*b+1;for(d=0;d<w;++d)u[d]=c;for(var z of m)for(c=z.length,d=1;d<c;++d){k=z[d-1];x=z[d];var q=void 0,t=void 0;k[0]<x[0]?(q=k[0],t=x[0]):(q=x[0],t=k[0]);
var B=void 0,y=void 0;k[1]<x[1]?(B=k[1],y=x[1]):(B=x[1],y=k[1]);var E=Math.floor(q)-b;t=Math.floor(t)+b;B=Math.floor(B)-b;y=Math.floor(y)+b;0>E&&(E=0);t>l&&(t=l);0>B&&(B=0);y>r&&(y=r);q=x[0]-k[0];const D=x[1]-k[1],G=q*q+D*D;for(;E<t;E++)for(let J=B;J<y;J++){var F=(E-k[0])*q+(J-k[1])*D,C=void 0;0>F?(C=k[0],F=k[1]):F>G?(C=x[0],F=x[1]):(F/=G,C=k[0]+F*q,F=k[1]+F*D);C=(E-C)*(E-C)+(J-F)*(J-F);F=(r-J-1)*l+E;C<u[F]&&(u[F]=C)}}for(z=0;z<w;++z)u[z]=Math.sqrt(u[z]);if(a.asFill)for(var A of m)for(a=A.length,
z=1;z<a;++z)for(m=A[z-1],w=A[z],m[0]<w[0]?(c=m[0],d=w[0]):(c=w[0],d=m[0]),m[1]<w[1]?(x=m[1],k=w[1]):(x=w[1],k=m[1]),c=Math.floor(c),d=Math.floor(d)+1,x=Math.floor(x),k=Math.floor(k)+1,c<b&&(c=b),d>l-b&&(d=l-b),x<b&&(x=b),k>r-b&&(k=r-b);x<k;++x)if(m[1]>x!==w[1]>x){t=(r-x-1)*l;for(B=c;B<d;++B)B<(w[0]-m[0])*(x-m[1])/(w[1]-m[1])+m[0]&&(u[t+B]=-u[t+B]);for(B=b;B<c;++B)u[t+B]=-u[t+B]}A=2*b;b=u.length;a=new Uint8Array(4*b);for(z=0;z<b;++z)g.packFloatRGBA(.5-u[z]/A,a,4*z);return[a,l,r]};h.getExtent=function(a){return a?
a.rings?e(a.rings):a.paths?e(a.paths):v.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};h.getSDFInfo=f;h.getSDFMetrics=function(a,b,c,m,d){const [k,l,r,u]=a;if(r<k||u<l)return[0,0,0];var w=r-k,x=u-l,z=p.spritePadding;a=Math.floor(.5*(64-z));z=(128-2*(a+z))/Math.max(w,x);const q=Math.round(w*z),t=Math.round(x*z)+2*a;x=1;b&&(x=t/z/(b.ymax-b.ymin));let B=0,y=0;w=1;m&&(d?b&&c&&0<b.ymax-b.ymin&&(w=(b.xmax-b.xmin)/(b.ymax-b.ymin),B=m.x/(c*w),y=m.y/c):(B=m.x,y=m.y));b&&(B=.5*(b.xmax+b.xmin)+B*(b.xmax-
b.xmin),y=.5*(b.ymax+b.ymin)+y*(b.ymax-b.ymin));B=(B-k)*z+a;y=(y-l)*z+a;b=B/(q+2*a)-.5;m=y/t-.5;d&&c&&(b*=c*w,m*=c);return[x,b,m]};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(h,g,v,n,p,f,e){function a(m){const d=new Set;for(const k of m)d.add(Math.floor(k/
256));return d}function b(m,d,k){m.has(d)||m.set(d,k().then(()=>{m.delete(d)}).catch(l=>{m.delete(d);g.throwIfNotAbortError(l)}));return m.get(d)}class c{constructor(m,d,k){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this._preloadCache={};this.width=m;this.height=d;this._glyphSource=k;this._binPack=new n(m-4,d-4);this._glyphData.push(new Uint8Array(m*d));this._dirties.push(!0);this._textures.push(null);
this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const m of this._textures)m&&m.dispose();this._textures.length=0;this._glyphData.length=0}_initDecorationGlyphs(){var m=[117,149,181,207,207,181,149,117];const d=[];var k=[];for(let l=0;l<m.length;l++){const r=m[l];for(let u=0;11>u;u++){const w=3<=l&&5>l&&3<=u&&8>u?255:0;d.push(r);k.push(w)}}m={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(d)};k={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(k)};
this._recordGlyph(m);this._recordGlyph(k)}async getGlyphItems(m,d,k){const l=this._getGlyphCache(m);await this._fetchRanges(m,d,k);return d.map(r=>this._getMosaicItem(l,m,r))}bind(m,d,k,l){const r=this._getTexture(m,k);r.setSamplingMode(d);this._dirties[k]&&(r.setData(this._glyphData[k]),this._dirties[k]=!1);m.bindTexture(r,l)}preloadASCIIGlyphCache(m){var d=this._preloadCache[m];if(null!=d)return d;d=this._glyphSource.preloadASCIIRange(m).then(()=>{const k=this._getGlyphCache(m);for(let l=0;256>
l;l++)this._getMosaicItem(k,m,l)});return this._preloadCache[m]=d}_getGlyphCache(m){this._glyphCache[m]||(this._glyphCache[m]={});return this._glyphCache[m]}_getTexture(m,d){if(!this._textures[d]){const k=new e.TextureDescriptor;k.pixelFormat=p.PixelFormat.ALPHA;k.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;k.width=this.width;k.height=this.height;this._textures[d]=new f.Texture(m,k,new Uint8Array(this.width*this.height))}return this._textures[d]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(m,
d,k){const l=[];a(d).forEach(r=>{l.push(this._fetchRange(m,r,k))});await Promise.all(l)}async _fetchRange(m,d,k){if(!(256<d))return b(this._rangePromises,m+d,()=>this._glyphSource.getRange(m,d,k))}_getMosaicItem(m,d,k){if(!m[k]){d=this._glyphSource.getGlyph(d,k);if(!d?.metrics)return{rect:new v(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:k,sdf:!0};const l=this._recordGlyph(d);m[k]={rect:l,page:this._currentPage,metrics:d.metrics,code:k,sdf:!0};this._invalidate()}return m[k]}_recordGlyph(m){var d=
m.metrics;if(0===d.width)d=new v(0,0,0,0);else{const k=d.width+6,l=d.height+6;d=this._binPack.allocate(k,l);d.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new n(this.width-4,this.height-4),d=this._binPack.allocate(k,l));const r=this._glyphData[this._currentPage];m=m.bitmap;
let u,w;if(m)for(let x=0;x<l;x++){u=k*x;w=this.width*(d.y+x)+d.x;for(let z=0;z<k;z++)r[w+z]=m[u+z]}h("esri-glyph-debug")&&this._showDebugPage(r)}return d}_showDebugPage(m){const d=document.createElement("canvas"),k=d.getContext("2d"),l=new ImageData(this.width,this.height),r=l.data;d.width=this.width;d.height=this.height;d.style.border="1px solid black";for(let u=0;u<m.length;++u)r[4*u]=m[u],r[4*u+1]=0,r[4*u+2]=0,r[4*u+3]=255;k.putImageData(l,0,0);document.body.appendChild(d)}}return c})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["./Rect"],
function(h){class g{constructor(v,n){this._height=this._width=0;this._free=[];this._width=v;this._height=n;this._free.push(new h(0,0,v,n))}get width(){return this._width}get height(){return this._height}allocate(v,n){if(v>this._width||n>this._height)return new h;let p=null,f=-1;for(let e=0;e<this._free.length;++e){const a=this._free[e];v<=a.width&&n<=a.height&&(null===p||a.y<=p.y&&a.x<=p.x)&&(p=a,f=e)}if(null===p)return new h;this._free.splice(f,1);p.width<p.height?(p.width>v&&this._free.push(new h(p.x+
v,p.y,p.width-v,n)),p.height>n&&this._free.push(new h(p.x,p.y+n,p.width,p.height-n))):(p.width>v&&this._free.push(new h(p.x+v,p.y,p.width-v,p.height)),p.height>n&&this._free.push(new h(p.x,p.y+n,v,p.height-n)));return new h(p.x,p.y,v,n)}release(v){for(let n=0;n<this._free.length;++n){const p=this._free[n];if(p.y===v.y&&p.height===v.height&&p.x+p.width===v.x)p.width+=v.width;else if(p.x===v.x&&p.width===v.width&&p.y+p.height===v.y)p.height+=v.height;else if(v.y===p.y&&v.height===p.height&&v.x+v.width===
p.x)p.x=v.x,p.width+=v.width;else if(v.x===p.x&&v.width===p.width&&v.y+v.height===p.y)p.y=v.y,p.height+=v.height;else continue;this._free.splice(n,1);this.release(v)}this._free.push(v)}}return g})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(h,g){class v{constructor(f){this._metrics=[];for(this._bitmaps=[];f.next();)switch(f.tag()){case 1:const e=f.getMessage();for(;e.next();)switch(e.tag()){case 3:const a=e.getMessage();let b,
c,m,d,k,l,r;for(;a.next();)switch(a.tag()){case 1:b=a.getUInt32();break;case 2:c=a.getBytes();break;case 3:m=a.getUInt32();break;case 4:d=a.getUInt32();break;case 5:k=a.getSInt32();break;case 6:l=a.getSInt32();break;case 7:r=a.getUInt32();break;default:a.skip()}a.release();b&&(this._metrics[b]={width:m,height:d,left:k,top:l,advance:r},this._bitmaps[b]=c);break;default:e.skip()}e.release();break;default:f.skip()}}getMetrics(f){return this._metrics[f]}getBitmap(f){return this._bitmaps[f]}}class n{constructor(){this._ranges=
[]}getRange(f){return this._ranges[f]}addRange(f,e){this._ranges[f]=e}}class p{constructor(f){this._glyphInfo={};this._baseURL=f}getRange(f,e,a){const b=this._getFontStack(f);if(b.getRange(e))return Promise.resolve();const c=256*e,m=c+255;f=this._baseURL.replace("{fontstack}",f).replace("{range}",c+"-"+m);return h(f,{responseType:"array-buffer",...a}).then(d=>{b.addRange(e,new v(new g(new Uint8Array(d.data),new DataView(d.data))))})}async preloadASCIIRange(f){const e=this._getFontStack(f);f=this._baseURL.replace("{fontstack}",
f).replace("{range}","0-255");f=await h(f,{responseType:"array-buffer"});f=new v(new g(new Uint8Array(f.data),new DataView(f.data)));for(let a=0;255>=a;a++)e.getRange(a)||e.addRange(a,f)}getGlyph(f,e){if(f=this._getFontStack(f))if(f=f.getRange(Math.floor(e/256)))return{metrics:f.getMetrics(e),bitmap:f.getBitmap(e)}}_getFontStack(f){let e=this._glyphInfo[f];e||(e=this._glyphInfo[f]=new n);return e}}return p})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../core/floatRGBA",
"../../../../core/promiseUtils"],function(h,g){class v{constructor(n){this._svg=null;this.size=n;const p=document.createElement("canvas");p.width=p.height=n;this._context=p.getContext("2d",{willReadFrequently:!1});this._gridOuter=new Float64Array(n*n);this._gridInner=new Float64Array(n*n);this._f=new Float64Array(n);this._d=new Float64Array(n);this._z=new Float64Array(n+1);this._v=new Int16Array(n)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg&&
(document.body.removeChild(this._svg),this._svg=null)}draw(n,p,f,e=31){this._initSVG();const a=this.createSVGString(n,p);return new Promise((b,c)=>{const m=new Image;m.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(a);m.onload=()=>{m.onload=null;this._context.clearRect(0,0,this.size,this.size);this._context.drawImage(m,0,0,this.size,this.size);var k=this._context.getImageData(0,0,this.size,this.size);const l=new Uint8Array(this.size*this.size*4);for(let r=0;r<this.size*this.size;r++){const u=
k.data[4*r+3]/255;this._gridOuter[r]=1===u?0:0===u?1E20:Math.max(0,.5-u)**2;this._gridInner[r]=1===u?1E20:0===u?0:Math.max(0,u-.5)**2}this._edt(this._gridOuter,this.size,this.size);this._edt(this._gridInner,this.size,this.size);for(k=0;k<this.size*this.size;k++)h.packFloatRGBA(.5-(this._gridOuter[k]-this._gridInner[k])/(2*e),l,4*k);b(l)};const d=f?.signal;if(d)g.onAbort(d,()=>c(g.createAbortError()))})}_initSVG(){if(!this._svg){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");
n.setAttribute("style","position: absolute;");n.setAttribute("width","0");n.setAttribute("height","0");n.setAttribute("aria-hidden","true");n.setAttribute("role","presentation");document.body.appendChild(n);this._svg=n}return this._svg}createSVGString(n,p){const f=this._initSVG(),e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",n);f.appendChild(e);n=e.getBBox();var a=n.width/n.height;const b=this.size/2;let c,m;1<a?(c=b/n.width,m=this.size/4,a=b-1/a*b/2):(c=b/n.height,
m=b-b*a/2,a=this.size/4);e.setAttribute("style",`transform: matrix(${c}, 0, 0, ${c}, ${-n.x*c+m}, ${-n.y*c+a})`);e.setAttribute("stroke-width",`${.5/c}`);p=`<svg style="fill:${p?"red":"none"}; stroke:${p?"none":"red"}" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${f.innerHTML}</svg>`;f.removeChild(e);return p}_edt(n,p,f){const e=this._f,a=this._d,b=this._v,c=this._z;for(var m=0;m<p;m++){for(var d=0;d<f;d++)e[d]=n[d*p+m];this._edt1d(e,a,b,c,f);for(d=0;d<f;d++)n[d*
p+m]=a[d]}for(m=0;m<f;m++){for(d=0;d<p;d++)e[d]=n[m*p+d];this._edt1d(e,a,b,c,p);for(d=0;d<p;d++)n[m*p+d]=Math.sqrt(a[d])}}_edt1d(n,p,f,e,a){f[0]=0;e[0]=-1E20;e[1]=1E20;for(let b=1,c=0;b<a;b++){let m=(n[b]+b*b-(n[f[c]]+f[c]*f[c]))/(2*b-2*f[c]);for(;m<=e[c];)c--,m=(n[b]+b*b-(n[f[c]]+f[c]*f[c]))/(2*b-2*f[c]);c++;f[c]=b;e[c]=m;e[c+1]=1E20}for(let b=0,c=0;b<a;b++){for(;e[c+1]<b;)c++;p[b]=(b-f[c])*(b-f[c])+n[f[c]]}}}return v})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("../../../../core/Error ../../../../core/has ./definitions ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f,e,a,b){function c(k){return k&&"static"===k.type}class m{constructor(k,l,r=0){this._mosaicPages=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=k||0>=l)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=k;this._pageHeight=l;0<r&&(this._maxItemSize=r);this.pixelRatio=window.devicePixelRatio||1;this._binPack=new f(this._pageWidth,
this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(k){return k>=this._mosaicPages.length?-1:this._mosaicPages[k].size[0]}getHeight(k){return k>=this._mosaicPages.length?-1:this._mosaicPages[k].size[1]}getPageTexture(k){return k<this._mosaicPages.length?this._mosaicPages[k].texture:null}has(k){return this._mosaicRects.has(k)}get itemCount(){return this._mosaicRects.size}getSpriteItem(k){return this._mosaicRects.get(k)}addSpriteItem(k,
l,r,u,w,x,z=1){if(this._mosaicRects.has(k))return this._mosaicRects.get(k);let q,t,B;c(r)?[q,t,B]=this._allocateImage(l[0],l[1]):(q=new p(0,0,l[0],l[1]),t=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:r,size:[l[0]+2*v.spritePadding,l[1]+2*v.spritePadding],dirty:!0,texture:void 0}));if(0>=q.width||0>=q.height)return null;x={rect:q,width:l[0],height:l[1],sdf:w,simplePattern:x,pixelRatio:z,page:t};this._mosaicRects.set(k,x);c(r)&&(g("esri-mosaic-debug")&&this._showDebugSprite(l,r.data),
this._copy({rect:q,spriteSize:l,spriteData:r.data,page:t,pageSize:B,repeat:u,sdf:w}));return x}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const k=this._spriteCopyQueue.pop();k&&this._copy(k)}getSpriteItems(k){const l={};for(const r of k)l[r]=this.getSpriteItem(r);return l}getMosaicItemPosition(k){k=this.getSpriteItem(k);const l=k?.rect;if(!l)return null;l.width=k.width;l.height=k.height;const r=v.spritePadding,u=this._mosaicPages[k.page].size;return{size:[k.width,
k.height],tl:[(l.x+r)/u[0],(l.y+r)/u[1]],br:[(l.x+r+k.width)/u[0],(l.y+r+k.height)/u[1]],page:k.page}}bind(k,l,r=0,u=0){const w=this._mosaicPages[r],x=w.mosaicsData;var z=w.texture;if(!z){z=w.size;const q=new b.TextureDescriptor;q.width=z[0];q.height=z[1];q.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;z=new a.Texture(k,q,null);w.texture=z}z.setSamplingMode(l);c(x)?(k.bindTexture(z,u),w.dirty&&(z.setData(new Uint8Array(x.data.buffer)),z.generateMipmap(),g("esri-mosaic-debug")&&this._showDebugPage(r))):
(x.data.bindFrame(k,z,u),z.generateMipmap());w.dirty=!1}dispose(){this._binPack=null;for(const l of this._mosaicPages){var k=l.texture;k&&k.dispose();k=l.mosaicsData;c(k)||k.data.destroy()}this._mosaicPages=null;this._mosaicRects.clear()}static _copyBits(k,l,r,u,w,x,z,q,t,B,y){let E=u*l+r;z=q*x+z;if(y)for(z-=x,y=-1;y<=B;y++,E=((y+B)%B+u)*l+r,z+=x)for(q=-1;q<=t;q++)w[z+q]=k[E+(q+t)%t];else for(r=0;r<B;r++){for(u=0;u<t;u++)w[z+u]=k[E+u];E+=l;z+=x}}_copy(k){if(!(k.page>=this._mosaicPages.length)){var l=
this._mosaicPages[k.page],r=l.mosaicsData;if(!c(l.mosaicsData))throw new h("mapview-invalid-resource","unsuitable data type!");var u=k.spriteData;(r=r.data)&&u||console.error("Source or target images are uninitialized!");m._copyBits(u,k.spriteSize[0],0,0,r,k.pageSize[0],k.rect.x+v.spritePadding,k.rect.y+v.spritePadding,k.spriteSize[0],k.spriteSize[1],k.repeat);l.dirty=!0}}_allocateImage(k,l){k+=2*v.spritePadding;l+=2*v.spritePadding;var r=Math.max(k,l);if(this._maxItemSize&&this._maxItemSize<r){r=
2**Math.ceil(n.log2(k));const u=2**Math.ceil(n.log2(l));k=new p(0,0,k,l);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*u)},size:[r,u],dirty:!0,texture:void 0});return[k,this._mosaicPages.length-1,[r,u]]}r=this._binPack.allocate(k,l);return 0>=r.width?(r=this._mosaicPages[this._currentPage],!r.dirty&&c(r.mosaicsData)&&(r.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*
this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new f(this._pageWidth,this._pageHeight),this._allocateImage(k,l)):[r,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([k,l],r){const u=document.createElement("canvas");u.width=k;u.height=l;u.setAttribute("style",`position: absolute; top: ${4+204*d++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const w=u.getContext("2d");k=new ImageData(k,l);k.data.set(new Uint8Array(r.buffer));
w.putImageData(k,0,0);document.body.appendChild(u)}_showDebugPage(k){const {size:[l,r],mosaicsData:u}=this._mosaicPages[k];if(c(u)){var w=`mosaicDebugPage${k}`,x=document.getElementById(w)??document.createElement("canvas");x.id=w;x.width=l;x.height=r;x.setAttribute("style",`position: absolute; top: ${4+204*k}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);k=x.getContext("2d");w=new ImageData(l,r);w.data.set(new Uint8Array(u.data.buffer));k.putImageData(w,0,0);document.body.appendChild(x)}else console.error("Could not show sprite mosaic debug for non-static resource")}}
let d=0;return m})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports","../definitions","./utils"],function(h,g,v){class n{constructor(p,f,e,a){this._animation=p;this._frameData=null;this.frameCount=this._animation.frameDurations.length;this.width=this._animation.width;this.height=this._animation.height;this._playHandle=v.play(this._animation,e,a,b=>{this._frameData=b;f.requestRender()})}destroy(){this._playHandle.remove()}bindFrame(p,f,e){p.bindTexture(f,
e);p=this._frameData;null!=p&&(f.updateData(0,g.spritePadding,g.spritePadding,"width"in p?p.width:p.codedWidth,"height"in p?p.height:p.codedHeight,p),this._frameData=null)}}h.AnimatableTextureResource=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define("exports ../../../../../core/handleUtils ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ../../../../../symbols/cim/enums ../grouping".split(" "),
function(h,g,v,n,p,f){function e(u){return v.Milliseconds(u.frameDurations.reduce((w,x)=>w+x,0))}function a(u){const {width:w,height:x}=u,z=u.frameDurations.reverse();return{frameCount:u.frameCount,duration:u.duration,frameDurations:z,getFrame:q=>u.getFrame(u.frameDurations.length-1-q),width:w,height:x}}function b(u,w){const {width:x,height:z,getFrame:q}=u,t=w/u.duration;w=u.frameDurations.map(B=>v.Milliseconds(B*t));return{frameCount:u.frameCount,duration:u.duration,frameDurations:w,getFrame:q,width:x,
height:z}}function c(u,w){const {width:x,height:z,getFrame:q}=u,t=u.frameDurations.slice(),B=t.shift();t.unshift(v.Milliseconds(B+w));return{frameCount:u.frameCount,duration:u.duration+w,frameDurations:t,getFrame:q,width:x,height:z}}function m(u,w){const {width:x,height:z,getFrame:q}=u,t=u.frameDurations.slice(),B=t.pop();t.push(v.Milliseconds(B+w));return{frameCount:u.frameCount,duration:u.duration+w,frameDurations:t,getFrame:q,width:x,height:z}}function d(u,w,x,z){let {repeatType:q}=w;null==q&&
(q=p.AnimatedSymbolRepeatType.Loop);!0===w.reverseAnimation&&(u=a(u));null!=w.duration&&(u=b(u,v.Milliseconds(1E3*w.duration)));if(null!=w.repeatDelay){const t=1E3*w.repeatDelay;q===p.AnimatedSymbolRepeatType.Loop?u=m(u,v.Milliseconds(t)):q===p.AnimatedSymbolRepeatType.Oscillate&&(u=c(m(u,v.Milliseconds(t/2)),v.Milliseconds(t/2)))}null!=w.startTimeOffset?w=v.Milliseconds(1E3*w.startTimeOffset):null!=w.randomizeStartTime?(x=f.getMaterialGroup(x),w=f.getRandomValue(x,null!=w.randomizeStartSeed?w.randomizeStartSeed:
82749913),w=v.Milliseconds(w*e(u))):w=v.Milliseconds(0);return new k(u,w,q,z)}class k{constructor(u,w,x,z){this._animation=u;this._repeatType=x;this._onFrameData=z;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(u=0;w>u;)u+=this.timeToFrame,this.nextFrame();w=this._animation.getFrame(this._currentFrame);this._onFrameData(w)}nextFrame(){this._currentFrame+=this._direction;if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case p.AnimatedSymbolRepeatType.None:this._currentFrame-=
this._direction;break;case p.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case p.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case p.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case p.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case p.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=
1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const u=this._animation.getFrame(this._currentFrame);this._onFrameData(u)}}let l,r;h.Player=k;h.adjustDuration=b;h.appendDelay=m;h.createPlayer=d;h.getDuration=e;h.play=function(u,w,x,z){function q(){E=t?setTimeout(()=>{B.nextFrame();y=B.timeToFrame;q()},y):void 0}const t=null!=w.playAnimation?w.playAnimation:!0,B=d(u,w,x,z);let y=B.timeToFrame,E;q();return g.makeHandle(()=>t&&clearTimeout(E))};h.prependDelay=c;h.resize=function(u,
w,x){l??(l=document.createElement("canvas"));r??(r=l.getContext("2d"));const {canvas:z,ctx:q}={canvas:l,ctx:r};z.width=w;z.height=x;const t=[],B=u.frameDurations.length;for(let y=0;y<B;y++){const E=u.getFrame(y);q.clearRect(0,0,w,x);E instanceof ImageData?q.drawImage(n.imageTypeToCanvas(E),0,0,w,x):q.drawImage(E,0,0,w,x);t.push(q.getImageData(0,0,w,x))}return{width:w,height:x,frameDurations:u.frameDurations,getFrame:y=>t[y],frameCount:u.frameCount,duration:u.duration}};h.reverse=a;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/exporters/gltf/imageutils":function(){define(["exports","../../../../../core/has","../../../../../core/Error","../../../../../core/urlUtils"],function(h,g,v,n){async function p(e){if(!(e instanceof HTMLImageElement))return"image/png";e=e.src;return n.isDataProtocol(e)?(e=n.dataComponents(e),"image/jpeg"===e?.mediaType?e.mediaType:"image/png"):/\.png$/i.test(e)?"image/png":/\.(jpg|jpeg)$/i.test(e)?"image/jpeg":"image/png"}function f(e){if(e instanceof
HTMLCanvasElement)return e;if(e instanceof HTMLVideoElement)return null;const a=document.createElement("canvas");a.width=e.width;a.height=e.height;const b=a.getContext("2d");e instanceof HTMLImageElement?b.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&b.putImageData(e,0,0);return a}h.encodeBase64DataUri=function(e){const a=[];e=new Uint8Array(e);for(let b=0;b<e.length;b++)a.push(String.fromCharCode(e[b]));return"data:application/octet-stream;base64,"+btoa(a.join(""))};h.imageToArrayBuffer=
async function(e){const a=f(e);if(null==a)throw new v("imageToArrayBuffer","Unsupported image type");const b=await p(e);e=await new Promise(c=>a.toBlob(c,b));if(!e)throw new v("imageToArrayBuffer","Failed to encode image");return{data:await e.arrayBuffer(),type:b}};h.imageToDataURI=function(e){e=f(e);return null!=e?e.toDataURL():""};h.imageTypeToCanvas=f;h.isArrayBufferPNG=function(e){if(8>e.byteLength)return!1;e=new Uint8Array(e);return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===
e[5]&&26===e[6]&&10===e[7]};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(h,g){function v(n,p){if("string"===typeof n)n=g.numericHash(n+`-seed(${p})`);else{let f=12;n^=p;do n=107*(n>>8^n)+f|0;while(0!==--f)}return(1+n/-2147483648)/2}h.getMaterialGroup=function(n){return Math.floor(10*v(n,53290320))};h.getRandomValue=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/util/Result":function(){define(["exports","../../../../../core/Error"],function(h,g){h.ok=function(v,n){return v&&"name"in v?(n&&n.error(new g(v.name,v.message,v.details)),!1):!0};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["exports"],function(h){h.keyFromSymbol=function(g){switch(g.type){case "esriSMS":return`${g.style}.${g.path}`;case "esriSLS":return`${g.style}.${g.cap}`;case "esriSFS":return`${g.style}`;
case "esriPFS":case "esriPMS":return g.imageData?`${g.imageData}${g.width}${g.height}`:`${g.url}${g.width}${g.height}`;default:return"mosaicHash"in g?g.mosaicHash:JSON.stringify(g)}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../core/promiseUtils","./definitions","../../../webgl/contextUtils"],function(h,g,v,n){class p{constructor(f,e){this._queue=[];this._context=f;this._refreshable=e}destroy(){this._queue=
[]}enqueueTextureUpdate(f,e){const a=g.createResolver(),b=v.textureUploadManagerChunkSize,c=Math.ceil(f.height/b);g.throwIfAborted(e);if(this._context.type===n.ContextType.WEBGL1)this._queue.push({type:"no-chunk",request:f,resolver:a,options:e});else for(let m=0;m<c;m++){const d=m===c-1;this._queue.push({type:"chunk",request:f,resolver:a,chunk:m,chunkOffset:m*b,destHeight:d?f.height-b*m:b,chunkIsLast:d,options:e})}g.onAbortOrThrow(e,m=>a.reject(m));return a.promise}upload(){let f=0;for(;this._queue.length;){var e=
performance.now();const a=this._queue.shift();if(a&&(null==a.options.signal||!a.options.signal.aborted)){switch(a.type){case "chunk":this._uploadChunk(a);break;case "no-chunk":this._uploadNoChunk(a)}e=performance.now()-e;f+=e;if(f+e>=v.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(f){const {request:e,resolver:a,chunkOffset:b,chunkIsLast:c,destHeight:m}=f,{data:d,texture:k,width:l}=e;null!=d&&(k.updateData(0,0,b,l,m,d,b),c&&a.resolve())}_uploadNoChunk(f){const {request:e,
resolver:a}=f,{data:b,texture:c}=e;c.setData(b);a.resolve()}}h.TextureUploadManager=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define("exports ../../../../core/maybe ../../../../chunks/common ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./VertexStream ./shaders/StencilPrograms ../../../webgl/enums ../../../webgl/ProgramTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d){const k=f.fromValues(-.5,-.5);class l{constructor(){this._centerNdc=a.create();this._pxToNdc=a.create();this._worldDimensionsPx=a.create();this._mat3=p.create();this._initialized=!1}dispose(){this._program=g.disposeMaybe(this._program);this._quad=g.disposeMaybe(this._quad)}render(r,u,w){const {context:x}=r;r=this._updateGeometry(r,w);if(null!=u){const {r:z,g:q,b:t,a:B}=u;x.setClearColor(B*z/255,B*q/255,B*t/255,B)}else x.setClearColor(0,0,0,0);x.setStencilFunction(m.CompareFunction.ALWAYS,
0,255);x.setStencilWriteMask(255);r?(x.setClearStencil(0),x.clear(x.gl.STENCIL_BUFFER_BIT|x.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(x),x.setDepthWriteEnabled(!1),x.setDepthTestEnabled(!1),x.setColorMask(!1,!1,!1,!1),x.setBlendingEnabled(!1),x.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE),x.setStencilFunction(m.CompareFunction.ALWAYS,1,255),x.setStencilTestEnabled(!0),x.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",
this._mat3),this._quad.draw(),this._quad.unbind()):(x.setClearStencil(1),x.clear(x.gl.STENCIL_BUFFER_BIT|x.gl.COLOR_BUFFER_BIT))}_initialize(r){if(!this._initialized){var u=d.createProgram(r,c.stencil);u&&(this._program=u,this._quad=new b(r,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}_updateGeometry(r,u){const {state:w,pixelRatio:x}=r,{size:z,rotation:q}=w,t=Math.round(z[0]*x),B=Math.round(z[1]*x);if(!w.spatialReference.isWrappable)return!1;r=v.toRadian(q);const y=Math.abs(Math.cos(r)),E=Math.abs(Math.sin(r)),
F=Math.round(w.worldScreenWidth);if(Math.round(t*y+B*E)<=F)return!1;const C=(u.left-u.right)*x/t;u=(u.bottom-u.top)*x/B;e.set(this._worldDimensionsPx,F*x,t*E+B*y,1);e.set(this._pxToNdc,2/t,-2/B,1);e.set(this._centerNdc,C,u,1);u=this._mat3;n.fromTranslation(u,this._centerNdc);n.scale(u,u,this._pxToNdc);0!==q&&n.rotate(u,u,r);n.scale(u,u,this._worldDimensionsPx);n.translate(u,u,k);return!0}}h.WorldExtentRenderer=l;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports",
"./sources/resolver"],function(h,g){g={shaders:{vertexShader:g.resolveIncludes("stencil/stencil.vert"),fragmentShader:g.resolveIncludes("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};h.stencil=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define(["exports","../../../../../core/has","../definitions","../VertexStream","./Effect"],function(h,g,v,n,p){class f extends p.Effect{constructor(){super(...arguments);
this.defines=[];this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(e,a){if(a?.size){var {context:b,renderingOptions:c}=e;this._quad||(this._quad=new n(b,[0,0,1,0,0,1,1,1]));var m=b.getBoundFramebufferObject(),{x:d,y:k,width:l,height:r}=b.getViewport();a.bindTextures(b);var u=a.getBlock(v.attributeDataAnimation);if(null!=u){var w=u.getFBO(b);u=u.getFBO(b,1);b.setViewport(0,0,a.size,a.size);
this._computeDelta(e,u,c.labelsAnimationTime);this._updateAnimationState(e,u,w);b.bindFramebuffer(m);b.setViewport(d,k,l,r)}}}_computeDelta(e,a,b){const {context:c,painter:m,displayLevel:d}=e,k=m.materialManager.getProgram(this._desc,["delta"]);c.bindFramebuffer(a);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.useProgram(k);a=g("featurelayer-animation-enabled")?b:1;k.setUniform1i("u_maskTexture",v.textureBindingAttributeData0);k.setUniform1i("u_sourceTexture",v.textureBindingAttributeData1);
k.setUniform1f("u_timeDelta",e.deltaTime);k.setUniform1f("u_animationTime",a);k.setUniform1f("u_zoomLevel",Math.round(10*d));this._quad.draw()}_updateAnimationState(e,a,b){const {context:c,painter:m}=e;e=m.materialManager.getProgram(this._desc,["update"]);c.bindTexture(a.colorTexture,1);c.useProgram(e);e.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(b);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()}}h.AnimationEffect=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ../shaders/BlendPrograms ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(h,g,v,n,p,f,e,a,b,c){const m=v.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class d{constructor(){this._size=[0,0]}dispose(k){this._backBufferTexture=n.disposeMaybe(this._backBufferTexture);
this._quad=n.disposeMaybe(this._quad)}draw(k,l,r,u,w){const {context:x,drawPhase:z}=k;this._setupShader(x);u&&"normal"!==u&&z!==p.WGLDrawPhase.LABEL?this._drawBlended(k,l,r,u,w):(k=e.createProgramTemplate("normal"),(k=x.programCache.acquire(k.shaders.vertexShader,k.shaders.fragmentShader,k.attributes))?(x.useProgram(k),l.setSamplingMode(r),x.bindTexture(l,0),k.setUniform1i("u_layerTexture",0),k.setUniform1f("u_opacity",w),x.setBlendingEnabled(!0),x.setBlendFunction(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA),
l=this._quad,l.draw(),l.unbind(),k.dispose()):m.error(new g("mapview-BlendEffect",'Error creating shader program for blend mode "normal"')))}_drawBlended(k,l,r,u,w){const {context:x,state:z,pixelRatio:q,inFadeTransition:t}=k;var {size:B}=z,y=x.getBoundFramebufferObject();let E;null!=y?(E=y.width,B=y.height):(E=Math.round(q*B[0]),B=Math.round(q*B[1]));this._createOrResizeTexture(k,E,B);k=this._backBufferTexture;y.copyToTexture(0,0,E,B,0,0,k);x.setStencilTestEnabled(!1);x.setStencilWriteMask(0);x.setBlendingEnabled(!0);
x.setDepthTestEnabled(!1);x.setDepthWriteEnabled(!1);y=e.createProgramTemplate(u);(y=x.programCache.acquire(y.shaders.vertexShader,y.shaders.fragmentShader,y.attributes))?(x.useProgram(y),k.setSamplingMode(r),x.bindTexture(k,0),y.setUniform1i("u_backbufferTexture",0),l.setSamplingMode(r),x.bindTexture(l,1),y.setUniform1i("u_layerTexture",1),y.setUniform1f("u_opacity",w),y.setUniform1f("u_inFadeOpacity",t?1:0),x.setBlendFunction(a.BlendFactor.ONE,a.BlendFactor.ZERO),l=this._quad,l.draw(),l.unbind(),
y.dispose(),x.setBlendFunction(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA)):m.error(new g("mapview-BlendEffect",`Error creating shader program for blend mode ${u}`))}_setupShader(k){this._quad||(this._quad=new f(k,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(k,l,r){({context:k}=k);if(null===this._backBufferTexture||l!==this._size[0]||r!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(l,r);else{const u=new c.TextureDescriptor;u.internalFormat=a.PixelFormat.RGBA;
u.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;u.width=l;u.height=r;this._backBufferTexture=new b.Texture(k,u)}this._size[0]=l;this._size[1]=r}}}h.BlendEffect=d;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BlendPrograms":function(){define(["exports","./sources/resolver"],function(h,g){h.createProgramTemplate=function(v){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:`#define ${v.replace("-","_").toUpperCase()}\n`+g.resolveIncludes("blend/blend.vert"),
fragmentShader:`#define ${v.replace("-","_").toUpperCase()}\n`+g.resolveIncludes("blend/blend.frag")}}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports","./Effect","../../../../webgl/enums"],function(h,g,v){class n extends g.Effect{constructor(p){super();this.name=this.constructor.name;this.defines=[p]}dispose(){}bind({context:p,painter:f}){this._prev=p.getBoundFramebufferObject();f=f.getFbos().effect0;
p.bindFramebuffer(f);p.setColorMask(!0,!0,!0,!0);p.setClearColor(0,0,0,0);p.clear(p.gl.COLOR_BUFFER_BIT)}unbind(){}draw(p,f){const {context:e,painter:a}=p;f=a.getPostProcessingEffects(f);const b=e.getBoundFramebufferObject();for(const {postProcessingEffect:c,effect:m}of f)c.draw(p,b,m);e.bindFramebuffer(this._prev);e.setStencilTestEnabled(!1);a.blitTexture(e,b.colorTexture,v.TextureSamplingMode.NEAREST);e.setStencilTestEnabled(!0)}}h.FeatureEffect=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightRenderer ./highlight/HighlightSurfaces ../../../../webgl/enums".split(" "),function(h,g,v,n,p,f){class e extends v.Effect{constructor(){super(...arguments);this.defines=["highlight"];this._hlRenderer=new n;this._height=this._width=void 0;this._boundFBO=null;this._hlSurfaces=new p;this._adjustedHeight=this._adjustedWidth=void 0;this._blitRenderer=new g.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose();
this._hlRenderer?.dispose();this._boundFBO=null}bind(a){const {context:b,painter:c}=a,{width:m,height:d}=b.getViewport(),k=c.getFbos().effect0;this.setup(a,m,d);b.bindFramebuffer(k);b.setColorMask(!0,!0,!0,!0);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:a},b,c){this._width=b;this._height=c;const m=b%4,d=c%4;b+=2>m?-m:4-m;c+=2>d?-d:4-d;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();b=Math.round(1*b);c=Math.round(1*c);this._hlRenderer.setup(a,
b,c);this._hlSurfaces.setup(a,b,c)}draw(a){const {context:b,highlightGradient:c}=a;c&&(a=b.getBoundFramebufferObject(),b.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),b.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),b.setStencilTestEnabled(!1),b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(b,a.colorTexture,f.TextureSamplingMode.NEAREST,1),b.setStencilTestEnabled(!1),b.setBlendingEnabled(!1),b.setColorMask(!1,!1,!1,!0),b.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),
b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(b,this._hlSurfaces.sharedBlur1Tex),b.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(b,this._hlSurfaces.sharedBlur2Tex),b.bindFramebuffer(this._boundFBO),b.setBlendingEnabled(!0),b.setColorMask(!0,!0,!0,!0),b.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(b,this._hlSurfaces.sharedBlur1Tex,c),this._boundFBO=
null)}}return e})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/enums ../../../../../webgl/ProgramTemplate ../../../../../webgl/VertexArrayObject ../../../../../webgl/VertexElementDescriptor".split(" "),function(h,g,v,n,p,f,e,a){class b{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),
this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(c,m){c.bindTexture(m,h.textureBindingHighlight0);c.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",g.alphaToRgbaChannelSelectorMatrix);c.bindVAO(this._resources.quadVAO);c.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);
c.bindVAO()}finalBlur(c,m){c.bindTexture(m,h.textureBindingHighlight0);c.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",g.rgbaToRgbaChannelSelectorMatrix);c.bindVAO(this._resources.quadVAO);c.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);c.bindVAO()}renderHighlight(c,m,d){c.bindTexture(m,h.textureBindingHighlight0);c.useProgram(this._resources.highlightProgram);
d.applyHighlightOptions(c,this._resources.highlightProgram);c.bindVAO(this._resources.quadVAO);c.setBlendingEnabled(!0);c.setBlendFunction(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);c.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);c.bindVAO()}_initialize(c,m,d){this._width=m;this._height=d;m=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);d=new e.VertexArrayObject(c,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new a.VertexElementDescriptor("a_position",
2,p.DataType.BYTE,0,4),new a.VertexElementDescriptor("a_texcoord",2,p.DataType.UNSIGNED_BYTE,2,4)]},{geometry:m});const k=f.createProgram(c,v.highlight),l=f.createProgram(c,v.blur);c.useProgram(k);k.setUniform1i("u_texture",h.textureBindingHighlight0);k.setUniform1i("u_shade",h.textureBindingHighlight1);k.setUniform1f("u_sigma",g.sigma);c.useProgram(l);l.setUniform1i("u_texture",h.textureBindingHighlight0);l.setUniform1f("u_sigma",g.sigma);this._resources={quadGeometry:m,quadVAO:d,highlightProgram:k,
blurProgram:l}}setup(c,m,d){this._resources?(this._width=m,this._height=d):this._initialize(c,m,d)}}return b})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],function(h,g){const v={shaders:{vertexShader:g.resolveIncludes("highlight/textured.vert"),fragmentShader:g.resolveIncludes("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};g={shaders:{vertexShader:g.resolveIncludes("highlight/textured.vert"),fragmentShader:g.resolveIncludes("highlight/blur.frag")},
attributes:new Map([["a_position",0],["a_texcoord",1]])};h.blur=g;h.highlight=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/RenderbufferDescriptor","../../../../../webgl/TextureDescriptor"],function(h,g,v,n){function p(e,a,b){const c=new n.TextureDescriptor(a,b);c.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;
return new g.FramebufferObject(e,c,new v.RenderbufferDescriptor(h.RenderbufferFormat.STENCIL_INDEX8,a,b))}class f{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(e,a,b){this._width=a;this._height=b;const c=p(e,a,b);e=p(e,a,b);this._resources={sharedBlur1Fbo:c,sharedBlur2Fbo:e}}setup(e,a,b){!this._resources||this._width===a&&this._height===
b||this.dispose();this._resources||this._initialize(e,a,b)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}return f})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports","../definitions","./Effect","../../../../webgl/enums"],function(h,g,v,n){class p extends v.Effect{constructor(){super(...arguments);
this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:f},e,a=g.hittestRadius){if(!e.length)return null;e=e.shift();const b=e.x,c=e.y;this._outstanding=e;return{type:"hittest",distance:a*f,position:[b,c]}}bind(f){const {context:e,attributeView:a}=f;a.size&&(f=a.getBlock(g.attributeDataGpgpu),null!=f&&(f=f.getFBO(e),e.setViewport(0,0,a.size,a.size),e.bindFramebuffer(f),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT|
e.gl.DEPTH_BUFFER_BIT)))}unbind(f){}draw(f){if(null!=this._outstanding){var e=this._outstanding;this._outstanding=null;this._resolve(f,e.resolvers)}}async _resolve(f,e){const {context:a,attributeView:b}=f;f=b.getBlock(g.attributeDataGpgpu);if(null==f)e.forEach(d=>d.resolve([]));else{var c=f.getFBO(a);f=new Uint8Array(c.width*c.height*4);try{await c.readPixelsAsync(0,0,c.width,c.height,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,f)}catch(d){e.forEach(k=>k.resolve([]));return}c=[];for(let d=0;d<f.length;d+=
4){const k=f[d+3];f[d]&&c.push({id:d/4,directHits:k})}c.sort((d,k)=>k.directHits===d.directHits?k.id-d.id:k.directHits-d.directHits);var m=c.map(d=>d.id);e.forEach(d=>d.resolve(m))}}}h.HittestEffect=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HittestEffectVTL":function(){define(["exports","../definitions","./Effect","../../../../webgl/enums"],function(h,g,v,n){class p extends v.Effect{constructor(){super(...arguments);this.name=this.constructor.name;
this.defines=["id"];this._lastSize=0;this._boundFBO=null}dispose(){null!=this._fbo&&this._fbo.dispose()}bind({context:f,painter:e}){this._boundFBO=f.getBoundFramebufferObject();e=e.getFbos().effect0;f.bindFramebuffer(e);f.setColorMask(!0,!0,!0,!0);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT)}unbind({context:f}){f.bindFramebuffer(this._boundFBO);this._boundFBO=null}draw(f,e,a=2*g.hittestRadius){this._resolve(f,e,a)}async _resolve({context:f,state:e,pixelRatio:a},b,c){const m=f.getBoundFramebufferObject(),
d=e.size[1]*a,k=Math.round(c*a),l=k/2,r=k/2;this._ensureBuffer(k);b.forEach(async(u,w)=>{var x=new Map;await m.readPixelsAsync(Math.floor(w.x*a-k/2),Math.floor(d-w.y*a-k/2),k,k,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,this._buf);for(let t=0;t<this._buf32.length;t++){const B=this._buf32[t];if(4294967295!==B&&0!==B){var z=t%k,q=k-Math.floor(t/k);z=(l-z)*(l-z)+(r-q)*(r-q);q=x.has(B)?x.get(B):4294967295;x.set(B,Math.min(z,q))}}x=Array.from(x).sort((t,B)=>t[1]-B[1]).map(t=>t[0]);u.resolve(x);b.delete(w)})}_ensureBuffer(f){this._lastSize!==
f&&(this._lastSize=f,this._buf=new Uint8Array(4*f*f),this._buf32=new Uint32Array(this._buf.buffer))}}h.HittestEffectVTL=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define("exports ./Bloom ./Blur ./Colorize ./DropShadow ./Opacity".split(" "),function(h,g,v,n,p,f){const e={colorize:()=>new n.Colorize,blur:()=>new v.Blur,bloom:()=>new g.Bloom,opacity:()=>new f.Opacity,"drop-shadow":()=>new p.DropShadow};
class a{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach(b=>b.dispose());this._effectMap.clear()}getPostProcessingEffects(b){if(!b||0===b.length)return[];const c=[];for(const m of b){a:switch(b=m.type,b){case "bloom":case "blur":case "opacity":case "drop-shadow":break a;default:b="colorize"}let d=this._effectMap.get(b);d||(d=e[b](),this._effectMap.set(b,d));c.push({postProcessingEffect:d,effect:m})}return c}}h.EffectManager=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),function(h,g,v,n,p,f){const e=[1,0],a=[0,1],b=[1,.8,.6,.4,.2],c=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class m{constructor(){this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0];
this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",
0]])}}}dispose(){this._quad=g.disposeMaybe(this._quad);this._intensityFBO=g.disposeMaybe(this._intensityFBO);this._compositeFBO=g.disposeMaybe(this._compositeFBO);if(this._mipsFBOs){for(let d=0;d<this._nMips;d++)this._mipsFBOs[d]&&(this._mipsFBOs[d].horizontal.dispose(),this._mipsFBOs[d].vertical.dispose());this._mipsFBOs=null}}draw(d,k,l){const {width:r,height:u}=k,{context:w,painter:x}=d,{materialManager:z}=x;var q=w.gl;const t=this._programDesc,{strength:B,radius:y,threshold:E}=l;this._quad||(this._quad=
new v(w,[-1,-1,1,-1,-1,1,1,1]));this._createOrResizeResources(d,r,u);w.setStencilTestEnabled(!1);w.setBlendingEnabled(!0);w.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);w.setStencilWriteMask(0);d=this._quad;d.bind();w.bindFramebuffer(this._intensityFBO);l=z.getProgram(t.luminosityHighPass);w.useProgram(l);w.bindTexture(k.colorTexture,0);l.setUniform1i("u_texture",0);l.setUniform3fv("u_defaultColor",[0,0,0]);l.setUniform1f("u_defaultOpacity",0);l.setUniform1f("u_luminosityThreshold",
E);l.setUniform1f("u_smoothWidth",.01);l=[Math.round(r/2),Math.round(u/2)];w.setViewport(0,0,l[0],l[1]);w.setClearColor(0,0,0,0);w.clear(q.COLOR_BUFFER_BIT);d.draw();w.setBlendingEnabled(!1);q=this._intensityFBO.colorTexture;for(let F=0;F<this._nMips;F++){const C=z.getProgram(t.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[F]}]);w.useProgram(C);w.bindTexture(q,F+1);C.setUniform1i("u_colorTexture",F+1);C.setUniform2fv("u_texSize",l);C.setUniform2fv("u_direction",e);w.setViewport(0,0,l[0],
l[1]);const A=this._mipsFBOs[F];w.bindFramebuffer(A.horizontal);d.draw();q=A.horizontal.colorTexture;w.bindFramebuffer(A.vertical);w.bindTexture(q,F+1);C.setUniform2fv("u_direction",a);d.draw();q=A.vertical.colorTexture;l[0]=Math.round(l[0]/2);l[1]=Math.round(l[1]/2)}w.setViewport(0,0,r,u);l=z.getProgram(t.composite,[{name:"nummips",value:5}]);w.bindFramebuffer(this._compositeFBO);w.useProgram(l);l.setUniform1f("u_bloomStrength",B);l.setUniform1f("u_bloomRadius",y);l.setUniform1fv("u_bloomFactors",
b);l.setUniform3fv("u_bloomTintColors",c);w.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);l.setUniform1i("u_blurTexture1",1);w.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);l.setUniform1i("u_blurTexture2",2);w.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3);l.setUniform1i("u_blurTexture3",3);w.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);l.setUniform1i("u_blurTexture4",4);w.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);l.setUniform1i("u_blurTexture5",5);
d.draw();w.bindFramebuffer(k);w.setBlendingEnabled(!0);k=z.getProgram(t.blit);w.useProgram(k);w.bindTexture(this._compositeFBO.colorTexture,6);k.setUniform1i("u_texture",6);w.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE);d.draw();d.unbind();w.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);w.setStencilTestEnabled(!0)}_createOrResizeResources(d,k,l){({context:d}=d);if(!this._compositeFBO||this._size[0]!==k||this._size[1]!==l){this._size[0]=k;this._size[1]=l;var r=[Math.round(k/
2),Math.round(l/2)];this._compositeFBO?this._compositeFBO.resize(k,l):(k=new f.TextureDescriptor(k,l),k.internalFormat=n.PixelFormat.RGBA,k.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,this._compositeFBO=new p.FramebufferObject(d,k));this._intensityFBO?this._intensityFBO.resize(r[0],r[1]):(k=new f.TextureDescriptor(r[0],r[1]),k.internalFormat=n.PixelFormat.RGBA,k.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,this._intensityFBO=new p.FramebufferObject(d,k));for(k=0;k<this._nMips;k++)this._mipsFBOs[k]?(this._mipsFBOs[k].horizontal.resize(r[0],
r[1]),this._mipsFBOs[k].vertical.resize(r[0],r[1])):(l=new f.TextureDescriptor(r[0],r[1]),l.internalFormat=n.PixelFormat.RGBA,l.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,this._mipsFBOs[k]={horizontal:new p.FramebufferObject(d,l),vertical:new p.FramebufferObject(d,l)}),r[0]=Math.round(r[0]/2),r[1]=Math.round(r[1]/2)}}}h.Bloom=m;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define(["exports","../../VertexStream","../../../../../webgl/enums",
"../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(h,g,v,n,p){const f=[1,0],e=[0,1];class a{constructor(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(b,c,m){const {context:d}=b,{type:k,radius:l}=m;0!==l&&(this._createOrResizeResources(b),this._quad||(this._quad=new g(d,[-1,-1,1,-1,-1,1,1,1])),m=this._quad,m.bind(),"blur"===k?this._gaussianBlur(b,c,l):this._radialBlur(b,c),m.unbind())}_gaussianBlur(b,c,m){const {context:d,state:k,painter:l,pixelRatio:r}=b;var {size:u}=k,{materialManager:w}=l;b=this._quad;u=[Math.round(r*u[0]),Math.round(r*
u[1])];const x=this._blurFBO;w=w.getProgram(this._programDesc.gaussianBlur,[{name:"radius",value:Math.ceil(m)}]);d.useProgram(w);d.setBlendingEnabled(!1);d.bindFramebuffer(x);d.bindTexture(c.colorTexture,4);w.setUniform1i("u_colorTexture",4);w.setUniform2fv("u_texSize",u);w.setUniform2fv("u_direction",f);w.setUniform1f("u_sigma",m);b.draw();d.bindFramebuffer(c);d.setStencilWriteMask(0);d.setStencilTestEnabled(!1);d.setDepthWriteEnabled(!1);d.setDepthTestEnabled(!1);d.bindTexture(x?.colorTexture,5);
w.setUniform1i("u_colorTexture",5);w.setUniform2fv("u_direction",e);b.draw();d.setBlendingEnabled(!0);d.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);d.setStencilTestEnabled(!0)}_radialBlur(b,c){const {context:m,painter:d}=b,{materialManager:k}=d,l=this._programDesc;b=this._quad;const r=this._blurFBO;m.bindFramebuffer(r);const u=k.getProgram(l.radialBlur);m.useProgram(u);m.setBlendingEnabled(!1);m.bindTexture(c.colorTexture,4);u.setUniform1i("u_colorTexture",4);b.draw();m.bindFramebuffer(c);
m.setStencilWriteMask(0);m.setStencilTestEnabled(!1);m.setDepthWriteEnabled(!1);m.setDepthTestEnabled(!1);m.setBlendingEnabled(!0);c=k.getProgram(l.blit);m.useProgram(c);m.bindTexture(r?.colorTexture,5);c.setUniform1i("u_texture",5);m.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);b.draw()}_createOrResizeResources(b){const {context:c,state:m,pixelRatio:d}=b;var {size:k}=m;b=Math.round(d*k[0]);k=Math.round(d*k[1]);this._blurFBO&&this._size[0]===b&&this._size[1]===k||(this._size[0]=
b,this._size[1]=k,this._blurFBO?this._blurFBO.resize(b,k):(b=new p.TextureDescriptor(b,k),b.internalFormat=v.PixelFormat.RGBA,b.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE,this._blurFBO=new n.FramebufferObject(c,b)))}}h.Blur=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f){class e{constructor(){this._layerFBOTexture=null;this._size=[0,0];this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture)}draw(a,b,c){const {width:m,height:d}=b;this._createOrResizeResources(a,m,d);const {context:k,painter:l}=a,{materialManager:r}=l,u=this._programDesc;a=this._quad;c=c.colorMatrix;a.bind();const w=this._layerFBOTexture;k.bindFramebuffer(b);
b.copyToTexture(0,0,m,d,0,0,w);k.setBlendingEnabled(!1);k.setStencilTestEnabled(!1);b=r.getProgram(u);k.useProgram(b);k.bindTexture(w,2);b.setUniformMatrix4fv("u_coefficients",c);b.setUniform1i("u_colorTexture",2);a.draw();k.setBlendingEnabled(!0);k.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);k.setStencilTestEnabled(!0);a.unbind()}_createOrResizeResources(a,b,c){({context:a}=a);if(!this._layerFBOTexture||this._size[0]!==b||this._size[1]!==c){this._size[0]=b;this._size[1]=
c;if(this._layerFBOTexture)this._layerFBOTexture.resize(b,c);else{const m=new f.TextureDescriptor;m.internalFormat=n.PixelFormat.RGBA;m.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;m.width=b;m.height=c;this._layerFBOTexture=new p.Texture(a,m)}this._quad||(this._quad=new v(a,[-1,-1,1,-1,-1,1,1,1]))}}}h.Colorize=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define("exports ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f,e,a){const b=[1,0],c=[0,1];class m{constructor(){this._verticalBlurFBO=this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture);this._horizontalBlurFBO=g.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=g.disposeMaybe(this._verticalBlurFBO)}draw(d,k,l){const {context:r,state:u,painter:w}=d,{materialManager:x}=w,z=this._programDesc,q=k.width,t=k.height,B=[Math.round(q),Math.round(t)],{blurRadius:y,offsetX:E,offsetY:F,color:C}=l;l=[v.pt2px(E),v.pt2px(F)];this._createOrResizeResources(d,q,t,B);const A=this._horizontalBlurFBO;
d=this._verticalBlurFBO;r.setStencilWriteMask(0);r.setStencilTestEnabled(!1);r.setDepthWriteEnabled(!1);r.setDepthTestEnabled(!1);const D=this._layerFBOTexture;k.copyToTexture(0,0,q,t,0,0,D);this._quad||(this._quad=new n(r,[-1,-1,1,-1,-1,1,1,1]));r.setViewport(0,0,B[0],B[1]);const G=this._quad;G.bind();r.setBlendingEnabled(!1);const J=x.getProgram(z.blur,[{name:"radius",value:Math.ceil(y)}]);r.useProgram(J);r.bindFramebuffer(A);r.bindTexture(k.colorTexture,4);J.setUniform1i("u_colorTexture",4);J.setUniform2fv("u_texSize",
B);J.setUniform2fv("u_direction",b);J.setUniform1f("u_sigma",y);G.draw();r.bindFramebuffer(d);r.bindTexture(A?.colorTexture,5);J.setUniform1i("u_colorTexture",5);J.setUniform2fv("u_direction",c);G.draw();r.bindFramebuffer(k);r.setViewport(0,0,q,t);k=x.getProgram(z.composite);r.useProgram(k);r.bindTexture(d?.colorTexture,2);k.setUniform1i("u_blurTexture",2);r.bindTexture(D,3);k.setUniform1i("u_layerFBOTexture",3);k.setUniform4fv("u_shadowColor",[C[0]/255*C[3],C[1]/255*C[3],C[2]/255*C[3],C[3]]);k.setUniformMatrix3fv("u_displayViewMat3",
u.displayMat3);k.setUniform2fv("u_shadowOffset",l);G.draw();r.setBlendingEnabled(!0);r.setStencilTestEnabled(!0);r.setBlendFunction(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);G.unbind()}_createOrResizeResources(d,k,l,r){({context:d}=d);if(!this._horizontalBlurFBO||this._size[0]!==k||this._size[1]!==l){this._size[0]=k;this._size[1]=l;if(this._horizontalBlurFBO)this._horizontalBlurFBO.resize(r[0],r[1]);else{const u=new a.TextureDescriptor(r[0],r[1]);u.internalFormat=p.PixelFormat.RGBA;u.wrapMode=
p.TextureWrapMode.CLAMP_TO_EDGE;this._horizontalBlurFBO=new f.FramebufferObject(d,u)}this._verticalBlurFBO?this._verticalBlurFBO.resize(r[0],r[1]):(r=new a.TextureDescriptor(r[0],r[1]),r.internalFormat=p.PixelFormat.RGBA,r.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,this._verticalBlurFBO=new f.FramebufferObject(d,r));this._layerFBOTexture?this._layerFBOTexture.resize(k,l):(r=new a.TextureDescriptor,r.internalFormat=p.PixelFormat.RGBA,r.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,r.width=k,r.height=l,this._layerFBOTexture=
new e.Texture(d,r))}}}h.DropShadow=m;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define(["exports","../../../../../../core/maybe","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(h,g,v,n,p){class f{constructor(){this._size=[0,0];this._layerFBOTexture=null}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture)}draw(e,a,b){const {width:c,
height:m}=a;this._createOrResizeResources(e,c,m);const {context:d,painter:k}=e;({amount:e}=b);b=d.gl;const l=this._layerFBOTexture;d.bindFramebuffer(a);a.copyToTexture(0,0,c,m,0,0,l);d.setBlendingEnabled(!0);d.setStencilTestEnabled(!1);d.setDepthTestEnabled(!1);d.setClearColor(0,0,0,0);d.clear(b.COLOR_BUFFER_BIT);k.blitTexture(d,l,v.TextureSamplingMode.NEAREST,e)}_createOrResizeResources(e,a,b){({context:e}=e);if(!this._layerFBOTexture||this._size[0]!==a||this._size[1]!==b)if(this._size[0]=a,this._size[1]=
b,this._layerFBOTexture)this._layerFBOTexture.resize(a,b);else{const c=new p.TextureDescriptor;c.internalFormat=v.PixelFormat.RGBA;c.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;c.samplingMode=v.TextureSamplingMode.NEAREST;c.width=a;c.height=b;this._layerFBOTexture=new n.Texture(e,c)}}}h.Opacity=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../core/arrayUtils","../enums","../../../../webgl/enums"],function(h,
g,v){class n{constructor(p,f){this.brushes=p;this.name=f.name;this.drawPhase=f.drawPhase||g.WGLDrawPhase.MAP;this._targetFn=f.target;this.effects=f.effects||[];this.enableDefaultDraw=f.enableDefaultDraw??(()=>!0);this.forceDrawByDisplayOrder=!!f.forceDrawByDisplayOrder}render(p){const {context:f,profiler:e}=p,a=this._targetFn();var b=this.drawPhase&p.drawPhase;e.recordPassStart(this.name);if(b){this.enableDefaultDraw()&&this._doRender(p,a);e.recordPassEnd();for(const c of this.effects){if(!c.enable())continue;
b=c.apply;const m=c.args?.(),d=f.getViewport(),k=f.getBoundFramebufferObject(),l=p.passOptions;this._bindEffect(p,b,m);this._doRender(p,a,b.defines);this._drawAndUnbindEffect(p,b,d,k,l,m)}}}_doRender(p,f,e){if(null!=f){var {profiler:a,context:b}=p;if(this.forceDrawByDisplayOrder){for(var c of this.brushes){a.recordBrushStart(c.name);if(null!=c.brushEffect){var m=b.getViewport(),d=b.getBoundFramebufferObject(),k=p.passOptions;this._bindEffect(p,c.brushEffect);this._drawWithBrush(c,p,f,e);this._drawAndUnbindEffect(p,
c.brushEffect,m,d,k)}else this._drawWithBrush(c,p,f,e);a.recordBrushEnd()}p.attributeView.bindTextures(p.context);for(const u of f)if(u.visible)if(u.commit(p),p.context.setStencilFunction(v.CompareFunction.EQUAL,u.stencilRef,255),m=u.getGeometry(g.WGLGeometryType.MARKER),f=u.getGeometry(g.WGLGeometryType.TEXT),m?.records&&f?.records){c=new Map;for(d=m.records.getCursor();d.next();)c.set(d.id,[d.getDrawInfo(m,g.WGLGeometryType.MARKER)]);for(m=f.records.getCursor();m.next();)d=c.get(m.id),k=m.getDrawInfo(f,
g.WGLGeometryType.TEXT),d?d.push(k):c.set(m.id,[k]);f=Array.from(c.entries()).sort(([w],[x])=>x-w);for(var [,l]of f)for(var r of l)f=p.painter.getBrush(r.geometryType,g.WGLSymbologyType.DEFAULT),f.prepareState(p,e),f.drawGeometry(p,u,r,e)}else if(m){const w=p.painter.getBrush(g.WGLGeometryType.MARKER,g.WGLSymbologyType.DEFAULT);w.prepareState(p,e);m.forEachCommand(x=>{w.drawGeometry(p,u,x,e)})}else if(f){const w=p.painter.getBrush(g.WGLGeometryType.TEXT,g.WGLSymbologyType.DEFAULT);w.prepareState(p,
e);f.forEachCommand(x=>{w.drawGeometry(p,u,x,e)})}}else for(m of this.brushes)a.recordBrushStart(m.name),null!=m.brushEffect?(l=b.getViewport(),r=b.getBoundFramebufferObject(),c=p.passOptions,this._bindEffect(p,m.brushEffect),this._drawWithBrush(m,p,f,e),this._drawAndUnbindEffect(p,m.brushEffect,l,r,c)):this._drawWithBrush(m,p,f,e),a.recordBrushEnd()}}_drawWithBrush(p,f,e,a){h.isArrayLike(e)?(p.prepareState(f,a),p.drawMany(f,e,a)):e.visible&&(p.prepareState(f,a),p.draw(f,e,a))}_bindEffect(p,f,e){const {profiler:a}=
p;a.recordPassStart(this.name+"."+f.name);f.bind(p,e);f=f.createOptions(p,e);p.passOptions=f}_drawAndUnbindEffect(p,f,e,a,b,c){const {profiler:m,context:d}=p;p.passOptions=b;m.recordBrushStart(f.name);f.draw(p,c);f.unbind(p,c);d.bindFramebuffer(a);const {x:k,y:l,width:r,height:u}=e;d.setViewport(k,l,r,u);m.recordBrushEnd();m.recordPassEnd()}}return n})},"esri/views/2d/engine/webgl/Profiler":function(){define(["exports","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has",
"../../../webgl/capabilities/DisjointTimerQuery"],function(h,g,v,n,p){const f=n("esri-2d-profiler");class e{constructor(a,b){this._events=new v;this._entries=new Map;this._timings=new g(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(f){this._ext=p.createDisjointTimerQuery(a.gl,{});this._debugOutput=b;var c=a.gl;if(this.enableCommandLogging)for(var m in c)if("function"===typeof c[m]){const d=c[m],k=m.includes("draw");c[m]=(...l)=>{this._events.emit("command",
{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:m,args:l,isDrawCommand:k});this._currentSummary&&(this._currentSummary.commands++,k&&this._currentSummary.drawCommands++);return d.apply(c,l)}}}}get enableCommandLogging(){return!("object"===typeof f&&f.disableCommands)}recordContainerStart(a){f&&(this._currentContainer=a)}recordContainerEnd(){f&&(this._currentContainer=null)}recordPassStart(a){f&&(this._currentPass=a,this._initSummary())}recordPassEnd(){f&&(this._currentPass=
null,this._emitSummary())}recordBrushStart(a){f&&(this._currentBrush=a)}recordBrushEnd(){f&&(this._currentBrush=null)}recordStart(a){if(f&&null!=this._ext){if(this._entries.has(a)){const k=this._entries.get(a);var b=this._ext.resultAvailable(k.query),c=this._ext.disjoint();if(b&&!c){b=this._ext.getResult(k.query)/1E6;c=0;if(null!=this._timings.enqueue(b)){c=this._timings.entries;const l=c.length;let r=0;for(var m of c)r+=m;c=r/l}m=b.toFixed(2);b=c?c.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${a}, ${m} ms (${b} last 10 avg)\n${k.commandsLen} Commands (${k.drawCommands} draw)`),
console.log("RenderPass breakdown: "),console.table(k.summaries),console.log("Commands: ",k.commands),console.groupEnd()):console.log(`Frame report for ${a}, ${m} ms (${b} last 10 avg)`);this._debugOutput.innerHTML=`${m} (${b})`}for(const l of k.handles)l.remove();this._ext.deleteQuery(k.query);this._entries.delete(a)}const d={name:a,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(d.handles.push(this._events.on("command",
k=>{d.commandsLen++;d.commands.push(k);k.isDrawCommand&&d.drawCommands++})),d.handles.push(this._events.on("summary",k=>{d.summaries.push(k)})));this._ext.beginTimeElapsed(d.query);this._entries.set(a,d)}}recordEnd(a){f&&null!=this._ext&&this._entries.has(a)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",
this._currentSummary)}}h.Profiler=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class h{constructor(g){this._start=this.size=0;this.maxSize=g;this._buffer=Array(g)}get entries(){return this._buffer}enqueue(g){if(this.size===this.maxSize){const v=this._buffer[this._start];this._buffer[this._start]=g;this._start=(this._start+1)%this.maxSize;return v}this._buffer[(this._start+this.size++)%this.maxSize]=g;return null}dequeue(){if(0===
this.size)return null;const g=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return g}peek(){return 0===this.size?null:this._buffer[this._start]}find(g){if(0===this.size)return null;for(const v of this._buffer)if(null!=v&&g(v))return v;return null}clear(g){let v=this.dequeue();for(;null!=v;)g&&g(v),v=this.dequeue()}}return h})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(h,
g){class v{constructor(n,p,f,e,a,b,c,m,d){this.createQuery=n;this.deleteQuery=p;this.resultAvailable=f;this.getResult=e;this.disjoint=a;this.beginTimeElapsed=b;this.endTimeElapsed=c;this.createTimestamp=m;this.timestampBits=d}}h.hasRunningElapsedTimer=!1;h.DisjointTimerQuery=v;h.createDisjointTimerQuery=function(n,p){if(p.disjointTimerQuery)return null;let f=n.getExtension("EXT_disjoint_timer_query_webgl2");return f&&g(n)?new v(()=>n.createQuery(),e=>{n.deleteQuery(e);h.hasRunningElapsedTimer=!1},
e=>n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE),e=>n.getQueryParameter(e,n.QUERY_RESULT),()=>n.getParameter(f.GPU_DISJOINT_EXT),e=>{h.hasRunningElapsedTimer||(h.hasRunningElapsedTimer=!0,n.beginQuery(f.TIME_ELAPSED_EXT,e))},()=>{n.endQuery(f.TIME_ELAPSED_EXT);h.hasRunningElapsedTimer=!1},e=>f.queryCounterEXT(e,f.TIMESTAMP_EXT),()=>n.getQuery(f.TIMESTAMP_EXT,f.QUERY_COUNTER_BITS_EXT)):(f=n.getExtension("EXT_disjoint_timer_query"))?new v(()=>f.createQueryEXT(),e=>{f.deleteQueryEXT(e);h.hasRunningElapsedTimer=
!1},e=>f.getQueryObjectEXT(e,f.QUERY_RESULT_AVAILABLE_EXT),e=>f.getQueryObjectEXT(e,f.QUERY_RESULT_EXT),()=>n.getParameter(f.GPU_DISJOINT_EXT),e=>{h.hasRunningElapsedTimer||(h.hasRunningElapsedTimer=!0,f.beginQueryEXT(f.TIME_ELAPSED_EXT,e))},()=>{f.endQueryEXT(f.TIME_ELAPSED_EXT);h.hasRunningElapsedTimer=!1},e=>f.queryCounterEXT(e,f.TIMESTAMP_EXT),()=>f.getQueryEXT(f.TIMESTAMP_EXT,f.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./contextUtils ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w){function x(q,t,B,y){t?y!==t&&q.bindBuffer(B,t.glName):q.bindBuffer(B,null);return t}function z(q,t){switch(q){case a.PrimitiveType.POINTS:return 2*t;case a.PrimitiveType.TRIANGLES:return t/3;case a.PrimitiveType.TRIANGLE_STRIP:return t-2;case a.PrimitiveType.TRIANGLE_FAN:return t-2;default:return 0}}h.RenderingContext=class{constructor(q,t){this.gl=q;this.instanceCounter=new b.InstanceCounter;this.programCache=new m.ProgramCache(this);this._state=new f.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=w(q)?e.ContextType.WEBGL2:e.ContextType.WEBGL1;this._loadExtensions();this.configure(t)}get gl2(){return this.type===e.ContextType.WEBGL1?null:this.gl}configure(q){this._capabilities=new u.Capabilities(this.gl,q);this._parameters=new c.Parameters(this.gl,this._capabilities,q);k.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;q=this.gl.getParameter(this.gl.VIEWPORT);this._state=new f.ContextState;this._state.viewport={x:q[0],
y:q[1],width:q[2],height:q[3]};this._stateTracker=new d.StateTracker({setBlending:t=>{t?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(t.opRgb,t.opAlpha),this.setBlendFunctionSeparate(t.srcRgb,t.dstRgb,t.srcAlpha,t.dstAlpha),t=t.color,this.setBlendColor(t.r,t.g,t.b,t.a)):this.setBlendingEnabled(!1)},setCulling:t=>{t?(this.setFaceCullingEnabled(!0),this.setCullFace(t.face),this.setFrontFace(t.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:t=>{t?(this.setPolygonOffsetFillEnabled(!0),
this.setPolygonOffset(t.factor,t.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:t=>{t?(this.setDepthTestEnabled(!0),this.setDepthFunction(t.func)):this.setDepthTestEnabled(!1)},setStencilTest:t=>{if(t){this.setStencilTestEnabled(!0);const B=t.function;this.setStencilFunction(B.func,B.ref,B.mask);t=t.operation;this.setStencilOp(t.fail,t.zFail,t.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:t=>{t?(this.setDepthWriteEnabled(!0),this.setDepthRange(t.zNear,t.zFar)):this.setDepthWriteEnabled(!1)},
setColorWrite:t=>{t?this.setColorMask(t.r,t.g,t.b,t.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:t=>{t?this.setStencilWriteMask(t.mask):this.setStencilWriteMask(0)},setDrawBuffers:t=>{const {drawBuffers:B}=this._capabilities;t?B?.drawBuffers(t.buffers):({drawFramebuffer:t}=this._state,null===t||0===t.colorAttachments.length?B?.drawBuffers([a.SpecialDrawBuffers.BACK]):B?.drawBuffers([a.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();g.disposeMaybe(this._driverTest);this._driverTest=
new r.WebGLDriverTest(this)}dispose(){g.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(a.BufferType.ARRAY_BUFFER);this.unbindBuffer(a.BufferType.ELEMENT_ARRAY_BUFFER);this.type===e.ContextType.WEBGL2&&(this.unbindBuffer(a.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(a.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(a.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(a.BufferType.COPY_READ_BUFFER),this.unbindBuffer(a.BufferType.COPY_WRITE_BUFFER));
this._state.textureUnitMap.length=0;p.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(q){this._stateTracker.setPipeline(q)}setBlendingEnabled(q){this._state.blend!==q&&(!0===q?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=q,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();
this._state.program=null}externalTextureUnitUpdate(q,t){for(let B=0;B<q.length;++B)this._state.textureUnitMap[q[B]]=null;0<=t&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const q=this.capabilities.vao;q&&(q.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(q,t,B,y){if(q!==this._state.blendColor.r||
t!==this._state.blendColor.g||B!==this._state.blendColor.b||y!==this._state.blendColor.a)this.gl.blendColor(q,t,B,y),this._state.blendColor.r=q,this._state.blendColor.g=t,this._state.blendColor.b=B,this._state.blendColor.a=y,this._stateTracker.invalidateBlending()}setBlendFunction(q,t){if(q!==this._state.blendFunction.srcRGB||t!==this._state.blendFunction.dstRGB)this.gl.blendFunc(q,t),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=q,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=
t,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(q,t,B,y){if(this._state.blendFunction.srcRGB!==q||this._state.blendFunction.srcAlpha!==B||this._state.blendFunction.dstRGB!==t||this._state.blendFunction.dstAlpha!==y)this.gl.blendFuncSeparate(q,t,B,y),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=B,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendEquation(q){this._state.blendEquation.mode!==
q&&(this.gl.blendEquation(q),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=q,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(q,t){if(this._state.blendEquation.mode!==q||this._state.blendEquation.modeAlpha!==t)this.gl.blendEquationSeparate(q,t),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending()}setColorMask(q,t,B,y){if(this._state.colorMask.r!==q||this._state.colorMask.g!==t||this._state.colorMask.b!==
B||this._state.colorMask.a!==y)this.gl.colorMask(q,t,B,y),this._state.colorMask.r=q,this._state.colorMask.g=t,this._state.colorMask.b=B,this._state.colorMask.a=y,this._stateTracker.invalidateColorWrite()}setClearColor(q,t,B,y){if(this._state.clearColor.r!==q||this._state.clearColor.g!==t||this._state.clearColor.b!==B||this._state.clearColor.a!==y)this.gl.clearColor(q,t,B,y),this._state.clearColor.r=q,this._state.clearColor.g=t,this._state.clearColor.b=B,this._state.clearColor.a=y}setFaceCullingEnabled(q){this._state.faceCulling!==
q&&(!0===q?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=q,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(q){this._state.polygonOffsetFill!==q&&(!0===q?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=q,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(q,t){if(this._state.polygonOffset[0]!==q||this._state.polygonOffset[1]!==t)this._state.polygonOffset[0]=
q,this._state.polygonOffset[1]=t,this.gl.polygonOffset(q,t),this._stateTracker.invalidatePolygonOffset()}setCullFace(q){this._state.cullFace!==q&&(this.gl.cullFace(q),this._state.cullFace=q,this._stateTracker.invalidateCulling())}setFrontFace(q){this._state.frontFace!==q&&(this.gl.frontFace(q),this._state.frontFace=q,this._stateTracker.invalidateCulling())}setScissorTestEnabled(q){this._state.scissorTest!==q&&(!0===q?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=
q)}setScissorRect(q,t,B,y){if(this._state.scissorRect.x!==q||this._state.scissorRect.y!==t||this._state.scissorRect.width!==B||this._state.scissorRect.height!==y)this.gl.scissor(q,t,B,y),this._state.scissorRect.x=q,this._state.scissorRect.y=t,this._state.scissorRect.width=B,this._state.scissorRect.height=y}setDepthTestEnabled(q){this._state.depthTest!==q&&(!0===q?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=q,this._stateTracker.invalidateDepthTest())}setClearDepth(q){this._state.clearDepth!==
q&&(this.gl.clearDepth(q),this._state.clearDepth=q)}setDepthFunction(q){this._state.depthFunction!==q&&(this.gl.depthFunc(q),this._state.depthFunction=q,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(q){this._state.depthWrite!==q&&(this.gl.depthMask(q),this._state.depthWrite=q,this._stateTracker.invalidateDepthWrite())}setDepthRange(q,t){if(this._state.depthRange.zNear!==q||this._state.depthRange.zFar!==t)this.gl.depthRange(q,t),this._state.depthRange.zNear=q,this._state.depthRange.zFar=
t,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(q){this._state.stencilTest!==q&&(!0===q?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=q,this._stateTracker.invalidateStencilTest())}setClearStencil(q){q!==this._state.clearStencil&&(this.gl.clearStencil(q),this._state.clearStencil=q)}setStencilFunction(q,t,B){if(this._state.stencilFunction.func!==q||this._state.stencilFunction.ref!==t||this._state.stencilFunction.mask!==B)this.gl.stencilFunc(q,
t,B),this._state.stencilFunction.face=a.Face.FRONT_AND_BACK,this._state.stencilFunction.func=q,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=B,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(q,t,B,y){if(this._state.stencilFunction.face!==q||this._state.stencilFunction.func!==t||this._state.stencilFunction.ref!==B||this._state.stencilFunction.mask!==y)this.gl.stencilFuncSeparate(q,t,B,y),this._state.stencilFunction.face=q,this._state.stencilFunction.func=
t,this._state.stencilFunction.ref=B,this._state.stencilFunction.mask=y,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(q){this._state.stencilWriteMask!==q&&(this.gl.stencilMask(q),this._state.stencilWriteMask=q,this._stateTracker.invalidateStencilWrite())}setStencilOp(q,t,B){if(this._state.stencilOperation.face!==a.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==q||this._state.stencilOperation.zFail!==t||this._state.stencilOperation.zPass!==B)this.gl.stencilOp(q,t,B),this._state.stencilOperation.face=
a.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=q,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=B,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(q,t,B,y){if(this._state.stencilOperation.face!==q||this._state.stencilOperation.fail!==t||this._state.stencilOperation.zFail!==B||this._state.stencilOperation.zPass!==y)this.gl.stencilOpSeparate(q,t,B,y),this._state.stencilOperation.face=q,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=
B,this._state.stencilOperation.zPass=y,this._stateTracker.invalidateStencilTest()}setActiveTexture(q,t=!1){const B=this._state.activeTexture;0<=q&&(t||q!==this._state.activeTexture)&&(this.gl.activeTexture(a.baseTextureUnit+q),this._state.activeTexture=q);return B}clear(q){q&&this.gl.clear(q)}clearSafe(q,t=255){q&&(q&a.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),q&a.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),q&a.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),
this.gl.clear(q))}drawArrays(q,t,B){p.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=z(q,B));this.gl.drawArrays(q,t,B);p.checkWebGLError(this.gl)}drawArraysInstanced(q,t,B,y){this.gl2?.drawArraysInstanced(q,t,B,y);p.checkWebGLError(this.gl)}drawElements(q,t,B,y){p.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=z(q,t));this.gl.drawElements(q,t,B,y);if(p.webglDebugEnabled()){const E=l.getErrorString(this);if(E){const F=this.getBoundVAO(),C=F?.indexBuffer,A=C?.size??
0,D=y+t;console.error(`drawElements: ${E}${A<D?`. Buffer is too small. Attempted to draw index ${D} of ${A}`:""}`,{args:{mode:q,count:t,type:B,offset:y},vao:{indexBuffer:C,vertexBuffers:F?.vertexBuffers}})}}}logInfo(){p.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){p.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(q,t,B,y){B=Math.max(Math.round(B),1);
y=Math.max(Math.round(y),1);const E=this._state.viewport;if(E.x!==q||E.y!==t||E.width!==B||E.height!==y)E.x=q,E.y=t,E.width=B,E.height=y,this.gl.viewport(q,t,B,y)}setViewport4fv(q){this.setViewport(q[0],q[1],q[2],q[3])}getViewport(){const q=this._state.viewport;return{x:q.x,y:q.y,width:q.width,height:q.height}}useProgram(q){this._state.program!==q&&(this._state.program?.stop(),this._state.program=q,this.gl.useProgram(q?.glName??null))}bindTexture(q,t,B=!1){(t>=this.parameters.maxTextureImageUnits||
0>t)&&console.error("Input texture unit is out of range of available units!");const y=this._state.textureUnitMap[t];if(null==q?.glName)return null!=y&&(this.setActiveTexture(t,B),this.gl.bindTexture(y.descriptor.target,null)),this._state.textureUnitMap[t]=null,y;if(!B&&y===q)return q.isDirty&&(this.setActiveTexture(t,B),q.applyChanges()),y;this.setActiveTexture(t,B);this.gl.bindTexture(q.descriptor.target,q.glName);q.applyChanges();this._state.textureUnitMap[t]=q;return y}unbindTexture(q){if(null!=
q)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===q&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(q,t=!1){if(t||this._state.readFramebuffer!==q||this._state.drawFramebuffer!==q)this._stateTracker.invalidateDrawBuffers(),null==q?(this.gl.bindFramebuffer(a.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(q.initializeAndBind(a.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=
q,this._state.drawFramebuffer=q)}bindFramebufferSeparate(q,t,B=!1){const y=t===a.FramebufferTarget.READ_FRAMEBUFFER,E=y?this._state.readFramebuffer:this._state.drawFramebuffer;if(B||E!==q)null==q?this.gl.bindFramebuffer(t,null):q.initializeAndBind(t),y?this._state.readFramebuffer=q??null:this._state.drawFramebuffer=q??null}blitFramebuffer(q,t,B=0,y=0,E=q.width,F=q.height,C=0,A=0,D=t.width,G=t.height,J=a.ClearBufferBit.COLOR_BUFFER_BIT,M=a.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(q,
a.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(t,a.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(B,y,E,F,C,A,D,G,J,M)}bindBuffer(q,t){if(q)switch(t??(t=q.bufferType),t){case a.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=x(this.gl,q,t,this._state.vertexBuffer);break;case a.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=x(this.gl,q,t,this._state.indexBuffer);break;case a.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=x(this.gl,q,t,this._state.uniformBuffer);
break;case a.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=x(this.gl,q,t,this._state.pixelPackBuffer);break;case a.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=x(this.gl,q,t,this._state.pixelUnpackBuffer);break;case a.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=x(this.gl,q,t,this._state.copyReadBuffer);break;case a.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=x(this.gl,q,t,this._state.copyWriteBuffer)}}bindRenderbuffer(q){const t=this.gl;q||(t.bindRenderbuffer(t.RENDERBUFFER,
null),this._state.renderbuffer=null);this._state.renderbuffer!==q&&(t.bindRenderbuffer(t.RENDERBUFFER,q.glName),this._state.renderbuffer=q)}_getBufferBinding(q,t){if(t>=this.parameters.maxUniformBufferBindings||0>t)return console.error("Uniform buffer binding point is out of range!"),null;q=this._state.uniformBufferBindingPoints;let B=q[t];null==B&&(B={buffer:null,offset:0,size:0},q[t]=B);return B}bindBufferBase(q,t,B){const y=this._getBufferBinding(q,t);null==y||y.buffer===B&&0===y.offset&&0===y.size||
(this.gl.bindBufferBase(q,t,B?B.glName:null),y.buffer=B,y.offset=0,y.size=0)}bindBufferRange(q,t,B,y,E){const F=this._getBufferBinding(q,t);null==F||F.buffer===B&&F.offset===y&&F.size===E||(0!==y%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(q,t,B.glName,y,E),F.buffer=B,F.offset=y,F.size=E))}bindUBO(q,t,B,y){null==t?this.bindBufferBase(a.BufferType.UNIFORM_BUFFER,q,null):(p.webglDebugEnabled()&&
(y??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==B&&void 0!==y?this.bindBufferRange(a.BufferType.UNIFORM_BUFFER,q,t.buffer,B,y):this.bindBufferBase(a.BufferType.UNIFORM_BUFFER,q,t.buffer))}unbindUBO(q){for(let t=0,B=this._state.uniformBufferBindingPoints.length;t<B;t++){const y=this._state.uniformBufferBindingPoints[t];null!=y&&y.buffer===q.buffer&&this.bindBufferBase(a.BufferType.UNIFORM_BUFFER,
t,null)}}unbindBuffer(q){switch(q){case a.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=x(this.gl,null,q,this._state.vertexBuffer);break;case a.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=x(this.gl,null,q,this._state.indexBuffer);break;case a.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=x(this.gl,null,q,this._state.uniformBuffer);break;case a.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=x(this.gl,null,q,this._state.pixelPackBuffer);break;case a.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=
x(this.gl,null,q,this._state.pixelUnpackBuffer);break;case a.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=x(this.gl,null,q,this._state.copyReadBuffer);break;case a.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=x(this.gl,null,q,this._state.copyWriteBuffer)}}bindVAO(q=null){null==q?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==q&&(q.bind(),this._state.vertexArrayObject=q)}async clientWaitAsync(q=
n.Milliseconds(10)){const t=this.gl,B=t.fenceSync(a.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!B)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(a.ResourceType.Sync,B);t.flush();let y;do await v.after(q),y=t.clientWaitSync(B,0,0);while(y===a.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(a.ResourceType.Sync,B);t.deleteSync(B);if(y===a.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(q=
a.FramebufferTarget.FRAMEBUFFER){return q===a.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(a.BufferType.ARRAY_BUFFER);this.unbindBuffer(a.BufferType.ELEMENT_ARRAY_BUFFER);this.type===e.ContextType.WEBGL2&&(this.unbindBuffer(a.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(a.BufferType.PIXEL_PACK_BUFFER),
this.unbindBuffer(a.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(a.BufferType.COPY_READ_BUFFER),this.unbindBuffer(a.BufferType.COPY_WRITE_BUFFER));for(let q=0;q<this.parameters.maxTextureImageUnits;++q)this.bindTexture(null,q);this.setBlendingEnabled(!1);this.setBlendFunction(a.BlendFactor.ONE,a.BlendFactor.ZERO);this.setBlendEquation(a.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(a.Face.BACK);this.setFrontFace(a.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(a.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(a.CompareFunction.ALWAYS,0,0);this.setStencilOp(a.StencilOperation.KEEP,a.StencilOperation.KEEP,a.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,
!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var q=this.capabilities.vao;q&&q.bindVertexArray(null);const {gl:t,gl2:B}=this;for(var y=0;y<this.parameters.maxVertexAttributes;y++)t.disableVertexAttribArray(y);this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(a.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,
this._state.indexBuffer.glName):t.bindBuffer(a.BufferType.ELEMENT_ARRAY_BUFFER,null);if(null!=B){this._state.uniformBuffer?B.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):B.bindBuffer(a.BufferType.UNIFORM_BUFFER,null);for(y=0;y<this._parameters.maxUniformBufferBindings;y++){const E=this._state.uniformBufferBindingPoints[y];if(null!=E){const {buffer:F,offset:C,size:A}=E;null!==F?0===C&&0===A?B.bindBufferBase(a.BufferType.UNIFORM_BUFFER,y,F.glName):B.bindBufferRange(a.BufferType.UNIFORM_BUFFER,
y,F.glName,C,A):B.bindBufferBase(a.BufferType.UNIFORM_BUFFER,y,null)}}this._state.pixelPackBuffer?B.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):B.bindBuffer(a.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?B.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):B.bindBuffer(a.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?B.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):
B.bindBuffer(a.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?B.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):B.bindBuffer(a.BufferType.COPY_WRITE_BUFFER,null);B.bindFramebuffer(a.FramebufferTarget.READ_FRAMEBUFFER,null);B.readBuffer(B.BACK);this._state.readFramebuffer&&(B.bindFramebuffer(a.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),B.readBuffer(a.ColorAttachment.COLOR_ATTACHMENT0));B.bindFramebuffer(a.FramebufferTarget.DRAW_FRAMEBUFFER,
this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(a.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(q&&this._state.vertexArrayObject){if(q=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(q)}t.useProgram(this._state.program?.glName??null);t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);
t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND);t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,
this._state.clearColor.a);t.clearDepth(this._state.clearDepth);t.clearStencil(this._state.clearStencil);t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);t.cullFace(this._state.cullFace);t.depthFunc(this._state.depthFunction);t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);t.depthMask(this._state.depthWrite);t.frontFace(this._state.frontFace);
t.lineWidth(1);!0===this._state.faceCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL);t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST);t.stencilFunc(this._state.stencilFunction.func,
this._state.stencilFunction.ref,this._state.stencilFunction.mask);t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST);t.stencilMask(this._state.stencilWriteMask);for(q=0;q<this.parameters.maxTextureImageUnits;q++)t.activeTexture(a.baseTextureUnit+q),t.bindTexture(a.TextureType.TEXTURE_2D,null),t.bindTexture(a.TextureType.TEXTURE_CUBE_MAP,
null),this.type===e.ContextType.WEBGL2&&(t.bindTexture(a.TextureType.TEXTURE_3D,null),t.bindTexture(a.TextureType.TEXTURE_2D_ARRAY,null)),y=this._state.textureUnitMap[q],null!=y&&t.bindTexture(y.descriptor.target,y.glName);t.activeTexture(a.baseTextureUnit+this._state.activeTexture);q=this._state.viewport;t.viewport(q.x,q.y,q.width,q.height);this.resetInfo()}_loadExtensions(){this.type===e.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")}};
Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(h,g){class v{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:g.BlendFactor.ONE,dstRGB:g.BlendFactor.ZERO,srcAlpha:g.BlendFactor.ONE,dstAlpha:g.BlendFactor.ZERO};this.blendEquation={mode:g.BlendOperation.ADD,modeAlpha:g.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=g.Face.BACK;
this.frontFace=g.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=g.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:g.Face.FRONT_AND_BACK,func:g.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:g.Face.FRONT_AND_BACK,fail:g.StencilOperation.KEEP,
zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}h.ContextState=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/InstanceCounter":function(){define(["exports","../support/AllocationTracer","./enums"],function(h,g,v){const n={RECORD_ALLOCATIONS:!1};class p{constructor(){this._current=[];for(this._allocations=new g.AllocationTracer(n.RECORD_ALLOCATIONS);this._current.length<v.ResourceType.COUNT;)this._current.push(0)}increment(f,e,a=1){this._current[f]+=a;this._allocations.add(e)}decrement(f,e,a=1){this._current[f]-=a;this._allocations.remove(e)}get current(){return this._current}get total(){return this.current.reduce((f,
e,a)=>f+(a<v.ResourceType.UNCOUNTED?e:0),0)}get resourceInformation(){let f="";if(0<this.total){f+="Live objects:\n";for(let e=0;e<v.ResourceType.COUNT;++e){const a=this._current[e];0<a&&(f+=`${v.ResourceType[e]}: ${a}\n`)}}return f+=this._allocations.information}}h.InstanceCounter=p;h.test=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(h){class g{constructor(v){this._allocations=new Map;v?Error.stackTraceLimit=
Infinity:(this.add=()=>{},this.remove=()=>{})}add(v){this._allocations.set(v,Error().stack)}remove(v){this._allocations.delete(v)}get information(){let v="";if(0<this._allocations.size){v+=`${this._allocations.size} live object allocations:\n`;const n=new Map;this._allocations.forEach(p=>{n.set(p,(n.get(p)??0)+1)});n.forEach((p,f)=>{f=f.split("\n");f.shift();f.shift();v+=`${p}: ${f.shift()}\n`;f.forEach(e=>v+=`   ${e}\n`)})}return v}}h.AllocationTracer=g;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports","./capabilities/isWebGL2Context"],function(h,g){class v{constructor(n,p,f){p=p.textureFilterAnisotropic;f=f.maxAnisotropy??Infinity;this.versionString=n.getParameter(n.VERSION);this.maxVertexTextureImageUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=p?Math.min(n.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY),f):1;this.maxTextureImageUnits=
n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=n.getParameter(n.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=n.getParameter(n.MAX_VIEWPORT_DIMS);g(n)?(this.maxUniformBufferBindings=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE),
this.uniformBufferOffsetAlignment=n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=n.getParameter(n.MAX_SAMPLES)):(this.maxUniformBlockSize=this.maxFragmentUniformBlocks=this.maxVertexUniformBlocks=this.maxUniformBufferBindings=0,this.maxSamples=this.maxArrayTextureLayers=this.uniformBufferOffsetAlignment=1)}}h.Parameters=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(h,g,v){function n(H){return C.intern(H)}function p(H){return A.intern(H)}function f(H){return D.intern(H)}function e(H){return G.intern(H)}function a(H){return J.intern(H)}function b(H){return M.intern(H)}function c(H){return L.intern(H)}function m(H){return Q.intern(H)}function d(H){return N.intern(H)}function k(H){return"["+H.join(",")+"]"}function l(H){return H?k([H.srcRgb,H.srcAlpha,H.dstRgb,H.dstAlpha,H.opRgb,H.opAlpha,H.color.r,H.color.g,
H.color.b,H.color.a]):null}function r(H){return H?k([H.face,H.mode]):null}function u(H){return H?k([H.factor,H.units]):null}function w(H){return H?k([H.func]):null}function x(H){return H?k([H.function.func,H.function.ref,H.function.mask,H.operation.fail,H.operation.zFail,H.operation.zPass]):null}function z(H){return H?k([H.zNear,H.zFar]):null}function q(H){return H?k([H.r,H.g,H.b,H.a]):null}function t(H){return H?k([H.mask]):null}function B(H){return H?k(H.buffers):null}const y={face:v.Face.BACK,
mode:v.CullMode.CCW},E={face:v.Face.FRONT,mode:v.CullMode.CCW};class F{constructor(H,O){this._makeKey=H;this._makeRef=O;this._interns=new Map}intern(H){if(!H)return null;const O=this._makeKey(H),T=this._interns;T.has(O)||T.set(O,this._makeRef(H));return T.get(O)??null}}const C=new F(l,H=>({__tag:"Blending",...H})),A=new F(r,H=>({__tag:"Culling",...H})),D=new F(u,H=>({__tag:"PolygonOffset",...H})),G=new F(w,H=>({__tag:"DepthTest",...H})),J=new F(x,H=>({__tag:"StencilTest",...H})),M=new F(z,H=>({__tag:"DepthWrite",
...H})),L=new F(q,H=>({__tag:"ColorWrite",...H})),Q=new F(t,H=>({__tag:"StencilWrite",...H})),N=new F(B,H=>({__tag:"DrawBuffers",...H})),U=new F(function(H){return H?k([l(H.blending),r(H.culling),u(H.polygonOffset),w(H.depthTest),x(H.stencilTest),z(H.depthWrite),q(H.colorWrite),t(H.stencilWrite),B(H.drawBuffers)]):null},H=>({blending:n(H.blending),culling:p(H.culling),polygonOffset:f(H.polygonOffset),depthTest:e(H.depthTest),stencilTest:a(H.stencilTest),depthWrite:b(H.depthWrite),colorWrite:c(H.colorWrite),
stencilWrite:m(H.stencilWrite),drawBuffers:d(H.drawBuffers)}));class Z{constructor(H){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=H}setPipeline(H){if(this._pipelineInvalid||H!==this._pipeline)this._setBlending(H.blending),this._setCulling(H.culling),this._setPolygonOffset(H.polygonOffset),
this._setDepthTest(H.depthTest),this._setStencilTest(H.stencilTest),this._setDepthWrite(H.depthWrite),this._setColorWrite(H.colorWrite),this._setStencilWrite(H.stencilWrite),this._setDrawBuffers(H.drawBuffers),this._pipeline=H;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(H){this._blending=this._setSubState(H,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(H){this._culling=this._setSubState(H,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(H){this._polygonOffset=this._setSubState(H,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(H){this._depthTest=this._setSubState(H,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(H){this._stencilTest=
this._setSubState(H,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(H){this._depthWrite=this._setSubState(H,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(H){this._colorWrite=this._setSubState(H,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(H){this._stencilWrite=this._setSubState(H,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(H){this._drawBuffers=this._setSubState(H,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(H,O,T,V){if(T||H!==O)V(H),this._pipelineInvalid=!0;return H}}h.StateTracker=Z;h.backFaceCullingParams=y;h.cullingParams=H=>H===g.CullFaceOptions.Back?y:H===g.CullFaceOptions.Front?E:null;h.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};
h.defaultDepthWriteParams={zNear:0,zFar:1};h.frontFaceCullingParams=E;h.makeBlending=n;h.makeColorWrite=c;h.makeCulling=p;h.makeDepthTest=e;h.makeDepthWrite=b;h.makeDrawBuffers=d;h.makePipelineState=function(H){return U.intern(H)};h.makePolygonOffset=f;h.makeStencilTest=a;h.makeStencilWrite=m;h.separateBlendingParams=function(H,O,T,V,X=v.BlendOperation.ADD,I=v.BlendOperation.ADD,K=[0,0,0,0]){return{srcRgb:H,srcAlpha:O,dstRgb:T,dstAlpha:V,opRgb:X,opAlpha:I,color:{r:K[0],g:K[1],b:K[2],a:K[3]}}};h.simpleBlendingParams=
function(H,O,T=v.BlendOperation.ADD,V=[0,0,0,0]){return{srcRgb:H,srcAlpha:H,dstRgb:O,dstAlpha:O,opRgb:T,opAlpha:T,color:{r:V[0],g:V[1],b:V[2],a:V[3]}}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(h){h.CullFaceOptions=void 0;(function(g){g[g.None=0]="None";g[g.Front=1]="Front";g[g.Back=2]="Back";g[g.COUNT=3]="COUNT"})(h.CullFaceOptions||(h.CullFaceOptions={}));h.DepthTestFunction=void 0;(function(g){g[g.Less=
0]="Less";g[g.Lequal=1]="Lequal";g[g.COUNT=2]="COUNT"})(h.DepthTestFunction||(h.DepthTestFunction={}));h.RenderRequestType=void 0;(function(g){g[g.BACKGROUND=0]="BACKGROUND";g[g.UPDATE=1]="UPDATE"})(h.RenderRequestType||(h.RenderRequestType={}));h.ResourceState=void 0;(function(g){g[g.NOT_LOADED=0]="NOT_LOADED";g[g.LOADING=1]="LOADING";g[g.LOADED=2]="LOADED"})(h.ResourceState||(h.ResourceState={}));h.StencilBits=void 0;(function(g){g[g.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";g[g.OutlineVisualElementMask=
2]="OutlineVisualElementMask"})(h.StencilBits||(h.StencilBits={}));h.Object3DState=void 0;(function(g){g[g.Highlight=0]="Highlight";g[g.MaskOccludee=1]="MaskOccludee";g[g.COUNT=2]="COUNT"})(h.Object3DState||(h.Object3DState={}));h.AlphaDiscardMode=void 0;(function(g){g[g.Blend=0]="Blend";g[g.Opaque=1]="Opaque";g[g.Mask=2]="Mask";g[g.MaskBlend=3]="MaskBlend";g[g.COUNT=4]="COUNT"})(h.AlphaDiscardMode||(h.AlphaDiscardMode={}));h.Decorations=void 0;(function(g){g[g.OFF=0]="OFF";g[g.ON=1]="ON"})(h.Decorations||
(h.Decorations={}));h.TextureEncodingMimeType=void 0;(function(g){g.DDS_ENCODING="image/vnd-ms.dds";g.KTX2_ENCODING="image/ktx2";g.BASIS_ENCODING="image/x.basis"})(h.TextureEncodingMimeType||(h.TextureEncodingMimeType={}));Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(h,
g,v,n,p,f){class e{constructor(a){this.rctx=a;this.floatBufferBlend=new n.FloatBufferBlend(a);this.svgPremultipliesAlpha=new f.SVGPremultipliedAlpha(a);this.doublePrecisionRequiresObfuscation=new v.DoublePrecisionRequiresObfuscation(a);this.ignoresSamplerPrecision=new p.IgnoresSamplerPrecision(a);this.drawArraysRequiresIndicesTypeReset=new g.DrawArraysRequiresIndicesTypeReset(a)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();
this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}h.WebGLDriverTest=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./contextUtils ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),function(h,g,v,n,p,f,e,a,b,c){class m extends c.WebGLDriverTestModule{constructor(d){super();
this._rctx=d;this._helperProgram=null;this._rctx.type===f.ContextType.WEBGL2&&g("mac")&&g("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(d){const k=this._rctx,l=k.getBoundFramebufferObject(),{x:r,y:u,width:w,height:x}=k.getViewport();k.resetState();var z=new b.TextureDescriptor(1);z.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;z.samplingMode=e.TextureSamplingMode.NEAREST;
z=new a.FramebufferObject(k,z);const q=p.BufferObject.createIndex(this._rctx,e.Usage.STATIC_DRAW,new Uint8Array([0]));k.bindFramebuffer(z);k.setViewport(0,0,1,1);k.useProgram(this._helperProgram);k.bindBuffer(q,e.BufferType.ELEMENT_ARRAY_BUFFER);k.drawElements(e.PrimitiveType.POINTS,1,e.DataType.UNSIGNED_BYTE,0);k.useProgram(d);k.bindVAO(null);k.drawArrays(e.PrimitiveType.TRIANGLES,0,258);d=new Uint8Array(4);z.readPixels(0,0,1,1,e.PixelFormat.RGBA,e.PixelType.UNSIGNED_BYTE,d);k.setViewport(r,u,w,
x);k.bindFramebuffer(l);z.dispose();q.dispose();return 255===d[0]}_prepareProgram(){const d=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${v.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
k=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${v.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(d,k,new Map([]))}_prepareHelperProgram(){const d=n.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(d.vertex,d.fragment,new Map([]))}}h.DrawArraysRequiresIndicesTypeReset=m;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(h){function g(p,...f){let e="";for(let a=0;a<f.length;a++)e+=p[a]+f[a];return e+=p[p.length-1]}class v{}const n=v;(function(p){p.int=function(f){return Math.round(f).toString()};p.float=function(f){return f.toPrecision(8)}})(g||(g={}));h.NoParameters=n;h.glsl=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"./BufferObject","./enums"],function(h,g,v){class n{constructor(p){this._rctx=p;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const p=
n.getShaderSources();return this._rctx.programCache.acquire(p.vertex,p.fragment,new Map([]))}_createIndexbuffer(){return g.BufferObject.createIndex(this._rctx,v.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,v.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(v.PrimitiveType.POINTS,1,v.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}h.AppleAmdDriverHelper=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(h,g){class v{constructor(){this._result=!1}dispose(){this._program=g.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}h.WebGLDriverTestModule=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k){function l(u,w){return u.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${w?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class r extends k.WebGLDriverTestModule{constructor(u){super();this._rctx=u;this._program=l(this._rctx,!1);this._obfuscated=l(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=n.disposeMaybe(this._obfuscated)}_test(u){if(v("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;u=this._runProgram(u);const w=this._runProgram(this._obfuscated);
return 0!==u&&(0===w||5<u/w)}_runProgram(u){var w=this._rctx;w.resetState();var x=new c.TextureDescriptor(1);x.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=a.TextureSamplingMode.NEAREST;x=new b.FramebufferObject(w,x);var z=f.BufferObject.createVertex(w,a.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));z=new m.VertexArrayObject(w,new Map([["position",0]]),{geometry:[new d.VertexElementDescriptor("position",2,a.DataType.UNSIGNED_SHORT,0,4)]},{geometry:z});const q=p.fromValues(5633261.287538229,
2626832.878767164,1434988.0495278358),t=p.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),B=new Float32Array(6);e.encodeDoubleArray(q,B,3);const y=new Float32Array(6);e.encodeDoubleArray(t,y,3);w.useProgram(u);u.setUniform3f("u_highA",B[0],B[2],B[4]);u.setUniform3f("u_lowA",B[1],B[3],B[5]);u.setUniform3f("u_highB",y[0],y[2],y[4]);u.setUniform3f("u_lowB",y[1],y[3],y[5]);w.bindFramebuffer(x);w.setViewport(0,0,1,1);w.bindVAO(z);w.drawArrays(a.PrimitiveType.TRIANGLE_STRIP,0,4);u=new Uint8Array(4);
x.readPixels(0,0,1,1,a.PixelFormat.RGBA,a.PixelType.UNSIGNED_BYTE,u);z.dispose();x.dispose();w=(q[2]-t[2])/25;u=g.unpackFloatRGBA(u);return Math.abs(w-u)}}h.DoublePrecisionRequiresObfuscation=r;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(h){const g=new Float32Array(2);h.decodeDoubleArray=function(v,n,p){for(let f=0;f<p;++f)n[f]=v[2*f]+v[2*f+1]};h.encodeDoubleArray=function(v,n,p){for(let f=0;f<p;++f)n[2*
f]=v[f],n[2*f+1]=v[f]-n[2*f]};h.encodeDoubleHi=function(v,n){const p=v.length;for(let f=0;f<p;++f)g[0]=v[f],n[f]=g[0];return n};h.encodeDoubleLo=function(v,n){const p=v.length;for(let f=0;f<p;++f)g[0]=v[f],g[1]=v[f]-g[0],n[f]=g[1];return n};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./contextUtils ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){class d extends m.WebGLDriverTestModule{constructor(k){super();this._rctx=k;k.gl&&(k.type===n.ContextType.WEBGL1?this._result=!(!k.capabilities.textureFloat?.textureFloat||!k.capabilities.colorBufferFloat?.textureFloat):k.capabilities.textureFloat?.textureFloat&&k.capabilities.colorBufferFloat?.textureFloat&&k.capabilities.colorBufferFloat?.floatBlend&&(this._program=k.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))))}_test(k){const l=this._rctx;var r=new a.TextureDescriptor(1);r.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;r.dataType=p.PixelType.FLOAT;r.internalFormat=p.SizedPixelFormat.RGBA32F;r.samplingMode=p.TextureSamplingMode.NEAREST;r=new f.FramebufferObject(l,r);var u=v.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));u=new b.VertexArrayObject(l,
new Map([["a_pos",0]]),{geometry:[new c.VertexElementDescriptor("a_pos",2,p.DataType.UNSIGNED_SHORT,0,4)]},{geometry:u});l.useProgram(k);k=l.getBoundFramebufferObject();const {x:w,y:x,width:z,height:q}=l.getViewport();l.bindFramebuffer(r);l.setViewport(0,0,1,1);l.bindVAO(u);l.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);var t=e.makePipelineState({blending:g.blendingAlpha});l.setPipelineState(t);l.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);t=l.gl.getError();l.setViewport(w,x,z,q);l.bindFramebuffer(k);
u.dispose();r.dispose();return 1282===t?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}h.FloatBufferBlend=d;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(h,g,v,n){const p=n.separateBlendingParams(v.BlendFactor.SRC_ALPHA,v.BlendFactor.ONE,
v.BlendFactor.ONE_MINUS_SRC_ALPHA,v.BlendFactor.ONE_MINUS_SRC_ALPHA),f=n.simpleBlendingParams(v.BlendFactor.ONE,v.BlendFactor.ONE),e=n.simpleBlendingParams(v.BlendFactor.ZERO,v.BlendFactor.ONE_MINUS_SRC_ALPHA),a={factor:-1,units:-2};h.OITPolygonOffset=a;h.OITPolygonOffsetLimit=5E5;h.blendingAlpha=e;h.blendingColor=f;h.blendingDefault=p;h.getOITPolygonOffset=function(b){return b?a:null};h.oitBlending=function(b){return b===g.TransparencyPassType.FrontFace?null:b===g.TransparencyPassType.Alpha?e:f};
h.oitDepthTest=function(b,c=v.CompareFunction.LESS){return b===g.TransparencyPassType.NONE||b===g.TransparencyPassType.FrontFace?c:v.CompareFunction.LEQUAL};h.oitDepthWrite=function(b){return b===g.TransparencyPassType.FrontFace?n.defaultDepthWriteParams:null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(h){h.TransparencyPassType=void 0;var g=h.TransparencyPassType||(h.TransparencyPassType=
{});g[g.Color=0]="Color";g[g.Alpha=1]="Alpha";g[g.FrontFace=2]="FrontFace";g[g.NONE=3]="NONE";g[g.COUNT=4]="COUNT";Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(h,g,v,n,p,f,e,a,b,c){class m extends c.WebGLDriverTestModule{constructor(d){super();
this._rctx=d;this._program=d.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(d){const k=this._rctx;var l=new e.TextureDescriptor(1);l.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;l.samplingMode=n.TextureSamplingMode.NEAREST;const r=new p.FramebufferObject(k,l),u=new Uint8Array(4);var w=v.BufferObject.createVertex(k,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));w=new a.VertexArrayObject(k,new Map([["a_position",
0]]),{geometry:[new b.VertexElementDescriptor("a_position",2,n.DataType.SHORT,0,4)]},{geometry:w});k.useProgram(d);l=new f.Texture(k,l,new Uint8Array([2,255,0,0]));d.setUniform1i("u_texture",0);k.bindTexture(l,0);l=k.getBoundFramebufferObject();k.bindFramebuffer(r);k.useProgram(d);const {x,y:z,width:q,height:t}=k.getViewport();k.setViewport(0,0,1,1);k.bindVAO(w);k.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);k.setViewport(x,z,q,t);r.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,
u);w.dispose();r.dispose();(d=255!==u[0]||255!==u[1]||255!==u[2]||255!==u[3])&&g.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${u[0]}.${u[1]}.${u[2]}.${u[3]}]`);k.bindFramebuffer(l);return d}}
h.IgnoresSamplerPrecision=m;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(h,g,v,n,p,f,e,a,b){class c extends b.WebGLDriverTestModule{constructor(d){super();this._rctx=d;this._program=d.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(d){const k=this._rctx;if(!k.gl)return d.dispose(),!0;var l=new e.TextureDescriptor(1);l.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;l.samplingMode=n.TextureSamplingMode.NEAREST;l=new p.FramebufferObject(k,l);var r=v.BufferObject.createVertex(k,n.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));r=new a.VertexArrayObject(k,new Map([["a_pos",0]]),g.Pos2us,{geometry:r});var u=new e.TextureDescriptor;u.samplingMode=n.TextureSamplingMode.LINEAR;u.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;u=new f.Texture(k,u,m);k.useProgram(d);k.bindTexture(u,0);d.setUniform1i("u_texture",0);d=k.getBoundFramebufferObject();const {x:w,y:x,width:z,height:q}=k.getViewport();k.bindFramebuffer(l);k.setViewport(0,0,1,1);k.setClearColor(0,0,0,0);k.setBlendingEnabled(!1);k.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT);
k.bindVAO(r);k.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);const t=new Uint8Array(4);l.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,t);r.dispose();l.dispose();u.dispose();k.setViewport(w,x,z,q);k.bindFramebuffer(d);return 255!==t[0]}}const m=new Image;m.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
m.width=5;m.height=5;m.decode();h.SVGPremultipliedAlpha=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ./DisjointTimerQuery ./DrawBuffers ./load ./LoseContext ./VertexArrayObjects".split(" "),function(h,g,v,n,p,f){class e{constructor(a,b){this._gl=a;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=this._textureFloat=
this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=null;this._disabledExtensions=b.disabledExtensions||{};this._debugWebGLExtensions=b.debugWebGLExtensions||{}}get drawBuffers(){this._drawBuffers||(this._drawBuffers=v.load(this._gl,this._disabledExtensions));return this._drawBuffers}get vao(){this._vertexArrayObject||(this._vertexArrayObject=f.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}get compressedTextureETC(){this._compressedTextureETC||
(this._compressedTextureETC=n.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=n.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=n.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||
(this._disjointTimerQuery=g.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){this._textureFloat||(this._textureFloat=n.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||(this._colorBufferFloat=n.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get blendMinMax(){this._minMaxBlending||(this._minMaxBlending=n.loadMinMaxBlending(this._gl,
this._disabledExtensions));return this._minMaxBlending}get depthTexture(){null===this._depthTexture&&(this._depthTexture=n.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=p.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16||(this._textureNorm16=n.loadTextureNorm16(this._gl,
this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=n.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(a){return this[a]}}h.Capabilities=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(h,g){h.load=
function(v,n){return n.disjointTimerQuery?null:g(v)?{drawBuffers:v.drawBuffers.bind(v),MAX_DRAW_BUFFERS:v.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:v.MAX_COLOR_ATTACHMENTS}:n.drawBuffers?null:(v=v.getExtension("WEBGL_draw_buffers"))?{drawBuffers:v.drawBuffersWEBGL.bind(v),MAX_DRAW_BUFFERS:v.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:v.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports",
"./isWebGL2Context"],function(h,g){h.loadBooleanExtension=function(v,n,p,f,e){if(f&&g(v))return!0;if(n[p])return!1;for(const a of e)if(v.getExtension(a))return!0;return!1};h.loadColorBufferFloat=function(v,n){if(g(v)){var p=!n.colorBufferHalfFloat&&v.getExtension("EXT_color_buffer_half_float")||!n.colorBufferFloat&&v.getExtension("EXT_color_buffer_float"),f=!n.colorBufferFloat&&v.getExtension("EXT_color_buffer_float");n=!n.floatBlend&&!n.colorBufferFloat&&v.getExtension("EXT_float_blend");return p||
f||n?{textureFloat:!!f,textureHalfFloat:!!p,floatBlend:!!n,R16F:v.R16F,RG16F:v.RG16F,RGBA16F:v.RGBA16F,R32F:v.R32F,RG32F:v.RG32F,RGBA32F:v.RGBA32F,R11F_G11F_B10F:v.R11F_G11F_B10F,RGB16F:v.RGB16F}:null}return v instanceof WebGLRenderingContext?(p=!n.colorBufferHalfFloat&&v.getExtension("EXT_color_buffer_half_float"),f=!n.colorBufferFloat&&v.getExtension("WEBGL_color_buffer_float"),v=!n.floatBlend&&!n.colorBufferFloat&&v.getExtension("EXT_float_blend"),p||f||v?{textureFloat:!!f,textureHalfFloat:!!p,
floatBlend:!!v,RGBA16F:p?p.RGBA16F_EXT:void 0,RGB16F:p?p.RGB16F_EXT:void 0,RGBA32F:f?f.RGBA32F_EXT:void 0}:null):null};h.loadCompressedTextureETC=function(v,n){return n.compressedTextureETC?null:(v=v.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:v.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:v.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:v.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:v.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:v.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:v.COMPRESSED_SRGB8_ETC2,
COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:v.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:v.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:v.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:v.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};h.loadCompressedTextureS3TC=function(v,n){return n.compressedTextureS3TC?null:(v=v.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:v.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:v.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:v.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:v.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};h.loadMinMaxBlending=function(v,n){return g(v)?{MIN:v.MIN,MAX:v.MAX}:n.blendMinMax?null:(v=v.getExtension("EXT_blend_minmax"))?{MIN:v.MIN_EXT,MAX:v.MAX_EXT}:null};h.loadTextureFilterAnisotropicCapability=function(v,n){return n.textureFilterAnisotropic?null:(v=v.getExtension("EXT_texture_filter_anisotropic")||v.getExtension("MOZ_EXT_texture_filter_anisotropic")||v.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?
{MAX_TEXTURE_MAX_ANISOTROPY:v.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:v.TEXTURE_MAX_ANISOTROPY_EXT}:null};h.loadTextureFloat=function(v,n){if(g(v))return{textureFloat:!0,textureFloatLinear:!n.textureFloatLinear&&!!v.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:v.HALF_FLOAT,R16F:v.R16F,RG16F:v.RG16F,RGBA16F:v.RGBA16F,R32F:v.R32F,RG32F:v.RG32F,RGBA32F:v.RGBA32F,R11F_G11F_B10F:v.R11F_G11F_B10F,RGB16F:v.RGB16F};if(v instanceof WebGLRenderingContext){const p=
!n.textureHalfFloat&&v.getExtension("OES_texture_half_float");return{textureFloat:!n.textureFloat&&!!v.getExtension("OES_texture_float"),textureFloatLinear:!n.textureFloatLinear&&!!v.getExtension("OES_texture_float_linear"),textureHalfFloat:!!p,textureHalfFloatLinear:!n.textureHalfFloatLinear&&!!v.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:p?p.HALF_FLOAT_OES:void 0}}return null};h.loadTextureNorm16=function(v,n){return!g(v)||n.textureNorm16?null:(v=v.getExtension("EXT_texture_norm16"))?
{R16:v.R16_EXT,RG16:v.RG16_EXT,RGB16:v.RGB16_EXT,RGBA16:v.RGBA16_EXT,R16_SNORM:v.R16_SNORM_EXT,RG16_SNORM:v.RG16_SNORM_EXT,RGB16_SNORM:v.RGB16_SNORM_EXT,RGBA16_SNORM:v.RGBA16_SNORM_EXT}:null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(h){h.load=function(g,v){const n=v.loseContext&&g.getExtension("WEBGL_lose_context");return n?{loseRenderingContext:()=>n.loseContext()}:null};Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(h,g){h.load=function(v,n){return g(v)?{createVertexArray:v.createVertexArray.bind(v),deleteVertexArray:v.deleteVertexArray.bind(v),bindVertexArray:v.bindVertexArray.bind(v)}:n.vao?null:(v=v.getExtension("OES_vertex_array_object")||v.getExtension("MOZ_OES_vertex_array_object")||v.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:v.createVertexArrayOES.bind(v),
deleteVertexArray:v.deleteVertexArrayOES.bind(v),bindVertexArray:v.bindVertexArrayOES.bind(v)}:null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/has ../../core/Logger ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d){h.LabelManager=class extends v{constructor(k){super(k);this.collisionEngine=new d.CollisionEngine;this.lastUpdateId=-1;this.updateRequested=!1;this.view=null;this._applyVisibilityPass=e.throttle(l=>{const r=this.view;if(r)try{const u=r.featuresTilingScheme.getClosestInfoForScale(l.state.scale).level;this.collisionEngine.run(r.allLayerViews.items,l,u)}catch(u){}},32,this);this.addHandles(this._applyVisibilityPass)}get updating(){p("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`);
return this.updateRequested}update(k){this._applyVisibilityPass(k)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(k){this.updateRequested&&(this.updateRequested=!1,this.update(k))}};g.__decorate([a.property()],h.LabelManager.prototype,"updateRequested",void 0);g.__decorate([a.property()],h.LabelManager.prototype,"updating",null);g.__decorate([a.property()],h.LabelManager.prototype,"view",void 0);h.LabelManager=
g.__decorate([m.subclass("esri.views.2d.LabelManager")],h.LabelManager);Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/throttle":function(){define(["exports"],function(h){h.throttle=function(g,v,n,p){let f=null,e=1E3;"number"===typeof v?(e=v,p=n):(f=v??null,e=n);let a=0,b;const c=()=>{a=0;g.apply(p,b)};v=(...m)=>{f&&f.apply(p,m);b=m;e?a||(a=setTimeout(c,e)):c()};v.remove=()=>{a&&(clearTimeout(a),a=0)};v.forceUpdate=()=>{a&&(clearTimeout(a),c())};v.hasPendingUpdates=()=>
!!a;return v};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define(["exports","../definitions","./CollisionGrid"],function(h,g,v){function n(f,e){const a=[];f.forEachTile(b=>a.push(b));a.sort((b,c)=>b.instanceId-c.instanceId);a.forEach(b=>{null!=b.labelMetrics&&b.isReady&&e(b,b.labelMetrics.getCursor())})}class p{run(f,e,a){const b=[];for(let c=f.length-1;0<=c;c--){const m=f[c];m.labelingCollisionInfos&&b.push(...m.labelingCollisionInfos)}this._transformMetrics(b);
this._runCollision(b,e,a)}_runCollision(f,e,a){const [b,c]=e.state.size,m=new v.CollisionBitsetGrid(b,c,e.pixelRatio);for(const {tileRenderer:d,deconflictionEnabled:k,visible:l}of f){const r=d.featuresView.attributeView;k?l?(this._prepare(d),this._collideVisible(m,d,a),this._collideInvisible(m,d)):n(d,(u,w)=>{for(;w.nextId();)r.setLabelMinZoom(w.id,255)}):n(d,(u,w)=>{for(;w.nextId();)r.setLabelMinZoom(w.id,0),l&&m.insertMetrics(w)})}}_isFiltered(f,e,a){f=e.getFilterFlags(f);e=null==a.featureEffect||
a.featureEffect.excludedLabelsVisible||!!(f&g.effectFlag0);return!((!a.hasFilter||f&g.filterFlag0)&&e)}_prepare(f){const e=f.featuresView.attributeView,a=new Set;n(f,(b,c)=>{for(;c.nextId();)a.has(c.id)||(a.add(c.id),this._isFiltered(c.id,e,f.layerView)?e.setLabelMinZoom(c.id,254):0!==e.getLabelMinZoom(c.id)?e.setLabelMinZoom(c.id,255):e.setLabelMinZoom(c.id,0))})}_collideVisible(f,e,a){const b=e.featuresView.attributeView,c=new Set;n(e,(m,d)=>{for(;d.nextId();)if(!c.has(d.id))if(m.key.level!==a)b.setLabelMinZoom(d.id,
254);else if(0===b.getLabelMinZoom(d.id))switch(f.insertMetrics(d)){case v.hasCollision:b.setLabelMinZoom(d.id,254);c.add(d.id);break;case v.none:b.setLabelMinZoom(d.id,0),c.add(d.id)}})}_collideInvisible(f,e){const a=e.featuresView.attributeView,b=new Set;n(e,(c,m)=>{for(;m.nextId();)if(!b.has(m.id)&&255===a.getLabelMinZoom(m.id))switch(f.insertMetrics(m)){case v.hasCollision:a.setLabelMinZoom(m.id,255);b.add(m.id);break;case v.none:a.setLabelMinZoom(m.id,0),b.add(m.id)}})}_transformMetrics(f){for(const {tileRenderer:e,
geometryType:a,vvEvaluators:b}of f)n(e,(c,m)=>{const d=e.featuresView.attributeView;c=c.transforms.labelMat2d;c[4]=Math.round(c[4]);c[5]=Math.round(c[5]);const k="polyline"===a;for(;m.next();){const z=m.boundsCount,q=m.anchorX,t=m.anchorY;var l=m.size,r=b[0];if(null!=r){var u=d.getVVSize(m.id);r=r(u);l=isNaN(r)||null==r||Infinity===r?l:r}r=l/2*m.directionX;l=l/2*m.directionY;for(u=0;u<z;u++){var w=q,x=m.anchorY;k?(w=w+m.boundsX(u)+r,x=x+m.boundsY(u)+l,w=c[0]*w+c[2]*x+c[4],x=c[1]*w+c[3]*x+c[5],m.setBoundsComputedAnchorX(u,
Math.floor(w)),m.setBoundsComputedAnchorY(u,Math.floor(x))):(w=c[0]*q+c[2]*t+c[4],x=c[1]*q+c[3]*t+c[5],w=w+m.boundsX(u)+r,x=x+m.boundsY(u)+l,m.setBoundsComputedAnchorX(u,w),m.setBoundsComputedAnchorY(u,x))}}})}}h.CollisionEngine=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(h,g,v){class n{constructor(p,f,e){this._debugMap=
new Map;this._width=p*e;this._height=f*e;this._pixelRatio=e;p=Math.ceil(this._width/1);f=Math.ceil(this._height/1);this._cols=p;this._rows=f;this._cells=v.StaticBitSet.create(p*f)}insertMetrics(p){const f=this._hasCollision(p);0===f&&this._markMetrics(p);return f}getCellId(p,f){return p+f*this._cols}has(p){return this._cells.has(p)}hasRange(p,f){return this._cells.hasRange(p,f)}set(p){this._cells.set(p)}setRange(p,f){this._cells.setRange(p,f)}_collide(p,f,e,a){p-=e/2;f-=a/2;e=p+e;var b=f+a;if(0>e||
0>b||p>this._width||f>this._height)return 1;a=g.clamp(Math.floor(p/1),0,this._cols);var c=g.clamp(Math.floor(f/1),0,this._rows);p=g.clamp(Math.ceil(e/1),0,this._cols);f=g.clamp(Math.ceil(b/1),0,this._rows);for(e=c;e<=f;e++)for(b=a;b<=p;b++)if(c=this.getCellId(b,e),this.has(c))return 2;return 0}_mark(p,f,e,a,b){p-=e/2;f-=a/2;e=p+e;var c=f+a;a=g.clamp(Math.floor(p/1),0,this._cols);var m=g.clamp(Math.floor(f/1),0,this._rows);p=g.clamp(Math.ceil(e/1),0,this._cols);f=g.clamp(Math.ceil(c/1),0,this._rows);
for(e=m;e<=f;e++)for(c=a;c<=p;c++)m=this.getCellId(c,e),this._debugMap.set(m,b),this.set(m);return!1}_hasCollision(p){const f=p.id;let e=0,a=0;p.save();do{const b=p.boundsCount;e+=b;for(let c=0;c<b;c++){const m=p.boundsComputedAnchorX(c),d=p.boundsComputedAnchorY(c),k=(p.boundsWidth(c)+2)*this._pixelRatio,l=(p.boundsHeight(c)+2)*this._pixelRatio;switch(this._collide(m,d,k,l)){case 2:return 2;case 1:a++}}}while(p.peekId()===f&&p.next());p.restore();return e===a?1:0}_markMetrics(p){const f=p.id;p.save();
do{const e=p.boundsCount;for(let a=0;a<e;a++){const b=p.boundsComputedAnchorX(a),c=p.boundsComputedAnchorY(a),m=(p.boundsWidth(a)+2)*this._pixelRatio,d=(p.boundsHeight(a)+2)*this._pixelRatio;this._mark(b,c,m,d,p.id)}}while(p.peekId()===f&&p.next());p.restore()}}h.CollisionBitsetGrid=n;h.hasCollision=2;h.none=0;h.outsideExtent=1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(h){class g{static fromBuffer(v,
n){return new g(v,n)}static create(v,n=4294967295){v=new Uint32Array(Math.ceil(v/32));return new g(v,n)}constructor(v,n){this._mask=0;this._buf=v;this._mask=n}_getIndex(v){return Math.floor(v/32)}has(v){v&=this._mask;return!!(this._buf[this._getIndex(v)]&1<<v%32)}hasRange(v,n){for(;v%32&&v!==n;){if(this.has(v))return!0;v++}for(;n%32&&v!==n;){if(this.has(v))return!0;n--}if(v===n)return!1;for(v/=32;v!==n/32;v++)if(this._buf[v])return!0;return!1}set(v){v&=this._mask;const n=this._getIndex(v);this._buf[n]|=
1<<v%32}setRange(v,n){for(;v%32&&v!==n;)this.set(v++);for(;n%32&&v!==n;)this.set(n--);if(v!==n)for(v/=32;v!==n/32;v++)this._buf[v]=4294967295}unset(v){v&=this._mask;const n=this._getIndex(v);this._buf[n]&=4294967295^1<<v%32}resize(v){const n=this._buf;v=new Uint32Array(Math.ceil(v/32));v.set(n);this._buf=v}or(v){for(let n=0;n<this._buf.length;n++)this._buf[n]|=v._buf[n];return this}and(v){for(let n=0;n<this._buf.length;n++)this._buf[n]&=v._buf[n];return this}xor(v){for(let n=0;n<this._buf.length;n++)this._buf[n]^=
v._buf[n];return this}ior(v){for(let n=0;n<this._buf.length;n++)this._buf[n]|=~v._buf[n];return this}iand(v){for(let n=0;n<this._buf.length;n++)this._buf[n]&=~v._buf[n];return this}ixor(v){for(let n=0;n<this._buf.length;n++)this._buf[n]^=~v._buf[n];return this}any(){for(let v=0;v<this._buf.length;v++)if(this._buf[v])return!0;return!1}copy(v){for(let n=0;n<this._buf.length;n++)this._buf[n]=v._buf[n];return this}clone(){return new g(this._buf.slice(),this._mask)}clear(){for(let v=0;v<this._buf.length;v++)this._buf[v]=
0}forEachSet(v){for(let n=0;n<this._buf.length;n++){let p=this._buf[n],f=32*n;if(p)for(;p;)p&1&&v(f),p>>>=1,f++}}countSet(){let v=0;this.forEachSet(n=>{v++});return v}}h.StaticBitSet=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/BidiText ../../../../core/has ../../../../core/Identifiable ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtilsSync ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/support/defaults ../../engine/webgl/definitions ../../engine/webgl/enums ../../engine/webgl/GraphicTile ../../engine/webgl/TileData ../../engine/webgl/WGLDisplayObject ../../engine/webgl/mesh/MeshData ../../engine/webgl/mesh/factories/WGLMeshFactory ../../engine/webgl/mesh/templates/WGLTemplateStore ../../engine/webgl/util/Matcher ../features/schemaUtils ../features/support/AttributeStore ../features/support/ComputedAttributeStorage ../features/support/GraphicsReader ./GraphicStore ./graphicsUtils ../support/cimSymbolUtils ../../../webgl/capabilities ../features/createSymbolSchema".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z,q,t,B,y,E,F,C,A,D,G,J,M,L,Q,N,U,Z,H,O,T){function V(I,K,P){let W=P.get(I);W||(W={tile:K,addedOrModified:[],removed:[]},P.set(I,W));return W}const X=p("esri-2d-graphic-debug");g=class extends f.IdentifiableMixin(g){constructor(I){super(I);this._storage=new Q.ComputedAttributeStorage;this._displayIds=new Map;this._controller=new AbortController;this._tiles=new Map;this._graphicStoreUpdate=!1;this._graphicsSet=new Set;this._matcher=Promise.resolve(null);
this._tileUpdateSet=new Set;this._tilesToUpdate=new Map;this._graphicIdToAbortController=new Map;this._attached=!1;this._updatingGraphicsTimer=null;this._hashToExpandedSymbol=new Map;this._hashToExpandedSymbolPromise=new Map;this._hashToCIMSymbolPromise=new Map;this._hashToCIM=new Map;this._needsProcessing=this._processing=!1;this._pendingUpdate={added:new Set,updated:new Set,removed:new Set};this.lastUpdateId=-1;this.renderer=null;this.updateRequested=!1;this.defaultPointSymbolEnabled=!0;this.graphicUpdateHandler=
this.graphicUpdateHandler.bind(this)}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating"));this._controller.abort();this.container.destroy();this._set("graphics",null);this._graphicStore.clear();this._attributeStore=null;this._hashToExpandedSymbol.clear();this.renderer=this.view=null;this._hashToCIM.clear();this._hashToCIMSymbolPromise.clear();this._hashToExpandedSymbolPromise.clear()}_createMatcher(I,K,P){if(I){const W=
M.createSymbolSchemaOptions(I);I=M.createMatcherSchema({indexCount:0,fields:{}},"feature",I,W);this._matcher=J.createMatcher(I,K,null,P)}}_createDisplayId(I){let K=this._displayIds.get(I);K||(K=this._storage.createDisplayId(),this._displayIds.set(I,K));return K}initialize(){this._attributeStore=new L({type:"local",initialize:K=>Promise.resolve(this.container.attributeView.initialize(K)),update:K=>this.container.attributeView.requestUpdate(K),render:()=>this.container.requestRender()},O.getWebGLCapabilities("2d"));
this.container.checkHighlight=()=>this._attributeStore.hasHighlight;const I=new G.WGLTemplateStore(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new U(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,K=>{this._createDisplayId(K.uid);this._setFilterState(K.uid,K.visible)},K=>{const P=this._displayIds.get(K.uid);this._displayIds.delete(K.uid);this._storage.releaseDisplayId(P)},this._hashToCIM);this._meshFactory=
new D.WGLMeshFactory(null,this.uid,I);this._templateStore=I;this.addHandles([b.watch(()=>this._effectiveRenderer,K=>{this._createMatcher(K,I,this.container.stage.resourceManager);for(const P of this.graphics)this._pendingUpdate.updated.add(P);this.requestUpdate()}),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{X&&this.container.enableRenderingBounds(()=>this._graphicStore.getAllBounds());0<this.graphics.items.length&&this._graphicsChangeHandler({target:this.graphics,
added:this.graphics.items,removed:[],moved:[]});this.addHandles(this.graphics.on("change",P=>this._graphicsChangeHandler(P)),"graphics");const K=this.container.stage.resourceManager;this._createMatcher(this._effectiveRenderer,I,K);this._graphicStore.setResourceManager(K);this._attached=!0;this.notifyChange("updating")})]);this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})}get _effectiveRenderer(){return"function"===typeof this.renderer?this.renderer():this.renderer}get updating(){return!this._attached||
null!==this._updatingGraphicsTimer||0<this._pendingUpdate.added.size||0<this._pendingUpdate.removed.size||0<this._pendingUpdate.updated.size||0<this._tileUpdateSet.size||0<this._tilesToUpdate.size||this._attributeStore?.updatingHandles.updating||this._processing}hitTest(I){if(!this.view||this.view.suspended)return[];const {resolution:K,rotation:P}=this.view.state;return this._graphicStore.hitTest(I.x,I.y,2,K,P)}update(I){a.throwIfAborted(this._controller.signal);({resolution:I}=I.state);this._graphicStore.updateLevel(I);
this._graphicStoreUpdate=!0;this.updateRequested=!1;0<this._pendingUpdate.updated.size&&(this._processing?this._needsProcessing=!0:this._updateGraphics())}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(I){this.updateRequested&&(this.updateRequested=!1,this.update(I))}graphicUpdateHandler(I){const {graphic:K,property:P}=I;switch(P){case "attributes":case "geometry":case "symbol":this._pendingUpdate.updated.add(K);
this.requestUpdate();break;case "visible":this._setFilterState(K.uid,K.visible),this._attributeStore.sendUpdates()}}setHighlight(I){const K=I.map(P=>this._displayIds.get(P)).filter(v.isSome);this._attributeStore.setHighlight(I,K)}_getIntersectingTiles(I){I=this._graphicStore.getBounds(I);if(!I||0===l.width(I)||0===l.height(I))return[];const K=Z.intersectingInternationalDateline(I,this.view.spatialReference);return null!=K?[...(new Set([...this.view.graphicsTileStore.boundsIntersections(K[0]),...this.view.graphicsTileStore.boundsIntersections(K[1])]))]:
this.view.graphicsTileStore.boundsIntersections(I)}async _updateTile(I){a.throwIfAborted(this._controller.signal);const K=I.tile;var P=this._getGraphicsData(this._templateStore,K,I.addedOrModified);P=await this._processGraphics(K,P);a.throwIfAborted(this._controller.signal);this._patchTile(K.key,{type:"update",addOrUpdate:P,remove:I.removed,end:!0,clear:!1,sort:!1});return P}_patchTile(I,K){if(I=this._tiles.get(I))this.container.onTileData(I,K),this.container.requestRender()}_graphicsChangeHandler(I){const K=
this._pendingUpdate;for(const P of I.added)K.added.add(P);for(const P of I.moved)K.updated.add(P);for(const P of I.removed)this._pendingUpdate.added.has(P)?K.added.delete(P):K.removed.add(P);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){const I={added:[],removed:[],updated:[]};if(!this.graphics)return I;const K=this._pendingUpdate;for(const P of this.graphics.items)K.added.has(P)?I.added.push(P):K.updated.has(P)&&I.updated.push(P);for(const P of K.removed)this._graphicStore.has(P)&&
I.removed.push(P);K.added.clear();K.removed.clear();K.updated.clear();return I}async _updateGraphics(){this._processing=!0;const {added:I,removed:K,updated:P}=this._getGraphicsToUpdate(),W=this._tilesToUpdate;try{if(!this._graphicStoreUpdate){var {resolution:aa}=this.view.state;this._graphicStore.updateLevel(aa)}aa=[];const ba=Array(I.length+K.length);for(let da=0;da<P.length;da++){var R=P[da];const fa=this._getIntersectingTiles(R);for(const ea of fa){var S=ea.id;V(S,ea,W).removed.push(this._displayIds.get(R.uid))}aa.push(this._updateGraphic(R,
null));ba[da]=R}var Y=P.length;for(R=0;R<I.length;R++){const da=I[R];ba[Y+R]=da;this._graphicsSet.add(da);aa.push(this._addGraphic(da))}for(const da of K){this._abortProcessingGraphic(da.uid);const fa=this._getIntersectingTiles(da);for(const ea of fa)S=ea.id,V(S,ea,W).removed.push(this._displayIds.get(da.uid));this._graphicsSet.delete(da);this._graphicStore.remove(da)}this._flipUpdatingGraphics();await Promise.all(aa);let ca;for(Y=0;Y<ba.length;Y++){ca=ba[Y];const da=this._getIntersectingTiles(ca);
for(const fa of da)S=fa.id,V(S,fa,W).addedOrModified.push(ca)}this._graphicStore.updateZ();S=[];for(const [,da]of W)S.push(this._updateTile(da));await Promise.all(S)}catch(ba){a.isAbortError(ba)}for(const ba of K)try{const ca=await this._getSymbolForGraphic(ba,null);if(ca){const da=ca.hash();this._hashToExpandedSymbol.delete(da)}}catch(ca){a.isAbortError(ca)}W.clear();this.notifyChange("updating");this._processing=!1;this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(I){const K=
(I.attributes?Object.keys(I.attributes):[]).map(P=>({name:P,alias:P,type:"string"===typeof I.attributes[P]?"esriFieldTypeString":"esriFieldTypeDouble"}));return null==I.geometry?null:{geometryType:u.getJsonType(I.geometry),spatialReference:k.fromJSON(I.geometry.spatialReference),fields:K}}_getSymbolForGraphic(I,K){a.throwIfAborted(this._controller.signal);return null!=I.symbol?Promise.resolve(I.symbol):null!=this._effectiveRenderer?this._effectiveRenderer.getSymbolAsync(I,{scale:this.view.state.scale,
signal:null!=K?K.signal:null}):Promise.resolve(this._getNullSymbol(I))}_getCIMSymbol(I,K,P){var W=this._hashToCIM.get(K);if(W)return Promise.resolve(W);I=q.symbolToCIM(I);if(null!=I){if("CIMSymbolReference"===I.type)return W=I,this._hashToCIM.set(K,W),Promise.resolve(W);if(W=this._hashToCIMSymbolPromise.get(K))return W;W=I.fetchCIMSymbol(P).then(aa=>{this._hashToCIM.set(K,aa.data);this._hashToCIMSymbolPromise.delete(K);return aa}).catch(aa=>{this._hashToCIMSymbolPromise.delete(K);a.throwIfAbortError(aa);
return null});this._hashToCIMSymbolPromise.set(K,W);return W}return Promise.resolve(null)}_expandCIMSymbol(I,K,P,W){var aa=this._hashToExpandedSymbol.get(P);if(aa)return Promise.resolve(aa);if(aa=this._hashToExpandedSymbolPromise.get(P))return aa;aa=this.container.stage;K=this._getArcadeInfo(K);const R=M.createSymbolSchemaOptions(null);I=T.createSymbolSchema(I,R);aa=H.expandSymbol(I,K,aa.resourceManager,W);this._hashToExpandedSymbolPromise.set(P,aa);aa.then(S=>{this._hashToExpandedSymbol.set(P,S);
this._hashToExpandedSymbolPromise.delete(P);return S});return aa}async _getSymbolResources(I,K){a.throwIfAborted(this._controller.signal);return this.container.stage?this._getSymbolForGraphic(I,K).then(P=>{if(!P)return null;const W=P.hash();return this._getCIMSymbol(P,W,K).then(aa=>null==aa?null:this._expandCIMSymbol(aa,I,W,K).then(R=>{const S=R.layers.filter(Y=>"text"===Y.type&&"string"===typeof Y.text);if(S&&0<S.length){const Y=Array(S.length);for(let ca=0;ca<S.length;ca++){const da=S[ca],fa=[],
[ea]=n.bidiText(da.text);da.text=ea;"text"===P.type&&(da.lineWidth=P.lineWidth);for(let ha=0;ha<ea.length;ha++)fa.push(ea.charCodeAt(ha));Y[ca]={symbol:da,id:ca,glyphIds:fa}}const ba=new Map;return this.container.getMaterialItems(Y).then(ca=>{e.assertIsSome(ca);for(let da=0;da<S.length;da++){const fa=S[da];ba.set(fa.cim,{text:fa.text,mosaicItem:ca[da].mosaicItem})}return{symbol:R,textInfo:ba,hash:W}})}return{symbol:R,hash:W}}))}).catch(P=>{a.throwIfAbortError(P);return null}):null}async _projectAndNormalizeGeometry(I,
K){a.throwIfAborted(this._controller.signal);if(null==I.geometry||"mesh"===I.geometry.type)return null;var P=I.geometry;u.isPolygon(P)?P.rings=P.rings:u.isPolyline(P)?P.paths=P.paths:u.isExtent(P)&&(I=await this._getSymbolForGraphic(I,K),a.throwIfAborted(this._controller.signal),P=I&&(Z.isMarkerSymbol(I.type)||Z.isTextSymbol(I.type))?P.center:Z.polygonFromExtent(P));await z.checkProjectionSupport(P.spatialReference,this.view.spatialReference);I=w.normalizeCentralMeridianForDisplay(P);(P=z.project(I,
P.spatialReference,this.view.spatialReference))&&r.closeRingsAndFixWinding(P);return P}_onTileUpdate(I){const K=x.getInfo(this.view.spatialReference);if(I.added&&0<I.added.length)for(const P of I.added)this._addNewTile(P,K);if(I.removed&&0<I.removed.length)for(const P of I.removed)this._removeTile(P.key)}async _addGraphic(I){this._abortProcessingGraphic(I.uid);a.throwIfAborted(this._controller.signal);var K=new AbortController;this._graphicIdToAbortController.set(I.uid,K);K={signal:K.signal};try{await this._addOrUpdateGraphic(I,
K),a.throwIfAborted(this._controller.signal),this._graphicIdToAbortController.delete(I.uid)}catch(P){if(this._graphicIdToAbortController.delete(I.uid),!a.isAbortError(P))throw P;}}_updateGraphic(I,K){a.throwIfAborted(this._controller.signal);const P=this._projectAndNormalizeGeometry(I,K);K=this._getSymbolResources(I,K);return Promise.all([P,K]).then(([W,aa])=>{a.throwIfAborted(this._controller.signal);this._graphicStore.addOrModify(I,aa,W)})}_addOrUpdateGraphic(I,K){a.throwIfAborted(this._controller.signal);
const P=this._projectAndNormalizeGeometry(I,K);K=this._getSymbolResources(I,K);return Promise.all([P,K]).then(([W,aa])=>{a.throwIfAborted(this._controller.signal);this._graphicsSet.has(I)&&this._graphicStore.addOrModify(I,aa,W)})}_addTile(I){var K=this.view.featuresTilingScheme.getTileBounds(l.create(),I);const P=this.view.featuresTilingScheme.getTileResolution(I.level);K=new E.GraphicTile(I,P,K[0],K[3]);this._tiles.set(I,K);this.container.addChild(K);return K}async _addNewTile(I,K){const P=this._addTile(I.key),
W=this._graphicStore.queryTileData(this._templateStore,I);if(0!==W.length){if(K){K=Math.round((K.valid[1]-K.valid[0])/I.resolution);for(var aa of W)aa.geometry&&(u.isPoint(aa.geometry)||u.isMultipoint(aa.geometry))&&this._wrapPoints(aa,K)}aa=I.key;this._tileUpdateSet.add(I.key);this.notifyChange("updating");try{const R={type:"update",clear:!1,addOrUpdate:await this._processGraphics(I,W),remove:[],end:!0,sort:!1};P.patch(R);this._tileUpdateSet.delete(aa);this.notifyChange("updating")}catch(R){if(this._tileUpdateSet.delete(aa),
this.notifyChange("updating"),!a.isAbortError(R))throw R;}}}_removeTile(I){if(this._tiles.has(I)){var K=this._tiles.get(I);this.container.removeChild(K);K.destroy();this._tiles.delete(I)}}_setFilterState(I,K){const P=this._displayIds.get(I);I=this._attributeStore.getHighlightFlag(I);this._attributeStore.setData(P,0,0,I|(K?B.filterFlag0:0))}_getGraphicsData(I,K,P){const W=x.getInfo(this.view.spatialReference);I=this._graphicStore.getGraphicsData(I,K,P);if(W){K=Math.round((W.valid[1]-W.valid[0])/K.resolution);
for(const aa of I)aa.geometry&&(u.isPoint(aa.geometry)||u.isMultipoint(aa.geometry))&&this._wrapPoints(aa,K)}return I}_wrapPoints(I,K){const P=I.geometry;u.isMultipoint(P)?this._wrapMultipoint(P,K):this._wrapPoint(I,K)}_wrapMultipoint(I,K){var P=I.points;const W=[];let aa=0,R=0;for(const [S,Y]of P)W.push([S+aa,Y]),aa=0,K===Z.tileSize?(P=5*Z.pixelBuffer,S+R<P?(W.push([K,0]),aa=-K):S+R>Z.tileSize-P&&(W.push([-K,0]),aa=K)):S+R<-Z.pixelBuffer?(W.push([K,0]),aa=-K):S+R>Z.tileSize+Z.pixelBuffer&&(W.push([-K,
0]),aa=K),R+=S;I.points=W}_wrapPoint(I,K){const P=I.geometry;if(K===Z.tileSize){const W=5*Z.pixelBuffer;P.x<W?I.geometry={points:[[P.x,P.y],[K,0]]}:P.x>Z.tileSize-W&&(I.geometry={points:[[P.x,P.y],[-K,0]]})}else P.x<-Z.pixelBuffer?I.geometry={points:[[P.x,P.y],[K,0]]}:P.x>Z.tileSize+Z.pixelBuffer&&(I.geometry={points:[[P.x,P.y],[-K,0]]})}_processGraphics(I,K,P){if(!K||!K.length||!this._meshFactory)return Promise.resolve(null);const W=N.GraphicsReader.from(K,this.uid,I.transform),aa=this._meshFactory;
return this._matcher.then(R=>aa.analyzeGraphics(W,this.container.stage.resourceManager,R,null,null,P).then(()=>{this._attributeStore.sendUpdates();return this._processAnalyzedGraphics(I,W)}))}_processAnalyzedGraphics(I,K){const P=this._meshFactory;var W=K.getSize();K=K.getCursor();const aa=new A.MeshData(I.key.id,{features:W,records:W,metrics:0},y.WGLSymbologyType.DEFAULT,!1,!1);for(W=[];K.next();){const R=K.readGraphic();R.insertAfter=-1===R.insertAfter?-1:this._displayIds.get(R.insertAfter);R.displayId=
this._displayIds.get(R.attributes[this.uid]);const S=new C(R.displayId);S.insertAfter=R.insertAfter;W.push(S);P.writeGraphic(aa,K,I.level,this.container.stage.resourceManager)}I=aa.serialize(I.tileInfoView.tileInfo.isWrappable);return 1!==I.length?new F.TileData:F.TileData.fromVertexData(I[0].message,W)}_abortProcessingGraphic(I){this._graphicIdToAbortController.get(I)?.abort()}_getNullSymbol(I){I=I.geometry;return u.isPolyline(I)?t.errorPolylineSymbol2D:u.isPolygon(I)||u.isExtent(I)?t.errorPolygonSymbol2D:
this.defaultPointSymbolEnabled?t.errorPointSymbol2D:null}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer);this._updatingGraphicsTimer=setTimeout(()=>{this._updatingGraphicsTimer=null;this.notifyChange("updating")},160);this.notifyChange("updating")}};h.__decorate([c.property()],g.prototype,"_effectiveRenderer",null);h.__decorate([c.property({constructOnly:!0})],g.prototype,"requestUpdateCallback",void 0);h.__decorate([c.property()],g.prototype,"container",
void 0);h.__decorate([c.property({constructOnly:!0})],g.prototype,"graphics",void 0);h.__decorate([c.property()],g.prototype,"renderer",void 0);h.__decorate([c.property()],g.prototype,"updating",null);h.__decorate([c.property()],g.prototype,"view",void 0);h.__decorate([c.property()],g.prototype,"updateRequested",void 0);h.__decorate([c.property()],g.prototype,"defaultPointSymbolEnabled",void 0);return g=h.__decorate([d.subclass("esri.views.2d.layers.support.GraphicsView2D")],g)})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),
function(h,g,v,n,p,f,e,a){function b(q,t){if(null==q)return null;var B=q.spatialReference,y=a.getInfo(B);q=g.isSerializable(q)?q.toJSON():q;if(!y)return q;B=a.isWebMercator(B)?102100:4326;const E=e.cutParams[B].maxX,F=e.cutParams[B].minX;if(f.isPoint(q))return m(q,E,F);if(f.isMultipoint(q))q.points=q.points.map(C=>m(C,E,F));else{if(f.isExtent(q))return c(q,y);if(f.isPolygon(q)||f.isPolyline(q)){B=n.getBoundsXY(x,q);y=B[0];B=B[2];const C=2*e.offsetMagnitude(y,F)*E;q=0===C?q:e.updatePolyGeometry(q,
C);y+=C;B+=C;return B>E?u(q,E,t):y<F?u(q,F,t):q}}return q}function c(q,t){if(!t)return q;const B=d(q,t).map(y=>y.extent);return 2>B.length?B[0]||q:2<B.length?(q.xmin=t.valid[0],q.xmax=t.valid[1],q):{rings:B.map(y=>[[y.xmin,y.ymin],[y.xmin,y.ymax],[y.xmax,y.ymax],[y.xmax,y.ymin],[y.xmin,y.ymin]])}}function m(q,t,B){if(Array.isArray(q)){var y=q[0];y>t?(B=e.offsetMagnitude(y,t),q[0]=y+-2*B*t):y<B&&(t=e.offsetMagnitude(y,B),q[0]=y+-2*t*B)}else y=q.x,y>t?(B=e.offsetMagnitude(y,t),q.x+=-2*B*t):y<B&&(t=
e.offsetMagnitude(y,B),q.x+=-2*t*B);return q}function d(q,t){const B=[],{ymin:y,ymax:E,xmin:F,xmax:C}=q;var A=q.xmax-q.xmin;const [D,G]=t.valid,{x:J,frameId:M}=k(q.xmin,t),{x:L,frameId:Q}=k(q.xmax,t);q=J===L&&0<A;if(A>2*G){A={xmin:F<C?J:L,ymin:y,xmax:G,ymax:E};q={xmin:D,ymin:y,xmax:F<C?L:J,ymax:E};t={xmin:0,ymin:y,xmax:G,ymax:E};const N={xmin:D,ymin:y,xmax:0,ymax:E},U=[],Z=[];l(A,t)&&U.push(M);l(A,N)&&Z.push(M);l(q,t)&&U.push(Q);l(q,N)&&Z.push(Q);for(let H=M+1;H<Q;H++)U.push(H),Z.push(H);B.push(new w(A,
[M]),new w(q,[Q]),new w(t,U),new w(N,Z))}else J>L||q?B.push(new w({xmin:J,ymin:y,xmax:G,ymax:E},[M]),new w({xmin:D,ymin:y,xmax:L,ymax:E},[Q])):B.push(new w({xmin:J,ymin:y,xmax:L,ymax:E},[M]));return B}function k(q,t){const [B,y]=t.valid;t=2*y;var E=0;q>y?(E=Math.ceil(Math.abs(q-y)/t),q-=E*t):q<B&&(E=Math.ceil(Math.abs(q-B)/t),q+=E*t,E=-E);return{x:q,frameId:E}}function l(q,t){const {xmin:B,ymin:y,xmax:E,ymax:F}=t;return r(q,B,y)&&r(q,B,F)&&r(q,E,F)&&r(q,E,y)}function r(q,t,B){return t>=q.xmin&&t<=
q.xmax&&B>=q.ymin&&B<=q.ymax?!0:!1}function u(q,t,B=!0){const y=!f.isPolyline(q);y&&p.closeRings(q);if(B)return(new z).cut(q,t);B=y?q.rings:q.paths;const E=y?4:2,F=B.length;t*=-2;for(let C=0;C<F;C++){const A=B[C];if(A&&A.length>=E){const D=[];for(const G of A)D.push([G[0]+t,G[1]]);B.push(D)}}y?q.rings=B:q.paths=B;return q}class w{constructor(q,t){this.extent=q;this.frameIds=t}}const x=v.create();class z{constructor(){this._linesIn=[];this._linesOut=[]}cut(q,t){this._xCut=t;if(q.rings)this._closed=
!0,t=q.rings,this._minPts=4;else if(q.paths)this._closed=!1,t=q.paths,this._minPts=2;else return null;for(var B of t)if(B&&!(B.length<this._minPts)){t=!0;for(const y of B)t?(this.moveTo(y),t=!1):this.lineTo(y);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();t=[];for(const y of this._linesIn)y&&y.length>=this._minPts&&t.push(y);B=-2*this._xCut;for(const y of this._linesOut)if(y&&y.length>=this._minPts){for(const E of y)E[0]+=B;t.push(y)}this._closed?q.rings=t:q.paths=t;return q}moveTo(q){this._pushLineIn();
this._pushLineOut();this._prevSide=this._side(q[0]);this._moveTo(q[0],q[1],this._prevSide);this._firstPt=this._prevPt=q}lineTo(q){const t=this._side(q[0]);if(-1===t*this._prevSide){const B=this._intersect(this._prevPt,q);this._lineTo(this._xCut,B,0);this._prevSide=0}this._lineTo(q[0],q[1],t);this._prevSide=t;this._prevPt=q}close(){const q=this._firstPt,t=this._prevPt;q[0]===t[0]&&q[1]===t[1]||this.lineTo(q);this._checkClosingPt(this._lineIn);this._checkClosingPt(this._lineOut)}_moveTo(q,t,B){this._closed?
(this._lineIn.push([0>=B?q:this._xCut,t]),this._lineOut.push([0<=B?q:this._xCut,t])):(0>=B&&this._lineIn.push([q,t]),0<=B&&this._lineOut.push([q,t]))}_lineTo(q,t,B){this._closed?(this._addPolyVertex(this._lineIn,0>=B?q:this._xCut,t),this._addPolyVertex(this._lineOut,0<=B?q:this._xCut,t)):0>B?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([q,t])):0<B?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([q,t])):0>this._prevSide?(this._lineIn.push([q,t]),this._lineOut.push([q,t])):
0<this._prevSide&&(this._lineOut.push([q,t]),this._lineIn.push([q,t]))}_addPolyVertex(q,t,B){const y=q.length;1<y&&q[y-1][0]===t&&q[y-2][0]===t?q[y-1][1]=B:q.push([t,B])}_checkClosingPt(q){const t=q.length;3<t&&q[0][0]===this._xCut&&q[t-2][0]===this._xCut&&q[1][0]===this._xCut&&(q[0][1]=q[t-2][1],q.pop())}_side(q){return q<this._xCut?-1:q>this._xCut?1:0}_intersect(q,t){return q[1]+(this._xCut-q[0])/(t[0]-q[0])*(t[1]-q[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);
this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}h.CutVertical=z;h.normalizeCentralMeridianForDisplay=function(q){return b(q,!1)};h.normalizeCentralMeridianSync=function(q){return b(q,!0)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(h,g,v,n,p,f,e){function a(u,w){if(!w)return null;if("x"in w){var x={x:0,y:0};[x.x,x.y]=u(w.x,w.y,m);null!=w.z&&(x.z=w.z);null!=w.m&&(x.m=w.m);return x}return"xmin"in w?(x={xmin:0,ymin:0,xmax:0,ymax:0},[x.xmin,x.ymin]=u(w.xmin,w.ymin,m),[x.xmax,x.ymax]=u(w.xmax,w.ymax,m),w.hasZ&&(x.zmin=w.zmin,x.zmax=w.zmax,x.hasZ=!0),w.hasM&&(x.mmin=w.mmin,x.mmax=w.mmax,x.hasM=!0),x):"rings"in w?{rings:b(w.rings,u),hasM:w.hasM,hasZ:w.hasZ}:"paths"in w?{paths:b(w.paths,u),hasM:w.hasM,hasZ:w.hasZ}:"points"in
w?{points:c(w.points,u),hasM:w.hasM,hasZ:w.hasZ}:null}function b(u,w){const x=[];for(const z of u)x.push(c(z,w));return x}function c(u,w){const x=[];for(const z of u)u=w(z[0],z[1],[0,0]),x.push(u),2<z.length&&u.push(z[2]),3<z.length&&u.push(z[3]);return x}const m=[0,0],d=a.bind(null,e.lngLatToXY),k=a.bind(null,e.xyToLngLat);class l{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(u,w,x,z){if(!u?.length||!w||!x||f.equals(w,x))return u;u={geometries:u,inSpatialReference:w,
outSpatialReference:x,geographicTransformation:z,resolve:v.createResolver()};this._jobs.push(u);this._timer??(this._timer=setTimeout(this._process,10));return u.resolve.promise}_process(){this._timer=null;const u=this._jobs.shift();if(u){var {geometries:w,inSpatialReference:x,outSpatialReference:z,resolve:q,geographicTransformation:t}=u;e.canProject(x,z)?f.isWebMercator(z)?q(w.map(d)):q(w.map(k)):q(n.projectMany(p.jsonAdapter,w,x,z,t,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const r=new l;h.checkProjectionSupport=async function(u,w){u&&w&&(u=Array.isArray(u)?u.map(x=>null!=x.geometry?x.geometry.spatialReference:null).filter(g.isSome):[u],await n.initializeProjection(u.map(x=>({source:x,dest:w}))))};h.project=function(u,w,x,z){if(!u)return u;x||(x=w,w=u.spatialReference);return f.isValid(w)&&f.isValid(x)&&!f.equals(w,x)?e.canProject(w,x)?(u=f.isWebMercator(x)?d(u):k(u),u.spatialReference=x,u):n.projectMany(p.jsonAdapter,[u],w,x,null,z)[0]:u};h.projectMany=function(u,
w,x,z){return r.push(u,w,x,z)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(h){class g{constructor(e,a,b){this.x=e;this.y=a;this.spatialReference=b;this.m=this.z=void 0}}class v{constructor(e,a,b,c){this.rings=e;this.spatialReference=a;this.hasM=this.hasZ=void 0;b&&(this.hasZ=b);c&&(this.hasM=c)}}class n{constructor(e,a,b,c){this.paths=e;this.spatialReference=a;this.hasM=this.hasZ=void 0;b&&(this.hasZ=
b);c&&(this.hasM=c)}}class p{constructor(e,a,b,c){this.points=e;this.spatialReference=a;this.hasM=this.hasZ=void 0;b&&(this.hasZ=b);c&&(this.hasM=c)}}class f{constructor(e,a,b,c,m){this.xmin=e;this.ymin=a;this.xmax=b;this.ymax=c;this.spatialReference=m;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}h.jsonAdapter={convertToGEGeometry:function(e,a){return null==a?null:e.convertJSONToGeometry(a)},exportPoint:function(e,a,b){b=new g(e.getPointX(a),e.getPointY(a),b);const c=e.hasZ(a),m=e.hasM(a);c&&(b.z=
e.getPointZ(a));m&&(b.m=e.getPointM(a));return b},exportPolygon:function(e,a,b){return new v(e.exportPaths(a),b,e.hasZ(a),e.hasM(a))},exportPolyline:function(e,a,b){return new n(e.exportPaths(a),b,e.hasZ(a),e.hasM(a))},exportMultipoint:function(e,a,b){return new p(e.exportPoints(a),b,e.hasZ(a),e.hasM(a))},exportExtent:function(e,a,b){var c=e.hasZ(a);const m=e.hasM(a);b=new f(e.getXMin(a),e.getYMin(a),e.getXMax(a),e.getYMax(a),b);c&&(c=e.getZExtent(a),b.zmin=c.vmin,b.zmax=c.vmax);m&&(e=e.getMExtent(a),
b.mmin=e.vmin,b.mmax=e.vmax);return b}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GraphicTile":function(){define(["exports","./DirtyMap","./DisplayRecordStore","./WGLBuffers","./WGLTile"],function(h,g,v,n,p){class f extends p.WGLTile{constructor(){super(...arguments);this._displayList=this._data=null;this._lastCommitTime=0;this._invalidated=this._hasData=!1;this._wglBuffers=null;this._dirtyMap=new g}destroy(){super.destroy();this.clear()}get hasData(){return!!this._hasData}get displayObjects(){return this._displayObjects??
[]}getGeometry(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}getDisplayList(){return this._displayList}patch(e){if(!0===e.clear)this.clear(),this._hasData=!1;else{var a=e.addOrUpdate,b=e.remove;!this._data&&a?.tileDisplayData?.displayObjects.length?(a.tileDisplayData.computeDisplayList(),this._dirtyMap=new g,this._dispRecStore=v.fromTileData(a,this._dirtyMap),this._data=a,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data?a?.tileDisplayData?.displayObjects.length||
b.length?this._doPatchData(e):e.end&&this.ready():e.end&&this.ready();e.end&&!this._data&&this.clear();this.requestRender();this.emit("change")}}commit(e){if(!e.time||e.time!==this._lastCommitTime)if(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new n(e.context)),this._dirtyMap.hasDirty()||this._invalidated))this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),
this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean()}clear(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}_doPatchData(e){this._invalidated=!0;this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=v.fromTileData(this._data,this._dirtyMap));this.requestRender()}_patchData(e){let a=!0;var b=e.addOrUpdate?.tileDisplayData?.displayObjects||
[],c=(e.remove||[]).slice();for(var m of b)null!=m.insertAfter&&c.push(m.id);let d;0<c.length&&(d=new Set(c));m=this._data.tileDisplayData;for(var k of c)if(c=m.displayObjectRegistry.get(k)){m.displayList.removeFromList(c.displayRecords);for(var l of c.displayRecords)this._dispRecStore.delete(l);m.displayObjectRegistry.delete(k)}d?.size&&(m.displayObjects=m.displayObjects.filter(z=>!d.has(z.id)));for(const z of b){b=m.displayObjectRegistry.get(z.id);let q;if(b){k=b.displayRecords;b.set(z);b.displayRecords=
k;k=b.displayRecords.length;for(l=0;l<k;++l){c=b.displayRecords[l];var r=z.displayRecords[l];if(l>=z.displayRecords.length||c.geometryType!==r.geometryType||c.symbolLevel!==r.symbolLevel||c.zOrder!==r.zOrder||c.materialKey!==r.materialKey)this._dispRecStore.delete(b.displayRecords[l]),l<z.displayRecords.length&&(b.displayRecords[l]=void 0)}b.displayRecords.length=z.displayRecords.length}else if(b=z.copy(),b.displayRecords=[],m.displayObjectRegistry.set(z.id,b),k=m.displayObjects,null!=b.insertAfter?
(q={},0<=b.insertAfter?(l=m.displayObjectRegistry.get(b.insertAfter))?(r=k.indexOf(l)+1,r<k.length?k.splice(r,0,b):(k.push(b),r=k.length)):(k.push(b),r=k.length):(k.unshift(b),r=0)):(k.push(b),r=k.length),q)for(l=0<z.displayRecords.length?1:0,c=0,--r;0<=r&&c<l;--r)for(var u=k[r].displayRecords.length-1;0<=u&&c<l;--u){var w=k[r].displayRecords[u],x=m.displayList.getDPInfoType();q[x]||(q[x]=w,++c)}k=z.displayRecords.length;for(l=0;l<k;++l){c=z.displayRecords[l];(r=b.displayRecords[l])?(r.meshData=c.meshData,
r.materialKey=c.materialKey):(r=c.copy(),r.vertexFrom=void 0,r.indexFrom=void 0,b.displayRecords[l]=r);w=c.geometryType;u=m.displayList.getDPInfoType();x=e.addOrUpdate.tileBufferData.geometries[w];w=x.vertexBuffer;x=x.indexBuffer;let t=void 0;q&&(t=q[u]?m.displayList.splitAfter(q[u]):-1);a=this._dispRecStore.setMeshData(r,c,w,x,t)&&a;q&&null!=r.indexFrom&&null!=r.indexFrom&&(q[u]=r)}}return a}}h.GraphicTile=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(function(){class h{constructor(){this._dirties=
[{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1}]}hasDirty(){return this._dirties.some(g=>-1!==g.indexCount||g.allDirty)}markAllClean(){for(const g of this._dirties)g.indexFrom=-1,g.indexCount=-1,g.vertexFrom=
-1,g.vertexCount=-1,g.allDirty=!1}markAllDirty(){for(const g of this._dirties)g.allDirty=!0}forEach(g){for(let v=0;v<this._dirties.length;++v){const {indexCount:n,indexFrom:p,vertexCount:f,vertexFrom:e,allDirty:a}=this._dirties[v],b={};let c=void 0,m=!1;if(a||-1!==e&&0<f)b.geometry={count:f,from:e,allDirty:a},m=!0;if(a||-1!==p&&0<n)c={count:n,from:p,allDirty:a},m=!0;m&&g({indices:c,vertices:b},v)}}markDirtyIndices(g,v,n){g=this._dirties[g];if(!g.allDirty)if(-1!==g.indexCount){const p=Math.min(g.indexFrom,
v);v=Math.max(g.indexFrom+g.indexCount,v+n)-p;g.indexFrom=p;g.indexCount=v}else g.indexFrom=v,g.indexCount=n}markDirtyVertices(g,v,n,p){g=this._dirties[g];g.allDirty||(-1!==g.vertexCount?(v=Math.min(g.vertexFrom,n),n=Math.max(g.vertexFrom+g.vertexCount,n+p)-v,g.vertexFrom=v,g.vertexCount=n):(g.vertexFrom=n,g.vertexCount=p))}}return h})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["../../../../core/has","./FreeList","./Utils"],function(h,g,v){const n=["FILL","LINE","MARKER",
"TEXT","LABEL"];class p{constructor(f,e,a,b){this._strides=f;this._displayList=e;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=a;for(const c in f){this._freeListsAndStorage[c]={vtxFreeList:b?new g.FreeList(b):null,idxFreeList:b?new g.FreeList(b):null,vertexBuffers:{},indexBuffer:b?new Uint32Array(b):null};for(const m in f[c])this._freeListsAndStorage[c].vertexBuffers[m]={data:b?v.allocateTypedArrayBuffer(b,f[c][m]):null,stride:f[c][m]}}}static fromTileData(f,e){var a=f.getStrides(),
b={};for(var c=0;c<a.length;c++)b[n[c]]=a[c];a=[0,0,0,0,0];c=[0,0,0,0,0];for(var m of f.tileDisplayData.displayObjects)for(var d of m.displayRecords)a[d.geometryType]=Math.max(a[d.geometryType],d.vertexFrom+d.vertexCount),c[d.geometryType]=Math.max(c[d.geometryType],d.indexFrom+d.indexCount);e=new p(b,f.tileDisplayData.displayList,e,void 0);f=f.tileBufferData?.geometries??[];for(b=0;b<f.length;++b){m=a[b];var k=c[b],l=f[b];d=e._storageFor(n[b]);var r=f[b].indexBuffer;d.indexBuffer=r;d.idxFreeList=
new g.FreeList(r.length);d.idxFreeList.allocate(k);k=0;for(const u in l.vertexBuffer)l=f[b].vertexBuffer[u],d.vertexBuffers[u].data=l.data,d.vertexBuffers[u].stride=l.stride,r=v.strideToPackingFactor(l.stride),l=l.data.length*r/l.stride,k||(k=l);d.vtxFreeList=new g.FreeList(k);d.vtxFreeList.allocate(m)}return e}delete(f){const e=n[f.geometryType];this._freeVertices(e,f.vertexFrom,f.vertexCount);this._freeIndices(e,f.indexFrom,f.indexCount);this._displayList.removeFromList(f);f.vertexFrom=void 0;f.indexFrom=
void 0}setMeshData(f,e,a,b,c){const m=n[f.geometryType];f.meshData=null;let d=void 0,k=void 0;void 0===f.vertexFrom?(k=e.vertexCount,d=this._allocateVertices(m,k)):e.vertexCount>f.vertexCount?(this._freeVertices(m,f.vertexFrom,f.vertexCount),k=e.vertexCount,d=this._allocateVertices(m,k)):e.vertexCount===f.vertexCount?(d=f.vertexFrom,k=f.vertexCount):(this._freeVertices(m,f.vertexFrom+e.vertexCount,f.vertexCount-e.vertexCount),d=f.vertexFrom,k=e.vertexCount);let l=!0,r=void 0,u=void 0,w=void 0;void 0===
f.indexFrom?(r=c,w=e.indexCount,u=this._allocateIndices(m,w)):e.indexCount>f.indexCount?(r=this._displayList.removeFromList(f),this._freeIndices(m,f.indexFrom,f.indexCount),w=e.indexCount,u=this._allocateIndices(m,w)):e.indexCount===f.indexCount?(l=!1,u=f.indexFrom,w=f.indexCount):(r=this._displayList.removeFromList(f),this._freeIndices(m,f.indexFrom+e.indexCount,f.indexCount-e.indexCount),u=f.indexFrom,w=e.indexCount);if(-1!==d&&-1!==u){c=this._storageFor(m);v.copyMeshData(d,u,c.vertexBuffers,c.indexBuffer,
e,a,b);f.vertexFrom=d;f.indexFrom=u;f.vertexCount=e.vertexCount;f.indexCount=e.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(f.geometryType,f.indexFrom,f.indexCount);for(const x in a)this._dirtyMap.markDirtyVertices(f.geometryType,x,f.vertexFrom,f.vertexCount)}l&&this._displayList.addToList(f,r);return!0}-1!==d&&this._freeVertices(m,d,k);-1!==u&&this._freeIndices(m,u,w);f.setMeshDataFromBuffers(e,a,b);f.vertexFrom=void 0;f.vertexCount=0;f.indexFrom=void 0;f.indexCount=0;return!1}tryAddMeshData(f,
e){const a=e.vertexBuffer;e=e.indexBuffer;var b=n[f.geometryType];const c=this._allocateVertices(b,f.vertexCount);if(-1===c)return this._freeVertices(b,c,f.vertexCount),!1;const m=this._allocateIndices(b,f.indexCount);if(-1===m)return this._freeVertices(b,c,f.vertexCount),this._freeIndices(b,m,f.indexCount),!1;b=this._storageFor(b);v.copyMeshData(c,m,b.vertexBuffers,b.indexBuffer,f,a,e);f.vertexFrom=c;f.indexFrom=m;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(f.geometryType,f.indexFrom,f.indexCount);
for(const d in a)this._dirtyMap.markDirtyVertices(f.geometryType,d,c,f.vertexCount)}this._displayList.addToList(f);return!0}_allocateVertices(f,e){f=this._storageFor(f);e=f.vtxFreeList?.allocate(e);if(null==e||-1===e)return-1;f=f.vtxFreeList?.fragmentation;return null==f||.5<f?-1:e}_freeVertices(f,e,a){this._storageFor(f).vtxFreeList?.free(e,a)}_freeIndices(f,e,a){this._storageFor(f).idxFreeList?.free(e,a)}_allocateIndices(f,e){f=this._storageFor(f);e=f.idxFreeList?.allocate(e);if(null==e||-1===e)return-1;
f=f.idxFreeList?.fragmentation;return null==f||.5<f?-1:e}_storageFor(f){return this._freeListsAndStorage[f]}_stridesFor(f,e){return this._strides[f][e]}}return p})},"esri/views/2d/engine/webgl/FreeList":function(){define(["exports"],function(h){class g{get largestRange(){return this._largestRange}constructor(n){this._largestRange=null;this._parent=n;this._updateLargestRange()}rangeCreated(n){if(!this._largestRange||n.count>this._largestRange.count)this._largestRange=n}rangeResized(n,p){if(n===this._largestRange)n.count<
p&&this._updateLargestRange();else if(!this._largestRange||n.count>this._largestRange.count)this._largestRange=n}findBestRange(n){let p=this._parent._freeHead,f=null;for(;null!==p;)p.count>=n&&(!f||p.count-n<f.count-n)&&(f=p),p=p.next;return f}findAdjacentRanges(n,p){let f=!0,e=!1,a=null,b=this._parent._freeHead;for(;f&&!e;){const c=null!==b?b.from:this._parent._size;n>=(null!==a?a.from+a.count:0)&&n+p<=c?(f=!1,e=!0):null!==b?(a=b,b=b.next):f=!1}return[a,b]}_updateLargestRange(){let n=null,p=this._parent._freeHead;
for(;null!==p;){if(!n||p.count>n.count)n=p;p=p.next}this._largestRange=n}}class v{constructor(n,p){this._allocated=0;this._size=n;this._freeHead=0<n?{from:0,count:n,prev:null,next:null}:null;this._bookKeeper=p||new g(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(n){const p=this._bookKeeper.findBestRange(n);if(null==p)return-1;const f=p.from,e=p.count;p.from+=n;p.count-=n;this._bookKeeper.rangeResized(p,f,e);this._allocated+=n;0===p.count&&(n=null!==p.prev?this._freeHead:
p.next,v._removeRange(p),this._freeHead=n);return f}free(n,p){const [f,e]=this._bookKeeper.findAdjacentRanges(n,p);n={from:n,count:p,prev:f??null,next:e??null};null!=f&&(f.next=n);null!=e&&(e.prev=n);this._bookKeeper.rangeCreated(n);this._allocated-=p;if(null!=e&&n.from+n.count===e.from){p=n.from;var a=n.count;v._fuse(n,e);v._removeRange(e);this._bookKeeper.rangeResized(n,p,a);this._bookKeeper.rangeResized(e,void 0,0)}null!=f&&f.from+f.count===n.from&&(p=f.from,a=f.count,v._fuse(f,n),v._removeRange(n),
this._bookKeeper.rangeResized(f,p,a),this._bookKeeper.rangeResized(n,void 0,0));this._freeHead=null!==n.prev?this._freeHead:n}get fragmentation(){const n=this._size-this._allocated;return 0===n?0:1-this._bookKeeper.largestRange.count/n}static _removeRange(n){null!==n.prev?null!==n.next?(n.prev.next=n.next,n.next.prev=n.prev):n.prev.next=null:null!==n.next&&(n.next.prev=null)}static _fuse(n,p){n.count+=p.count;n.next=p.next;p.from+=p.count;p.count=0;null!==p.next&&(p.next.prev=n)}}h.FreeList=v;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["./Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(h,g,v,n){class p{constructor(f){this.geometryMap=h.createGeometryData(()=>({indexBuffer:g.BufferObject.createIndex(f,v.Usage.STATIC_DRAW),vao:null}),(e,a)=>({vertexBuffer:g.BufferObject.createVertex(f,h.cVboInfo[a])}))}dispose(){for(let f=0;5>f;f++){const e=this.geometryMap[f];if(e){e.data.vao?.disposeVAOOnly();
e.data.indexBuffer?.dispose();for(const a in e.buffers)e.buffers[a]?.data.vertexBuffer.dispose()}}}get(f){const e=this.geometryMap[f];return{getVAO(a,b,c){if(!e.data.vao){const m={};for(const d in e.buffers)m[d]=e.buffers[d].data.vertexBuffer;e.data.vao=new n.VertexArrayObject(a,c,b,m,e.data.indexBuffer)}return e.data.vao}}}has(f){return null!=this.geometryMap[f]}upload(f,e){e.forEach((a,b)=>{this._upload(a,b,f)})}_upload(f,e,a){f.indices&&(f.indices.allDirty?this._uploadIndices(a,e):null!=f.indices.from&&
null!=f.indices.count&&this._uploadIndices(a,e,f.indices.from,f.indices.count));if(f.vertices){f=f.vertices;for(const b in f){const c=f[b];c.allDirty?this._uploadVertices(a,e,b):null!=c.from&&null!=c.count&&this._uploadVertices(a,e,b,c.from,c.count)}}}_uploadVertices(f,e,a,b,c){const m=this.geometryMap[e];if(m&&(f=f.geometries[e].vertexBuffer[a])){var {data:d,stride:k}=f;m.buffers[a]&&0<d.length&&(f=k/d.BYTES_PER_ELEMENT,null!=b&&null!=c?m.buffers[a].data.vertexBuffer.setSubData(d,b*f,b*f,(b+c)*f):
m.buffers[a].data.vertexBuffer.setData(d))}}_uploadIndices(f,e,a,b){const c=this.geometryMap[e];c&&(f=f.geometries[e].indexBuffer,c.data.indexBuffer&&0<f.length&&(null!=a&&null!=b?c.data.indexBuffer.setSubData(f,a,a,a+b):c.data.indexBuffer.setData(f)))}}return p})},"esri/views/2d/engine/webgl/WGLTile":function(){define("exports ../../../../chunks/mat2d ../../../../chunks/mat2df32 ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./definitions ./TiledDisplayObject".split(" "),function(h,g,v,n,p,f,
e){class a{acquire(c){return{refCount:1,version:-1,labelMat2d:v.create(),tileMat3:p.create(),dvs:p.create()}}release(c){}}class b extends e.TiledDisplayObject{constructor(c,m,d,k){super(c,m,d,k,f.tileSize,f.tileSize)}destroy(){super.destroy();this._transforms&&b.TransformCache.release(this.key.hash)}setTransform(c){var m=this.resolution/c.resolution,d=this.transforms.tileMat3;const [k,l]=c.toScreenNoRotation([0,0],[this.x,this.y]);var r=this.width/this.rangeX*m;m*=this.height/this.rangeY;n.set(d,
r,0,0,0,m,0,k,l,1);n.multiply(this.transforms.dvs,c.displayViewMat3,d);d=this.transforms.labelMat2d;const u=window.devicePixelRatio;r=g.set(v.create(),r*u,0,0,m*u,k*u,l*u);g.multiply(d,c.viewMat2d,r)}_createTransforms(){return b.TransformCache.acquire(this.key.hash)}}b.TransformCache=new a;h.WGLTile=b;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],
function(h,g,v,n){class p extends v.DisplayObject{constructor(f,e,a,b,c,m,d=c,k=m){super();this.triangleCount=this.triangleCountReportedInDebug=0;this.texture=null;this.key=new n(f);this.resolution=e;this.x=a;this.y=b;this.width=c;this.height=m;this.rangeX=d;this.rangeY=k}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(f){const e=this.resolution/(f.resolution*f.pixelRatio),a=this.transforms.tileMat3,[b,c]=f.toScreenNoRotation([0,0],[this.x,this.y]);g.set(a,this.width/
this.rangeX*e,0,0,0,this.height/this.rangeY*e,0,b,c,1);g.multiply(this.transforms.dvs,f.displayViewMat3,a)}}h.TiledDisplayObject=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileData":function(){define("exports ../../../../core/arrayUtils ./enums ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./WGLDisplayRecord ./cpuMapped/DisplayRecordReader ./mesh/VertexBuffer ./mesh/VertexVector ./util/Writer".split(" "),function(h,g,v,n,p,f,e,a,
b,c,m,d){const k=new n,l=new n;class r{constructor(){this.tileBufferData=this.tileDisplayData=null}reshuffle(){k.reset();if(this.tileDisplayData){var u=[[],[],[],[],[]],w=this.tileDisplayData.displayObjects;for(var x of w)for(var z of x.displayRecords)u[z.geometryType].push(z);for(var q of u)for(var t of q)t&&k.needMore(t.geometryType,t.meshData?t.meshData.vertexCount:t.vertexCount,t.meshData?t.meshData.indexData.length:t.indexCount);w=u.length;x=new p;for(z=0;z<w;++z)if(x.geometries[z].indexBuffer=
new Uint32Array(Math.round(g.ReallocGrowthFactor*k.indicesFor(z))),t=[],q=this.tileBufferData?.geometries[z].vertexBuffer){for(var B in q)t.push(q[B].stride);t=r._computeVertexAlignment(t);var y=Math.round(g.ReallocGrowthFactor*k.verticesFor(z));t=r._align(y,t);for(var E in q)y=q[E].stride,x.geometries[z].vertexBuffer[E]={stride:y,data:e.allocateTypedArrayBuffer(t,y)}}l.reset();this.tileDisplayData.displayList?.clear();for(B=0;B<w;++B){E=u[B];for(const A of E){if(A.meshData)A.writeMeshDataToBuffers(l.verticesFor(B),
x.geometries[B].vertexBuffer,l.indicesFor(B),x.geometries[B].indexBuffer),A.meshData=null;else if(z=this.tileBufferData?.geometries[B]){E=z.vertexBuffer;z=z.indexBuffer;q=x.geometries[B].vertexBuffer;t=x.geometries[B].indexBuffer;y=l.verticesFor(B);const D=l.indicesFor(B);e.copyMeshData(y,D,q,t,A,E,z);A.vertexFrom=y;A.indexFrom=D}l.needMore(B,A.vertexCount,A.indexCount)}}var {displayList:F,displayObjects:C}=this.tileDisplayData;if(F)for(const A of C)F.addToList(A.displayRecords);this.tileBufferData=
x}}getStrides(){const u=[],w=this.tileBufferData?.geometries;if(!w)return u;for(let x=0;x<w.length;++x){const z=w[x];u[x]={};for(const q in z.vertexBuffer)u[x][q]=z.vertexBuffer[q].stride}return u}clone(){const u=new r;u.tileBufferData=this.tileBufferData?.clone()??null;u.tileDisplayData=this.tileDisplayData?.clone()??null;return u}_guessSize(){const u=this.tileDisplayData?.displayObjects??[],w=Math.min(u.length,4);let x=0;for(let z=0;z<w;z++)x=Math.max(x,u[z].displayRecords.length);return 2*(12*
u.length+u.length*x*40)}serialize(){const u=this.tileBufferData.serialize(),w=this.tileBufferData.getBuffers(),x=this.tileDisplayData.serialize(new d(Int32Array,this._guessSize())).buffer();w.push(x);return{result:{displayData:x,bufferData:u},transferList:w}}static fromVertexData(u,w){const x={},z=new Map;for(const q of w)z.set(q.id,q);e.forEachGeometryType(q=>{const t=u.data[q];if(null!=t){const y=b.DisplayRecordReader.from(t.records).getCursor();for(;y.next();){var B=y.id;const E=y.materialKey,
F=y.indexFrom,C=y.indexCount,A=y.vertexFrom,D=y.vertexCount,G=z.get(B);B=new a(B,q,E);B.indexFrom=F;B.indexCount=C;B.vertexFrom=A;B.vertexCount=D;G.displayRecords.push(B)}x[q]=c.VertexBuffers.fromVertexData(t,q)}else x[q]=(new m.VertexVectors(q,0,v.WGLSymbologyType.DEFAULT)).intoBuffers()});return r.fromMeshData({displayObjects:w,vertexBuffersMap:x})}static fromMeshData(u){const w=new r,x=new f,z=new p;x.displayObjects=u.displayObjects;for(const q in u.vertexBuffersMap){const t=q,B=u.vertexBuffersMap[t];
z.geometries[t].indexBuffer=B.indexBuffer;z.geometries[t].vertexBuffer=B.namedBuffers}w.tileDisplayData=x;w.tileBufferData=z;return w}static bind(u,w){const x=new r;x.tileDisplayData=u;x.tileBufferData=w;return x}static create(u,w){const x=new r;x.tileDisplayData=new f;x.tileDisplayData.displayObjects=u;const z=[0,0,0,0,0],q=[0,0,0,0,0],t=[[],[],[],[],[]];for(var B of u)for(var y of B.displayRecords)t[y.geometryType].push(y),z[y.geometryType]+=y.meshData.vertexCount,q[y.geometryType]+=y.meshData.indexData.length;
u=new p;w=[w.fill||{},w.line||{},w.icon||{},w.text||{},w.label||{}];for(B=0;5>B;B++){y=new Uint32Array(q[B]);var E=w[B],F=z[B];const C={};for(const A in E){const D={data:e.allocateTypedArrayBuffer(F,E[A]),stride:E[A]};C[A]=D}E=C;a.writeAllMeshDataToBuffers(t[B],E,y);u.geometries[B]={indexBuffer:y,vertexBuffer:E}}x.tileBufferData=u;return x}static _align(u,w){const x=u%w;return 0===x?u:u+(w-x)}static _computeVertexAlignment(u){let w=!1,x=!1;for(const z of u)2===z%4?w=!0:0!==z%4&&(x=!0);return x?4:
w?2:1}}h.TileData=r;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(function(){class h{constructor(){this._byGeometryType=null}get satisfied(){return!this._byGeometryType}reset(){this._byGeometryType=null}verticesFor(g){return this._byGeometryType?this._byGeometryType[g].vertices:0}indicesFor(g){return this._byGeometryType?this._byGeometryType[g].indices:0}needMore(g,v,n){if(v||n)this._byGeometryType||(this._byGeometryType=
[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),g=this._byGeometryType[g],g.vertices+=v,g.indices+=n}}return h})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["./Utils"],function(h){class g{constructor(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}clone(){const v=
new g;for(let n=0;n<this.geometries.length;n++){const p=this.geometries[n],f=v.geometries[n];f.indexBuffer=p.indexBuffer.slice();f.vertexBuffer={};for(const e in p.vertexBuffer){const {data:a,stride:b}=p.vertexBuffer[e];f.vertexBuffer[e]={data:a.slice(),stride:b}}}return v}static deserialize(v){const n=new g;for(let p=0;5>p;++p){n.geometries[p].indexBuffer=new Uint32Array(v.geometries[p].indexBuffer);n.geometries[p].vertexBuffer={};for(const f in v.geometries[p].vertexBuffer)n.geometries[p].vertexBuffer[f]=
{data:h.allocateTypedArrayBufferwithData(v.geometries[p].vertexBuffer[f].data,v.geometries[p].vertexBuffer[f].stride),stride:v.geometries[p].vertexBuffer[f].stride}}return n}serialize(){const v={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,
vertexBuffer:{}}]};for(let n=0;5>n;++n)for(const p in this.geometries[n].vertexBuffer)v.geometries[n].vertexBuffer[p]={data:this.geometries[n].vertexBuffer[p].data.buffer,stride:this.geometries[n].vertexBuffer[p].stride};return v}getBuffers(){const v=[];for(let n=0;5>n;++n){v.push(this.geometries[n].indexBuffer.buffer);for(const p in this.geometries[n].vertexBuffer)v.push(this.geometries[n].vertexBuffer[p].data.buffer)}return v}}return g})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["./GraphicDisplayList",
"./WGLDisplayObject","./util/serializationUtils"],function(h,g,v){class n{constructor(){this.displayObjects=[];this._displayList=null}get displayObjectRegistry(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const p of this.displayObjects)this._displayObjectRegistry.set(p.id,p)}return this._displayObjectRegistry}get displayList(){return this._displayList}computeDisplayList(){this._displayList=new h;for(const p of this.displayObjects)for(const f of p.displayRecords)this._displayList.addToList(f)}clone(){const p=
new n;this.displayObjects&&(p.displayObjects=this.displayObjects.map(f=>f.clone()));return p}serialize(p){v.serializeList(p,this.displayObjects);return p}_deserializeObjects(p){var f=p.readInt32();f=Array(f);const e=new Map;for(let a=0;a<f.length;++a){const b=g.deserialize(p);f[a]=b;e.set(b.id,b)}this.displayObjects=f;this._displayList=null;this._displayObjectRegistry=e}static deserialize(p){const f=new n;f._deserializeObjects(p);return f}}return n})},"esri/views/2d/engine/webgl/GraphicDisplayList":function(){define(["./materialKey/MaterialKey"],
function(h){function g(a,b,c,...m){b<a.length?a.splice(b,c,...m):a.push(...m)}class v{constructor(){this.symbolLevels=[]}replay(a,b,c){for(const k of this.symbolLevels)for(const l of k.zLevels){var m=l.geometryDPInfo.unified;if(m)for(const r of m){const {geometryType:u,materialKey:w,indexFrom:x,indexCount:z}=r;m=h.MaterialKeyBase.load(w).symbologyType;m=a.painter.getBrush(u,m);var d=b.getGeometry(u);d={geometryType:u,materialKey:w,indexFrom:x,indexCount:z,target:d};m.prepareState(a);m.drawGeometry(a,
b,d,c)}}}get empty(){return!this.symbolLevels||0===this.symbolLevels.length}clear(){this.symbolLevels.length=0}addToList(a,b){if(Array.isArray(a))for(const c of a)this._addToList(c,b);else this._addToList(a,b)}removeFromList(a){Array.isArray(a)||(a=[a]);let b=null;for(const c of a)b=this._removeFromList(c);return b}clone(){const a=new v;for(const b of this.symbolLevels)a.symbolLevels.push(b.clone());return a}splitAfter(a){const b=this._getDisplayList(a.symbolLevel,a.zOrder),c=b.length,m=a.indexFrom+
a.indexCount;for(let d=0;d<c;++d){const k=b[d];if(k.geometryType===a.geometryType&&m>k.indexFrom&&m<=k.indexFrom+k.indexCount)return m<k.indexFrom+k.indexCount&&(a=new n,a.geometryType=k.geometryType,a.materialKey=k.materialKey,a.indexFrom=m,a.indexCount=k.indexFrom+k.indexCount-m,b.splice(d+1,0,a),k.indexCount=m-k.indexFrom),d}}_addToList(a,b){const c=this._getDisplayList(a.symbolLevel,a.zOrder);b=null!=b?b:c.length-1;var m=0<=b&&b<c.length?c[b]:null;null!==m&&m.materialKey===a.materialKey&&m.indexFrom+
m.indexCount===a.indexFrom&&m.geometryType===a.geometryType?m.indexCount+=a.indexCount:(m=new n,m.indexFrom=a.indexFrom,m.indexCount=a.indexCount,m.materialKey=a.materialKey,m.geometryType=a.geometryType,g(c,b+1,0,m))}_removeFromList(a){const b=this._getDisplayList(a.symbolLevel,a.zOrder);var c=b.length;let m=void 0;for(var d=0;d<c;++d){var k=b[d];if(a.indexFrom+a.indexCount>k.indexFrom&&a.indexFrom<k.indexFrom+k.indexCount&&k.geometryType===a.geometryType){m=d;break}}if(void 0!==m){c=b[m];if(a.indexFrom===
c.indexFrom)return c.indexCount-=a.indexCount,c.indexFrom+=a.indexCount,0===c.indexCount&&g(b,m,1),m-1;if(a.indexFrom+a.indexCount===c.indexFrom+c.indexCount)return c.indexCount-=a.indexCount,0===c.indexCount?(g(b,m,1),m-1):m;d=c.indexFrom;k=a.indexFrom-c.indexFrom;const l=a.indexCount;a=c.indexFrom+c.indexCount-(a.indexFrom+a.indexCount);c.indexCount=k;const r=new n;r.geometryType=c.geometryType;r.materialKey=c.materialKey;r.indexFrom=d+k+l;r.indexCount=a;g(b,m+1,0,r);return m}return null}_getDisplayList(a,
b){let c;var m=this.symbolLevels.length;for(let k=0;k<m;k++)if(this.symbolLevels[k].symbolLevel===a){c=this.symbolLevels[k];break}c||(c=new e,c.symbolLevel=a,this.symbolLevels.push(c));let d;a=c.zLevels.length;for(m=0;m<a;m++)if(c.zLevels[m].zLevel===b){d=c.zLevels[m];break}d||(d=new f,d.geometryDPInfo=new p,d.zLevel=b,c.zLevels.push(d));d.geometryDPInfo.unified||(d.geometryDPInfo.unified=[]);return d.geometryDPInfo.unified}getDPInfoType(){return"unified"}}class n{constructor(){this.materialKey=null;
this.indexCount=this.indexFrom=0}clone(){const a=new n;a.geometryType=this.geometryType;a.materialKey=this.materialKey;a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;return a}}class p{constructor(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}clone(){const a=new p;a.fill=this.fill&&this.fill.map(b=>b.clone());a.line=this.line&&this.line.map(b=>b.clone());a.marker=this.marker&&this.marker.map(b=>b.clone());a.text=this.text&&this.text.map(b=>b.clone());a.label=this.label&&
this.label.map(b=>b.clone());a.unified=this.unified&&this.unified.map(b=>b.clone());return a}}class f{constructor(){this.geometryDPInfo=new p}clone(){const a=new f;a.zLevel=this.zLevel;a.geometryDPInfo=this.geometryDPInfo.clone();return a}}class e{constructor(){this.zLevels=[]}clone(){const a=new e;a.symbolLevel=this.symbolLevel;for(const b of this.zLevels)a.zLevels.push(b.clone());return a}}return v})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["./WGLDisplayRecord","./util/serializationUtils"],
function(h,g){class v{constructor(n){this.insertAfter=null;this.id=n;this.displayRecords=[]}copy(){const n=new v(this.id);n.set(this);return n}clone(){const n=new v(this.id);n.displayRecords=this.displayRecords.map(p=>p.clone());n.insertAfter=this.insertAfter;return n}set(n){this.id=n.id;this.displayRecords=n.displayRecords;this.insertAfter=n.insertAfter}serialize(n){n.push(this.id);g.serializeList(n,this.displayRecords);return n}static deserialize(n){const p=n.readInt32(),f=new v(p);f.displayRecords=
g.deserializeList(n,h,{id:p})??[];return f}}return v})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["./MeshData","./Utils"],function(h,g){class v{constructor(n,p,f,e=0,a=0){this.id=n;this.geometryType=p;this.materialKey=f;this.minZoom=e;this.maxZoom=a;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0;this._sortKey=null}get sortKey(){null==this._sortKey&&this._computeSortKey();return this._sortKey}clone(){return this.copy()}copy(){const n=
new v(this.id,this.geometryType,this.materialKey);n.vertexFrom=this.vertexFrom;n.vertexCount=this.vertexCount;n.indexFrom=this.indexFrom;n.indexCount=this.indexCount;n.zOrder=this.zOrder;n.symbolLevel=this.symbolLevel;n.meshData=this.meshData;n.minZoom=this.minZoom;n.maxZoom=this.maxZoom;return n}setMeshDataFromBuffers(n,p,f){const e=new h;for(const a in p){const b=p[a].stride,c=p[a].data;if(!c)continue;const m=[],d=g.strideToPackingFactor(b);for(let k=0;k<b*n.vertexCount/d;++k)m[k]=c[k+b*n.vertexFrom/
d];e.vertexData.set(a,m)}e.indexData.length=0;for(p=0;p<n.indexCount;++p)e.indexData[p]=f[p+n.indexFrom]-n.vertexFrom;e.vertexCount=n.vertexCount;this.meshData=e}readMeshDataFromBuffers(n,p){this.meshData?this.meshData.clear():this.meshData=new h;for(const f in n){const e=n[f].stride,a=n[f].data,b=[],c=g.strideToPackingFactor(e);for(let m=0;m<e*this.vertexCount/c;++m)b[m]=a[m+e*this.vertexFrom/c];this.meshData.vertexData.set(f,b)}this.meshData.indexData.length=0;for(n=0;n<this.indexCount;++n)this.meshData.indexData[n]=
p[n+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(n,p,f,e){if(this.meshData){for(const a in p){const b=p[a].stride,c=this.meshData.vertexData.get(a),m=p[a].data,d=g.strideToPackingFactor(b);for(let k=0;k<b*this.meshData.vertexCount/d;++k)m[k+b*n/d]=c[k]}for(p=0;p<this.meshData.indexData.length;++p)e[p+f]=this.meshData.indexData[p]+n;this.vertexFrom=n;this.vertexCount=this.meshData.vertexCount;this.indexFrom=f;this.indexCount=this.meshData.indexData.length}}static writeAllMeshDataToBuffers(n,
p,f){let e=0,a=0;for(const b of n)b.writeMeshDataToBuffers(e,p,a,f),e+=b.vertexCount,a+=b.indexCount}_computeSortKey(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7}serialize(n){n.push(this.geometryType);n.push(this.materialKey);n.push(this.vertexFrom);n.push(this.vertexCount);n.push(this.indexFrom);n.push(this.indexCount);n.push(this.minZoom);n.push(this.maxZoom);return n}static deserialize(n,p){const f=n.readInt32(),e=n.readInt32();p=new v(p.id,f,e);p.vertexFrom=
n.readInt32();p.vertexCount=n.readInt32();p.indexFrom=n.readInt32();p.indexCount=n.readInt32();p.minZoom=n.readInt32();p.maxZoom=n.readInt32();return p}}return v})},"esri/views/2d/engine/webgl/MeshData":function(){define(function(){class h{constructor(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}clear(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]}update(g,v,n){for(const p in g)this.vertexData.set(p,g[p]);for(const p in this.vertexData)null===g[p]&&this.vertexData.delete(p);
this.vertexCount=v;this.indexData=n}}return h})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(h){h.deserializeList=function(g,v,n){var p=g.readInt32();p=Array(p);for(let f=0;f<p.length;f++)p[f]=v.deserialize(g,n);return p};h.serializeList=function(g,v){if(null===v)g.push(0);else{g.push(v.length);for(const n of v)n.serialize(g);return g}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/DisplayRecordReader":function(){define(["exports",
"../definitions","../FeatureDisplayList"],function(h,g,v){class n{constructor(f){this._cursor=this._head=f}static from(f,e=0,a=f.byteLength/p.BYTES_PER_RECORD-e){f=new p(new Int32Array(f,e*p.BYTES_PER_RECORD,a*p.ELEMENTS_PER_RECORD));return new n(f)}size(){let f=this._cursor,e=0;for(;f;)e+=f.size(),f=f._link;return e}get id(){return this._cursor.id}set id(f){this._cursor.id=f}get materialKey(){return this._cursor.materialKey}set materialKey(f){this._cursor.materialKey=f}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(f){this._cursor.indexFrom=
f}get indexCount(){return this._cursor.indexCount}set indexCount(f){this._cursor.indexCount=f}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(f){this._cursor.vertexFrom=f}get vertexCount(){return this._cursor.vertexCount}set vertexCount(f){this._cursor.vertexCount=f}get sortKey(){return this._cursor.sortKey}set sortKey(f){this._cursor.sortKey=f}get index(){return this._cursor._indexStart+this._cursor._index}seekIndex(f){for(this._cursor=this._head;this._cursor;){const e=this._cursor.size();
if(f<e)return this._cursor._index=f,!0;f-=e;this._cursor=this._cursor._link}return!1}forEach(f){const e=this.getCursor();for(;e.next();)f(e)}link(f){if(this._head){for(var e=this._head;e._link;)e=e._link;e._link=f._head;e._link._indexStart=e._indexStart+e.size()}else this._head=f._head}getCursor(){return this.copy()}getDrawInfo(f,e){return new v.FeatureDisplayListInfo(f,e,this.materialKey,this.indexFrom,this.indexCount)}lookup(f){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(f);){if(!this._cursor._link)return!1;
this._cursor=this._cursor._link}return!!this._cursor}copy(){const f=new n(this._head?.copy());if(!f._head)return f;let e=f._head,a=f._head._link;for(;a;)e._link=a.copy(),e=a,a=e._link;return f}next(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;return this.next()}return!0}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}delete(f){let e=this._head,a=null;for(;e;){if(e.delete(f))return e.isEmpty()&&(null!=a&&(a._link=
e._link),e===this._head&&(this._head=e._link),e===this._cursor&&(this._cursor=e._link)),!0;a=e;e=e._link}return!1}}n.ELEMENTS_PER_RECORD=g.displayRecordIntPerElement;n.BYTES_PER_RECORD=n.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class p{constructor(f){this._link=null;this._index=-1;this._indexStart=0;this._packedRecordsF32=null;this._deletedCount=0;this._offsets={instance:null};this._packedRecords=f}static from(f,e=0,a=f.byteLength/this.BYTES_PER_RECORD-e){return new p(new Int32Array(f,e*this.BYTES_PER_RECORD,
a*this.ELEMENTS_PER_RECORD))}delete(f){const e=this._index,a=this.lookup(f);if(a)for(this.id=2147483647,++this._deletedCount;this.next()&&this.id===f;)this.id=2147483647,++this._deletedCount;this._index=e;return a}isEmpty(){return this._deletedCount===this.size()}link(f){this._link?this._link.link(f):this._link=f}lookup(f){if(null==this._offsets.instance){this._offsets.instance=new Map;var e=this.copy();e._index=-1;let a=0;for(;e.next();)e.id!==a&&(this._offsets.instance.set(e.id,e._index),a=e.id)}if(!this._offsets.instance.has(f))return!1;
e=this._index;this._index=this._offsets.instance.get(f);return 2147483647===this.id?(this._index=e,!1):!0}get id(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD]}set id(f){this._packedRecords[this._index*p.ELEMENTS_PER_RECORD]=f}get materialKey(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+1]}set materialKey(f){this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+1]=f}get insertAfter(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*
p.ELEMENTS_PER_RECORD+3]}set indexFrom(f){this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+3]=f}get indexCount(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+4]}set indexCount(f){this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+4]=f}get vertexFrom(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+5]}set vertexFrom(f){this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+5]=f}get vertexCount(){return this._packedRecords[this._index*p.ELEMENTS_PER_RECORD+6]}set vertexCount(f){this._packedRecords[this._index*
p.ELEMENTS_PER_RECORD+6]=f}get sortKey(){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer));return this._packedRecordsF32[this._index*p.ELEMENTS_PER_RECORD+7]}set sortKey(f){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer));this._packedRecordsF32[this._index*p.ELEMENTS_PER_RECORD+7]=f}get index(){return this._index}size(){return this._packedRecords.length/p.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&
2147483647===this.id;);return this._index<this.size()}peekId(){const f=(this._index+1)*p.ELEMENTS_PER_RECORD;return f>=this._packedRecords.length?0:this._packedRecords[f]}getCursor(){return this.copy()}copy(){const f=new p(this._packedRecords);f._indexStart=this._indexStart;f._link=this._link;f._index=this._index;f._offsets=this._offsets;f._deletedCount=this._deletedCount;return f}}p.ELEMENTS_PER_RECORD=g.displayRecordIntPerElement;p.BYTES_PER_RECORD=p.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;
h.DisplayRecordReader=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","./cpuMapped/FreeList"],function(h,g){class v{constructor(p,f,e,a,b){this.target=p;this.geometryType=f;this.materialKey=e;this.indexFrom=a;this.indexCount=b}get indexEnd(){return this.indexFrom+this.indexCount}extend(p){this.indexCount+=p}}class n{constructor(p,f){this.geometryType=0;this._target=p;this.geometryType=f}static from(p,f,
e,a){p=new n(p,f);if(null!=a)for(const b of a)e.seekIndex(b),p.addRecord(e);else for(;e.next();)p.addRecord(e);return p}addRecord(p){var f=this._target,e=this.geometryType,a=p.materialKey;let b=p.indexFrom,c=p.indexCount;const m=p.vertexFrom;p=p.vertexCount;c||(b=m,c=p);if(null==this._head)a=new v(f,e,a,b,c),this._head=new g.List(a);else{f=null;for(e=this._head;e;){if(b<e.data.indexFrom)return this._insert(a,b,c,f,e);f=e;e=e.next}this._insert(a,b,c,f,null)}}forEach(p){null!=this._head&&this._head.forEach(p)}*infos(){if(null!=
this._head)for(const p of this._head.values())yield p}_insert(p,f,e,a,b){if(null==a&&null==b){const c=new v(this._target,this.geometryType,p,f,e);this._head=new g.List(c)}if(null==a&&null!=b)return this._insertAtHead(p,f,e,b);if(null!=a&&null==b)return this._insertAtEnd(p,f,e,a);if(null!=a&&null!=b)return this._insertAtMiddle(p,f,e,a,b)}_insertAtHead(p,f,e,a){p===a.data.materialKey&&f+e===a.data.indexFrom?(a.data.indexFrom=f,a.data.indexCount+=e):(p=new v(this._target,this.geometryType,p,f,e),this._head=
new g.List(p),this._head.next=a)}_insertAtEnd(p,f,e,a){a.data.materialKey===p&&a.data.indexEnd===f?a.data.indexCount+=e:(p=new v(this._target,this.geometryType,p,f,e),p=new g.List(p),a.next=p)}_insertAtMiddle(p,f,e,a,b){a.data.materialKey===p&&a.data.indexEnd===f?(a.data.indexCount+=e,a.data.materialKey===b.data.materialKey&&a.data.indexEnd===b.data.indexFrom&&(a.data.indexCount+=b.data.indexCount,a.next=b.next)):p===b.data.materialKey&&f+e===b.data.indexFrom?(b.data.indexFrom=f,b.data.indexCount+=
e):(p=new v(this._target,this.geometryType,p,f,e),p=new g.List(p),a.next=p,p.next=b)}}h.FeatureDisplayList=n;h.FeatureDisplayListInfo=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["exports","../Utils"],function(h,g){class v{constructor(p,f){this.data=p;this.stride=f}static decode(p){const f=g.allocateTypedArrayBufferwithData(p.data,p.stride);return new v(f,p.stride)}static fromVertexVector(p){const f=g.allocateTypedArrayBufferwithData(p.data.buffer(),
p.stride);return new v(f,p.stride)}}class n{constructor(p,f,e){this.geometryType=p;this.indexBuffer=new Uint32Array(f);this.namedBuffers=e}static decode(p){const f=p.geometryType,e=p.indexBuffer,a={};for(const b in p.namedBuffers)a[b]=v.decode(p.namedBuffers[b]);return new n(f,e,a)}static fromVertexData(p,f){const e=p.indices,a=g.allocateTypedArrayBufferwithData(p.vertices,p.stride);p={geometry:new v(a,p.stride)};return new n(f,e,p)}static fromVertexVectors(p){const f=p.geometryType,e=p.indexVector.buffer(),
a={};let b;for(b in p.namedVectors)a[b]=v.fromVertexVector(p.namedVectors[b]);return new n(f,e,a)}}h.VertexBuffers=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["exports","../Utils","./VertexBuffer","../util/Writer"],function(h,g,v,n){class p{get vertexCount(){const e=this.data.length/(this.stride/4);e!==(e|0)&&console.debug("Corrupted stride");return e}constructor(e,a){this.data=e;this.stride=a}transfer(e,a){const b=
this.data.buffer();e.vertexCount=this.vertexCount;e.data=b;e.stride=this.stride;a.push(b)}}class f{constructor(e,a,b){this.geometryType=e;this.indexVector=new n(Uint32Array,6*a);this.namedVectors={};e=g.getStrides(e,b);for(const c in e){b=e[c];let m;switch(b%4){case 0:case 2:m=new n(Uint32Array,b*a);break;case 1:case 3:m=new n(Uint8Array,b*a)}this.namedVectors[c]=new p(m,b)}}get(e){return this.namedVectors[e].data}getVector(e){return this.namedVectors[e]}transfer(e,a){const b=this.indexVector.buffer(),
c={};a.push(b);let m;for(m in this.namedVectors){const d=this.namedVectors[m];c[m]={};d.transfer(c[m],a)}e.geometryType=this.geometryType;e.indexBuffer=b;e.namedBuffers=c;this.destroy()}intoBuffers(){const e=v.VertexBuffers.fromVertexVectors(this);this.destroy();return e}destroy(){this.namedVectors=this.indexVector=null}}h.VertexVector=p;h.VertexVectors=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class h{get length(){return this._pos}constructor(g,
v){this._pos=0;v=v?this._roundToNearest(v,g.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(v);this._buffer=new g(this._array);this._ctor=g;this._i16View=new Int16Array(this._array)}_roundToNearest(g,v){g=Math.round(g);return 1===v?g:g+(v-g%v)}_ensureSize(g){if(this._pos+g>=this._buffer.length){g=this._roundToNearest(1.25*(this._array.byteLength+g*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);g=new ArrayBuffer(g);const v=new this._ctor(g);v.set(this._buffer,0);this._array=g;this._buffer=
v;this._i16View=new Int16Array(this._array)}}ensureSize(g){this._ensureSize(g)}writeF32(g){this._ensureSize(1);const v=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=g;this._pos++;return v}push(g){this._ensureSize(1);const v=this._pos;this._buffer[this._pos++]=g;return v}writeFixed(g){this._buffer[this._pos++]=g}setValue(g,v){this._buffer[g]=v}i1616Add(g,v,n){this._i16View[2*g]+=v;this._i16View[2*g+1]+=n}getValue(g){return this._buffer[g]}incr(g){if(this._buffer.length<g)throw Error("Increment index overflows the target buffer");
this._buffer[g]++}decr(g){this._buffer[g]--}writeRegion(g){this._ensureSize(g.length);const v=this._pos;this._buffer.set(g,this._pos);this._pos+=g.length;return v}writeManyFrom(g,v,n){for(this._ensureSize(n-v);v!==n;v++)this.writeFixed(g._buffer[v])}buffer(){const g=this._array.slice(0,4*this._pos);this.destroy();return g}toArray(){return[...this._buffer]}seek(g){this._pos=g}destroy(){this._buffer=this._array=null}}return h})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define("exports ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ../DisplayId ../enums ../Utils ./VertexDataWriter ../../../layers/features/support/tileUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){function d(r){switch(r){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function k(r){switch(r){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class l{constructor(r,u,w,x,z,q=0){this.hasRecords=this._hasAggregate=!1;this._data={self:new Map,neighbors:[]};this._version=0;this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,
vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0};this.hint=u;this.tileKey=r;this._hasAggregate=x;this._pixelBufferEnabled=z;this._version=q;this._symbologyType=w}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(r){const u=[];u.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self));this._data.neighbors.forEach((w,x)=>{var z=1<<x;x=d(z);z=k(z);x=m.getPow2NeighborKey(new v(this.tileKey),x,
z,r);x=this._serializeTileVertexData(this.tileKey,x.id,w.vertexData);x.message.bufferIds=w.displayIds;u.push(x)});return u}_serializeTileVertexData(r,u,w){const x=[];w={[a.WGLGeometryType.MARKER]:w.get(a.WGLGeometryType.MARKER)?.serialize(x),[a.WGLGeometryType.FILL]:w.get(a.WGLGeometryType.FILL)?.serialize(x),[a.WGLGeometryType.LINE]:w.get(a.WGLGeometryType.LINE)?.serialize(x),[a.WGLGeometryType.TEXT]:w.get(a.WGLGeometryType.TEXT)?.serialize(x),[a.WGLGeometryType.LABEL]:w.get(a.WGLGeometryType.LABEL)?.serialize(x)};
return{message:{tileKeyOrigin:r,tileKey:u,data:w,version:this._version},transferList:x}}featureStart(r,u){this._current.insertAfter=r;this._current.sortKey=u}featureEnd(){}recordStart(r,u,w,x){this._current.writer=this._getVertexWriter(w);this._current.overlaps=0;this._current.indexStart=this._current.writer.indexCount;this._current.vertStart=this._current.writer.vertexCount;this._current.bufferingEnabled=x;this._current.id=r;this._current.materialKey=u;this._current.geometryType=w;this._current.isDotDensity=
!1;this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(r){this._current.writer.vertexEnsureSize(r)}indexEnsureSize(r){this._current.writer.indexEnsureSize(r)}vertexBounds(r,u,w,x){this._current.bufferingEnabled&&this._addOverlap(r,u,w,x)}vertexWrite(r){this._current.writer.writeVertex(r)}vertexWriteF32(r){this._current.writer.writeVertexF32(r)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(r){this._current.writer.writeIndex(r)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(r,
u,w,x,z,q,t,B){this._current.writer=this._getVertexWriter(a.WGLGeometryType.LABEL);const y=this._current.writer.metricWriter;y.push(e.getDisplayIdTexel(r));y.push(u);y.push(w);y.push(x);y.push(z);y.push(q);y.push(t);y.push(B);y.push(255);this._current.metricBoxLenPointer=y.push(0)}metricEnd(){const r=this._current.writer.metricWriter;0===r.getValue(this._current.metricBoxLenPointer)&&r.seek(r.length-10)}metricBoxWrite(r,u,w,x){const z=this._current.writer.metricWriter;z.incr(this._current.metricBoxLenPointer);
z.push(0);z.push(0);z.push(r);z.push(u);z.push(w);z.push(x)}recordEnd(){var r=this._current.vertStart,u=this._current.writer.vertexCount-r;if(!u)return!1;this.hasRecords=!0;var w=this._current.indexStart;this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,w,this._current.writer.indexCount-w,r,u,this._current.sortKey);if(!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===a.WGLGeometryType.LABEL)return!0;
r=this._current.writer;for(u=0;8>u;u++){var x=1<<u;if(this._current.overlaps&x){this._data.neighbors[u]||(this._data.neighbors[u]={vertexData:new Map,displayIds:new Set});w=this._data.neighbors[u];var z=this._current.geometryType;if(!w.vertexData.has(z)){var q=b.getStrides(z,this._symbologyType).geometry;q=new c.VertexDataWriter(z,q,f.patchPixelBufferAllocSize);w.vertexData.set(z,q)}z=w.vertexData.get(this._current.geometryType);q=4096*-d(x);x=4096*-k(x);z?.copyLastFrom(r,q,x);w.displayIds.add(this._current.id)}}return!0}_addOverlap(r,
u,w,x){this._current.overlaps|=255^((r<0+w?148:r>=f.tileSize-w?41:189)|(u<0+x?224:u>=f.tileSize-x?7:231))}_getVertexWriter(r){if(!this._data.self.has(r)){const u=this._data.self,w=b.getStrides(r,this._symbologyType).geometry;u.set(r,new c.VertexDataWriter(r,w,this.hint.records))}return this._data.self.get(r)}}h.MeshData=l;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(h){h.aggregateValidFiltersMask=254;
h.createDisplayId=function(g,v){return((v?8388608:0)|g)>>>0};h.displayIdTexelMask=8388607;h.displayIdTypeAggregate=1;h.displayIdTypeFeature=0;h.displayIdTypeMask=8388608;h.getDisplayIdFilterMask=g=>1===(g&8388608)>>>23?254:255;h.getDisplayIdTexel=g=>g&8388607;h.getDisplayIdType=g=>(g&8388608)>>>23;h.isAggregateId=function(g){return 1===(g&8388608)>>>23};h.nonAggregateValidFiltersMask=255;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports",
"../definitions","./heuristics","../util/Writer"],function(h,g,v,n){class p{constructor(f,e,a){this._start={index:0,vertex:0};a=v.getMeshSizeHint(f,e,a);e/=4;this.geometryType=f;this._records=new n(Int32Array,a.recordBytes);this._indices=new n(Uint32Array,a.indexBytes);this._vertices=new n(Uint32Array,a.vertexBytes);this._metrics=new n(Float32Array,0);this._strideInt=e}serialize(f){const e=this._records.buffer(),a=this._indices.buffer(),b=this._vertices.buffer(),c=this._metrics.length?this._metrics.buffer():
null,m=4*this._strideInt;f.push(e,a,b);return{stride:m,records:e,indices:a,vertices:b,metrics:c}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/g.displayRecordIntPerElement}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(f){this._vertices.ensureSize(f)}indexEnsureSize(f){this._indices.ensureSize(f)}recordStart(){this._start.index=
this._indices.length;this._start.vertex=this._vertices.length}recordEnd(f,e,a,b,c,m,d,k){this._records.push(f);this._records.push(e??0);this._records.push(a);this._records.push(b);this._records.push(c);this._records.push(m);this._records.push(d);this._records.writeF32(k)}writeIndex(f){this._indices.push(f)}writeVertex(f){this._vertices.push(f)}writeVertexF32(f){this._vertices.writeF32(f)}copyLastFrom(f,e,a){var b=f._records.length-g.displayRecordIntPerElement;const c=f._records.getValue(b),m=f._records.getValue(b+
1),d=f._records.getValue(b+2),k=f._records.getValue(b+4),l=f._records.getValue(b+6);b=f._records.getValue(b+7);const r=this._vertices.length;var u=(f._start.vertex-this._vertices.length)/this._strideInt;const w=this._indices.length,x=this.vertexCount;for(var z=f._start.index;z!==f._indices.length;z++){const q=f._indices.getValue(z);this._indices.push(q-u)}for(u=f._start.vertex;u!==f._vertices.length;u++)z=f._vertices.getValue(u),this._vertices.push(z);for(f=r;f<=this._vertices.length;f+=this._strideInt)this._vertices.i1616Add(f,
e,a);this._records.push(c);this._records.push(m);this._records.push(d);this._records.push(w);this._records.push(k);this._records.push(x);this._records.push(l);this._records.push(b)}}h.VertexDataWriter=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/heuristics":function(){define(["exports","../definitions","../enums"],function(h,g,v){const n=new Map;n.set(v.WGLGeometryType.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4});n.set(v.WGLGeometryType.LINE,
{multiplier:1,indicesPerRecord:24,verticesPerRecord:8});n.set(v.WGLGeometryType.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10});n.set(v.WGLGeometryType.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});n.set(v.WGLGeometryType.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});h.getMeshSizeHint=function(p,f,e){const {indicesPerRecord:a,multiplier:b,verticesPerRecord:c}=n.get(p);return{recordBytes:e*g.displayRecordIntPerElement*Uint32Array.BYTES_PER_ELEMENT,indexBytes:b*
a*e*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:b*c*e*f}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(h){h.getPow2NeighborKey=function(g,v,n,p){g=g.clone();const f=1<<g.level;v=g.col+v;n=g.row+n;p&&0>v?(g.col=v+f,--g.world):v>=f?(g.col=v-f,g.world+=1):g.col=v;g.row=n;return g};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("exports ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../../../geometry/libtess ../../DisplayId ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(h,g,v,n,p,f,e,a){class b{constructor(c,m,d){this._geometryType=c;this._idField=m;this._templateStore=d}update(c,m){null!=c.mesh.labels&&(this._labelTemplates=this._createLabelTemplates(c.mesh.labels,m));this._schema=c}_createLabelTemplates(c,m){const d=new Map;if("simple"===c.type){for(var k of c.classes)c=f.fromLabelClass(k,m),d.set(k.index,c);return d}for(const l in c.classes){k=c.classes[l];for(const r of k)k=f.fromLabelClass(r,m),d.set(r.index,k)}return d}get templates(){return this._templateStore}async analyze(c,
m,d,k,l,r,u){if(!v.isAborted(u)){var w;"dictionary"===d?.type&&(w=await d.analyze(this._idField,c.copy(),m,l,r,u));for(m=0;c.next();){var x=null;x=w?w[m++]:null!=k&&p.isAggregateId(c.getDisplayId())&&1!==c.readAttribute("cluster_count")?k.match(this._idField,c,this._geometryType,l,r):d.match(this._idField,c,this._geometryType,l,r);c.setGroupId(x);if(a.isDynamicId(x)){x=this._templateStore.getDynamicTemplateGroup(x).templates;for(const z of x)z&&z.analyze&&z.analyze(this._templateStore,c,l,r)}}await n.loadLibtess();
return this._templateStore.finalize(u)}}async analyzeGraphics(c,m,d,k,l,r){if(!v.isAborted(r)){c=c.getCursor();for(d&&await d.analyze(this._idField,c.copy(),m,k,l,r);c.next();){m=c.getGroupId();if(null==m||-1===m)m=d?.match(this._idField,c,c.geometryType,k,l),c.setGroupId(m);if(a.isDynamicId(m)){const u=this._templateStore.getDynamicTemplateGroup(m).templates;for(const w of u)w&&w.analyze&&w.analyze(this._templateStore,c,k,l)}c.setGroupId(m)}await n.loadLibtess();return this._templateStore.finalize(r)}}writeGraphic(c,
m,d,k){const l=m.getGroupId(),r=m.getDisplayId(),u=this._templateStore.getTemplateGroup(l);c.featureStart(m.insertAfter,0);if(null!=r){if(a.isDynamicId(l))for(const w of u.templates)w&&w.bindFeature(m,null,null);if(u){for(const w of u.templates)w&&w.write(c,m,d,k);c.featureEnd()}}}writeCursor(c,m,d,k,l,r,u){const w=m.getGroupId(),x=m.getDisplayId();var z=this._templateStore.getTemplateGroup(w);const q=z.templates;z=this._getSortKeyValue(m,z);c.featureStart(0,z);if(null!=x&&q){if(a.isDynamicId(w))for(const t of q)t.bindFeature(m,
d,k);for(const t of q)t.write(c,m,l,u);q.length&&null!=r&&(d=r&&this._findLabelRef(q),this._writeLabels(c,m,r,d,l,u));c.featureEnd()}}_getSortKeyValue(c,m){const d=this._schema.mesh.sortKey;if(null==d)return 0;let k=0;k=!0===d.byRenderer&&null!=m.sortKey?m.sortKey:null!=d.fieldIndex?c.getComputedNumericAtIndex(d.fieldIndex):null!=d.field?c.readAttribute(d.field):c.readAttribute(this._idField);k*="asc"===d.order?1:-1;return null==k||isNaN(k)?0:k}_findLabelRef(c){for(const m of c)if(m instanceof e)return m;
return null}_writeLabels(c,m,d,k,l,r){for(const u of d)if(null!=u&&u){const {glyphs:w,rtl:x,index:z}=u;if(d=this._labelTemplates.get(z))d.setZoomLevel(l),d.bindReferenceTemplate(k),d.bindTextInfo(w,x),d.write(c,m,null,r)}}}h.WGLMeshFactory=b;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(h,g,v,n){async function p(){e=await (n("esri-csp-restrictions")?await (new Promise((a,b)=>h(["../chunks/libtess-asm"],
a,b))).then(a=>a.libtessAsm):await (new Promise((a,b)=>h(["../chunks/libtess"],a,b))).then(a=>a.libtess)).load({locateFile:a=>v.getAssetUrl(`esri/core/libs/libtess/${a}`)})}let f=null,e=null;g.loadLibtess=async function(){f||(f=p());return f};g.triangulate=function(a,b){return e.triangulate(a,b,Math.max(a.length,128E3))};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./segmentUtils ./WGLTextTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r){const u=g.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),w=(q,t="mapview-labeling")=>u.error(new h(t,q)),x=function(q){const t=new Map;return B=>{t.has(B)||t.set(B,q(B));return t.get(B)}}(q=>{let t=0;if(0===q)return Infinity;for(;!(q%2);)t++,q/=2;return t});class z extends r{constructor(q,t,B,y){super(q,B.font?.size,B.haloSize||0,B.font?.size,B.color&&b.premultiplyAlphaRGBAArray(B.color)||0,B.haloColor&&b.premultiplyAlphaRGBAArray(B.haloColor)||0,
B.horizontalAlignment,B.verticalAlignment,a.isMapAligned(t.labelPlacement)?e.Alignment.MAP:e.Alignment.SCREEN,B.font?.decoration,!1,B.angle||0,B.xoffset,B.yoffset,B.lineWidth,B.lineHeight,null,null,!1,null,null,B.backgroundColor&&b.premultiplyAlphaRGBAArray(B.backgroundColor),B.borderLineColor&&b.premultiplyAlphaRGBAArray(B.borderLineColor),B.borderLineSize);this._zoomLevel=this._refOffsetY=this._refOffsetX=this._refPlacementDirY=this._refPlacementDirX=this._refPlacementPadding=this._outLineLabelAngle=
0;this.geometryType=m.WGLGeometryType.LABEL;this._allowOverrun=t.allowOverrun??!1;this._repeatLabel=t.repeatLabel??!0;this._labelPosition=t.labelPosition??"curved";var E=!!t.minScale&&y.scaleToZoom(t.minScale)||0;E=v.clamp(E,0,25.5);y=!!t.maxScale&&y.scaleToZoom(t.maxScale)||255;y=v.clamp(y,0,25.5);const [F,C]=a.getAlignmentFromPlacement(t.labelPlacement);this._xAlignD=F;this._yAlignD=C;this._minZoom=E;this._maxZoom=y;this._minBackgroundZoom=E;this._maxBackgroundZoom=y;this._refPlacementPadding=n.pt2px(B.haloSize)+
c.textPlacementPadding;this._repeatLabelDistance=t.repeatLabelDistance?n.pt2px(t.repeatLabelDistance):128;q=k.LabelMaterialKey.load(q);q.sdf=!0;this._materialKey=q.data}static fromLabelClass(q,t){if("esriServerLinePlacementCenterAlong"===q.labelPlacement){const B=q.symbol;B.xoffset=0;B.yoffset=0;B.angle=0;B.font.decoration="none"}return new z(q.materialKey,q,q.symbol,t)}get _shapedBox(){return this._shapingInfo.bounds}setZoomLevel(q){this._zoomLevel=q}bindReferenceTemplate(q){let t=a.getXDirection(this._xAlignD),
B=a.getYDirection(this._yAlignD);this._refOffsetY=this._refOffsetX=0;if(null==q)this._refSymbolAndPlacementOffset=d.i8888to32(0,0,Math.floor(127*t+127),Math.floor(127*B+127));else{if("circle"===q.boundsType&&(t||B)){var y=Math.sqrt(t*t+B*B);t/=y;B/=y}y=Math.max(q.height,q.width);this._refSymbolAndPlacementOffset=d.i8888to32(4*this._refPlacementPadding,y,Math.floor(127*t+127),Math.floor(127*B+127));this._referenceSize=y;this._refPlacementDirX=t;this._refPlacementDirY=B;this._refOffsetX=q.xOffset;this._refOffsetY=
q.yOffset}}_write(q,t){if(null!=this._shapingInfo){var B=this._shapingInfo,y=t.getDisplayId(),E="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(E)switch(this._current={out:q,inId:y,inShaping:B,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===t.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&u.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),
t.geometryType){case "esriGeometryPolyline":this._placeLineLabels(E);break;case "esriGeometryPoint":case "esriGeometryPolygon":this._placePointLabels(E);break;default:w(`Geometry of type ${t.geometryType} is not supported`)}}}_isVisible(q,t){const B=Math.floor(this._current.zoomLevel*c.minMaxZoomPrecisionFactor);return Math.floor(q*c.minMaxZoomPrecisionFactor)<=B&&B<=Math.floor(t*c.minMaxZoomPrecisionFactor)}_placePointLabels(q){const {out:t,inId:B,inShaping:y}=this._current;this._writeGlyphs(t,B,
q,y)}_placeLineLabels(q){q=l.smoothPaths(q.paths,this._current.inShaping.bounds.width);const t=this._placeSubdivGlyphs.bind(this),B=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const y of q)l.pathDivide(y,B,t,this._repeatLabel)}_placeSubdivGlyphs(q,t,B,y){var E=x(t),F=this._shapedBox.width/2,C=Math.sqrt(this._repeatLabelDistance)/2;B=Math.min(B,y-B);F=this._current.inShaping.isMultiline?25:Math.log2(B/(C+F/2));E=Math.max(this._minZoom,this._current.zoomLevel+1-(0===t?F:Math.min(E,F)));
F=this._current.zoomLevel-E;C=this._shapedBox.width/2*2**F;this._current.inShaping.isMultiline?0===t&&this._placeStraight(q,E):this._allowOverrun&&0>F?this._placeStraightAlong(q,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(q,E):"curved"===this._labelPosition&&this._placeCurved(q,E,C)}_placeStraight(q,t){const {out:B,inId:y,inShaping:E}=this._current,F=Math.ceil((180/Math.PI*q.angle+180)%360);this._outLineLabelAngle=Math.round(254/360*Math.ceil(180/Math.PI*q.angle%360));
this._writeGlyphs(B,y,q,E,t);this._outLineLabelAngle=Math.round(254/360*F);this._writeGlyphs(B,y,q,E,t)}_placeCurved(q,t,B){const {out:y,inId:E}=this._current;y.metricStart(E,t,q.x,q.y,0,0,0,0);const F=q.clone(),C=(180/Math.PI*q.angle+180)%360;this._outLineLabelAngle=Math.round(180/Math.PI*q.angle%360*(254/360));this._placeFirst(F,t,1);this._placeBack(q,F,t,B,1);this._placeForward(q,F,t,B,1);this._outLineLabelAngle=Math.round(254/360*C);this._placeFirst(F,t,0);this._placeBack(q,F,t,B,0);this._placeForward(q,
F,t,B,0);y.metricEnd()}_placeStraightAlong(q,t){const {out:B,inId:y,inShaping:E}=this._current;B.metricStart(y,t,q.x,q.y,0,0,0,0);const F=q.clone(),C=180/Math.PI*q.angle%360,A=(180/Math.PI*q.angle+180)%360;var D=0<E.glyphs.length&&(this._borderLineColor||this._backgroundColor);this._maxBackgroundZoom=25;this._minBackgroundZoom=Math.max(t,0);if(D){D=k.LabelMaterialKey.load(this._materialKey);D.textureBinding=E.glyphs[0].textureBinding;const G=p.fromRotation(f.create(),-q.angle),[J,M]=E.shapeBackground(G);
this._outLineLabelAngle=Math.round(254/360*C);B.recordStart(y,D.data,this.geometryType,!0);this._writeBackgroundGeometry(B,y,q,J,M);B.recordEnd();this._outLineLabelAngle=Math.round(254/360*A);B.recordStart(y,D.data,this.geometryType,!0);this._writeBackgroundGeometry(B,y,q,J,M);B.recordEnd()}this._outLineLabelAngle=Math.round(254/360*C);this._placeFirst(F,t,1,!0);this._outLineLabelAngle=Math.round(254/360*A);this._placeFirst(F,t,0,!0);B.metricEnd()}_placeBack(q,t,B,y,E){const F=q.clone();for(q=q.backwardLength+
0;F.prev()&&!(q>=y);)this._placeOnSegment(F,t,q,B,-1,E),q+=F.length+0}_placeForward(q,t,B,y,E){const F=q.clone();for(q=q.remainingLength+0;F.next()&&!(q>=y);)this._placeOnSegment(F,t,q,B,1,E),q+=F.length+0}_placeFirst(q,t,B,y=!1){const E=this._current.inShaping;var F=E.glyphs;const C=this._current.zoomLevel,{out:A,inId:D}=this._current;for(const G of F)F=G.x>E.bounds.x?B:1-B,F=Math.max(0,C+Math.log2(Math.abs(G.x+G.width/2-E.bounds.x)/(F*q.remainingLength+(1-F)*q.backwardLength))),F=Math.max(t,y?0:
F),G.maxZoom=25,G.angle=q.angle+(1-B)*Math.PI,G.minZoom=F,this._writeGlyph(A,D,q.x,q.y,G),B&&this._isVisible(G.minZoom,G.maxZoom)&&(F=G.bounds,A.metricBoxWrite(F.center[0],F.center[1],F.width,F.height))}_placeOnSegment(q,t,B,y,E,F){var C=this._current.inShaping.glyphs;const {out:A,inId:D}=this._current,G=this._current.inShaping,J=this._current.zoomLevel;var M=q.x+q.dx/q.length*-E*B,L=q.y+q.dy/q.length*-E*B;for(const N of C)if((C=N.x>G.bounds.x?F:1-F)&&1===E||!C&&-1===E){var Q=Math.abs(N.x+N.width/
2-G.bounds.x);C=Math.max(0,J+Math.log2(Q/B)-.1);Q=Math.max(y,J+Math.log2(Q/(B+q.length+0)));0!==C&&(N.angle=q.angle+(1-F)*Math.PI,N.minZoom=Q,N.maxZoom=C,this._writeGlyph(A,D,M,L,N),F&&this._isVisible(N.minZoom,N.maxZoom)&&(C=N.bounds,A.metricBoxWrite(C.center[0]+(q.x-t.x),C.center[1]+(q.y-t.y),C.width,C.height)))}}_writeGlyphs(q,t,B,y,E=this._minZoom){if(!(0>B.x||512<=B.x||0>B.y||512<=B.y)){if(0<y.glyphs.length&&(this._borderLineColor||this._backgroundColor)){var F=k.LabelMaterialKey.load(this._materialKey);
F.textureBinding=y.glyphs[0].textureBinding;q.recordStart(t,F.data,this.geometryType,!0);this._writeBackgroundGeometry(q,t,B,y.bounds,y.background);q.recordEnd()}F=B.x+this._refOffsetX;B=B.y-this._refOffsetY;for(const C of y.glyphs)C.minZoom=E,C.maxZoom=this._maxZoom,this._writeGlyph(q,t,F,B,C);y=y.boundsT;q.metricStart(t,E,F,B,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey);q.metricBoxWrite(y.center[0],y.center[1],y.width,y.height);q.metricEnd()}}_writeVertexCommon(q,
t,B,y){const E=this._color,F=this._haloColor,C=d.i8888to32(0,0,this._size,this._haloSize);y=d.i8888to32(Math.floor(Math.max(y.minZoom,this._minZoom)*c.minMaxZoomPrecisionFactor),Math.floor(Math.min(y.maxZoom,this._maxZoom)*c.minMaxZoomPrecisionFactor),this._outLineLabelAngle,0);q.vertexWrite(B);q.vertexWrite(t);q.vertexWrite(E);q.vertexWrite(F);q.vertexWrite(C);q.vertexWrite(this._refSymbolAndPlacementOffset);q.vertexWrite(y)}_writeBackgroundVertex(q,t,B,y,E,F){const C=d.i8888to32(0,0,this._size,
this._haloSize),A=d.i8888to32(0,0,0,0),D=d.i8888to32(Math.floor(this._minBackgroundZoom*c.minMaxZoomPrecisionFactor),Math.floor(this._maxBackgroundZoom*c.minMaxZoomPrecisionFactor),this._outLineLabelAngle,1);q.vertexWrite(B);q.vertexWrite(t);q.vertexWrite(y);q.vertexWrite(A);q.vertexWrite(C);q.vertexWrite(this._refSymbolAndPlacementOffset);q.vertexWrite(D);q.vertexWrite(E);q.vertexWrite(F);q.vertexEnd()}}return z})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports",
"./util"],function(h,g){function v(a){return a.length-1}function n(a){let b=0;for(let c=0;c<v(a);c++)b+=p(a,c);return b}function p(a,b,c=1){const [m,d]=a[b+1];return Math.sqrt(m*m+d*d)*c}function f(a,b,c,m,d){if(!(c<b)){var k=m.clone().seek(c/2);null!=k&&(a(k.clone(),c,d),c=(c-b)/2,k=k.seek(b/2),f(a,b,c,m,d+1),f(a,b,c,k,d+1))}}class e{constructor(a,b,c,m,d){this._segments=a;this._index=b;this._distance=c;this._xStart=m;this._yStart=d;this._done=!1}static create(a){return new e(a,0,0,a[0][0],a[0][1])}clone(){return new e(this._segments,
this._index,this._distance,this.xStart,this.yStart)}equals(a){return this._index===a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+1&&(1===this._distance||0===a._distance)}leq(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance}geq(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance}get _segment(){return this._segments[this._index+1]}get angle(){const a=this.dy;let b=Math.acos((0*a+-1*
-this.dx)/(1*this.length));0<a&&(b=2*Math.PI-b);return b}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:a,dy:b}=this;return Math.sqrt(a*
a+b*b)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=this._index-1}hasNext(){return this._index+1<v(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;
this._distance=1;return this}_seekBackwards(a,b){var c=this.backwardLength;if(a<=c)return this._distance=(c-a)/this.length,this;for(c=this.backwardLength;this.prev();){if(c+this.length>a)return this._seekBackwards(a-c);c+=this.length}this._distance=0;return b?this:null}seek(a,b=!1){if(0>a)return this._seekBackwards(Math.abs(a),b);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;let c=this.remainingLength;for(;this.next();){if(c+this.length>a)return this.seek(a-
c,b);c+=this.length}this._distance=1;return b?this:null}}h.SegmentCursor=e;h.pathDivide=function(a,b,c,m=!0){const d=n(a);a=e.create(a);const k=d/2;if(m){m=Math.floor(Math.max((d-b)/2,0)/b);a.seek(k-m*b);for(let l=-m;l<=m;l++)512>a.x&&0<=a.x&&512>a.y&&0<=a.y&&c(a.clone(),l,k+l*b,d),a.seek(b)}else a.seek(k),c(a.clone(),0,k+0*b,d)};h.pathLength=n;h.pathSubdivide=function(a,b,c){f(c,b,n(a),e.create(a),0)};h.segmentAt=function(a,b){return a[b+1]};h.segmentCount=v;h.segmentLength=p;h.smoothPaths=function(a,
b){for(let F=0;F<a.length;F++){let C=a[F];a:{var c=C,m=b;if(0>=m)break a;const A=c.length;if(3>A)break a;const D=[];var d=0;D.push(0);for(var k=1;k<A;k++)d+=g.dist(c[k],c[k-1]),D.push(d);m=Math.min(m,.2*d);d=[];d.push(c[0][0]);d.push(c[0][1]);k=c[A-1][0];const G=c[A-1][1];var l=g.sub([0,0],c[0],c[1]);g.normalize(l);c[0][0]+=m*l[0];c[0][1]+=m*l[1];g.sub(l,c[A-1],c[A-2]);g.normalize(l);c[A-1][0]+=m*l[0];c[A-1][1]+=m*l[1];for(l=1;l<A;l++)D[l]+=m;D[A-1]+=m;l=.5*m;for(let J=1;J<A-1;J++){let M=0,L=0,Q=
0;for(var r=J-1;0<=r&&!(D[r+1]<D[J]-l);r--){var u=l+D[r+1]-D[J],w=D[r+1]-D[r],x=D[J]-D[r]<l?1:u/w;if(1E-6>Math.abs(x))break;var z=x*x,q=x*u-.5*z*w,t=x*w/m,B=c[r+1],y=c[r][0]-B[0],E=c[r][1]-B[1];M+=t/q*(B[0]*x*u+.5*z*(u*y-w*B[0])-z*x*w*y/3);L+=t/q*(B[1]*x*u+.5*z*(u*E-w*B[1])-z*x*w*E/3);Q+=t}for(r=J+1;r<A&&!(D[r-1]>D[J]+l);r++){u=l-D[r-1]+D[J];w=D[r]-D[r-1];x=D[r]-D[J]<l?1:u/w;if(1E-6>Math.abs(x))break;z=x*x;q=x*u-.5*z*w;t=x*w/m;B=c[r-1];y=c[r][0]-B[0];E=c[r][1]-B[1];M+=t/q*(B[0]*x*u+.5*z*(u*y-w*B[0])-
z*x*w*y/3);L+=t/q*(B[1]*x*u+.5*z*(u*E-w*B[1])-z*x*w*E/3);Q+=t}d.push(M/Q);d.push(L/Q)}d.push(k);d.push(G);for(let J=0,M=0;J<A;J++)c[J][0]=d[M++],c[J][1]=d[M++]}c=[];c.push(C[0]);for(m=1;m<C.length;m++){const [A,D]=C[m-1],[G,J]=C[m];c.push([Math.round(G-A),Math.round(J-D)])}C=a[F]=c}return a};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["exports"],function(h){function g(v,n){return Math.sqrt(v*v+n*n)}h.defaultMaxZoom=
100;h.defaultMinZoom=0;h.dist=function(v,n){return g(v[0]-n[0],v[1]-n[1])};h.getLimitCosine=function(v=2){return 1/Math.max(v,1)};h.getMinMaxZoom=function(v,n){const p=!!v?.minScale&&n.scaleToZoom(v.minScale)||0;v=!!v?.maxScale&&n.scaleToZoom(v.maxScale)||100;return[p,v]};h.isExtent=function(v){return void 0!==v.xmin&&void 0!==v.ymin&&void 0!==v.xmax&&void 0!==v.ymax};h.isMultipoint=function(v){return void 0!==v.points};h.isPoint=function(v){return void 0!==v.x&&void 0!==v.y};h.isPolygon=function(v){return void 0!==
v.rings};h.isPolyline=function(v){return void 0!==v.paths};h.len=g;h.normalize=function(v){const n=g(v[0],v[1]);v[0]/=n;v[1]/=n};h.sub=function(v,n,p){v[0]=n[0]-p[0];v[1]=n[1]-p[1];return v};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("../../../../../../core/BidiText ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLMeshTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){class d extends c(m){constructor(k,l,r,u,w,x,z,q,t,B,y,E,F,C,A,D,G,J,M,L,Q,N,U,Z){super();this._xOffset=g.pt2px(F);this._yOffset=g.pt2px(C);this._decoration=B||"none";this._backgroundColor=N;this._borderLineColor=U;this._borderLineSize=Z;this._color=w;this._haloColor=x;this._haloSize=Math.min(Math.floor(5*g.pt2px(g.toPt(r))),127);this._size=Math.min(Math.round(g.pt2px(l)),127);l=Math.min(Math.round(g.pt2px(u||l)),127);this._referenceSize=Math.round(Math.sqrt(256*l));
this._scale=this._size/f.glyphSize;this._angle=E;this._justify=n.getJustification(z||"center");this._xAlignD=n.getXAnchorDirection(z||"center");this._yAlignD=n.getYAnchorDirection(q||"baseline");this._baseline="baseline"===(q||"baseline");this._bitset=(t===v.Alignment.MAP?1:0)|(y?1:0)<<1;k=a.MaterialKeyBase.load(k);k.sdf=!0;this._materialKey=k.data;this._lineWidth=g.pt2px(A)||512;this._lineHeight=D||1;this._textPlacement=G;this._effects=J;this._isCIM=M??!1;this._minMaxZoom=e.i1616to32(Math.round(L*
f.minMaxZoomPrecisionFactor),Math.round(Q*f.minMaxZoomPrecisionFactor))}static fromText(k,l){const r=k.font?.size,u=new d(k.materialKey,r,k.haloSize||0,r,k.color&&p.premultiplyAlphaRGBAArray(k.color)||0,k.haloColor&&p.premultiplyAlphaRGBAArray(k.haloColor)||0,k.horizontalAlignment,k.verticalAlignment,v.Alignment.SCREEN,k.font?.decoration,!1,k.angle||0,k.xoffset||0,k.yoffset||0,k.lineWidth||0,k.lineHeight||0,null,null,!1,b.defaultMinZoom,b.defaultMaxZoom,k.backgroundColor&&p.premultiplyAlphaRGBAArray(k.backgroundColor),
k.borderLineColor&&p.premultiplyAlphaRGBAArray(k.borderLineColor),k.borderLineSize),[,w]=h.bidiText(k.text);u.bindTextInfo(l??[],w);u._vertexBoundsScale=k.maxVVSize&&r?k.maxVVSize/r:1;return u}static fromCIMText(k,l,r){var u=k.scaleFactor||1;const w=k.size*k.sizeRatio*u,[x,z]=b.getMinMaxZoom(k.scaleInfo,r);r=new d(k.materialKey,w,k.outlineSize*k.sizeRatio,k.referenceSize,p.premultiplyAlphaRGBA(k.color),p.premultiplyAlphaRGBA(k.outlineColor),k.horizontalAlignment,k.verticalAlignment,k.alignment,k.decoration,
k.colorLocked??!1,k.angle,k.offsetX*k.sizeRatio*u,k.offsetY*k.sizeRatio*u,k.lineWidth||512,1,k.markerPlacement,k.effects,!0,x,z,k.backgroundColor?p.premultiplyAlphaRGBA(k.backgroundColor):void 0,k.borderLineColor?p.premultiplyAlphaRGBA(k.borderLineColor):void 0,k.borderLineWidth);[,u]=h.bidiText(k.text);r.bindTextInfo(l,u);r._vertexBoundsScale=k.maxVVSize?k.maxVVSize/w:1;return r}}return d})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./shapingUtils".split(" "),
function(h,g,v,n,p,f,e,a){const b=f.i1616to32(4,4),c=f.i1616to32(16,4),m=f.i1616to32(4,2),d=f.i1616to32(4,6),k=[m,m,d,d],l=[m,d,m,d],r=[d,d,b,b],u=[b,b,d,d],w=[d,b,d,b],x=[b,d,b,d];return z=>class extends z{constructor(...q){super(...q);this._isCIM=!1;this._vertexBoundsScale=1;this.geometryType=p.WGLGeometryType.TEXT;this._aux=f.i8888to32(0,0,this._referenceSize,this._bitset)}bindTextInfo(q,t){this._shapingInfo=q?.length?a.shapeGlyphs(q,t,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,
yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:n.magicLabelLineHeight*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize}):null}_write(q,t,B,y){const E=t.getDisplayId();this._writeGeometry(q,t,E,B,y)}_writeGeometry(q,t,B,y,E){const F=this._shapingInfo;if(null!=F){if(this._textPlacement)return this._writePlacedText(q,
B,F,y,t,E);t=E?E.asOptimized():"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(null!=t){if(t.isPoint){const [C,A]=t.coords;return!q.hasAggregates&&q.hasPixelBufferEnabled&&(0>C||512<=C||0>A||512<=A)?void 0:this._writeGlyphs(q,B,{x:C,y:A},F)}t.forEachVertex((C,A)=>this._writeGlyphs(q,B,{x:C,y:A},F))}}}_writePlacedText(q,t,B,y,E,F){var C=this._textPlacement;if(E=F||g.GeometryCursor.fromFeatureSetReaderCIM(E))if(y=v.CIMMarkerPlacementHelper.getPlacement(E,-1,C,h.pt2px(1),
q.tileKey,y.geometryEngine)){C=B.bounds;C=Math.sqrt(C.height*C.height+C.width*C.width);for(var A;A=y.next();)E=A.tx,F=-A.ty,0<=E+C&&512>E-C&&0<=F+C&&512>F-C&&(A=-A.getAngle(),B.setRotation(A),this._writeGlyphs(q,t,{x:E,y:F},B),B.setRotation(-A))}}_writeGlyphs(q,t,B,y){const E=e.MaterialKeyBase.load(this._materialKey),F=f.i1616to32(Math.round(8*B.x),Math.round(8*B.y)),C=this._vertexBoundsScale,{bounds:A,background:D,glyphs:G}=y;0<G.length&&(this._borderLineColor||this._backgroundColor)&&(E.textureBinding=
G[0].textureBinding,q.recordStart(t,E.data,this.geometryType,!0),this._writeBackgroundGeometry(q,t,B,A,D),q.recordEnd());const J=2*Math.max(A.width,A.height);for(const M of y.glyphs)E.textureBinding=M.textureBinding,q.recordStart(t,E.data,this.geometryType,!0),q.vertexBounds(B.x+A.x+this._xOffset,B.y+A.y-this._yOffset,J*C,J*C),this._writeVertices(q,t,F,M),q.recordEnd()}_writeGlyph(q,t,B,y,E){var F=e.MaterialKeyBase.load(this._materialKey);const C=f.i1616to32(Math.round(8*B),Math.round(8*y));F.textureBinding=
E.textureBinding;q.recordStart(t,F.data,this.geometryType,!0);F=E.bounds;const A=this._vertexBoundsScale;q.vertexBounds(B+F.x*A,y+F.y*A,F.width*A,F.height*A);this._writeVertices(q,t,C,E);q.recordEnd()}_writeVertices(q,t,B,y){const E=q.vertexCount();this._writeVertexCommon(q,t,B,y);q.vertexWrite(y.offsets.upperLeft);q.vertexWrite(y.texcoords.upperLeft);q.vertexEnd();this._writeVertexCommon(q,t,B,y);q.vertexWrite(y.offsets.upperRight);q.vertexWrite(y.texcoords.upperRight);q.vertexEnd();this._writeVertexCommon(q,
t,B,y);q.vertexWrite(y.offsets.lowerLeft);q.vertexWrite(y.texcoords.lowerLeft);q.vertexEnd();this._writeVertexCommon(q,t,B,y);q.vertexWrite(y.offsets.lowerRight);q.vertexWrite(y.texcoords.lowerRight);q.vertexEnd();q.indexWrite(E+0);q.indexWrite(E+1);q.indexWrite(E+2);q.indexWrite(E+1);q.indexWrite(E+3);q.indexWrite(E+2)}_writeVertexCommon(q,t,B,y){y=this._color;const E=this._haloColor,F=f.i8888to32(0,0,this._referenceSize,this._bitset),C=f.i8888to32(0,0,this._size,this._haloSize);q.vertexWrite(B);
q.vertexWrite(t);q.vertexWrite(y);q.vertexWrite(E);q.vertexWrite(C);q.vertexWrite(F);q.vertexWrite(this._minMaxZoom)}_writeBackgroundVertex(q,t,B,y,E,F){const C=f.i8888to32(0,1,this._referenceSize,this._bitset),A=f.i8888to32(0,0,this._size,this._haloSize),D=f.i8888to32(0,0,0,0);q.vertexWrite(B);q.vertexWrite(t);q.vertexWrite(y);q.vertexWrite(D);q.vertexWrite(A);q.vertexWrite(C);q.vertexWrite(this._minMaxZoom);q.vertexWrite(E);q.vertexWrite(F);q.vertexEnd()}_writeBackgroundQuad(q,t,B,y,E,F){const C=
q.vertexCount();this._writeBackgroundVertex(q,t,B,y,E.upperLeft,F[0]);this._writeBackgroundVertex(q,t,B,y,E.upperRight,F[1]);this._writeBackgroundVertex(q,t,B,y,E.lowerLeft,F[2]);this._writeBackgroundVertex(q,t,B,y,E.lowerRight,F[3]);q.indexWrite(C+0);q.indexWrite(C+1);q.indexWrite(C+2);q.indexWrite(C+1);q.indexWrite(C+3);q.indexWrite(C+2)}_writeBackgroundGeometry(q,t,B,y,E){const F=f.i1616to32(Math.round(8*B.x),Math.round(8*B.y)),{x:C,y:A,width:D,height:G}=y;y=2*Math.max(D,G);q.vertexBounds(B.x+
C+this._xOffset,B.y+A-this._yOffset,y*this._vertexBoundsScale,y*this._vertexBoundsScale);this._backgroundColor&&this._writeBackgroundQuad(q,t,F,this._backgroundColor,E.main,[c,c,c,c]);if(this._borderLineColor||this._backgroundColor){const [J,M,L,Q,N]=this._borderLineColor&&this._borderLineSize&&0<this._borderLineSize?[k,k,l,l,this._borderLineColor]:[r,u,w,x,this._backgroundColor];this._writeBackgroundQuad(q,t,F,N,E.top,J);this._writeBackgroundQuad(q,t,F,N,E.bot,M);this._writeBackgroundQuad(q,t,F,
N,E.left,L);this._writeBackgroundQuad(q,t,F,N,E.right,Q)}}}})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(h,g){class v{static getPlacement(n,p,f,e,a,b){const c=g.getPlacementOperator(f);if(!c)return null;-1===p&&n.invertY();return c.execute(n,f,e,a,b)}}h.CIMMarkerPlacementHelper=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["../../../../../../geometry/GeometryCursor",
"../../../../../../symbols/cim/effects/CIMEffectHelper"],function(h,g){class v{constructor(){this._materialKey=null}bindFeature(n,p,f){}write(n,p,f,e){if(this._effects&&0<this._effects.length){if(f=h.GeometryCursor.fromFeatureSetReaderCIM(p)){f.invertY();const a=g.CIMEffectHelper.executeEffects(this._effects,f,n.tileKey,e.geometryEngine);for(;f=a.next();)f.invertY(),this._write(n,p,e,f)}}else this._write(n,p,e)}_write(n,p,f,e){}}return v})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),
function(h,g,v,n,p,f){const e=96/72;class a{static executeEffects(b,c,m,d){const k=f.getEffectsInflateSize(b);c=new n.SimpleEffectCursor(c);for(const l of b)(b=p.getEffectOperator(l))&&(c=b.execute(c,l,e,m,d,k));return c}static applyEffects(b,c,m){if(!b)return c;var d=f.getEffectsInflateSize(b);c=new n.SimpleEffectCursor(g.GeometryCursor.fromJSONCIM(c));for(var k of b)(b=p.getEffectOperator(k))&&(c=b.execute(c,k,1,null,m,d));d=[];for(k=null;m=c.next();)d.push(...v.collectMultipath(m)),k=m.geometryType;
return 0===d.length||null===k?null:"esriGeometryPolygon"===k?{rings:d}:{paths:d}}}h.CIMEffectHelper=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d){class k extends m(d){constructor(l,r,u,w,x,z,q,t,B,y,E,F,C,A,D,G,J,M,L,Q,N,U,Z,H){super();this.angle=w;this.height=q;this.width=z;this.xOffset=r*L;this.yOffset=u*L;this._markerPlacement=Q||void 0;this._effects=N||void 0;this._anchorX=G;this._anchorY=J;this._minMaxZoom=a.i1616to32(Math.round(U*f.minMaxZoomPrecisionFactor),Math.round(Z*f.minMaxZoomPrecisionFactor));r=(A===n.Alignment.MAP?f.bitsetMarkerAlignmentMap:f.bitsetMarkerAlignmentScreen)|(E?f.bitsetGenericLockColor:
0)|(C?f.bitsetMarkerOutlineAllowColorOverride:0)|(F?f.bitsetMarkerScaleSymbolsProportionally:0);u=D&&D.sdf;l=b.MarkerMaterialKey.load(l);l.sdf=u;l.pattern=!0;l.textureBinding=D.textureBinding;this._materialKey=l.data;this._fillColor=x;this._outlineColor=B;this._sizeOutlineWidth=a.i8888to32(Math.round(Math.min(Math.sqrt(128*z),255)),Math.round(Math.min(Math.sqrt(128*q),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*t),255)));l.symbologyType===e.WGLSymbologyType.PIE_CHART?
(this._computedWidth=z*M*L,this._computedHeight=q*M*L,this._texUpperLeft=a.i1616to32(0,1),this._texUpperRight=a.i1616to32(1,1),this._texBottomLeft=a.i1616to32(0,0),this._texBottomRight=a.i1616to32(1,0)):this._computeSize(z,q,M,y,L,D,l.hasSizeVV(),H);this._bitestAndDistRatio=a.i1616to32(r,Math.round(64*M));x=v.create();z=g.create();this._applyTransformation(z,x)}static fromCIMMarker(l,r,u){const w=l.size,x=(r&&r.width||1)/(r&&r.height||1)*l.scaleX;var z=l.scaleSymbolsProportionally&&l.frameHeight?
w/l.frameHeight:1;const q=p.premultiplyAlphaRGBA(l.color),t=p.premultiplyAlphaRGBA(l.outlineColor),B=h.pt2px(w),y=B*x,E=h.pt2px(l.offsetX||0),F=h.pt2px(l.offsetY||0);z*=h.pt2px(l.outlineWidth||0);const C=l.alignment||n.Alignment.SCREEN,A=h.pt2px(l.referenceSize),[D,G]=c.getMinMaxZoom(l.scaleInfo,u);u=l.rotation||0;l.rotateClockwise||(u=-u);let J=0,M=0;const L=l.anchorPoint;L&&(l.isAbsoluteAnchorPoint?w&&(J=L.x/(w*x),M=L.y/w):(J=L.x,M=L.y));r=new k(l.materialKey,E,F,u,q,y,B,A,t,z,l.colorLocked,l.scaleSymbolsProportionally,
!1,C,r,J,M,l.sizeRatio,l.scaleFactor??1,l.markerPlacement,l.effects,D,G,!0);r._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/y:1;r._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/B:1;return r}static fromPictureMarker(l,r){const u=Math.round(h.pt2px(l.width)),w=Math.round(h.pt2px(l.height)),x=f.pictureFillColor,z=Math.round(h.pt2px(l.xoffset||0)),q=Math.round(h.pt2px(l.yoffset||0));r=new k(l.materialKey,z,q,l.angle,x,u,w,w,0,0,!1,!1,!1,n.Alignment.SCREEN,r,0,0,1,1,null,null,c.defaultMinZoom,c.defaultMaxZoom,
!1);r._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/l.width:1;r._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/l.height:1;return r}static fromSimpleMarker(l,r){const u=l.style,w=p.premultiplyAlphaRGBAArray(l.color),x=Math.round(h.pt2px(l.size));let z=x;"esriSMSTriangle"===u&&(z*=r.height/r.width);const q=Math.round(h.pt2px(l.xoffset||0)),t=Math.round(h.pt2px(l.yoffset||0));var B=l.outline;const y=(B?.color&&p.premultiplyAlphaRGBAArray(B.color))|0;B=(B?.width&&Math.round(h.pt2px(B.width)))|0;r=new k(l.materialKey,
q,t,l.angle??0,w,x,z,z,y,B,!1,!1,"esriSMSCross"===u||"esriSMSX"===u,n.Alignment.SCREEN,r,0,0,2,1,null,null,c.defaultMinZoom,c.defaultMaxZoom,!1);r.boundsType="esriSMSCircle"===u?"circle":"square";r._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/l.size:1;r._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/l.size:1;return r}static fromLineSymbolMarker(l,r){const u=p.premultiplyAlphaRGBAArray(l.color),w=Math.round(h.pt2px(6*l.lineWidth)),x="cross"===l.style||"x"===l.style;switch(l.placement){case "begin-end":var z=
n.ExtremityPlacement.Both;break;case "begin":z=n.ExtremityPlacement.JustBegin;break;case "end":z=n.ExtremityPlacement.JustEnd;break;default:z=n.ExtremityPlacement.None}z={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:z,offsetAlongLine:0};r=new k(l.materialKey,0,0,0,u,w,w,w/6,u,x?Math.round(h.pt2px(l.lineWidth)):0,!1,!1,x,n.Alignment.MAP,r,0,0,2,1,z,null,c.defaultMinZoom,c.defaultMaxZoom,!1);r.boundsType="circle"===l.style?"circle":"square";return r}}return k})},
"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey".split(" "),function(h,g,v,n,p,f,e,a,b,c,m){const d=3.14159265359/180;return k=>
class extends k{constructor(...l){super(...l);this.height=this.width=this.yOffset=this.xOffset=this.angle=0;this.boundsType="square";this._computedHeight=this._computedWidth=this._anchorY=this._anchorX=0;this._allowBorrowing=!0;this._vertexBoundsScaleY=this._vertexBoundsScaleX=1;this.geometryType=b.WGLGeometryType.MARKER}_write(l,r,u,w){const x=r.getDisplayId();l.recordStart(x,this._materialKey,this.geometryType,!0);this._writeGeometry(l,r,x,u,w);l.recordEnd()}_writeGeometry(l,r,u,w,x){if(null!=this._markerPlacement)return this._writePlacedMarkers(l,
r,w,x);this._allowBorrowing=!0;if(!x&&"esriGeometryPoint"===r.geometryType)return w=r.getX(),r=r.getY(),!l.hasAggregates&&l.hasPixelBufferEnabled&&(0>w||513<=w||0>r||513<=r)?void 0:this._writeVertices(l,u,this._getPos(w,r),w,r);r=x?x.asOptimized():"esriGeometryPolygon"===r.geometryType?r.readCentroid():r.readGeometryForDisplay();if(null!=r){if(r.isPoint){const [z,q]=r.coords;return!l.hasAggregates&&l.hasPixelBufferEnabled&&(0>z||512<=z||0>q||512<=q)?void 0:this._writeVertices(l,u,this._getPos(z,q),
z,q)}r.forEachVertex((z,q)=>{const t=2*a.tileSize;z<-t||z>=t||q<-t||q>=t||this._writeVertices(l,u,this._getPos(z,q),z,q)})}}_writePlacedMarkers(l,r,u,w){if(w=w||f.GeometryCursor.fromFeatureSetReaderCIM(r))if(u=e.CIMMarkerPlacementHelper.getPlacement(w,-1,this._markerPlacement,h.pt2px(1),l.tileKey,u.geometryEngine)){this._allowBorrowing="esriGeometryPolygon"!==r.geometryType;r=r.getDisplayId();w=p.create();for(var x=v.create(),z=u.next();null!=z;){const q=z.tx,t=-z.ty;-128<=q&&640>=q&&-128<=t&&640>=
t&&(this._applyTransformation(x,w,-z.getAngle()/d),this._writeVertices(l,r,this._getPos(q,t),q,t));z=u.next()}}}_writeVertices(l,r,u,w,x){const z=m.MarkerMaterialKey.load(this._materialKey);switch(z.symbologyType){case b.WGLSymbologyType.HEATMAP:return this._writeHeatmapVertices(l,r,u);default:return this._writeMarkerVertices(l,r,z,u,w,x)}}_writeMarkerVertices(l,r,u,w,x,z){var q=u.vvRotation;u=l.vertexCount();let t=this._computedWidth*this._vertexBoundsScaleX;var B=this._computedHeight*this._vertexBoundsScaleY;
this.angle&&(t=B=Math.max(t,B));q&&(q=Math.max(this.xOffset,this.yOffset),t+=q,B+=q);this._allowBorrowing&&l.vertexBounds(x+this.xOffset,z-this.yOffset,t,B);l.vertexWrite(w);l.vertexWrite(this._offsetUpperLeft);l.vertexWrite(this._texUpperLeft);l.vertexWrite(this._bitestAndDistRatio);l.vertexWrite(r);l.vertexWrite(this._fillColor);l.vertexWrite(this._outlineColor);l.vertexWrite(this._sizeOutlineWidth);l.vertexWrite(this._minMaxZoom);l.vertexEnd();l.vertexWrite(w);l.vertexWrite(this._offsetUpperRight);
l.vertexWrite(this._texUpperRight);l.vertexWrite(this._bitestAndDistRatio);l.vertexWrite(r);l.vertexWrite(this._fillColor);l.vertexWrite(this._outlineColor);l.vertexWrite(this._sizeOutlineWidth);l.vertexWrite(this._minMaxZoom);l.vertexEnd();l.vertexWrite(w);l.vertexWrite(this._offsetBottomLeft);l.vertexWrite(this._texBottomLeft);l.vertexWrite(this._bitestAndDistRatio);l.vertexWrite(r);l.vertexWrite(this._fillColor);l.vertexWrite(this._outlineColor);l.vertexWrite(this._sizeOutlineWidth);l.vertexWrite(this._minMaxZoom);
l.vertexEnd();l.vertexWrite(w);l.vertexWrite(this._offsetBottomRight);l.vertexWrite(this._texBottomRight);l.vertexWrite(this._bitestAndDistRatio);l.vertexWrite(r);l.vertexWrite(this._fillColor);l.vertexWrite(this._outlineColor);l.vertexWrite(this._sizeOutlineWidth);l.vertexWrite(this._minMaxZoom);l.vertexEnd();this._writeIndices(l,u)}_writeHeatmapVertices(l,r,u){const w=l.vertexCount();l.vertexWrite(u);l.vertexWrite(this._offsetUpperLeft);l.vertexWrite(r);l.vertexEnd();l.vertexWrite(u);l.vertexWrite(this._offsetUpperRight);
l.vertexWrite(r);l.vertexEnd();l.vertexWrite(u);l.vertexWrite(this._offsetBottomLeft);l.vertexWrite(r);l.vertexEnd();l.vertexWrite(u);l.vertexWrite(this._offsetBottomRight);l.vertexWrite(r);l.vertexEnd();this._writeIndices(l,w)}_writeIndices(l,r){l.indexWrite(r+0);l.indexWrite(r+1);l.indexWrite(r+2);l.indexWrite(r+1);l.indexWrite(r+3);l.indexWrite(r+2)}_applyTransformation(l,r,u=0){u?g.fromRotation(l,d*u):g.identity(l);g.translate(l,l,p.fromValues(this.xOffset,-this.yOffset));this.angle&&g.rotate(l,
l,d*this.angle);u=this._computedWidth;const w=this._computedHeight,x=-(.5+this._anchorX)*u,z=-(.5-this._anchorY)*w;n.set(r,x,z);n.transformMat2d(r,r,l);this._offsetUpperLeft=c.i1616to32(16*r[0],16*r[1]);n.set(r,x+u,z);n.transformMat2d(r,r,l);this._offsetUpperRight=c.i1616to32(16*r[0],16*r[1]);n.set(r,x,z+w);n.transformMat2d(r,r,l);this._offsetBottomLeft=c.i1616to32(16*r[0],16*r[1]);n.set(r,x+u,z+w);n.transformMat2d(r,r,l);this._offsetBottomRight=c.i1616to32(16*r[0],16*r[1])}_computeSize(l,r,u,w,x,
z,q,t){const B=l*u;u*=r;z.sdf&&!q?(w+=2,l=Math.min((t&&l>r?B:l)+w,B),r=Math.min(r+w,u)):(l=B,r=u);t=a.sdfTextureSize/Math.max(B,u);q=.5*(B-l)*t;var y=.5*(u-r)*t;t=z.rect.x+a.spritePadding+q;w=z.rect.y+a.spritePadding+y;q=t+z.width-2*q;z=w+z.height-2*y;y=Math.floor(t);const E=Math.floor(w),F=Math.ceil(q),C=Math.ceil(z);l*=(F-y)/(q-t);r*=(C-E)/(z-w);this._texUpperLeft=c.i1616to32(y,E);this._texUpperRight=c.i1616to32(F,E);this._texBottomLeft=c.i1616to32(y,C);this._texBottomRight=c.i1616to32(F,C);this._anchorX*=
B/l;this._anchorY*=u/r;this._computedWidth=l*x;this._computedHeight=r*x}_getPos(l,r){return c.i1616to32(Math.round(8*l),Math.round(8*r))}}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaultsJSON ../../enums ../../materialKey/MaterialKey ./WGLDynamicFillTemplate ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/Lock ../../util/Result ../../../../layers/features/textUtils ../../../../layers/support/cimSymbolUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x,z){function q(D,G){const J=D.length;D.push(null);G.then(M=>D[J]=M);return D}function t(D){return null!=D&&!!(D&1)}const B=v.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),y={sortKey:null,templates:[]};v={isOutline:!1,placement:null,symbologyType:f.WGLSymbologyType.DEFAULT,vvFlags:0};const E={...p.errorPointSymbolJSON,hash:JSON.stringify(p.errorPointSymbolJSON),materialKey:e.createMaterialKey(f.WGLGeometryType.MARKER,v)},F={...p.errorPolylineSymbolJSON,
hash:JSON.stringify(p.errorPolylineSymbolJSON),materialKey:e.createMaterialKey(f.WGLGeometryType.LINE,v)},C={...p.errorPolygonSymbolJSON,hash:JSON.stringify(p.errorPolygonSymbolJSON),materialKey:e.createMaterialKey(f.WGLGeometryType.FILL,v)};class A{constructor(D,G){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=new Map;this._cimAnalyses=[];this._lock=new u.Lock;this._fetchResource=
D;this._tileInfo=G}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(D,G,J=null){this._initErrorTemplates();const M=D.hash;var L=this._symbolToTemplate.get(M);if(null!=L)return L;L=[];J={sortKey:J,templates:L};G&&this._createMeshTemplates(L,G,!0);this._createMeshTemplates(L,D,!1);G=this._createGroupId;if(L="expanded-cim"===
D.type)a:{if(D.layers)for(const Q of D.layers)if("function"===typeof Q.materialHash){L=!0;break a}L=!1}D=G.call(this,L);this._idToTemplateGroup.set(D,J);this._symbolToTemplate.set(M,D);return D}getTemplateGroup(D){return this._idToTemplateGroup.get(D)??y}getDynamicTemplateGroup(D){if(!this._idToTemplateGroup.has(D))return y;t(D)||B.error("mapview-template-store",`Id ${D} does not refer to a dynamic template`);return this._idToTemplateGroup.get(D)}getMosaicItem(D,G){const J=this._createTemplateId(),
M=new Promise(L=>this._idToResolver.set(J,L));this._fetchQueue.push({symbol:D,id:J,glyphIds:G});return M}finalize(D){return this._fetchQueue.length||this._lock.isHeld()?u.withLock(this._lock,this._fetchAllQueuedResources.bind(this),D):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],C,!1),marker:this._createMeshTemplates([],E,!1),line:this._createMeshTemplates([],F,!1)})}_fetchAllQueuedResources(D){if(!this._fetchQueue.length)return Promise.resolve();
const G=this._fetchQueue,J=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return Promise.all(J).then(()=>this._fetchResource(G,D).then(M=>{for(const {id:L,mosaicItem:Q}of M)this._idToResolver.get(L)(Q),this._idToResolver.delete(L)})).catch(M=>{n.isAbortError(M)?this._fetchQueue=this._fetchQueue.concat(G):"worker:port-closed"!==M.name&&B.error(new g("mapview-template-store","Unable to fetch requested texture resources",M))})}_createGroupId(D){return this._idCounter++<<1|(D?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(D){const {spriteMosaicItem:G}=
await this.getMosaicItem(D);return w.ok(G,B)?l.fromSimpleMarker(D,G):this._markerError}async _createPMS(D){const {spriteMosaicItem:G}=await this.getMosaicItem(D);return w.ok(G,B)?l.fromPictureMarker(D,G):this._markerError}async _createSFS(D,G){const {spriteMosaicItem:J}=await this.getMosaicItem(D);return w.ok(J,B)?d.fromSimpleFill(D,J,G):this._fillError}async _createPFS(D,G){const {spriteMosaicItem:J}=await this.getMosaicItem(D);return w.ok(J,B)?d.fromPictureFill(D,J,G):this._fillError}async _createSLS(D,
G){({spriteMosaicItem:G}=await this.getMosaicItem(D));return w.ok(G,B)?k.fromSimpleLine(D,G):this._lineError}async _createLMS(D){const {spriteMosaicItem:G}=await this.getMosaicItem(D);return w.ok(G,B)?l.fromLineSymbolMarker(D,G):this._markerError}async _createTS(D){const {glyphMosaicItems:G}=await this.getMosaicItem(D);return r.fromText(D,G??[])}async _createCIMText(D){const {glyphMosaicItems:G}=await this.getMosaicItem(z.cimLayerToRasterizationInfo(D),x.codepoints(D.text));return w.ok(G,B)?r.fromCIMText(D,
G,this._tileInfo):this._textError}async _createCIMFill(D){const {spriteMosaicItem:G}=await this.getMosaicItem(z.cimLayerToRasterizationInfo(D));return w.ok(G,B)?d.fromCIMFill(D,G,this._tileInfo):this._fillError}async _createCIMLine(D){const {spriteMosaicItem:G}=await this.getMosaicItem(z.cimLayerToRasterizationInfo(D));return w.ok(G,B)?k.fromCIMLine(D,G,this._tileInfo):this._lineError}async _createCIMMarker(D){const {spriteMosaicItem:G}=await this.getMosaicItem(z.cimLayerToRasterizationInfo(D));return w.ok(G,
B)?l.fromCIMMarker(D,G,this._tileInfo):this._markerError}async _createCIM(D){const G=D.templateHash;let J=this._cimTemplateCache.get(G);if(null!=J)return J;switch(D.type){case "marker":J=await this._createCIMMarker(D);break;case "line":J=await this._createCIMLine(D);break;case "fill":J=await this._createCIMFill(D);break;case "text":J=await this._createCIMText(D)}this._cimTemplateCache.set(G,J);return J}async _createDynamicCIM(D){const G=D.templateHash;let J=this._cimTemplateCache.get(G);if(null!=
J)return J;switch(D.type){case "marker":J=c.fromCIMMarker(D,this._tileInfo);break;case "line":J=b.fromCIMLine(D,this._tileInfo);break;case "fill":J=a.fromCIMFill(D,this._tileInfo);break;case "text":J=m.fromCIMText(D,this._tileInfo)}this._cimTemplateCache.set(G,J);return J}_createPrimitiveMeshTemplates(D,G,J){switch(G.type){case "esriSMS":return q(D,this._createSMS(G));case "esriPMS":return q(D,this._createPMS(G));case "esriSFS":return q(D,this._createSFS(G,J));case "line-marker":return q(D,this._createLMS(G));
case "esriPFS":return q(D,this._createPFS(G,J));case "esriSLS":return q(D,this._createSLS(G,!1));case "esriTS":return q(D,this._createTS(G));default:return B.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),D}}_createMeshTemplates(D,G,J){if(G.type.includes("3d"))return B.error("3D symbols are not supported with MapView"),D;if("expanded-cim"===G.type){for(const M of G.layers)"function"===typeof M.materialHash?q(D,this._createDynamicCIM(M)):q(D,this._createCIM(M));
return D}if("composite-symbol"===G.type){for(const M of G.layers)this._createPrimitiveMeshTemplates(D,M,J);return D}return"cim"===G.type||"label"===G.type||"web-style"===G.type?D:this._createPrimitiveMeshTemplates(D,G,J)}}h.WGLTemplateStore=A;h.errorPointSchema2D=E;h.errorPolygonSchema2D=C;h.errorPolylineSchema2D=F;h.isDynamicId=t;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicFillTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){class d extends b(c){constructor(k,l,r){super(k);this._minMaxZoom=f.i1616to32(Math.round(l*n.minMaxZoomPrecisionFactor),Math.round(r*n.minMaxZoomPrecisionFactor));g.isFeatureValueFn(k.color)?this._dynamicPropertyMap.set("fillColor",(t,B,y)=>(t=k.color(t,B,y))&&v.premultiplyAlphaRGBA(t)||0):this.fillColor=(l=k.color)&&v.premultiplyAlphaRGBA(l)||0;const u="CIMMarkerPlacementInsidePolygon"===k.cim.placement?.type&&k.cim.placement.shiftOddRows?2:1,w=k.height;g.isFeatureValueFn(w)?
this._dynamicPropertyMap.set("_height",(t,B,y)=>w(t,B,y)*u):this._height=(w||0)*u;const x=k.offsetX;g.isFeatureValueFn(x)?this._dynamicPropertyMap.set("_offsetX",(t,B,y)=>h.pt2px(x(t,B,y))):this._offsetX=h.pt2px(x||0);const z=k.offsetY;g.isFeatureValueFn(z)?this._dynamicPropertyMap.set("_offsetY",(t,B,y)=>h.pt2px(-z(t,B,y))):this._offsetY=h.pt2px(-z||0);l=k.scaleX;g.isFeatureValueFn(l)?this._dynamicPropertyMap.set("_scaleX",l):this._scaleX=l||1;const q=k.angle;g.isFeatureValueFn(q)?this._dynamicPropertyMap.set("_angle",
(t,B,y)=>p.degToByte(q(t,B,y))):this._angle=p.degToByte(q)||0;null!=k.effects&&(l=k.effects,g.isFeatureValueFn(l)?this._dynamicPropertyMap.set("_effects",l):this._effects=l);this._cimFillLayer=k;this._bitset=(k.colorLocked?n.bitsetGenericLockColor:0)|(k.applyRandomOffset?n.bitsetFillRandomPatternOffset:0)|(k.sampleAlphaOnly?n.bitsetGenericConsiderAlphaOnly:0)|(k.hasUnresolvedReplacementColor?n.bitsetFillHasUnresolvedReplacementColor:0);this._fillMaterialKey=k.materialKey}static fromCIMFill(k,l){const [r,
u]=a.getMinMaxZoom(k.scaleInfo,l);return new d(k,r,u)}bindFeature(k,l,r){const u=k.readLegacyFeature();this._dynamicPropertyMap.forEach((z,q)=>{this[q]=z(u,l,r)});k=e.FillMaterialKey.load(this._fillMaterialKey);var w=this._materialCache,x=this._cimFillLayer.materialHash;x=x(u,l,r);x=w.get(x);w=null;x&&m.ok(x.spriteMosaicItem)&&(w=x.spriteMosaicItem);if(w){const {rect:z,width:q,height:t}=w;x=z.x+n.spritePadding;const B=z.y+n.spritePadding,y=x+q,E=B+t;let F=h.pt2px(this._height);0>=F&&(F=E-B);F<n.maxSizeForU16Compression&&
(F*=n.compressionFactorForU16,this._bitset|=n.bitsetFillHasPatternHeightPrecisionFactor);F=Math.round(F);let C=h.pt2px(this._height/t*q);0>=C&&(C=y-x);C<n.maxSizeForU16Compression&&(C*=n.compressionFactorForU16,this._bitset|=n.bitsetFillHasPatternWidthPrecisionFactor);C=Math.round(C);const A=this._scaleX;this.tl=f.i1616to32(x,B);this.br=f.i1616to32(y,E);this.aux21=f.i1616to32(C,F);this.aux22=f.i1616to32(this._offsetX,this._offsetY);this.aux3=f.i8888to32(A*n.compressionFactorForU16,1*n.compressionFactorForU16,
this._angle,0);k.sdf=w.sdf;k.pattern=!0;k.textureBinding=w.textureBinding}else this.aux3=this.aux22=this.aux21=this.br=this.tl=0,k.sdf=!1,k.pattern=!1,k.textureBinding=0;this._materialKey=k.data}}return d})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseFillTemplate":function(){define("../../enums ../../number ../../Utils ../../materialKey/MaterialKey ./templateUtils ./WGLLineTemplate".split(" "),function(h,g,v,n,p,f){return e=>class extends e{constructor(...a){super(...a);this.forceLibtess=!1;
this._bitset=0;this._lineTemplate=null;this.geometryType=h.WGLGeometryType.FILL}_maybeAddLineTemplate(a){this._lineTemplate=f.fromFillOutline(a)}_write(a,b,c,m){c="esriGeometryPoint"===b.geometryType;const d=n.FillMaterialKey.load(this._materialKey);a.recordStart(b.getDisplayId(),this._materialKey,this.geometryType,c);this._writeGeometry(a,b,d,m,c);n.hasOutlineFillSymbology(d)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(a,b,m,c);a.recordEnd()}_writeGeometry(a,b,c,m,d){m=this._getGeometry(b,
m,d);null!=m&&(d=[],100<m.maxLength||this.forceLibtess||!p.triangulate(d,m)?(m=p.triangulateLibtess(m),this._writeVertices(a,b,m,[m.length/2],c)):d.length&&this._writeVertices(a,b,m.coords,m.lengths,c,d))}_writeVertex(a,b,c,m,d,k){const l=g.i1616to32(1*m,1*d);a.vertexBounds(m,d,0,0);a.vertexWrite(l);a.vertexWrite(b);c.symbologyType===h.WGLSymbologyType.DOT_DENSITY?a.vertexWriteF32(1/Math.abs(k.readGeometryArea())):(a.vertexWrite(this.fillColor),b=n.hasSimpleSymbology(c),b||(a.vertexWrite(this.tl),
a.vertexWrite(this.br)),a.vertexWrite(this.aux21),a.vertexWrite(this.aux22),a.vertexWrite(this.aux3),b||a.vertexWrite(this._minMaxZoom))}_writeVertices(a,b,c,m,d,k){var l=b.getDisplayId();l|=this._bitset<<24;var r=m.reduce((w,x)=>w+x);const u=v.getStrides(d.geometryType,d.symbologyType).geometry/4;m=a.vertexCount();a.vertexEnsureSize(u*r);r=0;if(k)for(const w of k)this._writeVertex(a,l,d,c[2*w],c[2*w+1],b),r++;else for(k=0;k<c.length;k+=2)this._writeVertex(a,l,d,Math.round(c[k]),Math.round(c[k+1]),
b),r++;a.indexEnsureSize(r);for(b=0;b<r;b++)a.indexWrite(b+m)}_getGeometry(a,b,c){return(a=b?.asOptimized()||a.readGeometryForDisplay())?p.clipMarshall(a,c?256:8):null}}})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),function(h,g,v,n,p,f,e){function a(d,
k,l){let r=0;for(let u=1;u<l;u++)r+=(d[2*(k+u)]-d[2*(k+u-1)])*(d[2*(k+u)+1]+d[2*(k+u-1)+1]);return r}function b(d,k,l,r,u){let w=0;for(;l<r;l+=3){const x=2*(d[l]-u),z=2*(d[l+1]-u),q=2*(d[l+2]-u);w+=Math.abs((k[x]-k[q])*(k[z+1]-k[x+1])-(k[x]-k[z])*(k[q+1]-k[x+1]))}return w}const c=new n.TileClipper(0,0,0,1,0),m=new n.TileClipper(0,0,0,1,0);c.setExtent(f.tileSize);m.setExtent(f.tileSize);h.area=a;h.clipLinesMarshall=function(d,k){m.setPixelMargin(k);const l=-k;k=f.tileSize+k;let r=[];var u=!1;if(!d.nextPath())return null;
let w=!0;for(;w;){d.seekPathStart();const x=[];if(!d.pathSize)return null;m.reset(n.GeometryType.LineString);d.nextPoint();let z=d.x,q=d.y;if(u)m.moveTo(z,q);else{if(z<l||z>k||q<l||q>k){u=!0;continue}x.push({x:z,y:q})}let t=!1;for(;d.nextPoint();)if(z=d.x,q=d.y,u)m.lineTo(z,q);else{if(z<l||z>k||q<l||q>k){t=!0;break}x.push({x:z,y:q})}if(t)u=!0;else{if(u){if(u=m.resultWithStarts())for(const B of u)r.push(B)}else r.push({line:x,start:0});w=d.nextPath();u=!1}}r=r.filter(x=>1<x.line.length);return 0===
r.length?null:r};h.clipMarshall=function(d,k){if(null==d)return null;a:{var l=f.tileSize+128;var r=0;for(var u=0;u<d.lengths.length;u++){var w=d.lengths[u];for(var x=0;x<w;x++){const z=d.coords[2*(x+r)],q=d.coords[2*(x+r)+1];if(-128>z||z>l||-128>q||q>l){l=!0;break a}}r+=w}l=!1}if(!l)return d;c.setPixelMargin(k);c.reset(n.GeometryType.Polygon);k=0;for(l=0;l<d.lengths.length;l++){r=d.lengths[l];u=d.coords[2*(0+k)];w=d.coords[2*(0+k)+1];c.moveTo(u,w);for(x=1;x<r;x++)u=d.coords[2*(x+k)],w=d.coords[2*
(x+k)+1],c.lineTo(u,w);c.close();k+=r}l=c.result(!1);if(!l)return null;d=[];k=[];for(const z of l){l=0;for(const q of z)k.push(q.x),k.push(q.y),l++;d.push(l)}return new p(d,k)};h.triangleAreaArray=b;h.triangulate=function(d,k){const {coords:l,lengths:r,hasIndeterminateRingOrder:u}=k;if(u)return!1;k=0;for(var w=0;w<r.length;){let q=w,t=r[w];w=a(l,k,t);for(var x=[];++q<r.length;){var z=r[q];const B=a(l,k+t,z);if(!(0<B))break;w+=B;x.push(k+t);t+=z}z=d.length;e.bufcut(d,l,k,k+t,x,2,0);x=b(d,l,z,d.length,
0);w=Math.abs(w);if(1E-5<Math.abs((x-w)/Math.max(1E-7,w)))return d.length=0,!1;w=q;k+=t}return!0};h.triangulateEarcut=function(d,k,l){const {coords:r,lengths:u,hasIndeterminateRingOrder:w}=k;if(w)return!1;let x=0;for(var z=0;z<u.length;){let t=z,B=u[z];for(z=[];++t<u.length;){var q=u[t];if(!(0<a(r,x+B,q)))break;z.push(x+B-x);B+=q}q=k.coords.slice(2*x,2*(x+B));z=g.earcut(q,z,2);for(const y of z)d.push(y+l+x);z=t;x+=B}return!0};h.triangulateLibtess=function(d){const {coords:k,lengths:l}=d;({buffer:d}=
v.triangulate(k,l));return d};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(h,g){var v={exports:{}};v.exports;(function(n){(function(p){p=p();void 0!==p&&(n.exports=p)})(function(){function p(C,A,D){D=D||2;var G=A&&A.length,J=G?A[0]*D:C.length,M=f(C,0,J,D,!0),L=[];if(!M||M.next===M.prev)return L;var Q;if(G){var N=M;var U=D;M=[];var Z;G=0;for(Z=A.length;G<Z;G++){var H=A[G]*U;var O=G<Z-1?A[G+1]*U:C.length;
H=f(C,H,O,U,!1);H===H.next&&(H.steiner=!0);O=M;var T=O.push,V=H,X=H;do{if(V.x<X.x||V.x===X.x&&V.y<X.y)X=V;V=V.next}while(V!==H);T.call(O,X)}M.sort(c);for(G=0;G<M.length;G++)U=M[G],A=N,(N=d(U,A))?(Z=t(N,U),U=e(N,N.next),Z=m(Z),e(Z,Z.next),U=m(U),N=m(A===N?U:A)):N=A,N=e(N,N.next);M=N}if(C.length>80*D){var I=Q=C[0];var K=G=C[1];for(U=D;U<J;U+=D)A=C[U],N=C[U+1],A<I&&(I=A),N<K&&(K=N),A>Q&&(Q=A),N>G&&(G=N);Q=Math.max(Q-I,G-K);Q=0!==Q?1/Q:0}a(M,L,D,I,K,Q);return L}function f(C,A,D,G,J){if(J===0<F(C,A,D,
G))for(J=A;J<D;J+=G)var M=B(J,C[J],C[J+1],M);else for(J=D-G;J>=A;J-=G)M=B(J,C[J],C[J+1],M);M&&u(M,M.next)&&(C=M.next,y(M),M=C);return M}function e(C,A){if(!C)return C;A||(A=C);do{var D=!1;if(C.steiner||!u(C,C.next)&&0!==r(C.prev,C,C.next))C=C.next;else{A=C.prev;y(C);C=A;if(C===C.next)break;D=!0}}while(D||C!==A);return A}function a(C,A,D,G,J,M,L){if(C){if(!L&&M){var Q=C,N=Q;do null===N.z&&(N.z=k(N.x,N.y,G,J,M)),N.prevZ=N.prev,N=N.nextZ=N.next;while(N!==Q);N.prevZ.nextZ=null;N.prevZ=null;Q=N;var U,
Z,H,O,T=1;do{N=Q;var V=Q=null;for(Z=0;N;){Z++;var X=N;for(U=H=0;U<T&&(H++,X=X.nextZ,X);U++);for(O=T;0<H||0<O&&X;)0!==H&&(0===O||!X||N.z<=X.z)?(U=N,N=N.nextZ,H--):(U=X,X=X.nextZ,O--),V?V.nextZ=U:Q=U,U.prevZ=V,V=U;N=X}V.nextZ=null;T*=2}while(1<Z)}for(Q=C;C.prev!==C.next;){N=C.prev;X=C.next;if(M)V=b(C,G,J,M);else a:if(V=C,Z=V.prev,H=V,T=V.next,0<=r(Z,H,T))V=!1;else{for(U=V.next.next;U!==V.prev;){if(l(Z.x,Z.y,H.x,H.y,T.x,T.y,U.x,U.y)&&0<=r(U.prev,U,U.next)){V=!1;break a}U=U.next}V=!0}if(V)A.push(N.i/
D),A.push(C.i/D),A.push(X.i/D),y(C),Q=C=X.next;else if(C=X,C===Q){if(!L)a(e(C),A,D,G,J,M,1);else if(1===L){C=e(C);L=A;Q=D;N=C;do X=N.prev,V=N.next.next,!u(X,V)&&w(X,N,N.next,V)&&q(X,V)&&q(V,X)&&(L.push(X.i/Q),L.push(N.i/Q),L.push(V.i/Q),y(N),y(N.next),N=C=V),N=N.next;while(N!==C);C=e(N);a(C,A,D,G,J,M,2)}else if(2===L)a:{L=C;do{for(Q=L.next.next;Q!==L.prev;){if(N=L.i!==Q.i){V=V=V=V=void 0;N=L;X=Q;if(V=N.next.i!==X.i&&N.prev.i!==X.i){b:{V=N;do{if(V.i!==N.i&&V.next.i!==N.i&&V.i!==X.i&&V.next.i!==X.i&&
w(V,V.next,N,X)){V=!0;break b}V=V.next}while(V!==N);V=!1}V=!V}if(V){if(V=q(N,X)&&q(X,N)){V=N;Z=!1;H=(N.x+X.x)/2;T=(N.y+X.y)/2;do V.y>T!==V.next.y>T&&V.next.y!==V.y&&H<(V.next.x-V.x)*(T-V.y)/(V.next.y-V.y)+V.x&&(Z=!Z),V=V.next;while(V!==N);V=Z}V=V&&(r(N.prev,N,X.prev)||r(N,X.prev,X))||u(N,X)&&0<r(N.prev,N,N.next)&&0<r(X.prev,X,X.next)}N=V}if(N){C=t(L,Q);L=e(L,L.next);C=e(C,C.next);a(L,A,D,G,J,M);a(C,A,D,G,J,M);break a}Q=Q.next}L=L.next}while(L!==C)}break}}}}function b(C,A,D,G){var J=C.prev,M=C.next;
if(0<=r(J,C,M))return!1;var L=J.x>C.x?J.x>M.x?J.x:M.x:C.x>M.x?C.x:M.x,Q=J.y>C.y?J.y>M.y?J.y:M.y:C.y>M.y?C.y:M.y,N=k(J.x<C.x?J.x<M.x?J.x:M.x:C.x<M.x?C.x:M.x,J.y<C.y?J.y<M.y?J.y:M.y:C.y<M.y?C.y:M.y,A,D,G);A=k(L,Q,A,D,G);D=C.prevZ;for(G=C.nextZ;D&&D.z>=N&&G&&G.z<=A;){if(D!==C.prev&&D!==C.next&&l(J.x,J.y,C.x,C.y,M.x,M.y,D.x,D.y)&&0<=r(D.prev,D,D.next))return!1;D=D.prevZ;if(G!==C.prev&&G!==C.next&&l(J.x,J.y,C.x,C.y,M.x,M.y,G.x,G.y)&&0<=r(G.prev,G,G.next))return!1;G=G.nextZ}for(;D&&D.z>=N;){if(D!==C.prev&&
D!==C.next&&l(J.x,J.y,C.x,C.y,M.x,M.y,D.x,D.y)&&0<=r(D.prev,D,D.next))return!1;D=D.prevZ}for(;G&&G.z<=A;){if(G!==C.prev&&G!==C.next&&l(J.x,J.y,C.x,C.y,M.x,M.y,G.x,G.y)&&0<=r(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function c(C,A){return C.x-A.x}function m(C){if(C.next.prev===C)return C;let A=C;do{const D=A.next;if(D.prev===A||D===A||D===C)break;A=D}while(1);return A}function d(C,A){var D=A,G=C.x,J=C.y,M=-Infinity;do{if(J<=D.y&&J>=D.next.y&&D.next.y!==D.y){var L=D.x+(J-D.y)*(D.next.x-D.x)/(D.next.y-
D.y);if(L<=G&&L>M){M=L;if(L===G){if(J===D.y)return D;if(J===D.next.y)return D.next}var Q=D.x<D.next.x?D:D.next}}D=D.next}while(D!==A);if(!Q)return null;if(G===M)return Q;A=Q;L=Q.x;var N=Q.y,U=Infinity;D=Q;do{if(G>=D.x&&D.x>=L&&G!==D.x&&l(J<N?G:M,J,L,N,J<N?M:G,J,D.x,D.y)){var Z=Math.abs(J-D.y)/(G-D.x);var H;if((H=q(D,C))&&!(H=Z<U)&&(H=Z===U)&&!(H=D.x>Q.x)&&(H=D.x===Q.x)){H=Q;var O=D;H=0>r(H.prev,H,O.prev)&&0>r(O.next,H,H.next)}H&&(Q=D,U=Z)}D=D.next}while(D!==A);return Q}function k(C,A,D,G,J){C=32767*
(C-D)*J;A=32767*(A-G)*J;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;A=(A|A<<8)&16711935;A=(A|A<<4)&252645135;A=(A|A<<2)&858993459;return(C|C<<1)&1431655765|((A|A<<1)&1431655765)<<1}function l(C,A,D,G,J,M,L,Q){return 0<=(J-L)*(A-Q)-(C-L)*(M-Q)&&0<=(C-L)*(G-Q)-(D-L)*(A-Q)&&0<=(D-L)*(M-Q)-(J-L)*(G-Q)}function r(C,A,D){return(A.y-C.y)*(D.x-A.x)-(A.x-C.x)*(D.y-A.y)}function u(C,A){return C.x===A.x&&C.y===A.y}function w(C,A,D,G){var J=z(r(C,A,D)),M=z(r(C,A,G)),L=z(r(D,G,C)),Q=z(r(D,G,
A));return J!==M&&L!==Q||0===J&&x(C,D,A)||0===M&&x(C,G,A)||0===L&&x(D,C,G)||0===Q&&x(D,A,G)?!0:!1}function x(C,A,D){return A.x<=Math.max(C.x,D.x)&&A.x>=Math.min(C.x,D.x)&&A.y<=Math.max(C.y,D.y)&&A.y>=Math.min(C.y,D.y)}function z(C){return 0<C?1:0>C?-1:0}function q(C,A){return 0>r(C.prev,C,C.next)?0<=r(C,A,C.next)&&0<=r(C,C.prev,A):0>r(C,A,C.prev)||0>r(C,C.next,A)}function t(C,A){var D=new E(C.i,C.x,C.y),G=new E(A.i,A.x,A.y),J=C.next,M=A.prev;C.next=A;A.prev=C;D.next=J;J.prev=D;G.next=D;D.prev=G;M.next=
G;G.prev=M;return G}function B(C,A,D,G){C=new E(C,A,D);G?(C.next=G.next,C.prev=G,G.next.prev=C,G.next=C):(C.prev=C,C.next=C);return C}function y(C){C.next.prev=C.prev;C.prev.next=C.next;C.prevZ&&(C.prevZ.nextZ=C.nextZ);C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function E(C,A,D){this.i=C;this.x=A;this.y=D;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function F(C,A,D,G){for(var J=0,M=D-G;A<D;A+=G)J+=(C[M]-C[A])*(C[A+1]+C[M+1]),M=A;return J}p.deviation=function(C,A,D,G){var J=A&&A.length,
M=Math.abs(F(C,0,J?A[0]*D:C.length,D));if(J){J=0;for(var L=A.length;J<L;J++)M-=Math.abs(F(C,A[J]*D,J<L-1?A[J+1]*D:C.length,D))}for(J=A=0;J<G.length;J+=3){L=G[J]*D;var Q=G[J+1]*D,N=G[J+2]*D;A+=Math.abs((C[L]-C[N])*(C[Q+1]-C[L+1])-(C[L]-C[Q])*(C[N+1]-C[L+1]))}return 0===M&&0===A?0:Math.abs((A-M)/M)};p.flatten=function(C){for(var A=C[0][0].length,D={vertices:[],holes:[],dimensions:A},G=0,J=0;J<C.length;J++){for(var M=0;M<C[J].length;M++)for(var L=0;L<A;L++)D.vertices.push(C[J][M][L]);0<J&&(G+=C[J-1].length,
D.holes.push(G))}return D};return p})})(v);g=g.getDefaultExportFromCjs(v.exports);h.earcut=g})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports"],function(h){function g(t,B,y,E,F,C,A){let D;y=0;for(let G=E,J=F-C;G<F;G+=C)y+=(t[J+B*C]-t[G+B*C])*(t[G+1+B*C]+t[J+1+B*C]),J=G;if(A===0<y)for(;E<F;E+=C)D=f(E+B*C,t[E+B*C],t[E+1+B*C],D);else for(F-=C;F>=E;F-=C)D=f(F+B*C,t[F+B*C],t[F+1+B*C],D);D&&r(D,D.next)&&(e(D),D=D.next);return D}function v(t,B=t){if(!t)return t;let y;do if(y=!1,t.steiner||
!r(t,t.next)&&0!==c(t.prev,t,t.next))t=t.next;else{e(t);t=B=t.prev;if(t===t.next)break;y=!0}while(y||t!==B);return B}function n(t,B,y,E,F,C,A,D){if(t){!D&&C&&(t=b(t,E,F,C));for(var G=t;t.prev!==t.next;){var J=t.prev,M=t.next;if(C)var L=p(t,E,F,C);else a:{L=t;var Q=L.prev,N=L;const U=L.next;if(0<=c(Q,N,U)){L=!1;break a}let Z=L.next.next;const H=Z;let O=0;for(;Z!==L.prev&&(0===O||Z!==H);){O++;if(d(Q.x,Q.y,N.x,N.y,U.x,U.y,Z.x,Z.y)&&0<=c(Z.prev,Z,Z.next)){L=!1;break a}Z=Z.next}L=!0}if(L)B.push(J.index/
y+A),B.push(t.index/y+A),B.push(M.index/y+A),e(t),G=t=M.next;else if(t=M,t===G){if(!D)n(v(t),B,y,E,F,C,A,1);else if(1===D){D=B;G=y;J=A;M=t;do L=M.prev,Q=M.next.next,!r(L,Q)&&m(L,M,M.next,Q)&&k(L,Q)&&k(Q,L)&&(D.push(L.index/G+J),D.push(M.index/G+J),D.push(Q.index/G+J),e(M),e(M.next),M=t=Q),M=M.next;while(M!==t);t=M;n(t,B,y,E,F,C,A,2)}else if(2===D)a:{D=t;do{for(G=D.next.next;G!==D.prev;){if(J=D.index!==G.index){L=L=L=void 0;J=D;M=G;if(L=J.next.index!==M.index&&J.prev.index!==M.index){b:{L=J;do{if(L.index!==
J.index&&L.next.index!==J.index&&L.index!==M.index&&L.next.index!==M.index&&m(L,L.next,J,M)){L=!0;break b}L=L.next}while(L!==J);L=!1}L=!L}if(L=L&&k(J,M)&&k(M,J)){L=J;Q=!1;N=(J.x+M.x)/2;M=(J.y+M.y)/2;do L.y>M!==L.next.y>M&&L.next.y!==L.y&&N<(L.next.x-L.x)*(M-L.y)/(L.next.y-L.y)+L.x&&(Q=!Q),L=L.next;while(L!==J);L=Q}J=L}if(J){t=w(D,G);D=v(D,D.next);t=v(t,t.next);n(D,B,y,E,F,C,A,0);n(t,B,y,E,F,C,A,0);break a}G=G.next}D=D.next}while(D!==t)}break}}}}function p(t,B,y,E){const F=t.prev,C=t.next;if(0<=c(F,
t,C))return!1;const A=F.x>t.x?F.x>C.x?F.x:C.x:t.x>C.x?t.x:C.x,D=F.y>t.y?F.y>C.y?F.y:C.y:t.y>C.y?t.y:C.y,G=l(F.x<t.x?F.x<C.x?F.x:C.x:t.x<C.x?t.x:C.x,F.y<t.y?F.y<C.y?F.y:C.y:t.y<C.y?t.y:C.y,B,y,E);B=l(A,D,B,y,E);y=t.prevZ;for(E=t.nextZ;y&&y.z>=G&&E&&E.z<=B;){if(y!==t.prev&&y!==t.next&&d(F.x,F.y,t.x,t.y,C.x,C.y,y.x,y.y)&&0<=c(y.prev,y,y.next))return!1;y=y.prevZ;if(E!==t.prev&&E!==t.next&&d(F.x,F.y,t.x,t.y,C.x,C.y,E.x,E.y)&&0<=c(E.prev,E,E.next))return!1;E=E.nextZ}for(;y&&y.z>=G;){if(y!==t.prev&&y!==
t.next&&d(F.x,F.y,t.x,t.y,C.x,C.y,y.x,y.y)&&0<=c(y.prev,y,y.next))return!1;y=y.prevZ}for(;E&&E.z<=B;){if(E!==t.prev&&E!==t.next&&d(F.x,F.y,t.x,t.y,C.x,C.y,E.x,E.y)&&0<=c(E.prev,E,E.next))return!1;E=E.nextZ}return!0}function f(t,B,y,E){t=x.create(t,B,y);E?(t.next=E.next,t.prev=E,E.next.prev=t,E.next=t):(t.prev=t,t.next=t);return t}function e(t){t.next.prev=t.prev;t.prev.next=t.next;t.prevZ&&(t.prevZ.nextZ=t.nextZ);t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function a(t,B){let y=B;const E=t.x,F=t.y;let C=-Infinity,
A;do{if(F<=y.y&&F>=y.next.y&&y.next.y!==y.y){var D=y.x+(F-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(D<=E&&D>C){C=D;if(D===E){if(F===y.y)return y;if(F===y.next.y)return y.next}A=y.x<y.next.x?y:y.next}}y=y.next}while(y!==B);if(!A)return null;if(E===C)return A.prev;B=A;D=A.x;const G=A.y;let J=Infinity,M;for(y=A.next;y!==B;)E>=y.x&&y.x>=D&&E!==y.x&&d(F<G?E:C,F,D,G,F<G?C:E,F,y.x,y.y)&&(M=Math.abs(F-y.y)/(E-y.x),(M<J||M===J&&y.x>A.x)&&k(y,t)&&(A=y,J=M)),y=y.next;return A}function b(t,B,y,E){for(var F;F!==t;F=
F.next){F=F||t;null===F.z&&(F.z=l(F.x,F.y,B,y,E));if(F.prev.next!==F||F.next.prev!==F)return F.prev.next=F,F.next.prev=F,b(t,B,y,E);F.prevZ=F.prev;F.nextZ=F.next}t.prevZ.nextZ=null;t.prevZ=null;a:for(y=1;;){E=t;B=t=null;let C=0;for(;E;){C++;F=E;let A=0;for(;A<y&&F;A++)F=F.nextZ;let D=y;for(;0<A||0<D&&F;){let G;0===A?(G=F,F=F.nextZ,D--):0!==D&&F?E.z<=F.z?(G=E,E=E.nextZ,A--):(G=F,F=F.nextZ,D--):(G=E,E=E.nextZ,A--);B?B.nextZ=G:t=G;G.prevZ=B;B=G}E=F}B.nextZ=null;y*=2;if(2>C)break a}return t}function c(t,
B,y){return(B.y-t.y)*(y.x-B.x)-(B.x-t.x)*(y.y-B.y)}function m(t,B,y,E){return r(t,B)&&r(y,E)||r(t,E)&&r(y,B)?!0:0<c(t,B,y)!==0<c(t,B,E)&&0<c(y,E,t)!==0<c(y,E,B)}function d(t,B,y,E,F,C,A,D){return 0<=(F-A)*(B-D)-(t-A)*(C-D)&&0<=(t-A)*(E-D)-(y-A)*(B-D)&&0<=(y-A)*(C-D)-(F-A)*(E-D)}function k(t,B){return 0>c(t.prev,t,t.next)?0<=c(t,B,t.next)&&0<=c(t,t.prev,B):0>c(t,B,t.prev)||0>c(t,t.next,B)}function l(t,B,y,E,F){t=32767*(t-y)*F;B=32767*(B-E)*F;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;
B=(B|B<<8)&16711935;B=(B|B<<4)&252645135;B=(B|B<<2)&858993459;return(t|t<<1)&1431655765|((B|B<<1)&1431655765)<<1}function r(t,B){return t.x===B.x&&t.y===B.y}function u(t,B){return t.x-B.x}function w(t,B){const y=x.create(t.index,t.x,t.y),E=x.create(B.index,B.x,B.y),F=t.next,C=B.prev;t.next=B;B.prev=t;y.next=F;F.prev=y;E.next=y;y.prev=E;C.next=E;E.prev=C;return E}class x{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(t,B,
y){const E=q<z.length?z[q++]:new x;E.index=t;E.x=B;E.y=y;E.prev=null;E.next=null;E.z=null;E.prevZ=null;E.nextZ=null;E.steiner=!1;return E}}const z=[];let q=0;for(let t=0;8096>t;t++)z.push(new x);h.bufcut=function(t,B,y,E,F,C,A){q=0;var D=(E-y)*C,G=F&&F.length;const J=G?(F[0]-y)*C:D;var M=g(B,y,E,0,J,C,!0);if(M&&M.next!==M.prev){var L;if(G){const H=[];for(let O=0,T=F.length;O<T;O++){const V=g(B,y,E,F[O]*C,O<T-1?F[O+1]*C:E*C,C,!1);V===V.next&&(V.steiner=!0);G=H;var Q=G.push;let X=V,I=V;do{if(X.x<I.x||
X.x===I.x&&X.y<I.y)I=X;X=X.next}while(X!==V);Q.call(G,I)}H.sort(u);for(var N of H)if(E=N,F=a(E,M))E=w(F,E),v(E,E.next),M=v(F,F.next)}if(D>80*C){var U=D=B[y*C];var Z=L=B[1+y*C];for(N=C;N<J;N+=C)E=B[N+y*C],F=B[N+1+y*C],U=Math.min(U,E),Z=Math.min(Z,F),D=Math.max(D,E),L=Math.max(L,F);L=Math.max(D-U,L-Z);L=0!==L?1/L:0}n(M,t,C,U,Z,L,A,0)}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){class d extends c(m){constructor(k,l,r,u,w,x,z,q,t,B,y,E,F,C,A,D,G,J,M,L){super();k=a.LineMaterialKey.load(k);l&&(k.sdf=l.sdf,k.pattern=!0,k.textureBinding=l.textureBinding);this._capType=u;this._joinType=w;this._miterLimitCosine=b.getLimitCosine(x);this.tessellationProperties._fillColor=z;this.tessellationProperties._tl=q;this.tessellationProperties._br=t;this._hasPattern=B;this._isDashed=y;this._zOrder=G;this._effects=J||null;this._minMaxZoom=f.i1616to32(Math.round(M*
p.minMaxZoomPrecisionFactor),Math.round(L*p.minMaxZoomPrecisionFactor));this._materialKey=k.data;this.tessellationProperties._bitset=(F?p.bitsetGenericLockColor:0)|(C?p.bitsetTypeFillOutline:0)|(E?p.bitsetLineScaleDash:0)|(A?p.bitsetGenericConsiderAlphaOnly:0);this.tessellationProperties._halfWidth=.5*r;this.tessellationProperties._halfReferenceWidth=.5*D;this.tessellationProperties.offset=0;this._initializeTessellator(!1)}static fromCIMLine(k,l,r){var u=k.color,w=k.scaleFactor||1;const x=!!k.dashTemplate;
let z=k.cap;x&&z===v.CapType.ROUND&&(z=v.CapType.SQUARE);const q=k.join;w*=g.pt2px(k.width);const t=g.pt2px(k.referenceWidth),B=g.pt2px(k.miterLimit);u=u&&n.premultiplyAlphaRGBA(u)||0;const [y,E]=b.getMinMaxZoom(k.scaleInfo,r);if(!l)return new d(k.materialKey,l,w,z,q,B,u,0,0,!1,x,k.scaleDash??!1,k.colorLocked??!1,!1,k.sampleAlphaOnly,t,k.zOrder,k.effects,y,E);const {rect:F,width:C,height:A}=l;var D=F.x+p.spritePadding;const G=F.y+p.spritePadding;r=D+C;const J=G+A;D=f.i1616to32(D,G);r=f.i1616to32(r,
J);return new d(k.materialKey,l,w,z,q,B,u,D,r,!0,x,k.scaleDash??!1,k.colorLocked??!1,!1,k.sampleAlphaOnly,t,k.zOrder,k.effects,y,E)}static fromFillOutline(k){const l=a.FillMaterialKey.load(k.materialKey);return a.hasOutlineFillSymbology(l)&&k.outline&&"esriSLSSolid"===k.outline?.style?d.fromSimpleLine({hash:"",materialKey:k.materialKey,...k.outline},null,!0):null}static fromSimpleLine(k,l,r=!1){var {color:u}=k;const w="esriSLSSolid"!==k.style&&"esriSLSNull"!==k.style,x=e.getCapType(k.cap||"round"),
z=e.getJoinType(k.join||"round");u=u&&"esriSLSNull"!==k.style&&n.premultiplyAlphaRGBAArray(u)||0;"esriSLSNull"===k.style&&(u=0);const q=g.pt2px(k.width),t=k.miterLimit;if(!l)return new d(k.materialKey,l,q,x,z,t,u,0,0,!1,w,!0,!1,r,!1,q,0,null,b.defaultMinZoom,b.defaultMaxZoom);const {rect:B,width:y,height:E}=l;var F=B.x+p.spritePadding;const C=B.y+p.spritePadding;var A=F+y;const D=C+E;F=f.i1616to32(F,C);A=f.i1616to32(A,D);return new d(k.materialKey,l,q,x,z,t,u,F,A,!0,w,!0,!1,r,!1,q,0,null,b.defaultMinZoom,
b.defaultMaxZoom)}static fromPictureLineSymbol(k,l,r,u){h.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!");return null}}return d})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("../../../../../../geometry/GeometryCursor ../../definitions ../../enums ../../number ../../TurboLine ../../materialKey/MaterialKey ./templateUtils".split(" "),function(h,g,v,n,p,f,e){const a=(m,d,k)=>(l,r,u,w,x,z,q,t,B,y,E)=>{u=
n.i1616to32(E,Math.ceil(16*m._halfWidth));q=n.i8888to32(Math.round(16*q),Math.round(16*t),Math.round(16*B),Math.round(16*y));x=n.i8888to32(16*x,16*z,0,m._bitset);z=m.out;z.vertexBounds(l,r,d,k);z.vertexWrite(n.i1616to32(8*l,8*r));z.vertexWrite(m.id);z.vertexWrite(m._fillColor);z.vertexWrite(q);z.vertexWrite(u);z.vertexWrite(m._tl);z.vertexWrite(m._br);z.vertexWrite(x);z.vertexWrite(n.i1616to32(Math.ceil(16*m._halfReferenceWidth),0));z.vertexWrite(m.minMaxZoom);z.vertexEnd();return m.offset+m.vertexCount++},
b=(m,d,k)=>(l,r,u,w,x,z,q,t,B,y,E)=>{u=n.i1616to32(16*m._halfWidth,16*m._halfReferenceWidth);q=n.i8888to32(16*q+128,16*t+128,16*B+128,16*y+128);t=m.out;B=m._bitset<<24|m.id;t.vertexBounds(l,r,d,k);t.vertexWrite(n.i1616to32(8*l,8*r));t.vertexWrite(B);t.vertexWrite(m._fillColor);l=f.hasSimpleSymbology(m.key);l||(t.vertexWrite(0),t.vertexWrite(0));t.vertexWrite(0);t.vertexWrite(u);t.vertexWrite(q);l||t.vertexWrite(m.minMaxZoom);t.vertexEnd();return m.offset+m.vertexCount++},c=m=>(d,k,l)=>{const r=m.out;
r.indexWrite(d);r.indexWrite(k);r.indexWrite(l);m.indexCount+=3};return m=>class extends m{constructor(...d){super(...d);this.tessellationProperties={};this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0};this.geometryType=v.WGLGeometryType.LINE}writeGeometry(d,k,l,r){this._writeGeometry(d,k,l,r)}_initializeTessellator(d){var k=f.LineMaterialKey.load(this._materialKey),l=f.FillMaterialKey.load(this._materialKey),r=this._tessellationOptions;k=k.vvSizeFieldStops||k.vvSizeMinMaxValue||
k.vvSizeScaleStops||k.vvSizeUnitValue;d=this.tessellationProperties._halfWidth<g.thinLineHalfWidthThreshold&&!d&&!k;this.tessellationProperties.minMaxZoom=this._minMaxZoom;r.wrapDistance=65535;r.textured=this._isDashed||this._hasPattern;r.offset=this.tessellationProperties.offset;r.halfWidth=this.tessellationProperties._halfWidth;r=d?0:1;l=f.hasOutlineFillSymbology(l)?b:a;this._lineTessellator=new p.LineTessellation(l(this.tessellationProperties,r,r),c(this.tessellationProperties),d)}_write(d,k,l,
r){l="esriGeometryPoint"===k.geometryType;d.recordStart(k.getDisplayId(),this._materialKey,this.geometryType,l);this._writeGeometry(d,k,r,l);d.recordEnd()}_writeGeometry(d,k,l,r){if(l=l||h.GeometryCursor.fromFeatureSetReaderCIM(k))r=this._getLines(l,r),null!=r&&this._writeVertices(d,k,r)}_getLines(d,k){return e.clipLinesMarshall(d,k?256:16)}_writeVertices(d,k,l){const r=k.getDisplayId(),u=d.vertexCount(),w=this.tessellationProperties;k=this._tessellationOptions;w.out=d;w.id=r;w.indexCount=0;w.vertexCount=
0;w.offset=u;k.capType=this._capType;k.joinType=this._joinType;d=f.FillMaterialKey.load(this._materialKey);this.tessellationProperties.key=f.hasOutlineFillSymbology(d)?d:f.LineMaterialKey.load(this._materialKey);for(const {line:x,start:z}of l)k.initialDistance=z%65535,this._lineTessellator.tessellate(x,k)}}})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","../../../../symbols/cim/enums","./definitions"],function(h,g,v){function n(d,k){return d.x===k.x&&d.y===k.y}function p(d,
k){d.x=k.y;d.y=-k.x;return d}function f(d,k){d.x=-k.y;d.y=k.x;return d}function e(d,k){d.x=k.x;d.y=k.y;return d}function a(d,k){d.x=-k.x;d.y=-k.y;return d}function b(d){return Math.sqrt(d.x*d.x+d.y*d.y)}function c(d,k,l,r){d.x=k.x*l+k.y*r;d.y=k.x*r-k.y*l;return d}class m{constructor(d,k,l){this._writeVertex=d;this._writeTriangle=k;this._canUseThinTessellation=l;this._prevNormal={x:void 0,y:void 0};this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,
y:-1};this._textureNormal={x:void 0,y:void 0};this._joinNormal={x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};this._bevelStart={x:void 0,y:void 0};this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}tessellate(d,k){if(d){var l=
d.length;if(!(1>=l)){var r=0;for(let u=1;u<l;u++)n(d[u],d[r])||++r===u||(d[r]=d[u]);d.length=r+1}}this._canUseThinTessellation&&k.halfWidth<v.thinLineHalfWidthThreshold&&!k.offset?this._tessellateThin(d,k):this._tessellate(d,k)}_tessellateThin(d,k){if(!(2>d.length)){var l=k.wrapDistance||65535;k=k.initialDistance||0;var r=!1,u=d[0].x,w=d[0].y,x=d.length;for(let B=1;B<x;++B){r&&(r=!1,k=0);let y=d[B].x,E=d[B].y;var z=y-u;let F=E-w;var q=Math.sqrt(z*z+F*F);z/=q;F/=q;if(k+q>l){r=!0;var t=(l-k)/q;q=l-
k;y=(1-t)*u+t*y;E=(1-t)*w+t*E;--B}t=this._writeVertex(u,w,0,0,z,F,F,-z,0,-1,k);u=this._writeVertex(u,w,0,0,z,F,-F,z,0,1,k);k+=q;q=this._writeVertex(y,E,0,0,z,F,F,-z,0,-1,k);z=this._writeVertex(y,E,0,0,z,F,-F,z,0,1,k);this._writeTriangle(t,u,q);this._writeTriangle(u,q,z);u=y;w=E}}}_tessellate(d,k){var l=d[d.length-1];const r=n(d[0],l);if(!(d.length<(r?3:2))){var u=k.pixelCoordRatio,w=null!=k.capType?k.capType:g.CapType.BUTT,x=null!=k.joinType?k.joinType:g.JoinType.MITER,z=null!=k.miterLimit?Math.min(k.miterLimit,
4):2,q=null!=k.roundLimit?Math.min(k.roundLimit,1.05):1.05,t=null!=k.halfWidth?k.halfWidth:2,B=!!k.textured,y=null,E=this._prevNormal,F=this._nextNormal,C=-1,A=-1,D=this._joinNormal,G=this._textureNormalLeft,J=this._textureNormalRight,M=this._textureNormal,L=-1,Q=-1,N=k.wrapDistance||65535,U=k.initialDistance||0,Z=this._writeVertex,H=this._writeTriangle;k=(ea,ha,ia,ka,la,ma)=>{ea=Z(T,V,K,P,ia,ka,ea,ha,la,ma,U);0<=L&&0<=Q&&0<=ea&&H(L,Q,ea);L=Q;return Q=ea};if(r){var O=d[d.length-2];F.x=l.x-O.x;F.y=
l.y-O.y;A=b(F);F.x/=A;F.y/=A}l=!1;for(let ea=0;ea<d.length;++ea){l&&(l=!1,U=0);O&&(E.x=-F.x,E.y=-F.y,C=A,U+C>N&&(l=!0));l?(y=(N-U)/C,C=N-U,O={x:(1-y)*O.x+y*d[ea].x,y:(1-y)*O.y+y*d[ea].y},--ea):O=d[ea];var T=O.x;var V=O.y;var X=0>=ea&&!l,I=ea===d.length-1;X||(U+=C);(y=I?r?d[1]:null:d[ea+1])?(F.x=y.x-T,F.y=y.y-V,A=b(F),F.x/=A,F.y/=A):(F.x=void 0,F.y=void 0);if(!r){if(X){f(D,F);var K=D.x;var P=D.y;w===g.CapType.SQUARE&&(k(-F.y-F.x,F.x-F.y,F.x,F.y,0,-1),k(F.y-F.x,-F.x-F.y,F.x,F.y,0,1));w===g.CapType.ROUND&&
(k(-F.y-F.x,F.x-F.y,F.x,F.y,-1,-1),k(F.y-F.x,-F.x-F.y,F.x,F.y,-1,1));if(w===g.CapType.ROUND||w===g.CapType.BUTT)k(-F.y,F.x,F.x,F.y,0,-1),k(F.y,-F.x,F.x,F.y,0,1);continue}if(I){p(D,E);K=D.x;P=D.y;if(w===g.CapType.ROUND||w===g.CapType.BUTT)k(E.y,-E.x,-E.x,-E.y,0,-1),k(-E.y,E.x,-E.x,-E.y,0,1);w===g.CapType.SQUARE&&(k(E.y-E.x,-E.x-E.y,-E.x,-E.y,0,-1),k(-E.y-E.x,E.x-E.y,-E.x,-E.y,0,1));w===g.CapType.ROUND&&(k(E.y-E.x,-E.x-E.y,-E.x,-E.y,1,-1),k(-E.y-E.x,E.x-E.y,-E.x,-E.y,1,1));continue}}var W=void 0;X=
-(E.x*F.y-E.y*F.x);.01>Math.abs(X)?0<E.x*F.x+E.y*F.y?(D.x=E.x,D.y=E.y,X=1,W=Number.MAX_VALUE,y=!0):(f(D,F),W=X=1,y=!1):(D.x=(E.x+F.x)/X,D.y=(E.y+F.y)/X,W=b(D),y=(W-1)*t*u,y=4<W||y>C&&y>A);K=D.x;P=D.y;var aa=x;switch(x){case g.JoinType.BEVEL:1.05>W&&(aa=g.JoinType.MITER);break;case g.JoinType.ROUND:W<q&&(aa=g.JoinType.MITER);break;case g.JoinType.MITER:W>z&&(aa=g.JoinType.BEVEL)}switch(aa){case g.JoinType.MITER:k(D.x,D.y,-E.x,-E.y,0,-1);k(-D.x,-D.y,-E.x,-E.y,0,1);if(I)break;B&&(y=l?0:U,L=this._writeVertex(T,
V,K,P,F.x,F.y,D.x,D.y,0,-1,y),Q=this._writeVertex(T,V,K,P,F.x,F.y,-D.x,-D.y,0,1,y));break;case g.JoinType.BEVEL:X=0>X;var R=void 0;X?(aa=L,L=Q,Q=aa,R=G,aa=J):(R=J,aa=G);var S=void 0,Y=void 0;y?(S=X?f(this._innerPrev,E):p(this._innerPrev,E),Y=X?p(this._innerNext,F):f(this._innerNext,F)):S=Y=X?a(this._inner,D):e(this._inner,D);W=X?p(this._bevelStart,E):f(this._bevelStart,E);k(S.x,S.y,-E.x,-E.y,R.x,R.y);S=k(W.x,W.y,-E.x,-E.y,aa.x,aa.y);if(I)break;I=X?f(this._bevelEnd,F):p(this._bevelEnd,F);y?(y=this._writeVertex(T,
V,K,P,-E.x,-E.y,0,0,0,0,U),L=this._writeVertex(T,V,K,P,F.x,F.y,Y.x,Y.y,R.x,R.y,U),Q=this._writeVertex(T,V,K,P,F.x,F.y,I.x,I.y,aa.x,aa.y,U),this._writeTriangle(S,y,Q)):(B?(y=this._bevelMiddle,y.x=(W.x+I.x)/2,y.y=(W.y+I.y)/2,c(M,y,-E.x,-E.y),k(y.x,y.y,-E.x,-E.y,M.x,M.y),c(M,y,F.x,F.y),L=this._writeVertex(T,V,K,P,F.x,F.y,y.x,y.y,M.x,M.y,U),Q=this._writeVertex(T,V,K,P,F.x,F.y,Y.x,Y.y,R.x,R.y,U)):(y=L,L=Q,Q=y),k(I.x,I.y,F.x,F.y,aa.x,aa.y));X&&(y=L,L=Q,Q=y);break;case g.JoinType.ROUND:X=0>X;var ba=void 0;
X?(aa=L,L=Q,Q=aa,aa=G,ba=J):(aa=J,ba=G);var ca=X?a(this._inner,D):e(this._inner,D);y?(Y=X?f(this._innerPrev,E):p(this._innerPrev,E),R=X?p(this._innerNext,F):f(this._innerNext,F)):R=Y=ca;S=X?p(this._roundStart,E):f(this._roundStart,E);var da=X?f(this._roundEnd,F):p(this._roundEnd,F);Y=k(Y.x,Y.y,-E.x,-E.y,aa.x,aa.y);S=k(S.x,S.y,-E.x,-E.y,ba.x,ba.y);if(I)break;I=this._writeVertex(T,V,K,P,-E.x,-E.y,0,0,0,0,U);y||this._writeTriangle(L,Q,I);ca=a(this._outer,ca);ba=this._writeVertex(T,V,K,P,F.x,F.y,da.x,
da.y,ba.x,ba.y,U);let ha,ia;if(da=2<W){var fa=void 0;W!==Number.MAX_VALUE?(ca.x/=W,ca.y/=W,fa=E.x*ca.x+E.y*ca.y,fa=(W*(fa*fa-1)+1)/fa):fa=-1;ha=X?p(this._startBreak,E):f(this._startBreak,E);ha.x+=E.x*fa;ha.y+=E.y*fa;ia=X?f(this._endBreak,F):p(this._endBreak,F);ia.x+=F.x*fa;ia.y+=F.y*fa}c(M,ca,-E.x,-E.y);W=this._writeVertex(T,V,K,P,-E.x,-E.y,ca.x,ca.y,M.x,M.y,U);c(M,ca,F.x,F.y);ca=B?this._writeVertex(T,V,K,P,F.x,F.y,ca.x,ca.y,M.x,M.y,U):W;fa=I;const ka=B?this._writeVertex(T,V,K,P,F.x,F.y,0,0,0,0,U):
I;let la=-1,ma=-1;da&&(c(M,ha,-E.x,-E.y),la=this._writeVertex(T,V,K,P,-E.x,-E.y,ha.x,ha.y,M.x,M.y,U),c(M,ia,F.x,F.y),ma=this._writeVertex(T,V,K,P,F.x,F.y,ia.x,ia.y,M.x,M.y,U));B?da?(this._writeTriangle(fa,S,la),this._writeTriangle(fa,la,W),this._writeTriangle(ka,ca,ma),this._writeTriangle(ka,ma,ba)):(this._writeTriangle(fa,S,W),this._writeTriangle(ka,ca,ba)):da?(this._writeTriangle(I,S,la),this._writeTriangle(I,la,ma),this._writeTriangle(I,ma,ba)):(this._writeTriangle(I,S,W),this._writeTriangle(I,
ca,ba));y?L=this._writeVertex(T,V,K,P,F.x,F.y,R.x,R.y,aa.x,aa.y,U):(L=B?this._writeVertex(T,V,K,P,F.x,F.y,R.x,R.y,aa.x,aa.y,U):Y,this._writeTriangle(L,ka,ba));Q=ba;X&&(y=L,L=Q,Q=y)}}}}}h.LineTessellation=m;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define(["../../../../../../core/Logger","../../../../../../symbols/cim/cimAnalyzer","../../../../../../symbols/cim/utils","./WGLMeshTemplate"],function(h,
g,v,n){const p=h.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class f extends n{constructor(e){super();this._ongoingMaterialRequestMap=new Map;this._materialCache=new Map;this._dynamicPropertyMap=new Map;this._cimLayer=e}async analyze(e,a,b,c,m){if(m&&0===m.length)return null;const d=m&&0<m.length,k=a.readLegacyFeature();a=a.getObjectId();const l=this._materialCache;var r=this._cimLayer.materialHash;if(!r)return p.error("A Dynamic mesh template must have a material hash value or function!"),
null;const u="function"===typeof r?r(k,b,c,a):r;r=l.get(u);if(null!=r||(r=this._ongoingMaterialRequestMap.get(u)))return r;r=this._cimLayer;const w=g.analyzeCIMResource(r.cim,this._cimLayer.materialOverrides);w.mosaicHash=u;const {type:x,url:z}=r;a={cim:w,type:x,mosaicHash:u,url:z,size:null,dashTemplate:null,text:null,fontName:null,objectId:a,animatedSymbolProperties:null};switch(x){case "marker":a.size=v.evaluateValueOrFunction(r.size,k,b,c);a.animatedSymbolProperties=v.evaluateValueOrFunction(r.animatedSymbolProperties,
k,b,c);break;case "line":a.dashTemplate=r.dashTemplate;break;case "text":a.text=v.evaluateValueOrFunction(r.text,k,b,c),a.fontName=v.evaluateValueOrFunction(r.fontName,k,b,c)}e=e.getMosaicItem(a,m).then(q=>{d||(this._ongoingMaterialRequestMap.delete(u),l.set(u,q));return q}).catch(q=>{this._ongoingMaterialRequestMap.delete(u);p.error(".analyze()",q.message);return null});d||this._ongoingMaterialRequestMap.set(u,e);return e}}return f})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../Color ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolDrawHelper ./CIMSymbolHelper ./enums ./quantizeTime ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/grouping".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x){function z(A){switch(A){case "Butt":return m.CapType.BUTT;case "Square":return m.CapType.SQUARE;default:return m.CapType.ROUND}}function q(A){switch(A){case "Bevel":return m.JoinType.BEVEL;case "Miter":return m.JoinType.MITER;default:return m.JoinType.ROUND}}function t(A){return A&&0===A.indexOf("Level_")&&(A=parseInt(A.substr(6),10),!isNaN(A))?A:0}function B(A){if(!A||0===A.length)return null;A=(new g(A)).toRgba();return{r:A[0],g:A[1],b:A[2],a:A[3]}}
function y(A){return A?A.charAt(0).toLowerCase()+A.substr(1):A}function E(A){var D=A.symbolLayers;if(!D||2!==D.length)return!1;A=D.find(G=>G.effects?.find(J=>"CIMGeometricEffectDashes"===J.type));D=D.find(G=>G.effects?.find(J=>"CIMGeometricEffectAddControlPoints"===J.type));return!!A&&!!D}const F=p.getLogger("esri.symbols.cim.cimAnalyzer");class C{constructor(A,D){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];this._resourceManager=A;this._info=D}async analyzeSymbolReference(A,D,G){this._cimLayers=
G??[];if(!A)return this._cimLayers;if(A.primitiveOverrides){this._primitiveOverrides=A.primitiveOverrides;this._poMap={};G=[];const M=this._info;for(const L of this._primitiveOverrides){var J=L.valueExpressionInfo;J&&M?(J=a.createRendererExpression(J.expression,M.spatialReference,M.fields).then(Q=>{null!=Q&&this._setPoMap(L.primitiveName,L.propertyName,Q)}),G.push(J)):null!=L.value&&this._setPoMap(L.primitiveName,L.propertyName,L.value);0<G.length&&await Promise.all(G)}}A=A.symbol;G=[];c.CIMSymbolHelper.fetchResources(A,
this._resourceManager,G);0<G.length&&await Promise.all(G);this._analyzeSymbol(A,D);return this._cimLayers}_analyzeSymbol(A,D){switch(A?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(A,D,1,0,0,0)}}_analyzeMultiLayerSymbol(A,D,G,J,M,L){const Q=A?.symbolLayers;if(Q){var N=A.effects,U=m.Alignment.SCREEN,Z=c.CIMSymbolHelper.getSize(A)??0;"CIMPointSymbol"===A.type&&"Map"===A.angleAlignment&&(U=m.Alignment.MAP);for(var H="CIMPolygonSymbol"===A.type,
O=Q.length;O--;){const V=Q[O];if(!V||!1===V.enable)continue;let X;N?.length&&(X=[...N]);var T=V.effects;T?.length&&(N?X.push(...T):X=[...T]);T=[];c.OverrideHelper.findEffectOverrides(X,this._primitiveOverrides,T);T=0<T.length?this._createEffectsOverrideFunction(X,T):X;c.OverrideHelper.findApplicableOverrides(V,this._primitiveOverrides,[]);switch(V.type){case "CIMSolidFill":this._analyzeSolidFill(V,T);break;case "CIMPictureFill":this._analyzePictureFill(V,T);break;case "CIMHatchFill":this._analyzeHatchFill(V,
T);break;case "CIMGradientFill":this._analyzeGradientFill(V,T);break;case "CIMSolidStroke":this._analyzeSolidStroke(V,T,H,Z);break;case "CIMPictureStroke":this._analyzePictureStroke(V,T,H,Z);break;case "CIMGradientStroke":this._analyzeGradientStroke(V,T,H,Z);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":"CIMLineSymbol"===A.type&&(U=(U=V.markerPlacement)&&U.angleToLine?m.Alignment.MAP:m.Alignment.SCREEN);const I=[],K=V.primitiveName;K&&I.push(K);this._analyzeMarker(V,
T,null,I,U,Z,1,D,G,J,M,L);break;default:F.error("Cannot analyze CIM layer",V.type)}}}}_analyzeSolidFill(A,D){const G=A.primitiveName,J=l.fromCIMColor(A.color),[M,L]=this._analyzePrimitiveOverrides(G,D,null,null),Q=e.numericHash(JSON.stringify(A)+L).toString();this._cimLayers.push({type:"fill",templateHash:Q,materialHash:M?()=>Q:Q,cim:A,materialOverrides:null,colorLocked:!!A.colorLocked,color:this._createOverrideFunction(G,"Color",J,B),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:D,applyRandomOffset:!1,
sampleAlphaOnly:!0})}_analyzePictureFill(A,D){const G=A.primitiveName,J=l.getTintColor(A),[M,L]=this._analyzePrimitiveOverrides(G,D,null,null),Q=e.numericHash(JSON.stringify(A)+L).toString(),N=e.numericHash(`${A.url}${JSON.stringify(A.colorSubstitutions)}`).toString(),U=l.getValue(A.height,b.defaultPictureFillHeight);let Z=l.getValue(A.scaleX,1);if("width"in A&&"number"===typeof A.width){const H=A.width;let O=1;const T=this._resourceManager.getResource(A.url);null!=T&&(O=T.width/T.height);Z/=U/H*
O}this._cimLayers.push({type:"fill",templateHash:Q,materialHash:M?()=>N:N,cim:A,materialOverrides:null,colorLocked:!!A.colorLocked,effects:D,color:this._createOverrideFunction(G,"TintColor",J,B),height:this._createOverrideFunction(G,"Height",U),scaleX:this._createOverrideFunction(G,"ScaleX",Z),angle:this._createOverrideFunction(G,"Rotation",l.getValue(A.rotation)),offsetX:this._createOverrideFunction(G,"OffsetX",l.getValue(A.offsetX)),offsetY:this._createOverrideFunction(G,"OffsetY",l.getValue(A.offsetY)),
url:A.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeHatchFill(A,D){const G=A.primitiveName,J=this._analyzeMaterialOverrides(G,["Rotation","OffsetX","OffsetY"]);let [M,L]=this._analyzePrimitiveOverrides(G,D,null,null);const Q=e.numericHash(JSON.stringify(A)+L).toString(),N=e.numericHash(`${A.separation}${JSON.stringify(A.lineSymbol)}`).toString();let U={r:255,g:255,b:255,a:1};var Z=!1;const H=A.lineSymbol?.symbolLayers?.find(O=>"CIMSolidStroke"===O.type&&null!=this._poMap[O.primitiveName]?.Color);
H&&(U=l.fromCIMColor(H.color),U=this._createOverrideFunction(H.primitiveName,"Color",U,B),Z="function"===typeof U,M=M||Z,Z=null!=H.color||Z);this._cimLayers.push({type:"fill",templateHash:Q,materialHash:M&&J?this._createMaterialHashFunction(N,J):N,cim:A,materialOverrides:J,colorLocked:!!A.colorLocked,effects:D,color:U,height:this._createOverrideFunction(G,"Separation",l.getValue(A.separation,b.defaultHatchFillSeparation)),scaleX:1,angle:this._createOverrideFunction(G,"Rotation",l.getValue(A.rotation)),
offsetX:this._createOverrideFunction(G,"OffsetX",l.getValue(A.offsetX)),offsetY:this._createOverrideFunction(G,"OffsetY",l.getValue(A.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!Z})}_analyzeGradientFill(A,D){const [G,J]=this._analyzePrimitiveOverrides(A.primitiveName,D,null,null),M=e.numericHash(JSON.stringify(A)+J).toString();this._cimLayers.push({type:"fill",templateHash:M,materialHash:G?()=>M:M,cim:A,materialOverrides:null,colorLocked:!!A.colorLocked,effects:D,
color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeSolidStroke(A,D,G,J){const M=A.primitiveName,L=l.fromCIMColor(A.color),Q=l.getValue(A.width,b.defaultStrokeWidth),N=z(A.capStyle),U=q(A.joinStyle),Z=A.miterLimit,[H,O]=this._analyzePrimitiveOverrides(M,D,null,null),T=e.numericHash(JSON.stringify(A)+O).toString();let V;if(D&&D instanceof Array&&0<D.length){const I=D[D.length-1];if("CIMGeometricEffectDashes"===I.type&&"NoConstraint"===
I.lineDashEnding&&null===I.offsetAlongLine){D=[...D];var X=D.pop();V=X.dashTemplate;X=X.scaleDash}}this._cimLayers.push({type:"line",templateHash:T,materialHash:H?()=>T:T,cim:A,materialOverrides:null,isOutline:G,colorLocked:!!A.colorLocked,effects:D,color:this._createOverrideFunction(M,"Color",L,B),width:this._createOverrideFunction(M,"Width",Q),cap:this._createOverrideFunction(M,"CapStyle",N),join:this._createOverrideFunction(M,"JoinStyle",U),miterLimit:Z&&this._createOverrideFunction(M,"MiterLimit",
Z),referenceWidth:J,zOrder:t(A.name),dashTemplate:V,scaleDash:X,sampleAlphaOnly:!0})}_analyzePictureStroke(A,D,G,J){const M=e.numericHash(`${A.url}${JSON.stringify(A.colorSubstitutions)}`).toString(),L=A.primitiveName,Q=l.getTintColor(A),N=l.getValue(A.width,b.defaultStrokeWidth),U=z(A.capStyle),Z=q(A.joinStyle),H=A.miterLimit,[O,T]=this._analyzePrimitiveOverrides(L,D,null,null),V=e.numericHash(JSON.stringify(A)+T).toString();this._cimLayers.push({type:"line",templateHash:V,materialHash:O?()=>M:M,
cim:A,materialOverrides:null,isOutline:G,colorLocked:!!A.colorLocked,effects:D,color:this._createOverrideFunction(L,"TintColor",Q,B),width:this._createOverrideFunction(L,"Width",N),cap:this._createOverrideFunction(L,"CapStyle",U),join:this._createOverrideFunction(L,"JoinStyle",Z),miterLimit:H&&this._createOverrideFunction(L,"MiterLimit",H),referenceWidth:J,zOrder:t(A.name),dashTemplate:null,scaleDash:!1,url:A.url,sampleAlphaOnly:!1})}_analyzeGradientStroke(A,D,G,J){const M=A.primitiveName,L=l.getValue(A.width,
b.defaultStrokeWidth),Q=z(A.capStyle),N=q(A.joinStyle),U=A.miterLimit,[Z,H]=this._analyzePrimitiveOverrides(M,D,null,null),O=e.numericHash(JSON.stringify(A)+H).toString();this._cimLayers.push({type:"line",templateHash:O,materialHash:Z?()=>O:O,cim:A,materialOverrides:null,isOutline:G,colorLocked:!!A.colorLocked,effects:D,color:{r:128,g:128,b:128,a:1},width:this._createOverrideFunction(M,"Width",L),cap:this._createOverrideFunction(M,"CapStyle",Q),join:this._createOverrideFunction(M,"JoinStyle",N),miterLimit:U&&
this._createOverrideFunction(M,"MiterLimit",U),referenceWidth:J,zOrder:t(A.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(A,D,G,J,M,L,Q,N,U,Z,H,O,T=!1){if(!this._analyzeMarkerInsidePolygon(A,D)){U=l.getValue(A.size,b.defaultMarkerSize);var V=l.getValue(A.rotation),X=l.getValue(A.offsetX),I=l.getValue(A.offsetY);U=this._createOverrideFunction(A.primitiveName,"Size",U);V=this._createOverrideFunction(A.primitiveName,"Rotation",V);X=this._createOverrideFunction(A.primitiveName,
"OffsetX",X);I=this._createOverrideFunction(A.primitiveName,"OffsetY",I);U=this._transformSize(U,Q);V=this._transformRotation(V,!!A.rotateClockwise,Z);H=this._transformOffsetX(X,I,Z,Q,H);Z=this._transformOffsetY(X,I,Z,Q,O);X=H;I=Z;switch(A.type){case "CIMPictureMarker":this._analyzePictureMarker(A,D,G,J,M,L,U,V,X,I,A.colorLocked||T);break;case "CIMVectorMarker":this._analyzeVectorMarker(A,D,G,J,M,L,Q,N,U,V,X,I,A.colorLocked||T)}}}_analyzeMarkerInsidePolygon(A,D){const {markerPlacement:G,type:J}=A;
if(!G||"CIMMarkerPlacementInsidePolygon"!==G.type)return!1;if("CIMVectorMarker"===J||"CIMPictureMarker"===J){var M=A.primitiveName;if(M&&([M]=this._analyzePrimitiveOverrides([M],D,null,null),M))return!1;if(M=G.primitiveName)if([M]=this._analyzePrimitiveOverrides([M],D,null,null),M)return!1;if("CIMVectorMarker"===J){if({markerGraphics:M}=A,M)for(var L of M)if({symbol:M}=L,"CIMPolygonSymbol"===M?.type&&M.symbolLayers){({symbolLayers:M}=M);for(var Q of M)if("CIMSolidStroke"===Q.type)return!1}}else if({animatedSymbolProperties:L}=
A,L)return!1}var N=Math.abs(G.stepX),U=Math.abs(G.stepY);if(0===N||0===U)return!0;const Z=new Set(["Rotation","OffsetX","OffsetY"]);L=this._primitiveOverrides.filter(T=>T.primitiveName!==A.primitiveName||!Z.has(T.propertyName));Q="url"in A&&"string"===typeof A.url?A.url:void 0;M=e.numericHash(JSON.stringify(A)).toString();let H=null;if("Random"===G.gridType){var O=f.px2pt(w.randomInsidePolygonTextureSize);const T=Math.max(Math.floor(O/N),1),V=Math.max(Math.floor(O/U),1);O=U*V;H=X=>X?X*V:0;N=T*N/O}else G.shiftOddRows?
(O=2*U,H=T=>T?2*T:0,N=N/U*.5):(O=U,H=null,N/=U);U=l.getTintColor(A);this._cimLayers.push({type:"fill",templateHash:M,materialHash:M,cim:A,materialOverrides:L,colorLocked:!!A.colorLocked,effects:D,color:U,height:this._createOverrideFunction(G.primitiveName,"StepY",O,H),scaleX:N,angle:G.gridAngle,offsetX:l.getValue(G.offsetX),offsetY:l.getValue(G.offsetY),url:Q,applyRandomOffset:"Random"===G.gridType,sampleAlphaOnly:!Q,hasUnresolvedReplacementColor:!0});return!0}_analyzePictureMarker(A,D,G,J,M,L,Q,
N,U,Z,H){let O=l.getValue(A.scaleX,1);const T=l.getTintColor(A),V=e.numericHash(`${A.url}${JSON.stringify(A.colorSubstitutions)}${JSON.stringify(A.animatedSymbolProperties)}`).toString();G||(G=this._createMarkerPlacementOverrideFunction(A.markerPlacement));const X=this._createAnimatedSymbolPropertiesOverrideFunction(A.animatedSymbolProperties),[I,K]=this._analyzePrimitiveOverrides(J,D,G,X);J=e.numericHash(JSON.stringify(A)+K).toString();const P=A.anchorPoint??{x:0,y:0};if("width"in A&&"number"===
typeof A.width){const aa=A.width;let R=1;var W=this._resourceManager.getResource(A.url);null!=W&&(R=W.width/W.height);W=l.getValue(A.size);O/=W/aa*R}this._cimLayers.push({type:"marker",templateHash:J,materialHash:A.animatedSymbolProperties&&!0===A.animatedSymbolProperties.randomizeStartTime?(aa,R,S,Y)=>{S=x.getMaterialGroup(Y??0);aa=null!=X?l.evaluateValueOrFunction(X,aa,R):null;return V+`-MATERIALGROUP(${S})`+`-ASP(${JSON.stringify(aa)})`}:I?(aa,R)=>{aa=null!=X?l.evaluateValueOrFunction(X,aa,R):
null;return V+`-ASP(${JSON.stringify(aa)})`}:V,cim:A,materialOverrides:null,colorLocked:!!A.colorLocked||!!H,effects:D,scaleSymbolsProportionally:!1,alignment:M,size:Q,scaleX:this._createOverrideFunction(A.primitiveName,"ScaleX",O),rotation:N,offsetX:U,offsetY:Z,color:this._createOverrideFunction(A.primitiveName,"TintColor",T,B),anchorPoint:{x:P.x,y:P.y},isAbsoluteAnchorPoint:"Relative"!==A.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:!1,referenceSize:L,
sizeRatio:1,markerPlacement:G,url:A.url,animatedSymbolProperties:X})}_analyzeVectorMarker(A,D,G,J,M,L,Q,N,U,Z,H,O,T){var V=A.markerGraphics;if(V){var X=A.frame,I=0,K=1;A.scaleSymbolsProportionally&&X&&(I=X.ymax-X.ymin,K=this._transformSize(U,1/I));K=this._transformSize(K,Q);G||(G=this._createMarkerPlacementOverrideFunction(A.markerPlacement));for(const aa of V)if(aa&&(Q=aa.symbol)){(V=aa.primitiveName)&&J.push(V);var P=H,W=O;if(("CIMPointSymbol"===Q.type||"CIMTextSymbol"===Q.type)&&X){let R=W=0;P=
aa.geometry;"x"in P&&"y"in P&&(W+=P.x-.5*(X.xmin+X.xmax),R+=P.y-.5*(X.ymin+X.ymax));if(P=A.anchorPoint)"Absolute"===A.anchorPointUnits?(W-=P.x,R-=P.y):X&&(W-=(X.xmax-X.xmin)*P.x,R-=(X.ymax-X.ymin)*P.y);P=this._transformOffsetX(W,R,Z,K,H);W=this._transformOffsetY(W,R,Z,K,O)}switch(Q.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":N||E(Q)?this._analyzeMultiLayerGraphicNonSDF(A,D,G,null,aa,J,M,L,I,!!T||!!A.colorLocked):this._analyzeMultiLayerGraphic(A,D,G,null,aa,J,M,L,I,K,U,
Z,P,W,!!T||!!A.colorLocked);break;case "CIMTextSymbol":this._analyzeTextGraphic(A,D,G,aa,J,M,L,I,K,U,Z,P,W,!!T||!!A.colorLocked)}V&&J.pop()}}}_analyzeMultiLayerGraphic(A,D,G,J,M,L,Q,N,U,Z,H,O,T,V,X){var I=M.symbol;const K=I.symbolLayers;if(K){var P=K.length;if(K&&2===K.length&&K[0].enable&&K[1].enable&&"CIMSolidStroke"===K[0].type&&"CIMSolidFill"===K[1].type&&null==K[0].path&&null==K[1].path&&!K[0].effects&&!K[1].effects)this._analyzeCompositeMarkerGraphic(A,D,G,J,M,K,L,Q,N,U,H,O,T,V,!!X||!!A.colorLocked);
else{var W=this._resourceManager.geometryEngine;if(I=r.CIMEffectHelper.applyEffects(I.effects,M.geometry,W))for(;P--;){const ca=K[P];if(!ca||!1===ca.enable)continue;const da=ca.primitiveName;da&&L.push(da);switch(ca.type){case "CIMSolidFill":case "CIMSolidStroke":var aa=r.CIMEffectHelper.applyEffects(ca.effects,I,W),R=k.getExtent(aa);if(!R)continue;const fa="Relative"!==A.anchorPointUnits,[ea,ha,ia]=k.getSDFMetrics(R,A.frame,A.size,A.anchorPoint,fa);var S="CIMSolidFill"===ca.type;aa={type:"sdf",geom:aa,
asFill:S};R=ca.path;const ka=S?l.fromCIMColor(l.getFillColor(ca)):null==R?l.fromCIMColor(l.getStrokeColor(ca)):{r:0,g:0,b:0,a:0},la=S?{r:0,g:0,b:0,a:0}:l.fromCIMColor(l.getStrokeColor(ca)),ma=l.getStrokeWidth(ca)??0;if(!S&&!ma)break;var Y=M.primitiveName;let na=null;S&&!ca.colorLocked&&(na=this._createOverrideFunction(Y,"FillColor",ka,B));let ra=null;S||ca.colorLocked||(ra=this._createOverrideFunction(Y,"StrokeColor",la,B));S=this._createOverrideFunction(Y,"StrokeWidth",ma);Y=!1;var ba="";for(const pa of this._primitiveOverrides)L.includes(pa.primitiveName)&&
(null!=pa.value?ba+=`-${pa.primitiveName}-${pa.propertyName}-${JSON.stringify(pa.value)}`:pa.valueExpressionInfo&&(Y=!0));if(null!=D&&"function"===typeof D||null!=G&&"function"===typeof G)Y=!0;if(l.isFeatureValueFn(H)||l.isFeatureValueFn(O)||l.isFeatureValueFn(T)||l.isFeatureValueFn(V))Y=!0;const sa=JSON.stringify({...A,markerGraphics:null}),ua=e.numericHash(JSON.stringify(aa)+R).toString();ba=e.numericHash(JSON.stringify(M)+JSON.stringify(ca)+sa+ba).toString();this._cimLayers.push({type:"marker",
templateHash:ba,materialHash:Y?()=>ua:ua,cim:aa,materialOverrides:null,colorLocked:!!ca.colorLocked||!!X,effects:D,scaleSymbolsProportionally:!!A.scaleSymbolsProportionally,alignment:Q,anchorPoint:{x:ha,y:ia},isAbsoluteAnchorPoint:fa,size:H,rotation:O,offsetX:T,offsetY:V,scaleX:1,frameHeight:U,rotateClockwise:!1,referenceSize:N,sizeRatio:ea,color:l.isFeatureValueFn(na)?na:this._createOverrideFunction(da,"Color",ka,B),outlineColor:l.isFeatureValueFn(ra)?ra:this._createOverrideFunction(da,"Color",la,
B),outlineWidth:l.isFeatureValueFn(S)?S:this._createOverrideFunction(da,"Width",ma),markerPlacement:G,animatedSymbolProperties:J,path:R});break;case "CIMVectorMarker":ca.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(A,D,G,J,M,L,Q,N,U,!!X||!!ca.colorLocked):this._analyzeMarker(ca,D,G,L,Q,N,Z,!1,H,O,T,V,!!X||!!A.colorLocked);break;default:this._analyzeMultiLayerGraphicNonSDF(A,D,G,J,M,L,Q,N,U,!!X||!!A.colorLocked)}da&&L.pop()}}}}_analyzeTextGraphic(A,D,G,J,M,L,Q,N,U,Z,H,O,T,V){c.OverrideHelper.findApplicableOverrides(J,
this._primitiveOverrides,[]);N=J.geometry;if("x"in N&&"y"in N){N=J.symbol;Z=l.fromCIMFontDecoration(N);var X=l.fromCIMFontStyle(N.fontStyleName),I=v.getFontFamily(N.fontFamilyName);N.font={family:I,decoration:Z,...X};var K=l.getValue(N.height,b.defaultTextHeight),P=l.getValue(N.angle),W=l.getValue(N.offsetX),aa=l.getValue(N.offsetY);K=this._transformSize(K,U);P=this._transformRotation(P,!1,H);O=this._transformOffsetX(W,aa,H,U,O);aa=this._transformOffsetY(W,aa,H,U,T);W=O;H=l.fromCIMColor(l.getFillColor(N));
T=l.fromCIMColor(l.getStrokeColor(N));O=l.getStrokeWidth(N)??0;O||(T=l.fromCIMColor(l.getFillColor(N.haloSymbol)),O=l.getValue(N.haloSize));O=this._transformSize(O,U);U=!1;if(N.symbol?.symbolLayers)for(var R of N.symbol.symbolLayers)null!=l.getFillColor(R)&&(U=!!R.colorLocked);var S=J.primitiveName;R=null;U||(R=this._createOverrideFunction(S,"Color",H,B));var Y=S=null,ba=0;if(N.callout&&"CIMBackgroundCallout"===N.callout.type){var ca=N.callout;if(ca.backgroundSymbol&&(ca=ca.backgroundSymbol.symbolLayers))for(const ia of ca)"CIMSolidFill"===
ia.type?S=l.fromCIMColor(ia.color):"CIMSolidStroke"===ia.type&&(Y=l.fromCIMColor(ia.color),ba=l.getValue(ia.width,b.defaultStrokeWidth))}var [da,fa]=this._analyzePrimitiveOverrides(M,D,G,null);M=JSON.stringify(A.effects)+Number(A.colorLocked||V).toString()+JSON.stringify(A.anchorPoint)+A.anchorPointUnits+JSON.stringify(A.markerPlacement)+A.size.toString();M=e.numericHash(JSON.stringify(J)+M+fa).toString();var ea=this._createOverrideFunction(J.primitiveName,"TextString",J.textString??"",l.adjustTextCase,
N.textCase);if(null!=ea){({fontStyleName:J}=N);var ha=I+(J?"-"+J.toLowerCase():"-regular");"string"===typeof ea&&ea.includes("[")&&N.fieldMap&&(ea=l.createLabelOverrideFunction(N.fieldMap,ea,N.textCase));this._cimLayers.push({type:"text",templateHash:M,materialHash:da||"function"===typeof ea||/\[(.*?)\]/.test(ea)?(ia,ka,la)=>ha+"-"+l.evaluateValueOrFunction(ea,ia,ka,la):ha+"-"+e.numericHash(ea),cim:N,materialOverrides:null,colorLocked:!!V||!!U,effects:D,alignment:L,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:"Relative"!==
A.anchorPointUnits,fontName:ha,decoration:Z,weight:X.weight,style:X.style,size:K,angle:P,offsetX:W,offsetY:aa,horizontalAlignment:l.fromCIMHorizontalAlignment(N.horizontalAlignment),verticalAlignment:l.fromCIMVerticalAlignment(N.verticalAlignment),text:ea,color:l.isFeatureValueFn(R)?R:H,outlineColor:T,outlineSize:O,backgroundColor:S,borderLineColor:Y,borderLineWidth:ba,lineWidth:null,referenceSize:Q,sizeRatio:1,markerPlacement:G})}}}_analyzeMultiLayerGraphicNonSDF(A,D,G,J,M,L,Q,N,U,Z){M=this._buildSimpleMarker(A,
M);const H=A.primitiveName,O=this._analyzeMaterialOverrides(H,["Rotation","OffsetX","OffsetY"]);var [,T]=this._analyzePrimitiveOverrides(L,null,null,null);const [V,X,I]=c.CIMSymbolHelper.getTextureAnchor(M,this._resourceManager);L=l.getValue(A.rotation);const K=l.getValue(A.offsetX),P=l.getValue(A.offsetY);T=e.numericHash(JSON.stringify(M)+T).toString();this._cimLayers.push({type:"marker",templateHash:T,materialHash:(O&&0<O.length||null!=D&&"function"===typeof D)&&O?this._createMaterialHashFunction(T,
O):T,cim:M,materialOverrides:O,colorLocked:!!A.colorLocked||!!Z,effects:D,scaleSymbolsProportionally:!!A.scaleSymbolsProportionally,alignment:Q,anchorPoint:{x:V,y:X},isAbsoluteAnchorPoint:!1,size:l.getValue(A.size,b.defaultMarkerSize),rotation:this._createOverrideFunction(H,"Rotation",L),offsetX:this._createOverrideFunction(H,"OffsetX",K),offsetY:this._createOverrideFunction(H,"OffsetY",P),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:U,rotateClockwise:!!A.rotateClockwise,
referenceSize:N,sizeRatio:I/f.pt2px(A.size),markerPlacement:G,animatedSymbolProperties:J,avoidSDFRasterization:!0})}_buildSimpleMarker(A,D){return{type:A.type,enable:!0,name:A.name,colorLocked:A.colorLocked,primitiveName:A.primitiveName,anchorPoint:A.anchorPoint,anchorPointUnits:A.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:A.rotateClockwise,rotation:0,size:A.size,billboardMode3D:A.billboardMode3D,depth3D:A.depth3D,frame:A.frame,markerGraphics:[D],scaleSymbolsProportionally:A.scaleSymbolsProportionally,
respectFrame:A.respectFrame,clippingPath:A.clippingPath}}_analyzeCompositeMarkerGraphic(A,D,G,J,M,L,Q,N,U,Z,H,O,T,V,X){var I=M.geometry;const K=L[0],P=L[1];var W=k.getExtent(I);if(W){L="Relative"!==A.anchorPointUnits;var [aa,R,S]=k.getSDFMetrics(W,A.frame,A.size,A.anchorPoint,L);I={type:"sdf",geom:I,asFill:!0};W=P.path;var Y=P.primitiveName,ba=K.primitiveName,ca=l.fromCIMColor(P.color),da=l.fromCIMColor(K.color),fa=l.getValue(K.width,b.defaultStrokeWidth),ea=M.primitiveName,ha=null;P.colorLocked||
X||(ha=this._createOverrideFunction(ea,"FillColor",ca,B));var ia=null;K.colorLocked||X||(ia=this._createOverrideFunction(ea,"StrokeColor",da,B));ea=this._createOverrideFunction(ea,"StrokeWidth",fa);var ka=!1,la="";for(const na of this._primitiveOverrides)if(na.primitiveName===Y||na.primitiveName===ba||Q.includes(na.primitiveName))null!=na.value?la+=`-${na.primitiveName}-${na.propertyName}-${JSON.stringify(na.value)}`:na.valueExpressionInfo&&(ka=!0);null!=G&&"function"===typeof G&&(ka=!0);if(l.isFeatureValueFn(H)||
l.isFeatureValueFn(O)||l.isFeatureValueFn(T)||l.isFeatureValueFn(V))ka=!0;Q=JSON.stringify({...A,markerGraphics:null});var ma=e.numericHash(JSON.stringify(I)+W).toString();M=e.numericHash(JSON.stringify(M)+JSON.stringify(P)+JSON.stringify(K)+Q+la).toString();this._cimLayers.push({type:"marker",templateHash:M,materialHash:ka?()=>ma:ma,cim:I,materialOverrides:null,colorLocked:!!X,effects:D,scaleSymbolsProportionally:!!A.scaleSymbolsProportionally,alignment:N,anchorPoint:{x:R,y:S},isAbsoluteAnchorPoint:L,
size:H,rotation:O,offsetX:T,offsetY:V,scaleX:1,frameHeight:Z,rotateClockwise:!1,referenceSize:U,sizeRatio:aa,color:l.isFeatureValueFn(ha)?ha:this._createOverrideFunction(Y,"Color",ca,B),outlineColor:l.isFeatureValueFn(ia)?ia:this._createOverrideFunction(ba,"Color",da,B),outlineWidth:l.isFeatureValueFn(ea)?ea:this._createOverrideFunction(ba,"Width",fa),markerPlacement:G,path:W,animatedSymbolProperties:J})}}_createMaterialHashFunction(A,D){const G=this._info?.geometryType;if(G){const J=this._poMap;
for(const M of D)if(M.valueExpressionInfo){const L=J[M.primitiveName]&&J[M.primitiveName][M.propertyName];L instanceof a.ArcadeExpression&&(M.fn=(Q,N,U)=>u(L,Q,{$view:U},G,N))}}return(J,M,L)=>{for(const Q of D)Q.fn&&(Q.value=Q.fn(J,M,L));return e.numericHash(A+c.OverrideHelper.buildOverrideKey(D)).toString()}}_setPoMap(A,D,G){let J;this._poMap[A]?J=this._poMap[A]:(J={},this._poMap[A]=J);J[D]=G}_createOverrideFunction(A,D,G,J,M){if(null==A)return G;A=this._poMap[A];if(null==A)return G;const L=A[D];
if("string"===typeof L||"number"===typeof L||L instanceof Array)return J?J.call(null,L,M):L;const Q=this._info?.geometryType;return null!=L&&L instanceof a.ArcadeExpression&&null!=Q?(N,U,Z)=>{N=u(L,N,{$view:Z},Q,U);null!==N&&J&&(N=J.call(null,N,M));return null!==N?N:G}:G}_createEffectsOverrideFunction(A,D){const G=this._poMap,J=this._info?.geometryType;for(const M of D)if(M.valueExpressionInfo&&J){const L=G[M.primitiveName]&&G[M.primitiveName][M.propertyName];L instanceof a.ArcadeExpression&&(M.fn=
(Q,N,U)=>u(L,Q,{$view:U},J,N))}return(M,L,Q)=>{for(var N of D)N.fn&&(N.value=N.fn(M,L,Q));M=[];for(let U of A){if(L=U?.primitiveName){Q=!1;for(const Z of D)Z.primitiveName===L&&(N=y(Z.propertyName),null!=Z.value&&Z.value!==U[N]&&(Q||(U=n.clone(U),Q=!0),U[N]=Z.value))}M.push(U)}return M}}_createMarkerPlacementOverrideFunction(A){const D=[];c.OverrideHelper.findApplicableOverrides(A,this._primitiveOverrides,D);if(null==A||0===D.length)return A;const G=this._poMap,J=this._info?.geometryType;for(const M of D)if(M.valueExpressionInfo&&
J){const L=G[M.primitiveName]&&G[M.primitiveName][M.propertyName];L instanceof a.ArcadeExpression&&(M.fn=(Q,N,U)=>u(L,Q,{$view:U},J,N))}return(M,L,Q)=>{for(const N of D)N.fn&&(N.value=N.fn(M,L,Q));M=n.clone(A);L=A.primitiveName;for(const N of D)N.primitiveName===L&&(Q=y(N.propertyName),null!=N.value&&N.value!==M[Q]&&(M[Q]=N.value));return M}}_createAnimatedSymbolPropertiesOverrideFunction(A){const D=[];c.OverrideHelper.findApplicableOverrides(A,this._primitiveOverrides,D);if(null==A||0===D.length)return A;
const G=this._info?.geometryType;if(G){const J=this._poMap;for(const M of D)if(M.valueExpressionInfo){const L=J[M.primitiveName]&&J[M.primitiveName][M.propertyName];L instanceof a.ArcadeExpression&&(M.fn=(Q,N,U)=>u(L,Q,{$view:U},G,N))}}return(J,M,L)=>{for(var Q of D)Q.fn&&(Q.value=Q.fn(J,M,L));J=n.clone(A);M=A.primitiveName;for(const N of D)N.primitiveName===M&&(L=y(N.propertyName),null!=N.value&&(Q=d.quantizeIfNeeded(N.value,N.propertyName),Q!==J[L]&&(J[L]=Q)));return J}}_analyzePrimitiveOverrides(A,
D,G,J){let M=!1,L="";"string"===typeof A&&(A=[A]);for(const Q of this._primitiveOverrides)A?.includes(Q.primitiveName)&&(null!=Q.value?L+=`-${Q.primitiveName}-${Q.propertyName}-${JSON.stringify(Q.value)}`:Q.valueExpressionInfo&&(M=!0));null!=D&&"function"===typeof D&&(M=!0);null!=G&&"function"===typeof G&&(M=!0);null!=J&&"function"===typeof J&&(M=!0);return[M,L]}_analyzeMaterialOverrides(A,D){return this._primitiveOverrides.filter(G=>G.primitiveName!==A||!D.includes(G.propertyName))}_transformSize(A,
D){return l.isFeatureValueFn(A)||l.isFeatureValueFn(D)?(G,J,M)=>{const L=l.isFeatureValueFn(A)?A(G,J,M):A;G=l.isFeatureValueFn(D)?D(G,J,M):D;return L*G}:A*D}_transformRotation(A,D,G){return l.isFeatureValueFn(A)||l.isFeatureValueFn(G)?(J,M,L)=>{const Q=l.isFeatureValueFn(A)?A(J,M,L):A;J=l.isFeatureValueFn(G)?G(J,M,L):G;return D?J-Q:J+Q}:D?G-A:G+A}_transformOffsetX(A,D,G,J,M){if(!(l.isFeatureValueFn(A)||l.isFeatureValueFn(D)||l.isFeatureValueFn(G)||l.isFeatureValueFn(J)||l.isFeatureValueFn(M))){const L=
G*Math.PI/180;return L?(Math.cos(L)*A-Math.sin(L)*D)*J+M:A*J+M}return(L,Q,N)=>{var U=l.isFeatureValueFn(G)?G(L,Q,N):G;const Z=l.isFeatureValueFn(J)?J(L,Q,N):J,H=l.isFeatureValueFn(A)?A(L,Q,N):A,O=l.isFeatureValueFn(M)?M(L,Q,N):M;if(U){U*=Math.PI/180;const T=Math.cos(U);U=Math.sin(U);L=l.isFeatureValueFn(D)?D(L,Q,N):D;return(T*H-U*L)*Z+O}return H*Z+O}}_transformOffsetY(A,D,G,J,M){if(!(l.isFeatureValueFn(A)||l.isFeatureValueFn(D)||l.isFeatureValueFn(G)||l.isFeatureValueFn(J)||l.isFeatureValueFn(M))){const L=
G*Math.PI/180;return L?(Math.sin(L)*A+Math.cos(L)*D)*J+M:D*J+M}return(L,Q,N)=>{var U=l.isFeatureValueFn(G)?G(L,Q,N):G;const Z=l.isFeatureValueFn(J)?J(L,Q,N):J,H=l.isFeatureValueFn(D)?D(L,Q,N):D,O=l.isFeatureValueFn(M)?M(L,Q,N):M;if(U){U*=Math.PI/180;const T=Math.cos(U);U=Math.sin(U);L=l.isFeatureValueFn(A)?A(L,Q,N):A;return(U*L+T*H)*Z+O}return H*Z+O}}}h.CIMAnalyzer=C;h.analyzeCIMResource=function(A,D){if(!D||0===D.length)return A;A=n.clone(A);c.OverrideHelper.applyOverrides(A,D);return A};Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/quantizeTime":function(){define(["exports"],function(h){const g=new Set(["StartTimeOffset","Duration","RepeatDelay"]);h.quantizeIfNeeded=function(v,n){return g.has(n)?.05*Math.max(Math.round(v/.05),1):v};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(h,g,v,n,p,f,e,a,b,c){class m extends a(b){constructor(d,k,l){super(d);this._minMaxZoom=p.i1616to32(Math.round(k*n.minMaxZoomPrecisionFactor),Math.round(l*n.minMaxZoomPrecisionFactor));this._cimLineLayer=d;let r=0;g.isFeatureValueFn(d.width)||(r=.5*h.pt2px(d.width));this._dynamicPropertyMap.set("_halfWidth",(x,z,q)=>g.isFeatureValueFn(d.width)?.5*h.pt2px(d.width(x,z,q)):r);g.isFeatureValueFn(d.cap)?this._dynamicPropertyMap.set("_capType",d.cap):this._capType=d.cap;g.isFeatureValueFn(d.join)?
this._dynamicPropertyMap.set("_joinType",d.join):this._joinType=d.join;const u=d.color;g.isFeatureValueFn(u)?this._dynamicPropertyMap.set("_fillColor",(x,z,q)=>v.premultiplyAlphaRGBA(u(x,z,q))):this._fillColor=u&&v.premultiplyAlphaRGBA(u)||0;const w=d.miterLimit;g.isFeatureValueFn(w)?this._dynamicPropertyMap.set("_miterLimitCosine",(x,z,q)=>e.getLimitCosine(w(x,z,q))):this._miterLimitCosine=e.getLimitCosine(w);null!=d.effects&&(k=d.effects,g.isFeatureValueFn(k)?this._dynamicPropertyMap.set("_effects",
k):this._effects=k);this._scaleFactor=d.scaleFactor||1;this._isDashed=null!=d.dashTemplate;this.tessellationProperties._bitset=(d.colorLocked?n.bitsetGenericLockColor:0)|(d.scaleDash?n.bitsetLineScaleDash:0)|(d.sampleAlphaOnly?n.bitsetGenericConsiderAlphaOnly:0);this._materialKey=d.materialKey;this._initializeTessellator(!0)}static fromCIMLine(d,k){const [l,r]=e.getMinMaxZoom(d.scaleInfo,k);return new m(d,l,r)}bindFeature(d,k,l){const r=d.readLegacyFeature();this._dynamicPropertyMap.forEach((w,x)=>
{this[x]=w(r,k,l)});this._halfWidth*=this._scaleFactor;d=this._materialCache;var u=this._cimLineLayer.materialHash;u=u(r,k,l);u=d.get(u);d=null;u&&c.ok(u.spriteMosaicItem)&&(d=u.spriteMosaicItem);if(d){this._hasPattern=!0;const {rect:w,width:x,height:z}=d;u=w.x+n.spritePadding;const q=w.y+n.spritePadding,t=u+x,B=q+z;this.tessellationProperties._tl=p.i1616to32(u,q);this.tessellationProperties._br=p.i1616to32(t,B)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=
0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties.offset=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;u=f.LineMaterialKey.load(this._materialKey);d&&(u.sdf=d.sdf,u.pattern=!0,u.textureBinding=d.textureBinding);this._materialKey=u.data}}return m})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r){const u=p.create(),w=n.create();class x extends k(l){constructor(z,q,t){super(z);this._cimMarkerLayer=z;this._minMaxZoom=c.i1616to32(Math.round(q*b.minMaxZoomPrecisionFactor),Math.round(t*b.minMaxZoomPrecisionFactor));const B=z.color;e.isFeatureValueFn(B)?this._dynamicPropertyMap.set("_fillColor",(D,G,J)=>a.premultiplyAlphaRGBA(B(D,G,J))):this._fillColor=a.premultiplyAlphaRGBA(B);const y=z.outlineColor;e.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_outlineColor",
(D,G,J)=>a.premultiplyAlphaRGBA(y(D,G,J))):this._outlineColor=a.premultiplyAlphaRGBA(y);const E=z.size;e.isFeatureValueFn(E)?this._dynamicPropertyMap.set("_size",(D,G,J)=>v.pt2px(E(D,G,J))):this._size=v.pt2px(E)||0;q=z.scaleX;e.isFeatureValueFn(q)?this._dynamicPropertyMap.set("_scaleX",q):this._scaleX=q;const F=z.offsetX;e.isFeatureValueFn(F)?this._dynamicPropertyMap.set("xOffset",(D,G,J)=>v.pt2px(F(D,G,J))):this.xOffset=v.pt2px(F)||0;const C=z.offsetY;e.isFeatureValueFn(C)?this._dynamicPropertyMap.set("yOffset",
(D,G,J)=>v.pt2px(C(D,G,J))):this.yOffset=v.pt2px(C)||0;const A=z.outlineWidth;e.isFeatureValueFn(A)?this._dynamicPropertyMap.set("_outlineWidth",(D,G,J)=>v.pt2px(A(D,G,J))):this._outlineWidth=v.pt2px(A)||0;q=z.rotation;e.isFeatureValueFn(q)?this._dynamicPropertyMap.set("_angle",q):this._angle=q||0;null!=z.effects&&(q=z.effects,e.isFeatureValueFn(q)?this._dynamicPropertyMap.set("_effects",q):this._effects=q);null!=z.markerPlacement&&(q=z.markerPlacement,e.isFeatureValueFn(q)?this._dynamicPropertyMap.set("_markerPlacement",
q):this._markerPlacement=q);this._scaleFactor=z.scaleFactor??1;this._bitSet=(z.alignment===f.Alignment.MAP?b.bitsetMarkerAlignmentMap:b.bitsetMarkerAlignmentScreen)|(z.colorLocked?b.bitsetGenericLockColor:0)|(z.scaleSymbolsProportionally?b.bitsetMarkerScaleSymbolsProportionally:0);this._materialKey=z.materialKey}static fromCIMMarker(z,q){const [t,B]=d.getMinMaxZoom(z.scaleInfo,q);return new x(z,t,B)}bindFeature(z,q,t){const B=z.readLegacyFeature();z=z.getObjectId();this._dynamicPropertyMap.forEach((Z,
H)=>{this[H]=Z(B,q,t)});var y=this._cimMarkerLayer.materialHash;z="function"===typeof y?y(B,q,t,z):y;if((z=this._materialCache.get(z))&&r.ok(z.spriteMosaicItem)&&z.spriteMosaicItem){z=z.spriteMosaicItem;y=this._cimMarkerLayer.sizeRatio;var E=z.width/z.height*this._scaleX,F=m.MarkerMaterialKey.load(this._materialKey);F.sdf=z.sdf;F.pattern=!0;F.textureBinding=z.textureBinding;this._materialKey=F.data;var C=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,A=this._size,D=A*E,G=this.xOffset,
J=this.yOffset;this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var M=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/v.pt2px(this._cimMarkerLayer.frameHeight):1;M*=this._outlineWidth;var L=v.pt2px(this._cimMarkerLayer.referenceSize),Q=0,N=0,U=this._cimMarkerLayer.anchorPoint;U&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(Q=v.pt2px(U.x)/(this._size*E),N=v.pt2px(U.y)/this._size):(Q=U.x,N=U.y));this._anchorX=Q;this._anchorY=N;
this._sizeOutlineWidth=c.i8888to32(Math.round(Math.min(Math.sqrt(128*D),255)),Math.round(Math.min(Math.sqrt(128*A),255)),Math.round(Math.min(Math.sqrt(128*M),255)),Math.round(Math.min(Math.sqrt(128*L),255)));this.angle=C;this._bitestAndDistRatio=c.i1616to32(this._bitSet,Math.round(64*y));this._computeSize(D,A,y,M,this._scaleFactor,z,F.hasSizeVV(),!0);this._applyTransformation(w,u);this.xOffset=G;this.yOffset=J}else g.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new h("mapview-cim",
"Encountered an error when binding feature"))}}return x})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(h,g,v,n,p,f,e,a,b,c,m,d){class k extends c(m){constructor(l,
r,u){super(l);this._horizontalAlignment="center";this._verticalAlignment="middle";this._textToGlyphs=new Map;this._minMaxZoom=e.i1616to32(Math.round(r*f.minMaxZoomPrecisionFactor),Math.round(u*f.minMaxZoomPrecisionFactor));r=l.scaleFactor||1;this._cimTextLayer=l;const w=l.color;v.isFeatureValueFn(w)?this._dynamicPropertyMap.set("_color",(B,y,E)=>p.premultiplyAlphaRGBA(w(B,y,E))):this._color=p.premultiplyAlphaRGBA(w);const x=l.outlineColor;v.isFeatureValueFn(x)?this._dynamicPropertyMap.set("_haloColor",
(B,y,E)=>p.premultiplyAlphaRGBA(x(B,y,E))):this._haloColor=p.premultiplyAlphaRGBA(x);let z;v.isFeatureValueFn(l.size)||(z=Math.min(Math.round(h.pt2px(l.size*l.sizeRatio)),127));this._dynamicPropertyMap.set("_size",(B,y,E)=>v.isFeatureValueFn(l.size)?Math.min(Math.round(h.pt2px(l.size(B,y,E)*l.sizeRatio)),127):z);v.isFeatureValueFn(l.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(B,y,E)=>Math.min(Math.floor(5*h.pt2px(l.outlineSize(B,y,E)*l.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*
h.pt2px(l.outlineSize*l.sizeRatio)),127);let q;v.isFeatureValueFn(l.offsetX)||(q=Math.round(h.pt2px(l.offsetX*l.sizeRatio)));this._dynamicPropertyMap.set("_xOffset",(B,y,E)=>v.isFeatureValueFn(l.offsetX)?Math.round(h.pt2px(l.offsetX(B,y,E)*l.sizeRatio)):q);let t;v.isFeatureValueFn(l.offsetY)||(t=Math.round(h.pt2px(l.offsetY*l.sizeRatio)));this._dynamicPropertyMap.set("_yOffset",(B,y,E)=>v.isFeatureValueFn(l.offsetY)?Math.round(h.pt2px(l.offsetY(B,y,E)*l.sizeRatio)):t);v.isFeatureValueFn(l.angle)?
this._dynamicPropertyMap.set("_angle",l.angle):this._angle=l.angle;v.isFeatureValueFn(l.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",l.horizontalAlignment):this._horizontalAlignment=l.horizontalAlignment;v.isFeatureValueFn(l.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",l.verticalAlignment):this._verticalAlignment=l.verticalAlignment;null!=l.effects&&(u=l.effects,v.isFeatureValueFn(u)?this._dynamicPropertyMap.set("_effects",u):this._effects=u);null!=
l.markerPlacement&&(u=l.markerPlacement,v.isFeatureValueFn(u)?this._dynamicPropertyMap.set("_markerPlacement",u):this._textPlacement=u);v.isFeatureValueFn(l.text)?this._dynamicPropertyMap.set("_text",l.text):this._text=l.text;this._backgroundColor=l.backgroundColor&&p.premultiplyAlphaRGBA(l.backgroundColor);this._borderLineColor=l.borderLineColor&&p.premultiplyAlphaRGBA(l.borderLineColor);this._borderLineSize=l.borderLineWidth;this._scaleFactor=r;r=Math.min(Math.round(h.pt2px(l.referenceSize*l.sizeRatio)),
127);this._referenceSize=Math.round(Math.sqrt(256*r));this._materialKey=l.materialKey;r=a.TextMaterialKey.load(this._materialKey);r.sdf=!0;this._bitset=(l.alignment===g.Alignment.MAP?1:0)|(l.colorLocked?1:0)<<1;this._materialKey=r.data;this._decoration="none";this._lineHeight=1;this._lineWidth=512;this._isCIM=!0}static fromCIMText(l,r){const [u,w]=b.getMinMaxZoom(l.scaleInfo,r);return new k(l,u,w)}async analyze(l,r,u,w){var x=r.readLegacyFeature();var z=this._cimTextLayer;x="string"===typeof z.text?
z.text:"function"===typeof z.text?z.text(x,u,w)??"":"";l=await super.analyze(l,r,u,w,d.codepoints(x));l?.glyphMosaicItems&&this._textToGlyphs.set(x,l.glyphMosaicItems);return l}bindFeature(l,r,u){const w=l.readLegacyFeature();this._dynamicPropertyMap.forEach((x,z)=>{this[z]=x(w,r,u)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/f.glyphSize,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=n.getXAnchorDirection(this._horizontalAlignment??
"center"),this._yAlignD=n.getYAnchorDirection(this._verticalAlignment??"baseline"),l=this._textToGlyphs.get(this._text)??[],this.bindTextInfo(l,!1)):this._shapingInfo=null}}return k})},"esri/views/2d/layers/features/textUtils":function(){define(["exports"],function(h){h.codepoints=function(g){if(null==g)return[];const v=Array(g.length);for(let n=0;n<g.length;n++)v[n]=g.charCodeAt(n);return v};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLMeshTemplate".split(" "),
function(h,g,v,n,p,f,e,a,b){class c extends a(b){constructor(m,d,k,l,r,u,w,x,z,q,t,B,y,E,F,C){super();this._effects=E||void 0;m=f.FillMaterialKey.load(m);d&&(m.sdf=d.sdf,m.pattern=!0,m.textureBinding=d.textureBinding);this.fillColor=k;this.tl=l;this.br=r;this.aux21=p.i1616to32(u,w);this.aux22=p.i1616to32(x,z);this.aux3=p.i8888to32(q,t,B,0);this._bitset=y;this._minMaxZoom=p.i1616to32(Math.round(F*v.minMaxZoomPrecisionFactor),Math.round(C*v.minMaxZoomPrecisionFactor));this._materialKey=m.data}static fromCIMFill(m,
d,k){var l=m.color;l=l&&g.premultiplyAlphaRGBA(l)||0;const r=m.materialKey,[u,w]=e.getMinMaxZoom(m.scaleInfo,k);k=(m.colorLocked?v.bitsetGenericLockColor:0)|(m.applyRandomOffset?v.bitsetFillRandomPatternOffset:0)|(m.sampleAlphaOnly?v.bitsetGenericConsiderAlphaOnly:0)|(m.hasUnresolvedReplacementColor?v.bitsetFillHasUnresolvedReplacementColor:0);if(!d)return new c(r,null,l,0,0,0,0,0,0,0,0,0,k,m.effects,u,w);const {rect:x,width:z,height:q}=d;var t=m.scaleX||1,B=x.x+v.spritePadding;const y=x.y+v.spritePadding;
var E=B+z;const F=y+q;var C=h.pt2px(m.height);t*=C;"CIMHatchFill"===m.cim.type&&(t*=z/q);0>=C&&(C=F-y);C<v.maxSizeForU16Compression&&(C*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternHeightPrecisionFactor);C=Math.round(C);0>=t&&(t=E-B);t<v.maxSizeForU16Compression&&(t*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternWidthPrecisionFactor);t=Math.round(t);const A=h.pt2px(m.offsetX||0),D=h.pt2px(-m.offsetY||0);B=p.i1616to32(B,y);E=p.i1616to32(E,F);return new c(r,d,l,B,E,t,C,A,D,v.compressionFactorForU16,
v.compressionFactorForU16,n.degToByte(m.angle),k,m.effects,u,w)}static fromSimpleFill(m,d,k=!1){var {color:l}=m;l=l&&"esriSFSNull"!==m.style&&g.premultiplyAlphaRGBAArray(l)||0;k=k?v.bitsetGenericLockColor:0;const r=m.materialKey;if(d){const {rect:q,width:t,height:B,pixelRatio:y}=d;var u=q.x+v.spritePadding,w=q.y+v.spritePadding,x=u+t,z=w+B;u=p.i1616to32(u,w);x=p.i1616to32(x,z);z=t/y;z<v.maxSizeForU16Compression&&(z*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternWidthPrecisionFactor);z=Math.round(z);
w=B/y;w<v.maxSizeForU16Compression&&(w*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternHeightPrecisionFactor);w=Math.round(w);d=new c(r,d,l,u,x,z,w,0,0,v.compressionFactorForU16,v.compressionFactorForU16,0,k,null,e.defaultMinZoom,e.defaultMaxZoom)}else d=new c(r,null,l,0,0,0,0,0,0,0,0,0,k,null,e.defaultMinZoom,e.defaultMaxZoom);d._maybeAddLineTemplate(m);return d}static fromPictureFill(m,d,k=!1){const l=v.pictureFillColor,{rect:r,width:u,height:w}=d;var x=r.x+v.spritePadding,z=r.y+v.spritePadding,
q=x+u,t=z+w;x=p.i1616to32(x,z);q=p.i1616to32(q,t);k=k?v.bitsetGenericLockColor:0;t=h.pt2px(m.width);t<v.maxSizeForU16Compression&&(t*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternWidthPrecisionFactor);t=Math.round(t);z=h.pt2px(m.height);z<v.maxSizeForU16Compression&&(z*=v.compressionFactorForU16,k|=v.bitsetFillHasPatternHeightPrecisionFactor);z=Math.round(z);const B=h.pt2px(m.xoffset),y=h.pt2px(-m.yoffset);d=new c(m.materialKey,d,l,x,q,t,z,B,y,v.compressionFactorForU16*m.xscale,v.compressionFactorForU16*
m.yscale,0,k,null,e.defaultMinZoom,e.defaultMaxZoom);d._maybeAddLineTemplate(m);return d}}return c})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["exports","../../../../../core/promiseUtils"],function(h,g){class v{constructor(){this._resolver=null}isHeld(){return!!this._resolver}async acquire(){this._resolver?(await this._resolver.promise,await this.acquire()):this._resolver=g.createResolver()}release(){const n=this._resolver;this._resolver=null;n?.resolve()}}h.Lock=v;h.withLock=async function(n,
p,f){try{await n.acquire(),await p(f),n.release()}catch(e){throw n.release(),e;}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/cimSymbolUtils":function(){define(["require","exports","../../../../symbols/cim/cimAnalyzer","../../../../symbols/cim/ExpandedCIM"],function(h,g,v,n){const p=async(f,e,a)=>{e=new v.CIMAnalyzer(a,e);return new n.ExpandedCIM(await e.analyzeSymbolReference(f.data,!1),f.data,f.rendererKey,f.maxVVSize)};g.cimLayerToRasterizationInfo=
function(f){if(!f)return null;const {avoidSDFRasterization:e,type:a,cim:b,url:c,materialHash:m,maxVVSize:d}=f,k={cim:b,type:a,mosaicHash:m,url:c,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:e};switch(a){case "marker":d&&"size"in b&&(b.size=Math.max(d,b.size));k.size=f.size;k.path=f.path;k.animatedSymbolProperties=f.animatedSymbolProperties;break;case "line":k.dashTemplate=f.dashTemplate;break;case "text":k.text=f.text,k.fontName=
f.fontName}return k};g.expandSymbol=async function(f,e,a,b){if(!f)return null;if("cim"===f.type)return p(f,e,a);if("web-style"===f.type){const {fetchCIMSymbolReference:c}=await new Promise((m,d)=>h(["./webStyleUtils"],m,d));f={type:"cim",data:await c(f,null,b)??void 0,rendererKey:f.rendererKey,maxVVSize:f.maxVVSize};return p(f,e,a)}return f};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/ExpandedCIM":function(){define(["exports","../../views/2d/engine/webgl/enums",
"../../views/2d/engine/webgl/materialKey/MaterialKey"],function(h,g,v){const n={marker:g.WGLGeometryType.MARKER,fill:g.WGLGeometryType.FILL,line:g.WGLGeometryType.LINE,text:g.WGLGeometryType.TEXT};class p{constructor(f,e,a,b){const c={minScale:e?.minScale,maxScale:e?.maxScale};var m=c.minScale||c.maxScale?c.minScale+"-"+c.maxScale:"";this.layers=f;this.data=e;this.hash=this._createHash()+m;this.rendererKey=a;e={isOutline:!1,placement:null,symbologyType:g.WGLSymbologyType.DEFAULT,vvFlags:a};for(const d of f)f=
n[d.type],e.isOutline="line"===d.type&&d.isOutline,d.materialKey=v.createMaterialKey(f,e),d.maxVVSize=b,d.scaleInfo=c,d.templateHash+=m}get type(){return"expanded-cim"}_createHash(){let f="";for(const e of this.layers)f+=e.templateHash;return f}}h.ExpandedCIM=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/Logger ../../../../../core/LRUCache ../../../../../support/arcadeOnDemand ../../../arcade/callExpressionWithFeature ../../../layers/support/cimSymbolUtils".split(" "),
function(h,g,v,n,p,f,e,a,b){async function c(q,t,B,y){switch(q.type){case "simple":case "heatmap":return l.fromBasicRenderer(q,t,B,y);case "map":return w.fromUVRenderer(q,t,B,y);case "interval":return u.fromCBRenderer(q,t,B,y);case "dictionary":return z.fromDictionaryRenderer(q,t,B,y);case "pie-chart":return r.fromPieChartRenderer(q,t,B,y);case "subtype":return r.fromSubtypes(q,t,B,y)}}async function m(q,t){const B=q||1;if("number"===typeof B)return(E,F,C)=>B;const y=await e.createRendererExpression(B,
t.spatialReference,t.fields);return(E,F,C)=>a(y,E,{$view:C},t.geometryType,F)||1}async function d(){x||(x=new Promise((q,t)=>h(["../../../layers/features/createSymbolSchema"],q,t)));return x}const k=p.getLogger("esri/views/2d/engine/webgl/util/Matcher");class l{constructor(){this.type="feature";this._defaultResult=null}static async fromBasicRenderer(q,t,B,y){const E=new l;q.symbol&&(q=await b.expandSymbol(q.symbol,B,y),t=t.createTemplateGroup(q,null),E.setDefault(t));return E}static async fromPieChartRenderer(q,
t,B,y){const E=new l;if(q.markerSymbol){const F=await b.expandSymbol(q.markerSymbol,B,y);let C;q.fillSymbol&&(C=await b.expandSymbol(q.fillSymbol,B,y));q=t.createTemplateGroup(F,C);E.setDefault(q)}return E}size(){return 1}getDefault(){return this._defaultResult}setDefault(q){this._defaultResult=q}match(q,t,B,y,E){return this.getDefault()}async analyze(q,t,B,y,E,F){return null}}class r extends l{constructor(q,t){super();this._subMatchers=q;this._subtypeField=t}static async fromSubtypes(q,t,B,y){const E=
new Map,F=[];for(const C in q.renderers){const A=parseInt(C,10),D=c(q.renderers[C],t,B,y).then(G=>E.set(A,G));F.push(D)}await Promise.all(F);return new r(E,q.subtypeField)}match(q,t,B,y,E){var F=t.readAttribute(this._subtypeField);return(F=this._subMatchers.get(F))?F.match(q,t,B,y,E):null}}class u extends l{constructor(q,t,B,y){super();this.type="interval";this._intervals=[];this._isMaxInclusive=t;this._fieldIndex=y;this._field=q;this._normalizationInfo=B}static async fromCBRenderer(q,t,B,y){const {isMaxInclusive:E,
normalizationField:F,normalizationTotal:C,normalizationType:A}=q,D=new u(q.field,E,{normalizationField:F,normalizationTotal:C,normalizationType:A},q.fieldIndex),G=await b.expandSymbol(q.backgroundFillSymbol,B,y);await Promise.all(q.intervals.map(async J=>{var M=await b.expandSymbol(J.symbol,B,y);M=t.createTemplateGroup(M,G);D.add({min:J.min,max:J.max},M)}));if(q=await b.expandSymbol(q.defaultSymbol,B,y))q=t.createTemplateGroup(q,G),D.setDefault(q);return D}add(q,t){this._intervals.push({interval:q,
result:t});this._intervals.sort((B,y)=>B.interval.min-y.interval.min)}size(){return super.size()+this._intervals.length}match(q,t,B,y,E){if(null==this._fieldIndex&&!this._field)return this.getDefault();q=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(null===q||void 0===q||isNaN(q)||Infinity===q||-Infinity===q)return this.getDefault();for(t=0;t<this._intervals.length;t++){const {interval:F,result:C}=this._intervals[t];B=this._isMaxInclusive?q<=F.max:
q<F.max;if(q>=F.min&&B)return C}return this.getDefault()}_needsNormalization(){const q=this._normalizationInfo;return q&&(q.normalizationField||q.normalizationTotal||q.normalizationType)}_getValueFromField(q){const t=q.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;const {normalizationField:B,normalizationTotal:y,normalizationType:E}=this._normalizationInfo;q=q.readAttribute(B)??1;if(E)switch(E){case "esriNormalizeByField":return(q||void 0)&&t/q;case "esriNormalizeByLog":return Math.log(t)*
Math.LOG10E;case "esriNormalizeByPercentOfTotal":return t/y*100;default:k.error(`Found unknown normalization type: ${E}`)}else k.error("Normalization is required, but no type was set!")}}class w extends l{constructor(q,t,B){super();this.type="map";this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fieldsIndex=B;this._fields=q;this._seperator=t||""}static async fromUVRenderer(q,t,B,y){const E=q.fieldDelimiter,F=[q.field];q.field2&&F.push(q.field2);q.field3&&F.push(q.field3);const C=
await b.expandSymbol(q.backgroundFillSymbol,B,y),A=new w(F,E,q.fieldIndex);await Promise.all(q.map.map(async(D,G)=>{const J=await b.expandSymbol(D.symbol,B,y);G=t.createTemplateGroup(J,C,G+1);"\x3cNull\x3e"===D.value?A.setNullResult(G):A.add(D.value,G)}));if(q=await b.expandSymbol(q.defaultSymbol,B,y))q=t.createTemplateGroup(q,C,Number.MAX_SAFE_INTEGER),A.setDefault(q);return A}setNullResult(q){this._nullResult=q}add(q,t){this._resultsMap.set(q.toString(),t)}size(){return super.size()+this._resultsMap.size}match(q,
t,B,y,E){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();q=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==q||""===q||"\x3cNull\x3e"===q))return this._nullResult;if(null==q)return this.getDefault();q=q.toString();return this._resultsMap.has(q)?this._resultsMap.get(q):this.getDefault()}_getValueFromFields(q){const t=[];for(const B of this._fields){const y=q.readAttribute(B);null==y||""===y?t.push("\x3cNull\x3e"):
t.push(y)}return t.join(this._seperator)}}let x;class z extends l{constructor(q,t,B,y,E,F){super();this.type="dictionary";this._groupIdCache=new f.LRUCache(100);this._loader=q;this._fieldMap=q.fieldMap;this._symbolFields=q.getSymbolFields();this._templates=t;this._info=B;this._scaleFn=y;this._schemaUtilsModule=E;this._symbolOptions=F}static async fromDictionaryRenderer(q,t,B,y){const [{DictionaryLoader:E},F]=await Promise.all([new Promise((A,D)=>h(["../../../../../renderers/support/DictionaryLoader"],
A,D)),d()]);y=new E(q.url,q.config,q.fieldMap);await y.fetchResources({spatialReference:B.spatialReference,fields:B.fields});const C=await m(q.scaleExpression,B);return new z(y,t,B,C,F,q.symbolOptions)}async _analyzeFeature(q,t,B,y,E){q=q.readLegacyFeature();const F=this._scaleFn(q,B,y);B=this._attributeHash(q)+"-"+F;const C=this._groupIdCache.get(B);if(C)return C;y=await this._loader.getSymbolAsync(q,{...y,spatialReference:this._info.spatialReference,abortOptions:E,fields:this._info.fields});y=this._schemaUtilsModule.createSymbolSchema(y,
this._symbolOptions);t=b.expandSymbol(y,this._info,t,E).then(A=>{if("expanded-cim"!==A?.type)return k.error(new n("mapview-bad-type",`Found unexpected type ${A?.type} in dictionary response`)),null;A.hash+="-"+F;for(const D of A.layers)D.scaleFactor=F,D.templateHash+="-"+F;return this._templates.createTemplateGroup(A,null)});this._groupIdCache.put(B,t,1);return t}async analyze(q,t,B,y,E,F){q=t.getCursor();for(t=[];q.next();)t.push(this._analyzeFeature(q,B,y,E,F));return Promise.all(t).then(C=>C.filter(v.isSome))}match(q,
t,B,y,E){return null}_attributeHash(q){let t="";for(const B of this._symbolFields){const y=this._fieldMap?.[B];y&&(t+=q.attributes[y]+"-")}return t}}g.DictionaryMatcher=z;g.FeatureMatcher=l;g.IntervalMatcher=u;g.MapMatcher=w;g.SubtypeMatcher=r;g.createMatcher=c;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schemaUtils":function(){define("exports ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/screenUtils ../../../../core/sql ../../../../core/accessorSupport/diffUtils ../../../../layers/support/labelingInfo ../../engine/webgl/enums ../../engine/webgl/Utils ../../engine/webgl/techniques/utils ../../engine/webgl/util/vvFlagUtils ./createSymbolSchema ./support/pixelBuffering ./support/rendererUtils ../support/clusterUtils ../support/util".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x){function z(R,S){let Y=0,ba=0,ca=c.WGLSymbologyType.DEFAULT;if(null!=R){ba=r.getPtMaxVVSize(R,S);"visualVariables"in R&&(Y=k.getVVFlags(R.visualVariables||[]),"dot-density"===R.type&&(ca=c.WGLSymbologyType.DOT_DENSITY));"heatmap"===R.type&&(ca=c.WGLSymbologyType.HEATMAP);if("dictionary"===R.type)return{maxVVSize:ba,vvFlags:Y,symbologyType:c.WGLSymbologyType.DEFAULT};if("pie-chart"===R.type)return{maxVVSize:ba,vvFlags:Y,symbologyType:c.WGLSymbologyType.PIE_CHART};
if(ca!==c.WGLSymbologyType.DOT_DENSITY&&ca!==c.WGLSymbologyType.HEATMAP){var da=R.getSymbols();"backgroundFillSymbol"in R&&R.backgroundFillSymbol&&da.push(R.backgroundFillSymbol);S=R=!0;for(const ea of da){if("cim"===ea.type||"web-style"===ea.type)S=!1;if("simple-fill"===ea.type||"picture-fill"===ea.type){da=(da=ea.outline)&&"none"!==da.style&&"solid"!==da.style;var fa="simple-fill"===ea.type&&"none"!==ea.style&&"solid"!==ea.style;fa="picture-fill"===ea.type||fa||da;da&&(R=!1);fa&&(S=!1)}}R?ca=S?
c.WGLSymbologyType.OUTLINE_FILL_SIMPLE:c.WGLSymbologyType.OUTLINE_FILL:S&&(ca=c.WGLSymbologyType.SIMPLE)}}return{vvFlags:Y,maxVVSize:ba,symbologyType:ca}}function q(R,S=!1){try{const ba=J(R,S);var Y="heatmap"===R.renderer?.type&&"raster"===u.getSupportedHeatmapRenderer()?{type:"heatmap"}:{type:"symbol"};const ca={};ba.map(da=>t(ca,R,da));return{source:{definitionExpression:e.sqlAnd(R.definitionExpression,null!=R.subtypeCode?`${R.subtypeField} = ${R.subtypeCode}`:null),fields:R.fields.map(da=>da.toJSON()),
gdbVersion:R.gdbVersion,historicMoment:R.historicMoment?.getTime(),outFields:R.availableFields,pixelBuffer:R.pixelBuffer,spatialReference:R.spatialReference.toJSON(),timeExtent:R.timeExtent?.toJSON(),customParameters:R.customParameters},attributes:{fields:{},indexCount:0},processors:ba,tileRenderer:Y,targets:ca}}catch(ba){if("ValidationError"===ba.fieldName)return W.error(ba),null;throw ba;}}function t(R,S,Y){switch(Y.target){case "feature":E(R,y(S),Y);break;case "aggregate":if("featureReduction"in
S){var ba=S.featureReduction;switch(ba?.type){case "selection":throw new v("ValidationError","Mapview does not support `selection` reduction type",ba);case "binning":E(R,y(S),Y);C(R,ba,S.fields.map(ca=>ca.toJSON()),Y);break;case "cluster":E(R,y(S),Y),A(R,ba,S.fields.map(ca=>ca.toJSON()),Y)}}}}function B(R,S){for(const ba in S){const ca=S[ba];if(ca.target===R.name){var Y=R.attributes[ba];Y?.context?(Y=Y.context,Y.mesh=Y.mesh||ca.context?.mesh,Y.storage=Y.storage||ca.context?.storage):R.attributes[ba]=
ca}}return R}function y(R){return[R.filter?.toJSON()??null,R.featureEffect?.filter?.toJSON()??null]}function E(R,S,Y){R.feature||(R.feature={name:"feature",input:"source",filters:S,attributes:{}});B(R.feature,Y.attributes.fields);return R}function F(R,S){const {onStatisticExpression:Y,onStatisticField:ba,statisticType:ca}=R;switch(ca){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":if(Y)return{returnType:S}=Y,S?"string"===S?"esriFieldTypeString":
"esriFieldTypeDouble":(W.error(new v("ValidationError","Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",R)),"esriFieldTypeString");S=S.find(da=>da.name===ba);return S?S.type:(W.error(new v("ValidationError","Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",R)),"esriFieldTypeString")}}function C(R,S,Y,ba){R.aggregate||(R.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:S.fixedBinLevel,
fields:(S.fields??[]).map(ca=>({...ca.toJSON(),type:F(ca,Y)}))},attributes:{}});B(R.aggregate,ba.attributes.fields);return R}function A(R,S,Y,ba){const ca=ba.aggregateFields??[],da=new Set;for(const fa of ca)da.add(fa.name);for(const fa of S?.fields??[])da.has(fa.name)||ca.push(fa);R.aggregate||(R.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:f.pt2px(S.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(f.pt2px(S.clusterMaxSize)/64),fields:ca.map(fa=>
({...fa.toJSON(),type:F(fa,Y)}))}});B(R.aggregate,ba.attributes.fields);return R}function D(R,S){return S.field?G(R,{...S,type:"field",field:S.field}):S.valueExpression?G(R,{...S,type:"expression",valueExpression:S.valueExpression}):{field:void 0,fieldIndex:void 0}}function G(R,S){switch(S.type){case "expression":var Y=S.valueExpression;if(!R.fields[Y]){var ba=R.indexCount++;R.fields[Y]={...S,name:Y,fieldIndex:ba}}return{fieldIndex:R.fields[Y].fieldIndex};case "label-expression":return Y=JSON.stringify(S.label),
R.fields[Y]||(ba=R.indexCount++,R.fields[Y]={...S,name:Y,fieldIndex:ba}),{fieldIndex:R.fields[Y].fieldIndex};case "field":Y=S.field;if("aggregate"===S.target&&R.fields[Y])return{field:Y};R.fields[Y]={...S,name:Y};return{field:Y};case "statistic":return R.fields[S.name]={...S},{field:S.name}}}function J(R,S=!1){const Y=[];let ba=0;Y.push(Q(R,ba++,S));return Y}function M(R,S,Y,ba,ca,da=!1){R=G(R,{type:"label-expression",target:Y,context:{mesh:!0},resultType:"string",label:{labelExpression:S.labelExpression,
labelExpressionInfo:S.labelExpressionInfo?{expression:S.labelExpressionInfo.expression}:null,symbol:!!S.symbol,where:S.where}});({fieldIndex:R}=R);return{...l.createSymbolSchema(S,ca,da),fieldIndex:R,target:Y,index:ba}}function L(R,S,Y){const ba="featureReduction"in S&&S.featureReduction;if(!ba)return{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};const ca=[];let da=null,fa=x.toJSONGeometryType(S.geometryType),ea=[];var ha=null;if(ba)switch(ba.type){case "selection":return W.error(new v("ValidationError",
"Mapview does not support `selection` reduction type",ba)),{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};case "cluster":case "binning":ca.push(...(ba.fields??[])),"cluster"===ba.type?fa="esriGeometryPoint":"binning"===ba.type&&(fa="esriGeometryPolygon"),ba.renderer&&!ba.renderer.authoringInfo?.isAutoGenerated?("cluster"===ba.type?{renderer:ha}=w.injectDynamicLevelDependentSizeVisualVariable(ba.renderer,ba,null):ha=ba.renderer,S=z(ba.renderer,ba),da=T(R,"aggregate",ba.renderer,S,Y),
ea=ba&&ba.labelsVisible&&ba.labelingInfo||[]):"cluster"===ba.type&&(ha=w.createClusterRenderer(ca,S.renderer,ba,null,!0),ba.symbol&&(S=z(ha,ba),da={type:"simple",symbol:l.createSymbolSchema(ba.symbol,S,Y),symbologyType:S.symbologyType}),ea=ba&&ba.labelsVisible&&ba.labelingInfo||[])}U(R,ca);return{labels:b.validateLabelingInfo(ea,"binning"===ba.type?"esriGeometryPolygon":fa),matcher:da,fields:ca,rendererOverride:ha}}function Q(R,S,Y=!1){const ba={indexCount:0,fields:{}};var ca="featureReduction"in
R?R.featureReduction??void 0:void 0;S=ca?"aggregate":"feature";if("sublayers"in R){var da={type:"subtype",subtypeField:R.subtypeField,renderers:{},symbologyType:c.WGLSymbologyType.DEFAULT},fa={type:"subtype",mapping:{},target:"feature",subtypeField:R.subtypeField},ea={type:"subtype",classes:{}},ha={type:"symbol",target:"feature",aggregateFields:[],attributes:ba,storage:fa,mesh:{matcher:da,aggregateMatcher:null,labels:ea,sortKey:null}};ca=new Set;let la=0;for(const {renderer:ma,subtypeCode:na,labelingInfo:ra,
labelsVisible:sa}of R.sublayers){R=0;"visualVariables"in ma&&ma.visualVariables&&(ma.visualVariables.some(Ea=>"rotation"!==Ea.type)&&W.warnOnce("SubtypeGroupLayer currently only supports rotation visualVariables. All other visualVariable types will be ignored."),R=k.getVVFlags(ma.visualVariables.filter(Ea=>"size"!==Ea.type)));const ua={symbologyType:c.WGLSymbologyType.DEFAULT,vvFlags:R,maxVVSize:0};R=T(ba,S,ma,ua,Y);const pa=Z(ba,S,ma),Aa=sa&&ra;if("dictionary"===R.type)throw new v("ValidationError",
"Dictionary renderer is not supported in subtype layers");if("subtype"===R.type)throw new v("ValidationError","Nested subtype renderers is not supported");if(null!=pa&&"subtype"===pa.type)throw new v("ValidationError","Nested subtype storage is not supported");if(null!=pa?.attributeMapping)throw new v("ValidationError","Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===R.type)throw new v("ValidationError","Heatmaps are not supported in subtype layers");if("pie-chart"===
R.type)throw new v("ValidationError","Pie-charts are not supported in subtype layers");if(ca.has(na))throw new v("ValidationError","Subtype codes for sublayers must be unique");ca.add(na);da.renderers[na]=R;fa.mapping[na]=pa;Aa&&(ea.classes[na]=Aa.map(Ea=>M(ba,Ea,"feature",la++,ua,Y)))}return ha}if("heatmap"===R.renderer?.type&&"raster"===u.getSupportedHeatmapRenderer()){const {radius:la,fieldOffset:ma,field:na}=R.renderer;return{type:"heatmap",aggregateFields:[],attributes:ba,target:S,storage:null,
mesh:{radius:la,fieldOffset:ma,field:D(ba,{target:S,field:na,resultType:"numeric"}).field}}}da=L(ba,R,Y);ea=x.toJSONGeometryType(R.geometryType);ha=da.rendererOverride??R.renderer;const ia=z(ha,ca);fa=T(ba,S,ha,ia,Y);ha=Z(ba,S,ha);ca=N(ba,R.orderBy,R.renderer,ca);let ka=0;R=[...b.validateLabelingInfo(R.labelsVisible&&R.labelingInfo||[],ea).map(la=>M(ba,la,"feature",ka++,ia,Y)),...da.labels.map(la=>M(ba,la,"aggregate",ka++,ia,Y))];return{type:"symbol",target:S,attributes:ba,aggregateFields:da.fields,
storage:ha,mesh:{matcher:fa,labels:{type:"simple",classes:R},aggregateMatcher:da.matcher,sortKey:ca}}}function N(R,S,Y,ba){if(null!=ba)return null;if(null!=S&&S.length){1<S.length&&W.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${S.length}. All but the first will be discarded`);S=S[0];Y="ascending"===S.order?"asc":"desc";if(S.field)return{field:S.field,order:Y};if(S.valueExpression)return{fieldIndex:G(R,{type:"expression",target:"feature",valueExpression:S.valueExpression,
resultType:"numeric"}).fieldIndex,order:Y};W.error(new v("ValidationError","Expected to find a field or valueExpression for OrderByInfo",S));return null}return null!=Y&&"unique-value"===Y.type&&Y.orderByClassesEnabled?{byRenderer:!0,order:"asc"}:null}function U(R,S){const Y={mesh:!0,storage:!0};for(const ba of S){const {name:ca,onStatisticField:da,onStatisticExpression:fa,statisticType:ea}=ba;let ha=S=void 0;fa?ha=G(R,{type:"expression",target:"feature",valueExpression:fa.expression,resultType:"numeric"}).fieldIndex:
S=G(R,{type:"field",target:"feature",field:da}).field;G(R,{type:"statistic",target:"aggregate",name:ca,context:Y,inField:S,inFieldIndex:ha,statisticType:ea})}}function Z(R,S,Y){let ba;switch(Y.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":ba={visualVariables:!0,attributes:null};break;default:ba=d.getTechniqueFromRenderer(Y).getStorageSpec(Y)}return H(R,S,ba,Y)}function H(R,S,Y,ba){if(null==Y)return null;const {visualVariables:ca,attributes:da}=Y;Y=null;ca&&"visualVariables"in
ba&&(Y=O(R,S,ba.visualVariables));const fa=null!=Y?4:0;ba=null;null!=da&&(ba=da.map((ea,ha)=>{const {field:ia,fieldIndex:ka}=D(R,{valueExpression:ea.valueExpression,field:ea.field,resultType:"numeric",target:S});return{binding:ha+fa,field:ia,fieldIndex:ka}}));return{type:"simple",target:S,attributeMapping:ba,vvMapping:Y}}function O(R,S,Y){if(!Y?.length)return[];const ba={storage:!0};return u.simplifyVisualVariables(Y).map(ca=>{const da=m.getVVType(ca.type),{field:fa,fieldIndex:ea}=D(R,{target:S,valueExpression:ca.valueExpression,
field:ca.field,context:ba,resultType:"numeric"});switch(ca.type){case "size":return"$view.scale"===ca.valueExpression?null:{type:"size",binding:da,field:fa,fieldIndex:ea,normalizationField:D(R,{target:S,field:ca.normalizationField,context:ba,resultType:"numeric"}).field,valueRepresentation:ca.valueRepresentation??null};case "color":return{type:"color",binding:da,field:fa,fieldIndex:ea,normalizationField:D(R,{target:S,field:ca.normalizationField,context:ba,resultType:"numeric"}).field};case "opacity":return{type:"opacity",
binding:da,field:fa,fieldIndex:ea,normalizationField:D(R,{target:S,field:ca.normalizationField,context:ba,resultType:"numeric"}).field};case "rotation":return{type:"rotation",binding:da,field:fa,fieldIndex:ea}}}).filter(g.isSome)}function T(R,S,Y,ba,ca=!1){R=R??{indexCount:0,fields:{}};switch(Y.type){case "simple":case "dot-density":return V(R,Y,ba,ca);case "class-breaks":return I(R,S,Y,ba,ca);case "unique-value":return K(R,S,Y,ba,ca);case "dictionary":return{type:"dictionary",config:Y.config,fieldMap:Y.fieldMap,
scaleExpression:Y.scaleExpression,url:Y.url,symbolOptions:ba,symbologyType:ba.symbologyType};case "heatmap":return P(R,Y,ba,ca);case "pie-chart":return X(R,Y,ba,ca)}}function V(R,S,Y,ba=!1){R=S.getSymbols();return{type:"simple",symbol:l.createSymbolSchema(R.length?R[0]:null,Y,ba),symbologyType:Y.symbologyType}}function X(R,S,Y,ba=!1){R=S.getSymbols();S=1<R.length?R[1]:null;return{type:"pie-chart",markerSymbol:l.createSymbolSchema(R[0],Y,ba),fillSymbol:l.createSymbolSchema(S,Y,ba),symbologyType:Y.symbologyType}}
function I(R,S,Y,ba,ca=!1){const da=Y.backgroundFillSymbol,{field:fa,fieldIndex:ea}=D(R,{target:S,field:Y.field,valueExpression:Y.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}});S=Y.normalizationType;S="log"===S?"esriNormalizeByLog":"percent-of-total"===S?"esriNormalizeByPercentOfTotal":"field"===S?"esriNormalizeByField":null;const ha=Y.classBreakInfos.map(ia=>({symbol:l.createSymbolSchema(ia.symbol,ba,ca),min:ia.minValue,max:ia.maxValue})).sort((ia,ka)=>ia.min-ka.min);
return{type:"interval",attributes:R.fields,field:fa,fieldIndex:ea,backgroundFillSymbol:l.createSymbolSchema(da,ba,ca),defaultSymbol:l.createSymbolSchema(Y.defaultSymbol,ba,ca),intervals:ha,normalizationField:Y.normalizationField,normalizationTotal:Y.normalizationTotal,normalizationType:S,isMaxInclusive:Y.isMaxInclusive,symbologyType:ba.symbologyType}}function K(R,S,Y,ba,ca=!1){const da=[],fa=Y.backgroundFillSymbol;S={target:S,context:{mesh:!0},resultType:"string"};if(Y.field&&"string"!==typeof Y.field)throw new v("ValidationError",
"Expected renderer.field to be a string",Y);const {field:ea,fieldIndex:ha}=D(R,{...S,field:Y.field,valueExpression:Y.valueExpression});for(const ia of Y.uniqueValueInfos??[])da.push({value:""+ia.value,symbol:l.createSymbolSchema(ia.symbol,ba,ca)});return{type:"map",attributes:R.fields,field:ea,fieldIndex:ha,field2:D(R,{...S,field:Y.field2}).field,field3:D(R,{...S,field:Y.field3}).field,fieldDelimiter:Y.fieldDelimiter??void 0,backgroundFillSymbol:l.createSymbolSchema(fa,ba),defaultSymbol:l.createSymbolSchema(Y.defaultSymbol,
ba),map:da,symbologyType:ba.symbologyType}}function P(R,S,Y,ba=!1){R=S.getSymbols();return{type:"heatmap",symbol:l.createSymbolSchema(R.length?R[0]:null,Y,ba),symbologyType:Y.symbologyType}}const W=p.getLogger("esri.views.2d.layers.features.schemaUtils");let aa=null;h.createSymbolSchema=l.createSymbolSchema;h.addAggregateFields=U;h.createMatcherSchema=T;h.createRendererAttributeSchema=D;h.createSchema=function(R){if(n("esri-2d-update-debug")){const S=q(R,!0);console.debug("Created new schema",S);
console.debug("Schema diff",a.diff(aa,S));aa=S}return q(R)};h.createSymbolSchemaOptions=z;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["exports","../enums","../visualVariablesUtils"],function(h,g,v){h.getVVFlags=function(n){if(!n)return g.WGLVVFlag.NONE;let p=0;for(const f of n)"size"===f.type?(n=v.getTypeOfSizeVisualVariable(f),p|=n,"outline"===f.target&&(p|=n<<4)):"color"===f.type?p|=g.WGLVVFlag.COLOR:"opacity"===
f.type?p|=g.WGLVVFlag.OPACITY:"rotation"===f.type&&(p|=g.WGLVVFlag.ROTATION);return p};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define(["exports","../../../../core/Error","../../../../core/Logger","./enums","./Utils"],function(h,g,v,n,p){h.getTypeOfSizeVisualVariable=function(f){if(p.isNumber(f.minDataValue)&&p.isNumber(f.maxDataValue)&&null!=f.minSize&&null!=f.maxSize)return n.WGLVVFlag.SIZE_MINMAX_VALUE;if((f.expression&&
"view.scale"===f.expression||f.valueExpression&&"$view.scale"===f.valueExpression)&&Array.isArray(f.stops))return n.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=f.field||f.expression&&"view.scale"!==f.expression||f.valueExpression&&"$view.scale"!==f.valueExpression)&&(Array.isArray(f.stops)||"levels"in f&&f.levels))return n.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=f.field||f.expression&&"view.scale"!==f.expression||f.valueExpression&&"$view.scale"!==f.valueExpression)&&null!=f.valueUnit)return n.WGLVVFlag.SIZE_UNIT_VALUE;
v.getLogger("esri.views.2d.engine.webgl").error(new g("mapview-bad-type","Found invalid size VisualVariable",f));return n.WGLVVFlag.NONE};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/createSymbolSchema":function(){define(["exports","../../../../symbols/cim/CIMSymbolHelper","../../engine/webgl/enums","../../engine/webgl/materialKey/MaterialKey"],function(h,g,v,n){function p(b){switch(b.type){case "line-marker":return{type:"line-marker",color:b.color?.toJSON(),
placement:b.placement,style:b.style};default:return b.constructor.fromJSON(b.toJSON()).toJSON()}}function f(b,c,m=!1){if(!b)return null;switch(b.type){case "simple-fill":case "picture-fill":return e(b,c,m);case "simple-marker":case "picture-marker":if("simple-marker"===b.type&&("path"===b.style||b.outline&&"solid"!==b.outline.style&&"none"!==b.outline.style))b=g.CIMSymbolHelper.fromSimpleMarker(b),b=f({type:"CIMSymbolReference",symbol:b},c,m);else{var d=n.createMaterialKey(v.WGLGeometryType.MARKER,
c);m=m?n.hydrateMaterialKey(d):d;d=p(b);b={materialKey:m,hash:b.hash(),...d,angle:b.angle,maxVVSize:c.maxVVSize}}return b;case "simple-line":return a(b,c,m);case "text":return d=n.createMaterialKey(v.WGLGeometryType.TEXT,c),m=m?n.hydrateMaterialKey(d):d,d=p(b),{materialKey:m,hash:b.hash(),...d,angle:b.angle,maxVVSize:c.maxVVSize};case "label":return d=b.toJSON(),c=n.createMaterialKey(v.WGLGeometryType.LABEL,{...c,placement:d.labelPlacement}),{materialKey:m?n.hydrateMaterialKey(c):c,hash:b.hash(),
...d,labelPlacement:d.labelPlacement};case "cim":return{type:"cim",rendererKey:c.vvFlags,data:b.data,maxVVSize:c.maxVVSize};case "CIMSymbolReference":return{type:"cim",rendererKey:c.vvFlags,data:b,maxVVSize:c.maxVVSize};case "web-style":return{...p(b),type:"web-style",hash:b.hash(),rendererKey:c.vvFlags,maxVVSize:c.maxVVSize};default:throw Error(`symbol not supported ${b.type}`);}}function e(b,c,m){var d=n.createMaterialKey(v.WGLGeometryType.FILL,c);d=m?n.hydrateMaterialKey(d):d;var k=b.clone();b=
k.outline;const l=n.isOutlineFillSymbology(c.symbologyType);l||(k.outline=null);k={materialKey:d,hash:k.hash(),...p(k)};if(l)return k;d=[];d.push(k);b&&(c=n.createMaterialKey(v.WGLGeometryType.LINE,{...c,isOutline:!0}),m={materialKey:m?n.hydrateMaterialKey(c):c,hash:b.hash(),...p(b)},d.push(m));return{type:"composite-symbol",layers:d,hash:d.reduce((r,u)=>u.hash+r,"")}}function a(b,c,m){var d=n.isOutlineFillSymbology(c.symbologyType)?v.WGLSymbologyType.DEFAULT:c.symbologyType;d=n.createMaterialKey(v.WGLGeometryType.LINE,
{...c,symbologyType:d});const k=m?n.hydrateMaterialKey(d):d;b=b.clone();d=b.marker;b.marker=null;const l=[];l.push({materialKey:k,hash:b.hash(),...p(b)});d&&(c=n.createMaterialKey(v.WGLGeometryType.MARKER,c),m=m?n.hydrateMaterialKey(c):c,d.color=d.color??b.color,l.push({materialKey:m,hash:d.hash(),lineWidth:b.width,...p(d)}));return{type:"composite-symbol",layers:l,hash:l.reduce((r,u)=>u.hash+r,"")}}h.createSymbolSchema=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/pixelBuffering":function(){define("exports ../../../../../core/screenUtils ../../../../../symbols/cim/CIMSymbolHelper ../../../../../symbols/cim/Rect ../../../engine/webgl/definitions ../../graphics/graphicsUtils ../../support/cimSymbolUtils".split(" "),
function(h,g,v,n,p,f,e){function a(w,x){if(!("visualVariables"in w&&w.hasVisualVariables("size")))return 0;w=w.getVisualVariablesForType("size");if(!w[0])return 0;w=w[0];if(x&&"cluster_count"===w.field&&"cluster"===x.type)return x.clusterMaxSize;if("outline"===w.target)return 0;if("stops"===w.transformationType)return w.stops.map(z=>z.size).reduce(k,0);if("clamped-linear"===w.transformationType){let z=x=-Infinity;x="number"===typeof w.maxSize?w.maxSize:w.maxSize.stops.map(q=>q.size).reduce(k,0);z=
"number"===typeof w.minSize?w.minSize:w.minSize.stops.map(q=>q.size).reduce(k,0);return Math.max(x,z)}if("real-world-size"===w.transformationType)return 30}function b(w,x){return null==w?x:w}async function c(w,x,z,q,t,B){if("simple-marker"===w.type)return x=Math.max(b(w.size,12),x),d(w)+.707*x;if("picture-marker"===w.type)return z=Math.max(b(w.height,12),x),x=b(w.width,12)*(z/b(w.height,12))/2,z/=2,d(w)+Math.sqrt(x*x+z*z);if("text"===w.type){if(z=w.text&&w.text.length){x=[];for(q=0;q<z;q++)x.push({...u,
code:w.text.charCodeAt(q)});x={glyphMosaicItems:x}}else x={glyphMosaicItems:[u]};f.getTextSymbolSize(r,w.toJSON(),x);return Math.max(Math.abs(r[0]),Math.abs(r[1]))+Math.max(r[2],r[3])}return"simple-line"===w.type?(z=Math.max(b(w.width,.75),x)/2,w.marker?Math.max(6*w.width,2*x):z):"simple-fill"===w.type||"picture-fill"===w.type?(z=Math,q=z.max,w=null==w.outline?0:b(w.outline.width,0),q.call(z,w,x)/2):"cim"===w.type?(await e.expandSymbol({type:"cim",rendererKey:0,data:w.data,maxVVSize:x},{geometryType:q,
fields:t,spatialReference:B},z),(w=v.CIMSymbolHelper.getEnvelope(w.data,null,z))?Math.sqrt(w.width*w.width+w.height*w.height):0):"web-style"===w.type?c(await w.fetchCIMSymbol(),x,z,q,t,B):0}async function m(w,x,z,q,t,B){return w.type in l?Math.min(await c(w,x,z,q,t,B),75):0}function d(w){const x=b(w.xoffset,0);w=b(w.yoffset,0);return Math.sqrt(x*x+w*w)}function k(w,x){return Math.max(w,x)}const l={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},
r=[0,0,0,0],u={sdf:!0,code:99,metrics:p.averageGlyphMosaicItem.metrics,rect:new n(0,0,24,24),page:0,textureBinding:2};h.computePxBuffer=async function(w,x,z,q,t,B){if(!w||B&&"cluster"===B.type)return 0;if("heatmap"===w.type)return Math.round(g.pt2px(w.radius));if("dot-density"===w.type)return 0;if("dictionary"===w.type)return"esriGeometryPoint"===x||"esriGeometryMultipoint"===x?100:200;B=w.getSymbols();w=a(w);const y=[];for(const E of B)y.push(m(E,w,z,x,q,t));x=await Promise.all(y);return g.pt2px(x.reduce(k,
0))};h.getPtMaxVVSize=a;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/BidiText ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/alignmentUtils ../../engine/webgl/definitions ../../engine/webgl/mesh/templates/shapingUtils".split(" "),function(h,g,v,n,p,f,e,a,b){h.getTextSymbolSize=
function(c,m,d){if(!d?.glyphMosaicItems?.length)return c;const k=g.bidiText(m.text)[1];m=b.shapeGlyphs(d.glyphMosaicItems,k,{scale:v.pt2px(m.font.size)/a.glyphSize,angle:m.angle??0,xOffset:m.xoffset??0,yOffset:m.yoffset??0,hAlign:e.getXAnchorDirection(m.horizontalAlignment||"center"),vAlign:e.getYAnchorDirection(m.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(m.lineWidth||512,512)),lineHeight:a.magicLabelLineHeight*Math.max(.25,Math.min(m.lineHeight||1,4)),decoration:m.font.decoration||
"none",isCIM:!1,hasBackground:!!m.backgroundColor,borderLineSize:m.borderLineSize}).bounds;c[0]=v.pt2px(m.x-m.halfWidth);c[1]=v.pt2px(m.y-m.halfHeight);c[2]=v.pt2px(m.width);c[3]=v.pt2px(m.height);return c};h.graphicGeometryToNumber=function(c){switch(c.geometry.type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};h.intersectingInternationalDateline=function(c,m){m=f.getInfo(m);if(!m)return null;const [d,k]=m.valid;return c[2]>k?[p.create([c[0],c[1],k,c[3]]),p.create([d,
c[1],d+c[2]-k,c[3]])]:c[0]<d?[p.create([d,c[1],c[2],c[3]]),p.create([k-(d-c[0]),c[1],k,c[3]])]:null};h.isMarkerSymbol=function(c){return"simple-marker"===c||"picture-marker"===c||"esriSMS"===c||"esriPMS"===c};h.isTextSymbol=function(c){return"text"===c||"esriTS"===c};h.pixelBuffer=50;h.polygonFromExtent=function(c){if(!c)return null;const {xmin:m,ymin:d,xmax:k,ymax:l,spatialReference:r}=c;return new n({rings:[[[m,d],[m,l],[k,l],[k,d],[m,d]]],spatialReference:r})};h.tileSize=512;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/screenUtils ../../../../webgl/capabilities".split(" "),function(h,g,v,n,p,f){function e(m){return("size"===m.type||"color"===m.type||"opacity"===m.type)&&null!=m.stops}function a(m){var d=m.type;var k=m.stops??[];if(8>=k.length)d=k;else if(c.warn(`Found ${k.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),
16<k.length){const [B,...y]=k;var l=y.pop(),r=y[0].value,u=y[y.length-1].value,w=(u-r)/6;const E=[];for(;r<u;r+=w){for(var x=0;r>=y[x].value;)x++;var z=y[x],q=k[x-1],t=r-q.value;z=z.value===q.value?1:t/(z.value-q.value);"color"===d?(q=y[x],x=k[x-1],t=q.color.clone(),t.r=(1-z)*x.color.r+z*t.r,t.g=(1-z)*x.color.g+z*t.g,t.b=(1-z)*x.color.b+z*t.b,t.a=(1-z)*x.color.a+z*t.a,E.push({value:r,color:t,label:q.label})):"size"===d?(q=y[x],t=k[x-1],x=p.toPt(q.size),t=p.toPt(t.size),E.push({value:r,size:(1-z)*
t+z*x,label:q.label})):(q=y[x],E.push({value:r,opacity:(1-z)*k[x-1].opacity+z*q.opacity,label:q.label}))}d=[B,...E,l]}else{const [B,...y]=k;for(d=y.pop();6<y.length;){l=k=0;for(u=1;u<y.length;u++)w=Math.abs(y[u].value-y[u-1].value),w>l&&(l=w,k=u);y.splice(k,1)}d=[B,...y,d]}m.stops=d;return m}function b(){if(v("heatmap-force-raster"))return"raster";const {supportsTextureFloat:m,supportsTextureHalfFloat:d,supportsColorBufferFloat:k,supportsColorBufferFloatBlend:l,supportsColorBufferHalfFloat:r}=f.getWebGLCapabilities("2d");
return m&&k&&l||d&&r?"symbol":v("heatmap-allow-raster-fallback")?"raster":"none"}const c=n.getLogger("esri.views.2d.layers.features.support.rendererUtils");h.getSupportedHeatmapRenderer=b;h.isRendererSupported=function(m){if(!m)return!0;switch(m.type){case "dot-density":if(!f.getWebGLCapabilities("2d").supportsTextureFloat)return c.error(new g("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case "heatmap":if(m=b(),"none"===m||"raster"===
m&&!v("heatmap-force-raster")){const d=f.getWebGLCapabilities("2d"),k=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(l=>!d[l]).join(", ");if("none"===m)return c.errorOnce(new g("webgl-missing-extension",`Missing WebGL${d.type} requirements for Heatmap: ${k}`)),!1;"raster"===m&&c.warnOnce(`Missing WebGL${d.type} requirements for accelerated Heatmap: ${k}. Feature support may be limited.`)}}return!0};
h.simplifyVVRenderer=m=>{if(!("visualVariables"in m&&m.visualVariables?.length))return m;m=m.clone();const d=m.visualVariables.map(k=>e(k)?a(k):k);m.visualVariables=d;return m};h.simplifyVisualVariables=function(m){return m.map(d=>e(d)?a(d.clone()):d)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/util":function(){define(["exports","../../../../core/jsonMap"],function(h,g){const v=new g.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",
esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});h.analyzeRings=function(n,p,f){const e=[],a=[];let b=0,c=0;for(const m of n){n=c;let d=m[0][0],k=m[0][1];e[c++]=d;e[c++]=k;let l=0;for(let r=1;r<m.length;++r){const u=d,w=k;d=m[r][0];k=m[r][1];l+=k*u-d*w;e[c++]=d;e[c++]=k}p(l/2);0<l?(0<n-b&&(f(b,n,e,a),b=n),a.length=0):0>l?0<n-b?a.push(.5*(n-b)):c=n:c=n}0<c-b&&f(b,c,e,a)};h.canUseMajorityInterpolationOnDataSource=function(n){const {bandCount:p,
attributeTable:f,colormap:e,pixelType:a}=n.raster.rasterInfo;return 1===p&&(null!=f||null!=e||"u8"===a||"s8"===a)};h.toJSONGeometryType=function(n){return v.toJSON(n)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("require ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../core/support/UpdatingHandles ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/util/debug ../tileRenderers/support/visualVariablesUtils ../../../../webgl/enums".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r){function u(y,E){return F=>E(y(F))}const w=n.getLogger("esri.views.layers.2d.features.support.AttributeStore"),x=k.createDebugLogger(k.debugAttrUpdates,w);var z=v("esri-shared-array-buffer"),q=v("esri-atomics");class t{constructor(y,E,F,C){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:A,layout:D,textureOnly:G}=C;this.textureOnly=G||!1;this.pixelType=A;this._ctype=E;this.layout=D;this._resetRange();this._shared=y;this.size=F;G||
(this.data=this._initData(A,F,y,E))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(y,E){const F=this.data;for(let C=0;C<this.size*this.size;C++)F[C*this.texelSize+y]&=~E;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(y,E){const F=this.data;for(let C=0;C<this.size*this.size;C++)F[C*this.texelSize+y]|=255&E;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(y,E,F){const C=this.data;for(const A of F)C[A*this.texelSize+y]|=E,this.dirtyStart=
Math.min(this.dirtyStart,A),this.dirtyEnd=Math.max(this.dirtyEnd,A)}setComponentTexel(y,E,F){this.data[F*this.texelSize+y]|=E;this.dirtyStart=Math.min(this.dirtyStart,F);this.dirtyEnd=Math.max(this.dirtyEnd,F)}unsetComponentTexel(y,E,F){this.data[F*this.texelSize+y]&=~E;this.dirtyStart=Math.min(this.dirtyStart,F);this.dirtyEnd=Math.max(this.dirtyEnd,F)}getData(y,E){y=m.getDisplayIdTexel(y);return this.data[y*this.texelSize+E]}setData(y,E,F){y=m.getDisplayIdTexel(y);0===(this.layout&1<<E)?w.error("mapview-attributes-store",
"Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[y*this.texelSize+E]=F,this.dirtyStart=Math.min(this.dirtyStart,y),this.dirtyEnd=Math.max(this.dirtyEnd,y))}lock(){this.pixelType===r.PixelType.UNSIGNED_BYTE&&this._shared&&q&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===r.PixelType.UNSIGNED_BYTE&&this._shared&&q&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(y){this.size=y;this.textureOnly||(y=this._initData(this.pixelType,
y,this._shared,this._ctype),y.set(this.data),this.data=y)}toMessage(){const y=this.dirtyStart,E=this.dirtyEnd;var F=this.texelSize;if(y>E)return null;this._resetRange();const C=this.pixelType,A=this.layout,D=this.data;F=!this._shared&&"local"!==this._ctype&&D.slice(y*F,(E+1)*F)||null;return{start:y,end:E,data:F,pixelType:C,layout:A}}_initData(y,E,F,C){F=F&&"local"!==C?SharedArrayBuffer:ArrayBuffer;y=d.getPixelArrayCtor(y);E=new y(new F(E*E*4*y.BYTES_PER_ELEMENT));for(y=0;y<E.length;y+=4)E[y+1]=255;
return E}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class B{constructor(y,E){this._client=y;this.config=E;this.updatingHandles=new a.UpdatingHandles;this._blocks=[];this._filters=Array(c.maxFilters);this._attributeComputeInfo=null;this._targetType=0;this._abortController=new AbortController;this._hasScaleExpr=!1;this._size=32;this._currUpdate=this._nextUpdate=null;this._idsToHighlight=new Set;y=E.supportsTextureFloat?r.PixelType.FLOAT:r.PixelType.UNSIGNED_BYTE;x(`Creating AttributeStore ${z?
"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:r.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:r.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:r.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:y,layout:15},{pixelType:y,layout:15},{pixelType:y,layout:15},{pixelType:y,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort();this.updatingHandles.destroy()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return 0<
this._idsToHighlight.size}isUpdating(){const y=this.updatingHandles.updating||!!this._nextUpdate;v("esri-2d-log-updating")&&console.log(`Updating AttributeStore: ${y}\n  -> updatingHandles ${this.updatingHandles.updating} (currUpdate: ${!!this._currUpdate})\n  -> nextUpdate: ${!!this._nextUpdate}\n`);return y}update(y,E){this.config=E;E=E.schema.processors[0].storage;const F=e.diff(this._schema,E);if(y.targets.feature||y.targets.aggregate)y.storage.data=!0;if(F&&(v("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",
F),y.storage.data=!0,this._schema=E,this._attributeComputeInfo=null,null!=E)){switch(E.target){case "feature":this._targetType=m.displayIdTypeFeature;break;case "aggregate":this._targetType=m.displayIdTypeAggregate}if("subtype"===E.type){this._attributeComputeInfo={isSubtype:!0,subtypeField:E.subtypeField,map:new Map};for(const C in E.mapping)if(y=E.mapping[C],null!=y?.vvMapping)for(const A of y.vvMapping)this._bindAttribute(A,parseInt(C,10))}else{this._attributeComputeInfo={isSubtype:!1,map:new Map};
if(null!=E.vvMapping)for(const C of E.vvMapping)this._bindAttribute(C);if(null!=E.attributeMapping)for(const C of E.attributeMapping)this._bindAttribute(C)}}}onTileData(y,E){if(null!=E.addOrUpdate)for(y=E.addOrUpdate.getCursor();y.next();)E=y.getDisplayId(),this.setAttributeData(E,y)}async setHighlight(y,E){const F=this._getBlock(0);E=E.map(C=>m.getDisplayIdTexel(C));F.lock();F.unsetComponentAllTexels(0,1);F.setComponent(0,1,E);F.unlock();this._idsToHighlight.clear();for(const C of y)this._idsToHighlight.add(C);
await this.sendUpdates()}async updateFilters(y,E,F){v("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters");const {service:C,spatialReference:A}=F;({filters:E}=E);E=E.map((D,G)=>this._updateFilter(D,G,C,A));E=(await Promise.all(E)).some(D=>D);v("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters - finsihed");E&&(y.storage.filters=!0,v("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(y,E,F,C){const A=m.getDisplayIdTexel(y);
this._ensureSizeForTexel(A);this._getBlock(E).setData(y,F,C)}getData(y,E,F){return this._getBlock(E).getData(y,F)}getHighlightFlag(y){return this._idsToHighlight.has(y)?c.highlightFlag:0}unsetAttributeData(y){y=m.getDisplayIdTexel(y);this._getBlock(0).setData(y,0,0)}setAttributeData(y,E){const F=m.getDisplayIdTexel(y);this._ensureSizeForTexel(F);this._getBlock(0).setData(F,0,this.getFilterFlags(E));if(this._targetType===m.getDisplayIdType(y)){y=this._attributeComputeInfo;var C=this.config.supportsTextureFloat?
1:2,A=null;y&&(A=y.isSubtype?y.map.get(E.readAttribute(y.subtypeField)):y.map,A?.size&&A.forEach((D,G)=>{const J=G*C%4;G=this._getBlock(Math.floor(G*C/4)+c.attributeDataVv);D=D(E);if(this.config.supportsTextureFloat)G.setData(F,J,D);else if(D===c.nanMagicNumber)G.setData(F,J,255),G.setData(F,J+1,255);else{D=p.clamp(Math.round(D),-32767,32766)+32768;const M=(D&65280)>>8;G.setData(F,J,D&255);G.setData(F,J+1,M)}}))}}sendUpdates(){v("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate");
if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=f.createResolver(),this.updatingHandles.addPromise(this._nextUpdate.promise),this._nextUpdate.promise;const y={blocks:this._blocks.map(E=>null!=E?E.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{var E=()=>{this._currUpdate=null;if(this._nextUpdate){const F=this._nextUpdate;this._nextUpdate=null;this.sendUpdates().then(()=>F.resolve())}else v("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::No additional updates queued")};
v("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::client.update");E=this.updatingHandles.addPromise(this._client.update(y,this._signal).then(E).catch(E));this._client.render(this._signal);return E}).catch(E=>{if(f.isAbortError(E))return this._createResourcesPromise=null,this._createResources();w.error(new g("mapview-attribute-store","Encountered an error during client update",E))})}_ensureSizeForTexel(y){for(;y>=this._size*this._size&&!this._expand(););}_bindAttribute(y,E){function F(){const {normalizationField:M}=
y;return M?L=>{const Q=L.readAttribute(M);return Q?L.readAttribute(y.field)/Q:null}:L=>L.readAttribute(y.field)}function C(){y.normalizationField&&w.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported.");return M=>M.getComputedNumericAtIndex(y.fieldIndex)}let A;if(null!=y.fieldIndex)A=C();else if(y.field)A=F();else return;const {valueRepresentation:D}=y;D&&(A=u(A,M=>l.getVisualVariableSizeValueRepresentationRatio(M,D)));const G=M=>null===M||
isNaN(M)||Infinity===M||-Infinity===M?c.nanMagicNumber:M,J=this._attributeComputeInfo;if(J.isSubtype){const M=J.map.get(E)??new Map;M.set(y.binding,u(A,G));J.map.set(E,M)}else J.map.set(y.binding,u(A,G))}_createResources(){if(null!=this._createResourcesPromise)return this._createResourcesPromise;this._getBlock(c.attributeDataAnimation);this._getBlock(c.attributeDataGpgpu);x("Initializing AttributeStore");var y={shared:z&&"local"!==this._client.type,size:this._size,blocks:this._blocks.map(E=>null!=
E?{textureOnly:E.textureOnly,buffer:E.buffer,pixelType:E.pixelType}:null)};this._createResourcesPromise=y=this._client.initialize(y,this._signal).catch(E=>{f.isAbortError(E)?this._createResourcesPromise=null:w.error(new g("mapview-attribute-store","Encountered an error during client initialization",E))});y.then(()=>null==this._createResourcesPromise?this._createResources():void 0);return y}_getBlock(y){var E=this._blocks[y];if(null!=E)return E;x(`Initializing AttributeBlock at index ${y}`);E=new t(z,
this._client.type,this._size,this._blockDescriptors[y]);this._blocks[y]=E;this._createResourcesPromise=null;return E}_expand(){if(this._size<this.config.maxTextureSize){const y=this._size<<=1;x("Expanding block size to",y,this._blocks);for(const E of this._blocks)E?.expand(y);this._createResourcesPromise=null;this._size=y;return 0}w.error(new g("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}async _updateFilter(y,E,F,C){const A=this._filters[E];if(!A&&!y||(null!=A&&
A.hash)===JSON.stringify(y))return!1;if(null==y){if(!A)return!1;y=1<<E+1;F=this._getBlock(0);this._filters[E]=null;F.setComponentAllTexels(0,y);this.sendUpdates();return!0}await (await this._getFilter(E,F)).update(y,C);return!0}async _getFilter(y,E){var F=this._filters[y];if(null!=F)return F;({default:F}=await new Promise((C,A)=>h(["./FeatureFilter"],D=>C(Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}))),A)));E=new F({geometryType:E.geometryType,
hasM:!1,hasZ:!1,timeInfo:E.timeInfo,fieldsIndex:b.fromJSON(E.fieldsIndex)});return this._filters[y]=E}isVisible(y){return!!(this._getBlock(0).getData(y,0)&2)}getFilterFlags(y){let E=0;var F=m.getDisplayIdFilterMask(y.getDisplayId());for(let A=0;A<this._filters.length;A++){var C=this._filters[A];C=!(F&1<<A)||null==C||C.check(y);E|=(C?1:0)<<A}F=0;this._idsToHighlight.size&&(y=y.getObjectId(),F=this.getHighlightFlag(y));return E<<1|F}}return B})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],
function(h){h.createDebugLogger=(g,v)=>g&&((...n)=>v.warn("DEBUG:",...n))||(()=>null);h.debugAttrUpdates=!1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define("exports ../../../../../../core/screenUtils ../../../../engine/webgl/color ../../../../engine/webgl/definitions ../../../../engine/webgl/enums ../../../../engine/webgl/visualVariablesUtils".split(" "),function(h,g,v,n,p,f){function e(l){return{value:l.value,
size:g.toPt(l.size)}}function a(l){return(l??[]).map(r=>e(r))}function b(l){return"string"===typeof l||"number"===typeof l?g.toPt(l):{type:"size",expression:l.expression,stops:a(l.stops)}}function c(l){const r={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"===typeof l.field)if(l.stops){if(8<l.stops.length)return null;l=l.stops;for(var u=0;8>u;++u){const w=l[Math.min(u,l.length-1)];r.values[u]=w.value;r.opacities[u]=w.opacity}}else return null;else if(l.stops&&0<=l.stops.length)for(l=
l.stops&&0<=l.stops.length?l.stops[0].opacity:0,u=0;8>u;u++)r.values[u]=Infinity,r.opacities[u]=l;else return null;return r}function m(l,r,u){l[4*r]=u.r/255;l[4*r+1]=u.g/255;l[4*r+2]=u.b/255;l[4*r+3]=u.a}function d(l){if(null==l||l.normalizationField)return null;const r={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"===typeof l.field)if(l.stops){if(8<l.stops.length)return null;r.field=l.field;l=l.stops;for(var u=0;8>u;++u){const w=
l[Math.min(u,l.length-1)];r.values[u]=w.value;m(r.colors,u,w.color)}}else return null;else if(l.stops&&0<=l.stops.length)for(l=l.stops&&0<=l.stops.length&&l.stops[0].color,u=0;8>u;u++)r.values[u]=Infinity,m(r.colors,u,l);else return null;for(l=0;32>l;l+=4)v.premultiplyAlpha(r.colors,l,!0);return r}const k=l=>{const r=[],u=[];l=a(l);const w=l.length;for(let x=0;6>x;x++){const z=l[Math.min(x,w-1)];r.push(z.value);u.push(null==z.size?n.nanMagicNumber:g.pt2px(z.size))}return{values:new Float32Array(r),
sizes:new Float32Array(u)}};h.convertColorVariable=d;h.convertVisualVariables=function(l){const r=l&&0<l.length?{}:null,u=r?{}:null;if(!r||!u)return{vvFields:r,vvRanges:u};for(const w of l)if(w.field&&(r[w.type]=w.field),"size"===w.type)switch(u.size||(u.size={}),l=w,f.getTypeOfSizeVisualVariable(l)){case p.WGLVVFlag.SIZE_MINMAX_VALUE:u.size.minMaxValue={minDataValue:l.minDataValue,maxDataValue:l.maxDataValue,minSize:b(l.minSize),maxSize:b(l.maxSize)};break;case p.WGLVVFlag.SIZE_SCALE_STOPS:u.size.scaleStops=
{stops:a(l.stops)};break;case p.WGLVVFlag.SIZE_FIELD_STOPS:if(l.levels){const x={};for(const z in l.levels)x[z]=k(l.levels[z]);u.size.fieldStops={type:"level-dependent",levels:x}}else u.size.fieldStops={type:"static",...k(l.stops)};break;case p.WGLVVFlag.SIZE_UNIT_VALUE:u.size.unitValue={unit:l.valueUnit,valueRepresentation:l.valueRepresentation??void 0}}else"color"===w.type?u.color=d(w):"opacity"===w.type?u.opacity=c(w):"rotation"===w.type&&(u.rotation={type:w.rotationType});return{vvFields:r,vvRanges:u}};
h.getVisualVariableSizeValueRepresentationRatio=function(l,r){if(!l||!r)return l;switch(r){case "radius":case "distance":return 2*l;case "area":return Math.sqrt(l)}return l};h.normalizeSizeElement=b;h.normalizeSizeStops=a;h.stopToSizeStop=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define(["exports","../../../engine/webgl/DisplayId","./DisplayIdGenerator","./StaticBitSet"],function(h,g,v,n){function p(e,
a,b){if(!(e.length>a))for(;e.length<=a;)e.push(b)}class f{constructor(){this._numerics=[];this._strings=[];this._idGenerator=new v.DisplayIdGenerator;this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[]}createBitset(){const e=this._bitsets.length;this._bitsets.push(n.StaticBitSet.create(this._allocatedSize,g.displayIdTexelMask));return e+1}getBitset(e){return this._bitsets[e-1]}_expand(){this._allocatedSize<<=1;for(const e of this._bitsets)e.resize(this._allocatedSize)}_ensureNumeric(e,
a){this._numerics[e]||(this._numerics[e]=[]);p(this._numerics[e],a,0)}_ensureInstanceId(e){p(this._instanceIds,e,0)}_ensureString(e,a){this._strings[e]||(this._strings[e]=[]);p(this._strings[e],a,null)}createDisplayId(e=!1){const a=this._idGenerator.createId();a>this._allocatedSize&&this._expand();return g.createDisplayId(a,e)}releaseDisplayId(e){for(const a of this._bitsets)a.unset(e);return this._idGenerator.releaseId(e&g.displayIdTexelMask)}getComputedNumeric(e,a){return this.getComputedNumericAtIndex(e&
g.displayIdTexelMask,0)}setComputedNumeric(e,a,b){return this.setComputedNumericAtIndex(e&g.displayIdTexelMask,b,0)}getComputedString(e,a){return this.getComputedStringAtIndex(e&g.displayIdTexelMask,0)}setComputedString(e,a,b){return this.setComputedStringAtIndex(e&g.displayIdTexelMask,0,b)}getComputedNumericAtIndex(e,a){e&=g.displayIdTexelMask;this._ensureNumeric(a,e);return this._numerics[a][e]}setComputedNumericAtIndex(e,a,b){e&=g.displayIdTexelMask;this._ensureNumeric(a,e);this._numerics[a][e]=
b}getInstanceId(e){e&=g.displayIdTexelMask;this._ensureInstanceId(e);return this._instanceIds[e]}setInstanceId(e,a){e&=g.displayIdTexelMask;this._ensureInstanceId(e);this._instanceIds[e]=a}getComputedStringAtIndex(e,a){e&=g.displayIdTexelMask;this._ensureString(a,e);return this._strings[a][e]}setComputedStringAtIndex(e,a,b){e&=g.displayIdTexelMask;this._ensureString(a,e);this._strings[a][e]=b}getXMin(e){return this._bounds[4*(e&g.displayIdTexelMask)]}getYMin(e){return this._bounds[4*(e&g.displayIdTexelMask)+
1]}getXMax(e){return this._bounds[4*(e&g.displayIdTexelMask)+2]}getYMax(e){return this._bounds[4*(e&g.displayIdTexelMask)+3]}setBounds(e,a){a=a.readHydratedGeometry();if(!a?.coords.length)return!1;let b=Infinity,c=Infinity,m=-Infinity,d=-Infinity;a.forEachVertex((k,l)=>{b=Math.min(b,k);c=Math.min(c,l);m=Math.max(m,k);d=Math.max(d,l)});e&=g.displayIdTexelMask;p(this._bounds,4*e+4,0);this._bounds[4*e]=b;this._bounds[4*e+1]=c;this._bounds[4*e+2]=m;this._bounds[4*e+3]=d;return!0}}h.ComputedAttributeStorage=
f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(h,g){class v{constructor(){this._freeIds=[];this._idCounter=1}createId(n=!1){return g.createDisplayId(this._getFreeId(),n)}releaseId(n){this._freeIds.push(n)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}h.DisplayIdGenerator=v;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define(["exports","../../../../../geometry/support/jsonUtils","../../../../../layers/graphics/featureConversionUtils","./FeatureSetReader","./FeatureSetReaderJSON"],function(h,g,v,n,p){class f extends p.FeatureSetReaderJSON{static from(e,a,b){const c=n.FeatureSetReader.createInstance(),m=[];e=e.filter(d=>!!d.geometry);for(const d of e)e=g.getJsonType(d.geometry),v.convertFromGraphics(m,[d],e,!1,!1,a);return new f(c,
m,b)}constructor(e,a,b){super(e,a,null);this._transform=b}get geometryType(){const e=this._current;return e?e.geometryType:null}get insertAfter(){return this._current.insertAfter}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){const e=new f(this.instance,this._features,this._transform);this.copyInto(e);return e}}h.GraphicsReader=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l){let r=0;g=n("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const u=g[0],w=g[1],x=g[2],z=g[3];g=n("featurelayer-simplify-payload-size-factors")??[1,2,4];const q=g[0],t=g[1],B=g[2],y=n("featurelayer-simplify-mobile-factor")??2,E=n("esri-mobile");class F{constructor(C,A){this.type="FeatureSetReader";this.arcadeDeclaredClass="esri.arcade.Feature";this.seen=!1;this._ty=this._tx=this.instance=0;this._sy=this._sx=1;this._deleted=null;this._joined=[];this._contextTimeZone=
this._objectIdToIndex=null;this._level=0;this.instance=C;this._layerSchema=A}static createInstance(){r++;return r=65535<r?0:r}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(C){this._contextTimeZone=C}set level(C){this._level=C}getAreaSimplificationThreshold(C,A){let D=1;const G=E?y:1;4E6<A?D=B*G:1E6<A?D=t*G:5E5<A?D=q*G:1E5<A&&(D=G);A=0;4E3<C?A=z*D:2E3<C?A=x*D:100<C?A=w:15<C&&(A=u);C=8;4>this._level?
C=1:5>this._level?C=2:6>this._level&&(C=4);return A*C}createQuantizedExtrudedGeometry(C,A){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(C,A):this._createQuantizedExtrudedQuad(C,A)}_createQuantizedExtrudedQuad(C,A){return new m([5],[C-1,A,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(C,A){return new m([2],[C-1,A+1,1,-1])}parseTimestampOffset(C){return C}setArcadeSpatialReference(C){this._arcadeSpatialReference=C}attachStorage(C){this._storage=C}getQuantizationTransform(){throw Error("Unable to find transform for featureSet");
}getStorage(){return this._storage}getComputedNumeric(C){return this.getComputedNumericAtIndex(0)}setComputedNumeric(C,A){return this.setComputedNumericAtIndex(A,0)}getComputedString(C){return this.getComputedStringAtIndex(0)}setComputedString(C,A){return this.setComputedStringAtIndex(0,A)}getComputedNumericAtIndex(C){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),C)}setComputedNumericAtIndex(C,A){this._storage.setComputedNumericAtIndex(this.getDisplayId(),C,A)}getComputedStringAtIndex(C){return this._storage.getComputedStringAtIndex(this.getDisplayId(),
C)}setComputedStringAtIndex(C,A){return this._storage.setComputedStringAtIndex(this.getDisplayId(),C,A)}transform(C,A,D,G){const J=this.copy();J._tx+=C;J._ty+=A;J._sx*=D;J._sy*=G;return J}readAttributeAsTimestamp(C){C=this.readAttribute(C);return"string"===typeof C?(new Date(C)).getTime():"number"===typeof C||null==C?C:null}readAttribute(C,A=!1){var D=this._readAttribute(C,A);if(void 0!==D)return D;for(const G of this._joined)if(G.setIndex(this.getIndex()),D=G._readAttribute(C,A),void 0!==D)return D}readAttributes(){const C=
this._readAttributes();for(const A of this._joined){A.setIndex(this.getIndex());const D=A._readAttributes();for(const G of Object.keys(D))C[G]=D[G]}return C}joinAttributes(C){this._joined.push(C)}readArcadeFeature(){return this}hasField(C){return this.fields.has(C)}geometry(){var C=this.readHydratedGeometry();C=c.convertToGeometry(C,this.geometryType,this.hasZ,this.hasM);if(C=l.fromJSON(C))C.spatialReference=this._arcadeSpatialReference;return C}autocastArcadeDate(C,A){return A&&A instanceof Date?
this.isUnknownDateTimeField(C)?v.ArcadeDate.unknownDateJSToArcadeDate(A):v.ArcadeDate.dateJSAndZoneToArcadeDate(A,this.contextTimeZone??d.system):A}isUnknownDateTimeField(C){return this._layerSchema.fieldsIndex.getTimeZone(C)===d.unknown}field(C){let A=this.fields.get(C);if(A)switch(A.type){case "date-only":case "esriFieldTypeDateOnly":return f.DateOnly.fromReader(this.readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return e.TimeOnly.fromReader(this.readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return v.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,this.readAttribute(C,!0));default:return this.readAttribute(C,!1)}for(const D of this._joined)if(D.setIndex(this.getIndex()),A=D.fields.get(C))switch(A.type){case "date-only":case "esriFieldTypeDateOnly":return f.DateOnly.fromReader(D._readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return e.TimeOnly.fromReader(D._readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return v.ArcadeDate.fromReaderAsTimeStampOffset(D._readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,D._readAttribute(C,!0));default:return this.readAttribute(C,!1)}throw Error(`Field ${C} does not exist`);}setField(C,A){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(C=>C.name)}castToText(C=!1){if(!C)return JSON.stringify(this.readLegacyFeature());C=this.readLegacyFeature();if(!C)return JSON.stringify(null);C={geometry:C.geometry,attributes:{...(C.attributes??
{})}};for(const A in C.attributes){const D=C.attributes[A];D instanceof Date&&(C.attributes[A]=D.getTime())}return JSON.stringify(C)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(C=null){return{attributes:this._readAttributes(),geometry:!0===C?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(C,A=null){return Promise.resolve(this.castAsJson(A))}removeIds(C){if(null==this._objectIdToIndex){var A=new Map;const D=this.getCursor();for(;D.next();){const G=
D.getObjectId();p.assertIsSome(G);A.set(G,D.getIndex())}this._objectIdToIndex=A}A=this._objectIdToIndex;for(const D of C)A.has(D)&&this.removeAtIndex(A.get(D))}removeAtIndex(C){null==this._deleted&&(this._deleted=k.StaticBitSet.create(this.getSize()));this._deleted.set(C)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const C=this.getCursor();for(;C.next();)yield C.readOptimizedFeature()}_getExists(){return null==
this._deleted||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;var C=this.readUnquantizedGeometry();if(!C||C.hasIndeterminateRingOrder)return null;C=a.GeometryCursor.fromOptimized(C,this.geometryType);C.yFactor*=-1;return(C=b.getLabelPoint(C))?(C[1]*=-1,new m([],C)):null}copyInto(C){C.seen=this.seen;C._storage=this._storage;C._arcadeSpatialReference=this._arcadeSpatialReference;C._joined=this._joined;C._tx=this._tx;C._ty=this._ty;C._sx=
this._sx;C._sy=this._sy;C._deleted=this._deleted;C._objectIdToIndex=this._objectIdToIndex;C.contextTimeZone=this.contextTimeZone}}h.FeatureSetReader=F;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(h,g,v,n){function p(c,m,d){return c<m?c-m:c>d?c-d:0}function f(c,m=!0){if(c instanceof n.Zone)return c;if("system"===c.toLowerCase())return"system";if("utc"===
c.toLowerCase())return"UTC";if("unknown"===c.toLowerCase())return v.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(c)){const d=n.FixedOffsetZone.parseSpecifier("UTC"+(c.startsWith("+")||c.startsWith("-")?"":"+")+c);if(d)return d}c=n.IANAZone.create(c);if(!c.isValid){if(m)throw new a(h.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return c}h.ArcadeDateErrorCodes=void 0;(h.ArcadeDateErrorCodes||(h.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const e={[h.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class a extends Error{constructor(c,m){super(g.replace(e[c],m));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,a)}}class b{constructor(c){this._date=c;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(c=0,m=1,d=1,k=0,l=0,r=0,u=0,w){if(isNaN(c)||isNaN(m)||isNaN(d)||isNaN(k)||isNaN(l)||isNaN(r)||isNaN(u))return null;const x=
n.DateTime.local(c,m).daysInMonth;c=n.DateTime.fromObject({day:1>d?1:d>x?x:d,year:c,month:1>m?1:12<m?12:m,hour:0>k?0:23<k?23:k,minute:0>l?0:59<l?59:l,second:0>r?0:59<r?59:r,millisecond:0>u?0:999<u?999:u},{zone:f(w)});c=c.plus({months:p(m,1,12),days:p(d,1,x),hours:p(k,0,23),minutes:p(l,0,59),seconds:p(r,0,59),milliseconds:p(u,0,999)});return new b(c)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(c,m){m=
f(m);return c.isUnknownTimeZone||m===v.UnknownTimeZone.instance?b.fromParts(c.year,c.monthJS+1,c.day,c.hour,c.minute,c.second,c.millisecond,m):new b(c._date.setZone(m))}static dateJSToArcadeDate(c){return new b(n.DateTime.fromJSDate(c,{zone:"system"}))}static dateJSAndZoneToArcadeDate(c,m="system"){m=f(m);return new b(n.DateTime.fromJSDate(c,{zone:m}))}static unknownEpochToArcadeDate(c){return new b(n.DateTime.fromMillis(c,{zone:v.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(c){return new b(n.DateTime.fromMillis(c.getTime(),
{zone:v.UnknownTimeZone.instance}))}static epochToArcadeDate(c,m="system"){m=f(m);return new b(n.DateTime.fromMillis(c,{zone:m}))}static dateTimeToArcadeDate(c){return new b(c)}clone(){return new b(this._date)}changeTimeZone(c){c=f(c);return b.dateTimeToArcadeDate(this._date.setZone(c))}static dateTimeAndZoneToArcadeDate(c,m){m=f(m);return c.zone===v.UnknownTimeZone.instance||m===v.UnknownTimeZone.instance?b.fromParts(c.year,c.month,c.day,c.hour,c.minute,c.second,c.millisecond,m):new b(c.setZone(m))}static nowToArcadeDate(c){c=
f(c);return new b(n.DateTime.fromJSDate(new Date,{zone:c}))}static nowUTCToArcadeDate(){return new b(n.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===b.systemTimeZoneCanonicalName}equals(c){return this.isSystem&&c.isSystem?this.toNumber()===c.toNumber():this.isUnknownTimeZone!==c.isUnknownTimeZone?!1:this._date.equals(c._date)}get isUnknownTimeZone(){return this._date.zone===v.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let c=
this._date.weekday;6<c&&(c=0);return c}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const c=this.zone;return"fixed"===c.type?0===c.fixed?"UTC":c.formatOffset(0,"short"):c.name}stringify(){return JSON.stringify(this.toJSDate())}plus(c){return new b(this._date.plus(c))}diff(c,m="milliseconds"){return this._date.diff(c._date,m)[m]}toISODate(){return this._date.toISODate()}toISOString(c){return c?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(c,m){return this._date.toISOTime({suppressMilliseconds:c,
includeOffset:m&&!this.isUnknownTimeZone})}toFormat(c,m){this.isUnknownTimeZone&&(c=c.replaceAll("Z",""));return this._date.toFormat(c,m)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new b(this._date.toUTC())}toLocal(){return new b(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(c){if(!c)return null;
c=n.DateTime.fromISO(c,{setZone:!0});return new b(c)}}h.ArcadeDate=b;h.ArcadeDateError=a;h.ArcadeDateErrorMessages=e;h.createDateTimeZone=f;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(h,g,v,n){function p(e){e=e.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let a="";const b=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const c of e.match(b)||[])switch(c){case "D":a+="d";break;case "DD":a+="dd";break;case "DDD":a+="o";break;case "d":a+="c";break;case "ddd":a+="ccc";break;case "dddd":a+="cccc";break;case "M":a+="L";break;case "MM":a+="LL";break;case "MMM":a+="LLL";break;case "MMMM":a+="LLLL";break;case "YY":a+="yy";break;case "Y":case "YYYY":a+="yyyy";break;case "Q":a+="q";break;case "X":case "x":a+=c;break;default:a=2<=c.length&&"["===c.slice(0,1)&&"]"===c.slice(-1)?a+`'${c.slice(1,-1)}'`:a+`'${c}'`}return a}
class f{constructor(e,a,b){this._year=e;this._month=a;this._day=b;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return e instanceof f&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new f(this._year,this._month,this._day)}toDateTime(e){return n.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:g.createDateTimeZone(e)})}toDateTimeLuxon(e){return n.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:g.createDateTimeZone(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null){if(null===e||""===e)return this.toString();e=p(e);if(!e)return"";const a=this.toDateTime("unknown");return g.ArcadeDate.dateTimeToArcadeDate(a).toFormat(e,{locale:v.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return g.ArcadeDate.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd")}toSQLValue(){return this.toFormat("yyyy-LL-dd")}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd")+"'"}plus(e,a){return f.fromDateTime(this.toUTCDateTime().plus({[e]:a}))}toUTCDateTime(){return n.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(e,a){switch(a.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===a?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(e.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(e){e=n.DateTime.fromMillis(e,{zone:n.FixedOffsetZone.utcInstance});
return e.isValid?f.fromParts(e.year,e.month,e.day):null}static fromSeconds(e){e=n.DateTime.fromSeconds(e,{zone:n.FixedOffsetZone.utcInstance});return e.isValid?f.fromParts(e.year,e.month,e.day):null}static fromReader(e){if(!e)return null;e=e.split("-");return 3!==e.length?null:new f(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10))}static fromParts(e,a,b){e=new f(e,a,b);return!1===e.isValid?null:e}static fromDateJS(e){return f.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return f.fromParts(e.year,
e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,a=null){if(""===e||null===e)return null;var b=[];if(a)(a=p(a))&&b.push(a);else if(null===a||""===a)return e=n.DateTime.fromISO(e,{setZone:!0}),e.isValid?f.fromParts(e.year,e.month,e.day):null;for(const c of b)if(b=n.DateTime.fromFormat(e,a??c),b.isValid)return new f(b.year,b.month,b.day);return null}static fromNow(e="system"){e=n.DateTime.fromJSDate(new Date).setZone(g.createDateTimeZone(e));
return new f(e.year,e.month,e.day)}}h.DateOnly=f;h.standardiseDateOnlyFormat=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(h,g,v,n){function p(e){if(!e)return"";const a=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let b="";for(const c of e.match(a)||[])switch(c){case "SSS":b+=c;break;case "A":case "a":b+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":b+=
c;break;default:b+=`'${c}'`}return b}class f{constructor(e,a,b,c){this._hour=e;this._minute=a;this._second=b;this._millisecond=c;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return e instanceof f&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new f(this.hour,this.minute,this.second,
this.millisecond)}isValid(){return g.isInteger(this.hour)&&g.isInteger(this.minute)&&g.isInteger(this.second)&&g.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,
"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return null===e||""===e?this.toString():(e=p(e))?n.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:v.getLocale(),numberingSystem:"latn"}):
""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(e,a,b,c){e=new f(e,a,b,c);return e.isValid()?e:null}static fromReader(e){if(!e)return null;e=e.split(":");return 3!==e.length?null:new f(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}static fromMilliseconds(e){return 864E5<e||0>e?null:new f(Math.floor(e/36E5%24),Math.floor(e/6E4%60),Math.floor(e/1E3%60),Math.floor(e%1E3))}static fromDateJS(e){return new f(e.getHours(),e.getMinutes(),e.getSeconds(),
e.getMilliseconds())}static fromDateTime(e){return new f(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,a=null){if(""===e||null===e)return null;const b=[];if(a)(a=p(a))&&b.push(a);else if(null===a||""===a)b.push("HH:mm:ss"),b.push("HH:mm:ss.SSS"),b.push("hh:mm:ss a"),b.push("hh:mm:ss.SSS a"),b.push("HH:mm"),b.push("hh:mm a"),b.push("H:mm"),b.push("h:mm a"),b.push("H:mm:ss"),b.push("h:mm:ss a"),b.push("H:mm:ss.SSS"),
b.push("h:mm:ss.SSS a");for(const c of b)if(a=n.DateTime.fromFormat(e,c),a.isValid)return new f(a.hour,a.minute,a.second,a.millisecond);return null}plus(e,a){switch(e){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return f.fromDateTime(this.toUTCDateTime().plus({[e]:a}))}return null}toUTCDateTime(){return n.DateTime.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,a){switch(a.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(e.toUTCDateTime(),
"days").days;case "months":case "month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===a?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;
case "hours":case "hour":case "h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds}}}h.TimeOnly=f;h.standardiseTimeFormat=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(h,g){h.cloneGeometry=function(v){if(null==
v)return null;const n=v.clone();void 0!==v.cache._geVersion&&(n.cache._geVersion=v.cache._geVersion);return n};h.convertLinearUnitsToCode=function(v){if(null==v)return null;if("number"===typeof v)return v;v=v.toLowerCase();v=v.replaceAll(/\s/g,"");v=v.replaceAll("-","");switch(v){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};h.convertSquareUnitsToCode=function(v){if(null==v)return null;if("number"===typeof v)return v;v=v.toLowerCase();v=v.replaceAll(/\s/g,"");v=v.replaceAll("-","");switch(v){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;
case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};
h.isInteger=function(v){return"number"===typeof v&&isFinite(v)&&Math.floor(v)===v};h.sameGeomType=function(v,n){return v===n||"point"===v&&"esriGeometryPoint"===n||"polyline"===v&&"esriGeometryPolyline"===n||"polygon"===v&&"esriGeometryPolygon"===n||"extent"===v&&"esriGeometryEnvelope"===n||"multipoint"===v&&"esriGeometryMultipoint"===n||"point"===n&&"esriGeometryPoint"===v||"polyline"===n&&"esriGeometryPolyline"===v||"polygon"===n&&"esriGeometryPolygon"===v||"extent"===n&&"esriGeometryEnvelope"===
v||"multipoint"===n&&"esriGeometryMultipoint"===v?!0:!1};h.shapeExtent=function(v){if(null==v)return null;switch(v.type){case "polygon":case "multipoint":case "polyline":return v.extent;case "point":return new g({xmin:v.x,ymin:v.y,xmax:v.x,ymax:v.y,spatialReference:v.spatialReference});case "extent":return v}return null};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils",
"../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(h,g,v,n,p){function f({coords:a,lengths:b}){let c=0;for(const m of b){for(b=1;b<m;b++)a[2*(c+b)]+=a[2*(c+b)-2],a[2*(c+b)+1]+=a[2*(c+b)-1];c+=m}}class e extends p.FeatureSetReader{static fromFeatures(a,b){const {objectIdField:c,geometryType:m}=b,d=g.convertFromFeatures([],a,m,!1,!1,c);for(let k=0;k<d.length;k++)d[k].displayId=a[k].displayId;return e.fromOptimizedFeatures(d,b)}static fromFeatureSet(a,
b){a=g.convertFromFeatureSet(a,b.objectIdField);return e.fromOptimizedFeatureSet(a,b)}static fromOptimizedFeatureSet(a,b){var {features:c}=a;c=e.fromOptimizedFeatures(c,b);c._exceededTransferLimit=a.exceededTransferLimit;c._transform=a.transform;c._fieldsIndex=new n(b.fields);return c}static fromOptimizedFeatures(a,b,c){const m=p.FeatureSetReader.createInstance();a=new e(m,a,b);a._fieldsIndex=new n(b.fields);a._transform=c;return a}constructor(a,b,c){super(a,c);this._exceededTransferLimit=!1;this._featureIndex=
-1;this._fieldsIndex=null;this._geometryType=c?.geometryType;this._features=b}get fields(){return this._fieldsIndex}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(a){const b=new Set(a);this._features=this._features.filter(c=>
!(null!=c.objectId&&b.has(c.objectId)))}append(a){for(const b of a)this._features.push(b)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let a="";for(const b in this._current.attributes)a+=this._current.attributes[b];return a}getIndex(){return this._featureIndex}setIndex(a){this._featureIndex=a}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){this._current.displayId=
a}getGroupId(){return this._current.groupId}setGroupId(a){this._current.groupId=a}copy(){const a=new e(this.instance,this._features,this.fullSchema());this.copyInto(a);return a}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return g.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),
y:this.getY()}:null}readLegacyGeometry(){const a=this.readUnquantizedGeometry();return g.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const a=this.readCentroid();return null==a?null:{x:a.coords[0]*this._sx+this._tx,y:a.coords[1]*this._sy+this._ty}}readGeometryArea(){return v.hasGeometry(this._current)?g.getQuantizedArea(this._current.geometry,2):0}readUnquantizedGeometry(){var a=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!a)return a;a=a.clone();
f(a);return a}readHydratedGeometry(){var a=this._current.geometry;if(null==a)return null;a=a.clone();null!=this._transform&&g.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,this._transform);return a}getXHydrated(){if(!v.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[0],b=this.getQuantizationTransform();return null==b?a:a*b.scale[0]+b.translate[0]}getYHydrated(){if(!v.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[1],b=this.getQuantizationTransform();
return null==b?a:b.translate[1]-a*b.scale[1]}getX(){return v.hasGeometry(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return v.hasGeometry(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!v.hasGeometry(this._current)){if(null!=this._current.centroid){const [c,m]=this._current.centroid.coords;return this.createQuantizedExtrudedGeometry(c,m)}return null}const a=this._current.geometry.clone();if(a.isPoint)return a.coords[0]=a.coords[0]*
this._sx+this._tx,a.coords[1]=a.coords[1]*this._sy+this._ty,a;let b=0;for(const c of a.lengths)a.coords[2*b]=a.coords[2*b]*this._sx+this._tx,a.coords[2*b+1]=a.coords[2*b+1]*this._sy+this._ty,b+=c;return a}readCentroid(){return v.hasGeometry(this._current)?this._computeCentroid():this._current.centroid}_readAttribute(a,b){var c=this._fieldsIndex.get(a);if(c){c=this._current.attributes[c.name];if(null==c)return c;"esriFieldTypeTimestampOffset"===this.fields.get(a)?.type&&(c=this.parseTimestampOffset(c));
return b&&this.fields.isDateField(a)?new Date(c):c}}copyInto(a){super.copyInto(a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._fieldsIndex=this._fieldsIndex}_readAttributes(){return this._current.attributes}}h.FeatureSetReaderJSON=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("../../../../core/screenUtils ../../../../chunks/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../symbols/cim/CIMSymbolDrawHelper ../../../../symbols/cim/CIMSymbolHelper ./GraphicStoreItem ./graphicsUtils".split(" "),
function(h,g,v,n,p,f,e,a,b,c){function m(w,x,z,q,t){k.minX=x;k.minY=z;k.maxX=q;k.maxY=t;return w.search(k)}function d(w){return{minX:w.bounds[0],minY:w.bounds[1],maxX:w.bounds[2],maxY:w.bounds[3]}}const k={minX:0,minY:0,maxX:0,maxY:0},l=v.create();class r{constructor(w,x,z,q,t,B,y){this._graphics=q;this._onAdd=t;this._onRemove=B;this._hashToCIM=y;this._index=g.rbush(9,d);this._itemByGraphic=new Map;this._inflatedSizeHelper=new a.CIMSymbolInflatedSizeHelper;this._tileInfoView=w;this._uidFieldName=
z;if(w=w.getClosestInfoForScale(x))this._resolution=this._tileInfoView.getTileResolution(w.level)}setResourceManager(w){this._cimResourceManager=w;this._hittestDrawHelper=new e.HittestDrawHelper(w)}hitTest(w,x,z,q,t){w=p.normalizeMapX(w,this._tileInfoView.spatialReference);var B=.5*q*window.devicePixelRatio*z;l[0]=w-B;l[1]=x-B;l[2]=w+B;l[3]=x+B;z=.5*q*(z+c.pixelBuffer);x=m(this._index,w-z,x-z,w+z,x+z);if(!x||0===x.length)return[];w=[];z=v.create();B=v.create();for(var y of x){const {geometry:E,symbolResource:F}=
y;this._getSymbolBounds(z,F,E,B,t);B[3]=B[2]=B[1]=B[0]=0;v.intersects(z,l)&&y.graphic?.visible&&w.push(y)}if(0===w.length)return[];y=this._hittestDrawHelper;x=[];for(const E of w){const {geometry:F,symbolResource:C}=E,{hash:A,textInfo:D}=C;(w=this._hashToCIM.get(A))&&y.hitTest(l,w.symbol,F,D,t,q)&&x.push(E)}x.sort(u);return x.map(E=>E.graphic)}getGraphicsData(w,x,z){const q=this._searchForItems(x);if(0===q.length||0===z.length)return[];q.sort((A,D)=>A.zorder-D.zorder);q[0].insertAfter=-1;for(var t=
1;t<q.length;t++)q[t].insertAfter=q[t-1].graphic.uid;q.sort((A,D)=>A.graphic.uid-D.graphic.uid);z.sort((A,D)=>A.uid-D.uid);let B=t=0,y;const E=x.resolution,F=[],C={originPosition:"upperLeft",scale:[E,E],translate:[x.bounds[0],x.bounds[3]]};for(const A of z){for(B=-2;t<q.length;)if(y=q[t],t++,A.uid===y.graphic.uid){B=y.insertAfter;break}if(!y?.geometry||-2===B)continue;z=y.getGeometryQuantized(C,x.bounds,this._tileInfoView.spatialReference,E);const D={...y.graphic.attributes};D[this._uidFieldName]=
A.uid;null==y.groupId&&(y.groupId=w.createTemplateGroup(y.symbol,null));F.push({centroid:b.getCentroidQuantized(y,C),geometry:z,attributes:D,symbol:y.symbol,groupId:y.groupId,insertAfter:B,zorder:y.zorder})}F.sort((A,D)=>A.zorder-D.zorder);return F}queryTileData(w,x){if(0===this._graphics.length)return[];const {bounds:z,resolution:q}=x,t=this._searchForItems(x),B=[];if(0===t.length)return B;this._createTileGraphics(B,w,t,{originPosition:"upperLeft",scale:[q,q],translate:[z[0],z[3]]},x);return B}has(w){return this._itemByGraphic.has(w)}getBounds(w){return(w=
this._itemByGraphic.get(w))?w.bounds:null}getAllBounds(){return Array.from(this._itemByGraphic.values()).filter(w=>w.graphic.visible).map(w=>w.bounds)}addOrModify(w,x,z){if(w&&null!=x){this.has(w)&&this.remove(w);this._onAdd(w);var q=[0,0,0,0],t=this._getSymbolBounds(null,x,z,q,0);x=b.acquire(w,x,z,null!=t?t:null,q);this._itemByGraphic.set(w,x);z&&this._index.insert(x);return x.bounds}}remove(w){if(this._itemByGraphic.has(w)){this._onRemove(w);var x=this._itemByGraphic.get(w);x?.bounds&&this._index.remove(x);
this._itemByGraphic.delete(w)}}updateZ(){const w=this._graphics.items;for(let z=0;z<w.length;z++){var x=w[z];if(x=this._itemByGraphic.get(x))x.zorder=z}}update(w,x,z){const q=this._itemByGraphic.get(w);q.groupId=null;const t=v.clone(q.bounds);this._index.remove(q);const B=this._getSymbolBounds(q.bounds,x,z,q.size,0);null!=B&&q.set(w,x,z,B,q.size);z&&this._index.insert(q);return{oldBounds:t,newBounds:q.bounds}}updateLevel(w){if(this._resolution!==w){this._resolution=w;this._index.clear();var x=this._itemByGraphic;
w=[];for(const [,z]of x)x=this._getSymbolBounds(z.bounds,z.symbolResource,z.geometry,z.size,0),z.geometry&&null!=x&&(z.bounds=x,w.push(z));this._index.load(w)}}clear(){this._itemByGraphic.clear();this._index.clear()}_createTileGraphics(w,x,z,q,t){const B=this._uidFieldName,y=this._tileInfoView.spatialReference,{bounds:E,resolution:F}=t;z.sort((G,J)=>G.zorder-J.zorder);let C,A,D;for(let G=0;G<z.length;G++){A=z[G];t=A.graphic;C=A.getGeometryQuantized(q,E,y,F);D=0===G?-1:z[G-1].graphic.uid;const J={...A.graphic.attributes};
J[B]=t.uid;null==A.groupId&&(A.groupId=x.createTemplateGroup(A.symbol,null));w.push({centroid:b.getCentroidQuantized(A,q),geometry:C,attributes:J,symbol:A.symbol,groupId:A.groupId,insertAfter:D,zorder:A.zorder})}}_searchForItems(w){var x=this._tileInfoView.spatialReference,z=w.bounds,q=f.getInfo(x);if(q&&x.isWrappable){const [t,B]=q.valid;x=1E-5>Math.abs(z[2]-B);q=1E-5>Math.abs(z[0]-t);if(!(x&&q||!x&&!q))return w=w.resolution,w=x?v.create([t,z[1],t+w*c.pixelBuffer,z[3]]):v.create([B-w*c.pixelBuffer,
z[1],B,z[3]]),z=m(this._index,z[0],z[1],z[2],z[3]),w=m(this._index,w[0],w[1],w[2],w[3]),[...(new Set([...z,...w]))]}return m(this._index,z[0],z[1],z[2],z[3])}_getSymbolBounds(w,x,z,q,t){if(!x||!x.symbol||!z)return null;w||(w=v.create());n.getBoundsXY(w,z);if(!q||0===q[0]&&0===q[1]&&0===q[2]&&0===q[3]){const {hash:B,textInfo:y}=x;x=this._hashToCIM.get(B);if(!x)return null;q||(q=[0,0,0,0]);t=this._inflatedSizeHelper.getSymbolInflateSize(q,x.symbol,this._cimResourceManager,t,y);q[0]=h.pt2px(t[0]);q[1]=
h.pt2px(t[1]);q[2]=h.pt2px(t[2]);q[3]=h.pt2px(t[3])}t=this._resolution;q=a.CIMSymbolInflatedSizeHelper.safeSize(q);w[0]-=q*t;w[1]-=q*t;w[2]+=q*t;w[3]+=q*t;return w}}const u=(w,x)=>{const z=c.graphicGeometryToNumber(w.graphic),q=c.graphicGeometryToNumber(x.graphic);return z===q?x.zorder-w.zorder:z-q};return r})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry".split(" "),
function(h,g,v,n,p,f,e){function a(d){d.coords.length=0;d.lengths.length=0}const b=new e,c=new e;class m{constructor(){this.bounds=h.create();this.graphic=null}static acquire(d=null,k,l,r,u){let w;0===m._pool.length?w=new m:(w=m._pool.pop(),this._set.delete(w));w.acquire(d,k,l,r,u);return w}static release(d){d&&!this._set.has(d)&&(d.release(),this._pool.push(d),this._set.add(d))}static getCentroidQuantized(d,k){if(v.isPolygon(d.geometry)){const l=d.symbol;if(null==l)return null;if(0<l?.layers.length&&
l.layers.some(r=>"text"===r.type||"marker"===r.type))return d=g.polygonCentroid(d.geometry),null!==d?n.quantizePoint(k,{},{x:d[0],y:d[1]},!1,!1):null}return null}acquire(d=null,k,l,r,u){d&&this.set(d,k,l,r,u)}release(){this.geometry=this.symbolResource=this.graphic=null}get symbol(){return this.symbolResource.symbol}set(d,k,l,r,u){this.graphic=d;this.geometry=l;this.symbolResource=k;this.bounds=r;u&&(this.size=u)}getGeometryQuantized(d,k,l,r){var u=this.geometry;const w=v.getJsonType(u);if(null==
w)return null;switch(w){case "esriGeometryPolygon":({rings:u}=u);if(!u||0===u.length)return null;l=1===u.length&&2===u[0].length?n.quantizeGeometry(d,{paths:[[u[0][0],u[0][1]]]}):n.quantizeGeometry(d,this.geometry);if(!l&&(l=n.quantizeGeometry(d,{x:u[0][0][0],y:u[0][0][1]}))){const {x:z,y:q}=l;return{rings:[[[z-1,q],[1,-1],[1,1],[-1,1],[-1,-1]]]}}return l;case "esriGeometryPolyline":return a(b),a(c),l=u.hasZ??!1,r=u.hasM??!1,f.convertFromPolyline(b,u),f.generalizeOptimizedGeometry(c,b,l,r,"esriGeometryPolyline",
d.scale[0]),f.quantizeOptimizedGeometry(b,c,l,r,"esriGeometryPolyline",d),f.convertToPolyline(b,u.hasZ??!1,u.hasM??!1);case "esriGeometryMultipoint":const x=.5*r*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]);l=p.getInfo(l);u=u.points;if(l){const [z,q]=l.valid,t=q-z;u=u.filter(B=>{if(B[0]+x>q||B[0]-x<z){const y=[...B];y[0]=B[0]+x>q?y[0]-t:y[0]+t;return h.containsPointWithMargin(k,B,x)||h.containsPointWithMargin(k,y,x)}return h.containsPointWithMargin(k,
B,x)})}return 0===u.length?{points:u}:n.quantizeGeometry(d,{points:u})}return n.quantizeGeometry(d,this.geometry)}}m._pool=[];m._set=new Set;return m})},"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["../../engine/webgl/enums","./BaseGraphicContainer"],function(h,g){class v extends g{renderChildren(n){this.attributeView.update();this.children.some(p=>p.hasData)&&(this.attributeView.bindTextures(n.context,!1),super.renderChildren(n),n.drawPhase===h.WGLDrawPhase.MAP&&this._renderChildren(n),
this.hasHighlight&&n.drawPhase===h.WGLDrawPhase.HIGHLIGHT&&this._renderHighlight(n),this._boundsRenderer&&this._boundsRenderer.doRender(n))}_renderHighlight(n){var {painter:p}=n;p=p.effects.highlight;p.bind(n);this._renderChildren(n,p.defines);p.draw(n);p.unbind()}}return v})},"esri/views/2d/layers/graphics/BaseGraphicContainer":function(){define(["../../../../core/maybe","../../engine/FeatureContainer","./GraphicBoundsRenderer","../../../webgl/enums"],function(h,g,v,n){return class extends g.FeatureContainer{constructor(p){super(p);
this.checkHighlight=()=>!0}destroy(){super.destroy();this._boundsRenderer=h.destroyMaybe(this._boundsRenderer)}enableRenderingBounds(p){this._boundsRenderer=new v(p);this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(p,f){p.patch(f);this.contains(p)||this.addChild(p);this.requestRender()}onTileError(p){p.clear();this.contains(p)||this.addChild(p)}_renderChildren(p,f){for(const e of this.children)e.isReady&&e.hasData&&(e.commit(p),p.context.setStencilFunction(n.CompareFunction.EQUAL,
e.stencilRef,255),e.getDisplayList().replay(p,e,f))}}})},"esri/views/2d/engine/FeatureContainer":function(){define("exports ../../../core/promiseUtils ../../../core/Queue ./webgl/AttributeStoreView ./webgl/TileContainer ./webgl/WGLRendererInfo".split(" "),function(h,g,v,n,p,f){class e extends p{constructor(a){super(a);this._rendererInfo=new f.WGLRendererInfo;this._materialItemsRequestQueue=new v;this.attributeView=new n.AttributeStoreView(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(a=>
a.destroy());this.removeAllChildren();this.attributeView.destroy();this._materialItemsRequestQueue.clear()}setRendererInfo(a,b,c){this._rendererInfo.setInfo(a,b,c);this.requestRender()}async getMaterialItems(a,b){if(!a||0===a.length)return[];const c=g.createResolver();this._materialItemsRequestQueue.push({items:a,abortOptions:b,resolver:c});this.requestRender();return c.promise}doRender(a){a.context.capabilities.enable("textureFloat");a.context.capabilities.enable("vao");if(0<this._materialItemsRequestQueue.length){let b=
this._materialItemsRequestQueue.pop();for(;b;)this._processMaterialItemRequest(a,b),b=this._materialItemsRequestQueue.pop()}super.doRender(a)}renderChildren(a){for(const b of this.children)b.commit(a);this._rendererInfo.update(a.state);super.renderChildren(a)}createRenderParams(a){a=super.createRenderParams(a);a.rendererInfo=this._rendererInfo;a.attributeView=this.attributeView;return a}onAttributeStoreUpdate(){}_processMaterialItemRequest(a,{items:b,abortOptions:c,resolver:m}){const {painter:d,pixelRatio:k}=
a;a=b.map(l=>d.textureManager.rasterizeItem(l.symbol,k,l.glyphIds,c));Promise.all(a).then(l=>{this.stage?(l=l.map((r,u)=>({id:b[u].id,mosaicItem:r})),m.resolve(l)):m.reject()},m.reject)}}h.FeatureContainer=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ./definitions ./DisplayId ./Utils ./util/debug ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k){const l=n.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),r=b.createDebugLogger(b.debugAttrUpdates,l);class u{constructor(x,z,q){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;const {buffer:t,pixelType:B,textureOnly:y}=x;x=a.getPixelArrayCtor(B);this.shared=q;this.pixelType=B;this.size=z;this.textureOnly=y;y||(this.data=new x(t));this._resetRange()}destroy(){this._texture?.dispose();for(const x in this._fbos){const z=this._fbos[x];
z&&("0"===x&&z.detachColorTexture(),z.dispose());this._fbos[x]=null}this._texture=null}get _textureDesc(){const x=new k.TextureDescriptor;x.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=c.TextureSamplingMode.NEAREST;x.dataType=this.pixelType;x.width=this.size;x.height=this.size;return x}setData(x,z,q){x=e.getDisplayIdTexel(x);const t=this.data;z=x*this.texelSize+z;!t||z>=t.length||(t[z]=q,this.dirtyStart=Math.min(this.dirtyStart,x),this.dirtyEnd=Math.max(this.dirtyEnd,x))}getData(x,z){if(null==
this.data)return null;x=e.getDisplayIdTexel(x)*this.texelSize+z;return!this.data||x>=this.data.length?null:this.data[x]}getTexture(x){return this._texture??this._initTexture(x)}getFBO(x,z=0){if(!this._fbos[z]){const q=0===z?this.getTexture(x):this._textureDesc;this._fbos[z]=new m.FramebufferObject(x,q)}return this._fbos[z]}get locked(){return this.pixelType===c.PixelType.UNSIGNED_BYTE&&this.shared&&!this.textureOnly&&v("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1}get hasDirty(){return this.dirtyEnd>=
this.dirtyStart}updateTexture(x,z){if(!this.locked){try{const q=this.dirtyStart,t=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const B=this.data.buffer,y=this.getTexture(x),E=(q-q%this.size)/this.size,F=(t-t%this.size)/this.size,C=E*this.size*4,A=4*(this.size+F*this.size)-C,D=a.getPixelArrayCtor(this.pixelType),G=new D(B,C*D.BYTES_PER_ELEMENT,A),J=this.size;x=F-E+1;if(x>this.size){l.error(new g("mapview-webgl","Out-of-bounds index when updating AttributeData"));return}y.updateData(0,
0,E,J,x,G)}catch(q){}z()}}update(x){const {data:z,start:q,end:t}=x;if(null!=z&&null!=this.data){const B=this.data,y=q*this.texelSize;for(let E=0;E<z.length;E++)x.layout&1<<E%this.texelSize&&(B[y+E]=z[E])}this.dirtyStart=Math.min(this.dirtyStart,q);this.dirtyEnd=Math.max(this.dirtyEnd,t)}resize(x,z){const q=this.size;this.size=z;this.textureOnly?q!==this.size&&(this._lastTexture=this._texture,this._texture=null):(z=a.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new z(x.buffer))}_resetRange(){this.dirtyStart=
2147483647;this.dirtyEnd=0}_initTexture(x){const z=new d.Texture(x,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const B=this._lastTexture.descriptor.width,y=this._lastTexture.descriptor.height,E=this._lastTexture.descriptor.dataType,F=this._lastTexture.descriptor.pixelFormat,C=this.getFBO(x);var q=a.getPixelBytes(E),t=a.getPixelArrayCtor(E);q=new ArrayBuffer(B*y*q*this.texelSize);t=new t(q);q=x.getBoundFramebufferObject();const {x:A,y:D,width:G,height:J}=x.getViewport();
x.bindFramebuffer(C);C.readPixels(0,0,B,y,F,E,t);z.updateData(0,0,0,2*B,y/2,t);x.setViewport(A,D,G,J);x.bindFramebuffer(q)}this.destroy();return this._texture=z}}class w{constructor(x){this._onUpdate=x;this._locked=this._forceNextUpload=this._initialized=!1}initialize(x){const {blocks:z,shared:q,size:t}=x;this.shared=q;this.size=t;r("Initializing AttributeStoreView",x);if(null==this._data)this._data=z.map(B=>null!=B?new u(B,t,q):null);else for(x=0;x<this._data.length;x++){const B=this._data[x],y=
z[x];null!=y&&(null==B?this._data[x]=new u(y,t,q):B.resize(y,t))}this._initialized=!0}destroy(){for(const x of this._data??[])x?.destroy();this._defaultTexture?.dispose()}isEmpty(){return null==this._data}isUpdating(){const x=null!=this._pendingAttributeUpdate;v("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${x}\n  -> hasPendingUpdate ${x}`);return x}getBlock(x){return null==this._data?null:this._data[x]}setLabelMinZoom(x,z){this.setData(x,0,1,z)}getLabelMinZoom(x){return this.getData(x,
0,1,255)}getFilterFlags(x){return this.getData(x,0,0,0)}getVVSize(x){return this.getData(x,f.attributeDataVv,0,0)}getData(x,z,q,t){if(!this._data)return 0;z=this._data[z];if(null==z)return 0;x=z.getData(x,q);return null!=x?x:t}setData(x,z,q,t){this._data[z].setData(x,q,t)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}async requestUpdate(x){if(this._pendingAttributeUpdate)l.error(new g("mapview-webgl","Tried to update attribute data with a pending update"));
else{var z=p.createResolver();r("AttributeStoreView Update Requested",x);this._pendingAttributeUpdate={data:x,resolver:z};this._onUpdate();return z.promise}}update(){if(this._initialized&&null!=this._pendingAttributeUpdate){v("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");const {data:x,resolver:z}=this._pendingAttributeUpdate,q=this._data;for(let t=0;t<x.blocks.length;t++){const B=x.blocks[t],y=q[t];null!=y&&null!=B&&(r(`Updating block ${t}`,B),y.update(B))}this._pendingAttributeUpdate=
null;z();this._onUpdate()}}bindTextures(x,z=!0){const q=this._getDefaultTexture(x);if(this._initialized){var t=this._data;if(!this._locked||this._forceNextUpload){for(const B of t)B?.updateTexture(x,()=>this._onUpdate());this._forceNextUpload=!1}x.bindTexture(t[f.attributeDataFilterFlags]?.getTexture(x)??q,f.textureBindingAttributeData0);z&&(x.bindTexture(t[f.attributeDataGpgpu]?.getTexture(x)??q,f.textureBindingGpgpu),x.bindTexture(t[f.attributeDataAnimation]?.getTexture(x)??q,f.textureBindingAttributeData1),
x.bindTexture(t[f.attributeDataVv]?.getTexture(x)??q,f.textureBindingAttributeData2),x.bindTexture(t[f.attributeDataDd1]?.getTexture(x)??q,f.textureBindingAttributeData3),x.bindTexture(t[f.textureBindingAttributeData4]?.getTexture(x)??q,f.textureBindingAttributeData4),x.bindTexture(t[f.textureBindingAttributeData5]?.getTexture(x)??q,f.textureBindingAttributeData5))}else x.bindTexture(q,f.textureBindingAttributeData0),z&&(x.bindTexture(q,f.textureBindingAttributeData1),x.bindTexture(q,f.textureBindingAttributeData2),
x.bindTexture(q,f.textureBindingAttributeData3),x.bindTexture(q,f.textureBindingAttributeData4),x.bindTexture(q,f.textureBindingAttributeData5),x.bindTexture(q,f.textureBindingGpgpu))}_getDefaultTexture(x){if(null==this._defaultTexture){const z=new k.TextureDescriptor;z.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;z.samplingMode=c.TextureSamplingMode.NEAREST;z.width=1;z.height=1;this._defaultTexture=new d.Texture(x,z,new Uint8Array(4))}return this._defaultTexture}}h.AttributeStoreView=w;Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileContainer":function(){define(["../../../../core/has","./enums","./WGLContainer","./brushes/WGLBrushInfo","./brushes/WGLBrushStencil"],function(h,g,v,n,p){const f=(a,b)=>0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col;class e extends v{constructor(a){super();this._tileInfoView=a}renderChildren(a){this.sortChildren(f);this.setStencilReference(a);super.renderChildren(a)}createRenderParams(a){const {state:b}=
a;a=super.createRenderParams(a);a.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level;a.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(b.scale);return a}prepareRenderPasses(a){const b=super.prepareRenderPasses(a);b.push(a.registerRenderPass({name:"stencil",brushes:[p],drawPhase:g.WGLDrawPhase.DEBUG|g.WGLDrawPhase.MAP|g.WGLDrawPhase.HIGHLIGHT,target:()=>this.getStencilTarget()}));h("esri-tiles-debug")&&b.push(a.registerRenderPass({name:"tileInfo",brushes:[n],drawPhase:g.WGLDrawPhase.DEBUG,
target:()=>this.children}));return b}getStencilTarget(){return this.children}setStencilReference(a){a=1;for(const b of this.children)b.stencilRef=a++}}return e})},"esri/views/2d/engine/webgl/WGLContainer":function(){define(["../../../../core/has","../brushes","../Container","./ClippingInfo","./enums"],function(h,g,v,n,p){class f extends v.Container{set clips(e){super.clips=e;this._updateClippingInfo(e)}renderChildren(e){null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(e.painter));
for(const a of this._renderPasses)try{a.render(e)}catch(b){}}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[g.brushes.clip],target:()=>this._clippingInfos,drawPhase:p.WGLDrawPhase.MAP|p.WGLDrawPhase.LABEL|p.WGLDrawPhase.LABEL_ALPHA|p.WGLDrawPhase.DEBUG|p.WGLDrawPhase.HIGHLIGHT})]}_updateClippingInfo(e){null!=this._clippingInfos&&(this._clippingInfos.forEach(a=>a.destroy()),this._clippingInfos=null);null!=e&&e.length&&(this._clippingInfos=e.items.map(a=>n.fromClipArea(this.stage,
a)));this.requestRender()}}return f})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../chunks/mat3f32 ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(h,g,v,n,p,f,e){class a extends p.DisplayObject{constructor(b,c){super();this._clip=c;this._cache={};this.stage=b;this._handle=v.watch(()=>c.version,()=>this._invalidate());this.ready()}static fromClipArea(b,c){return new a(b,
c)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL();this._handle.remove()}getVAO(b,c,m,d){const [k,l]=c.size;if("geometry"===this._clip.type||this._lastWidth!==k||this._lastHeight!==l)this._lastWidth=k,this._lastHeight=l,this._destroyGL();if(null==this._cache.vao){c=this._createMesh(c,this._clip);const r=c.getIndexBuffer(b),u=c.getVertexBuffers(b);this._cache.mesh=
c;this._cache.vao=new e.VertexArrayObject(b,m,d,u,r)}return this._cache.vao}_createTransforms(){return{dvs:n.create()}}_invalidate(){this._destroyGL();this.requestRender()}_createScreenRect(b,c){const [m,d]=b.size;b="string"===typeof c.left?parseFloat(c.left)/100*m:c.left;const k="string"===typeof c.right?parseFloat(c.right)/100*m:c.right,l="string"===typeof c.top?parseFloat(c.top)/100*d:c.top;c="string"===typeof c.bottom?parseFloat(c.bottom)/100*d:c.bottom;return{x:b,y:l,width:Math.max(m-k-b,0),
height:Math.max(d-c-l,0)}}_createMesh(b,c){switch(c.type){case "rect":return f.fromRect(this._createScreenRect(b,c));case "path":return f.fromPath(c);case "geometry":return f.fromGeometry(b,c);default:return g.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new h("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),f.fromRect({x:0,y:0,width:1,height:1})}}}return a})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("../../../../core/Error ../../../../core/Logger ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(h,g,v,n,p,f,e,a,b,c){const m=({coords:k,lengths:l},r)=>{const u=[];for(let z=0,q=0;z<l.length;q+=l[z],z+=1){const t=q;for(var w=[];z<l.length-1;z+=1,q+=l[z]){var x=q+l[z];let B=0;for(let y=1;y<l[z+1];y++)B+=(k[2*(x+y)]-k[2*(x+y-1)])*(k[2*(x+y)+1]+k[2*(x+y-1)+1]);if(!(r?0<B:0>B))break;w.push(q+l[z]-t)}x=k.slice(2*t,2*(q+l[z]));w=v.earcut(x,w,2);for(const B of w)u.push(B+t)}return u};class d{constructor(k,l,r,u=!1){this._cache={};this.vertices=k;this.indices=l;this.primitiveType=r;this.isMapSpace=
u}static fromRect({x:k,y:l,width:r,height:u}){return d.fromScreenExtent({xmin:k,ymin:l,xmax:k+r,ymax:l+u})}static fromPath(k){var l=f.convertFromNestedArray(new e,k.path,!1,!1);k=l.coords;l=new Uint32Array(m(l,!0));const r=new Uint32Array(k.length/2);for(let u=0;u<r.length;u++)r[u]=a.i1616to32(Math.floor(k[2*u]),Math.floor(k[2*u+1]));return new d({geometry:r},l,c.PrimitiveType.TRIANGLES)}static fromGeometry(k,l){const r=l.geometry?.type;switch(r){case "polygon":return d.fromPolygon(k,l.geometry);
case "extent":return d.fromMapExtent(k,l.geometry);default:return g.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new h("mapview-bad-type",`Unable to create a mesh from type ${r}`,l)),d.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(k,l){var r=f.convertFromPolygon(new e,l,!1,!1);l=r.coords;r=new Uint32Array(m(r,!1));const u=new Uint32Array(l.length/2),w=p.create(),x=p.create();for(let z=0;z<u.length;z++)n.set(w,l[2*z],l[2*z+1]),k.toScreen(x,w),u[z]=a.i1616to32(Math.floor(x[0]),Math.floor(x[1]));
return new d({geometry:u},r,c.PrimitiveType.TRIANGLES,!0)}static fromScreenExtent({xmin:k,xmax:l,ymin:r,ymax:u}){k={geometry:new Uint32Array([a.i1616to32(k,r),a.i1616to32(l,r),a.i1616to32(k,u),a.i1616to32(k,u),a.i1616to32(l,r),a.i1616to32(l,u)])};l=new Uint32Array([0,1,2,3,4,5]);return new d(k,l,c.PrimitiveType.TRIANGLES)}static fromMapExtent(k,l){const [r,u]=k.toScreen([0,0],[l.xmin,l.ymin]),[w,x]=k.toScreen([0,0],[l.xmax,l.ymax]);k={geometry:new Uint32Array([a.i1616to32(r,u),a.i1616to32(w,u),a.i1616to32(r,
x),a.i1616to32(r,x),a.i1616to32(w,u),a.i1616to32(w,x)])};l=new Uint32Array([0,1,2,3,4,5]);return new d(k,l,c.PrimitiveType.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose();for(const k in this._cache.vertexBuffers)null!=this._cache.vertexBuffers[k]&&this._cache.vertexBuffers[k].dispose()}get elementType(){a:switch(this.indices.BYTES_PER_ELEMENT){case 1:var k=c.DataType.UNSIGNED_BYTE;break a;case 2:k=c.DataType.UNSIGNED_SHORT;break a;case 4:k=c.DataType.UNSIGNED_INT;
break a;default:throw new h("Cannot get DataType of array");}return k}getIndexBuffer(k,l=c.Usage.STATIC_DRAW){this._cache.indexBuffer||(this._cache.indexBuffer=b.BufferObject.createIndex(k,l,this.indices));return this._cache.indexBuffer}getVertexBuffers(k,l=c.Usage.STATIC_DRAW){this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((r,u)=>({...r,[u]:b.BufferObject.createVertex(k,l,this.vertices[u])}),{}));return this._cache.vertexBuffers}}return d})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("exports ../../../../core/screenUtils ../../../../core/unitUtils ../../../../renderers/support/lengthUtils ./Utils ./techniques/Technique ./techniques/utils ../../../webgl/capabilities".split(" "),
function(h,g,v,n,p,f,e,a){function b(m,d){const k=d.length;if(m<d[0].value||1===k)return d[0].size;for(let l=1;l<k;l++)if(m<d[l].value)return d[l-1].size+(m-d[l-1].value)/(d[l].value-d[l-1].value)*(d[l].size-d[l-1].size);return d[k-1].size}class c{constructor(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.outsideLabelsVisible=
!1;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._technique=f.Technique}getSizeVVFieldStops(m){var d=this._vvSizeFieldStops;if(d)switch(d.type){case "static":return d;case "level-dependent":var k;if(null!=(k=d.levels[m]))d=k;else{{let l=Infinity;k=0;for(const r in d.levels){const u=parseFloat(r),w=Math.abs(m-u);w<l&&(l=w,k=u)}Infinity===l?d={sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,
0,0,0,0,0])}:(m=2**((m-k)/2),d=d.levels[k],k=new Float32Array(d.values),k[2]*=m,k[3]*=m,d={sizes:d.sizes,values:k})}}return d}}get vvMaterialParameters(){return this._vvMaterialParameters}update(m){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,m)}setInfo(m,d,k){this._updateEffects(k);this._vvInfo=d;this._technique=e.getTechniqueFromRenderer(m);this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,m)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),
outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:a.getWebGLCapabilities("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(m){this.outsideLabelsVisible=null!=m?m.excludedLabelsVisible:!1}_updateVisualVariables(m,d){const k=this._vvMaterialParameters;k.vvOpacityEnabled=!1;k.vvSizeEnabled=!1;k.vvColorEnabled=!1;k.vvRotationEnabled=!1;if(m){var l=m.size;if(l){k.vvSizeEnabled=
!0;if(l.minMaxValue){const u=l.minMaxValue;let w;if(p.isDefined(u.minSize)&&p.isDefined(u.maxSize))if(p.isNumber(u.minSize)&&p.isNumber(u.maxSize)){w=g.pt2px(u.minSize);var r=g.pt2px(u.maxSize)}else r=d.scale,w=g.pt2px(b(r,u.minSize.stops)),r=g.pt2px(b(r,u.maxSize.stops));this.vvSizeMinMaxValue.set([u.minDataValue,u.maxDataValue,w,r])}l.scaleStops&&(this.vvSizeScaleStopsValue=g.pt2px(b(d.scale,l.scaleStops.stops)));l.unitValue&&(this.vvSizeUnitValueToPixelsRatio=v.getMetersPerUnitForSR(d.spatialReference)/
n.meterIn[l.unitValue.unit]/d.resolution);l.fieldStops&&(this._vvSizeFieldStops=l.fieldStops)}if(d=m.color)k.vvColorEnabled=!0,this.vvColorValues.set(d.values),this.vvColors.set(d.colors);if(d=m.opacity)k.vvOpacityEnabled=!0,this.vvOpacityValues.set(d.values),this.vvOpacities.set(d.opacities);if(m=m.rotation)k.vvRotationEnabled=!0,k.vvRotationType=m.type}}}h.WGLRendererInfo=c;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define("../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m){const d=Math.PI/180;class k extends e.DisplayObject{constructor(r){super();this._indexBuffer=this._vertexBuffer=this._vao=this._program=null;this._dvsMat3=v.create();this._localOrigin={x:0,y:0};this._getBounds=r}destroy(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=h.disposeMaybe(this._program)}doRender(r){const {context:u}=r,w=this._getBounds();1>w.length||(this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(r),
this._updateBufferData(u,w),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0),r=this._program,u.bindVAO(this._vao),u.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(c.PrimitiveType.LINES,8*w.length,c.DataType.UNSIGNED_INT,0),u.bindVAO())}_createTransforms(){return{dvs:v.create()}}_createShaderProgram(r){this._program||
(this._program=r.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",l().attributes))}_updateMatricesAndLocalOrigin(r){var {state:u}=r;const {displayMat3:w,size:x,resolution:z,
pixelRatio:q,rotation:t,viewpoint:B}=u;r=d*t;const {x:y,y:E}=B.targetGeometry;u=f.normalizeMapX(y,u.spatialReference);this._localOrigin.x=u;this._localOrigin.y=E;u=q*x[0];const F=q*x[1],C=z*u,A=z*F,D=g.identity(this._dvsMat3);g.multiply(D,D,w);g.translate(D,D,n.fromValues(u/2,F/2));g.scale(D,D,p.fromValues(x[0]/C,-F/A,1));g.rotate(D,D,-r)}_updateBufferData(r,u){const {x:w,y:x}=this._localOrigin,z=new Float32Array(8*u.length),q=new Uint32Array(8*u.length);let t=0,B=0;for(const y of u)y&&(z[2*t]=y[0]-
w,z[2*t+1]=y[1]-x,z[2*t+2]=y[0]-w,z[2*t+3]=y[3]-x,z[2*t+4]=y[2]-w,z[2*t+5]=y[3]-x,z[2*t+6]=y[2]-w,z[2*t+7]=y[1]-x,q[B]=t+0,q[B+1]=t+3,q[B+2]=t+3,q[B+3]=t+2,q[B+4]=t+2,q[B+5]=t+1,q[B+6]=t+1,q[B+7]=t+0,t+=4,B+=8);this._vertexBuffer?this._vertexBuffer.setData(z.buffer):this._vertexBuffer=b.BufferObject.createVertex(r,c.Usage.DYNAMIC_DRAW,z.buffer);this._indexBuffer?this._indexBuffer.setData(q):this._indexBuffer=b.BufferObject.createIndex(r,c.Usage.DYNAMIC_DRAW,q);this._vao||(u=l(),this._vao=new m.VertexArrayObject(r,
u.attributes,u.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer))}}const l=()=>a.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:c.DataType.FLOAT}]});return k})},"esri/chunks/vec3f32":function(){define(["exports"],function(h){function g(){return new Float32Array(3)}function v(w){const x=new Float32Array(3);x[0]=w[0];x[1]=w[1];x[2]=w[2];return x}function n(w,x,z){const q=new Float32Array(3);q[0]=w;q[1]=x;q[2]=z;return q}function p(w,x){return new Float32Array(w,
x,3)}function f(){return g()}function e(){return n(1,1,1)}function a(){return n(1,0,0)}function b(){return n(0,1,0)}function c(){return n(0,0,1)}const m=g(),d=e(),k=a(),l=b(),r=c(),u=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:k,UNIT_Y:l,UNIT_Z:r,ZEROS:m,clone:v,create:g,createView:p,fromValues:n,ones:e,unitX:a,unitY:b,unitZ:c,zeros:f},Symbol.toStringTag,{value:"Module"}));h.ONES=d;h.UNIT_X=k;h.UNIT_Y=l;h.UNIT_Z=r;h.ZEROS=m;h.clone=v;h.create=g;h.createView=p;h.fromValues=n;
h.ones=e;h.unitX=a;h.unitY=b;h.unitZ=c;h.vec3f32=u;h.zeros=f})},"esri/views/2d/navigation/MapViewNavigation":function(){define("../../../chunks/tslib.es6 ../../../Viewpoint ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r){const u=new g({targetGeometry:new c}),w=[0,0];g=class extends v{constructor(x){super(x);this.animationManager=this._lastEventTimestamp=this._endTimer=null;this.interacting=!1}initialize(){this.pan=new k({navigation:this});this.rotate=new r({navigation:this});this.pinch=new l({navigation:this});this.zoomBox=new d({view:this.view,navigation:this})}destroy(){this.pan=n.destroyMaybe(this.pan);this.rotate=n.destroyMaybe(this.rotate);this.pinch=n.destroyMaybe(this.pinch);
this.zoomBox=n.destroyMaybe(this.zoomBox);this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now();this._startTimer(250)}async zoom(x,z=this._getDefaultAnchor()){this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>x?this.zoomIn(z):this.zoomOut(z);this.setViewpoint(z,x,0,[0,0])}async zoomIn(x){var z=this.view;z=z.constraints.snapToNextScale(z.scale);return this._zoomToScale(z,x)}async zoomOut(x){var z=
this.view;z=z.constraints.snapToPreviousScale(z.scale);return this._zoomToScale(z,x)}setViewpoint(x,z,q,t){this.begin();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,x,z,q,t);this.end()}setViewpointImmediate(x,z=0,q=[0,0],t=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,x,z,q)}continousRotateClockwise(){const x=this.view.viewpoint;this.animationManager?.animateContinous(x,z=>
{m.rotateBy(z,z,-1)})}continousRotateCounterclockwise(){const x=this.view.viewpoint;this.animationManager?.animateContinous(x,z=>{m.rotateBy(z,z,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x,y:z}){this._continuousPan([10*x,10*z])}stop(){this.pan.stopMomentumNavigation();
this.animationManager?.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(x){const z=this.view.viewpoint;this.animationManager?.animateContinous(z,q=>{m.translateBy(q,q,x);this.view.constraints.constrainByGeometry(q)})}_startTimer(x){return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(()=>{this._endTimer=null;const z=performance.now()-(this._lastEventTimestamp??0);250>z?this._endTimer=this._startTimer(z):
this._set("interacting",!1)},x)}_getDefaultAnchor(){const {size:x,padding:{left:z,right:q,top:t,bottom:B}}=this.view;w[0]=.5*(x[0]-q+z);w[1]=.5*(x[1]-B+t);return w}async _zoomToScale(x,z=this._getDefaultAnchor()){const {view:q}=this,{constraints:t,scale:B,viewpoint:y,size:E,padding:F}=q,C=t.canZoomInTo(x),A=t.canZoomOutTo(x);if(!(x<B&&!C||x>B&&!A))return m.padAndScaleAndRotateBy(u,y,x/B,0,z,E,F),t.constrainByGeometry(u),q.goTo(u,{animate:!0,pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(x,
z,q,t,B){var {view:y}=this;const {size:E,padding:F,constraints:C,scale:A,viewpoint:D}=y;var G=A*q;y=C.canZoomInTo(G);G=C.canZoomOutTo(G);if(1>q&&!y||1<q&&!G)q=1;m.translateBy(D,D,B);m.padAndScaleAndRotateBy(x,D,q,t,z,E,F);return C.constrainByGeometry(x)}};h.__decorate([p.property()],g.prototype,"animationManager",void 0);h.__decorate([p.property({type:Boolean,readOnly:!0})],g.prototype,"interacting",void 0);h.__decorate([p.property()],g.prototype,"pan",void 0);h.__decorate([p.property()],g.prototype,
"pinch",void 0);h.__decorate([p.property()],g.prototype,"rotate",void 0);h.__decorate([p.property()],g.prototype,"view",void 0);h.__decorate([p.property()],g.prototype,"zoomBox",void 0);return g=h.__decorate([b.subclass("esri.views.2d.navigation.MapViewNavigation")],g)})},"esri/views/2d/navigation/ZoomBox":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../input/InputManager".split(" "),
function(h,g,v,n,p,f,e,a,b){g=class extends g{constructor(c){super(c);this._boxShape=this._backgroundShape=this._overlay=this._container=null;this._box={x:0,y:0,width:0,height:0};this._rafId=null;this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(c){this.removeAllHandles();this._destroyOverlay();this._set("view",c);c&&this.addHandles([c.on("drag",["Shift"],m=>this._handleDrag(m,1),b.ViewEventPriorities.INTERNAL),c.on("drag",["Shift","Ctrl"],m=>this._handleDrag(m,-1),b.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer();
this._createOverlay();this.navigation.begin()}_update(c,m,d,k){this._box.x=c;this._box.y=m;this._box.width=d;this._box.height=k;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(c,m,d,k,l){const r=this.view;c=r.toMap(v.createScreenPoint(c+.5*d,m+.5*k));d=Math.max(d/r.width,k/r.height);-1===l&&(d=1/d);this._destroyOverlay();this.navigation.end();r.goTo({center:c,scale:r.scale*d})}_updateBox(c,m,d,k){const l=this._boxShape;l.setAttributeNS(null,"x",""+c);l.setAttributeNS(null,"y",
""+m);l.setAttributeNS(null,"width",""+d);l.setAttributeNS(null,"height",""+k);l.setAttributeNS(null,"class","esri-zoom-box__outline")}_updateBackground(c,m,d,k){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(c,m,d,k,this.view.width,this.view.height))}_createContainer(){const c=document.createElement("div");c.className="esri-zoom-box__container";this.view.root.appendChild(c);this._container=c}_createOverlay(){var c=this.view.width,m=this.view.height;const d=document.createElementNS("http://www.w3.org/2000/svg",
"path");d.setAttributeNS(null,"d","M 0 0 L "+c+" 0 L "+c+" "+m+" L 0 "+m+" Z");d.setAttributeNS(null,"class","esri-zoom-box__overlay-background");c=document.createElementNS("http://www.w3.org/2000/svg","rect");m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");m.setAttributeNS(null,"class","esri-zoom-box__overlay");m.appendChild(d);m.appendChild(c);this._container.appendChild(m);this._backgroundShape=
d;this._boxShape=c;this._overlay=m}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(c,m,d,k,l,r){d=c+d;k=m+k;return"M 0 0 L "+l+" 0 L "+l+" "+r+" L 0 "+r+" ZM "+c+" "+m+" L "+c+" "+k+" L "+d+" "+k+" L "+d+" "+m+" Z"}_handleDrag(c,m){var d=c.x,k=c.y,l=c.origin.x;const r=c.origin.y;let u;d>l?(u=l,l=d-l):(u=d,l-=d);k>r?(d=r,k-=r):(d=k,k=r-k);switch(c.action){case "start":this._start();
break;case "update":this._update(u,d,l,k);break;case "end":this._end(u,d,l,k,m)}c.stopPropagation()}_redraw(){if(this._rafId&&(this._rafId=null,this._overlay)){var {x:c,y:m,width:d,height:k}=this._box;this._updateBox(c,m,d,k);this._updateBackground(c,m,d,k);this._rafId=requestAnimationFrame(this._redraw)}}};h.__decorate([n.property()],g.prototype,"navigation",void 0);h.__decorate([n.property()],g.prototype,"view",null);return g=h.__decorate([a.subclass("esri.views.2d.navigation.ZoomBox")],g)})},"esri/views/2d/navigation/actions/Pan":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator ../../../../geometry/Point".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u){g=class extends n{constructor(w){super(w);this.animationTime=0;this.momentumEstimator=new r.PanPlanarMomentumEstimator(500,6,.92);this.momentum=null;this.tmpMomentum=k.create();this.momentumFinished=!1;this.viewpoint=new v({targetGeometry:new u,scale:0,rotation:0});this._previousDrag=null;p.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(w,x){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(x);this._previousDrag=
x}update(w,x){this.addToEstimator(x);let z=x.center.x,q=x.center.y;const t=this._previousDrag;z=t?t.center.x-z:-z;q=t?q-t.center.y:q;w.viewpoint=l.translateBy(this.viewpoint,w.viewpoint,[z||0,q||0]);this._previousDrag=x}end(w,x){this.addToEstimator(x);this.momentum=w.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(w);this._previousDrag=null;this.navigation.end()}addToEstimator(w){var x=w.center.x;const z=w.center.y,
q=f.createScreenPointArray(-x,z);x=k.fromValues(-x,z,0);this.momentumEstimator.add(q,x,.001*w.timestamp)}onAnimationUpdate(w){this.navigation.animationManager?.animateContinous(w.viewpoint,(x,z)=>{const {momentum:q,animationTime:t,tmpMomentum:B}=this;var y=this.momentumFinished=!q||q.isFinished(t);z*=.001;y||(y=q.valueDelta(t,z),d.scale(B,q.direction,y),l.translateBy(x,x,B),w.constraints.constrainByGeometry(x));this.animationTime+=z})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),
this.momentum=null,this.navigation.stop())}};h.__decorate([e.property()],g.prototype,"momentumFinished",void 0);h.__decorate([e.property()],g.prototype,"viewpoint",void 0);h.__decorate([e.property()],g.prototype,"navigation",void 0);return g=h.__decorate([m.subclass("esri.views.2d.navigation.actions.Pan")],g)})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec3","../../chunks/vec3f64","./FilteredFiniteDifference","./Momentum"],function(h,g,v,n,p){class f extends p.Momentum{constructor(a,
b,c,m,d){super(a,b,c);this._sceneVelocity=m;this.direction=d}value(a){return super.valueFromInitialVelocity(this._sceneVelocity,a)}}class e{constructor(a=300,b=12,c=.84){this._minimumInitialVelocity=a;this._stopVelocity=b;this._friction=c;this.enabled=!0;this._time=new n.FilteredFiniteDifference(.6);this._screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];this._scene=[new n.FilteredFiniteDifference(.6),new n.FilteredFiniteDifference(.6),new n.FilteredFiniteDifference(.6)];
this._tmpDirection=v.create()}add(a,b,c){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(c)||(this._screen[0].update(a[0]),this._screen[1].update(a[1]),this._scene[0].update(b[0]),this._scene[1].update(b[1]),this._scene[2].update(b[2]),this._time.update(c))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;
var a=this._screen[0].filteredDelta,b=this._screen[1].filteredDelta;a=null==a||null==b?0:Math.sqrt(a*a+b*b);b=this._time.filteredDelta;a=null==b||null==a?0:a/b;return Math.abs(a)<this._minimumInitialVelocity?null:this.createMomentum(a,this._stopVelocity,this._friction)}createMomentum(a,b,c){g.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const m=g.length(this._tmpDirection);0<m&&g.scale(this._tmpDirection,this._tmpDirection,
1/m);const d=this._time.filteredDelta;return new f(a,b,c,null==d?0:m/d,this._tmpDirection)}}h.PanPlanarMomentum=f;h.PanPlanarMomentumEstimator=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(h){class g{constructor(v){this._gain=v;this.filteredDelta=this.lastValue=void 0}update(v){if(this.hasLastValue()){const n=this.computeDelta(v);this._updateDelta(n)}this.lastValue=v}reset(){this.filteredDelta=
this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(v){return void 0===this.lastValue?NaN:v-this.lastValue}_updateDelta(v){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*v:v}}h.FilteredFiniteDifference=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(h){class g{constructor(v,n,p){this._initialVelocity=
v;this._stopVelocity=n;this._friction=p;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(v){return v>this.duration}get friction(){return this._friction}value(v){return this.valueFromInitialVelocity(this._initialVelocity,v)}valueDelta(v,n){const p=this.value(v);return this.value(v+n)-p}valueFromInitialVelocity(v,n){n=Math.min(n,this.duration);const p=1-this.friction;return v*(p**n-1)/Math.log(p)}}
h.Momentum=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator ../../../../geometry/Point".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u){g=class extends n{constructor(w){super(w);this._animationTime=0;this._momentumFinished=!1;this._previousRadius=this._previousAngle=0;this._previousCenter=null;this._rotationMomentumEstimator=new l.RotationMomentumEstimator(.6,.15,.95);this._rotationDirection=1;this._startRadius=this._startAngle=0;this._updateTimestamp=null;this._zoomDirection=1;this._zoomMomentumEstimator=new r.ZoomMomentumEstimator;this.rotateMomentum=this.zoomMomentum=this._zoomOnly=null;
this.viewpoint=new v({targetGeometry:new u,scale:0,rotation:0});this.addHandles(p.when(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(w,x){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=x.angle;this._previousRadius=this._startRadius=x.radius;this._previousCenter=x.center;this._updateTimestamp=null;w.constraints.rotationEnabled&&this.addToRotateEstimator(0,x.timestamp);this.addToZoomEstimator(x,
1)}update(w,x){null===this._updateTimestamp&&(this._updateTimestamp=x.timestamp);const z=x.angle,q=x.radius,t=x.center,B=Math.abs(180*(z-this._startAngle)/Math.PI),y=Math.abs(q-this._startRadius),E=this._startRadius/q;if(this._previousRadius&&this._previousCenter){const F=q/this._previousRadius;let C=180*(z-this._previousAngle)/Math.PI;this._rotationDirection=0<=C?1:-1;this._zoomDirection=1<=F?1:-1;w.constraints.rotationEnabled?(null===this._zoomOnly&&200<x.timestamp-this._updateTimestamp&&(this._zoomOnly=
0<y-B),null===this._zoomOnly||this._zoomOnly?C=0:this.addToRotateEstimator(z-this._startAngle,x.timestamp)):C=0;this.addToZoomEstimator(x,E);this.navigation.setViewpoint([t.x,t.y],1/F,C,[this._previousCenter.x-t.x,t.y-this._previousCenter.y])}this._previousAngle=z;this._previousRadius=q;this._previousCenter=t}end(w){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(w);
this.navigation.end()}addToRotateEstimator(w,x){this._rotationMomentumEstimator.add(w,.001*x)}addToZoomEstimator(w,x){this._zoomMomentumEstimator.add(x,.001*w.timestamp)}canZoomIn(w){const x=w.scale;w=w.constraints.effectiveMaxScale;return 0===w||x>w}canZoomOut(w){const x=w.scale;w=w.constraints.effectiveMinScale;return 0===w||x<w}onAnimationUpdate(w){this.navigation.animationManager?.animateContinous(w.viewpoint,(x,z)=>{var q=!this.canZoomIn(w)&&1<this._zoomDirection||!this.canZoomOut(w)&&1>this._zoomDirection,
t=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime);q=q||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime);z*=.001;this._momentumFinished=t&&q;if(!this._momentumFinished){t=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,z))*this._rotationDirection*180/Math.PI:0;q=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,z)):1;const y=d.create();var B=d.create();if(this._previousCenter){m.set(y,this._previousCenter.x,
this._previousCenter.y);k.getPaddingScreenTranslation(B,w.size,w.padding);m.add(y,y,B);const {constraints:E,scale:F}=w;B=F*q;1>q&&!E.canZoomInTo(B)?(q=F/E.effectiveMaxScale,this.rotateMomentum=this.zoomMomentum=null):1<q&&!E.canZoomOutTo(B)&&(q=F/E.effectiveMinScale,this.rotateMomentum=this.zoomMomentum=null);k.scaleAndRotateBy(x,w.viewpoint,q,t,y,w.size);w.constraints.constrainByGeometry(x)}}this._animationTime+=z})}stopMomentumNavigation(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&
(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()}};h.__decorate([f.property()],g.prototype,"_momentumFinished",void 0);h.__decorate([f.property()],g.prototype,"viewpoint",void 0);h.__decorate([f.property()],g.prototype,"navigation",void 0);return g=h.__decorate([c.subclass("esri.views.2d.navigation.actions.Pinch")],g)})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(h,g){class v extends g.MomentumEstimator{constructor(n=3,p=.01,f=.95,e=12){super(n,p,f,e)}add(n,p){const f=this.value.lastValue;if(null!=f){for(n-=f;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;n=f+n}super.add(n,p)}}h.RotationMomentumEstimator=v;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(h,g,
v,n){class p{constructor(f=2.5,e=.01,a=.95,b=12){this._minimumInitialVelocity=f;this._stopVelocity=e;this._friction=a;this._maxVelocity=b;this.enabled=!0;this.value=new v.FilteredFiniteDifference(.8);this.time=new v.FilteredFiniteDifference(.3)}add(f,e){if(this.enabled&&null!=e){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta()){const a=this.value.computeDelta(f);0>this.value.filteredDelta*a&&this.value.reset()}}this.time.update(e);this.value.update(f)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let f=this.value.filteredDelta/this.time.filteredDelta;f=g.clamp(f,-this._maxVelocity,this._maxVelocity);return Math.abs(f)<this._minimumInitialVelocity?null:this.createMomentum(f,this._stopVelocity,this._friction)}createMomentum(f,e,a){return new n.Momentum(f,e,a)}}h.MomentumEstimator=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(h,g,v){class n extends g.Momentum{constructor(f,e,a){super(f,e,a)}value(f){f=super.value(f);return Math.exp(f)}valueDelta(f,e){const a=super.value(f);f=super.value(f+e);return Math.exp(f-a)}}class p extends v.MomentumEstimator{constructor(f=2.5,e=.01,a=.95,b=12){super(f,e,a,b)}add(f,e){super.add(Math.log(f),e)}createMomentum(f,e,a){return new n(f,e,a)}}h.ZoomMomentum=n;h.ZoomMomentumEstimator=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/navigation/actions/Rotate":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../viewpointUtils ../../../../geometry/Point".split(" "),function(h,g,v,n,p,f,e,a,b,c,m,d,
k){const l=m.create(),r=m.create();g=class extends n{constructor(u){super(u);this._previousCenter=m.create();this.viewpoint=new v({targetGeometry:new k,scale:0,rotation:0})}begin(u,w){this.navigation.begin();c.set(this._previousCenter,w.center.x,w.center.y)}update(u,w){const {state:{size:x,padding:z}}=u;c.set(l,w.center.x,w.center.y);d.getAnchor(r,x,z);u.viewpoint=d.rotateBy(this.viewpoint,u.state.paddedViewState.viewpoint,d.angleBetween(r,this._previousCenter,l));c.copy(this._previousCenter,l)}end(){this.navigation.end()}};
h.__decorate([p.property()],g.prototype,"viewpoint",void 0);h.__decorate([p.property()],g.prototype,"navigation",void 0);return g=h.__decorate([b.subclass("esri.views.2d.actions.Rotate")],g)})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("../../../request ../../../core/asyncUtils ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/urlUtils ../../../chunks/mat3f32 ../engine/DisplayObject ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/enums ../engine/webgl/shaders/MagnifierPrograms ../../magnifier/resources ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/VertexArrayObject".split(" "),
function(h,g,v,n,p,f,e,a,b,c,m,d,k,l,r,u,w,x){class z extends b.DisplayObject{constructor(){super();this._handles=new v;this._resourcePixelRatio=1;this.visible=!1}destroy(){this._handles=p.destroyMaybe(this._handles);this._disposeRenderResources();this._resourcesTask=p.abortMaybe(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(q){this._backgroundColor=q;this.requestRender()}get magnifier(){return this._magnifier}set magnifier(q){this._magnifier=q;this._handles.removeAll();
this._handles.add([f.watch(()=>q.version,()=>{this.visible=q.visible&&null!=q.position&&0<q.size;this.requestRender()},f.initial),f.watch(()=>[q.maskUrl,q.overlayUrl],()=>this._reloadResources()),f.watch(()=>q.size,()=>{this._disposeRenderResources();this.requestRender()})])}_createTransforms(){return{dvs:a.create()}}doRender(q){const t=q.context;if(!this._resourcesTask)this._reloadResources();else if(q.drawPhase===m.WGLDrawPhase.MAP&&this._canRender()){this._updateResources(q);var B=this._magnifier;
if(null!=B.position){var y=q.pixelRatio,E=B.size*y,F=Math.ceil(1/B.factor*E);this._readbackTexture.resize(F,F);var {size:C}=q.state;q=y*C[0];C=y*C[1];var A=.5*F,D=.5*F,G=n.clamp(y*B.position.x,A,q-A-1),J=n.clamp(C-y*B.position.y,D,C-D-1);t.setBlendingEnabled(!0);A=G-A;D=J-D;var M=this._readbackTexture;t.bindTexture(M,0);t.gl.copyTexImage2D(M.descriptor.target,0,M.descriptor.pixelFormat,A,D,F,F,0);F=(F=this.backgroundColor)?[F.a*F.r/255,F.a*F.g/255,F.a*F.b/255,F.a]:[1,1,1,1];G=-1+(G+B.offset.x*y)/
q*2;y=-1+(J-B.offset.y*y)/C*2;q=E/q*2;E=E/C*2;C=this._program;t.bindVAO(this._vertexArrayObject);t.bindTexture(this._overlayTexture,6);t.bindTexture(this._maskTexture,7);t.useProgram(C);C.setUniform4fv("u_background",F);C.setUniform1i("u_readbackTexture",0);C.setUniform1i("u_overlayTexture",6);C.setUniform1i("u_maskTexture",7);C.setUniform4f("u_drawPos",G,y,q,E);C.setUniform1i("u_maskEnabled",B.maskEnabled?1:0);C.setUniform1i("u_overlayEnabled",B.overlayEnabled?1:0);t.setStencilTestEnabled(!1);t.setColorMask(!0,
!0,!0,!0);t.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4);t.bindVAO()}}}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const q=null!=this._magnifier?this._magnifier.maskUrl:null,t=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=g.createTask(async B=>{const y=null==q||null==t?k.loadMagnifierResources(B):null,E=null!=q?h(q,{responseType:"image",signal:B}).then(A=>A.data):y.then(A=>A.mask);
B=null!=t?h(t,{responseType:"image",signal:B}).then(A=>A.data):y.then(A=>A.overlay);const [F,C]=await Promise.all([E,B]);this.mask=F;this.overlay=C;this._disposeRenderResources();this.requestRender()})}_disposeRenderResources(){this._readbackTexture=p.disposeMaybe(this._readbackTexture);this._overlayTexture=p.disposeMaybe(this._overlayTexture);this._maskTexture=p.disposeMaybe(this._maskTexture);this._vertexArrayObject=p.disposeMaybe(this._vertexArrayObject);this._program=p.disposeMaybe(this._program)}_updateResources(q){q.pixelRatio!==
this._resourcePixelRatio&&this._disposeRenderResources();if(!this._readbackTexture){var t=q.context;this._resourcePixelRatio=q.pixelRatio;var B=Math.ceil(this._magnifier.size*q.pixelRatio);this._program=d.createMagnifierProgram(t);var y=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new x.VertexArrayObject(t,d.magnifierProgramTemplate.attributes,c.Pos2us,{geometry:l.BufferObject.createVertex(t,r.Usage.STATIC_DRAW,y)});this.overlay.width=B;this.overlay.height=B;y=new w.TextureDescriptor;
y.internalFormat=r.PixelFormat.RGBA;y.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;y.samplingMode=r.TextureSamplingMode.NEAREST;y.flipped=!0;y.preMultiplyAlpha=!e.isSVG(this.overlay.src)||!q.context.driverTest.svgPremultipliesAlpha.result;this._overlayTexture=new u.Texture(t,y,this.overlay);this.mask.width=B;this.mask.height=B;y.pixelFormat=y.internalFormat=r.PixelFormat.ALPHA;this._maskTexture=new u.Texture(t,y,this.mask);q=1/this._magnifier.factor;y.pixelFormat=y.internalFormat=r.PixelFormat.RGBA;y.width=
y.height=Math.ceil(q*B);y.samplingMode=r.TextureSamplingMode.LINEAR;y.flipped=!1;this._readbackTexture=new u.Texture(t,y)}}}return z})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/ProgramTemplate"],function(h,g,v){const n={shaders:{vertexShader:g.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:g.resolveIncludes("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};h.createMagnifierProgram=function(p){return v.createProgram(p,
n)};h.magnifierProgramTemplate=n;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(h,g,v,n){const p=f=>Object.freeze(Object.defineProperty({__proto__:null,default:f},Symbol.toStringTag,{value:"Module"}));g.loadMagnifierResources=async function(f){var e=new Promise((b,c)=>h(["./mask-svg"],m=>b(p(m)),c)),a=new Promise((b,c)=>h(["./overlay-svg"],
m=>b(p(m)),c));e=n.requestImage((await e).default,{signal:f});a=n.requestImage((await a).default,{signal:f});a={mask:await e,overlay:await a};v.throwIfAborted(f);return a};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(h,g){h.requestImage=async function(v,n){({data:v}=await g(v,{responseType:"image",...n}));return v};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports",
"../../../chunks/mat4"],function(h,g){h.mat4=g.mat4;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","../../../chunks/mat4f32"],function(h,g){h.mat4f32=g.mat4f32;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports","../../../chunks/vec3f32"],function(h,g){h.vec3f32=g.vec3f32;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports",
"../../../chunks/vec4f32"],function(h,g){h.vec4f32=g.vec4f32;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define("exports ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/contextUtils ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),function(h,g,v,n,p,f,e,a,b,c,m){function d(r){return r&&"render"in r}function k(r){const u=
document.createElement("canvas");u.width=r.width;u.height=r.height;r.render(u.getContext("2d"));return u}class l extends f.DisplayObject{constructor(r=null,u=!1){super();this.blendFunction="standard";this._sourceHeight=this._sourceWidth=0;this._textureInvalidated=!1;this._texture=null;this.stencilRef=0;this.coordScale=[1,1];this._height=void 0;this.pixelRatio=1;this.rotation=this.resolution=0;this._source=null;this._width=void 0;this.y=this.x=0;this.immutable=u;this.source=r;this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&
(this._texture.dispose(),this._texture=null);null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(r){this._height=r}get source(){return this._source}set source(r){if(null!=r||null!=this._source)this._source=r,this.invalidateTexture(),this.requestRender()}get width(){return void 0!==this._width?
this._width:this._sourceWidth}set width(r){this._width=r}beforeRender(r){super.beforeRender(r);this.updateTexture(r)}async setSourceAsync(r,u){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const w=new AbortController,x=g.createResolver();g.onAbortOrThrow(u,()=>w.abort());g.onAbortOrThrow(w,z=>x.reject(z));this._uploadStatus={controller:w,resolver:x};this.source=r;return x.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?
(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(r,u){64<=r&&(this.inFadeTransition=this.fadeTransitionEnabled=!1);super.updateTransitionProperties(r,u)}setTransform(r){const u=v.identity(this.transforms.dvs),[w,x]=r.toScreenNoRotation([0,0],[this.x,this.y]);var z=this.resolution/this.pixelRatio/r.resolution;const q=z*this.width;z*=this.height;
const t=Math.PI*this.rotation/180;v.translate(u,u,p.fromValues(w,x));v.translate(u,u,p.fromValues(q/2,z/2));v.rotate(u,u,-t);v.translate(u,u,p.fromValues(-q/2,-z/2));v.scaleByVec2(u,u,p.fromValues(q,z));v.multiply(this.transforms.dvs,r.displayViewMat3,u)}setSamplingProfile(r){this._texture&&(r.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(r.samplingMode))}bind(r,u){this._texture&&r.bindTexture(this._texture,u)}async updateTexture({context:r,
painter:u}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(r)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);r=this.source;r=d(r)?r instanceof e?r.getRenderedRasterPixels()?.renderedRasterPixels:k(r):r;try{if(null!=this._uploadStatus){const {controller:w,resolver:x}=this._uploadStatus,z={signal:w.signal},{width:q,height:t}=this;await u.textureUploadManager.enqueueTextureUpdate({data:r,texture:this._texture,width:q,
height:t},z);x.resolve();this._uploadStatus=null}else this._texture.setData(r);this.ready()}catch(w){g.throwIfNotAbortError(w)}}else this._texture.setData(null)}onDetach(){this.destroy()}_createTransforms(){return{dvs:n.create()}}_createTexture(r){const u=this.immutable&&r.type===a.ContextType.WEBGL2,w=new m.TextureDescriptor;w.internalFormat=u?b.SizedPixelFormat.RGBA8:b.PixelFormat.RGBA;w.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;w.isImmutable=u;w.width=this._sourceWidth;w.height=this._sourceHeight;
return new c.Texture(r,w)}}h.Bitmap=l;h.isImageSource=d;h.rasterize=k;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(function(){class h{constructor(g,v,n){this.pixelBlock=g;this.extent=v;this.originalPixelBlock=n}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(g){var v=this.pixelBlock;if(null!=v){var n=this.filter({extent:this.extent,
pixelBlock:this.originalPixelBlock??v});null!=n.pixelBlock&&(n.pixelBlock.maskIsAlpha&&(n.pixelBlock.premultiplyAlpha=!0),v=n.pixelBlock.getAsRGBA(),n=g.createImageData(n.pixelBlock.width,n.pixelBlock.height),n.data.set(v),g.putImageData(n,0,0))}}getRenderedRasterPixels(){const g=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});if(null==g.pixelBlock)return null;g.pixelBlock.maskIsAlpha&&(g.pixelBlock.premultiplyAlpha=!0);return{width:g.pixelBlock.width,height:g.pixelBlock.height,renderedRasterPixels:new Uint8Array(g.pixelBlock.getAsRGBA().buffer)}}}
return h})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","./brushes","./webgl/enums","./webgl/WGLContainer"],function(h,g,v,n){class p extends n{constructor(){super(...arguments);this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(f){super.beforeRender(f);this._manageFade()}prepareRenderPasses(f){const e=f.registerRenderPass({name:"bitmap",brushes:[g.brushes.bitmap],target:()=>this.children,drawPhase:v.WGLDrawPhase.MAP});
return[...super.prepareRenderPasses(f),e]}_manageFade(){2<=this.children.reduce((f,e)=>f+(e.inFadeTransition?1:0),0)?(this.children.forEach(f=>f.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(f=>f.blendFunction="standard"),this._hasCrossfade=!1)}}h.BitmapContainer=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../chunks/mat3f32","./Bitmap","./webgl/TiledDisplayObject"],function(h,g,v,
n){class p extends n.TiledDisplayObject{constructor(f,e,a,b,c,m,d=null){super(f,e,a,b,c,m);this.bitmap=new v.Bitmap(d);this.bitmap.coordScale=[c,m];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy()}beforeRender(f){this.bitmap.beforeRender(f);super.beforeRender(f)}afterRender(f){this.bitmap.afterRender(f);super.afterRender(f)}set stencilRef(f){this.bitmap.stencilRef=f}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:g.create(),
tileMat3:g.create()}}setTransform(f){super.setTransform(f);this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}h.BitmapTile=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define("exports ../../../geometry/support/aaBoundingRect ./BitmapTile ./brushes ./webgl/enums ./webgl/TileContainer".split(" "),function(h,g,v,n,p,f){class e extends f{get requiresDedicatedFBO(){return this.children.some(a=>
"additive"===a.bitmap.blendFunction)}createTile(a){const b=this._tileInfoView.getTileBounds(g.create(),a),c=this._tileInfoView.getTileResolution(a.level),[m,d]=this._tileInfoView.tileInfo.size;return new v.BitmapTile(a,c,b[0],b[3],m,d)}prepareRenderPasses(a){const b=a.registerRenderPass({name:"bitmap (tile)",brushes:[n.brushes.bitmap],target:()=>this.children.map(c=>c.bitmap),drawPhase:p.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(a),b]}doRender(a){this.visible&&a.drawPhase===p.WGLDrawPhase.MAP&&
super.doRender(a)}}h.BitmapTileContainer=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("exports ./engine/Stage ./LabelManager ./layers/graphics/GraphicsView2D ./layers/graphics/GraphicContainer ./navigation/MapViewNavigation ./magnifier/MagnifierView2D".split(" "),function(h,g,v,n,p,f,e){h.Stage=g.Stage;Object.defineProperty(h,"LabelManager",{enumerable:!0,get:()=>v.LabelManager});h.GraphicsView2D=n;h.GraphicContainer=p;h.MapViewNavigation=f;h.MagnifierView2D=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});