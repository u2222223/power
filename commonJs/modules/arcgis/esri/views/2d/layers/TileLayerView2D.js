// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(d,g,k,c,a,b,f,l,q){d.BitmapTileLayerView2D=h=>{h=class extends h{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=
new q.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren();this._bitmapView=null}};return h=g.__decorate([l.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],h)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(d,g,k,c,a,b,f,l,q,h,e,p,v,w,z,K,Q){const I=k.ofType({key:"type",base:null,typeMap:{rect:z,path:Q,geometry:K}});d.LayerView2DMixin=J=>{J=class extends J{constructor(){super(...arguments);this.attached=!1;this.clips=new I;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const A=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&A&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new a("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new v.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([b.watch(()=>this.suspended,x=>{this.container&&(this.container.visible=!x);this.view&&!x&&this.updateRequested&&this.view.requestUpdate()},b.syncAndInitial),b.watch(()=>this.layer?.opacity??1,x=>{this.container&&(this.container.opacity=
x)},b.syncAndInitial),b.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",x=>{this.container&&(this.container.blendMode=x)},b.syncAndInitial),b.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,x=>{this.container&&(this.container.effect=x)},b.syncAndInitial),b.watch(()=>this.highlightOptions,x=>this.container.highlightOptions=x,b.syncAndInitial),b.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},b.syncAndInitial),b.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:x})=>{x=null!=x?this.isVisibleAtScale(x):!1;x!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",x)},b.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(x=>{x===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const A=
this.view?.spatialReference;return null==A||this.supportsSpatialReference(A)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(A){const x=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!x)return!0;const {minScale:O,maxScale:P}=x;return p.isInScaleRange(A,O,P)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(A){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",A),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(A)))}hitTest(A,
x){return Promise.resolve(null)}supportsSpatialReference(A){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const A=super.getSuspendInfo(),x=!this.spatialReferenceSupported,O=this.visibleAtCurrentScale;x&&(A.spatialReferenceNotSupported=x);O&&(A.outsideScaleRange=O);return A}addAttachHandles(A){this.addHandles(A,"attach")}};g.__decorate([f.property()],J.prototype,"attached",void 0);g.__decorate([f.property({type:I,set(A){A=
c.referenceSetter(A,this._get("clips"),I);this._set("clips",A)}})],J.prototype,"clips",void 0);g.__decorate([f.property()],J.prototype,"container",void 0);g.__decorate([f.property()],J.prototype,"moving",void 0);g.__decorate([f.property({readOnly:!0})],J.prototype,"spatialReferenceSupported",null);g.__decorate([f.property({readOnly:!0})],J.prototype,"updateParameters",void 0);g.__decorate([f.property()],J.prototype,"updateRequested",void 0);g.__decorate([f.property()],J.prototype,"updating",null);
g.__decorate([f.property()],J.prototype,"view",void 0);g.__decorate([f.property({readOnly:!0})],J.prototype,"visibleAtCurrentScale",void 0);g.__decorate([f.property({type:w})],J.prototype,"highlightOptions",void 0);return J=g.__decorate([e.subclass("esri.views.2d.layers.LayerView2D")],J)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(d,g,k){function c(a,b){b=k.getMetersPerUnitForSR(b);
return a/(b*k.inchesPerMeter*96)}d.getExtentForScale=function(a,b){const f=a.extent;a=a.width-(a.padding?a.padding.left+a.padding.right:0);b=c(b,f.spatialReference);return f.clone().expand(b*a/f.width)};d.getResolutionForScale=c;d.getResolutionInMetersForScale=function(a){return a/(96*k.inchesPerMeter)};d.getScale=function(a,b){b=b||a.extent;a=a.width;const f=k.getMetersPerUnitForSR(b?.spatialReference);return b&&a?b.width/a*f*k.inchesPerMeter*96:0};d.getScaleForResolution=function(a,b){b=k.getMetersPerUnitForSR(b);
return a*b*k.inchesPerMeter*96};d.isInScaleRange=function(a,b,f){if(b=0===b||g.floatEqualAbsolute(a,b)||a<b)b=0===f||g.floatEqualAbsolute(a,f)||a>f;return b};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,g,k,c,a,b,f){var l;k=l=class extends f{constructor(q){super(q);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};d.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"left",void 0);d.__decorate([g.property({type:[Number,String],
json:{write:!0}})],k.prototype,"right",void 0);d.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"top",void 0);d.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"bottom",void 0);return k=l=d.__decorate([b.subclass("esri.views.layers.support.ClipRect")],k)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,g,k,c,a,b,f){g=class extends g.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};d.__decorate([k.property({readOnly:!0})],g.prototype,"version",null);return g=d.__decorate([f.subclass("esri.views.layers.support.ClipArea")],g)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(d,g,k,c,a,b,f,l,q,h,e,p){var v;g={base:l,key:"type",typeMap:{extent:e,polygon:p}};h=v=class extends h{constructor(w){super(w);this.type="geometry";this.geometry=null}clone(){return new v({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};d.__decorate([k.property({types:g,json:{read:q.fromJSON,write:!0}})],h.prototype,"geometry",void 0);return h=v=d.__decorate([f.subclass("esri.views.layers.support.Geometry")],h)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,g,k,c,a,b,f){k=class extends f{constructor(l){super(l);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};d.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],k.prototype,"path",void 0);return k=d.__decorate([b.subclass("esri.views.layers.support.Path")],k)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(d,g,k,c,a,b,f,l,q,h){g=class extends q{get hasHighlight(){return this.children.some(e=>e.hasData)}renderChildren(e){if(e.drawPhase===l.WGLDrawPhase.HIGHLIGHT&&(this.attributeView.update(),this.children.some(v=>v.hasData))){this.attributeView.bindTextures(e.context);super.renderChildren(e);var {painter:p}=e;p=p.effects.highlight;p.bind(e);e.context.setColorMask(!0,!0,!0,!0);e.context.clear(h.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(e,p.defines.concat(["highlightAll"]));p.draw(e);
p.unbind()}}};return g=d.__decorate([f.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],g)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],function(d){function g(k){const c=document.createElement("canvas");[c.width,c.height]=k;return c}d.createBlankImage=g;d.resampleImage=function(k,c,a,b){if(a.level===b.level)return c;const f=k.tileInfo.size;var l=k.getTileResolution(a.level),q=k.getTileResolution(b.level),h=k.getLODInfoAt(b.level),e=h.getXForColumn(b.col);
b=h.getYForRow(b.row);h=k.getLODInfoAt(a.level);k=h.getXForColumn(a.col);const p=h.getYForRow(a.row);h=(c instanceof HTMLImageElement?c.naturalWidth:c.width)/f[0];a=(c instanceof HTMLImageElement?c.naturalHeight:c.height)/f[1];e=Math.round((e-k)/l*h);b=Math.round(-(b-p)/l*a);k=Math.round(q/l*f[0]*h);l=Math.round(q/l*f[1]*a);q=g(f);q.getContext("2d").drawImage(c,e,b,k,l,0,0,f[0],f[1]);return q};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,g,k,c,a,b,f,l,q){return h=>{h=class extends h{initialize(){this.addHandles(c.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(p=>{k.isAbortError(p)||g.getLogger(this).error(p)})}),"RefreshableLayerView")}};d.__decorate([a.property()],h.prototype,"layer",void 0);return h=d.__decorate([q.subclass("esri.layers.mixins.RefreshableLayerView")],h)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/fieldUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ./popupUtils".split(" "),
function(d,g,k,c,a,b,f,l,q,h,e,p,v,w,z,K,Q,I,J,A,x,O,P,C,R,T,U){function V(m,r,t){const B=[];if(!m)return B;const y=D=>{var n=0===D.minScale||r<=D.minScale;const E=0===D.maxScale||r>=D.maxScale;D.visible&&n&&E&&(D.sublayers?D.sublayers.forEach(y):D.popupEnabled&&(n=U.getFetchPopupTemplate(D,{...t,defaultPopupTemplateEnabled:!1}),null!=n&&B.unshift({sublayer:D,popupTemplate:n})))};m.map(y);return B}function W(m){return m.expressionInfos?.length||Array.isArray(m.content)&&m.content.some(r=>"expression"===
r.type)?R.loadArcade():Promise.resolve()}async function Z(m,r){if(m.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(r.map(({sublayer:t})=>t.load().then(()=>t.capabilities.operations.supportsQuery)))}catch{return!1}}async function ca(m,r){const t=m.renderer;t&&"defaultSymbol"in t&&!t.defaultSymbol&&(r=t.valueExpression?await Promise.all(r.map(B=>t.getSymbolAsync(B).then(y=>y?B:null))).then(B=>B.filter(y=>null!=y)):r.filter(B=>null!=t.getSymbol(B)));return r}let X=null;
g.MapServiceLayerViewHelper=class extends a{constructor(m){super(m);this._featuresResolutions=new WeakMap;this.highlightGraphicUpdated=this.highlightGraphics=null;this.updateHighlightedFeatures=p.debounce(async r=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(r).catch(()=>{}))})}initialize(){const m=r=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(r).catch(()=>{}));this.updateHighlightedFeatures(this._highlightGeometriesResolution)};
this.addHandles([v.on(()=>this.highlightGraphics,"change",r=>m(r.added),{onListenerAdd:r=>m(r)})])}async fetchPopupFeatures(m,r){const {layerView:{layer:t,view:{scale:B}}}=this;if(!m)throw new l("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:t});const y=V(t.sublayers,B,r);if(!y.length)return[];const D=await Z(t,y);if(!((t.capabilities?.operations?.supportsIdentify??!0)&&10.5<=t.version||D))throw new l("fetchPopupFeatures:not-supported","query operation is disabled for this service",
{layer:t});return D?this._fetchPopupFeaturesUsingQueries(m,y,r):this._fetchPopupFeaturesUsingIdentify(m,y,r)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(m){const r=this.highlightGraphics;if(!r)return q.makeHandle();let t=null;m instanceof c?t=[m]:f.isCollection(m)&&0<m.length?t=m.toArray():Array.isArray(m)&&0<m.length&&(t=m);t=t?.filter(b.isSome);if(!t?.length)return q.makeHandle();for(const B of t)m=B.sourceLayer,null!=m&&"geometryType"in m&&"point"===m.geometryType&&(B.visible=
!1);r.addMany(t);return q.makeHandle(()=>r.removeMany(t??[]))}async _updateHighlightedFeaturesSymbols(m){const {layerView:{view:r},highlightGraphics:t,highlightGraphicUpdated:B}=this;if(t&&B)for(const y of m){const D=y.sourceLayer&&"renderer"in y.sourceLayer&&y.sourceLayer.renderer;y.sourceLayer&&"geometryType"in y.sourceLayer&&"point"===y.sourceLayer.geometryType&&D&&"getSymbolAsync"in D&&D.getSymbolAsync(y).then(async n=>{n||(n=new T);let E=null;const H="visualVariables"in D?D.visualVariables?.find(G=>
"size"===G.type):void 0;H&&(X||(X=(await new Promise((G,N)=>d(["../../../renderers/visualVariables/support/visualVariableUtils"],G,N))).getSize),E=X(H,y,{view:r.type,scale:r.scale,shape:"simple-marker"===n.type?n.style:null}));E||(E="width"in n&&"height"in n&&null!=n.width&&null!=n.height?Math.max(n.width,n.height):"size"in n?n.size:16);t.includes(y)&&(y.symbol=new T({style:"square",size:E,xoffset:"xoffset"in n?n.xoffset:0,yoffset:"yoffset"in n?n.yoffset:0}),B(y,"symbol"),y.visible=!0)})}}async _updateHighlightedFeaturesGeometries(m){const {layerView:{layer:r,
view:t},highlightGraphics:B,highlightGraphicUpdated:y}=this;this._highlightGeometriesResolution=m;if(y&&B?.length&&r.capabilities.operations.supportsQuery){var D=this._getTargetResolution(m);m=new Map;for(var n of B)(!this._featuresResolutions.has(n)||this._featuresResolutions.get(n)>D)&&e.getOrCreateMapValue(m,n.sourceLayer,()=>new Map).set(n.getObjectId(),n);n=Array.from(m,([E,H])=>{const G=E.createQuery();G.objectIds=[...H.keys()];G.outFields=[E.objectIdField];G.returnGeometry=!0;G.maxAllowableOffset=
D;G.outSpatialReference=t.spatialReference;return E.queryFeatures(G)});n=await Promise.all(n);if(!this.destroyed)for(const {features:E}of n)for(const H of E)(n=m.get(H.sourceLayer).get(H.getObjectId()))&&B.includes(n)&&(n.geometry=H.geometry,y(n,"geometry"),this._featuresResolutions.set(n,D))}}_getTargetResolution(m){const r=m*w.getMetersPerUnitForSR(this.layerView.view.spatialReference),t=r/16;return 10>=t?0:m/r*t}async _fetchPopupFeaturesUsingIdentify(m,r,t){m=await this._createIdentifyParameters(m,
r,t);if(null==m)return[];({results:m}=await P.identify(this.layerView.layer.parsedUrl,m));return m.map(B=>B.feature)}async _createIdentifyParameters(m,r,t){const {floors:B,layer:y,timeExtent:D,view:{spatialReference:n,scale:E}}=this.layerView,H=null!=t?t.event:null;if(!r.length)return null;await Promise.all(r.map(({sublayer:L})=>L.load().catch(()=>{})));r=Math.min(h("mapservice-popup-identify-max-tolerance"),y.allSublayers.reduce((L,aa)=>aa.renderer?O.calculateTolerance({renderer:aa.renderer,event:H}):
L,2));var G=this.createFetchPopupFeaturesQueryGeometry(m,r);const N=J.getResolutionForScale(E,n);t=Math.round(G.width/N);G=new I({xmin:G.center.x-N*t,ymin:G.center.y-N*t,xmax:G.center.x+N*t,ymax:G.center.y+N*t,spatialReference:G.spatialReference});return new C({floors:B,gdbVersion:"gdbVersion"in y?y.gdbVersion:void 0,geometry:m,height:t,layerOption:"popup",mapExtent:G,returnGeometry:!0,spatialReference:n,sublayers:y.sublayers,timeExtent:D,tolerance:r,width:t})}async _fetchPopupFeaturesUsingQueries(m,
r,t){const {layerView:{floors:B,timeExtent:y}}=this,D=null!=t?t.event:null;r=r.map(async({sublayer:n,popupTemplate:E})=>{await n.load().catch(()=>{});if(n.capabilities&&!n.capabilities.operations.supportsQuery)return[];var H=n.createQuery(),G=O.calculateTolerance({renderer:n.renderer,event:D}),N=this.createFetchPopupFeaturesQueryGeometry(m,G),L=new Set;const [aa]=await Promise.all([U.getRequiredFields(n,E),n.renderer?.collectRequiredFields(L,n.fieldsIndex)]);A.collectFields(L,n.fieldsIndex,aa);L=
Array.from(L).sort();H.geometry=N;H.outFields=L;H.timeExtent=y;B&&(L=B.clone(),L=x.getLayerFloorFilterClause(L,n),null!=L&&(H.where=H.where?`(${H.where}) AND (${L})`:L));G=this._getTargetResolution(N.width/G);N=await W(E);E="point"===n.geometryType||N&&N.arcadeUtils.hasGeometryOperations(E);E||(H.maxAllowableOffset=G);({features:H}=await n.queryFeatures(H));E=E?0:G;H=await ca(n,H);for(const fa of H)this._featuresResolutions.set(fa,E);return H});return(await Promise.allSettled(r)).reduce((n,E)=>"fulfilled"===
E.status?[...n,...E.value]:n,[]).filter(b.isSome)}};k.__decorate([z.property({constructOnly:!0})],g.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);k.__decorate([z.property({constructOnly:!0})],g.MapServiceLayerViewHelper.prototype,"layerView",void 0);k.__decorate([z.property({constructOnly:!0})],g.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);k.__decorate([z.property({constructOnly:!0})],g.MapServiceLayerViewHelper.prototype,"highlightGraphicUpdated",
void 0);k.__decorate([z.property({constructOnly:!0})],g.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);g.MapServiceLayerViewHelper=k.__decorate([Q.subclass("esri.views.layers.support.MapService")],g.MapServiceLayerViewHelper);g.collectPopupProviders=V;g.isMapServiceLayerView=function(m,r){return"tile"===r.type||"map-image"===r.type};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(d){function g(k,
c){if(!k?.length)return null;k=k.filter(a=>""!==a).map(a=>`'${a}'`);k.push("''");return`${c} IN (${k.join(",")}) OR ${c} IS NULL`}d.getFloorFilterClause=function(k){const c=k.layer;return"floorInfo"in c&&c.floorInfo?.floorField&&"floors"in k.view?g(k.view.floors,c.floorInfo.floorField):null};d.getLayerFloorFilterClause=function(k,c){return"floorInfo"in c&&c.floorInfo?.floorField?g(k,c.floorInfo.floorField):null};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],
function(d){function g(a,b){return b?"xoffset"in b&&b.xoffset?Math.max(a,Math.abs(b.xoffset)):"yoffset"in b&&b.yoffset?Math.max(a,Math.abs(b.yoffset||0)):a:a}function k(a,b){if("number"===typeof a)return a;if(a?.stops?.length){a=a.stops;let f=b=0;for(let l=0;l<a.length;l++){const q=a[l].size;"number"===typeof q&&(b+=q,f++)}return b/f}return b}function c(a,b){if(!b)return a;b=b.filter(q=>"size"===q.type).map(q=>{const {maxSize:h,minSize:e}=q;return(k(h,a)+k(e,a))/2});let f=0;const l=b.length;if(0===
l)return a;for(let q=0;q<l;q++)f+=b[q];return Math.max(Math.floor(f/l),a)}d.calculateTolerance=function(a){const b=a?.renderer;a="touch"===a?.event?.pointerType?9:6;if(!b)return a;a="visualVariables"in b?c(a,b.visualVariables):a;if("simple"===b.type)return g(a,b.symbol);if("unique-value"===b.type){let f=a;b.uniqueValueInfos?.forEach(l=>{f=g(f,l.symbol)});return f}if("class-breaks"===b.type){let f=a;b.classBreakInfos.forEach(l=>{f=g(f,l.symbol)});return f}return a};Object.defineProperty(d,Symbol.toStringTag,
{value:"Module"})})},"esri/rest/identify":function(){define("exports ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),function(d,g,k,c,a,b,f){function l(e){e=e.data;e.results=e.results||[];e.exceededTransferLimit=!!e.exceededTransferLimit;e.results=e.results.map(p=>f.fromJSON(p));return e}function q(e){return e=b.from(e)}function h(e,p){function v(z){w.set(z.id,z);z.sublayers&&z.sublayers.forEach(v)}if(!p?.length)return e;
const w=new Map;p.forEach(v);for(const z of e.results)z.feature.sourceLayer=w.get(z.layerId);return e}d.identify=async function(e,p,v){p=q(p);const w=p.geometry?[p.geometry]:[],z=c.parseUrl(e);z.path+="/identify";return k.normalizeCentralMeridian(w).then(K=>{K=a.identifyToIdentifyRESTParameters(p,{geometry:K?.[0]});K=c.encode({...z.query,f:"json",...K});K=c.asValidOptions(K,v);return g(z.path,K).then(l).then(Q=>h(Q,p.sublayers))})};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),
function(d,g,k,c,a,b,f){function l(h){const {mapExtent:e,floors:p,width:v,sublayers:w,layerIds:z,layerOption:K,gdbVersion:Q}=h;var I=w?.find(C=>null!=C.layer)?.layer?.serviceSublayers;const J="popup"===K;h={};const A=c.getScale({extent:e,width:v,spatialReference:e?.spatialReference}),x=[],O=C=>{const R=0===A,T=0===C.minScale||A<=C.minScale,U=0===C.maxScale||A>=C.maxScale;C.visible&&(R||T&&U)&&(C.sublayers?C.sublayers.forEach(O):!1!==z?.includes(C.id)&&(!J||C.popupTemplate&&C.popupEnabled)&&x.unshift(C))};
w?.forEach(O);if(w&&!x.length)h.layerIds=[];else{I=f.isExportDynamic(x,I,Q);var P=x.map(C=>{const R=b.getLayerFloorFilterClause(p,C);return C.toExportImageJSON(R)});if(I)h.dynamicLayers=JSON.stringify(P);else if(w?(I=x.map(({id:C})=>C),z&&(I=I.filter(C=>z.includes(C))),h.layerIds=I):z?.length&&(h.layerIds=z),I=q(p,x),null!=I&&I.length){P={};for(const C of I)C.definitionExpression&&(P[C.id]=C.definitionExpression);Object.keys(P).length&&(h.layerDefs=JSON.stringify(P))}}return h}function q(h,e){const p=
!!h?.length;e=e.filter(v=>null!=v.definitionExpression||p&&null!=v.floorInfo);return e.length?e.map(v=>{var w=b.getLayerFloorFilterClause(h,v);w=g.sqlAnd(w,v.definitionExpression);return{id:v.id,definitionExpression:w??void 0}}):null}d.identifyToIdentifyRESTParameters=function(h,e){const {dpi:p,gdbVersion:v,geometry:w,geometryPrecision:z,height:K,layerOption:Q,mapExtent:I,maxAllowableOffset:J,returnFieldName:A,returnGeometry:x,returnUnformattedValues:O,returnZ:P,spatialReference:C,timeExtent:R,tolerance:T,
width:U}=h.toJSON(),{dynamicLayers:V,layerDefs:W,layerIds:Z}=l(h);e=null!=e?.geometry?e.geometry:null;h={geometryPrecision:z,maxAllowableOffset:J,returnFieldName:A,returnGeometry:x,returnUnformattedValues:O,returnZ:P,tolerance:T};e=e&&e.toJSON()||w;h.imageDisplay=`${U},${K},${p}`;v&&(h.gdbVersion=v);e&&(delete e.spatialReference,h.geometry=JSON.stringify(e),h.geometryType=k.getJsonType(e));if(e=C??e?.spatialReference??I?.spatialReference)h.sr=a.srToRESTValue(e);h.time=R?[R.start,R.end].join():null;
if(I){const {xmin:ca,ymin:X,xmax:m,ymax:r}=I;h.mapExtent=`${ca},${X},${m},${r}`}W&&(h.layerDefs=W);V&&!W&&(h.dynamicLayers=V);h.layers="popup"===Q?"visible":Q;Z&&!V&&(h.layers+=`:${Z.join(",")}`);return h};d.toDynamicLayersJSON=l;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(d,g){function k(c,a){if(!c?.length||null==a)return!0;a=a.slice().reverse().flatten(({sublayers:l})=>
l&&l.toArray().reverse()).map(l=>l.id).toArray();if(c.length>a.length)return!1;let b=0;const f=a.length;for(const {id:l}of c){for(;b<f&&a[b]!==l;)b++;if(b>=f)return!1}return!0}d.isExportDynamic=function(c,a,b){return c.some(f=>{const l=f.source;return!(!l||"map-layer"===l.type&&l.mapLayerId===f.id&&(null==l.gdbVersion||l.gdbVersion===b))||f.originIdOf("renderer")>g.OriginId.SERVICE||f.originIdOf("labelingInfo")>g.OriginId.SERVICE||f.originIdOf("opacity")>g.OriginId.SERVICE||f.originIdOf("labelsVisible")>
g.OriginId.SERVICE})?!0:!k(c,a)};d.isSublayerOverhaul=function(c){return!!c&&c.some(a=>null!=a.minScale||null!=a.layerDefinition?.minScale)};d.shouldWriteSublayerStructure=function(c,a,b){return a.flatten(({sublayers:f})=>f).length!==c.length||c.some(f=>f.originIdOf("minScale")>b||f.originIdOf("maxScale")>b||f.originIdOf("renderer")>b||f.originIdOf("labelingInfo")>b||f.originIdOf("opacity")>b||f.originIdOf("labelsVisible")>b||f.originIdOf("source")>b)?!0:!k(c,a)};Object.defineProperty(d,Symbol.toStringTag,
{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(d,g,k,c,a,b,f,l,q,h,e,p){var v;c=v=class extends c.JSONSupport{static from(w){return b.ensureClass(v,
w)}constructor(w){super(w);this.dpi=96;this.geometryPrecision=this.geometry=this.gdbVersion=this.floors=null;this.height=400;this.layerIds=null;this.layerOption="top";this.maxAllowableOffset=this.mapExtent=null;this.returnFieldName=!0;this.returnM=this.returnGeometry=!1;this.returnUnformattedValues=!0;this.returnZ=!1;this.tolerance=this.timeExtent=this.sublayers=this.spatialReference=null;this.width=400}};d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"dpi",void 0);d.__decorate([a.property()],
c.prototype,"floors",void 0);d.__decorate([a.property({type:String,json:{write:!0}})],c.prototype,"gdbVersion",void 0);d.__decorate([a.property({types:g.geometryTypes,json:{read:h.fromJSON,write:!0}})],c.prototype,"geometry",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"geometryPrecision",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"height",void 0);d.__decorate([a.property({type:[Number],json:{write:!0}})],c.prototype,"layerIds",void 0);
d.__decorate([a.property({type:["top","visible","all","popup"],json:{write:!0}})],c.prototype,"layerOption",void 0);d.__decorate([a.property({type:e,json:{write:!0}})],c.prototype,"mapExtent",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"maxAllowableOffset",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnFieldName",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnGeometry",void 0);d.__decorate([a.property({type:Boolean,
json:{write:!0}})],c.prototype,"returnM",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnUnformattedValues",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnZ",void 0);d.__decorate([a.property({type:p,json:{write:!0}})],c.prototype,"spatialReference",void 0);d.__decorate([a.property()],c.prototype,"sublayers",void 0);d.__decorate([a.property({type:k,json:{write:!0}})],c.prototype,"timeExtent",void 0);d.__decorate([a.property({type:Number,
json:{write:!0}})],c.prototype,"tolerance",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"width",void 0);return c=v=d.__decorate([q.subclass("esri.rest.support.IdentifyParameters")],c)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),
function(d,g,k,c,a,b,f,l,q,h,e,p){g=class extends c.JSONSupport{constructor(v){super(v);this.layerName=this.layerId=this.feature=this.displayFieldName=null}readFeature(v,w){return k.fromJSON({attributes:{...w.attributes},geometry:{...w.geometry}})}writeFeature(v,w){if(v){var {attributes:z,geometry:K}=v;z&&(w.attributes={...z});null!=K&&(w.geometry=K.toJSON(),w.geometryType=p.typeKebabDictionary.toJSON(K.type))}}};d.__decorate([a.property({type:String,json:{write:!0}})],g.prototype,"displayFieldName",
void 0);d.__decorate([a.property({type:k})],g.prototype,"feature",void 0);d.__decorate([q.reader("feature",["attributes","geometry"])],g.prototype,"readFeature",null);d.__decorate([e.writer("feature")],g.prototype,"writeFeature",null);d.__decorate([a.property({type:Number,json:{write:!0}})],g.prototype,"layerId",void 0);d.__decorate([a.property({type:String,json:{write:!0}})],g.prototype,"layerName",void 0);return g=d.__decorate([h.subclass("esri.rest.support.IdentifyResult")],g)})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(d,g){function k(c,a){return c.popupTemplate?c.popupTemplate:null!=a&&a.defaultPopupTemplateEnabled&&null!=c.defaultPopupTemplate?c.defaultPopupTemplate:null}d.getFetchPopupTemplate=k;d.getRequiredFields=async function(c,a=c.popupTemplate){if(null==a)return[];const b=await a.getRequiredFields(c.fieldsIndex);({lastEditInfoEnabled:a}=a);const {objectIdField:f,typeIdField:l,globalIdField:q,relationships:h}=c;if(b.includes("*"))return["*"];a=a?g.getFeatureEditFields(c):
[];const e=g.fixFields(c.fieldsIndex,[...b,...a]);l&&e.push(l);e&&f&&c.fieldsIndex?.has(f)&&!e.includes(f)&&e.push(f);e&&q&&c.fieldsIndex?.has(q)&&!e.includes(q)&&e.push(q);h&&h.forEach(p=>{({keyField:p}=p);e&&p&&c.fieldsIndex?.has(p)&&!e.includes(p)&&e.push(p)});return e};d.hasPopupTemplate=function(c,a){return null!=k(c,{defaultPopupTemplateEnabled:a})};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../geometry",
"../../core/unitUtils","../../renderers/support/clickToleranceUtils","../../geometry/Extent"],function(d,g,k,c,a){function b(l,q,h,e=new a){let p=0;if("2d"===h.type)p=q*(h.resolution??0);else if("3d"===h.type){var v=h.overlayPixelSizeInMapUnits(l),w=h.basemapSpatialReference;p=null==w||w.equals(h.spatialReference)?q*v:k.getMetersPerUnitForSR(w)/k.getMetersPerUnitForSR(h.spatialReference)}q=l.x-p;v=l.y-p;w=l.x+p;l=l.y+p;({spatialReference:h}=h);e.xmin=Math.min(q,w);e.ymin=Math.min(v,l);e.xmax=Math.max(q,
w);e.ymax=Math.max(v,l);e.spatialReference=h;return e}const f=new a;d.createQueryGeometry=b;d.intersectsDrapedGeometry=function(l,q,h){l=h.toMap(l);if(null==l)return!1;const e=c.calculateTolerance();return b(l,e,h,f).intersects(q)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../config ../../../request ../../../core/urlUtils ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../../../core/Evented ../../../core/mathUtils ../../webgl/contextUtils ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../../chunks/builtins ../engine/webgl/definitions ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../core/asyncUtils ../../../core/Collection ../../../core/accessorSupport/watch ../../../core/accessorSupport/tracking/SimpleTrackingTarget ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../engine/webgl/shaders/MagnifierPrograms ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils".split(" "),function(d,
g,k,c,a,b,f,l,q,h,e,p,v,w,z,K,Q,I,J,A,x,O,P,C,R,T,U,V,W,Z,ca,X,m,r,t,B,y,D,n,E,H,G,N,L,aa,fa,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,ja,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ka,la,ma,da,na,ha,oa,pa,qa,ra,ia,sa){const ta=[0,0];b=class extends ra(ka.BitmapTileLayerView2D(la.LayerView2DMixin(qa))){constructor(){super(...arguments);this._fetchQueue=null;this._highlightGraphics=new e.GraphicsCollection;this.layer=this._tileStrategy=this._popupHighlightHelper=this._highlightView=null}get resampling(){return!("resampling"in
this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(u){this._fetchQueue.pause();this._fetchQueue.state=u.state;this._tileStrategy.update(u);this._fetchQueue.resume();this._highlightView?.processUpdate(u)}attach(){const u="tileServers"in this.layer?this.layer.tileServers:null,F=this.tilemapCache;this._tileInfoView=new na(this.layer.tileInfo,this.layer.fullExtent,F?.effectiveMinLOD,F?.effectiveMaxLOD);this._fetchQueue=new oa({tileInfoView:this._tileInfoView,
concurrency:u&&10*u.length||10,process:(M,S)=>this.fetchTile(M,S)});this._tileStrategy=new pa({cachePolicy:"keep",resampling:this.resampling,acquireTile:M=>this.acquireTile(M),releaseTile:M=>this.releaseTile(M),tileInfoView:this._tileInfoView});if(ia.isMapServiceLayerView(this,this.layer)){const M=this._highlightView=new ja({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new ma(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});
this.container.addChild(this._highlightView.container);this._popupHighlightHelper=new ia.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(S,Y)=>sa.createQueryGeometry(S,Y,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(S,Y)=>{M.graphicUpdateHandler({graphic:S,property:Y})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate();this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()}));super.attach()}detach(){super.detach();
this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._popupHighlightHelper?.destroy();this._highlightView?.destroy();this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}async fetchPopupFeatures(u,F){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(u,F):[]}highlight(u){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(u):g.makeHandle()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(u){return h.equals(this.layer.tileInfo?.spatialReference,
u)}async doRefresh(){this.attached&&(this.suspended?(this._tileStrategy.clear(),this.requestUpdate()):(this._fetchQueue.reset(),this._tileStrategy.refresh(u=>this._updatingHandles.addPromise(this._enqueueTileFetch(u)))))}acquireTile(u){u=this._bitmapView.createTile(u);const F=u.bitmap;[F.x,F.y]=this._tileInfoView.getTileCoords(ta,u.key);F.resolution=this._tileInfoView.getTileResolution(u.key);[F.width,F.height]=this._tileInfoView.tileInfo.size;this._updatingHandles.addPromise(this._enqueueTileFetch(u));
this._bitmapView.addChild(u);this.requestUpdate();return u}releaseTile(u){this._fetchQueue.abort(u.key.id);this._bitmapView.removeChild(u);u.once("detach",()=>u.destroy());this.requestUpdate()}async fetchTile(u,F={}){var M=this.tilemapCache;const {signal:S,resamplingLevel:Y=0}=F;if(!M)try{return await this._fetchImage(u,S)}catch(ba){if(!c.isAbortError(ba)&&!this.resampling)return da.createBlankImage(this._tileInfoView.tileInfo.size);if(3>Y&&(M=this._tileInfoView.getTileParentId(u.id)))return M=new ha(M),
F=await this.fetchTile(M,{...F,resamplingLevel:Y+1}),da.resampleImage(this._tileInfoView,F,M,u);throw ba;}F=new ha(0,0,0,0);let ea;try{await M.fetchAvailabilityUpsample(u.level,u.row,u.col,F,{signal:S});if(F.level!==u.level&&!this.resampling)return da.createBlankImage(this._tileInfoView.tileInfo.size);ea=await this._fetchImage(F,S)}catch(ba){if(c.isAbortError(ba))throw ba;ea=await this._fetchImage(u,S)}return this.resampling?da.resampleImage(this._tileInfoView,ea,F,u):ea}async _enqueueTileFetch(u){if(!this._fetchQueue.has(u.key.id)){try{const F=
await this._fetchQueue.push(u.key);u.bitmap.source=F;u.bitmap.width=this._tileInfoView.tileInfo.size[0];u.bitmap.height=this._tileInfoView.tileInfo.size[1];u.once("attach",()=>this.requestUpdate())}catch(F){c.isAbortError(F)||k.getLogger(this).error(F)}this.requestUpdate()}}async _fetchImage(u,F){return this.layer.fetchImageBitmapTile(u.level,u.row,u.col,{signal:F})}};d.__decorate([a.property()],b.prototype,"resampling",null);d.__decorate([a.property()],b.prototype,"tilemapCache",null);return b=d.__decorate([q.subclass("esri.views.2d.layers.TileLayerView2D")],
b)});