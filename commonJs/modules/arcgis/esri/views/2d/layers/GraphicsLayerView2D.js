// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/handleUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(f,h,k,l,g,m,n,d,v,p,q,r,t,u){d=class extends q.LayerView2DMixin(u){constructor(){super(...arguments);
this._highlightIds=new Map}attach(){this.graphicsView=new t({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:this.layer.graphics,container:new r(this.view.featuresTilingScheme)});this._updateHighlight();this.container.addChild(this.graphicsView.container);this.addAttachHandles(this.layer.on("graphic-update",this.graphicsView.graphicUpdateHandler))}detach(){this.container.removeAllChildren();this.graphicsView=m.destroyMaybe(this.graphicsView)}async hitTest(a){return this.graphicsView?
this.graphicsView.hitTest(a).map(b=>({type:"graphic",graphic:b,mapPoint:a,layer:this.layer})):null}async fetchPopupFeatures(a){return this.graphicsView?this.graphicsView.hitTest(a).filter(b=>!!b.popupTemplate):[]}queryGraphics(){return Promise.resolve(this.graphicsView.graphics)}update(a){this.graphicsView.processUpdate(a)}moveStart(){}viewChange(){this.graphicsView.viewChange()}moveEnd(){}isUpdating(){return!this.graphicsView||this.graphicsView.updating}highlight(a){let b;"number"===typeof a?b=[a]:
a instanceof h?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(c=>c&&c.uid):l.isCollection(a)&&0<a.length&&(b=a.map(c=>c&&c.uid).toArray());const e=b?.filter(k.isSome);if(!e?.length)return g.makeHandle();this._addHighlight(e);return g.makeHandle(()=>this._removeHighlight(e))}_addHighlight(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()}_removeHighlight(a){for(const b of a)this._highlightIds.has(b)&&
(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()}_updateHighlight(){this.graphicsView?.setHighlight(Array.from(this._highlightIds.keys()))}};f.__decorate([n.property()],d.prototype,"graphicsView",void 0);return d=f.__decorate([p.subclass("esri.views.2d.layers.GraphicsLayerView2D")],d)});