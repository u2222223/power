// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/arrayUtils ./core/has ./core/accessorSupport/decorators/subclass".split(" "),function(m,q,r,d,k,n,w){q=class extends q{constructor(){super(...arguments);this.isAggregate=!0}getEffectivePopupTemplate(l){return this.popupTemplate?this.popupTemplate:(l=this.sourceLayer?.featureReduction)&&"popupTemplate"in l&&l.popupEnabled?l.popupTemplate:
null}getObjectId(){return this.attributes.aggregateId}};m.__decorate([r.property({type:Boolean})],q.prototype,"isAggregate",void 0);return q=m.__decorate([w.subclass("esri.AggregateGraphic")],q)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(m,
q,r,d,k,n,w,l){q=class extends q{constructor(c){super(c);this._filter=null;this.duration=r("mapview-transitions-duration");this._excludedEffectView=new l.EffectView(c);this._includedEffectView=new l.EffectView(c)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(c){this._get("featureEffect")!==c&&this._transitionTo(c)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(c){this._set("scale",
c);this._excludedEffectView.scale=c;this._includedEffectView.scale=c}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(c,b){this._set("scale",b);this.transitioning?(this._includedEffectView.transitionStep(c,b),this._excludedEffectView.transitionStep(c,b),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=b,this._includedEffectView.scale=b)}endTransitions(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();
this._filter=null}_transitionTo(c){const b=this._get("featureEffect"),h=c?.includedEffect,g=c?.excludedEffect,f=this._includedEffectView.canTransitionTo(h)&&this._excludedEffectView.canTransitionTo(g);this._includedEffectView.effect=h;this._excludedEffectView.effect=g;this._set("featureEffect",c);this._filter=c?.filter||b?.filter||null;f||this.endTransitions()}};m.__decorate([d.property()],q.prototype,"_filter",void 0);m.__decorate([d.property()],q.prototype,"_excludedEffectView",void 0);m.__decorate([d.property()],
q.prototype,"_includedEffectView",void 0);m.__decorate([d.property()],q.prototype,"duration",void 0);m.__decorate([d.property()],q.prototype,"excludedEffects",null);m.__decorate([d.property()],q.prototype,"featureEffect",null);m.__decorate([d.property()],q.prototype,"filter",null);m.__decorate([d.property()],q.prototype,"hasEffects",null);m.__decorate([d.property()],q.prototype,"includedEffects",null);m.__decorate([d.property({value:0})],q.prototype,"scale",null);m.__decorate([d.property()],q.prototype,
"transitioning",null);return q=m.__decorate([w.subclass("esri.layers.effects.FeatureEffectView")],q)})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(m,
q,r,d,k,n,w,l,c,b,h){r=class extends b{constructor(){super(...arguments);this.features=[]}readFeatures(g,f){f=h.fromJSON(f.spatialReference);const t=[];for(let x=0;x<g.length;x++){var A=g[x];const B=q.fromJSON(A);var y=A.geometry?.spatialReference;null==B.geometry||y||(B.geometry.spatialReference=f);A=A.aggregateGeometries;y=B.aggregateGeometries;if(A&&null!=y)for(const z in y){const p=y[z],u=A[z]?.spatialReference;null==p||u||(p.spatialReference=f)}t.push(B)}return t}};m.__decorate([d.property({type:[q],
json:{write:!0}})],r.prototype,"features",void 0);m.__decorate([l.reader("features")],r.prototype,"readFeatures",null);return r=m.__decorate([c.subclass("esri.rest.support.AggregateFeatureSet")],r)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(m,q,r,d,k,n,w,l,c,b,h,g,f,t,A,y,x){const B=r.ofType({key:"type",base:null,typeMap:{rect:A,path:x,geometry:y}});m.LayerView2DMixin=z=>{z=class extends z{constructor(){super(...arguments);this.attached=!1;this.clips=new B;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const p=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&p&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new k("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new f.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([n.watch(()=>this.suspended,u=>{this.container&&(this.container.visible=!u);this.view&&!u&&this.updateRequested&&this.view.requestUpdate()},n.syncAndInitial),n.watch(()=>this.layer?.opacity??1,u=>{this.container&&(this.container.opacity=
u)},n.syncAndInitial),n.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",u=>{this.container&&(this.container.blendMode=u)},n.syncAndInitial),n.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,u=>{this.container&&(this.container.effect=u)},n.syncAndInitial),n.watch(()=>this.highlightOptions,u=>this.container.highlightOptions=u,n.syncAndInitial),n.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},n.syncAndInitial),n.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:u})=>{u=null!=u?this.isVisibleAtScale(u):!1;u!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",u)},n.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(u=>{u===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const p=
this.view?.spatialReference;return null==p||this.supportsSpatialReference(p)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(p){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!u)return!0;const {minScale:E,maxScale:H}=u;return g.isInScaleRange(p,E,H)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(p){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",p),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(p)))}hitTest(p,
u){return Promise.resolve(null)}supportsSpatialReference(p){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const p=super.getSuspendInfo(),u=!this.spatialReferenceSupported,E=this.visibleAtCurrentScale;u&&(p.spatialReferenceNotSupported=u);E&&(p.outsideScaleRange=E);return p}addAttachHandles(p){this.addHandles(p,"attach")}};q.__decorate([w.property()],z.prototype,"attached",void 0);q.__decorate([w.property({type:B,set(p){p=
d.referenceSetter(p,this._get("clips"),B);this._set("clips",p)}})],z.prototype,"clips",void 0);q.__decorate([w.property()],z.prototype,"container",void 0);q.__decorate([w.property()],z.prototype,"moving",void 0);q.__decorate([w.property({readOnly:!0})],z.prototype,"spatialReferenceSupported",null);q.__decorate([w.property({readOnly:!0})],z.prototype,"updateParameters",void 0);q.__decorate([w.property()],z.prototype,"updateRequested",void 0);q.__decorate([w.property()],z.prototype,"updating",null);
q.__decorate([w.property()],z.prototype,"view",void 0);q.__decorate([w.property({readOnly:!0})],z.prototype,"visibleAtCurrentScale",void 0);q.__decorate([w.property({type:t})],z.prototype,"highlightOptions",void 0);return z=q.__decorate([h.subclass("esri.views.2d.layers.LayerView2D")],z)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(m,q,r){function d(k,n){n=r.getMetersPerUnitForSR(n);
return k/(n*r.inchesPerMeter*96)}m.getExtentForScale=function(k,n){const w=k.extent;k=k.width-(k.padding?k.padding.left+k.padding.right:0);n=d(n,w.spatialReference);return w.clone().expand(n*k/w.width)};m.getResolutionForScale=d;m.getResolutionInMetersForScale=function(k){return k/(96*r.inchesPerMeter)};m.getScale=function(k,n){n=n||k.extent;k=k.width;const w=r.getMetersPerUnitForSR(n?.spatialReference);return n&&k?n.width/k*w*r.inchesPerMeter*96:0};m.getScaleForResolution=function(k,n){n=r.getMetersPerUnitForSR(n);
return k*n*r.inchesPerMeter*96};m.isInScaleRange=function(k,n,w){if(n=0===n||q.floatEqualAbsolute(k,n)||k<n)n=0===w||q.floatEqualAbsolute(k,w)||k>w;return n};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(m,q,r,d,k,n,w){var l;r=l=class extends w{constructor(c){super(c);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};m.__decorate([q.property({type:[Number,String],json:{write:!0}})],r.prototype,"left",void 0);m.__decorate([q.property({type:[Number,String],
json:{write:!0}})],r.prototype,"right",void 0);m.__decorate([q.property({type:[Number,String],json:{write:!0}})],r.prototype,"top",void 0);m.__decorate([q.property({type:[Number,String],json:{write:!0}})],r.prototype,"bottom",void 0);return r=l=m.__decorate([n.subclass("esri.views.layers.support.ClipRect")],r)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(m,q,r,d,k,n,w){q=class extends q.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};m.__decorate([r.property({readOnly:!0})],q.prototype,"version",null);return q=m.__decorate([w.subclass("esri.views.layers.support.ClipArea")],q)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(m,q,r,d,k,n,w,l,c,b,h,g){var f;q={base:l,key:"type",typeMap:{extent:h,polygon:g}};b=f=class extends b{constructor(t){super(t);this.type="geometry";this.geometry=null}clone(){return new f({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};m.__decorate([r.property({types:q,json:{read:c.fromJSON,write:!0}})],b.prototype,"geometry",void 0);return b=f=m.__decorate([w.subclass("esri.views.layers.support.Geometry")],b)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(m,q,r,d,k,n,w){r=class extends w{constructor(l){super(l);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};m.__decorate([q.property({type:[[[Number]]],json:{write:!0}})],r.prototype,"path",void 0);return r=m.__decorate([n.subclass("esri.views.layers.support.Path")],r)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["exports","./tileRenderers/HeatmapTileRenderer","./tileRenderers/SymbolTileRenderer"],function(m,q,r){m.createOrReuseTileRenderer=
function(d,k){if(!d)return null;switch(d.type){case "symbol":return new r.SymbolTileRenderer(k);case "heatmap":return new q.HeatmapTileRenderer(k)}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/HeatmapTileRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),
function(m,q,r,d,k,n,w,l,c,b,h,g){m.HeatmapTileRenderer=class extends h{constructor(f){super(f);this._intensityInfo={minDensity:0,maxDensity:0};this.type="heatmap";this.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}};this._container=new b.BitmapTileContainer(f.tileInfoView)}createTile(f){const t=this._container.createTile(f);this.tileInfoView.getTileCoords(t.bitmap,f);t.bitmap.resolution=this.tileInfoView.getTileResolution(f);return t}onConfigUpdate(){const f=
this.layer.renderer;if("heatmap"===f.type){const {minDensity:t,maxDensity:A,colorStops:y}=f;this._intensityInfo.minDensity=t;this._intensityInfo.maxDensity=A;this._gradient=c.generateGradient(y);this.tiles.forEach(x=>{const B=x.bitmap.source;B&&(B.minDensity=t,B.maxDensity=A,B.gradient=this._gradient,x.bitmap.invalidateTexture(),x.bitmap.requestRender())})}}hitTest(){return Promise.resolve([])}install(f){f.addChild(this._container)}uninstall(f){this._container.removeAllChildren();f.removeChild(this._container)}disposeTile(f){this._container.removeChild(f);
f.destroy()}supportsRenderer(f){return f&&"heatmap"===f.type}onTileData(f){const t=this.tiles.get(f.tileKey);if(t){f=f.intensityInfo;var {minDensity:A,maxDensity:y}=this._intensityInfo,x=t.bitmap.source||new g.HeatmapSource;x.intensities=f?.matrix||null;x.minDensity=A;x.maxDensity=y;x.gradient=this._gradient;t.bitmap.source=x;this._container.addChild(t);this._container.requestRender();this.requestUpdate()}}onTileError(f){console.error(f)}lockGPUUploads(){}unlockGPUUploads(){}fetchResource(f,t){console.error(f);
return Promise.reject()}};m.HeatmapTileRenderer=q.__decorate([l.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],m.HeatmapTileRenderer);Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/has ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(m,q,r,d,k,n,w){q=class extends q{constructor(l){super(l);this.tiles=new Map}destroy(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null}get updating(){return this.isUpdating()}acquireTile(l){const c=this.createTile(l);c.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(l.id,c);this.notifyChange("updating");return c}forceAttributeTextureUpload(){}forEachTile(l){this.tiles.forEach(l)}releaseTile(l){this.tiles.delete(l.key.id);this.notifyChange("updating");
this.disposeTile(l)}isUpdating(){let l=!0;this.tiles.forEach(b=>{l=l&&b.isReady});const c=!l;if(r("esri-2d-log-updating")){let b="";this.tiles.forEach(h=>{b+=`-> ${h.key.id}: isReady: ${h.isReady} status: ${h.updateStatus}\n`;l=l&&h.isReady});console.log(`Updating BaseTileRenderer ${c}\n${b}`)}return c}setHighlight(){}invalidateLabels(){}requestUpdate(){this.layerView.requestUpdate()}};m.__decorate([d.property()],q.prototype,"layer",void 0);m.__decorate([d.property()],q.prototype,"layerView",void 0);
m.__decorate([d.property()],q.prototype,"tileInfoView",void 0);m.__decorate([d.property()],q.prototype,"updating",null);return q=m.__decorate([w.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],q)})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["exports","../../../../../../renderers/support/heatmapUtils"],function(m,q){class r{constructor(){this.gradient=null;this.height=512;this.intensities=null;this.width=512}render(d){q.drawHeatmap(d,
512,this.intensities,this.gradient,this.minDensity,this.maxDensity)}}m.HeatmapSource=r;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/SymbolTileRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),
function(m,q,r,d,k,n,w,l,c,b,h,g,f,t,A,y){m.SymbolTileRenderer=class extends t{constructor(){super(...arguments);this.type="symbol"}install(x){const B=new y.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=B;x.addChild(B)}uninstall(x){x.removeChild(this.featuresView);this.featuresView=d.destroyMaybe(this.featuresView)}fetchResource(x,B){({url:x}=x);const z=this.featuresView.stage;try{return z.resourceManager.fetchResource(x,{signal:B.signal})}catch(p){return k.isAbortError(p)?
Promise.resolve({width:0,height:0}):Promise.reject(p)}}isUpdating(){const x=super.isUpdating(),B=!this.featuresView||this.featuresView.isUpdating();var z=this.featuresView?.hasEmptyAttributeView();z=x||B||x&&z;r("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${z}\n  -> updatingTiles ${x}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${B}`);return z}hitTest(x){return this.featuresView.hitTest(x)}supportsRenderer(x){return null!=x&&"simple class-breaks unique-value dot-density dictionary heatmap pie-chart".split(" ").includes(x.type)}onConfigUpdate(x){var B=
null;x&&"visualVariables"in x&&(B=(f.simplifyVVRenderer(x).visualVariables||[]).map(z=>{const p=z.clone();"normalizationField"in z&&(p.normalizationField=null);z.valueExpression&&"$view.scale"!==z.valueExpression&&(p.valueExpression=null,p.field="nop");return p}),B=A.convertVisualVariables(B));this.featuresView.setRendererInfo(x,B,this.layerView.featureEffect)}onTileData(x){const B=this.tiles.get(x.tileKey);if(B&&x.data)this.featuresView.onTileData(B,x.data);this.layerView.view.labelManager.requestUpdate()}onTileError(x){if(x=
this.tiles.get(x.tileKey))this.featuresView.onTileError(x)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload();this.tiles.forEach(x=>x.lock())}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(x=>x.unlock())}async getMaterialItems(x){return this.featuresView.getMaterialItems(x)}invalidateLabels(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}createTile(x){const B=
this.tileInfoView.getTileBounds(h.create(),x),z=this.tileInfoView.getTileResolution(x.level);return new g.FeatureTile(x,z,B[0],B[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())}disposeTile(x){this.featuresView.removeChild(x);x.destroy();this.layerView.view.labelManager.requestUpdate()}};m.SymbolTileRenderer=q.__decorate([b.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],m.SymbolTileRenderer);Object.defineProperty(m,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../core/CircularArray ../../../../core/has ../../../../chunks/mat2df32 ./enums ./Utils ./WGLTile ./collisions/MetricReader ./cpuMapped/Geometry".split(" "),function(m,q,r,d,k,n,w,l,c){let b=0;class h extends w.WGLTile{constructor(g,f,t,A,y,x){super(g,f,t,A);this.instanceId=b++;this.patchCount=0;this._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1};this._patches=
new q(100);this._bufferPatches=new q(100);this._lastCommitTime=0;this.transforms.labelMat2d=d.create();this._store=y;this._requestLabelUpdate=x}destroy(){super.destroy();this._renderState.current.geometry.forEach(g=>g.destroy());null!=this._renderState.next&&this._renderState.next.geometry.forEach(g=>g.destroy());this._renderState.current=null;this._renderState.next=null}get labelMetrics(){return this._renderState.current.metrics}get hasData(){return!!this._renderState.current.geometry.size}get updateStatus(){return`renderState:${!!this._renderState.current}, ${!!this._renderState.next}, hasData:${this.hasData}, queue:${this._patches.size}`}getGeometry(g){return this._renderState.current.geometry.get(g)}patch(g,
f){this.patchCount++;g.clear&&50<=this._patches.size&&this._dropPatches();const t=g.addOrUpdate&&this.key.id!==g.addOrUpdate.tileKeyOrigin;f&&t?this._bufferPatches.enqueue(g):(g.sort=g.sort&&!f,this._patches.enqueue(g));this.requestRender()}commit(g){if(this._lastCommitTime!==g.time){this._lastCommitTime=g.time;for(g=0;4>g;g++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}lock(){this._renderState.locked=!0}unlock(){this._renderState.locked=
!1;this._flushUpdates();this._swap()}_swapRenderStates(){this._renderState.next&&(this._renderState.locked?(this._renderState.swap=!0,this.requestRender()):(this._renderState.swap=!0,this._swap()))}_swap(){this._renderState.swap&&(this._renderState.swap=!1,null!=this._renderState.next&&(this._renderState.current.geometry.forEach(g=>g.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))}_flushUpdates(){let g=this._patches.maxSize;for(;this._patches.size&&
g--;)this._updateMesh(),this._swap()}_updateBufferMesh(){var g=this._bufferPatches.peek();if(null==g||!g.clear||null===this._renderState.next)for(;this._bufferPatches.size;)g=this._bufferPatches.dequeue(),null!=g&&this._patchBuffer(g)}_updateMesh(){const g=this._patches.dequeue();if(null!=g){if(r("esri-2d-update-debug")){var f=g.addOrUpdate?.tileKeyOrigin;f=this.key.id===f?"SELF":f;let t="";for(let A=0;5>A;A++)t+=g.addOrUpdate?.data[A]?.records?.byteLength?1:0;console.debug(this.key.id,"FeatureTile:patch",
`[clear: ${g.clear} origin: ${f}, end:${g.end} data:${t}]`)}!0===g.clear&&(null!=this._renderState.next&&(this._renderState.next.geometry.forEach(t=>t.destroy()),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},r("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState"));this.requestRender();this._patch(g);g.end&&(r("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),
this.ready(),this._swapRenderStates())}}_patch(g){n.forEachGeometryType(f=>{this._remove(f,g.remove);this._insert(f,g,!1)})}_patchBuffer(g){n.forEachGeometryType(f=>{this._insert(f,g,!0)})}_insert(g,f,t){try{const A=f.addOrUpdate?.data[g],y=(this._renderState.next??this._renderState.current).geometry;null!=A&&(y.has(g)||(r("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Creating geometry buffer ${g}`),y.set(g,new c.Geometry(g,this.stage))),r("esri-2d-update-debug")&&console.debug(this.key.id,
`FeatureTile:_insert - Inserting into ${g}, version=${f.addOrUpdate?.version} stride=${A.stride}`),y.get(g).insert(A,f.sort,t),g===k.WGLGeometryType.LABEL&&this._insertLabelMetrics(f.type,A.metrics,f.clear))}catch(A){}}_insertLabelMetrics(g,f,t){t=this._renderState.next??this._renderState.current;if(null!=f)if(f=l.MetricReader.from(f),null==t.metrics)t.metrics=f;else{if("update"===g)for(g=f.getCursor();g.next();)t.metrics.delete(g.id);t.metrics.link(f)}}_remove(g,f){g=(this._renderState.next??this._renderState.current).geometry.get(g);
f&&f.length&&g&&(g.remove(f),this._removeLabelMetrics(f))}_removeLabelMetrics(g){const {metrics:f}=this._renderState.next??this._renderState.current;if(null!=f&&g.length)for(const t of g)for(;f.delete(t););}_dropPatches(){const g=[];let f=!1;for(;this._patches.size;){const t=this._patches.dequeue();if(null==t)break;if(t.clear){if(f)break;f=!0}g.push(t)}this._patches.clear();g.forEach(t=>this._patches.enqueue(t))}}m.FeatureTile=h;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/MetricReader":function(){define(["exports"],
function(m){class q{constructor(d){this._savedOffset=this._savedCursor=null;this._cursor=this._head=d}static from(d){d=r.from(new Float32Array(d));return new q(d)}get id(){return this._cursor.id}get baseZoom(){return this._cursor.baseZoom}get anchorX(){return this._cursor.anchorX}get anchorY(){return this._cursor.anchorY}get directionX(){return this._cursor.directionX}get directionY(){return this._cursor.directionY}get size(){return this._cursor.size}get materialKey(){return this._cursor.materialKey}get boundsCount(){return this._cursor.boundsCount}computedMinZoom(){return this._cursor.computedMinZoom()}setComputedMinZoom(d){return this._cursor.setComputedMinZoom(d)}boundsComputedAnchorX(d){return this._cursor.boundsComputedAnchorX(d)}boundsComputedAnchorY(d){return this._cursor.boundsComputedAnchorY(d)}setBoundsComputedAnchorX(d,
k){return this._cursor.setBoundsComputedAnchorX(d,k)}setBoundsComputedAnchorY(d,k){return this._cursor.setBoundsComputedAnchorY(d,k)}boundsX(d){return this._cursor.boundsX(d)}boundsY(d){return this._cursor.boundsY(d)}boundsWidth(d){return this._cursor.boundsWidth(d)}boundsHeight(d){return this._cursor.boundsHeight(d)}link(d){if(null!=d._head)return this._cursor.link(d._head)}getCursor(){return this.copy()}copy(){const d=new q(this._head?.copy());if(!d._head)return d;let k=d._head,n=d._head._link;
for(;n;)k._link=n.copy(),k=n,n=k._link;return d}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}nextId(){const d=this.id;for(;d===this.id;)if(!this.next())return!1;return!0}save(){this._savedCursor=this._cursor;this._savedOffset=this._cursor._offset}restore(){this._savedCursor&&(this._cursor=this._savedCursor);null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)}next(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;
this._cursor._offset=0}return!0}lookup(d){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(d);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}delete(d){let k=this._head,n=null;for(;k;){if(k.delete(d))return k.isEmpty()&&null!=n&&(n._link=k._link),!0;n=k;k=k._link}return!1}}class r{constructor(d){this._offset=-1;this._link=null;this._deletedCount=this._count=0;this._offsets={instance:null};this._buffer=d}static from(d){return new r(new Float32Array(d))}isEmpty(){return this._deletedCount===
this.count}get count(){this._count||(this._count=this._computeCount());return this._count}get id(){return this._buffer[this._offset]}set id(d){this._buffer[this._offset]=d}get baseZoom(){return this._buffer[this._offset+1]}get anchorX(){return this._buffer[this._offset+2]}get anchorY(){return this._buffer[this._offset+3]}get directionX(){return this._buffer[this._offset+4]}get directionY(){return this._buffer[this._offset+5]}get size(){return this._buffer[this._offset+6]}get materialKey(){return this._buffer[this._offset+
7]}computedMinZoom(){return this._buffer[this._offset+8]}setComputedMinZoom(d){this._buffer[this._offset+8]=d}get boundsCount(){return this._buffer[this._offset+9]}boundsComputedAnchorX(d){return this._buffer[this._offset+10+6*d]}boundsComputedAnchorY(d){return this._buffer[this._offset+10+6*d+1]}setBoundsComputedAnchorX(d,k){this._buffer[this._offset+10+6*d]=k}setBoundsComputedAnchorY(d,k){this._buffer[this._offset+10+6*d+1]=k}boundsX(d){return this._buffer[this._offset+10+6*d+2]}boundsY(d){return this._buffer[this._offset+
10+6*d+3]}boundsWidth(d){return this._buffer[this._offset+10+6*d+4]}boundsHeight(d){return this._buffer[this._offset+10+6*d+5]}link(d){let k=this;for(;k._link;)k=k._link;k._link=d}getCursor(){return this.copy()}copy(){const d=new r(this._buffer);d._link=this._link;d._offset=this._offset;d._deletedCount=this._deletedCount;d._offsets=this._offsets;d._count=this._count;return d}peekId(){const d=this._offset+10+6*this.boundsCount+0;return d>=this._buffer.length?0:this._buffer[d]}next(){let d=0;for(;this._offset<
this._buffer.length&&100>d++&&(this._offset=-1===this._offset?0:this._offset+(10+6*this.boundsCount),4294967296===this.id););return 4294967296!==this.id&&this._offset<this._buffer.length}delete(d){const k=this._offset,n=this.lookup(d);if(n)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===d;)this.id=4294967295,++this._deletedCount;this._offset=k;return n}lookup(d){const k=this._offset;if(null==this._offsets.instance){this._offsets.instance=new Map;const n=this.copy();n._offset=-1;
let w=0;for(;n.next();)n.id!==w&&(this._offsets.instance.set(n.id,n._offset),w=n.id)}if(!this._offsets.instance.has(d))return!1;this._offset=this._offsets.instance.get(d);return 4294967296===this.id?(this._offset=k,!1):!0}_computeCount(){const d=this._offset;let k=0;for(this._offset=-1;this.next();)k++;this._offset=d;return k}}m.MetricReader=q;m.MetricReaderNode=r;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Geometry":function(){define("exports ../../../../../core/maybe ../FeatureDisplayList ./Buffer ./DisplayRecordReader ../../../../webgl/VertexArrayObject".split(" "),
function(m,q,r,d,k,n){class w{constructor(l,c){this._vaos=new Map;this._indicesInvalid=!1;this.geometryType=l;this._stage=c}destroy(){for(const [,l]of this._vaos)l?.disposeVAOOnly();this._indexBuffer=q.destroyMaybe(this._indexBuffer);this._vertexBuffer=q.destroyMaybe(this._vertexBuffer)}get records(){return this._records}insert(l,c,b){if(l.records.byteLength)if(b=l.stride,this._vertexBuffer&&this._indexBuffer){var h=l.vertices.byteLength/b;this._indexBuffer.ensure(l.indices.byteLength/4);this._vertexBuffer.ensure(h);
const {vertices:g,indices:f}=l;l=k.DisplayRecordReader.from(l.records);const t=this._vertexBuffer.insert(g,0,g.byteLength/b,0),A=this._indexBuffer.insert(f,0,f.byteLength/4,t);l.forEach(y=>{y.indexFrom+=A;y.vertexFrom+=t});this._records.link(l);if(c)this._indicesInvalid=!0;else if(this._displayList)for(c=l.getCursor();c.next();)this._displayList.addRecord(c)}else{h=l.indices.byteLength/4;const g=l.vertices.byteLength/b,f=b/Uint32Array.BYTES_PER_ELEMENT,t=this._stage.bufferPool;this._records=k.DisplayRecordReader.from(l.records);
this._indexBuffer=new d.Buffer("index",h,1,t);this._vertexBuffer=new d.Buffer("vertex",g,f,t);this._indexBuffer.insert(l.indices,0,l.indices.byteLength/4,0);this._vertexBuffer.insert(l.vertices,0,l.vertices.byteLength/b,0);c&&(this._indicesInvalid=!0)}}remove(l){if(null!=this._records)for(const c of l){l=this._records.getCursor();if(!l.lookup(c))continue;const b=l.indexFrom,h=l.vertexFrom;let g=l.indexCount,f=l.vertexCount;for(;l.next()&&l.id===c;)g+=l.indexCount,f+=l.vertexCount;this._indexBuffer.free(b,
g);this._vertexBuffer.free(h,f,!0);this._records.delete(c)}}getVAO(l,c,b,h){if(!this._vertexBuffer||!this._indexBuffer||null==this._records||!this._vertexBuffer.bufferSize)return null;const g=h?1:0;let f=this._vaos.get(g);if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||h&&this._indexBuffer.invalidatedComputeBuffer)f?.disposeVAOOnly(),f=null;this._vertexBuffer.upload();this._indexBuffer.upload();h=this._indexBuffer.getGPUBuffer(l,1===g);const t=this._vertexBuffer.getGPUBuffer(l);
f||(f=new n.VertexArrayObject(l,b,c,{geometry:t},h),this._vaos.set(g,f));return f}forEachCommand(l){if(null!=this._records){this._sortIndices(this._records);if(!this._displayList){const c=this._cursorIndexOrder;this._displayList=r.FeatureDisplayList.from(this,this.geometryType,this._records.getCursor(),c)}this._displayList.forEach(l)}}_sortIndices(l){const c=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var b=0,h=l.getCursor(),g=[],f=[],t=[];h.next();)f.push(h.index),
t.push(h.sortKey),g.push(h.id);f.sort((x,B)=>{const z=t[B],p=t[x];return p===z?g[B]-g[x]:z-p});l=l.getCursor();h=c?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const x of f){if(!l.seekIndex(x))throw Error("Expected to find index");if(c){const {indexFrom:B,indexCount:z}=l;l.indexFrom=b;for(var A=0;A<z;A++)this._indexBuffer.set(b++,h.array[B+A])}else{const {vertexFrom:B,vertexCount:z}=l;var y=this._vertexBuffer.strideInt;const p=B*y;A=p+z*y;l.vertexFrom=b/y;for(y=p;y<A;y++)this._vertexBuffer.set(b++,
h.array[y])}}this._cursorIndexOrder=f;this._displayList=null}}}m.Geometry=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../core/maybe ../BufferPool ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(m,q,r,d,k,n){class w{constructor(l,c,b,h){h=r.TypedBuffer.create(c*b*Uint32Array.BYTES_PER_ELEMENT,h);this.size=c;this.strideInt=b;this.bufferType=l;this.dirty={start:Infinity,
end:0};this._gpu=null;this._cpu=h;this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get invalidated(){return 0<this.bufferSize&&!this._gpu}get invalidatedComputeBuffer(){return 0<this.bufferSize&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer();this._gpu?.dispose();this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose();this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose();this._gpuComputeTriangles?.dispose();this._cpu?.destroy();
this._cpu2?.destroy()}clear(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new d.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0}ensure(l){if(!(this.maxAvailableSpace()>=l)&&l*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const c=this._cpu.length/this.strideInt;l=Math.round(1.25*(c+l));this._cpu.expand(l*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(c,l-c)}}set(l,c){this._cpu.array[l]!==c&&(this._cpu.array[l]=c,this.dirty.start=
Math.min(l,this.dirty.start),this.dirty.end=Math.max(l,this.dirty.end))}getGPUBuffer(l,c=!1){if(!this.bufferSize)return null;if(c){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(l));return this._gpuComputeTriangles}null==this._gpu&&(this._gpu=this._createBuffer(l));return this._gpu}getCPUBuffer(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==
this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);this._cpu2.set(this._cpu);return this._cpu2}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(l,c,b,h){const g=b*this.strideInt;if(!g)return 0;l=new Uint32Array(l,c*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,g);b=this.freeList.firstFit(b);q.assertIsSome(b,"First fit region must be defined");b*=this.strideInt;c=b/this.strideInt-c;if(0!==
h)for(let f=0;f<l.length;f++)l[f]+=h;this._cpu.array.set(l,b);this.dirty.start=Math.min(this.dirty.start,b);this.dirty.end=Math.max(this.dirty.end,b+g);this.fillPointer=Math.max(this.fillPointer,b+g);return c}free(l,c,b){const h=l*this.strideInt,g=(l+c)*this.strideInt;if(!0===b)for(b=l;b!==l+c;b++)this._cpu.array[b*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,h);this.dirty.end=Math.max(this.dirty.end,g);this.freeList.free(l,c)}upload(){this.dirty.end&&(this._invalidateTriangleBuffer(),
null!=this._gpu&&this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)}_createBuffer(l){const c=n.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?k.BufferObject.createIndex(l,c,this._cpu.array):k.BufferObject.createVertex(l,c,this._cpu.array)}_createComputeBuffer(l){const c=n.Usage.DYNAMIC_DRAW,b=new Uint32Array(this.fillPointer/3);for(let h=0;h<this.fillPointer;h+=3)b[h/3]=this._cpu.array[h];return k.BufferObject.createIndex(l,
c,b)}}m.Buffer=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("exports ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),function(m,q,r,d,k,n){const w=q("featurelayer-order-by-server-enabled");class l extends k.FeatureContainer{constructor(c,b,h,g){super(c);this._hitTestsRequests=
[];this._layer=h;this._layerView=b;this._onUpdate=g}renderChildren(c){this.attributeView.update();this.hasAnimation&&c.painter.effects.integrate.draw(c,c.attributeView);super.renderChildren(c)}hasEmptyAttributeView(){return this.attributeView.isEmpty()}isUpdating(){return this.attributeView.isUpdating()}hitTest(c){let b=this._hitTestsRequests.find(({x:g,y:f})=>g===c.x&&f===c.y);const h=r.createResolver();b?b.resolvers.push(h):(b={x:c.x,y:c.y,resolvers:[h]},this._hitTestsRequests.push(b));this.requestRender();
return h.promise}onTileData(c,b){const h=w&&"orderBy"in this._layer&&this._layer.orderBy,g=h&&h?.length&&!h[0].valueExpression&&h[0].field;c.patch(b,!!h&&this._layerView.orderByFields===g);this.contains(c)||this.addChild(c);this.requestRender()}onTileError(c){this.contains(c)||this.addChild(c)}updateTransitionProperties(c,b){super.updateTransitionProperties(c,b);this._layerView.featureEffectView.transitionStep(c,b);this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(c){const {minScale:b,
maxScale:h}=this._layer.effectiveScaleRange,g=c.state.scale;g<=(b||Infinity)&&g>=h&&super.doRender(c)}afterRender(c){super.afterRender(c);this._hitTestsRequests.length&&this.requestRender()}onAttributeStoreUpdate(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();this._onUpdate()}get hasAnimation(){return this.hasLabels}setStencilReference(c){const {rendererSchema:b}=c.rendererInfo;if("dot-density"===b?.type&&1<b?.dotSize||"heatmap"===b?.type)for(const h of this.children)h.stencilRef=
h.key.level+1;else super.setStencilReference(c)}get hasHighlight(){return this._layerView.hasHighlight()}get hasLabels(){if("sublayers"in this._layer)return this._layer.sublayers.some(b=>!!b.labelingInfo?.length&&b.labelsVisible);var c=this._layer.featureReduction;c=c&&"labelingInfo"in c&&c.labelsVisible&&c.labelingInfo&&c.labelingInfo.length;return this._layer.labelingInfo?.length&&this._layer.labelsVisible||!!c}prepareRenderPasses(c){const b=super.prepareRenderPasses(c),h=c.registerRenderPass({name:"label",
brushes:[d.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:n.WGLDrawPhase.LABEL|n.WGLDrawPhase.LABEL_ALPHA});if(q("featurelayer-force-marker-text-draw-order")){var g=c.registerRenderPass({name:"geometry",brushes:[d.brushes.fill,d.brushes.dotDensity,d.brushes.line,d.brushes.heatmap,d.brushes.pieChart],target:()=>this.children,forceDrawByDisplayOrder:!0,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:c.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,
args:()=>this._layerView.featureEffectView.excludedEffects},{apply:c.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:c.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]});b.push(g)}else g=c.registerRenderPass({name:"geometry",brushes:[d.brushes.fill,d.brushes.dotDensity,d.brushes.line,d.brushes.marker,d.brushes.heatmap,d.brushes.pieChart,d.brushes.text],target:()=>
this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:c.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:c.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:c.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),b.push(g);c=c.registerRenderPass({name:"highlight",
brushes:[d.brushes.fill,d.brushes.dotDensity,d.brushes.line,d.brushes.marker,d.brushes.pieChart,d.brushes.text],target:()=>this.children,drawPhase:n.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:c.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});b.push(c);b.push(h);return b}}m.WGLFeatureView=l;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(m,q,r,d,k,n,w,l){function c(f){return f.some(t=>t.globalId)}function b(f){return f.filter(t=>!t.error).map(t=>t.objectId??t.globalId).filter(t=>null!=t)}function h(f,t){f=new Set(f);for(const A of t.values())f.add(A);return f}function g(f,t){f=new Set(f);for(const A of t.values())f.delete(A);return f}q=class extends q{constructor(f){super(f);this._hasGlobalIds=!1;this._notifyUpdating=()=>{this.notifyChange("updating")}}normalizeCtorArgs(f){this._queueProcessor=new l.QueueProcessor({concurrency:1,
process:f.process});return{}}destroy(){this.clear()}get updating(){return 0<this._queueProcessor.length}clear(){this._queueProcessor.clear()}push(f){const t=this._queueProcessor;var A=t.last();switch(f.type){case "update":case "refresh":if(A?.type===f.type)return;t.push(f).then(this._notifyUpdating,this._notifyUpdating);break;case "edit":(A="processed-edit"===A?.type?A:null)&&t.popLast();f=this._mergeEdits(A,f);for(const y of f)y&&t.push(y).then(this._notifyUpdating,this._notifyUpdating)}this.notifyChange("updating")}_mergeEdits(f,
t){const {addedFeatures:A,deletedFeatures:y,updatedFeatures:x}=t.edits;if(this._hasGlobalIds=this._hasGlobalIds||c(A)||c(x)||c(y))return t=[...A,...x],[f,{type:"processed-edit",edits:{addOrModified:t,removed:y}}];t=new Set(b(f?.edits.addOrModified??[]));f=new Set(b(f?.edits.removed??[]));const B=new Set([...b(A),...b(x)]),z=new Set(b(y));t=Array.from(h(g(t,z),B)).map(p=>({objectId:p}));f=Array.from(h(g(f,B),z)).map(p=>({objectId:p}));return[{type:"processed-edit",edits:{addOrModified:t,removed:f}}]}};
m.__decorate([r.property({readOnly:!0})],q.prototype,"updating",null);m.__decorate([r.property()],q.prototype,"process",void 0);return q=m.__decorate([w.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],q)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(m,q,r,d,k,n,w,l,c){q=class extends q.EsriPromise{constructor(b){super(b);this._startupResolver=r.createResolver();this.isReady=!1}initialize(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort();this._connection&&this._connection.close()}set tileRenderer(b){this.client.tileRenderer=b}get closed(){return this._connection.closed}async startup(b,h,g,f){await this.when();var t=this._controller.signal;t=Array.isArray(g.source)?
{transferList:g.source,signal:t}:void 0;b=b.tileInfo.toJSON();await this._connection.invoke("startup",{service:g,config:h,tileInfo:b,tiles:f},t);this._startupResolver.resolve();this._set("isReady",!0)}async updateTiles(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("updateTiles",b))}async update(b){b={config:b};await this._startupResolver.promise;return this._connection.invoke("update",b)}async applyUpdate(b){await this._startupResolver.promise;return this._connection.invoke("applyUpdate",
b)}async setHighlight(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",b))}async stop(){await this._startupResolver.promise;if(!this.closed)return r.ignoreAbortErrors(this._connection.invoke("stop"))}async refresh(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.refresh",b))}async querySummaryStatistics(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",
{query:b.toJSON(),params:h},g)}async queryAggregateSummaryStatistics(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateSummaryStatistics",{query:b.toJSON(),params:h},g)}async queryUniqueValues(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",{query:b.toJSON(),params:h},g)}async queryAggregateUniqueValues(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateUniqueValues",
{query:b.toJSON(),params:h},g)}async queryClassBreaks(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",{query:b.toJSON(),params:h},g)}async queryAggregateClassBreaks(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateClassBreaks",{query:b.toJSON(),params:h},g)}async queryHistogram(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",{query:b.toJSON(),
params:h},g)}async queryAggregateHistogram(b,h,g){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateHistogram",{query:b.toJSON(),params:h},g)}async queryFeatures(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",b?.toJSON(),h)}async queryVisibleFeatures(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",b?.toJSON(),h)}async queryObjectIds(b,h){await this._startupResolver.promise;
return this._connection.invoke("controller.queryObjectIds",b?.toJSON(),h)}async queryFeatureCount(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",b?.toJSON(),h)}async queryExtent(b,h){return this._connection.invoke("controller.queryExtent",b.toJSON(),h)}async queryLatestObservations(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",b.toJSON(),h)}async queryStatistics(b){await this._startupResolver.promise;
return this._connection.invoke("controller.queryStatistics",b)}async queryAggregates(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregates",b?.toJSON(),h)}async queryAggregateCount(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateCount",b?.toJSON(),h)}async queryAggregateIds(b,h){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateIds",b?.toJSON(),h)}async getObjectId(b){await this._startupResolver.promise;
return this._connection.invoke("controller.getObjectId",b)}async getDisplayId(b){await this._startupResolver.promise;return this._connection.invoke("controller.getDisplayId",b)}async getFeatures(b){await this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",b)}async getAggregates(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")}async getAggregateValueRanges(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")}async mapValidDisplayIds(b){await this._startupResolver.promise;
return this._connection.invoke("controller.mapValidDisplayIds",b)}async onEdits(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.onEdits",b))}async enableEvent(b,h){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:b,value:h}))}async pauseStream(){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))}async resumeStream(){await this._startupResolver.promise;
return r.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))}async sendMessageToSocket(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToSocket",b))}async sendMessageToClient(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToClient",b))}async updateCustomParameters(b){await this._startupResolver.promise;return r.ignoreAbortErrors(this._connection.invoke("controller.updateCustomParameters",
b))}async _startWorker(b){try{this._connection=await d.open("Pipeline",{client:this.client,strategy:"dedicated",signal:b})}catch(h){r.throwIfNotAbortError(h)}}};m.__decorate([k.property()],q.prototype,"isReady",void 0);m.__decorate([k.property({constructOnly:!0})],q.prototype,"client",void 0);m.__decorate([k.property()],q.prototype,"tileRenderer",null);return q=m.__decorate([c.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],q)})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports",
"../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],function(m,q,r,d){function k(c,b){switch(b.transformationType){case d.TransformationType.Additive:var h=n(b.minSize,c);return c+(h||b.minDataValue);case d.TransformationType.Constant:return h=b.stops,h=h?.length&&h[0].size,null==h&&(h=b.minSize),n(h,c);case d.TransformationType.ClampedLinear:h=b.minDataValue;var g=b.maxDataValue,f=(c-h)/(g-h),t=n(b.minSize,c);
b=n(b.maxSize,c);c=c<=h?t:c>=g?b:t+f*(b-t);return c;case d.TransformationType.Proportional:return h=c/b.minDataValue,g=n(b.minSize,c),c=n(b.maxSize,c),q.clamp(h*g,g,c);case d.TransformationType.Stops:{const [A,y,x]=w(c,b.cache.ipData);A===y?c=n(b.stops[A].size,c):(h=n(b.stops[A].size,c),c=n(b.stops[y].size,c),c=h+(c-h)*x)}return c;case d.TransformationType.RealWorldSize:return h=r.meterIn[b.valueUnit],g=n(b.minSize,c),f=n(b.maxSize,c),{valueRepresentation:b}=b,t=null,t="area"===b?2*Math.sqrt(c/l)/
h:"radius"===b||"distance"===b?2*c/h:c/h,q.clamp(t,g,f);case d.TransformationType.Identity:return c;case d.TransformationType.Unknown:return null}}function n(c,b){return"number"===typeof c?c:k(b,c)}function w(c,b){if(b){var h=0,g=b.length-1;b.some((f,t)=>{if(c<f)return g=t,!0;h=t;return!1});return[h,g,(c-b[h])/(b[g]-b[h])]}}const l=Math.PI;m.getSizeForValueSimple=k;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileManager":function(){define(["exports","./TileCoverage",
"./TileKey"],function(m,q,r){class d{constructor(k){this._tiles=new Map;this.buffer=0;this.acquireTile=k.acquireTile;this.releaseTile=k.releaseTile;this.tileInfoView=k.tileInfoView;this.buffer=k.buffer}destroy(){}clear(){this._tiles.forEach(k=>this._releaseTile(k))}tileKeys(){const k=[];this._tiles.forEach((n,w)=>k.push(w));return k}update(k){k=this.tileInfoView.getTileCoverage(k.state,this.buffer,!0,"closest");const {spans:n,lodInfo:w}=k,{level:l}=w,c=[],b=[],h=new Set,g=new Set;for(const {row:f,
colFrom:t,colTo:A}of n)for(let y=t;y<=A;y++){const x=r.getId(l,f,w.normalizeCol(y),w.getWorldForColumn(y)),B=this._getOrAcquireTile(c,x);h.add(x);B.isReady?B.visible=!0:g.add(B.key)}g.forEach(f=>this._addPlaceholders(h,f));this._tiles.forEach(f=>{h.has(f.key.id)||(b.push(f.key.id),this._releaseTile(f))});q.pool.release(k);return{hasMissingTiles:0<g.size,added:c,removed:b}}_getOrAcquireTile(k,n){if(!this._tiles.has(n)){const w=this.acquireTile(new r(n));k.push(n);this._tiles.set(n,w);w.visible=!1}return this._tiles.get(n)}_getTile(k){return this._tiles.get(k)}_releaseTile(k){this._tiles.delete(k.key.id);
this.releaseTile(k)}_addPlaceholders(k,n){const w=this._addPlaceholderChildren(k,n);1E-6>Math.abs(1-w)||this._addPlaceholderParent(k,n)||(this._getTile(n.id).visible=!0)}_addPlaceholderChildren(k,n){let w=0;this._tiles.forEach(l=>{w+=this._addPlaceholderChild(k,l,n)});return w}_addPlaceholderChild(k,n,w){if(n.key.level<=w.level||!n.hasData||!w.contains(n.key))return 0;n.visible=!0;k.add(n.key.id);return 1/(1<<2*(n.key.level-w.level))}_addPlaceholderParent(k,n){n=n.getParentKey();var w=0;let l=null;
for(;null!=n;){if(k.has(n.id))return!0;const c=this._getTile(n.id);if(c?.isReady){for(const b of k)(w=this._getTile(b))&&n.contains(w.key)&&(w.visible=!1);c.visible=!0;k.add(c.key.id);return!0}c?.hasData&&c.patchCount>w&&(w=c.patchCount,l=c);n=n.getParentKey()}return l?(l.visible=!0,k.add(l.key.id),!0):!1}}m.TileManager=d;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(m,q,r,d,k,n,w,l,c,b,h,g,f,t,A,y,x){const B=r.getLogger("esri.views.layers.FeatureLayerView");return z=>{z=class extends z{constructor(...p){super(...p);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([d.watch(()=>{const p=this.layer;return[p?.elevationInfo?.featureExpressionInfo,p&&"displayField"in p?p.displayField:null,p&&"timeInfo"in p&&p.timeInfo,p&&"renderer"in
p&&p.renderer,p&&"labelingInfo"in p&&p.labelingInfo,p&&"floorInfo"in p&&p.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),d.syncAndInitial),d.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),d.on(()=>{const p=this.layer;return p&&"sublayers"in p?p.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){const {layer:p,layer:{fieldsIndex:u},requiredFields:E}=this;return"outFields"in p&&p.outFields?
f.fixFields(u,[...f.unpackFieldNames(u,p.outFields),...E]):f.fixFields(u,E)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(p){this._override("featureEffect",p)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(p){B.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(p){throw Error("missing implementation");}createQuery(){var p=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};p=null!=this.filter?this.filter.createQuery(p):new A(p);if("feature"===this.layer.type){const u=t.getFloorFilterClause(this);null!=u&&(p.where=p.where?`(${p.where}) AND (${u})`:u)}null!=this.timeExtent&&(p.timeExtent=null!=p.timeExtent?p.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return p}createAggregateQuery(){return new A({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(p,
u){throw Error("missing implementation");}queryObjectIds(p,u){throw Error("missing implementation");}queryFeatureCount(p,u){throw Error("missing implementation");}queryExtent(p,u){throw Error("missing implementation");}async fetchPopupFeatures(p,u){if(p=this.validateFetchPopupFeatures(u))throw p;return this.fetchClientPopupFeatures(u)}_loadArcadeModules(p){return p.expressionInfos?.length||Array.isArray(p.content)&&p.content.some(u=>"expression"===u.type)?y.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const p=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",p);p.then(()=>{this._updatingRequiredFieldsPromise===p&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var p="3d"===this.view.type,{layer:u,layer:{fieldsIndex:E,objectIdField:H}}=this,J="renderer"in u&&u.renderer,K="orderBy"in u&&u.orderBy,M="featureReduction"in u?u.featureReduction:null,F=new Set;J=await Promise.allSettled([J?J.collectRequiredFields(F,E):null,f.collectLabelingFields(F,
u),p?f.collectElevationFields(F,u):null,null!=this.filter?f.collectFilterFields(F,u,this.filter):null,null!=this.featureEffect?f.collectFilterFields(F,u,this.featureEffect.filter):null,M?f.collectFeatureReductionFields(F,u,M):null,K?f.collectOrderByInfos(F,u,K):null]);"timeInfo"in u&&u.timeInfo&&this.timeExtent&&f.collectFields(F,u.fieldsIndex,[u.timeInfo.startField,u.timeInfo.endField]);"feature"===u.type&&(u.floorInfo&&f.collectFields(F,u.fieldsIndex,[u.floorInfo.floorField]),p&&null!=u.infoFor3D&&
(null==u.globalIdField&&B.error("globalIdField missing on 3DObjectFeatureLayer"),f.collectFields(F,u.fieldsIndex,[u.globalIdField])));"subtype-group"===u.type&&(f.collectField(F,E,u.subtypeField),K=u.sublayers.map(N=>Promise.all([N.renderer?.collectRequiredFields(F,E),f.collectLabelingFields(F,N)])),await Promise.allSettled(K));for(const N of J)"rejected"===N.status&&B.error(N.reason);f.collectField(F,E,H);p&&"displayField"in u&&u.displayField&&f.collectField(F,E,u.displayField);p=Array.from(F).sort();
this._set("requiredFields",p)}}validateFetchPopupFeatures(p){if(null==p)return null;for(const u of p.clientGraphics??[]){const E=u.layer;if("popupEnabled"in E&&!E.popupEnabled)return new q("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:E});if(u.isAggregate){const H="featureReduction"in E?E.featureReduction:null;if(!(H&&"popupTemplate"in H&&H.popupEnabled&&H.popupTemplate))return new q("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:E})}else if("popupTemplate"in
E&&!x.getFetchPopupTemplate(E,p))return new q("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:E})}}async fetchClientPopupFeatures(p){const u=null!=p?p.clientGraphics:null;if(!u||0===u.length)return[];const E=Array(u.length),H=new Map,J=await this.createPopupQuery(p);for(let M=0;M<u.length;M++){const F=u[M];if(F.isAggregate){E[M]=F;continue}var K=F.layer;if(!("popupEnabled"in K))continue;const N=f.unpackFieldNames(this.layer.fieldsIndex,J.outFields);K=x.getFetchPopupTemplate(K,
p);if(null==K)continue;const T=await this._loadArcadeModules(K);T&&T.arcadeUtils.hasGeometryOperations(K)||!f.featureHasFields(N,F)?H.set(F.getObjectId(),{graphic:F,index:M}):E[M]=F}if("stream"===this.layer.type||0===H.size)return E.filter(Boolean);J.objectIds=Array.from(H.keys());try{const M=await this.layer.queryFeatures(J);for(const F of M.features){const {graphic:{geometry:N},index:T}=H.get(F.getObjectId());F.geometry||(F.geometry=N);E[T]=F}}catch{}return E.filter(Boolean)}async createPopupQuery(p){const u=
this.layer.createQuery(),E=new Set;var H=!1,J=p?.clientGraphics?p.clientGraphics.map(K=>K.layer):[this.layer];for(const K of J)if("popupEnabled"in K&&(J=x.getFetchPopupTemplate(K,p),null!=J)){H=(H=await this._loadArcadeModules(J))&&H.arcadeUtils.hasGeometryOperations(J);H=!("point"!==this.layer.geometryType&&!H);J=await x.getRequiredFields(this.layer,J);for(const M of J)E.add(M)}u.returnGeometry=H;u.returnZ=H;u.returnM=H;u.outFields=Array.from(E);u.outSpatialReference=this.view.spatialReference;"feature"===
this.layer.type&&(p=t.getFloorFilterClause(this),null!=p&&(u.where=u.where?`(${u.where}) AND (${p})`:p));return u}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0}};m.__decorate([k.property()],z.prototype,"_updatingRequiredFieldsPromise",void 0);m.__decorate([k.property({readOnly:!0})],z.prototype,"availableFields",null);m.__decorate([k.property({readOnly:!0})],z.prototype,"dataUpdating",void 0);m.__decorate([k.property({type:h})],z.prototype,"featureEffect",
null);m.__decorate([k.property({type:g})],z.prototype,"filter",void 0);m.__decorate([k.property(b.combinedViewLayerTimeExtentProperty)],z.prototype,"timeExtent",void 0);m.__decorate([k.property()],z.prototype,"layer",void 0);m.__decorate([k.property({type:Number})],z.prototype,"maximumNumberOfFeatures",null);m.__decorate([k.property({readOnly:!0,type:Boolean})],z.prototype,"maximumNumberOfFeaturesExceeded",null);m.__decorate([k.property({readOnly:!0})],z.prototype,"requiredFields",void 0);m.__decorate([k.property()],
z.prototype,"suspended",void 0);m.__decorate([k.property()],z.prototype,"view",void 0);return z=m.__decorate([c.subclass("esri.views.layers.FeatureLayerView")],z)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(m){function q(r,d){if(!r?.length)return null;r=r.filter(k=>""!==k).map(k=>`'${k}'`);r.push("''");return`${d} IN (${r.join(",")}) OR ${d} IS NULL`}m.getFloorFilterClause=function(r){const d=r.layer;return"floorInfo"in d&&d.floorInfo?.floorField&&"floors"in r.view?
q(r.view.floors,d.floorInfo.floorField):null};m.getLayerFloorFilterClause=function(r,d){return"floorInfo"in d&&d.floorInfo?.floorField?q(r,d.floorInfo.floorField):null};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(m,q){function r(d,k){return d.popupTemplate?d.popupTemplate:null!=k&&k.defaultPopupTemplateEnabled&&null!=d.defaultPopupTemplate?d.defaultPopupTemplate:null}
m.getFetchPopupTemplate=r;m.getRequiredFields=async function(d,k=d.popupTemplate){if(null==k)return[];const n=await k.getRequiredFields(d.fieldsIndex);({lastEditInfoEnabled:k}=k);const {objectIdField:w,typeIdField:l,globalIdField:c,relationships:b}=d;if(n.includes("*"))return["*"];k=k?q.getFeatureEditFields(d):[];const h=q.fixFields(d.fieldsIndex,[...n,...k]);l&&h.push(l);h&&w&&d.fieldsIndex?.has(w)&&!h.includes(w)&&h.push(w);h&&c&&d.fieldsIndex?.has(c)&&!h.includes(c)&&h.push(c);b&&b.forEach(g=>
{({keyField:g}=g);h&&g&&d.fieldsIndex?.has(g)&&!h.includes(g)&&h.push(g)});return h};m.hasPopupTemplate=function(d,k){return null!=r(d,{defaultPopupTemplateEnabled:k})};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(m,q,r,d,k,n,w,l,c){return b=>{b=class extends b{initialize(){this.addHandles(d.on(()=>this.layer,"refresh",h=>{this.doRefresh(h.dataChanged).catch(g=>{r.isAbortError(g)||q.getLogger(this).error(g)})}),"RefreshableLayerView")}};m.__decorate([k.property()],b.prototype,"layer",void 0);return b=m.__decorate([c.subclass("esri.layers.mixins.RefreshableLayerView")],b)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../layers/support/layerUtils ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/rendererUtils ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/visualVariableSimpleUtils ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(m,
q,r,d,k,n,w,l,c,b,h,g,f,t,A,y,x,B,z,p,u,E,H,J,K,M,F,N,T,U,ba,ca,da,ea,fa,ha,ia,ja,ka){function aa(a){return a&&"openPorts"in a}function la(a){for(const e of a)if(a=("featureReduction"in e&&e.featureReduction&&"labelingInfo"in e.featureReduction?e.featureReduction:void 0)?.labelingInfo||[],a=[...(e.labelingInfo||[]),...a],e.labelsVisible&&a.length&&a.some(v=>"none"===v.deconflictionStrategy))return!0;return!1}function ma(a){return e=>A.pt2px(da.getSizeForValueSimple(e,a))}function na(a){switch(a.geometryType){case "point":return"esriGeometryPoint";
case "polyline":return"esriGeometryPolyline";case "polygon":return"esriGeometryPolygon";case "multipatch":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";default:return h.getLogger("esri.views.2d.layers.FeatureLayerView2D").error(new w("unsupported-geometry-type",`Geometry type of ${a.geometryType} is not supported`)),null}}r=class extends fa(ia(M.LayerView2DMixin(ha))){constructor(){super(...arguments);this._pipelineIsUpdating=!0;this._commandsQueue=new ba({process:a=>
{switch(a.type){case "processed-edit":return this._doEdit(a);case "refresh":return this._doRefresh(a.dataChanged);case "update":return this._doUpdate()}}});this._visibilityOverrides=new Set;this._highlightIds=new Map;this._updateHighlight=f.debounce(async()=>this._proxy.setHighlight(Array.from(this._highlightIds.keys())));this._needsClusterSizeUpdate=this._uploadsLocked=!1;this.featureEffectView=new z;this._lastDefinitionExpression=null}destroy(){this._updateClusterSizeTask?.remove();this._proxy?.destroy();
this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.addHandles([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),t.watch(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},t.syncAndInitial)],"constructor");this.featureEffectView.endTransitions()}async _initProxy(){var a=this.layer;if("isTable"in a&&a.isTable)throw new w("featurelayerview:table-not-supported","table feature layer can't be displayed",
{layer:this.layer});if(("feature"===a.type||"subtype-group"===a.type)&&!u.getEffectiveLayerCapabilities(a)?.operations.supportsQuery)throw new w("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:a});this._proxy&&this._proxy.destroy();a=this._createClientOptions();this._set("_proxy",new ca({client:a}));return this._proxy.when()}async _initServiceOptions(){this._set("_serviceOptions",await this._createServiceOptions());return this._serviceOptions}get _effectiveFeatureReduction(){if(!("featureReduction"in
this.layer))return null;const a=this.layer.featureReduction;return a?!("maxScale"in a&&a.maxScale)||a.maxScale<this.view.scale?a:null:null}get orderByFields(){return"stream"!==this._serviceOptions?.type?this._serviceOptions?.orderByFields:void 0}get labelsVisible(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(e=>e.labelingInfo&&e.labelsVisible)}get labelingCollisionInfos(){const {tileRenderer:a,layer:e}=this;if(null==a)return null;
const v=e.geometryType,C=!la("subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer]),D={};if("subtype-group"!==e.type){if("heatmap"===a?.type)return null;a:{var G=e.renderer;if(G=null!=G&&"visualVariables"in G&&G.visualVariables)for(I of G)if("size"===I.type){var I=ma(I);break a}I=null}D[0]=I}return[{tileRenderer:a,vvEvaluators:D,deconflictionEnabled:C,geometryType:v,visible:!this.suspended}]}get queryMode(){return this._serviceOptions?.type}get renderingConfigHash(){if(!this.layer)return null;
const a=this.availableFields;var e=this.layer;const v=this.view.floors,{definitionExpression:C}=e,D="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,G="renderer"in e&&e.renderer,I="gdbVersion"in e?e.gdbVersion:void 0,P="historicMoment"in e?e.historicMoment?.getTime():void 0,{timeExtent:L}=this,O="customParameters"in e?JSON.stringify(e.customParameters):void 0,R="apiKey"in e?e.apiKey:void 0;e="stream"===e.type?`${JSON.stringify(e.geometryDefinition)}${e.definitionExpression}`:
null;const Q=JSON.stringify(this.clips),W=this._effectiveFeatureReduction?.toJSON(),X="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),Z="sublayers"in this.layer&&this.layer.sublayers.items.reduce((Y,S)=>Y+`${S.visible?1:0}.${JSON.stringify(S.renderer)}.${S.labelsVisible}\n.${JSON.stringify(S.labelingInfo)}`,"");return JSON.stringify({orderBy:X,sublayerHash:Z,subtypeCode:"subtypeCode"in this.layer&&this.layer.subtypeCode,filterHash:null!=this.filter&&this.filter.toJSON(),effectHash:null!=
this.featureEffect&&this.featureEffect.toJSON(),streamFilter:e,gdbVersion:I,definitionExpression:C,historicMoment:P,availableFields:a,renderer:G,labelingInfo:D,timeExtent:L,floors:v,clipsHash:Q,featureReduction:W,customParameters:O,apiKey:R,timeZone:this.view.timeZone})}highlight(a){let e;a instanceof d?e=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?e=[a]:n.isCollection(a)&&0<a.length?e=a.map(C=>C?.getObjectId()).toArray():Array.isArray(a)&&0<a.length&&(e="number"===typeof a[0]||"string"===
typeof a[0]?a:a.map(C=>C?.getObjectId()));const v=e?.filter(k.isSome);if(!v?.length)return l.makeHandle();this._addHighlight(v);return l.makeHandle(()=>this._removeHighlight(v))}hasHighlight(){return!!this._highlightIds.size}async hitTest(a,e){if(!this.tileRenderer)return null;e=await this.tileRenderer.hitTest(e);if(0===e.length)return null;c("featurelayer-force-marker-text-draw-order")&&e.sort((D,G)=>D-G);const {features:v,aggregates:C}=await this._proxy.getFeatures(e);return[...C.map(D=>this._createGraphicHit(a,
q.fromJSON(D))),...v.map(D=>this._createGraphicHit(a,d.fromJSON(D)))]}queryStatistics(){return this._proxy.queryStatistics()}async querySummaryStatistics(a,e,v){e={...e,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(a),e,v)}async queryAggregateSummaryStatistics(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryAggregateSummaryStatistics(this._cleanUpAggregateQuery(a),e,v)}async queryUniqueValues(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(a),
e,v)}async queryAggregateUniqueValues(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryAggregateUniqueValues(this._cleanUpAggregateQuery(a),e,v)}async queryClassBreaks(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(a),e,v)}async queryAggregateClassBreaks(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryAggregateClassBreaks(this._cleanUpAggregateQuery(a),e,v)}async queryHistogram(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(a),
e,v)}async queryAggregateHistogram(a,e,v){e={...e,scale:this.view.scale};return this._proxy.queryAggregateHistogram(this._cleanUpAggregateQuery(a),e,v)}queryFeatures(a,e){return this.queryFeaturesJSON(a,e).then(v=>{v=H.fromJSON(v);v.features.forEach(C=>this._setLayersForFeature(C));return v})}queryVisibleFeatures(a,e){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),e).then(v=>{v=H.fromJSON(v);v.features.forEach(C=>this._setLayersForFeature(C));return v})}async queryAggregates(a,e){a=
await this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),e);a=E.fromJSON(a);a.features.forEach(v=>this._setLayersForFeature(v));return a}queryAggregateIds(a,e){return this._proxy.queryAggregateIds(this._cleanUpAggregateQuery(a),e)}queryAggregateCount(a,e){return this._proxy.queryAggregateCount(this._cleanUpAggregateQuery(a),e)}queryAggregateJSON(a,e){return this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),e)}queryFeaturesJSON(a,e){return this._proxy.queryFeatures(this._cleanUpQuery(a),
e)}queryObjectIds(a,e){return this._proxy.queryObjectIds(this._cleanUpQuery(a),e)}queryFeatureCount(a,e){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),e)}queryExtent(a,e){return this._proxy.queryExtent(this._cleanUpQuery(a),e).then(v=>({count:v.count,extent:ka.fromJSON(v.extent)}))}setVisibility(a,e){e?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()}update(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:e,added:v,removed:C}=this._tileStrategy.update(a);
(v.length||C.length)&&this._proxy.updateTiles({added:v,removed:C});e&&this.requestUpdate();this.notifyChange("updating")}}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new ea.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.addAttachHandles(t.watch(()=>this.renderingConfigHash,()=>this._update(),t.initial));"stream"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",
a=>this._edit(a)))}detach(){this._commandsQueue.clear();this._proxy?.stop();this.container.removeAllChildren();this.tileRenderer?.uninstall(this.container);this.tileRenderer=null;this._tileStrategy=g.destroyMaybe(this._tileStrategy);this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const a="renderer"in this.layer&&null!=this.layer.renderer,e=this._commandsQueue.updating,v=null!=this._updatingRequiredFieldsPromise,
C=!this._proxy||!this._proxy.isReady,D=this._pipelineIsUpdating,G=null==this.tileRenderer||this.tileRenderer?.updating,I=a&&(e||v||C||D||this.dataUpdating||G);c("esri-2d-log-updating")&&console.log(`Updating FLV2D (${this.layer.id}): ${I}\n  -> hasRenderer ${a}\n  -> hasPendingCommand ${e}\n  -> updatingRequiredFields ${v}\n  -> updatingProxy ${C}\n  -> updatingPipeline ${D}\n  -> updatingData: ${this.dataUpdating}\n  -> updatingTileRenderer ${G}\n`);return I}_createClientOptions(){return{setUpdating:a=>
{this._set("_pipelineIsUpdating",a)},setDataUpdating:a=>{this._set("dataUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}}async _detectQueryMode(a){a="path"in a;const {layer:e}=this;var v="refreshInterval"in e&&!!e.refreshInterval;v=!("editingInfo"in e&&e.editingInfo?.lastEditDate)&&v;const C=u.getEffectiveLayerCapabilities(e);if(a&&("feature"===e.type||"subtype-group"===e.type)&&"point"===e.geometryType&&C?.query.supportsPagination&&!C?.operations.supportsEditing&&!v&&c("featurelayer-snapshot-enabled"))try{const I=
await e.queryFeatureCount();var D=c("featurelayer-snapshot-point-min-threshold");if(I<=D)return{mode:"snapshot",featureCount:I};const P=c("featurelayer-snapshot-point-max-threshold"),L=c("featurelayer-snapshot-point-coverage"),O=this.view.extent;var G=e.fullExtent;D=G?.clone().intersection(O);const R=null!=D?D.width*D.height:0;G=G?.width*G?.height;if(I<=P&&(0===G?0:R/G)>=L)return{mode:"snapshot",featureCount:I}}catch(I){h.getLogger(this).warn("mapview-feature-layer","Encountered an error when querying for featureCount",
{error:I})}return{mode:"on-demand"}}async _createServiceOptions(){const a=this.layer;if("stream"===a.type)return null;const e=u.getEffectiveLayerCapabilities(a),{capabilities:v,objectIdField:C}=a,D=a.fieldsIndex.toJSON(),G=D.fields,I=null!=a.fullExtent?a.fullExtent.toJSON():null,P=na(a),L="timeInfo"in a&&a.timeInfo?.toJSON()||null,O=a.spatialReference?a.spatialReference.toJSON():null,R="feature"===a.type?a.globalIdField:null;let Q;"ogc-feature"===a.type?Q=a.source.getSource():aa(a.source)?Q=await a.source.openPorts():
a.parsedUrl&&(Q=b.clone(a.parsedUrl),"dynamicDataSource"in a&&a.dynamicDataSource&&(Q.query={layer:JSON.stringify({source:a.dynamicDataSource})}));const W="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone,X=("subtypeField"in this.layer?this.layer.subtypeField:null)??null,{mode:Z,featureCount:Y}=await this._detectQueryMode(Q);let S=this.layer.objectIdField;if("feature"===this.layer.type&&null!=this.layer.orderBy&&this.layer.orderBy.length){const V=!this.layer.orderBy[0].valueExpression&&
this.layer.orderBy[0].field;V&&(S=V)}return{type:Z,typeIdField:"typeIdField"in a&&a.typeIdField||void 0,types:"types"in a&&a.types?.map(V=>V.toJSON())||void 0,timeReferenceUnknownClient:W,subtypeField:X,featureCount:Y,globalIdField:R,maxRecordCount:v.query.maxRecordCount,tileMaxRecordCount:v.query.tileMaxRecordCount,capabilities:v,effectiveCapabilities:e,fields:G,fieldsIndex:D,fullExtent:I,geometryType:P,objectIdField:C,source:Q,timeInfo:L,spatialReference:O,orderByFields:S}}async _createMemoryServiceOptions(a){a=
await a.openPorts();return{...this._createServiceOptions(),type:"memory",source:a}}_cleanUpQuery(a){a=J.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a}_cleanUpAggregateQuery(a){a=J.from(a)||this.createAggregateQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(a){if(this.suspended)this._clearTiles();else if(this._validateEdit(a))return this._commandsQueue.push({type:"edit",
edits:a})}async doRefresh(a){if(this.attached&&this._tileStrategy.tileKeys().length){if(!this.suspended||!a)return this._commandsQueue.push({type:"refresh",dataChanged:a});this._clearTiles()}}_clearTiles(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}_validateEdit(a){const e="globalIdField"in this.layer&&this.layer.globalIdField,v=a.deletedFeatures.some(D=>
-1===D.objectId||!D.objectId),C=e&&this.availableFields.includes(e);return v&&!C?(h.getLogger(this).error(new w("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${e} to be included the layer's outFields for updates to be reflected on the map`)),null):a}async _doUpdate(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:a,filter:e}=this;await this._updateRequiredFields();if(!this.destroyed){var {renderer:v}=
this._getEffectiveRenderer();this._set("_effectiveRenderer",v);var C=this._createSchemaConfig(),D=this._createConfiguration(C,e,a.filter),G=this._lastDefinitionExpression!==D.schema.source.definitionExpression;this._lastDefinitionExpression=D.schema.source.definitionExpression;var I=D.schema.tileRenderer,P=this._createTileRendererHash(I);"snapshot"===this._serviceOptions.type&&(D.schema.source.initialFeatureCount=this._serviceOptions.featureCount);if(P!==this._tileRendererHash){this._initTileRenderer(I,
v);const L=this.layer,O="stream"===L.type?await this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(v);"stream"!==L.type&&aa(L.source)&&(O.source=await L.source.openPorts());const R={added:this._tileStrategy.tileKeys(),removed:[]};c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Proxy startup");await this._proxy.startup(this.view.featuresTilingScheme,D,O,R);c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy startup");this.hasHighlight()&&
(c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating highlight"),await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished highlight update"));c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate start");this.tileRenderer.onConfigUpdate(v);c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate end")}else{"snapshot"===this._serviceOptions.type&&G&&(D.schema.source.changedFeatureCount=
await this.layer.queryFeatureCount());c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating proxy");const L=await this._proxy.update(D);c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy update");if(L.mesh||L.targets?.aggregate)c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Locking GPU Uploads"),this._lockGPUUploads();try{c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Applying update to proxy"),await this._proxy.applyUpdate(L),
c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished applying update to proxy")}catch(O){f.isAbortError(O)||h.getLogger(this).error(O)}(L.mesh||L.targets?.aggregate)&&this._unlockGPUUploads();this.tileRenderer.onConfigUpdate(v);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=P;this.tileRenderer.invalidateLabels();this.requestUpdate()}}}catch(L){}}async _doEdit(a){try{await this._proxy.onEdits(a)}catch(e){f.isAbortError(e)}}async _doRefresh(a){this._lockGPUUploads();
try{let e;a&&"snapshot"===this.queryMode&&"queryFeatureCount"in this.layer&&(e=await this.layer.queryFeatureCount());await this._proxy.refresh({dataChanged:a,featureCount:e})}catch(e){f.isAbortError(e)}this._unlockGPUUploads();this._effectiveFeatureReduction&&this._updateClusterSizeVariable()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(a,e){return t.watch(()=>this._aggregateValueRanges,
v=>{this._updateClusterEffectiveRendererSizeVariable(a,e,v);this._needsClusterSizeUpdate=!0;this._uploadsLocked||this._updateClusterSizeVariable()})}async _updateClusterEffectiveRendererSizeVariable(a,e,v){if(a.dynamicClusterSize&&"visualVariables"in a&&a.visualVariables){var C=U.findSizeVV(a.visualVariables);null!=C&&"cluster_count"===C.field&&(C=a.visualVariables.indexOf(C),a.visualVariables[C]=U.createClusterCountSizeVariable(e,v),a=a.clone(),a.dynamicClusterSize=!0,this._set("_effectiveRenderer",
a))}}_getEffectiveRenderer(){var a=this.layer,e="renderer"in a?a.renderer:null;a=this._effectiveFeatureReduction;this._updateClusterSizeTask=g.removeMaybe(this._updateClusterSizeTask);if(a&&"renderer"in a&&a.renderer&&!a.renderer.authoringInfo?.isAutoGenerated){var v=a.fields;if("cluster"===a.type){const {renderer:C,didInject:D}=U.injectDynamicLevelDependentSizeVisualVariable(a.renderer,a,this._aggregateValueRanges);D&&(this._updateClusterSizeTask=this._createUpdateClusterSizeTask(C,a));return{renderer:C,
aggregateFields:v,featureReduction:a}}return{renderer:a.renderer,aggregateFields:v,featureReduction:a}}return a&&"cluster"===a.type&&e&&U.isClusterCompatibleRenderer(e)?(v=[],e=U.createClusterRenderer(v,e,a,this._aggregateValueRanges,!0),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(e,a),{renderer:e,aggregateFields:v,featureReduction:a}):{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});
return a}_releaseTile(a){this.tileRenderer.releaseTile(a)}_initTileRenderer(a,e){a=N.createOrReuseTileRenderer(a,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer=g.destroyMaybe(this.tileRenderer));if(this.destroyed)return null;this._proxy.tileRenderer=a;this._set("tileRenderer",a);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(e);this.requestUpdate();
return this.tileRenderer}_createTileRendererHash(a){return`${a.type}`}get hasFilter(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(a){var e=null!=a?a.timeExtent:null;e=null!=this.timeExtent&&null!=e?this.timeExtent.intersection(e):this.timeExtent||e;let v=null;const C="floorInfo"in this.layer&&this.layer.floorInfo;C&&(v=this._addFloorFilterClause(null!=
a?a.where:null));if(!this._visibilityOverrides.size&&!e&&!C)return null!=a?a.toJSON():null;a=null!=a&&a.clone()||new p;a.timeExtent=e;v&&(a.where=v);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a}_addFloorFilterClause(a){var e=this.layer;a=a||"";if("floorInfo"in e&&e.floorInfo){var v=this.view.floors;if(!v?.length)return a;e.floorInfo.viewAllLevelIds?.length&&(v=e.floorInfo.viewAllLevelIds);v=v.filter(C=>""!==C).map(C=>"'"+C+"'");v.push("''");e=e.floorInfo.floorField;v=("("+
e+" IN ({ids}) OR "+e+" IS NULL)").replace("{ids}",v.join(", "));if(null!=a&&a.includes(e)){let C=new RegExp("AND \\("+e+".*NULL\\)","g");a=a.replace(C,"");C=new RegExp("\\("+e+".*NULL\\)","g");a=a.replace(C,"");a=a.replaceAll(/\s+/g," ").trim()}a=""!==a?"("+a+") AND "+v:v}return""!==a?a:null}_createConfiguration(a,e,v){const C="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,D="feature"===this.layer.type?this.layer.gdbVersion??void 0:void 0,G=Array(K.maxFilters);
e=this._injectOverrides(e);G[0]=e;G[1]=null!=v?v.toJSON():null;a=F.createSchema(a);if(null==a)return null;v=ja.getWebGLCapabilities("2d");return{availableFields:this.availableFields,gdbVersion:D,historicMoment:C,devicePixelRatio:window.devicePixelRatio||1,filters:G,schema:a,supportsTextureFloat:v.supportsTextureFloat,maxTextureSize:v.maxTextureSize,timeZone:this.view.timeZone}}_hasRequiredSupport(a){return"renderer"in a?T.isRendererSupported(a.renderer):!0}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=
!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){const a=this.layer;return{renderer:"renderer"in a?a.renderer:null,spatialReference:a.spatialReference,timeExtent:"timeExtent"in a?a.timeExtent:null,definitionExpression:a.definitionExpression,featureReduction:this._effectiveFeatureReduction,
fields:a.fields,geometryType:a.geometryType,historicMoment:"historicMoment"in a?a.historicMoment:null,labelsVisible:"labelsVisible"in a&&a.labelsVisible,labelingInfo:"labelingInfo"in a?a.labelingInfo:null,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"gdbVersion"in a?a.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in a&&a.orderBy?a.orderBy:null,customParameters:{...("customParameters"in a?a.customParameters:void 0),token:"apiKey"in a?a.apiKey??
void 0:void 0},subtypeCode:"subtypeCode"in a?a.subtypeCode:void 0,subtypeField:"subtypeField"in a?a.subtypeField:void 0}}_addHighlight(a){for(const e of a)this._highlightIds.has(e)?(a=this._highlightIds.get(e),this._highlightIds.set(e,a+1)):this._highlightIds.set(e,1);this._updateHighlight().catch(e=>{f.isAbortError(e)||h.getLogger(this).error(e)})}_removeHighlight(a){for(const e of a)this._highlightIds.has(e)&&(a=this._highlightIds.get(e)-1,0===a?this._highlightIds.delete(e):this._highlightIds.set(e,
a));this._updateHighlight().catch(e=>{f.isAbortError(e)||h.getLogger(this).error(e)})}_setLayersForFeature(a){const e=this.layer;a.layer=e;a.sourceLayer=e}_createGraphicHit(a,e){this._setLayersForFeature(e);null!=e.geometry&&(e.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:e,layer:this.layer,mapPoint:a}}};m.__decorate([y.property()],r.prototype,"_serviceOptions",void 0);m.__decorate([y.property()],r.prototype,"_proxy",void 0);m.__decorate([y.property()],r.prototype,
"_pipelineIsUpdating",void 0);m.__decorate([y.property()],r.prototype,"_effectiveRenderer",void 0);m.__decorate([y.property()],r.prototype,"_effectiveFeatureReduction",null);m.__decorate([y.property()],r.prototype,"_aggregateValueRanges",void 0);m.__decorate([y.property()],r.prototype,"_commandsQueue",void 0);m.__decorate([y.property()],r.prototype,"featureEffectView",void 0);m.__decorate([y.property()],r.prototype,"labelsVisible",null);m.__decorate([y.property()],r.prototype,"labelingCollisionInfos",
null);m.__decorate([y.property({readOnly:!0})],r.prototype,"queryMode",null);m.__decorate([y.property()],r.prototype,"renderingConfigHash",null);m.__decorate([y.property()],r.prototype,"tileRenderer",void 0);m.__decorate([y.property()],r.prototype,"updating",void 0);return r=m.__decorate([B.subclass("esri.views.2d.layers.FeatureLayerView2D")],r)});