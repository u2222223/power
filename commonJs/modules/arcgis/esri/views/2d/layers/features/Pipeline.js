// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t){var v;q=new q.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});x=v=class extends x.JSONSupport{static create(y={}){const {resolutionFactor:h=1,scales:A,size:E=256,spatialReference:z=p.WebMercator,numLODs:F=24}=y;if(!d.isValid(z)){y=[];if(A)for(var D=0;D<A.length;D++){var B=
A[D];y.push(new n({level:D,scale:B,resolution:B}))}else for(D=5E-4,B=F-1;0<=B;B--)y.unshift(new n({level:B,scale:D,resolution:D})),D*=2;return new v({dpi:96,lods:y,origin:new b(0,0,z),size:[E,E],spatialReference:z})}D=d.getInfo(z);y=y.origin?new b({x:y.origin.x,y:y.origin.y,spatialReference:z}):D?new b({x:D.origin[0],y:D.origin[1],spatialReference:z}):new b({x:0,y:0,spatialReference:z});D=1/(39.37*w.getMetersPerUnitForSR(z)*96);B=[];if(A)for(var u=0;u<A.length;u++){var H=A[u];B.push(new n({level:u,
scale:H,resolution:H*D}))}else{var G=d.isGeographic(z)?512/E*5.916575275917094E8:256/E*5.91657527591555E8;u=Math.ceil(F/h);B.push(new n({level:0,scale:G,resolution:G*D}));for(H=1;H<u;H++)G/=2**h,B.push(new n({level:H,scale:G,resolution:G*D}))}return new v({dpi:96,lods:B,origin:y,size:[E,E],spatialReference:z})}constructor(y){super(y);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:y,origin:h}=this;if(y&&h){const A=d.getInfo(y);return y.isWrappable&&
!!A&&Math.abs(A.origin[0]-h.x)<=A.dx}return!1}readOrigin(y,h){return b.fromJSON({spatialReference:h.spatialReference,...y})}set lods(y){const h=[],A=this._levelToLOD={};y&&y.forEach(E=>{h.push(E.scale);A[E.level]=E});this._set("scales",h);this._set("lods",y);this._initializeUpsampleLevels()}readSize(y,h){return[h.cols,h.rows]}writeSize(y,h){h.cols=y[0];h.rows=y[1]}zoomToScale(y){const h=this.scales;if(0>=y)return h[0];if(y>=h.length-1)return h[h.length-1];const A=Math.floor(y);return h[A]/(h[A]/h[A+
1])**(y-A)}scaleToZoom(y){const h=this.scales,A=h.length-1;let E=0;for(;E<A;E++){const z=h[E],F=h[E+1];if(z<=y)break;if(F===y)return E+1;if(z>y&&F<y)return E+Math.log(z/y)/Math.log(z/F)}return E}snapScale(y,h=.95){y=this.scaleToZoom(y);return y%Math.floor(y)>=h?this.zoomToScale(Math.ceil(y)):this.zoomToScale(Math.floor(y))}tileAt(y,h,A,E){var z=this.lodAt(y);if(!z)return null;let F;if("number"===typeof h)F=h,h=A;else{if(d.equals(h.spatialReference,this.spatialReference))F=h.x,h=h.y;else{E=a.project(h,
this.spatialReference);if(null==E)return null;F=E.x;h=E.y}E=A}A=z.resolution*this.size[0];z=z.resolution*this.size[1];E||(E=new t.TileKey(null,0,0,0,c.create()));E.level=y;E.row=Math.floor((this.origin.y-h)/z+.001);E.col=Math.floor((F-this.origin.x)/A+.001);this.updateTileInfo(E);return E}updateTileInfo(y,h=v.ExtrapolateOptions.NONE){var A=this.lodAt(y.level);A||h!==v.ExtrapolateOptions.POWER_OF_TWO||(h=this.lods[this.lods.length-1],h.level<y.level&&(A=h));if(A){var E=y.level-A.level;h=A.resolution*
this.size[0]/2**E;A=A.resolution*this.size[1]/2**E;y.id=`${y.level}/${y.row}/${y.col}`;y.extent||(y.extent=c.create());y.extent[0]=this.origin.x+y.col*h;y.extent[1]=this.origin.y-(y.row+1)*A;y.extent[2]=y.extent[0]+h;y.extent[3]=y.extent[1]+A}}upsampleTile(y){const h=this._upsampleLevels[y.level];if(!h||-1===h.parentLevel)return!1;y.level=h.parentLevel;y.row=Math.floor(y.row/h.factor+.001);y.col=Math.floor(y.col/h.factor+.001);this.updateTileInfo(y);return!0}getTileBounds(y,h){var A=this.lodAt(h.level);
if(null==A)return null;var {resolution:E}=A;A=E*this.size[0];E*=this.size[1];y[0]=this.origin.x+h.col*A;y[1]=this.origin.y-(h.row+1)*E;y[2]=y[0]+A;y[3]=y[1]+E;return y}lodAt(y){return this._levelToLOD?.[y]??null}clone(){return v.fromJSON(this.write({}))}getOrCreateCompatible(y,h){if(256===this.size[0]&&256===this.size[1])return 256===y?this:null;const A=[],E=this.lods.length;for(let z=0;z<E;z++){const F=this.lods[z];A.push(new n({level:F.level,scale:F.scale,resolution:F.resolution*h}))}return new v({size:[y,
y],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:A})}_initializeUpsampleLevels(){const y=this.lods;this._upsampleLevels=[];let h=null;for(let A=0;A<y.length;A++){const E=y[A];this._upsampleLevels[E.level]={parentLevel:h?h.level:-1,factor:h?h.resolution/E.resolution:0};h=E}}};g.__decorate([C.property({type:Number,json:{write:!0}})],x.prototype,"compressionQuality",void 0);g.__decorate([C.property({type:Number,
json:{write:!0}})],x.prototype,"dpi",void 0);g.__decorate([C.property({type:String,json:{read:q.read,write:q.write,origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"format",void 0);g.__decorate([C.property({readOnly:!0})],x.prototype,"isWrappable",null);g.__decorate([C.property({type:b,json:{write:!0}})],x.prototype,"origin",void 0);g.__decorate([f.reader("origin")],x.prototype,"readOrigin",null);g.__decorate([C.property({type:[n],value:null,json:{write:!0}})],x.prototype,"lods",null);g.__decorate([C.property({readOnly:!0})],
x.prototype,"scales",void 0);g.__decorate([C.property({cast:y=>Array.isArray(y)?y:"number"===typeof y?[y,y]:[256,256]})],x.prototype,"size",void 0);g.__decorate([f.reader("size",["rows","cols"])],x.prototype,"readSize",null);g.__decorate([l.writer("size",{cols:{type:r.Integer},rows:{type:r.Integer}})],x.prototype,"writeSize",null);g.__decorate([C.property({type:p,json:{write:!0}})],x.prototype,"spatialReference",void 0);x=v=g.__decorate([e.subclass("esri.layers.support.TileInfo")],x);(function(y){y=
y.ExtrapolateOptions||(y.ExtrapolateOptions={});y[y.NONE=0]="NONE";y[y.POWER_OF_TWO=1]="POWER_OF_TWO"})(x||(x={}));return x})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m){var k;q=k=class extends q.JSONSupport{constructor(f){super(f);this.cols=null;this.level=
0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new k({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};g.__decorate([x.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"cols",void 0);g.__decorate([x.property({type:w.Integer,json:{write:!0}})],q.prototype,"level",void 0);g.__decorate([x.property({type:String,json:{write:!0}})],
q.prototype,"levelValue",void 0);g.__decorate([x.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"origin",void 0);g.__decorate([x.property({type:Number,json:{write:!0}})],q.prototype,"resolution",void 0);g.__decorate([x.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"rows",void 0);g.__decorate([x.property({type:Number,json:{write:!0}})],q.prototype,"scale",void 0);
return q=k=g.__decorate([m.subclass("esri.layers.support.LOD")],q)})},"esri/layers/support/TileKey":function(){define(["exports"],function(g){class q{constructor(x,w,C,r,m){this.id=x;this.level=w;this.row=C;this.col=r;this.extent=m}}g.TileKey=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processors":function(){define(["require","exports"],function(g,q){const x=w=>Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"}));
q.loadProcessorModule=function(w){return"heatmap"===w?new Promise((C,r)=>g(["./processors/HeatmapProcessor"],m=>C(x(m)),r)):new Promise((C,r)=>g(["./processors/SymbolProcessor"],m=>C(x(m)),r))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/controllers/FeatureController2D":function(){define("../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/support/UpdatingHandles ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/data/QueryEngine ../../../../../layers/support/FieldsIndex ../../../../../time/timeZoneUtils ../FeatureStore2D ../sources/createSource ../support/AttributeStore ../support/BinStore ../support/ClusterStore ../support/ComputedAttributeStorage ../support/FeatureSetReaderJSON ../support/UpdateToken ../../../../support/QueueProcessor".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E){function z(D){if(!C.isAbortError(D)&&"worker:port-closed"!==D.name)throw D;}function F(D){return"feature"===D.type&&"snapshot"===D.mode}q=class extends q{constructor(){super(...arguments);this._storage=new y.ComputedAttributeStorage;this._markedIdsBufId=this._storage.createBitset();this._lastCleanup=performance.now();this._invalidated=this._cleanupNeeded=!1;this._tileToResolver=new Map;this._didEdit=!1;this._updateVersion=1;this._updatingHandles=
new e.UpdatingHandles;this.service=this.remoteClient=this.processor=this.config=this.tileStore=null}initialize(){this._initStores();this._initSource();this._updateQueue=new E.QueueProcessor({concurrency:"stream"===this._source.type?1:4,process:(D,B)=>this._onTileMessage(D,{signal:B})});this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this)),r.when(()=>!this.updating,()=>this.onIdle())])}_initSource(){this._source=a.createSource(this.service,{...this.service,fieldsIndex:this.fieldsIndex},
this.spatialReference,this.tileStore.tileScheme,(D,B)=>{this._invalidated=!0;return this._patchTile(D,B)},()=>this._updateQueue&&50>this._updateQueue.length,this.featureStore);this._proxyEvents()}_setStreamClientProperty(D,B){this.remoteClient.invoke("setProperty",{propertyName:D,value:B}).catch(z)}_proxyEvents(){if("stream"===this._source.type){const D=this._source.events,B=this._source;this.addHandles([r.watch(()=>B.connectionStatus,u=>this._setStreamClientProperty("pipelineConnectionStatus",u),
{initial:!0}),r.watch(()=>B.errorString,u=>this._setStreamClientProperty("pipelineErrorString",u),{initial:!0}),D.on("data-received",u=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:u.attributes,centroid:u.centroid,geometry:u.geometry}}).catch(z)),D.on("message-received",u=>this.remoteClient.invoke("emitEvent",{name:"message-received",event:u}).catch(z)),D.on("updateRate",u=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...u}}).catch(z))])}}_initAttributeStore(D){this.attributeStore||
(this.attributeStore=new n({type:"remote",initialize:(B,u)=>C.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",B,{signal:u}).catch(z)),update:(B,u)=>C.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",B,{signal:u}).catch(z)),render:B=>C.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:B}).catch(z))},D))}_initStores(){this.featureStore=new d.FeatureStore2D({geometryInfo:{geometryType:this.service.geometryType,
hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex},this._storage,"snapshot"===this.service.type?"snapshot":"on-demand")}_initQueryEngine(D){const B=this;this.featureQueryEngine?.destroy();this.featureQueryEngine=new b.QueryEngine({availableFields:D.availableFields,definitionExpression:D.schema.source.definitionExpression??void 0,fieldsIndex:p.fromJSON(this.service.fieldsIndex),geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,
hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds(u){return null==B.aggregateStore?[]:B.aggregateStore.getFeatureDisplayIdsForAggregate(u).map(H=>B.getObjectId(H))}},timeInfo:this.service.timeInfo})}_initAggregateQueryEngine(D,B){this.aggregateQueryEngine?.destroy();null!=D&&(B=B.targets.aggregate.params.fields.slice(),this.aggregateQueryEngine=new b.QueryEngine({definitionExpression:void 0,fieldsIndex:p.fromLayerJSON({fields:B,
dateFieldsTimeReference:{timeZoneIANA:c.utc}}),geometryType:D.geometryInfo.geometryType,objectIdField:D.objectIdField,hasM:D.geometryInfo.hasM,hasZ:D.geometryInfo.hasZ,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!1,featureStore:D,aggregateAdapter:{getFeatureObjectIds(u){return[]}}}))}destroy(){this._updateQueue.destroy();this._source.destroy();this.featureQueryEngine?.destroy();this.aggregateQueryEngine?.destroy();this.attributeStore?.destroy();for(const D of this.tileStore.tiles)this._source.unsubscribe(D);
clearInterval(this._checkUpdating);this._updatingHandles.destroy()}get fieldsIndex(){return p.fromJSON(this.service.fieldsIndex)}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get dataUpdating(){return this._source.updatingHandles.updating}get updating(){return this.isUpdating()}isUpdating(){var D=this._source.updatingHandles.updating;const B=!this.attributeStore||this.attributeStore.updatingHandles.updating,u=D||B||this._updatingHandles.updating;if(w("esri-2d-log-updating")){D=
`Updating FeatureController2D: ${u}\n`+`  -> updatingSource ${D}\n`;for(const H of this._source.subscriptions)D+=`     ${H.tile.id} ${H.isDone}\n`;D=D+`  -> updatingAttributeStore ${B}\n`+`  -> updatingHandles ${this._updatingHandles.updating} (queue: ${this._updateQueue.length})\n`;console.log(D)}return u}updateCustomParameters(D){"stream"===this._source.type&&this._source.updateCustomParameters(D)}enableEvent(D){this._source.enableEvent(D.name,D.value)}pause(){this._updateQueue.pause();this._updateQueue.clear()}resume(){this._updateQueue.resume()}pauseStream(){"stream"===
this._source.type&&this._source.pauseStream()}resumeStream(){"stream"===this._source.type&&this._source.resumeStream()}sendMessageToSocket(D){"stream"===this._source.type&&this._source.sendMessageToSocket(D)}sendMessageToClient(D){"stream"===this._source.type&&this._source.sendMessageToClient(D)}_initAggregateStore(D){D=D.schema.targets?.aggregate?.type??null;if((this.config?.schema.targets?.aggregate?.type??null)!==D&&(null!=this.aggregateStore&&(this.removeHandles("valueRangesChanged"),this.aggregateStore.destroy(),
this.aggregateStore=null),D)){switch(D){case "cluster":this.aggregateStore=new v.ClusterStore({geometryInfo:{geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},this.spatialReference,this._storage,{...this.service,fieldsIndex:this.fieldsIndex});this.addHandles(this.aggregateStore.events.on("valueRangesChanged",B=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:B.valueRanges}}).catch(z)}),
"valueRangesChanged");break;case "bin":this.aggregateStore=new t.BinStore({geometryInfo:{geometryType:"esriGeometryPolygon",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},this.spatialReference,this._storage,{...this.service,fieldsIndex:this.fieldsIndex})}this.aggregateStore.onTileUpdate({added:this.tileStore.tiles,removed:[]})}}async update(D,B){this._updateVersion++;w("esri-2d-update-debug")&&console.debug(`FeatureController2D::update: Token version ${this._updateVersion}`);
this._initQueryEngine(B);this._initAttributeStore(B);this.pause();this.config?.timeZone!==B.timeZone&&(D.mesh=!0,D.storage.data=!0,D.storage.filters=!0,D.targets.aggregate=!0,D.targets.feature=!0,this.featureStore.invalidate());await Promise.all([this._source.update(D,B.schema.source),this.featureStore.updateSchema(D,B.schema.targets.feature),this.attributeStore.update(D,B),this.attributeStore.updateFilters(D,B,this)]);this._initAggregateStore(B);null!=this.aggregateStore&&await this.aggregateStore.updateSchema(D,
B.schema.targets.aggregate);this._initAggregateQueryEngine(this.aggregateStore,B.schema);w("esri-2d-update-debug")&&D.describe();this._set("config",B)}async applyUpdate(D){D.version=this._updateVersion;w("esri-2d-update-debug")&&console.debug(`FeatureController2D::applyUpdate: Token version ${D.version}`);D.mesh&&this.clearTiles();this._updateQueue.resume();await this._source.applyUpdate(D);w("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Waiting for source update to finish");
this.notifyChange("updating");await r.whenOnce(()=>!this.updating);w("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Source update finsihed");null!=this.aggregateStore&&(await C.after(10),w("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Waiting for aggregate idle call"),await r.whenOnce(()=>!this.updating),w("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Aggregate idle called"));w("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Update finished")}async onEdits({edits:D}){w("esri-2d-update-debug")&&
console.debug("Applying Edit:",D);this._didEdit=!0;try{const B=D.removed.map(H=>H.objectId&&-1!==H.objectId?H.objectId:this._lookupObjectIdByGlobalId(H.globalId)),u=D.addOrModified.map(({objectId:H})=>H);this.featureStore.invalidate();await this._source.edit(u,B);this.clearTiles();this.notifyChange("updating");null!=this.aggregateStore&&this.aggregateStore.clear();await this._source.resend();await r.whenOnce(()=>!this.updating)}catch(B){}}async refresh(D){if(!D.dataChanged)return D=A.UpdateToken.empty(),
D.storage.filters=!0,this.applyUpdate(D);this.featureStore.invalidate();this.clearTiles();this._source.refresh(this._updateVersion,D);this._cleanupNeeded=!0;this.notifyChange("updating");await r.whenOnce(()=>!this.updating)}clearTiles(){for(const D of this.tileStore.tiles)this.processor.onTileClear(D,!1)}onTileUpdate(D){if(null!=this.aggregateStore)this.aggregateStore.onTileUpdate(D);for(const B of D.added){const u=this._source.subscribe(B,this._updateVersion);"stream"!==this._source.type&&this._updatingHandles.addPromise(u.done);
this._level=B.level}for(const B of D.removed)this._source.unsubscribe(B),this._cleanupNeeded=!0,this._tileToResolver.has(B.id)&&(this._tileToResolver.get(B.id).resolve(),this._tileToResolver.delete(B.id));this.notifyChange("updating")}async onIdle(){this._invalidated&&(this._invalidated=!1,null==this.aggregateStore&&"heatmap"!==this.processor.type||await this._repushCurrentLevelTiles());this._markAndSweep()}async querySummaryStatistics({query:D,params:B}){return this.featureQueryEngine.executeQueryForSummaryStatistics(D,
B)}async queryAggregateSummaryStatistics({query:D,params:B}){return this.aggregateQueryEngine.executeQueryForSummaryStatistics(this._normalizeAggregateQuery(D),B)}async queryUniqueValues({query:D,params:B}){return this.featureQueryEngine.executeQueryForUniqueValues(D,B)}async queryAggregateUniqueValues({query:D,params:B}){return this.aggregateQueryEngine.executeQueryForUniqueValues(this._normalizeAggregateQuery(D),B)}async queryClassBreaks({query:D,params:B}){return this.featureQueryEngine.executeQueryForClassBreaks(D,
B)}async queryAggregateClassBreaks({query:D,params:B}){return this.aggregateQueryEngine.executeQueryForClassBreaks(this._normalizeAggregateQuery(D),B)}async queryHistogram({query:D,params:B}){return this.featureQueryEngine.executeQueryForHistogram(D,B)}async queryAggregateHistogram({query:D,params:B}){return this.aggregateQueryEngine.executeQueryForHistogram(this._normalizeAggregateQuery(D),B)}queryExtent(D){return this.featureQueryEngine.executeQueryForExtent(D)}queryAggregates(D){return this.aggregateQueryEngine.executeQuery(this._normalizeAggregateQuery(D))}queryAggregateCount(D){return this.aggregateQueryEngine.executeQueryForCount(this._normalizeAggregateQuery(D))}queryAggregateIds(D){return this.aggregateQueryEngine.executeQueryForIds(this._normalizeAggregateQuery(D))}queryFeatures(D){return this.featureQueryEngine.executeQuery(D)}async queryVisibleFeatures(D){D=
await this.featureQueryEngine.executeQuery(D);const B=D.objectIdFieldName;D.features=D.features.filter(u=>{u=this.getDisplayId(u.attributes[B]);return null!=u&&this.attributeStore.isVisible(u)});return D}queryFeatureCount(D){return this.featureQueryEngine.executeQueryForCount(D)}queryLatestObservations(D){return this.featureQueryEngine.executeQueryForLatestObservations(D)}queryObjectIds(D){return this.featureQueryEngine.executeQueryForIds(D)}async queryStatistics(){return this.featureStore.storeStatistics}getObjectId(D){return this.featureStore.lookupObjectId(D,
this._storage)}getDisplayId(D){if(null!=this.aggregateStore){const B=this.aggregateStore.getDisplayId(D);return null==B?(D=this.featureStore.lookupDisplayId(D),this.aggregateStore.getDisplayIdForReferenceId(D)):B}return this.featureStore.lookupDisplayId(D)}getFeatures(D){const B=[],u=[];for(const H of D)D=null!=this.aggregateStore?this.getAggregate(H):null,null!=D?null!=D.attributes.referenceId?(D=this.getFeature(D.attributes.referenceId),null!=D&&B.push(D)):u.push(D):(D=this.getFeature(H),null!=
D&&B.push(D));return{features:B,aggregates:u}}getFeature(D){D=this.featureStore.lookupFeatureByDisplayId(D,this._storage);if(null==D)return null;var B=D.readHydratedGeometry();B=l.convertToGeometry(B,D.geometryType,D.hasZ,D.hasM);return{attributes:D.readAttributes(),geometry:B}}getAggregate(D){return null==this.aggregateStore?null:this.aggregateStore.getAggregate(D)}getAggregates(){return null==this.aggregateStore?[]:this.aggregateStore.getAggregates()}async setHighlight(D){const B=D.map(u=>this.getDisplayId(u)).filter(x.isSome);
return this.attributeStore.setHighlight(D,B)}_normalizeAggregateQuery(D){const B=D.objectIds??[];for(const u of D.aggregateIds??[])B.push(u);D.objectIds=B;D.aggregateIds=[];return D}_lookupObjectIdByGlobalId(D){const B=this.service.globalIdField;if(null==B)throw Error("Expected globalIdField to be defined");let u=null;this.featureStore.forEach(H=>{D===H.readAttribute(B)&&(u=H.getObjectId())});if(null==u)throw Error(`Expected to find a feature with globalId ${D}`);return u}async _repushCurrentLevelTiles(){var D=
this.tileStore.tiles.filter(B=>B.level===this._level);D.map(async B=>this._patchTile({type:"append",id:B.key.id,clear:!0,addOrUpdate:null,end:!1}));D=D.map(async B=>this._patchTile({type:"append",id:B.key.id,addOrUpdate:h.FeatureSetReaderJSON.fromOptimizedFeatures([],{...this.service,fieldsIndex:this.fieldsIndex}),remove:[],end:!0,isRepush:!0,status:A.UpdateToken.empty()}));await Promise.all(D)}_maybeForceCleanup(){5E3<performance.now()-this._lastCleanup&&this._markAndSweep()}_patchTile(D,B){D=this._updateQueue.push(D,
B).catch(u=>{});return this._updatingHandles.addPromise(D)}async _onTileMessage(D,B){C.throwIfAborted(B);w("esri-2d-update-debug")&&console.debug(D.id,`FeatureController:onTileMessage: [clear:${D.clear}, end:${D.end}, features: ${D.addOrUpdate?.hasFeatures}]`);const u=this.tileStore.get(D.id);if(u){if(D.clear)return this.processor.onTileClear(u,D.end);var H=D.status;this._cleanupNeeded=!0;var G=[];for(const I of D.remove??[]){const J=this.featureStore.lookupDisplayId(I);J&&G.push(J)}D.remove=G;try{if(null==
D.addOrUpdate)this.processor.onTileMessage(u,{...D,addOrUpdate:null},null!=this.aggregateStore,B).catch(C.throwIfNotAbortError);else{D.addOrUpdate.setArcadeSpatialReference(this.spatialReference);this.featureStore.hasInstance(D.addOrUpdate.instance)&&H.targets.feature||(H.targets.feature=!0,this.featureStore.onTileData(u,D,this.config?.timeZone));H.storage.data&&H.storage.filters||(H.storage.data=!0,H.storage.filters=!0,this.attributeStore.onTileData(u,D),"stream"===this._source.type||this._didEdit?
(await this.attributeStore.sendUpdates(),C.throwIfAborted(B)):this.attributeStore.sendUpdates());if(null!=this.aggregateStore&&!H.targets.aggregate){H.targets.aggregate=!0;const I=F(this._source)&&this._source.loading,J=!F(this._source)||I||D.end;this.aggregateStore.onTileData(u,D,this._storage,this.attributeStore,this.config?.timeZone,J);if(!J)return;H.mesh||(this.attributeStore.onTileData(u,D),await this.attributeStore.sendUpdates())}H.mesh||(H.mesh=!0,await this.processor.onTileMessage(u,D,null!=
this.aggregateStore&&"cluster"===this.aggregateStore.type,B),C.throwIfAborted(B));this._maybeForceCleanup()}}catch(I){C.throwIfNotAbortError(I)}}}_mark(D,B,u){const H=this._storage.getInstanceId(D);D&&(B.add((4294901760&H)>>>16),u.set(D))}_markAndSweep(){this._lastCleanup=performance.now();if(!("feature"===this._source.type&&"snapshot"===this._source.mode||"stream"!==this._source.type&&!this._cleanupNeeded)){this._cleanupNeeded=!1;var D=this._storage.getBitset(this._markedIdsBufId),B=new Set;D.clear();
for(const H of this.tileStore.tiles)for(const G of this._source.readers(H.id)){const I=G.getCursor();for(;I.next();){var u=I.getDisplayId();u||(u=I.getObjectId(),u=this.featureStore.lookupDisplayId(u));this._mark(u,B,D)}}"symbol"===this.processor.type&&this.processor.forEachBufferId(H=>{this._mark(H,B,D)});this._updateQueue.forEach(H=>{for(const G of H.remove??[])H=this.featureStore.lookupDisplayId(G),this._mark(H,B,D)});null!=this.aggregateStore&&(this.aggregateStore.sweepFeatures(D,this.featureStore),
"sweepAggregates"in this.aggregateStore&&this.aggregateStore.sweepAggregates(this._storage,this.attributeStore,this._level));this.featureStore.sweepFeatures(D,this._storage,this.attributeStore);this.featureStore.sweepFeatureSets(B)}}};g.__decorate([m.property({constructOnly:!0})],q.prototype,"tileStore",void 0);g.__decorate([m.property()],q.prototype,"config",void 0);g.__decorate([m.property({readOnly:!0})],q.prototype,"fieldsIndex",null);g.__decorate([m.property()],q.prototype,"processor",void 0);
g.__decorate([m.property({constructOnly:!0})],q.prototype,"remoteClient",void 0);g.__decorate([m.property({constructOnly:!0})],q.prototype,"service",void 0);g.__decorate([m.property()],q.prototype,"spatialReference",null);g.__decorate([m.property()],q.prototype,"dataUpdating",null);g.__decorate([m.property()],q.prototype,"updating",null);return q=g.__decorate([f.subclass("esri.views.2d.layers.features.controllers.FeatureController2D")],q)})},"esri/core/support/UpdatingHandles":function(){define("exports ../../chunks/tslib.es6 ../Accessor ../handleUtils ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k){g.UpdatingHandles=class extends x{constructor(){super(...arguments);this.updating=!1;this._scheduleHandleId=this._handleId=0;this._pendingPromises=new Set}destroy(){this.removeAll()}add(f,e,l={}){return this._installWatch(f,e,l,C.watch)}addWhen(f,e,l={}){return this._installWatch(f,e,l,C.when)}addOnCollectionChange(f,e,{initial:l=!1,final:b=!1}={}){const p=++this._handleId;this.addHandles([C.on(f,"after-changes",this._createSyncUpdatingCallback(),C.sync),C.on(f,"change",
e,{onListenerAdd:l?c=>e({added:c.toArray(),removed:[]}):void 0,onListenerRemove:b?c=>e({added:[],removed:c.toArray()}):void 0})],p);return w.makeHandle(()=>this.removeHandles(p))}addPromise(f){if(null==f)return f;const e=++this._handleId;this.addHandles(w.makeHandle(()=>{this._pendingPromises.delete(f)&&(0!==this._pendingPromises.size||this.hasHandles(-42)||this._set("updating",!1))}),e);this._pendingPromises.add(f);this._set("updating",!0);const l=()=>this.removeHandles(e);f.then(l,l);return f}removeAll(){this._pendingPromises.clear();
this.removeAllHandles();this._set("updating",!1)}_installWatch(f,e,l={},b){const p=++this._handleId;l.sync||this._installSyncUpdatingWatch(f,p);f=b(f,e,l);this.addHandles(f,p);return w.makeHandle(()=>this.removeHandles(p))}_installSyncUpdatingWatch(f,e){const l=this._createSyncUpdatingCallback();f=C.watch(f,l,{sync:!0,equals:()=>!1});this.addHandles(f,e);return f}_createSyncUpdatingCallback(){return()=>{this.removeHandles(-42);++this._scheduleHandleId;const f=this._scheduleHandleId;this._get("updating")||
this._set("updating",!0);this.addHandles(r.schedule(()=>{f===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this.removeHandles(-42))}),-42)}}};q.__decorate([m.property({readOnly:!0})],g.UpdatingHandles.prototype,"updating",void 0);g.UpdatingHandles=q.__decorate([k.subclass("esri.core.support.UpdatingHandles")],g.UpdatingHandles);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/maybe ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(g,q,x,w,C,r,m,k,f,e){function l(S,V){return S?V?4:3:V?3:2}function b(S,V,X,ha){if(S){if(X)return V&&ha?T:ua;if(V&&ha)return L}else if(V&&ha)return ua;return ra}function p({scale:S,translate:V},X){return Math.round((X-V[0])/S[0])}function c({scale:S,translate:V},X){return Math.round((V[1]-X)/S[1])}function d({scale:S,translate:V},X,ha){return X*S[ha]+V[ha]}function a(S){S=S.coords;return{x:S[0],y:S[1]}}function n(S,V){S.coords[0]=V.x;S.coords[1]=V.y;return S}function t(S){S=S.coords;return{x:S[0],
y:S[1],z:S[2]}}function v(S,V){S.coords[0]=V.x;S.coords[1]=V.y;S.coords[2]=V.z;return S}function y(S){S=S.coords;return{x:S[0],y:S[1],m:S[2]}}function h(S,V){S.coords[0]=V.x;S.coords[1]=V.y;S.coords[2]=V.m;return S}function A(S){S=S.coords;return{x:S[0],y:S[1],z:S[2],m:S[3]}}function E(S,V){S.coords[0]=V.x;S.coords[1]=V.y;S.coords[2]=V.z;S.coords[3]=V.m;return S}function z(S,V){return S&&V?E:S?v:V?h:n}function F(S,V,X,ha,ja){X=z(X,ha);for(const {geometry:ma,attributes:oa}of V)V=null!=ma?X(new e,ma):
null,S.push(new k.OptimizedFeature(V,oa,null,ja?oa[ja]:void 0));return S}function D(S,V,X,ha){for(const {geometry:ja,attributes:ma}of V)S.push({attributes:ma,geometry:null!=ja?B(ja,X,ha):null});return S}function B(S,V,X){if(null==S)return null;const ha=l(V,X),ja=[];for(let ma=0;ma<S.coords.length;ma+=ha){const oa=[];for(let va=0;va<ha;va++)oa.push(S.coords[ma+va]);ja.push(oa)}return V?X?{points:ja,hasZ:V,hasM:X}:{points:ja,hasZ:V}:X?{points:ja,hasM:X}:{points:ja}}function u(S,V,X,ha,ja){X=l(X,ha);
for(const {geometry:ma,attributes:oa}of V)V=null!=ma?H(new e,ma,X):null,S.push(new k.OptimizedFeature(V,oa,null,ja?oa[ja]:void 0));return S}function H(S,V,X=l(V.hasZ,V.hasM)){S.lengths[0]=V.points.length;const ha=S.coords;let ja=0;for(const ma of V.points)for(V=0;V<X;V++)ha[ja++]=ma[V];return S}function G(S,V,X){if(!S)return null;const ha=l(V,X),{coords:ja,lengths:ma}=S;S=[];let oa=0;for(const va of ma){const xa=[];for(let za=0;za<va;za++){const Aa=[];for(let Ba=0;Ba<ha;Ba++)Aa.push(ja[oa++]);xa.push(Aa)}S.push(xa)}return V?
X?{paths:S,hasZ:V,hasM:X}:{paths:S,hasZ:V}:X?{paths:S,hasM:X}:{paths:S}}function I(S,V,X,ha,ja){X=l(X,ha);for(const {geometry:ma,attributes:oa}of V)V=null!=ma?J(new e,ma,X):null,S.push(new k.OptimizedFeature(V,oa,null,ja?oa[ja]:void 0));return S}function J(S,V,X=l(V.hasZ,V.hasM)){const {lengths:ha,coords:ja}=S;let ma=0;for(const oa of V.paths){for(const va of oa)for(V=0;V<X;V++)ja[ma++]=va[V];ha.push(oa.length)}return S}function M(S,V,X){if(!S)return null;const ha=l(V,X),{coords:ja,lengths:ma}=S;
S=[];let oa=0;for(const va of ma){const xa=[];for(let za=0;za<va;za++){const Aa=[];for(let Ba=0;Ba<ha;Ba++)Aa.push(ja[oa++]);xa.push(Aa)}S.push(xa)}return V?X?{rings:S,hasZ:V,hasM:X}:{rings:S,hasZ:V}:X?{rings:S,hasM:X}:{rings:S}}function R(S,V,X,ha,ja){for(const {geometry:ma,centroid:oa,attributes:va}of V){V=null!=ma?Y(new e,ma,X,ha):null;const xa=ja?va[ja]:void 0;null!=oa?S.push(new k.OptimizedFeature(V,va,n(new e,oa),xa)):S.push(new k.OptimizedFeature(V,va,null,xa))}return S}function Y(S,V,X=V.hasZ,
ha=V.hasM){return fa(S,V.rings,X,ha)}function fa(S,V,X,ha){X=l(X,ha);const {lengths:ja,coords:ma}=S;ha=0;ca(S);for(const oa of V){for(const va of oa)for(V=0;V<X;V++)ma[ha++]=va[V];ja.push(oa.length)}return S}function O(S,V,X,ha,ja,ma){la(S);if(!X){for(const oa of V)S.push(new k.OptimizedFeature(null,oa.attributes,null,ma?oa.attributes[ma]:void 0));return S}switch(X){case "esriGeometryPoint":return F(S,V,ha,ja,ma);case "esriGeometryMultipoint":return u(S,V,ha,ja,ma);case "esriGeometryPolyline":return I(S,
V,ha,ja,ma);case "esriGeometryPolygon":return R(S,V,ha,ja,ma);default:pa.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${X}'`)),la(S)}return S}function Q(S,V,X,ha){S=S&&("coords"in S?S:S.geometry);if(null==S)return null;switch(V){case "esriGeometryPoint":return V=a,X&&ha?V=A:X?V=t:ha&&(V=y),V(S);case "esriGeometryMultipoint":return B(S,X,ha);case "esriGeometryPolyline":return G(S,X,ha);case "esriGeometryPolygon":return M(S,X,ha);default:return pa.error("convertToGeometry:unknown-geometry",
new q(`Unable to parse unknown geometry type '${V}'`)),null}}function Z(S,V,X,ha,ja){la(S);if(null==X){for(const oa of V)S.push({attributes:oa.attributes});return S}switch(X){case "esriGeometryPoint":X=a;ha&&ja?X=A:ha?X=t:ja&&(X=y);for(var ma of V){const {geometry:oa,attributes:va}=ma;ha=null!=oa?X(oa):null;S.push({attributes:va,geometry:ha})}break;case "esriGeometryMultipoint":return D(S,V,ha,ja);case "esriGeometryPolyline":for(const {geometry:oa,attributes:va}of V)S.push({attributes:va,geometry:null!=
oa?G(oa,ha,ja):null});break;case "esriGeometryPolygon":for(const {geometry:oa,attributes:va,centroid:xa}of V)ma=null!=oa?M(oa,ha,ja):null,null!=xa?(V=a(xa),S.push({attributes:va,centroid:V,geometry:ma})):S.push({attributes:va,geometry:ma});break;default:pa.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${X}'`))}return S}function ba(S,V,X,ha,ja,ma,oa=X,va=ha){ca(S);if(!V?.coords.length)return null;ja=na[ja];const {coords:xa,lengths:za}=V;V=l(X,ha);const Aa=
l(X&&oa,ha&&va);X=b(X,ha,oa,va);if(!za.length)return X(S.coords,xa,0,0,p(ma,xa[0]),c(ma,xa[1])),ca(S,V,0),S;let Ba,Ia=0,Da,Ga=0;for(const Fa of za){if(Fa<ja)continue;let Ea=0;Da=Ga;va=ha=p(ma,xa[Ia]);Ba=oa=c(ma,xa[Ia+1]);X(S.coords,xa,Da,Ia,va,Ba);Ea++;Ia+=V;Da+=Aa;for(let La=1;La<Fa;La++,Ia+=V)if(va=p(ma,xa[Ia]),Ba=c(ma,xa[Ia+1]),va!==ha||Ba!==oa)X(S.coords,xa,Da,Ia,va-ha,Ba-oa),Da+=Aa,Ea++,ha=va,oa=Ba;Ea>=ja&&(S.lengths.push(Ea),Ga=Da)}la(S.coords,Ga);return S.coords.length?S:null}function da(S,
V,X,ha,ja,ma,oa){let va=ha,xa=0;for(let Aa=ma+X;Aa<oa;Aa+=X){var za=V[Aa];const Ba=V[Aa+1],Ia=V[oa],Da=V[oa+1];let Ga=V[ma],Fa=V[ma+1],Ea=Ia-Ga,La=Da-Fa;if(0!==Ea||0!==La){const Ua=((za-Ga)*Ea+(Ba-Fa)*La)/(Ea*Ea+La*La);1<Ua?(Ga=Ia,Fa=Da):0<Ua&&(Ga+=Ea*Ua,Fa+=La*Ua)}Ea=za-Ga;La=Ba-Fa;za=Ea*Ea+La*La;za>va&&(xa=Aa,va=za)}va>ha&&(xa-ma>X&&da(S,V,X,ha,ja,ma,xa),ja(S,V,S.length,xa,V[xa],V[xa+1]),oa-xa>X&&da(S,V,X,ha,ja,xa,oa))}function P(S,V,X,ha,ja){const {coords:ma,lengths:oa}=V;X=l(X,ha);if(!ma.length)return S!==
V&&ca(S),S;w.assertIsSome(ja);const {originPosition:va,scale:xa,translate:za}=ja;ja=qa;ja.originPosition=va;ha=ja.scale;ha[0]=xa[0]??1;ha[1]=-(xa[1]??1);ha[2]=xa[2]??1;ha[3]=xa[3]??1;var Aa=ja.translate;Aa[0]=za[0]??0;Aa[1]=za[1]??0;Aa[2]=za[2]??0;Aa[3]=za[3]??0;if(!oa.length){for(ha=0;ha<X;++ha)S.coords[ha]=d(ja,ma[ha],ha);S!==V&&ca(S,X,0);return S}Aa=0;for(let Ia=0;Ia<oa.length;Ia++){const Da=oa[Ia];S.lengths[Ia]=Da;for(var Ba=0;Ba<X;++Ba)S.coords[Aa+Ba]=d(ja,ma[Aa+Ba],Ba);Ba=S.coords[Aa];let Ga=
S.coords[Aa+1];Aa+=X;for(let Fa=1;Fa<Da;Fa++,Aa+=X){Ba+=ma[Aa]*ha[0];Ga+=ma[Aa+1]*ha[1];S.coords[Aa]=Ba;S.coords[Aa+1]=Ga;for(let Ea=2;Ea<X;++Ea)S.coords[Aa+Ea]=d(ja,ma[Aa+Ea],Ea)}}S!==V&&ca(S,ma.length,oa.length);return S}function U(S,V,X,ha){let ja=0,ma=S[ha*V],oa=S[ha*(V+1)];for(let va=1;va<X;va++){const xa=ma+S[ha*(V+va)],za=oa+S[ha*(V+va)+1],Aa=(xa-ma)*(za+oa);ma=xa;oa=za;ja+=Aa}return.5*ja}function ca(S,V=0,X=0){la(S.lengths,X);la(S.coords,V)}function la(S,V=0){S.length!==V&&(S.length=V)}const pa=
x.getLogger("esri.layers.graphics.featureConversionUtils"),na={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},ra=(S,V,X,ha,ja,ma)=>{S[X]=ja;S[X+1]=ma},ua=(S,V,X,ha,ja,ma)=>{S[X]=ja;S[X+1]=ma;S[X+2]=V[ha+2]},L=(S,V,X,ha,ja,ma)=>{S[X]=ja;S[X+1]=ma;S[X+2]=V[ha+3]},T=(S,V,X,ha,ja,ma)=>{S[X]=ja;S[X+1]=ma;S[X+2]=V[ha+2];S[X+3]=V[ha+3]},ia=[],ka=[],qa={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};g.convertFromFeature=function(S,
V,X,ha,ja){ia[0]=S;[S]=O(ka,ia,V,X,ha,ja);la(ia);la(ka);return S};g.convertFromFeatureSet=function(S,V){const X=new f,{hasM:ha,hasZ:ja,features:ma,objectIdFieldName:oa,spatialReference:va,geometryType:xa,exceededTransferLimit:za,transform:Aa,fields:Ba}=S;Ba&&(X.fields=Ba);X.geometryType=xa??null;X.objectIdFieldName=oa??V??null;X.spatialReference=va??null;if(!X.objectIdFieldName)return pa.error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),X;ma&&O(X.features,
ma,xa,ja,ha,X.objectIdFieldName);za&&(X.exceededTransferLimit=za);ha&&(X.hasM=ha);ja&&(X.hasZ=ja);Aa&&(X.transform=Aa);return X};g.convertFromFeatures=O;g.convertFromGeometry=function(S,V,X){if(null==S)return null;const ha=new e;"hasZ"in S&&null==V&&(V=S.hasZ);"hasM"in S&&null==X&&(X=S.hasM);if(m.isPoint(S))return z(null!=V?V:null!=S.z,null!=X?X:null!=S.m)(ha,S);if(m.isPolygon(S))return Y(ha,S,V,X);if(m.isPolyline(S))return J(ha,S,l(V,X));if(m.isMultipoint(S))return H(ha,S,l(V,X));pa.error("convertFromGeometry:unknown-geometry",
new q(`Unable to parse unknown geometry type '${S}'`))};g.convertFromGraphics=function(S,V,X,ha,ja,ma){const oa=S.length;switch(X){case "esriGeometryPoint":F(S,V,ha,ja,ma);break;case "esriGeometryMultipoint":u(S,V,ha,ja,ma);break;case "esriGeometryPolyline":I(S,V,ha,ja,ma);break;case "esriGeometryPolygon":R(S,V,ha,ja,ma);break;default:pa.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${X}'`))}for(ha=0;ha<V.length;ha++)S[ha+oa].geometryType=X,S[ha+oa].insertAfter=
V[ha].insertAfter,S[ha+oa].groupId=V[ha].groupId;return S};g.convertFromMultipoint=H;g.convertFromMultipointFeatures=u;g.convertFromNestedArray=fa;g.convertFromPoint=function(S,V,X=z(null!=V.z,null!=V.m)){return X(S,V)};g.convertFromPointFeatures=F;g.convertFromPolygon=Y;g.convertFromPolyline=J;g.convertFromPolylineFeatures=I;g.convertToFeature=function(S,V,X,ha){ka[0]=S;Z(ia,ka,V,X,ha);S=ia[0];la(ia);la(ka);return S};g.convertToFeatureSet=function(S){const {objectIdFieldName:V,spatialReference:X,
transform:ha,fields:ja,hasM:ma,hasZ:oa,features:va,geometryType:xa,exceededTransferLimit:za,uniqueIdField:Aa,queryGeometry:Ba,queryGeometryType:Ia}=S;S=Z([],va,xa,oa,ma);const Da=Q(Ba,Ia,!1,!1);S={features:S,fields:ja,geometryType:xa,objectIdFieldName:V,spatialReference:X,uniqueIdField:Aa,queryGeometry:Da};ha&&(S.transform=ha);za&&(S.exceededTransferLimit=za);ma&&(S.hasM=ma);oa&&(S.hasZ=oa);return S};g.convertToFeatures=Z;g.convertToGeometry=Q;g.convertToMultipoint=B;g.convertToMultipointFeatures=
D;g.convertToPoint=function(S,V,X){return S?V?X?A(S):t(S):X?y(S):a(S):null};g.convertToPolygon=M;g.convertToPolyline=G;g.deltaDecodeGeometry=function(S,V){if(null==S)return null;const X=S.clone(),ha=S.coords;S=S.lengths;let ja=0;for(let va=0;va<S.length;va++){const xa=S[va];var ma=ha[V*ja],oa=ha[V*ja+1];for(let za=1;za<xa;za++)ma+=ha[V*(ja+za)],oa+=ha[V*(ja+za)+1],X.coords[V*(ja+za)]=ma,X.coords[V*(ja+za)+1]=oa;ja+=xa}return X};g.deltaEncodeGeometry=function(S,V){const X=S.clone(),ha=S.coords;S=S.lengths;
let ja=0;for(let oa=0;oa<S.length;oa++){const va=S[oa];let xa=ha[V*ja];var ma=ha[V*ja+1];for(let za=1;za<va;za++){const Aa=ha[V*(ja+za)],Ba=ha[V*(ja+za)+1];ma=Ba-ma;X.coords[V*(ja+za)]=Aa-xa;X.coords[V*(ja+za)+1]=ma;xa=Aa;ma=Ba}ja+=va}return X};g.generalizeOptimizedGeometry=function(S,V,X,ha,ja,ma,oa=X,va=ha){ca(S);if(!V?.coords.length)return null;ja=na[ja];const {coords:xa,lengths:za}=V;V=l(X,ha);const Aa=l(X&&oa,ha&&va);X=b(X,ha,oa,va);if(!za.length)return X(S.coords,xa,0,0,xa[0],xa[1]),ca(S,V,
0),S;ha=0;ma*=ma;for(const Ba of za){if(Ba<ja){ha+=Ba*V;continue}oa=S.coords.length/Aa;va=ha;const Ia=ha+(Ba-1)*V;X(S.coords,xa,S.coords.length,va,xa[va],xa[va+1]);da(S.coords,xa,V,ma,X,va,Ia);X(S.coords,xa,S.coords.length,Ia,xa[Ia],xa[Ia+1]);va=S.coords.length/Aa-oa;va>=ja?S.lengths.push(va):la(S.coords,oa*Aa);ha+=Ba*V}return S.coords.length?S:null};g.getBoundsOptimizedGeometry=function(S,V,X,ha){if(!V?.coords?.length)return null;X=l(X,ha);let ja=ha=Number.POSITIVE_INFINITY,ma=Number.NEGATIVE_INFINITY,
oa=Number.NEGATIVE_INFINITY;if(V&&V.coords){V=V.coords;for(let va=0;va<V.length;va+=X){const xa=V[va],za=V[va+1];ha=Math.min(ha,xa);ma=Math.max(ma,xa);ja=Math.min(ja,za);oa=Math.max(oa,za)}}C.is(S)?C.fromRectValues(S,ha,ja,ma,oa):r.fromValues(ha,ja,ma,oa,S);return S};g.getQuantizedArea=function(S,V){const {coords:X,lengths:ha}=S;let ja=S=0;for(let ma=0;ma<ha.length;ma++){const oa=ha[ma];ja+=U(X,S,oa,V);S+=oa}return Math.abs(ja)};g.getQuantizedBoundsOptimizedGeometry=function(S,V,X,ha){X=l(X,ha);const {lengths:ja,
coords:ma}=V;ha=V=Number.POSITIVE_INFINITY;let oa=Number.NEGATIVE_INFINITY,va=Number.NEGATIVE_INFINITY,xa=0;for(const za of ja){let Aa=ma[xa],Ba=ma[xa+1];V=Math.min(Aa,V);ha=Math.min(Ba,ha);oa=Math.max(Aa,oa);va=Math.max(Ba,va);xa+=X;for(let Ia=1;Ia<za;Ia++,xa+=X){const Da=ma[xa],Ga=ma[xa+1];Aa+=Da;Ba+=Ga;0>Da&&(V=Math.min(V,Aa));0<Da&&(oa=Math.max(oa,Aa));0>Ga?ha=Math.min(ha,Ba):0<Ga&&(va=Math.max(va,Ba))}}S[0]=V;S[1]=ha;S[2]=oa;S[3]=va;return S};g.getSignedQuantizedRingArea=U;g.quantizeOptimizedFeatureSet=
function(S,V){const {geometryType:X,features:ha,hasM:ja,hasZ:ma}=V;if(!S)return V;for(let oa=0;oa<ha.length;oa++){const va=ha[oa],xa=va.weakClone();xa.geometry=new e;ba(xa.geometry,va.geometry,ja,ma,X,S);va.centroid&&(xa.centroid=new e,ba(xa.centroid,va.centroid,ja,ma,"esriGeometryPoint",S));ha[oa]=xa}V.transform=S;return V};g.quantizeOptimizedGeometry=ba;g.quantizeX=p;g.quantizeY=c;g.removeCollinearVectices=function(S,V,X,ha,ja){if(!V?.coords?.length)return null;X=na[X];const {coords:ma,lengths:oa}=
V;V=b(ha,ja,ha,ja);ha=l(ha,ja);let va=ja=0,xa=0,za=0;for(const Ia of oa){va=za;V(S.coords,ma,va,ja,ma[ja],ma[ja+1]);ja+=ha;var Aa=ma[ja];let Da=ma[ja+1],Ga=Aa,Fa=Da;var Ba=Da/Aa;va+=ha;V(S.coords,ma,va,ja,Ga,Fa);ja+=ha;for(let Ea=2;Ea<Ia;Ea++){Aa=ma[ja];Da=ma[ja+1];const La=Da/Aa,Ua=Ba===La||!isFinite(Ba)&&!isFinite(La);Ba=Ua&&isFinite(La)?0<=Ba&&0<=La||0>=Ba&&0>=La:0<=Fa&&0<=Da||0>=Fa&&0>=Da;Ua&&Ba?(Ga+=Aa,Fa+=Da):(Ga=Aa,Fa=Da,va+=ha);V(S.coords,ma,va,ja,Ga,Fa);ja+=ha;Ba=La}va+=ha;Aa=(va-za)/ha;
Aa>=X&&(S.lengths[xa]=Aa,za=va,xa++)}S.coords.length>za&&(S.coords.length=za);S.lengths.length>xa&&(S.lengths.length=xa);return S.coords.length&&S.lengths.length?S:null};g.removeZMValues=function(S,V,X,ha,ja,ma){ca(S);S.lengths.push(...V.lengths);if(X===ja&&ha===ma)for(var oa=0;oa<V.coords.length;oa++)S.coords.push(V.coords[oa]);else for(oa=l(X,ha),X=b(X,ha,ja,ma),V=V.coords,ha=0;ha<V.length;ha+=oa)X(S.coords,V,S.coords.length,ha,V[ha],V[ha+1]);return S};g.unquantizeOptimizedFeatureSet=function(S){const {transform:V,
features:X,hasM:ha,hasZ:ja}=S;if(!V)return S;for(const ma of X)null!=ma.geometry&&P(ma.geometry,ma.geometry,ha,ja,V),null!=ma.centroid&&P(ma.centroid,ma.centroid,ha,ja,V);S.transform=null;return S};g.unquantizeOptimizedGeometry=P;g.unquantizeValue=d;g.unquantizeX=function(S,V){return d(S,V,0)};g.unquantizeY=function(S,V){return d(S,-V,1)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect"],
function(g,q,x){function w(d=p){return[d[0],d[1],d[2],d[3],d[4],d[5]]}function C(d,a,n,t,v,y,h=w()){h[0]=d;h[1]=a;h[2]=n;h[3]=t;h[4]=v;h[5]=y;return h}function r(d){return d[0]>=d[3]?0:d[3]-d[0]}function m(d){return d[1]>=d[4]?0:d[4]-d[1]}function k(d){return d[2]>=d[5]?0:d[5]-d[2]}function f(d,a){return Math.max(a[0],d[0])<=Math.min(a[3],d[3])&&Math.max(a[1],d[1])<=Math.min(a[4],d[4])&&Math.max(a[2],d[2])<=Math.min(a[5],d[5])}function e(d,a){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=
a[5];return d}function l(d){return 6===d.length}const b=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],p=[0,0,0,0,0,0],c=w();g.allFinite=function(d){for(let a=0;6>a;a++)if(!isFinite(d[a]))return!1;return!0};g.center=function(d,a=[0,0,0]){a[0]=d[0]+r(d)/2;a[1]=d[1]+m(d)/2;a[2]=d[2]+k(d)/2;return a};g.contains=function(d,a){return a[0]>=d[0]&&a[1]>=d[1]&&a[2]>=d[2]&&a[3]<=d[3]&&a[4]<=d[4]&&a[5]<=d[5]};g.containsPoint=function(d,a){return a[0]>=d[0]&&a[1]>=d[1]&&a[2]>=d[2]&&a[0]<=d[3]&&a[1]<=
d[4]&&a[2]<=d[5]};g.containsPointWithMargin=function(d,a,n){return a[0]>=d[0]-n&&a[1]>=d[1]-n&&a[2]>=d[2]-n&&a[0]<=d[3]+n&&a[1]<=d[4]+n&&a[2]<=d[5]+n};g.create=w;g.depth=m;g.diameter=function(d){const a=r(d),n=k(d);d=m(d);return Math.sqrt(a*a+n*n+d*d)};g.empty=function(d){return d?e(d,b):w(b)};g.equals=function(d,a,n){if(null==d||null==a)return d===a;if(!l(d)||!l(a))return!1;if(n)for(let t=0;t<d.length;t++){if(!n(d[t],a[t]))return!1}else for(n=0;n<d.length;n++)if(d[n]!==a[n])return!1;return!0};g.expandWithAABB=
function(d,a){d[0]=Math.min(d[0],a[0]);d[1]=Math.min(d[1],a[1]);d[2]=Math.min(d[2],a[2]);d[3]=Math.max(d[3],a[3]);d[4]=Math.max(d[4],a[4]);d[5]=Math.max(d[5],a[5])};g.expandWithBuffer=function(d,a,n=0,t=a.length/3){let v=d[0],y=d[1],h=d[2],A=d[3],E=d[4],z=d[5];for(let F=0;F<t;F++)v=Math.min(v,a[n+3*F]),y=Math.min(y,a[n+3*F+1]),h=Math.min(h,a[n+3*F+2]),A=Math.max(A,a[n+3*F]),E=Math.max(E,a[n+3*F+1]),z=Math.max(z,a[n+3*F+2]);d[0]=v;d[1]=y;d[2]=h;d[3]=A;d[4]=E;d[5]=z};g.expandWithNestedArray=function(d,
a,n){const t=a.length;let v=d[0],y=d[1],h=d[2],A=d[3],E=d[4],z=d[5];if(n)for(n=0;n<t;n++){var F=a[n];v=Math.min(v,F[0]);y=Math.min(y,F[1]);h=Math.min(h,F[2]);A=Math.max(A,F[0]);E=Math.max(E,F[1]);z=Math.max(z,F[2])}else for(n=0;n<t;n++)F=a[n],v=Math.min(v,F[0]),y=Math.min(y,F[1]),A=Math.max(A,F[0]),E=Math.max(E,F[1]);d[0]=v;d[1]=y;d[2]=h;d[3]=A;d[4]=E;d[5]=z};g.expandWithOffset=function(d,a,n,t){d[0]=Math.min(d[0],d[0]+a);d[3]=Math.max(d[3],d[3]+a);d[1]=Math.min(d[1],d[1]+n);d[4]=Math.max(d[4],d[4]+
n);d[2]=Math.min(d[2],d[2]+t);d[5]=Math.max(d[5],d[5]+t)};g.expandWithRect=function(d,a){d[0]=Math.min(d[0],a[0]);d[1]=Math.min(d[1],a[1]);d[3]=Math.max(d[3],a[2]);d[4]=Math.max(d[4],a[3])};g.expandWithVec3=function(d,a){d[0]=Math.min(d[0],a[0]);d[1]=Math.min(d[1],a[1]);d[2]=Math.min(d[2],a[2]);d[3]=Math.max(d[3],a[0]);d[4]=Math.max(d[4],a[1]);d[5]=Math.max(d[5],a[2])};g.fromExtent=function(d,a=w()){a[0]=d.xmin;a[1]=d.ymin;a[2]=d.hasZ?d.zmin:-Infinity;a[3]=d.xmax;a[4]=d.ymax;a[5]=d.hasZ?d.zmax:Infinity;
return a};g.fromMinMax=function(d,a,n=w()){n[0]=d[0];n[1]=d[1];n[2]=d[2];n[3]=a[0];n[4]=a[1];n[5]=a[2];return n};g.fromRect=function(d,a){d[0]=a[0];d[1]=a[1];d[2]=Number.NEGATIVE_INFINITY;d[3]=a[2];d[4]=a[3];d[5]=Number.POSITIVE_INFINITY;return d};g.fromRectValues=function(d,a,n,t,v){d[0]=a;d[1]=n;d[2]=Number.NEGATIVE_INFINITY;d[3]=t;d[4]=v;d[5]=Number.POSITIVE_INFINITY;return d};g.fromValues=C;g.getMax=function(d,a){a[0]=d[3];a[1]=d[4];a[2]=d[5];return a};g.getMin=function(d,a){a[0]=d[0];a[1]=d[1];
a[2]=d[2];return a};g.height=k;g.intersects=f;g.intersectsClippingArea=function(d,a){return null==a?!0:f(d,a)};g.is=l;g.isPoint=function(d){return 0===r(d)&&0===m(d)&&0===k(d)};g.maximumDimension=function(d){return Math.max(r(d),k(d),m(d))};g.negativeInfinity=b;g.offset=function(d,a,n,t,v=d){v[0]=d[0]+a;v[1]=d[1]+n;v[2]=d[2]+t;v[3]=d[3]+a;v[4]=d[4]+n;v[5]=d[5]+t;return v};g.positiveInfinity=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];g.scale=function(d,a,n=d){const t=d[0]+r(d)/2,v=
d[1]+m(d)/2,y=d[2]+k(d)/2;n[0]=t+(d[0]-t)*a;n[1]=v+(d[1]-v)*a;n[2]=y+(d[2]-y)*a;n[3]=t+(d[3]-t)*a;n[4]=v+(d[4]-v)*a;n[5]=y+(d[5]-y)*a;return n};g.set=e;g.setMax=function(d,a,n=d){n[3]=a[0];n[4]=a[1];n[5]=a[2];n!==d&&(n[0]=d[0],n[1]=d[1],n[2]=d[2]);return d};g.setMin=function(d,a,n=d){n[0]=a[0];n[1]=a[1];n[2]=a[2];n!==d&&(n[3]=d[3],n[4]=d[4],n[5]=d[5]);return n};g.size=function(d,a=[0,0,0]){a[0]=r(d);a[1]=m(d);a[2]=k(d);return a};g.toExtent=function(d,a){return isFinite(d[2])||isFinite(d[5])?new q({xmin:d[0],
xmax:d[3],ymin:d[1],ymax:d[4],zmin:d[2],zmax:d[5],spatialReference:a}):new q({xmin:d[0],xmax:d[3],ymin:d[1],ymax:d[4],spatialReference:a})};g.toRect=function(d,a){a||(a=x.create());a[0]=d[0];a[1]=d[1];a[2]=d[3];a[3]=d[4];return a};g.width=r;g.wrap=function(d,a,n,t,v,y){return C(d,a,n,t,v,y,c)};g.zero=p;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports"],function(g){class q{constructor(w=null,C={},r,m){this.geometry=
w;this.attributes=C;this.centroid=r;this.objectId=m;this.geohashY=this.geohashX=this.displayId=0}weakClone(){const w=new q(this.geometry,this.attributes,this.centroid,this.objectId);w.displayId=this.displayId;w.geohashX=this.geohashX;w.geohashY=this.geohashY;return w}}class x extends q{}g.OptimizedFeature=q;g.OptimizedFeatureWithGeometry=x;g.hasGeometry=function(w){return!!w.geometry?.coords?.length};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){class g{constructor(){this.spatialReference=
this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1;this.queryGeometry=this.queryGeometryType=this.uniqueIdField=null}weakClone(){const q=new g;q.objectIdFieldName=this.objectIdFieldName;q.globalIdFieldName=this.globalIdFieldName;q.geohashFieldName=this.geohashFieldName;q.geometryProperties=this.geometryProperties;q.geometryType=this.geometryType;
q.spatialReference=this.spatialReference;q.hasZ=this.hasZ;q.hasM=this.hasM;q.features=this.features;q.fields=this.fields;q.transform=this.transform;q.exceededTransferLimit=this.exceededTransferLimit;q.uniqueIdField=this.uniqueIdField;q.queryGeometry=this.queryGeometry;q.queryGeometryType=this.queryGeometryType;return q}}return g})},"esri/layers/graphics/OptimizedGeometry":function(){define(function(){class g{constructor(q=[],x=[],w=!1){this.lengths=q??[];this.coords=x??[];this.hasIndeterminateRingOrder=
w}static fromRect(q){const [x,w,C,r]=q;q=C-x;const m=r-w;return new g([5],[x,w,q,0,0,m,-q,0,0,-m])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((q,x)=>q+x)}forEachVertex(q){let x=0;this.lengths.length||q(this.coords[0],this.coords[1]);for(let w=0;w<this.lengths.length;w++){const C=this.lengths[w];for(let r=0;r<C;r++)q(this.coords[2*(r+x)],this.coords[2*(r+x)+1]);x+=C}}clone(q){return q?(q.set(this.coords),new g(this.lengths.slice(),
q,this.hasIndeterminateRingOrder)):new g(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}return g})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E,z,F,D,B,u){class H{constructor(M,R=null,Y,fa,O){this.attributes=M;this.geometry=Y;this.centroid=fa;this.filterFlags=O;this.groupId=-1;this.displayId=R}}const G=new m.MemCacheStorage(2E6);let I=0;class J{constructor(M){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:h.queryCapabilities};this.geometryType=M.geometryType;this.hasM=!!M.hasM;this.hasZ=!!M.hasZ;this.objectIdField=M.objectIdField;this.spatialReference=M.spatialReference;
this.definitionExpression=M.definitionExpression;this.featureStore=M.featureStore;this.aggregateAdapter=M.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=M.timeInfo;M.cacheSpatialQueries&&(this._geometryQueryCache=new m.MemCache(I++ +"$$",G));this.fieldsIndex=w.isSerializable(M.fieldsIndex)?M.fieldsIndex:B.fromJSON(M.fieldsIndex);this.availableFields=null==M.availableFields?new Set(this.fieldsIndex.fields.map(R=>R.name)):new Set(M.availableFields.map(R=>
this.fieldsIndex.get(R)?.name).filter(R=>null!=R));M.scheduler&&M.priority&&(this._frameTask=M.scheduler.registerTask(M.priority))}destroy(){this._frameTask=r.removeMaybe(this._frameTask);this.clearCache();r.destroyMaybe(this._geometryQueryCache);this._changeHandle=r.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(M,
R){try{return(await this._executeQuery(M,{},R)).createQueryResponse()}catch(Y){if(Y!==E.queryEngineEmptyResult)throw Y;return(new A.QueryEngineResult([],M,this)).createQueryResponse()}}async executeQueryForCount(M={},R){try{return(await this._executeQuery(M,{returnGeometry:!1,returnCentroid:!1,outSR:null},R)).createQueryResponseForCount()}catch(Y){if(Y!==E.queryEngineEmptyResult)throw Y;return 0}}async executeQueryForExtent(M,R){const Y=M.outSR;try{const fa=await this._executeQuery(M,{returnGeometry:!0,
returnCentroid:!1,outSR:null},R),O=fa.size;if(!O)return{count:0,extent:null};const Q=await this._getBounds(fa.items,fa.spatialReference,Y||this.spatialReference);return{count:O,extent:Q}}catch(fa){if(fa===E.queryEngineEmptyResult)return{count:0,extent:null};throw fa;}}async executeQueryForIds(M,R){return this.executeQueryForIdSet(M,R).then(Y=>Array.from(Y))}async executeQueryForIdSet(M,R){try{const Y=await this._executeQuery(M,{returnGeometry:!0,returnCentroid:!1,outSR:null},R),fa=Y.items,O=new Set;
await this._reschedule(()=>{for(const Q of fa)O.add(Y.featureAdapter.getObjectId(Q))},R);return O}catch(Y){if(Y===E.queryEngineEmptyResult)return new Set;throw Y;}}async executeQueryForSnapping(M,R){const {point:Y,distance:fa,returnEdge:O,vertexMode:Q}=M;if(!O&&"none"===Q)return{candidates:[]};let Z=C.clone(M.query);Z=await this._schedule(()=>E.normalizeQueryLike(Z,this.definitionExpression,this.spatialReference),R);Z=await this._reschedule(()=>z.validateQuery(Z,{availableFields:this.availableFields,
fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),R);const ba=!a.equals(Y.spatialReference,this.spatialReference);ba&&await y.checkProjectionSupport(Y.spatialReference,this.spatialReference);var da="number"===typeof fa?fa:fa.x,P="number"===typeof fa?fa:fa.y;da={xmin:Y.x-da,xmax:Y.x+da,ymin:Y.y-P,ymax:Y.y+P,spatialReference:Y.spatialReference};da=ba?y.project(da,this.spatialReference):da;if(!da)return{candidates:[]};P=(await d.normalizeCentralMeridian(c.fromJSON(Y),
null,{signal:R}))[0];const U=(await d.normalizeCentralMeridian(c.fromJSON(da),null,{signal:R}))[0];if(null==P||null==U)return{candidates:[]};const ca=new A.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(U.toJSON())),R),Z,this);await this._reschedule(()=>this._executeObjectIdsQuery(ca),R);await this._reschedule(()=>this._executeTimeQuery(ca),R);await this._reschedule(()=>this._executeAttributesQuery(ca),R);await this._reschedule(()=>this._executeGeometryQueryForSnapping(ca,
R),R);P=P.toJSON();P=ba?y.project(P,this.spatialReference):P;return ca.createSnappingResponse({...M,point:P,distance:ba?Math.max(da.xmax-da.xmin,da.ymax-da.ymin)/2:fa},Y.spatialReference)}async executeQueryForLatestObservations(M,R){if(!this.timeInfo?.trackIdField)throw new x("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:M,timeInfo:this.timeInfo});try{const Y=await this._executeQuery(M,{},R);await this._reschedule(()=>this._filterLatest(Y),R);return Y.createQueryResponse()}catch(Y){if(Y!==
E.queryEngineEmptyResult)throw Y;return(new A.QueryEngineResult([],M,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(M={},R,Y){const {field:fa,normalizationField:O,valueExpression:Q}=R;return(await this._executeQueryForStatistics(M,{field:fa,normalizationField:O,valueExpression:Q},Y)).createSummaryStatisticsResponse(R)}async executeQueryForUniqueValues(M={},R,Y){const {field:fa,field2:O,field3:Q,valueExpression:Z}=R;return(await this._executeQueryForStatistics(M,{field:fa,field2:O,
field3:Q,valueExpression:Z},Y)).createUniqueValuesResponse(R)}async executeQueryForClassBreaks(M={},R,Y){const {field:fa,normalizationField:O,valueExpression:Q}=R;return(await this._executeQueryForStatistics(M,{field:fa,normalizationField:O,valueExpression:Q},Y)).createClassBreaksResponse(R)}async executeQueryForHistogram(M={},R,Y){const {field:fa,normalizationField:O,valueExpression:Q}=R;return(await this._executeQueryForStatistics(M,{field:fa,normalizationField:O,valueExpression:Q},Y)).createHistogramResponse(R)}async fetchRecomputedExtents(M){this._timeExtentPromise||
(this._timeExtentPromise=D.getTimeExtent(this.timeInfo,this.featureStore));const [R,Y]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);k.throwIfAborted(M);return{fullExtent:R,timeExtent:Y}}async _getBounds(M,R,Y){const fa=l.set(l.create(),l.negativeInfinity);await this.featureStore.forEachBounds(M,O=>l.expandWithAABB(fa,O));M={xmin:fa[0],ymin:fa[1],xmax:fa[3],ymax:fa[4],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(fa[2])&&isFinite(fa[5])&&
(M.zmin=fa[2],M.zmax=fa[5]);R=y.project(M,R,Y);R.spatialReference=v.cleanFromGeometryEngine(Y);0===R.xmax-R.xmin&&(Y=f.getMetersPerUnitForSR(R.spatialReference),R.xmin-=Y,R.xmax+=Y);0===R.ymax-R.ymin&&(Y=f.getMetersPerUnitForSR(R.spatialReference),R.ymin-=Y,R.ymax+=Y);this.hasZ&&null!=R.zmin&&null!=R.zmax&&0===R.zmax-R.zmin&&(Y=f.getMetersPerUnitForSR(R.spatialReference),R.zmin-=Y,R.zmax+=Y);return R}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&
this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(M=>this._getBounds(M,this.spatialReference,this.spatialReference)));return this._fullExtentPromise}async _schedule(M,R){return null!=this._frameTask?this._frameTask.schedule(M,R):M(u.noBudget)}async _reschedule(M,R){return null!=this._frameTask?this._frameTask.reschedule(M,R):M(u.noBudget)}async _getAllFeaturesQueryEngineResult(M){return new A.QueryEngineResult(await this._getAllFeatures(),
M,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const Y=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(fa=>Y.push(fa))})().then(()=>Y)}const M=this._allFeaturesPromise,R=await M;return M===this._allFeaturesPromise?R.slice():this._getAllFeatures()}async _executeQuery(M,R,Y){M=C.clone(M);M=await this._schedule(()=>E.normalizeQuery(M,this.definitionExpression,this.spatialReference),Y);M=await this._reschedule(()=>z.validateQuery(M,{availableFields:this.availableFields,
fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),Y);M={...M,...R};const fa=await this._reschedule(()=>this._executeSceneFilterQuery(M,Y),Y),O=await this._reschedule(()=>this._executeGeometryQuery(M,fa,Y),Y);await this._reschedule(()=>this._executeAggregateIdsQuery(O),Y);await this._reschedule(()=>this._executeObjectIdsQuery(O),Y);await this._reschedule(()=>this._executeTimeQuery(O),Y);await this._reschedule(()=>this._executeAttributesQuery(O),Y);
return O}async _executeSceneFilterQuery(M,R){if(null==M.sceneFilter)return null;const {outSR:Y,returnGeometry:fa,returnCentroid:O}=M;var Q=this.featureStore.featureSpatialReference,Z=M.sceneFilter.geometry;const ba=null==Q||a.equals(Q,Z.spatialReference)?Z:y.project(Z,Q);if(!ba)return null;Q=fa||O;Q=a.isValid(Y)&&!a.equals(this.spatialReference,Y)&&Q?async ca=>this._project(ca,Y):ca=>ca;const da=this.featureAdapter;Z=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(ba)),R);if("disjoint"===
M.sceneFilter.spatialRelationship){if(!Z.length)return null;const ca=new Set;for(var P of Z)ca.add(da.getObjectId(P));const la=await this._reschedule(()=>this._getAllFeatures(),R);P=await this._reschedule(async()=>{const pa=await F.getSpatialQueryOperator("esriSpatialRelDisjoint",ba,this.geometryType,this.hasZ,this.hasM),na=await this._runSpatialFilter(la,ra=>!ca.has(da.getObjectId(ra))||pa(da.getGeometry(ra)),R);return new A.QueryEngineResult(na,M,this)},R);return Q(P)}if(!Z.length)return new A.QueryEngineResult([],
M,this);if(this._canExecuteSinglePass(ba,M))return Q(new A.QueryEngineResult(Z,M,this));const U=await F.getSpatialQueryOperator("esriSpatialRelContains",ba,this.geometryType,this.hasZ,this.hasM);P=await this._runSpatialFilter(Z,ca=>U(da.getGeometry(ca)),R);return Q(new A.QueryEngineResult(P,M,this))}async _executeGeometryQuery(M,R,Y){if(null!=R&&0===R.items.length)return R;M=null!=R?R.query:M;const {geometry:fa,outSR:O,spatialRel:Q,returnGeometry:Z,returnCentroid:ba}=M;var da=this.featureStore.featureSpatialReference;
const P=!fa||null==da||a.equals(da,fa.spatialReference)?fa:y.project(fa,da),U=Z||ba,ca=a.isValid(O)&&!a.equals(this.spatialReference,O),la=this._geometryQueryCache&&null==R?ca&&U?JSON.stringify({originalFilterGeometry:fa,spatialRelationship:Q,outSpatialReference:O}):JSON.stringify({originalFilterGeometry:fa,spatialRelationship:Q}):null;da=la?this._geometryQueryCache.get(la):null;if(null!=da)return new A.QueryEngineResult(da,M,this);da=async L=>{ca&&U&&await this._project(L,O);la&&this._geometryQueryCache.put(la,
L.items,L.items.length+1);return L};if(!P)return da(null!=R?R:await this._getAllFeaturesQueryEngineResult(M));const pa=this.featureAdapter;let na=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(fa)),Y);if("esriSpatialRelDisjoint"===Q){if(!na.length)return da(null!=R?R:await this._getAllFeaturesQueryEngineResult(M));const L=new Set;for(var ra of na)L.add(pa.getObjectId(ra));const T=null!=R?R.items:await this._reschedule(()=>this._getAllFeatures(),Y);ra=await this._reschedule(async()=>
{const ia=await F.getSpatialQueryOperator(Q,P,this.geometryType,this.hasZ,this.hasM),ka=await this._runSpatialFilter(T,qa=>!L.has(pa.getObjectId(qa))||ia(pa.getGeometry(qa)),Y);return new A.QueryEngineResult(ka,M,this)},Y);return da(ra)}if(null!=R){const L=new q.PositionHint;na=na.filter(T=>0<=q.indexOf(R.items,T,R.items.length,L))}if(!na.length)return da=new A.QueryEngineResult([],M,this),la&&this._geometryQueryCache.put(la,da.items,1),da;if(this._canExecuteSinglePass(P,M))return da(new A.QueryEngineResult(na,
M,this));const ua=await F.getSpatialQueryOperator(Q,P,this.geometryType,this.hasZ,this.hasM);ra=await this._runSpatialFilter(na,L=>ua(pa.getGeometry(L)),Y);return da(new A.QueryEngineResult(ra,M,this))}async _executeGeometryQueryForSnapping(M,R){const {query:Y}=M,{spatialRel:fa}=Y;if(M?.items?.length&&Y.geometry&&fa){var O=await F.getSpatialQueryOperator(fa,Y.geometry,this.geometryType,this.hasZ,this.hasM);R=await this._runSpatialFilter(M.items,Q=>O(Q.geometry),R);M.items=R}}_executeAggregateIdsQuery(M){if(0!==
M.items.length&&M.query.aggregateIds?.length&&null!=this.aggregateAdapter){var R=new Set;for(const fa of M.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(fa).forEach(O=>R.add(O));var Y=this.featureAdapter.getObjectId;M.items=M.items.filter(fa=>R.has(Y(fa)))}}_executeObjectIdsQuery(M){if(0!==M.items.length&&M.query.objectIds?.length){var R=new Set(M.query.objectIds),Y=this.featureAdapter.getObjectId;M.items=M.items.filter(fa=>R.has(Y(fa)))}}_executeTimeQuery(M){if(0!==M.items.length){var R=
D.getTimeOperator(this.timeInfo,M.query.timeExtent,this.featureAdapter);null!=R&&(M.items=M.items.filter(R))}}_executeAttributesQuery(M){if(0!==M.items.length){var R=t.getWhereClause(M.query.where,this.fieldsIndex);if(R){if(!R.isStandardized)throw new TypeError("Where clause is not standardized");M.items=M.items.filter(Y=>R.testFeature(Y,this.featureAdapter))}}}async _runSpatialFilter(M,R,Y){if(!R)return M;if(null==this._frameTask)return M.filter(Z=>R(Z));let fa=0;const O=[],Q=async Z=>{for(;fa<M.length;){const ba=
M[fa++];R(ba)&&(O.push(ba),Z.madeProgress());Z.done&&await this._reschedule(da=>Q(da),Y)}};return this._reschedule(Z=>Q(Z),Y).then(()=>O)}_filterLatest(M){const {trackIdField:R,startTimeField:Y,endTimeField:fa}=this.timeInfo,O=fa||Y,Q=new Map,Z=this.featureAdapter.getAttribute;for(const ba of M.items){const da=Z(ba,R),P=Z(ba,O),U=Q.get(da);(!U||P>Z(U,O))&&Q.set(da,ba)}M.items=Array.from(Q.values())}_canExecuteSinglePass(M,R){({spatialRel:R}=R);return F.canQueryWithRBush(M)&&("esriSpatialRelEnvelopeIntersects"===
R||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===R||"esriSpatialRelContains"===R))}async _project(M,R){if(!R||a.equals(this.spatialReference,R))return M;const Y=this.featureAdapter;let fa=void 0;try{const O=await this._getFullExtent();fa=e.getTransformation(this.spatialReference,R,O)}catch{}R=await y.projectMany(M.items.map(O=>v.getGeometry(this.geometryType,this.hasZ,this.hasM,Y.getGeometry(O))),this.spatialReference,R,fa);M.items=R.map((O,Q)=>Y.cloneWithGeometry(M.items[Q],
n.convertFromGeometry(O,this.hasZ,this.hasM)));return M}_getQueryBBoxes(M){if(F.canQueryWithRBush(M)){if(c.isExtent(M))return[b.fromValues(Math.min(M.xmin,M.xmax),Math.min(M.ymin,M.ymax),Math.max(M.xmin,M.xmax),Math.max(M.ymin,M.ymax))];if(c.isPolygon(M))return M.rings.map(R=>b.fromValues(Math.min(R[0][0],R[2][0]),Math.min(R[0][1],R[2][1]),Math.max(R[0][0],R[2][0]),Math.max(R[0][1],R[2][1])))}return[p.getBoundsXY(b.create(),M)]}async _searchFeatures(M){const R=new Set;await Promise.all(M.map(Y=>this.featureStore.forEachInBounds(Y,
fa=>R.add(fa))));M=Array.from(R.values());R.clear();return M}async _executeQueryForStatistics(M,R,Y){M=C.clone(M);try{M=await this._schedule(()=>E.normalizeQuery(M,this.definitionExpression,this.spatialReference),Y);M=await this._reschedule(()=>z.validateStatisticsQuery(M,R,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),Y);const fa=await this._reschedule(()=>this._executeSceneFilterQuery(M,Y),Y),O=await this._reschedule(()=>
this._executeGeometryQuery(M,fa,Y),Y);await this._reschedule(()=>this._executeAggregateIdsQuery(O),Y);await this._reschedule(()=>this._executeObjectIdsQuery(O),Y);await this._reschedule(()=>this._executeTimeQuery(O),Y);await this._reschedule(()=>this._executeAttributesQuery(O),Y);return O}catch(fa){if(fa!==E.queryEngineEmptyResult)throw fa;return new A.QueryEngineResult([],M,this)}}}g.Feature=H;g.QueryEngine=J;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports",
"./PooledArray"],function(g,q){g.RemoveMode=void 0;(function(r){r[r.ALL=0]="ALL";r[r.SOME=1]="SOME"})(g.RemoveMode||(g.RemoveMode={}));class x{constructor(r,m,k){this.name=r;this._storage=m;this.id=`${C++}:`;this.maxSize=this.size=0;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);k&&(this._storage.registerRemoveFunc(this.id,k),this._removeFunc=!0)}destroy(){this._storage.clear(this);this._removeFunc&&this._storage.deregisterRemoveFunc(this.id);this._storage.deregister(this);
this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(r,m,k,f=0){this._storage.put(this,r,m,k,f)}get(r){r=this._storage.get(this,r);void 0===r?++this._miss:++this._hit;return r}peek(r){return this._storage.peek(this,r)}pop(r){r=this._storage.pop(this,r);void 0===r?++this._miss:++this._hit;return r}updateSize(r,m,k){this._storage.updateSize(this,r,m,k)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}
class w{get size(){return this._size}constructor(r=10485760){this._maxSize=r;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=new q;this._users=new q}destroy(){this.clearAll();this._removeFuncs.clear();this._users.clear();this._db=null}register(r){this._users.push(r)}deregister(r){this._users.removeUnordered(r)}registerRemoveFunc(r,m){this._removeFuncs.push([r,m])}deregisterRemoveFunc(r){this._removeFuncs.filterInPlace(m=>m[0]!==r)}get maxSize(){return this._maxSize}set maxSize(r){this._maxSize=
Math.max(r,0);this._checkSizeLimits()}put(r,m,k,f,e){m=r.id+m;const l=this._db.get(m);l&&(this._size-=l.size,r.size-=l.size,this._db.delete(m),l.entry!==k&&this._notifyRemove(m,l.entry,g.RemoveMode.ALL));f>this._maxSize?this._notifyRemove(m,k,g.RemoveMode.ALL):void 0===k?console.warn("Refusing to cache undefined entry "):!f||0>f?(console.warn(`Refusing to cache entry with size ${f} for key ${m}`),this._notifyRemove(m,k,g.RemoveMode.ALL)):(e=1+Math.max(e,-3)- -3,this._db.set(m,{entry:k,size:f,lifetime:e,
lives:e}),this._size+=f,r.size+=f,this._checkSizeLimits())}updateSize(r,m,k,f){m=r.id+m;const e=this._db.get(m);if(e&&e.entry===k){this._size-=e.size;for(r.size-=e.size;f>this._maxSize;)if(f=this._notifyRemove(m,k,g.RemoveMode.SOME),!(null!=f&&0<f)){this._db.delete(m);return}e.size=f;this._size+=f;r.size+=f;this._checkSizeLimits()}}pop(r,m){m=r.id+m;const k=this._db.get(m);if(k)return this._size-=k.size,r.size-=k.size,this._db.delete(m),++this._hit,k.entry;++this._miss}get(r,m){m=r.id+m;r=this._db.get(m);
if(void 0===r)++this._miss;else return this._db.delete(m),r.lives=r.lifetime,this._db.set(m,r),++this._hit,r.entry}peek(r,m){(r=this._db.get(r.id+m))?++this._hit:++this._miss;return r?.entry}get performanceInfo(){const r={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},m={},k=[];this._db.forEach((l,b)=>{const p=l.lifetime;k[p]=(k[p]||0)+l.size;this._users.forAll(c=>{const {id:d,name:a}=
c;b.startsWith(d)&&(m[a]=(m[a]||0)+l.size)})});const f={};this._users.forAll(l=>{const b=l.name;"hitRate"in l&&"number"===typeof l.hitRate&&!isNaN(l.hitRate)&&0<l.hitRate?(m[b]=m[b]||0,f[b]=Math.round(100*l.hitRate)+"%"):f[b]="0%"});var e=Object.keys(m);e.sort((l,b)=>m[b]-m[l]);e.forEach(l=>r[l]=Math.round(m[l]/2**20)+"MB / "+f[l]);for(e=k.length-1;0<=e;--e){const l=k[e];l&&(r["Priority "+(e+-3-1)]=Math.round(l/this._size*100)+"%")}return r}resetStats(){this._hit=this._miss=0;this._users.forAll(r=>
r.resetHitRate())}clear(r){const m=r.id;this._db.forEach((k,f)=>{f.startsWith(m)&&(this._size-=k.size,this._db.delete(f),this._notifyRemove(f,k.entry,g.RemoveMode.ALL))});r.size=0}clearAll(){this._db.forEach((r,m)=>this._notifyRemove(m,r.entry,g.RemoveMode.ALL));this._users.forEach(r=>r.size=0);this._size=0;this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(r,m,k){let f;this._removeFuncs.some(e=>r.startsWith(e[0])?(e=e[1](m,k),"number"===typeof e&&(f=e),!0):!1);return f}_checkSizeLimits(){if(this._size>
this._maxSize)for(const [r,m]of this._db)if(this._purgeItem(r,m),this._size<=.9*this.maxSize)return;this._users.forEach(r=>{if(0<r.maxSize&&r.size>r.maxSize)for(const [m,k]of this._db)if(m.startsWith(r.id)&&(this._purgeItem(m,k,r),r.size<=.9*r.maxSize))break})}_purgeItem(r,m,k=this._users.find(f=>r.startsWith(f.id))){this._db.delete(r);if(1>=m.lives){this._size-=m.size;k&&(k.size-=m.size);const f=this._notifyRemove(r,m.entry,g.RemoveMode.SOME);null!=f&&0<f&&(this._size+=f,k&&(k.size+=f),m.lives=m.lifetime,
m.size=f,this._db.set(r,m))}else--m.lives,this._db.set(r,m)}}let C=0;g.MemCache=x;g.MemCacheStorage=w;g.minPriority=-3;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define("exports ../../config ../../core/Error ../../core/Logger ../Polygon ../Polyline ./normalizeUtilsCommon ./spatialReferenceUtils ./webMercatorUtils ../../rest/geometryService/cut ../../rest/geometryService/simplify".split(" "),function(g,q,x,w,C,r,m,k,f,e,l){function b(v){const y=
[];let h=0,A=0;for(let E=0;E<v.length;E++){const z=v[E];let F=null;for(let D=0;D<z.length;D++)F=z[D],y.push(F),0===D?A=h=F[0]:(h=Math.min(h,F[0]),A=Math.max(A,F[0]));F&&y.push([(h+A)/2,0])}return y}function p(v,y){if(!(v instanceof r||v instanceof C))throw t.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new x("straightLineDensify: the input geometry is neither polyline nor polygon");var h=m.getGeometryParts(v);const A=[];for(const z of h){h=[];A.push(h);h.push([z[0][0],
z[0][1]]);for(let F=0;F<z.length-1;F++){const D=z[F][0],B=z[F][1],u=z[F+1][0],H=z[F+1][1];var E=Math.sqrt((u-D)*(u-D)+(H-B)*(H-B));const G=(H-B)/E,I=(u-D)/E,J=E/y;if(1<J){for(let M=1;M<=J-1;M++){const R=M*y;h.push([I*R+D,G*R+B])}E=(E+Math.floor(J-1)*y)/2;h.push([I*E+D,G*E+B])}h.push([u,H])}}return"polygon"===v.type?new C({rings:A,spatialReference:v.spatialReference}):new r({paths:A,spatialReference:v.spatialReference})}function c(v,y,h){y&&(v=p(v,1E6),v=f.webMercatorToGeographic(v,!0));h&&(v=m.updatePolyGeometry(v,
h));return v}function d(v,y,h){if(Array.isArray(v)){var A=v[0];A>y?(h=m.offsetMagnitude(A,y),v[0]=A+-2*h*y):A<h&&(y=m.offsetMagnitude(A,h),v[0]=A+-2*y*h)}else A=v.x,A>y?(h=m.offsetMagnitude(A,y),v=v.clone().offset(-2*h*y,0)):A<h&&(y=m.offsetMagnitude(A,h),v=v.clone().offset(-2*y*h,0));return v}function a(v,y){let h=-1;for(let A=0;A<y.cutIndexes.length;A++){const E=y.cutIndexes[A],z=y.geometries[A],F=m.getGeometryParts(z);for(let D=0;D<F.length;D++){const B=F[D];B.some(u=>{if(180>u[0])return!0;u=0;
for(var H=0;H<B.length;H++){var G=B[H][0];u=G>u?G:u}u=Number(u.toFixed(9));u=-360*m.offsetMagnitude(u,180);for(H=0;H<B.length;H++)G=z.getPoint(D,H),z.setPoint(D,H,G.clone().offset(u,0));return!0})}if(E===h)if("polygon"===v[0].type)for(const D of m.getGeometryParts(z))v[E]=v[E].addRing(D);else{if("polyline"===v[0].type)for(const D of m.getGeometryParts(z))v[E]=v[E].addPath(D)}else h=E,v[E]=z}return v}async function n(v,y,h){if(!Array.isArray(v))return n([v],y);y&&"string"!==typeof y&&t.warn("normalizeCentralMeridian()",
"The url object is deprecated, use the url string instead");var A="string"===typeof y?y:y?.url??q.geometryServiceUrl;let E,z,F;let D=0;var B=[];y=[];for(var u of v)if(null==u)y.push(u);else{if(!H){var H=u.spatialReference;var G=k.getInfo(H);var I=(E=H.isWebMercator)?102100:4326;z=m.cutParams[I].maxX;F=m.cutParams[I].minX;var J=m.cutParams[I].plus180Line;I=m.cutParams[I].minus180Line}if(G)if("mesh"===u.type)y.push(u);else if("point"===u.type)y.push(d(u.clone(),z,F));else if("multipoint"===u.type){var M=
u.clone();M.points=M.points.map(R=>d(R,z,F));y.push(M)}else if("extent"===u.type)M=u.clone()._normalize(!1,!1,G),y.push(M.rings?new C(M):M);else if(u.extent){M=u.extent;const R=2*m.offsetMagnitude(M.xmin,F)*z;let Y=0===R?u.clone():m.updatePolyGeometry(u.clone(),R);M.offset(R,0);M.intersects(J)&&M.xmax!==z?(D=M.xmax>D?M.xmax:D,Y=c(Y,E),B.push(Y),y.push("cut")):M.intersects(I)&&M.xmin!==F?(D=2*M.xmax*z>D?2*M.xmax*z:D,Y=c(Y,E,360),B.push(Y),y.push("cut")):y.push(Y)}else y.push(u.clone());else y.push(u)}H=
m.offsetMagnitude(D,z);G=-90;J=H;for(u=new r;0<H;)I=-180+360*H,u.addPath([[I,G],[I,-1*G]]),G*=-1,H--;if(0<B.length&&0<J){H=await e.cut(A,B,u,h);H=a(B,H);G=[];B=[];for(J=0;J<y.length;J++)u=y[J],"cut"!==u?B.push(u):(u=H.shift(),I=v[J],null!=I&&"polygon"===I.type&&I.rings&&1<I.rings.length&&u.rings.length>=I.rings.length?(G.push(u),B.push("simplify")):B.push(E?f.geographicToWebMercator(u):u));if(!G.length)return B;y=await l.simplify(A,G,h);v=[];for(h=0;h<B.length;h++)A=B[h],"simplify"!==A?v.push(A):
v.push(E?f.geographicToWebMercator(y.shift()):y.shift());return v}v=[];for(h=0;h<y.length;h++)A=y[h],"cut"!==A?v.push(A):(A=B.shift(),v.push(!0===E?f.geographicToWebMercator(A):A));return v}const t=w.getLogger("esri.geometry.support.normalizeUtils");g.getClosestDenormalizedXToReference=function(v,y,h){h=k.getInfo(h);if(null==h)return v;const [A,E]=h.valid;h=2*E;let z=0,F=0;y>E?z=Math.ceil(Math.abs(y-E)/h):y<A&&(z=-Math.ceil(Math.abs(y-A)/h));v>E?F=Math.ceil(Math.abs(v-E)/h):v<A&&(F=-Math.ceil(Math.abs(v-
A)/h));v+=(z-F)*h;y=v-y;y>E?v-=h:y<A&&(v+=h);return v};g.getDenormalizedExtent=function(v){if(!v)return null;const y=v.extent;if(!y)return null;var h=v.spatialReference&&k.getInfo(v.spatialReference);if(!h)return y;const [A,E]=h.valid;({width:h}=y);let {xmin:z,xmax:F}=y;[z,F]=[F,z];if("extent"===v.type||0===h||h<=E||h>2*E||z<A||F>E)return y;let D;switch(v.type){case "polygon":if(1<v.rings.length)D=b(v.rings);else return y;break;case "polyline":if(1<v.paths.length)D=b(v.paths);else return y;break;
case "multipoint":D=v.points}v=y.clone();for(let B=0;B<D.length;B++){let u=D[B][0];0>u?(u+=E,F=Math.max(u,F)):(u-=E,z=Math.min(u,z))}v.xmin=z;v.xmax=F;return v.width<h?(v.xmin-=E,v.xmax-=E,v):y};g.normalizeCentralMeridian=n;g.normalizeMapX=function(v,y){if(y=k.getInfo(y)){const [h,A]=y.valid;y=A-h;if(v<h)for(;v<h;)v+=y;if(v>A)for(;v>A;)v-=y}return v};g.straightLineDensify=p;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports",
"../Polyline","../SpatialReference","./jsonUtils"],function(g,q,x,w){function C(r){return w.isPolygon(r)?r.rings:r.paths}q={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new q({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator}),minus180Line:new q({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator})},4326:{maxX:180,
minX:-180,plus180Line:new q({paths:[[[180,-180],[180,180]]],spatialReference:x.WGS84}),minus180Line:new q({paths:[[[-180,-180],[-180,180]]],spatialReference:x.WGS84})}};g.cutParams=q;g.getGeometryParts=C;g.offsetMagnitude=function(r,m){return Math.ceil((r-m)/(2*m))};g.updatePolyGeometry=function(r,m){const k=C(r);for(const f of k)for(const e of f)e[0]+=m;return r};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define("exports ../../geometry ../../request ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ../utils".split(" "),
function(g,q,x,w,C,r){g.cut=async function(m,k,f,e){m=r.parseUrl(m);const l=k[0].spatialReference;k={...e,responseType:"json",query:{...m.query,f:"json",sr:C.srToRESTValue(l),target:JSON.stringify({geometryType:w.getJsonType(k[0]),geometries:k}),cutter:JSON.stringify(f)}};k=await x(m.path+"/cut",k);const {cutIndexes:b,geometries:p=[]}=k.data;return{cutIndexes:b,geometries:p.map(c=>{c=w.fromJSON(c);c.spatialReference=l;return c})}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define("exports ../config ../kernel ../core/lang ../core/urlUtils ../support/apiKeyUtils".split(" "),
function(g,q,x,w,C,r){function m(k,f,e){const l={};for(const p in k)if("declaredClass"!==p){var b=k[p];if(null!=b&&"function"!==typeof b)if(Array.isArray(b)){l[p]=[];for(let c=0;c<b.length;c++)l[p][c]=m(b[c])}else"object"===typeof b?b.toJSON?(b=b.toJSON(e?.[p]),l[p]=f?b:JSON.stringify(b)):l[p]=f?b:JSON.stringify(b):l[p]=b}return l}g.asValidOptions=function(k,f){return f?{...f,query:{...(k??{}),...f.query}}:{query:k}};g.encode=m;g.getToken=function(k,f){return k?r.supportsApiKey(k)&&(f||q.apiKey)?
f||q.apiKey:x.id?.findCredential(k)?.token:null};g.parseUrl=function(k){return"string"===typeof k?C.urlToObject(k):w.clone(k)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define("exports ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ./utils".split(" "),function(g,q,x,w,C,r){g.simplify=async function(m,k,f){const e="string"===typeof m?x.urlToObject(m):m;m=k[0].spatialReference;
const l=w.getJsonType(k[0]);k={...f,query:{...e.query,f:"json",sr:C.srToRESTValue(m),geometries:JSON.stringify(r.encodeGeometries(k))}};({data:k}=await q(e.path+"/simplify",k));return r.decodeGeometries(k.geometries,l,m)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(g,q){g.decodeGeometries=function(x,w,C){const r=q.getGeometryType(w);return x.map(m=>{m=r.fromJSON(m);m.spatialReference=
C;return m})};g.encodeGeometries=function(x){return{geometryType:q.getJsonType(x[0]),geometries:x.map(w=>w.toJSON())}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(g,q,x,w){function C(p,c,d={}){const a=r(c,p);if(!a)throw d=e.getError(c,p),new q("unsupported-query","invalid SQL expression",{expression:c,error:d});
p=d.expressionName||"expression";if(d.validateStandardized&&!a.isStandardized)throw new q("unsupported-query",`${p} is not standard`,{expression:c});if(d.validateAggregate&&!a.isAggregate)throw new q("unsupported-query",`${p} does not contain a valid aggregate function`,{expression:c});return a.fieldNames}function r(p,c){return p?e.get(p,c):null}function m(p){return/\((.*?)\)/.test(p)?p:p.split(" as ")[0]}function k(p,c,d,a={}){const n=new Map;var t=a.allowedFieldTypes??b;for(const v of d)if("*"!==
v)if(p.get(v))f(n,p,c,t,v);else try{const y=m(v),h=C(p,y,{validateStandardized:!0});for(const A of h)f(n,p,c,t,A)}catch(y){n.set(v,{type:"expression-error",expression:v,error:y})}if(n.size)throw new q("unsupported-query",`${a.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(n.values()),query:a.query});}function f(p,c,d,a,n){"*"!==n&&((c=c.get(n))?d.has(c.name)?!1===a?.has(c.type)&&p.set(n,{type:"invalid-type",fieldName:c.name,fieldType:w.kebabDict.fromJSON(c.type),
allowedFieldTypes:Array.from(a,t=>w.kebabDict.fromJSON(t))}):p.set(n,{type:"missing-field",fieldName:c.name}):p.set(n,{type:"invalid-field",fieldName:n}))}const e=new x.WhereClauseCache(50,500);x=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),b=new Set(["esriFieldTypeString",
"esriFieldTypeGUID","esriFieldTypeGlobalID",...x,...l]);g.allDateAndTimeFieldTypes=l;g.getAliasFromFieldName=function(p){return p.split(" as ")[1]};g.getExpressionFromFieldName=m;g.getWhereClause=r;g.numericFieldTypes=x;g.validateFields=k;g.validateHaving=function(p,c,d,a,n){if(!d)return!0;const t=C(p,d,{validateAggregate:!0,expressionName:"having clause"});k(p,c,t,{expressionName:"having clause",query:n});if(!r(d,p)?.getExpressions().every(v=>{const {aggregateType:y,field:h}=v,A=p.get(h)?.name;return a.some(E=>
{const {onStatisticField:z,statisticType:F}=E;return p.get(z)?.name===A&&F.toLowerCase().trim()===y})}))throw new q("unsupported-query","expressions in having clause should also exist in outStatistics",{having:d});return!0};g.validateWhere=function(p,c,d,a){if(!d)return!0;d=C(p,d,{validateStandardized:!0,expressionName:"where clause"});k(p,c,d,{expressionName:"where clause",query:a});return!0};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports",
"../LRUCache","./WhereClause"],function(g,q,x){class w{constructor(C,r){this._cache=new q.LRUCache(C);this._invalidCache=new q.LRUCache(r)}get(C,r){const m=`${r.uid}:${C}`,k=this._cache.get(m);if(k)return k;if(null!=this._invalidCache.get(m))return null;try{const f=x.WhereClause.create(C,r);this._cache.put(m,f);return f}catch(f){return this._invalidCache.put(m,f),null}}getError(C,r){return this._invalidCache.get(`${r.uid}:${C}`)??null}}g.WhereClauseCache=w;Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(g,q){class x{constructor(w,C){this._storage=new q.MemCacheStorage;this.name=this.id="";this.size=0;this._storage.maxSize=w;this._storage.register(this);C&&this._storage.registerRemoveFunc("",C)}destroy(){this._storage.deregister(this);this._storage.destroy()}put(w,C,r=1){this._storage.put(this,w,C,r,1)}pop(w){return this._storage.pop(this,w)}get(w){return this._storage.get(this,w)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(w){this._storage.maxSize=
w}resetHitRate(){}}g.LRUCache=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d){function a(u){return Array.isArray(u)?
u:[u]}function n(u){return null!==u?!0!==u:null}function t(u,H){return null!=u&&null!=H?!0===u&&!0===H:!1===u||!1===H?!1:null}function v(u,H){return null!=u&&null!=H?!0===u||!0===H:!0===u||!0===H?!0:null}function y(u,H){if(null==u)return null;let G=!1;for(const I of H)if(null==I)G=null;else if(u===I){G=!0;break}return G}function h(u,H,G){if(null==u)return null;let I="",J=D.Normal;for(let M=0;M<H.length;M++){const R=H.charAt(M);switch(J){case D.Normal:R===G?J=D.Escaped:I="-[]/{}()*+?.\\^$|".includes(R)?
I+("\\"+R):"%"===R?I+".*":"_"===R?I+".":I+R;break;case D.Escaped:I="-[]/{}()*+?.\\^$|".includes(R)?I+("\\"+R):I+R,J=D.Normal}}return(new RegExp("^"+I+"$","m")).test(u)}function A(u,H,G,I){u=I.getAttribute(u,H);H=G?.get(H);return null==u||"esriFieldTypeDate"!==H?.type&&"date"!==H?.type?null==u||"esriFieldTypeDateOnly"!==H?.type&&"date-only"!==H?.type?null==u||"esriFieldTypeTimeOnly"!==H?.type&&"time-only"!==H?.type?null==u||"esriFieldTypeTimestampOffset"!==H?.type&&"timestamp-offset"!==H?.type?u:new l.SqlTimeStampOffset(u):
p.TimeOnly.fromReader(u):r.DateOnly.fromReader(u):f.convertToExecutingTimeZone(new Date(u),G?.getLuxonTimeZone(H.name)??d.FixedOffsetZone.utcInstance)}const E=new Set(["current_timestamp","current_date","current_time"]);class z{static makeBool(u){return!0===u}static featureValue(u,H,G,I){return A(u,H,G,I)}static equalsNull(u){return null===u}static applyLike(u,H,G){return h(u,H,G)}static ensureArray(u){return a(u)}static applyIn(u,H){return y(u,H)}static currentDate(u){return r.DateOnly.fromNow(u)}static makeSqlInterval(u,
H,G){return e.SqlInterval.createFromValueAndQualifer(u,H,G)}static convertInterval(u){return u instanceof e.SqlInterval?u.valueInMilliseconds():u}static currentTimestamp(u){return f.convertToExecutingTimeZone(new Date,u)}static compare(u,H,G,I){return k.sqlCompare(H,G,u)}static calculate(u,H,G,I){return m.sqlCalculateFunction(u,H,G,I)}static evaluateTime(u){return f.parseTime(u)}static evaluateTimestamp(u,H,G){return f.parseTimestamp(u,H,G)}static evaluateDate(u,H){return f.parseDate(u,H)}static evaluateFunction(u,
H,G){return b.evaluateFunction(u,H,G)}static lookup(u,H){u=H[u];return void 0===u?null:u}static between(u,H,G){return null==u||null==H[0]||null==H[1]?null:k.sqlCompare(u,H[0],"\x3e\x3d")&&k.sqlCompare(u,H[1],"\x3c\x3d")}static notbetween(u,H,G){return null==u||null==H[0]||null==H[1]?null:k.sqlCompare(u,H[0],"\x3c")||k.sqlCompare(u,H[1],"\x3e")}static ternaryNot(u){return n(u)}static ternaryAnd(u,H){return t(u,H)}static ternaryOr(u,H){return v(u,H)}}class F{constructor(u,H,G="UTC"){this.fieldsIndex=
H;this.timeZone=G;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=c.WhereGrammar.parse(u);const {isStandardized:I,isAggregate:J,referencedFieldNames:M}=this._extractExpressionInfo(H);this._referencedFieldNames=M;this.isStandardized=I;this.isAggregate=J}static convertValueToStorageFormat(u,H=null){if(null===H)return f.isDate(u)?u.getTime():f.isDateTime(u)?u.toMillis():f.isTimestampOffset(u)?u.toStorageFormat():f.isTimeOnly(u)?u.toStorageString():f.isDateOnly(u)?u.toStorageFormat():
u;switch(H){case "date":if(f.isDate(u))return u.getTime();if(f.isDateTime(u))return u.toMillis();if(f.isTimestampOffset(u))return u.toMilliseconds();if(f.isDateOnly(u))return u.toNumber();break;case "date-only":if(f.isDate(u))return r.DateOnly.fromDateJS(u).toString();if(f.isTimestampOffset(u))return r.DateOnly.fromSqlTimeStampOffset(u).toString();if(f.isDateTime(u))return r.DateOnly.fromDateTime(u).toString();break;case "time-only":if(f.isDate(u))return p.TimeOnly.fromDateJS(u).toStorageString();
if(f.isDateTime(u))return p.TimeOnly.fromDateTime(u).toStorageString();if(f.isTimestampOffset(u))return p.TimeOnly.fromSqlTimeStampOffset(u).toStorageString();if(f.isTimeOnly(u))return u.toStorageString();break;case "timestamp-offset":if(f.isDate(u))return l.SqlTimeStampOffset.fromJSDate(u).toStorageFormat();if(f.isDateTime(u))return l.SqlTimeStampOffset.fromDateTime(u).toStorageFormat();if(f.isTimestampOffset(u))return u.toStorageFormat()}return u}static create(u,H,G="UTC"){return new F(u,H,G)}get fieldNames(){return this._referencedFieldNames}testSet(u,
H=B){return!!this._evaluateNode(this.parseTree,null,H,u)}calculateValue(u,H=B){u=this._evaluateNode(this.parseTree,u,H,null);return u instanceof e.SqlInterval?u.valueInMilliseconds()/864E5:u}calculateValueCompiled(u,H=B){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(u,this.parameters,H,this.fieldsIndex,this.timeZone);if(w("esri-csp-restrictions"))return this.calculateValue(u,H);this._compileMe();return this.parseTree._compiledVersion(u,this.parameters,H,this.fieldsIndex,
this.timeZone)}testFeature(u,H=B){return!!this._evaluateNode(this.parseTree,u,H,null)}testFeatureCompiled(u,H=B){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(u,this.parameters,H,this.fieldsIndex,this.timeZone);if(w("esri-csp-restrictions"))return this.testFeature(u,H);this._compileMe();return!!this.parseTree._compiledVersion(u,this.parameters,H,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=
!1;this._visitAll(this.parseTree,u=>{"current-time"===u.type?this._hasDateFunctions=!0:"function"===u.type&&(this._hasDateFunctions=this._hasDateFunctions||E.has(u.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const u=new Set;this._visitAll(this.parseTree,H=>{"function"===H.type&&u.add(H.name.toLowerCase())});return Array.from(u)}getExpressions(){const u=new Map;this._visitAll(this.parseTree,H=>{if("function"===H.type){const G=H.name.toLowerCase();H=H.args.value[0];if("column-reference"===
H.type){H=H.column;const I=`${G}-${H}`;u.has(I)||u.set(I,{aggregateType:G,field:H})}}});return[...u.values()]}getVariables(){const u=new Set;this._visitAll(this.parseTree,H=>{"parameter"===H.type&&u.add(H.value.toLowerCase())});return Array.from(u)}_compileMe(){const u="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone",u)).bind(z)}_extractExpressionInfo(u){const H=
[],G=new Set;let I=!0,J=!1;this._visitAll(this.parseTree,M=>{switch(M.type){case "column-reference":var R=u?.get(M.column);let Y;R?R=Y=R.name??"":(Y=M.column,R=Y.toLowerCase());G.has(R)||(G.add(R),H.push(Y));M.column=Y;break;case "function":const {name:fa,args:O}=M;M=O.value.length;I&&(I=b.isStandardized(fa,M));!1===J&&(J=C.isAggregate(fa,M))}});return{referencedFieldNames:Array.from(H),isStandardized:I,isAggregate:J}}_visitAll(u,H){if(null!=u)switch(H(u),u.type){case "when-clause":this._visitAll(u.operand,
H);this._visitAll(u.value,H);break;case "case-expression":for(const G of u.clauses)this._visitAll(G,H);"simple"===u.format&&this._visitAll(u.operand,H);null!==u.else&&this._visitAll(u.else,H);break;case "expression-list":for(const G of u.value)this._visitAll(G,H);break;case "unary-expression":this._visitAll(u.expr,H);break;case "binary-expression":this._visitAll(u.left,H);this._visitAll(u.right,H);break;case "function":this._visitAll(u.args,H)}}evaluateNodeToJavaScript(u){switch(u.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(u.value)+", "+JSON.stringify(u.qualifier)+","+JSON.stringify(u.op)+")";case "case-expression":var H="";if("simple"===u.format){var G=this.evaluateNodeToJavaScript(u.operand);H="( ";for(let I=0;I<u.clauses.length;I++)H+=" (this.compare('\x3d',"+G+","+this.evaluateNodeToJavaScript(u.clauses[I].operand)+") ? ("+this.evaluateNodeToJavaScript(u.clauses[I].value)+") : "}else for(H="( ",G=0;G<u.clauses.length;G++)H+=" this.makeBool("+this.evaluateNodeToJavaScript(u.clauses[G].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(u.clauses[G].value)+") : ";H=null!==u.else?H+this.evaluateNodeToJavaScript(u.else):H+"null";return H+" )";case "parameter":return"this.lookup("+JSON.stringify(u.value.toLowerCase())+",lookups)";case "expression-list":H="[";for(G of u.value)"["!==H&&(H+=","),H+=this.evaluateNodeToJavaScript(G);return H+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(u.expr)+")";case "binary-expression":switch(u.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+" )";case "IS":if("null"!==u.right.type)throw new x.SqlError(x.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(u.left)+")";case "ISNOT":if("null"!==u.right.type)throw new x.SqlError(x.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(u.left)+
")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(u.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(u.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(u.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(u.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(u.left)+
","+this.evaluateNodeToJavaScript(u.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+","+JSON.stringify(u.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+","+JSON.stringify(u.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(u.operator)+
","+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(u.operator)+","+this.evaluateNodeToJavaScript(u.left)+","+this.evaluateNodeToJavaScript(u.right)+", timeZone)"}throw new x.SqlError(x.SqlErrorCodes.UnsupportedOperator,{operator:u.operator});case "null":case "boolean":case "string":case "number":return JSON.stringify(u.value);case "time":return"this.evaluateTime(JSON.stringify(node.value))";
case "date":return"this.evaluateDate(JSON.stringify(node.value), 'unknown')";case "timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), 'unknown')";case "current-time":return"date"===u.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(u.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(u.name)+","+this.evaluateNodeToJavaScript(u.args)+", timeZone)"}throw new x.SqlError(x.SqlErrorCodes.UnsupportedSyntax,
{node:u.type});}_evaluateNode(u,H,G,I){switch(u.type){case "interval":return G=this._evaluateNode(u.value,H,G,I),e.SqlInterval.createFromValueAndQualifer(G,u.qualifier,u.op);case "case-expression":if("simple"===u.format){var J=this._evaluateNode(u.operand,H,G,I);for(var M=0;M<u.clauses.length;M++)if(k.sqlCompare(J,this._evaluateNode(u.clauses[M].operand,H,G,I),"\x3d",this.timeZone))return this._evaluateNode(u.clauses[M].value,H,G,I)}else for(J=0;J<u.clauses.length;J++)if(!0===this._evaluateNode(u.clauses[J].operand,
H,G,I))return this._evaluateNode(u.clauses[J].value,H,G,I);return null!==u.else?this._evaluateNode(u.else,H,G,I):null;case "parameter":return u=this.parameters[u.value.toLowerCase()],f.isDate(u)?d.DateTime.fromJSDate(u):u instanceof q.ArcadeDate?u.toDateTime():u;case "expression-list":J=[];for(var R of u.value)J.push(this._evaluateNode(R,H,G,I));return J;case "unary-expression":return n(this._evaluateNode(u.expr,H,G,I));case "binary-expression":switch(u.operator){case "AND":return t(this._evaluateNode(u.left,
H,G,I),this._evaluateNode(u.right,H,G,I));case "OR":return v(this._evaluateNode(u.left,H,G,I),this._evaluateNode(u.right,H,G,I));case "IS":if("null"!==u.right.type)throw new x.SqlError(x.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(u.left,H,G,I);case "ISNOT":if("null"!==u.right.type)throw new x.SqlError(x.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(u.left,H,G,I);case "IN":return J=a(this._evaluateNode(u.right,H,G,I)),y(this._evaluateNode(u.left,H,G,I),J);case "NOT IN":return J=
a(this._evaluateNode(u.right,H,G,I)),n(y(this._evaluateNode(u.left,H,G,I),J));case "BETWEEN":return J=this._evaluateNode(u.left,H,G,I),u=this._evaluateNode(u.right,H,G,I),null==J||null==u[0]||null==u[1]?null:k.sqlCompare(J,u[0],"\x3e\x3d",this.timeZone)&&k.sqlCompare(J,u[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return J=this._evaluateNode(u.left,H,G,I),u=this._evaluateNode(u.right,H,G,I),null==J||null==u[0]||null==u[1]?null:k.sqlCompare(J,u[0],"\x3c",this.timeZone)||k.sqlCompare(J,u[1],"\x3e",
this.timeZone);case "LIKE":return h(this._evaluateNode(u.left,H,G,I),this._evaluateNode(u.right,H,G,I),u.escape);case "NOT LIKE":return n(h(this._evaluateNode(u.left,H,G,I),this._evaluateNode(u.right,H,G,I),u.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return k.sqlCompare(this._evaluateNode(u.left,H,G,I),this._evaluateNode(u.right,H,G,I),u.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return m.sqlCalculateFunction(u.operator,
this._evaluateNode(u.left,H,G,I),this._evaluateNode(u.right,H,G,I),this.timeZone)}case "null":case "boolean":case "string":case "number":return u.value;case "date":return u.parsedValue??(u.parsedValue=f.parseDate(u.value,"unknown")),u.parsedValue;case "timestamp":return u.parsedValue??(u.parsedValue=f.parseTimestamp(u.value,"unknown")),u.parsedValue;case "time":return f.parseTime(u.value);case "current-time":return"date"===u.mode?r.DateOnly.fromNow(this.timeZone):f.convertToExecutingTimeZone(new Date,
this.timeZone);case "column-reference":return A(H,u.column,this.fieldsIndex,G);case "data-type":return u.value;case "function":if(this.isAggregate&&C.isAggregate(u.name,u.args.value.length)){H=[];for(J of u.args?.value||[]){R=[];for(M of I||[])R.push(this._evaluateNode(J,M,G,null));H.push(R)}return C.aggregateFunction(u.name,H)}G=this._evaluateNode(u.args,H,G,I);return b.evaluateFunction(u.name,G,this.timeZone)}throw new x.SqlError(x.SqlErrorCodes.UnsupportedSyntax,{node:u.type});}}var D;(function(u){u[u.Normal=
0]="Normal";u[u.Escaped=1]="Escaped"})(D||(D={}));const B={getAttribute(u,H){return(u&&"object"===typeof u.attributes?u.attributes:u)[H]}};g.WhereClause=F;g.defaultAttributeAdapter=B;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(g,q,x,w){function C(e,l,b){return e<l?e-l:e>b?e-b:0}function r(e,l=!0){if(e instanceof w.Zone)return e;if("system"===e.toLowerCase())return"system";
if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return x.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const b=w.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(b)return b}e=w.IANAZone.create(e);if(!e.isValid){if(l)throw new k(g.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return e}g.ArcadeDateErrorCodes=void 0;(g.ArcadeDateErrorCodes||(g.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const m={[g.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class k extends Error{constructor(e,l){super(q.replace(m[e],l));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,k)}}class f{constructor(e){this._date=e;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,l=1,b=1,p=0,c=0,d=0,a=0,n){if(isNaN(e)||isNaN(l)||isNaN(b)||isNaN(p)||isNaN(c)||isNaN(d)||isNaN(a))return null;const t=
w.DateTime.local(e,l).daysInMonth;e=w.DateTime.fromObject({day:1>b?1:b>t?t:b,year:e,month:1>l?1:12<l?12:l,hour:0>p?0:23<p?23:p,minute:0>c?0:59<c?59:c,second:0>d?0:59<d?59:d,millisecond:0>a?0:999<a?999:a},{zone:r(n)});e=e.plus({months:C(l,1,12),days:C(b,1,t),hours:C(p,0,23),minutes:C(c,0,59),seconds:C(d,0,59),milliseconds:C(a,0,999)});return new f(e)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,l){l=
r(l);return e.isUnknownTimeZone||l===x.UnknownTimeZone.instance?f.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,l):new f(e._date.setZone(l))}static dateJSToArcadeDate(e){return new f(w.DateTime.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,l="system"){l=r(l);return new f(w.DateTime.fromJSDate(e,{zone:l}))}static unknownEpochToArcadeDate(e){return new f(w.DateTime.fromMillis(e,{zone:x.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(e){return new f(w.DateTime.fromMillis(e.getTime(),
{zone:x.UnknownTimeZone.instance}))}static epochToArcadeDate(e,l="system"){l=r(l);return new f(w.DateTime.fromMillis(e,{zone:l}))}static dateTimeToArcadeDate(e){return new f(e)}clone(){return new f(this._date)}changeTimeZone(e){e=r(e);return f.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(e,l){l=r(l);return e.zone===x.UnknownTimeZone.instance||l===x.UnknownTimeZone.instance?f.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,l):new f(e.setZone(l))}static nowToArcadeDate(e){e=
r(e);return new f(w.DateTime.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new f(w.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===f.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone!==e.isUnknownTimeZone?!1:this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===x.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=
this._date.weekday;6<e&&(e=0);return e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new f(this._date.plus(e))}diff(e,l="milliseconds"){return this._date.diff(e._date,l)[l]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,l){return this._date.toISOTime({suppressMilliseconds:e,
includeOffset:l&&!this.isUnknownTimeZone})}toFormat(e,l){this.isUnknownTimeZone&&(e=e.replaceAll("Z",""));return this._date.toFormat(e,l)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new f(this._date.toUTC())}toLocal(){return new f(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;
e=w.DateTime.fromISO(e,{setZone:!0});return new f(e)}}g.ArcadeDate=f;g.ArcadeDateError=k;g.ArcadeDateErrorMessages=m;g.createDateTimeZone=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/UnknownTimeZone":function(){define(["exports","../../chunks/datetime"],function(g,q){function x(C){return C instanceof q.Zone?C===w.instance?!0:!1:"unknown"===C?.toString().toLowerCase()?!0:!1}class w{}w.instance=new q.IANAZone("Etc/UTC");g.UnknownTimeZone=w;g.adoptTimeZone=function(C,
r){return q.DateTime.fromObject({day:C.day,year:C.year,month:C.month,hour:C.hour,minute:C.minute,second:C.second,millisecond:C.millisecond},{zone:r})};g.isUnknownTimeZone=x;g.substituteUnknownTimezone=function(C){return x(C)?w.instance:C};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(g,q){g.SqlErrorCodes=void 0;(function(m){m.InvalidFunctionParameters="InvalidFunctionParameters";
m.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";m.UnsupportedSqlFunction="UnsupportedSqlFunction";m.UnsupportedOperator="UnsupportedOperator";m.UnsupportedSyntax="UnsupportedSyntax";m.UnsupportedIsRhs="UnsupportedIsRhs";m.UnsupportedIsLhs="UnsupportedIsLhs";m.InvalidDataType="InvalidDataType";m.CannotCastValue="CannotCastValue";m.FunctionNotRecognized="FunctionNotRecognized";m.InvalidTime="InvalidTime";m.InvalidParameterCount="InvalidParameterCount";m.InvalidTimeStamp="InvalidTimeStamp";
m.InvalidDate="InvalidDate";m.InvalidOperator="InvalidOperator";m.IllegalInterval="IllegalInterval";m.YearMonthIntervals="YearMonthIntervals";m.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";m.MissingStatisticParameters="MissingStatisticParameters"})(g.SqlErrorCodes||(g.SqlErrorCodes={}));const x={[g.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[g.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[g.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",
[g.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[g.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[g.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[g.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[g.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[g.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[g.SqlErrorCodes.InvalidDate]:"Invalid date encountered",
[g.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[g.SqlErrorCodes.InvalidTime]:"Invalid time encountered",[g.SqlErrorCodes.IllegalInterval]:"Illegal interval",[g.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[g.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[g.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[g.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[g.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",
[g.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};class w extends Error{constructor(m,k){super(q.replace(x[m],k));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,w)}}g.FeatureSetErrorCodes=void 0;(function(m){m.NeverReach="NeverReach";m.NotImplemented="NotImplemented";m.Cancelled="Cancelled";m.InvalidStatResponse="InvalidStatResponse";m.InvalidRequest="InvalidRequest";m.RequestFailed="RequestFailed";
m.MissingFeatures="MissingFeatures";m.AggregationFieldNotFound="AggregationFieldNotFound";m.DataElementsNotFound="DataElementsNotFound"})(g.FeatureSetErrorCodes||(g.FeatureSetErrorCodes={}));const C={[g.FeatureSetErrorCodes.Cancelled]:"Cancelled",[g.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[g.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[g.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[g.FeatureSetErrorCodes.MissingFeatures]:"Missing features",
[g.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",[g.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[g.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[g.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class r extends Error{constructor(m,k){super(q.replace(C[m],k));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,r)}}g.FeatureSetError=
r;g.FeatureSetErrorMessages=C;g.SqlError=w;g.SqlErrorMessages=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(g,q,x,w,C,r){function m(l){if(null===l)return null;let b=0,p=0;for(let c=0;c<l.length;c++){const d=l[c];if(null!==d){if("number"!==typeof d)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);
p++;b+=d}}return 0===p?null:b/l.length}function k(l,b){if(null===l)return null;let p=null,c=null;for(const d of l)l=d,l=d instanceof x.DateOnly?d.toNumber():d instanceof C.TimeOnly?d.toNumber():d instanceof r.DateTime?d.toMillis():d instanceof w.SqlTimeStampOffset?d.toMilliseconds():d,null===p?(p=d,c=l):"max"===b&&null!==c&&null!==l&&c<=l?(p=d,c=l):"min"===b&&null!==c&&null!==l&&c>=l&&(p=d,c=l);return p}function f(l){if(null===l)return null;l=l.filter(c=>null!==c);if(0===l.length)return null;const b=
m(l);if(null===b)return null;let p=0;for(const c of l){if("number"!==typeof c)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);p+=(b-c)**2}return p/(l.length-1)}const e={min:{minParams:1,maxParams:1,evaluate:l=>k(l[0],"min")},max:{minParams:1,maxParams:1,evaluate:l=>k(l[0],"max")},avg:{minParams:1,maxParams:1,evaluate:l=>m(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>{l=l[0];if(null===l)l=null;else{var b=0;for(let p=0;p<l.length;p++){const c=l[p];if(null!==c){if("number"!==
typeof c)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);b+=c}}l=b}return l}},stddev:{minParams:1,maxParams:1,evaluate:l=>{l=l[0];null===l?l=null:(l=f(l),l=null===l?null:Math.sqrt(l));return l}},count:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>f(l[0])}};g.aggregateFunction=function(l,b){const p=e[l.toLowerCase()];if(null==p)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(b.length<p.minParams||b.length>
p.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:l.toUpperCase()});return p.evaluate(b)};g.isAggregate=function(l,b){l=e[l.toLowerCase()];return null!=l&&b>=l.minParams&&b<=l.maxParams};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(g,q,x,w){function C(m){m=m.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let k="";const f=
/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const e of m.match(f)||[])switch(e){case "D":k+="d";break;case "DD":k+="dd";break;case "DDD":k+="o";break;case "d":k+="c";break;case "ddd":k+="ccc";break;case "dddd":k+="cccc";break;case "M":k+="L";break;case "MM":k+="LL";break;case "MMM":k+="LLL";break;case "MMMM":k+="LLLL";break;case "YY":k+="yy";
break;case "Y":case "YYYY":k+="yyyy";break;case "Q":k+="q";break;case "X":case "x":k+=e;break;default:k=2<=e.length&&"["===e.slice(0,1)&&"]"===e.slice(-1)?k+`'${e.slice(1,-1)}'`:k+`'${e}'`}return k}class r{constructor(m,k,f){this._year=m;this._month=k;this._day=f;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(m){return m instanceof
r&&m.day===this.day&&m.month===this.month&&m.year===this.year}clone(){return new r(this._year,this._month,this._day)}toDateTime(m){return w.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(m)})}toDateTimeLuxon(m){return w.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(m)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(m=
null){if(null===m||""===m)return this.toString();m=C(m);if(!m)return"";const k=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(k).toFormat(m,{locale:x.getLocale(),numberingSystem:"latn"})}toArcadeDate(){const m=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(m)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd")}toSQLValue(){return this.toFormat("yyyy-LL-dd")}toSQLWithKeyword(){return"date '"+
this.toFormat("yyyy-LL-dd")+"'"}plus(m,k){return r.fromDateTime(this.toUTCDateTime().plus({[m]:k}))}toUTCDateTime(){return w.DateTime.utc(this.year,this.month,this.day,0,0,0,0)}difference(m,k){switch(k.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(m.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(m.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===k?this.toUTCDateTime().diff(m.toUTCDateTime(),
"months").months:this.toUTCDateTime().diff(m.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(m.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(m.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(m.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(m.toUTCDateTime(),
"years").years;default:return this.toUTCDateTime().diff(m.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(m){m=w.DateTime.fromMillis(m,{zone:w.FixedOffsetZone.utcInstance});return m.isValid?r.fromParts(m.year,m.month,m.day):null}static fromSeconds(m){m=w.DateTime.fromSeconds(m,{zone:w.FixedOffsetZone.utcInstance});return m.isValid?r.fromParts(m.year,m.month,m.day):null}static fromReader(m){if(!m)return null;m=m.split("-");return 3!==m.length?null:new r(parseInt(m[0],10),parseInt(m[1],
10),parseInt(m[2],10))}static fromParts(m,k,f){m=new r(m,k,f);return!1===m.isValid?null:m}static fromDateJS(m){return r.fromParts(m.getFullYear(),m.getMonth()+1,m.getDay())}static fromDateTime(m){return r.fromParts(m.year,m.month,m.day)}static fromSqlTimeStampOffset(m){return this.fromDateTime(m.toDateTime())}static fromString(m,k=null){if(""===m||null===m)return null;var f=[];if(k)(k=C(k))&&f.push(k);else if(null===k||""===k)return m=w.DateTime.fromISO(m,{setZone:!0}),m.isValid?r.fromParts(m.year,
m.month,m.day):null;for(const e of f)if(f=w.DateTime.fromFormat(m,k??e),f.isValid)return new r(f.year,f.month,f.day);return null}static fromNow(m="system"){m=w.DateTime.fromJSDate(new Date).setZone(q.createDateTimeZone(m));return new r(m.year,m.month,m.day)}}g.DateOnly=r;g.standardiseDateOnlyFormat=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(g,q){function x(C){return Number.isNaN(C)||
0===C?C:Math.trunc(C)}class w{constructor(C){this._timeStampOffset=C;this._date=null}toDateTime(){this._date??(this._date=q.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return x(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return x(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return w.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(C){return new w(q.DateTime.fromJSDate(C).toISO({includeOffset:!0}))}static fromDateTime(C){return new w(C.toISO({includeOffset:!0}))}static fromParts(C,
r,m=0,k=0,f=0,e=0,l=0,b=!1,p=0,c=0){C=`${C.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${m.toString().padStart(2,"0")}`;r="";10>e&&(r="0");k=`${k.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}:${r+e.toString()}`;0!==l&&(k+="."+l.toString().padStart(3,"0"));l=`${b?"-":"+"}${p.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`;return new w(C+"T"+k+l)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let C=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});C&&(C=C.replace(".000",""));return C}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(C){C=this.toDateTime().plus(C);return w.fromDateTime(C)}}g.SqlTimeStampOffset=w;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(g,q,x,w){function C(m){if(!m)return"";const k=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let f="";for(const e of m.match(k)||
[])switch(e){case "SSS":f+=e;break;case "A":case "a":f+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":f+=e;break;default:f+=`'${e}'`}return f}class r{constructor(m,k,f,e){this._hour=m;this._minute=k;this._second=f;this._millisecond=e;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(m){return m instanceof r&&m.hour===
this.hour&&m.minute===this.minute&&m.second===this.second&&m.millisecond===this.millisecond}clone(){return new r(this.hour,this.minute,this.second,this.millisecond)}isValid(){return q.isInteger(this.hour)&&q.isInteger(this.minute)&&q.isInteger(this.second)&&q.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(m=null){return null===m||""===m?this.toString():(m=C(m))?w.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(m,{locale:x.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(m,k,f,e){m=new r(m,k,f,e);return m.isValid()?m:null}static fromReader(m){if(!m)return null;m=m.split(":");return 3!==m.length?null:new r(parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],
10),0)}static fromMilliseconds(m){return 864E5<m||0>m?null:new r(Math.floor(m/36E5%24),Math.floor(m/6E4%60),Math.floor(m/1E3%60),Math.floor(m%1E3))}static fromDateJS(m){return new r(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds())}static fromDateTime(m){return new r(m.hour,m.minute,m.second,m.millisecond)}static fromSqlTimeStampOffset(m){return this.fromDateTime(m.toDateTime())}static fromString(m,k=null){if(""===m||null===m)return null;const f=[];if(k)(k=C(k))&&f.push(k);else if(null===
k||""===k)f.push("HH:mm:ss"),f.push("HH:mm:ss.SSS"),f.push("hh:mm:ss a"),f.push("hh:mm:ss.SSS a"),f.push("HH:mm"),f.push("hh:mm a"),f.push("H:mm"),f.push("h:mm a"),f.push("H:mm:ss"),f.push("h:mm:ss a"),f.push("H:mm:ss.SSS"),f.push("h:mm:ss.SSS a");for(const e of f)if(k=w.DateTime.fromFormat(m,e),k.isValid)return new r(k.hour,k.minute,k.second,k.millisecond);return null}plus(m,k){switch(m){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return r.fromDateTime(this.toUTCDateTime().plus({[m]:k}))}return null}toUTCDateTime(){return w.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(m,k){switch(k.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(m.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(m.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===k?this.toUTCDateTime().diff(m.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(m.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(m.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(m.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(m.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(m.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(m.toUTCDateTime(),"milliseconds").milliseconds}}}g.TimeOnly=r;g.standardiseTimeFormat=C;Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(g,q){g.cloneGeometry=function(x){if(null==x)return null;const w=x.clone();void 0!==x.cache._geVersion&&(w.cache._geVersion=x.cache._geVersion);return w};g.convertLinearUnitsToCode=function(x){if(null==x)return null;if("number"===typeof x)return x;x=x.toLowerCase();x=x.replaceAll(/\s/g,"");x=x.replaceAll("-","");switch(x){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};g.convertSquareUnitsToCode=
function(x){if(null==x)return null;if("number"===typeof x)return x;x=x.toLowerCase();x=x.replaceAll(/\s/g,"");x=x.replaceAll("-","");switch(x){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};g.isInteger=function(x){return"number"===typeof x&&isFinite(x)&&Math.floor(x)===x};g.sameGeomType=function(x,w){return x===w||"point"===x&&"esriGeometryPoint"===w||"polyline"===x&&"esriGeometryPolyline"===
w||"polygon"===x&&"esriGeometryPolygon"===w||"extent"===x&&"esriGeometryEnvelope"===w||"multipoint"===x&&"esriGeometryMultipoint"===w||"point"===w&&"esriGeometryPoint"===x||"polyline"===w&&"esriGeometryPolyline"===x||"polygon"===w&&"esriGeometryPolygon"===x||"extent"===w&&"esriGeometryEnvelope"===x||"multipoint"===w&&"esriGeometryMultipoint"===x?!0:!1};g.shapeExtent=function(x){if(null==x)return null;switch(x.type){case "polygon":case "multipoint":case "polyline":return x.extent;case "point":return new q({xmin:x.x,
ymin:x.y,xmax:x.x,ymax:x.y,spatialReference:x.spatialReference});case "extent":return x}return null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(g,q,x,w,C){function r(S,V,X){switch(X){case "+":return S+V;case "-":return S-V;case "*":return S*V;case "/":return S/V}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function m(S,V,X){switch(X){case "+":return V.plus({milliseconds:S.valueInMilliseconds()});case "-":return S.valueInMilliseconds()-V.toMillis()}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function k(S,V,X){switch(X){case "+":return V.plus("milliseconds",S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function f(S,V,X){switch(X){case "+":return V.plus("milliseconds",S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function e(S,
V,X){switch(X){case "+":return S.plus("milliseconds",V.valueInMilliseconds());case "-":return S.plus("milliseconds",-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function l(S,V,X){switch(X){case "+":return V.addMilliseconds(S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function b(S,V,X){switch(X){case "+":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()+V.valueInMilliseconds());case "-":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()-
V.valueInMilliseconds());case "*":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()*V.valueInMilliseconds());case "/":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()/V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function p(S,V,X){switch(X){case "+":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()+V);case "-":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()-V);case "*":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()*
V);case "/":return w.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()/V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function c(S,V,X){switch(X){case "+":return w.SqlInterval.createFromMilliseconds(S+V.valueInMilliseconds());case "-":return w.SqlInterval.createFromMilliseconds(S-V.valueInMilliseconds());case "*":return w.SqlInterval.createFromMilliseconds(S*V.valueInMilliseconds());case "/":return w.SqlInterval.createFromMilliseconds(S/V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function d(S,V,X){switch(X){case "+":return S.plus("milliseconds",V.valueInMilliseconds());case "-":return S.plus("milliseconds",-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function a(S,V,X){switch(X){case "+":return S.plus({milliseconds:V.valueInMilliseconds()});case "-":return S.minus({milliseconds:V.valueInMilliseconds()})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function n(S,V,X){switch(X){case "+":return S.addMilliseconds(V.valueInMilliseconds());
case "-":return S.addMilliseconds(-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function t(S,V,X){V*=864E5;switch(X){case "+":return S.plus({milliseconds:V});case "-":return S.minus({milliseconds:V})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function v(S,V,X){V*=864E5;switch(X){case "+":return S.plus("milliseconds",V);case "-":return S.plus("milliseconds",-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function y(S,V,X){V*=864E5;switch(X){case "+":return S.plus("milliseconds",
V);case "-":return S.plus("milliseconds",-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function h(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function A(S,V,X){V*=864E5;switch(X){case "+":return S.addMilliseconds(V);case "-":return S.addMilliseconds(-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function E(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function z(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function F(S,
V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function D(S,V,X){V=parseFloat(V);if(isNaN(V))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return r(S,V,X)}function B(S,V,X){S=parseFloat(S);if(isNaN(S))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return r(S,V,X)}function u(S,V,X){switch(X){case "+":return S+V}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function H(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function G(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function I(S,V,X){switch(X){case "-":return S.toDateTimeLuxon(V.zone).diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function J(S,V,X){switch(X){case "-":return S.toDateTimeLuxon(V.toDateTime().zone).diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function M(S,V,X){switch(X){case "-":return S.toDateTimeLuxon("UTC").diff(V.toDateTimeLuxon("UTC")).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function R(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function Y(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function fa(S,V,X){switch(X){case "-":return S.toDateTime().diff(V.toDateTimeLuxon(S.toDateTime().zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function O(S,V,X){switch(X){case "-":return S.toDateTime().diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function Q(S,V,X){switch(X){case "-":return S.toDateTime().diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function Z(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ba(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function da(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function P(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function U(S,V,X){switch(X){case "-":return S.diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ca(S,V,X){switch(X){case "-":return S.diff(V.toDateTimeLuxon(S.zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function la(S,V,X){switch(X){case "-":return S.diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function pa(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function na(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ra(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ua(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function L(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function T(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ia(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ka(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function qa(S,V,X){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}g.calculateDateOnlyAndDateOnly=M;g.calculateDateOnlyAndDateTime=I;g.calculateDateOnlyAndNumber=v;g.calculateDateOnlyAndSqlInterval=d;g.calculateDateOnlyAndString=na;g.calculateDateOnlyAndTimeOnly=R;g.calculateDateOnlyAndTimestamp=
J;g.calculateDateTimeAndDateOnly=ca;g.calculateDateTimeAndDateTime=U;g.calculateDateTimeAndNumber=t;g.calculateDateTimeAndSqlInterval=a;g.calculateDateTimeAndString=ua;g.calculateDateTimeAndTimeOnly=pa;g.calculateDateTimeAndTimestamp=la;g.calculateNumberAndDateOnly=F;g.calculateNumberAndDateTime=h;g.calculateNumberAndNumber=r;g.calculateNumberAndSqlInterval=c;g.calculateNumberAndString=D;g.calculateNumberAndTimeOnly=z;g.calculateNumberAndTimestamp=E;g.calculateSqlIntervalAndDateOnly=f;g.calculateSqlIntervalAndDateTime=
m;g.calculateSqlIntervalAndNumber=p;g.calculateSqlIntervalAndSqlInterval=b;g.calculateSqlIntervalAndString=H;g.calculateSqlIntervalAndTimeOnly=k;g.calculateSqlIntervalAndTimestamp=l;g.calculateStringAndDateOnly=ia;g.calculateStringAndDateTime=ka;g.calculateStringAndNumber=B;g.calculateStringAndSqlInterval=G;g.calculateStringAndString=u;g.calculateStringAndTimeOnly=T;g.calculateStringAndTimestamp=qa;g.calculateTimeOnlyAndDateOnly=ba;g.calculateTimeOnlyAndDateTime=Z;g.calculateTimeOnlyAndNumber=y;g.calculateTimeOnlyAndSqlInterval=
e;g.calculateTimeOnlyAndString=ra;g.calculateTimeOnlyAndTimeOnly=P;g.calculateTimeOnlyAndTimestamp=da;g.calculateTimestampAndDateOnly=fa;g.calculateTimestampAndDateTime=O;g.calculateTimestampAndNumber=A;g.calculateTimestampAndSqlInterval=n;g.calculateTimestampAndString=L;g.calculateTimestampAndTimeOnly=Y;g.calculateTimestampAndTimestamp=Q;g.sqlCalculateFunction=function(S,V,X,ha){if("||"===S)return C.evaluateFunction("concat",[V,X],ha);if(null===V||null===X)return null;if(x.isNumber(V)){if(x.isNumber(X))return r(V,
X,S);if(x.isSqlInterval(X))return c(V,X,S);if(x.isTimeOnly(X))return z();if(x.isDateOnly(X))return F();if(x.isTimestampOffset(X))return E();if(x.isDateTime(X))return h();if(x.isString(X))return D(V,X,S)}else if(x.isDateOnly(V)){if(x.isNumber(X))return v(V,X,S);if(x.isSqlInterval(X))return d(V,X,S);if(x.isTimeOnly(X))return R();if(x.isDateOnly(X))return M(V,X,S);if(x.isTimestampOffset(X))return J(V,X,S);if(x.isDateTime(X))return I(V,X,S);if(x.isString(X))return na()}else if(x.isTimeOnly(V)){if(x.isNumber(X))return y(V,
X,S);if(x.isSqlInterval(X))return e(V,X,S);if(x.isTimeOnly(X))return P();if(x.isDateOnly(X))return ba();if(x.isTimestampOffset(X))return da();if(x.isDateTime(X))return Z();if(x.isString(X))return ra()}else if(x.isSqlInterval(V)){if(x.isNumber(X))return p(V,X,S);if(x.isSqlInterval(X))return b(V,X,S);if(x.isTimeOnly(X))return k(V,X,S);if(x.isDateOnly(X))return f(V,X,S);if(x.isTimestampOffset(X))return l(V,X,S);if(x.isDateTime(X))return m(V,X,S);if(x.isString(X))return H()}else if(x.isDateTime(V)){if(x.isNumber(X))return t(V,
X,S);if(x.isSqlInterval(X))return a(V,X,S);if(x.isTimeOnly(X))return pa();if(x.isDateOnly(X))return ca(V,X,S);if(x.isTimestampOffset(X))return la(V,X,S);if(x.isDateTime(X))return U(V,X,S);if(x.isString(X))return ua()}else if(x.isTimestampOffset(V)){if(x.isNumber(X))return A(V,X,S);if(x.isSqlInterval(X))return n(V,X,S);if(x.isTimeOnly(X))return Y();if(x.isDateOnly(X))return fa(V,X,S);if(x.isTimestampOffset(X))return Q(V,X,S);if(x.isDateTime(X))return O(V,X,S);if(x.isString(X))return L()}else if(x.isString(V)){if(x.isNumber(X))return B(V,
X,S);if(x.isSqlInterval(X))return G();if(x.isTimeOnly(X))return T();if(x.isDateOnly(X))return ia();if(x.isTimestampOffset(X))return qa();if(x.isDateTime(X))return ka();if(x.isString(X))return u(V,X,S)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(g,q,x,w,C,r,m,k){function f(t,v,y){y=c.exec(t);if(null!==y){const [,h,A,E,z,F,D,B]=y;t=k.DateTime.fromObject({year:parseInt(h,10),month:parseInt(A,10),day:parseInt(E,10),hour:parseInt(z,10),minute:parseInt(F,10),second:parseInt(D,10),millisecond:B?parseInt(B.replace(".",""),10):0},{zone:m.substituteUnknownTimezone(v)});if(!1===t.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return t}y=d.exec(t);if(null!==y){const [,h,A,E,z,F,D,B,u,H,G]=y;t=C.SqlTimeStampOffset.fromParts(parseInt(h,
10),parseInt(A,10),parseInt(E,10),parseInt(z,10),parseInt(F,10),parseInt(D,10),B?parseInt(B.replace(".",""),10):0,"-"===u,parseInt(H,10),parseInt(G,10));if(!1===t.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return t}y=a.exec(t);if(null!==y){const [,h,A,E,z,F,D,B,u]=y;t=C.SqlTimeStampOffset.fromParts(parseInt(h,10),parseInt(A,10),parseInt(E,10),parseInt(z,10),parseInt(F,10),0,0,"-"===D,parseInt(B,10),parseInt(u,10));if(!1===t.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);
return t}y=n.exec(t);if(null!==y){const [,h,A,E,z,F]=y;t=k.DateTime.fromObject({year:parseInt(h,10),month:parseInt(A,10),day:parseInt(E,10),hour:parseInt(z,10),minute:parseInt(F,10),second:0},{zone:m.substituteUnknownTimezone(v)});if(!1===t.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return t}y=p.exec(t);if(null!==y){const [,h,A,E]=y;t=k.DateTime.fromObject({year:parseInt(h,10),month:parseInt(A,10),day:parseInt(E,10),hour:0,minute:0,second:0},{zone:m.substituteUnknownTimezone(v)});
if(!1===t.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return t}throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);}const e=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,l=/^(\d{1,2}):(\d{1,2})$/,b=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,a=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,
n=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;g.convertToExecutingTimeZone=function(t,v){if(v instanceof k.Zone)return v===m.UnknownTimeZone.instance?k.DateTime.fromMillis(t.getTime(),{zone:m.UnknownTimeZone.instance}):k.DateTime.fromJSDate(t,{zone:v});switch(v){case "system":case "local":case null:return k.DateTime.fromJSDate(t);default:return"unknown"===v?.toLowerCase()?k.DateTime.fromMillis(t.getTime(),{zone:m.UnknownTimeZone.instance}):k.DateTime.fromJSDate(t,{zone:v})}};g.isDate=function(t){return t instanceof
Date};g.isDateOnly=function(t){return t instanceof x.DateOnly};g.isDateTime=function(t){return t instanceof k.DateTime};g.isNumber=function(t){return"number"===typeof t};g.isSqlInterval=function(t){return t instanceof w.SqlInterval};g.isString=function(t){return"string"===typeof t||t instanceof String};g.isTimeOnly=function(t){return t instanceof r.TimeOnly};g.isTimestampOffset=function(t){return t instanceof C.SqlTimeStampOffset};g.parseDate=function(t,v){const y=p.exec(t);if(null===y)try{return f(t,
v)}catch{throw new q.SqlError(q.SqlErrorCodes.InvalidDate);}const [,h,A,E]=y;t=x.DateOnly.fromParts(parseInt(h,10),parseInt(A,10),parseInt(E,10));if(null===t)throw new q.SqlError(q.SqlErrorCodes.InvalidDate);return t};g.parseTime=function(t){let v=e.exec(t);if(null!==v){const [,y,h,A]=v;t=r.TimeOnly.fromParts(parseInt(y,10),parseInt(h,10),parseInt(A,10),0);if(null!==t)return t;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}v=l.exec(t);if(null!==v){const [,y,h]=v;t=r.TimeOnly.fromParts(parseInt(y,
10),parseInt(h,10),0,0);if(null!==t)return t;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}v=b.exec(t);if(null!==v){const [,y,h,A,E]=v;t=r.TimeOnly.fromParts(parseInt(y,10),parseInt(h,10),parseInt(A,10),parseInt(E,10));if(null!==t)return t}throw new q.SqlError(q.SqlErrorCodes.InvalidTime);};g.parseTimestamp=f;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(g,q){class x{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(w){if(null!==w.precision||null!==w.secondary)throw new q.SqlError(q.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(w,C){C.includes(".")?(C=C.split("."),w.second=parseFloat(C[0]),w.millis=parseInt(C[1],10)):w.second=parseFloat(C)}static createFromMilliseconds(w){const C=new x;C.second=w/1E3;return C}static createFromValueAndQualifer(w,C,r){let m=null;const k=new x;k.op="-"===
r?"-":"+";if("interval-period"===C.type){x._fixDefaults(C);r=RegExp("^[0-9]{1,}$");if("year"===C.period||"month"===C.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);if("second"===C.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(w))x._parseSecondsComponent(k,w);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);else if(r.test(w))k[C.period]=parseFloat(w);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}else{x._fixDefaults(C.start);x._fixDefaults(C.end);if("year"===
C.start.period||"month"===C.start.period||"year"===C.end.period||"month"===C.end.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);switch(C.start.period){case "day":switch(C.end.period){case "hour":m=RegExp("^[0-9]{1,} [0-9]{1,}$");if(m.test(w))k[C.start.period]=parseFloat(w.split(" ")[0]),k[C.end.period]=parseFloat(w.split(" ")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "minute":m=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(m.test(w))k[C.start.period]=
parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":m=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(m.test(w))k[C.start.period]=parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]),x._parseSecondsComponent(k,w[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(C.end.period){case "minute":m=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(m.test(w))k.hour=parseFloat(w.split(":")[0]),k.minute=parseFloat(w.split(":")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":m=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(m.test(w))w=w.split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]),x._parseSecondsComponent(k,w[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(C.end.period){case "second":m=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(m.test(w))w=w.split(":"),k.minute=parseFloat(w[0]),x._parseSecondsComponent(k,w[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}}return k}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}g.SqlInterval=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(g,q,x,w,C,r,m,k){function f(a){return"string"===typeof a||a instanceof String}function e(a){return r.isDate(a)||r.isDateOnly(a)||
r.isDateTime(a)||r.isTimeOnly(a)||r.isTimestampOffset(a)?!1:!0}function l(a){return r.isDateOnly(a)||r.isTimeOnly(a)?a.toString():r.isTimestampOffset(a)?a.toSQLValue():r.isDateTime(a)?0===a.millisecond?a.toFormat("yyyy-LL-dd HH:mm:ss"):a.toSQL({includeOffset:!1}):r.isDate(a)?l(k.DateTime.fromJSDate(a)):a.toString()}function b(a){if(r.isDate(a))return w.DateOnly.fromDateJS(a);if(r.isDateTime(a))return w.DateOnly.fromParts(a.year,a.month,a.day);if(r.isDateOnly(a))return a;if(r.isTimeOnly(a))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(r.isTimestampOffset(a)&&null===w.DateOnly.fromParts(a.year,a.month,a.day))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(f(a)&&(a=w.DateOnly.fromReader(a),null!==a&&a.isValid))return a;throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function p(a,n,t){if(r.isDate(a))return r.convertToExecutingTimeZone(a,n);if(r.isDateTime(a))return a;if(r.isDateOnly(a))return a.toDateTimeLuxon("unknown");if(r.isTimeOnly(a))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(r.isTimestampOffset(a))return a;
if(f(a))return r.parseTimestamp(a,"unknown",t);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function c(a){if(r.isDate(a))return m.TimeOnly.fromDateJS(a);if(r.isDateTime(a))return m.TimeOnly.fromDateTime(a);if(r.isDateOnly(a))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(r.isTimeOnly(a))return a;if(r.isTimestampOffset(a))return m.TimeOnly.fromSqlTimeStampOffset(a);if(f(a))return r.parseTime(a);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}const d={extract:{minParams:2,
maxParams:2,evaluate:([a,n])=>{if(null==n)return null;if(r.isDate(n))switch(a.toUpperCase()){case "SECOND":return n.getSeconds();case "MINUTE":return n.getMinutes();case "HOUR":return n.getHours();case "DAY":return n.getDate();case "MONTH":return n.getMonth()+1;case "YEAR":return n.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(r.isDateTime(n))switch(a.toUpperCase()){case "SECOND":return n.second;case "MINUTE":return n.minute;case "HOUR":return n.hour;case "DAY":return n.day;
case "MONTH":return n.month;case "YEAR":return n.year}else if(r.isDateOnly(n))switch(a.toUpperCase()){case "DAY":return n.day;case "MONTH":return n.month;case "YEAR":return n.year}else if(r.isTimeOnly(n))switch(a.toUpperCase()){case "SECOND":return n.second;case "MINUTE":return n.minute;case "HOUR":return n.hour}else if(r.isTimestampOffset(n))switch(a.toUpperCase()){case "SECOND":return n.second;case "MINUTE":return n.minute;case "HOUR":return n.hour;case "DAY":return n.day;case "MONTH":return n.month;
case "YEAR":return n.year;case "TIMEZONE_HOUR":return n.timezoneOffsetHour;case "TIMEZONE_MINUTE":return n.timezoneOffsetMinutes}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:a=>{if(2===a.length){const [n,t]=a;return null==n||null==t?null:n.toString().substring(t-1)}if(3===a.length){const [n,t,v]=a;return null==n||null==t||null==v?null:0>=v?"":n.toString().substring(t-1,t+v-1)}}},position:{minParams:2,maxParams:2,
evaluate:([a,n])=>null==a||null==n?null:n.indexOf(a)+1},trim:{minParams:2,maxParams:3,evaluate:a=>{var n=3===a.length,t=n?a[1]:" ";n=n?a[2]:a[1];if(null==t||null==n)return null;t=`(${x.escapeRegExpString(t)})`;switch(a[0]){case "BOTH":return n.replaceAll(new RegExp(`^${t}*|${t}*$`,"g"),"");case "LEADING":return n.replaceAll(new RegExp(`^${t}*`,"g"),"");case "TRAILING":return n.replaceAll(new RegExp(`${t}*$`,"g"),"")}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.abs(a[0])},ceiling:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.ceil(a[0])},floor:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.floor(a[0])},log:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])},log10:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sin(a[0])},cos:{minParams:1,maxParams:1,evaluate:a=>
null==a[0]?null:Math.cos(a[0])},tan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tan(a[0])},asin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.asin(a[0])},acos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.acos(a[0])},atan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.atan(a[0])},sign:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:0<a[0]?1:0>a[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]**a[1]},mod:{minParams:2,
maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]%a[1]},round:{minParams:1,maxParams:2,evaluate:a=>{const n=a[0];a=2===a.length?10**a[1]:1;return null==n?null:Math.round(n*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:a=>null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))},char_length:{minParams:1,maxParams:1,evaluate:a=>f(a[0])?a[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:a=>{let n="";for(let t=0;t<a.length;t++){if(null==a[t])return null;
n+=a[t].toString()}return n}},lower:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:a=>{for(const n of a)if(null!==n)return n;return null}},cosh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cosh(a[0])},sinh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sinh(a[0])},tanh:{minParams:1,maxParams:1,evaluate:a=>
null==a[0]?null:Math.tanh(a[0])},nullif:{minParams:2,maxParams:2,evaluate:(a,n)=>C.sqlCompare(a[0],a[1],"\x3d")?null:a[0]},cast:{minParams:2,maxParams:2,evaluate:(a,n)=>{const t=a[0];a=a[1];if(null===t)return null;switch(a.type){case "integer":if(!e(t))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);n=parseInt(t,10);if(isNaN(n))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return n;case "smallint":if(!e(t))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);n=parseInt(t,10);if(isNaN(n))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(32767<n||-32767>n)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return n;case "float":case "real":if(!e(t))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);n=parseFloat(t);if(isNaN(n))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return n;case "time":return c(t);case "date":return b(t);case "timestamp":return p(t,n,!0===a.withtimezone);case "varchar":n=l(t);if(n.length>a.size)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return n;default:throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);
}}}};g.evaluateFunction=function(a,n,t){const v=d[a.toLowerCase()];if(null==v)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(n.length<v.minParams||n.length>v.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:a.toUpperCase()});return v.evaluate(n,t)};g.isStandardized=function(a,n){a=d[a.toLowerCase()];return null!=a&&n>=a.minParams&&n<=a.maxParams};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(g,q,x,w,C,r){function m(a){return x.isDateTime(a)||x.isTimestampOffset(a)?!0:!1}function k(a){return x.isDateTime(a)||x.isDateOnly(a)||x.isTimestampOffset(a)||x.isTimeOnly(a)?!0:!1}function f(a){if(x.isDateTime(a))return a.toMillis();if(x.isDateOnly(a))return a.toNumber();if(x.isTimestampOffset(a))return a.toMilliseconds();throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);}function e(a,n,t){switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<
n;case "\x3e\x3d":return a>=n;case "\x3c\x3d":return a<=n}}function l(a,n,t){const v=parseFloat(n);if(!isNaN(v))return e(a,v,t);a=a.toString();switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<n;case "\x3e\x3d":return a>=n;case "\x3c\x3d":return a<=n}}function b(a,n,t){const v=parseFloat(a);if(!isNaN(v))return e(v,n,t);n=n.toString();switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<
n;case "\x3e\x3d":return a>=n;case "\x3c\x3d":return a<=n}}function p(a,n,t){switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<n;case "\x3e\x3d":return a>=n;case "\x3c\x3d":return a<=n}}function c(a,n,t){a instanceof w.SqlTimeStampOffset&&(a=a.toDateTime());n instanceof w.SqlTimeStampOffset&&(n=n.toDateTime());a=d(a);n=d(n);switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<n;case "\x3e\x3d":return a>=
n;case "\x3c\x3d":return a<=n}}function d(a){return 321408E5*a.year+26784E5*a.month+864E5*a.day+36E5*a.hour+6E4*a.minute+1E3*a.second+a.millisecond}g.dateValueInMilliseconds=f;g.isDateOrTimeValue=k;g.isDateTimeComparableValue=m;g.sqlCompare=function(a,n,t,v){if(null==a||null==n)return null;if(x.isNumber(a)){if(x.isNumber(n))return e(a,n,t);if(x.isString(n))return l(a,n,t);if(k(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}else if(x.isString(a)){if(x.isNumber(n))return b(a,n,t);if(x.isString(n))return p(a,n,t);if(x.isDateTime(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isTimeOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isTimestampOffset(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(x.isDateTime(a)){if(m(n)){if(a instanceof r.DateTime&&C.isUnknownTimeZone(a.zone)){if(n instanceof r.DateTime&&
!1===C.isUnknownTimeZone(n.zone)||n instanceof w.SqlTimeStampOffset)return c(a,n,t)}else if(n instanceof r.DateTime&&C.isUnknownTimeZone(n.zone)&&(a instanceof r.DateTime&&!1===C.isUnknownTimeZone(a.zone)||a instanceof w.SqlTimeStampOffset))return c(a,n,t);return e(f(a),f(n),t)}if(x.isString(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))return n=n.toDateTimeLuxon(a.zone),a=a.startOf("day"),e(a.toMillis(),n.toMillis(),t);if(x.isTimeOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(x.isNumber(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(x.isDateOnly(a)){if(x.isTimestampOffset(n))return a=a.toDateTimeLuxon(n.toDateTime().zone),n=n.startOfDay(),e(a.toMillis(),n.toMilliseconds(),t);if(x.isDateTime(n))return a=a.toDateTimeLuxon(n.zone),n=n.startOf("day"),e(a.toMillis(),n.toMillis(),t);if(x.isString(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))return e(a.toNumber(),n.toNumber(),t);if(x.isTimeOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(x.isNumber(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(x.isTimeOnly(a)){if(x.isTimeOnly(n))return e(a.toNumber(),n.toNumber(),t);if(x.isString(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isNumber(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(m(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(x.isTimestampOffset(a)){if(m(n))return n instanceof r.DateTime&&
C.isUnknownTimeZone(n.zone)?c(a,n,t):e(f(a),f(n),t);if(x.isString(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isDateOnly(n))return n=n.toDateTimeLuxon(a.toDateTime().zone),a=a.startOfDay(),e(a.toMilliseconds(),n.toMillis(),t);if(x.isTimeOnly(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(x.isNumber(n))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}switch(t){case "\x3c\x3e":return a!==n;case "\x3d":return a===n;case "\x3e":return a>n;case "\x3c":return a<n;case "\x3e\x3d":return a>=
n;case "\x3c\x3d":return a<=n}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(g,q){var x={exports:{}};x.exports;(function(r){(function(m,k){r.exports&&(r.exports=k())})(q.commonjsGlobal,function(){function m(f,e,l,b){f=Error.call(this,f);Object.setPrototypeOf&&Object.setPrototypeOf(f,m.prototype);f.expected=e;f.found=l;f.location=b;f.name="SyntaxError";return f}function k(f,e,l){l=
l||" ";if(f.length>e)return f;e-=f.length;l+=l.repeat(e);return f+l.slice(0,e)}(function(f,e){function l(){this.constructor=f}l.prototype=e.prototype;f.prototype=new l})(m,Error);m.prototype.format=function(f){var e="Error: "+this.message;if(this.location){var l=null,b;for(b=0;b<f.length;b++)if(f[b].source===this.location.source){l=f[b].text.split(/\r\n|\n|\r/g);break}f=this.location.start;b=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(f):f;var p=
this.location.source+":"+b.line+":"+b.column;if(l){var c=this.location.end,d=k("",b.line.toString().length," ");l=l[f.line-1];c=(f.line===c.line?c.column:l.length+1)-f.column||1;e+="\n --\x3e "+p+"\n"+d+" |\n"+b.line+" | "+l+"\n"+d+" | "+k("",f.column-1," ")+k("",c,"^")}else e+="\n at "+p}return e};m.buildMessage=function(f,e){function l(a){return a.charCodeAt(0).toString(16).toUpperCase()}function b(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,
"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+l(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+l(n)})}function p(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+l(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+l(n)})}function c(a){return d[a.type](a)}var d={literal:function(a){return'"'+
b(a.text)+'"'},class:function(a){var n=a.parts.map(function(t){return Array.isArray(t)?p(t[0])+"-"+p(t[1]):p(t)});return"["+(a.inverted?"^":"")+n.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){a=a.map(c);var n,t;a.sort();if(0<a.length){for(t=n=1;n<a.length;n++)a[n-1]!==a[n]&&(a[t]=a[n],t++);a.length=t}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,
-1).join(", ")+", or "+a[a.length-1]}}(f)+" but "+(e?'"'+b(e)+'"':"end of input")+" found."};return{SyntaxError:m,parse:function(f,e){function l(W,aa){aa=void 0!==aa?aa:d(ya,N);throw new m(W,null,null,aa);}function b(W,aa){return{type:"literal",text:W,ignoreCase:aa}}function p(W,aa,ea){return{type:"class",parts:W,inverted:aa,ignoreCase:ea}}function c(W){var aa=Md[W],ea;if(!aa){for(ea=W-1;!Md[ea];)ea--;aa=Md[ea];for(aa={line:aa.line,column:aa.column};ea<W;)10===f.charCodeAt(ea)?(aa.line++,aa.column=
1):aa.column++,ea++;Md[W]=aa}return aa}function d(W,aa,ea){var sa=c(W),Ca=c(aa);W={source:sb,start:{offset:W,line:sa.line,column:sa.column},end:{offset:aa,line:Ca.line,column:Ca.column}};ea&&sb&&"function"===typeof sb.offset&&(W.start=sb.offset(W.start),W.end=sb.offset(W.end));return W}function a(W){N<tb||(N>tb&&(tb=N,Fe=[]),Fe.push(W))}function n(){var W=N;wa();var aa=v();aa!==K?(wa(),ya=W,W=aa):(N=W,W=K);return W}function t(){var W=N;var aa=v();if(aa!==K){var ea=[];var sa=N;var Ca=wa();var Ha=Ta();
if(Ha!==K){var Ka=wa();var Ma=v();Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)}else N=sa,sa=K;for(;sa!==K;)ea.push(sa),sa=N,Ca=wa(),Ha=Ta(),Ha!==K?(Ka=wa(),Ma=v(),Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)):(N=sa,sa=K);ya=W;W={type:"expression-list"};aa=[aa];for(sa=0;sa<ea.length;sa++)aa.push(ea[sa][3]);W.value=aa}else N=W,W=K;return W}function v(){var W=N;var aa=y();if(aa!==K){var ea=[];var sa=N;var Ca=wa();var Ha=X();if(Ha!==K){var Ka=wa();var Ma=y();Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)}else N=sa,sa=K;
for(;sa!==K;)ea.push(sa),sa=N,Ca=wa(),Ha=X(),Ha!==K?(Ka=wa(),Ma=y(),Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)):(N=sa,sa=K);ya=W;W=jb(aa,ea)}else N=W,W=K;return W}function y(){var W=N;var aa=h();if(aa!==K){var ea=[];var sa=N;var Ca=wa();var Ha=V();if(Ha!==K){var Ka=wa();var Ma=h();Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)}else N=sa,sa=K;for(;sa!==K;)ea.push(sa),sa=N,Ca=wa(),Ha=V(),Ha!==K?(Ka=wa(),Ma=h(),Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)):(N=sa,sa=K);ya=W;W=jb(aa,ea)}else N=W,W=K;return W}function h(){var W=
N;var aa=S();if(aa===K){aa=N;if(33===f.charCodeAt(N)){var ea=cd;N++}else ea=K,0===ta&&a(ub);if(ea!==K){var sa=N;ta++;if(61===f.charCodeAt(N)){var Ca=Fc;N++}else Ca=K,0===ta&&a(cb);ta--;Ca===K?sa=void 0:(N=sa,sa=K);sa!==K?aa=ea=[ea,sa]:(N=aa,aa=K)}else N=aa,aa=K}aa!==K?(ea=wa(),sa=h(),sa!==K?(ya=W,W={type:"unary-expression",operator:"NOT",expr:sa}):(N=W,W=K)):(N=W,W=K);if(W===K){aa=N;W=F();if(W!==K){wa();ea=N;sa=[];Ca=N;var Ha=wa();var Ka=A();if(Ka!==K){var Ma=wa();var Yb=F();Yb!==K?Ca=Ha=[Ha,Ka,Ma,
Yb]:(N=Ca,Ca=K)}else N=Ca,Ca=K;if(Ca!==K)for(;Ca!==K;)sa.push(Ca),Ca=N,Ha=wa(),Ka=A(),Ka!==K?(Ma=wa(),Yb=F(),Yb!==K?Ca=Ha=[Ha,Ka,Ma,Yb]:(N=Ca,Ca=K)):(N=Ca,Ca=K);else sa=K;sa!==K&&(ya=ea,sa={type:"arithmetic",tail:sa});ea=sa;ea===K&&(ea=N,sa=z(),sa!==K?(wa(),Ca=Na(),Ca!==K?(wa(),Ca=t(),Ca!==K?(wa(),Ha=Pa(),Ha!==K?(ya=ea,ea={op:sa,right:Ca}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=z(),sa!==K?(wa(),Ca=Na(),Ca!==K?(wa(),Ca=Pa(),Ca!==K?(ya=ea,ea={op:sa,right:{type:"expression-list",
value:[]}}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=z(),sa!==K?(wa(),Ca=fa(),Ca!==K?(ya=ea,ea={op:sa,right:Ca}):(N=ea,ea=K)):(N=ea,ea=K))),ea===K&&(ea=N,Ha=S(),Ha!==K?(wa(),sa=ha(),sa!==K?(wa(),Ca=F(),Ca!==K?(wa(),Ka=V(),Ka!==K?(wa(),Ha=F(),Ha!==K?(ya=ea,ea={op:"NOT"+sa,right:{type:"expression-list",value:[Ca,Ha]}}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,Ha=ha(),Ha!==K?(wa(),sa=F(),sa!==K?(wa(),Ca=V(),Ca!==K?(wa(),Ka=F(),Ka!==K?(ya=ea,ea={op:Ha,
right:{type:"expression-list",value:[sa,Ka]}}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)),ea===K&&(ea=N,sa=ka(),sa!==K?(wa(),Ca=S(),Ca!==K?(wa(),Ca=F(),Ca!==K?(ya=ea,ea={op:sa+"NOT",right:Ca}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=ka(),sa!==K?(wa(),Ca=F(),Ca!==K?(ya=ea,ea={op:sa,right:Ca}):(N=ea,ea=K)):(N=ea,ea=K)),ea===K&&(ea=N,sa=E(),sa!==K?(wa(),Ca=P(),Ca!==K?(wa(),Ha=N,f.substr(N,6).toLowerCase()===nb?(Ka=f.substr(N,6),N+=6):(Ka=K,0===ta&&a(Nd)),Ka!==K?(Ka=N,ta++,Ma=
J(),ta--,Ma===K?Ka=void 0:(N=Ka,Ka=K),Ka!==K?(ya=Ha,Ha="ESCAPE"):(N=Ha,Ha=K)):(N=Ha,Ha=K),Ha!==K?(wa(),Ha=U(),Ha!==K?(ya=ea,ea={op:sa,right:Ca,escape:Ha.value}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=E(),sa!==K?(wa(),Ca=P(),Ca!==K?(ya=ea,ea={op:sa,right:Ca,escape:""}):(N=ea,ea=K)):(N=ea,ea=K))))));ea===K&&(ea=null);ya=aa;aa=ea;""==aa||void 0==aa||null==aa?aa=W:(ea=null,aa=ea="arithmetic"==aa.type?jb(W,aa.tail):db(aa.op,W,aa.right,aa.escape))}else N=aa,aa=K;W=aa}return W}
function A(){if(f.substr(N,2)===dd){var W=dd;N+=2}else W=K,0===ta&&a(kb);W===K&&(62===f.charCodeAt(N)?(W=ed,N++):(W=K,0===ta&&a(Gc)),W===K&&(f.substr(N,2)===Eb?(W=Eb,N+=2):(W=K,0===ta&&a(Od)),W===K&&(f.substr(N,2)===fd?(W=fd,N+=2):(W=K,0===ta&&a(Zb)),W===K&&(60===f.charCodeAt(N)?(W=Xa,N++):(W=K,0===ta&&a(Ge)),W===K&&(61===f.charCodeAt(N)?(W=Fc,N++):(W=K,0===ta&&a(cb)),W===K&&(f.substr(N,2)===Fb?(W=Fb,N+=2):(W=K,0===ta&&a(He))))))));return W}function E(){var W;var aa=W=N;var ea=S();if(ea!==K){var sa=
wa();var Ca=qa();Ca!==K?aa=ea=[ea,sa,Ca]:(N=aa,aa=K)}else N=aa,aa=K;aa!==K&&(ya=W,aa=aa[0]+" "+aa[2]);W=aa;W===K&&(W=qa());return W}function z(){var W;var aa=W=N;var ea=S();if(ea!==K){var sa=wa();var Ca=ia();Ca!==K?aa=ea=[ea,sa,Ca]:(N=aa,aa=K)}else N=aa,aa=K;aa!==K&&(ya=W,aa=aa[0]+" "+aa[2]);W=aa;W===K&&(W=ia());return W}function F(){var W=N;var aa=B();if(aa!==K){var ea=[];var sa=N;var Ca=wa();var Ha=D();if(Ha!==K){var Ka=wa();var Ma=B();Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)}else N=sa,sa=K;for(;sa!==
K;)ea.push(sa),sa=N,Ca=wa(),Ha=D(),Ha!==K?(Ka=wa(),Ma=B(),Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)):(N=sa,sa=K);ya=W;W=jb(aa,ea)}else N=W,W=K;return W}function D(){if(43===f.charCodeAt(N)){var W=pb;N++}else W=K,0===ta&&a(Hc);W===K&&(45===f.charCodeAt(N)?(W=vb,N++):(W=K,0===ta&&a(Ic)),W===K&&(f.substr(N,2)===$b?(W=$b,N+=2):(W=K,0===ta&&a(Pd))));return W}function B(){var W=N;var aa=H();if(aa!==K){var ea=[];var sa=N;var Ca=wa();var Ha=u();if(Ha!==K){var Ka=wa();var Ma=H();Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=
sa,sa=K)}else N=sa,sa=K;for(;sa!==K;)ea.push(sa),sa=N,Ca=wa(),Ha=u(),Ha!==K?(Ka=wa(),Ma=H(),Ma!==K?sa=Ca=[Ca,Ha,Ka,Ma]:(N=sa,sa=K)):(N=sa,sa=K);ya=W;W=jb(aa,ea)}else N=W,W=K;return W}function u(){if(42===f.charCodeAt(N)){var W=Sb;N++}else W=K,0===ta&&a(Ie);W===K&&(47===f.charCodeAt(N)?(W=Qd,N++):(W=K,0===ta&&a(Rd)));return W}function H(){var W=U();if(W===K){var aa=N;var ea=N;var sa=na();if(sa!==K){var Ca=ra();if(Ca!==K){var Ha=ua();Ha!==K?(ya=ea,ea=parseFloat(sa+Ca+Ha)):(N=ea,ea=K)}else N=ea,ea=K}else N=
ea,ea=K;ea===K&&(ea=N,sa=na(),sa!==K?(Ca=ra(),Ca!==K?(ya=ea,ea=parseFloat(sa+Ca)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=na(),sa!==K?(Ca=ua(),Ca!==K?(ya=ea,ea=parseFloat(sa+Ca)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=na(),sa!==K&&(ya=ea,sa=parseFloat(sa)),ea=sa)));var Ka=ea;if(Ka!==K){var Ma=N;ta++;var Yb=I();ta--;Yb===K?Ma=void 0:(N=Ma,Ma=K);Ma!==K?(ya=aa,aa={type:"number",value:Ka}):(N=aa,aa=K)}else N=aa,aa=K;W=aa;if(W===K){var ac=N;var Jc=N;if(f.substr(N,4).toLowerCase()===Je){var Sd=f.substr(N,
4);N+=4}else Sd=K,0===ta&&a(bc);if(Sd!==K){var gd=N;ta++;var Rf=J();ta--;Rf===K?gd=void 0:(N=gd,gd=K);gd!==K?Jc=Sd=[Sd,gd]:(N=Jc,Jc=K)}else N=Jc,Jc=K;var cc=Jc;cc!==K&&(ya=ac,cc={type:"boolean",value:!0});ac=cc;if(ac===K){ac=N;var Kc=N;if(f.substr(N,5).toLowerCase()===Td){var Ud=f.substr(N,5);N+=5}else Ud=K,0===ta&&a(Lc);if(Ud!==K){var hd=N;ta++;var Sf=J();ta--;Sf===K?hd=void 0:(N=hd,hd=K);hd!==K?Kc=Ud=[Ud,hd]:(N=Kc,Kc=K)}else N=Kc,Kc=K;cc=Kc;cc!==K&&(ya=ac,cc={type:"boolean",value:!1});ac=cc}W=ac;
if(W===K){var Tf=N;var Mc=N;if(f.substr(N,4).toLowerCase()===Ke){var Vd=f.substr(N,4);N+=4}else Vd=K,0===ta&&a(Tb);if(Vd!==K){var id=N;ta++;var Uf=J();ta--;Uf===K?id=void 0:(N=id,id=K);id!==K?Mc=Vd=[Vd,id]:(N=Mc,Mc=K)}else N=Mc,Mc=K;var Le=Mc;Le!==K&&(ya=Tf,Le={type:"null",value:null});W=Le;if(W===K){var dc=N;if(va()!==K){wa();var Wd=P();Wd!==K?(ya=dc,"string"===Wd.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Wd.value)&&
l("Date literal is invalid"),dc={type:"date",value:Wd.value}):(N=dc,dc=K)}else N=dc,dc=K;W=dc;if(W===K){var ec=N;if(oa()!==K){wa();var Xd=P();Xd!==K?(ya=ec,"string"===Xd.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Xd.value)&&
l("Timestamp literal is invalid"),ec={type:"timestamp",value:Xd.value}):(N=ec,ec=K)}else N=ec,ec=K;W=ec;if(W===K){var Ya=N;var Me=za();if(Me!==K){wa();if(45===f.charCodeAt(N)){var Gb=vb;N++}else Gb=K,0===ta&&a(Ic);Gb===K&&(43===f.charCodeAt(N)?(Gb=pb,N++):(Gb=K,0===ta&&a(Hc)));if(Gb!==K){wa();var jd=P();if(jd!==K){wa();var of=Q();of!==K?(ya=Ya,Ya={type:"interval",value:jd,qualifier:of,op:Gb}):(N=Ya,Ya=K)}else N=Ya,Ya=K}else N=Ya,Ya=K}else N=Ya,Ya=K;Ya===K&&(Ya=N,Me=za(),Me!==K?(wa(),Gb=P(),Gb!==K?
(wa(),jd=Q(),jd!==K?(ya=Ya,Ya={type:"interval",value:Gb,qualifier:jd,op:""}):(N=Ya,Ya=K)):(N=Ya,Ya=K)):(N=Ya,Ya=K));W=Ya;if(W===K){var fc=N;if(xa()!==K){wa();var Yd=P();Yd!==K?(ya=fc,"string"===Yd.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(Yd.value)&&l("Time literal is invalid"),fc={type:"time",value:Yd.value}):(N=fc,fc=K)}else N=fc,fc=K;W=fc}}}}}}}var Ra=W;if(Ra===K){var eb=N;var gc=N;if(f.substr(N,7).toLowerCase()===Zd){var pf=
f.substr(N,7);N+=7}else pf=K,0===ta&&a(hc);if(pf!==K){var $d=N;ta++;var Vf=J();ta--;Vf===K?$d=void 0:(N=$d,$d=K);$d!==K?(ya=gc,gc="EXTRACT"):(N=gc,gc=K)}else N=gc,gc=K;if(gc!==K){wa();var Wf=Na();if(Wf!==K){wa();var fb=Aa();if(fb===K&&(fb=Ba(),fb===K&&(fb=Ia(),fb===K&&(fb=Da(),fb===K&&(fb=Ga(),fb===K&&(fb=Fa(),fb===K)))))){var ic=N;if(f.substr(N,13).toLowerCase()===Nc){var qf=f.substr(N,13);N+=13}else qf=K,0===ta&&a(Xf);if(qf!==K){var ae=N;ta++;var Yf=J();ta--;Yf===K?ae=void 0:(N=ae,ae=K);ae!==K?
(ya=ic,ic="TIMEZONE_HOUR"):(N=ic,ic=K)}else N=ic,ic=K;fb=ic;if(fb===K){var jc=N;if(f.substr(N,15).toLowerCase()===Ne){var rf=f.substr(N,15);N+=15}else rf=K,0===ta&&a(Zf);if(rf!==K){var be=N;ta++;var $f=J();ta--;$f===K?be=void 0:(N=be,be=K);be!==K?(ya=jc,jc="TIMEZONE_MINUTE"):(N=jc,jc=K)}else N=jc,jc=K;fb=jc}}var sf=fb;if(sf!==K){wa();var ag=ja();if(ag!==K){wa();var tf=v();if(tf!==K){wa();var bg=Pa();bg!==K?(ya=eb,eb={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",
value:sf},tf]}}):(N=eb,eb=K)}else N=eb,eb=K}else N=eb,eb=K}else N=eb,eb=K}else N=eb,eb=K}else N=eb,eb=K;Ra=eb;if(Ra===K){var gb=N;var kc=N;if(f.substr(N,9).toLowerCase()===lc){var uf=f.substr(N,9);N+=9}else uf=K,0===ta&&a(wb);if(uf!==K){var ce=N;ta++;var cg=J();ta--;cg===K?ce=void 0:(N=ce,ce=K);ce!==K?(ya=kc,kc="SUBSTRING"):(N=kc,kc=K)}else N=kc,kc=K;if(kc!==K){wa();var dg=Na();if(dg!==K){wa();var Oe=v();if(Oe!==K){wa();var eg=ja();if(eg!==K){wa();var Pe=v();if(Pe!==K){wa();var Hb=N;var mc=N;if(f.substr(N,
3).toLowerCase()===kd){var vf=f.substr(N,3);N+=3}else vf=K,0===ta&&a(ld);if(vf!==K){var de=N;ta++;var fg=J();ta--;fg===K?de=void 0:(N=de,de=K);de!==K?(ya=mc,mc="FOR"):(N=mc,mc=K)}else N=mc,mc=K;var md=mc;if(md!==K){var gg=wa();var wf=v();if(wf!==K){var hg=wa();Hb=md=[md,gg,wf,hg]}else N=Hb,Hb=K}else N=Hb,Hb=K;Hb===K&&(Hb=null);md=Pa();md!==K?(ya=gb,gb={type:"function",name:"substring",args:{type:"expression-list",value:Hb?[Oe,Pe,Hb[2]]:[Oe,Pe]}}):(N=gb,gb=K)}else N=gb,gb=K}else N=gb,gb=K}else N=gb,
gb=K}else N=gb,gb=K}else N=gb,gb=K;Ra=gb;if(Ra===K){var Va=N;var Qe=ma();if(Qe!==K){wa();var Re=Na();if(Re!==K){wa();var Ib=O();Ib===K&&(Ib=null);wa();var nd=v();if(nd!==K){wa();var Se=ja();if(Se!==K){wa();var xf=v();if(xf!==K){wa();var ig=Pa();ig!==K?(ya=Va,Va={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ib?"BOTH":Ib},nd,xf]}}):(N=Va,Va=K)}else N=Va,Va=K}else N=Va,Va=K}else N=Va,Va=K}else N=Va,Va=K}else N=Va,Va=K;Va===K&&(Va=N,Qe=ma(),Qe!==K?(wa(),Re=
Na(),Re!==K?(wa(),Ib=O(),Ib===K&&(Ib=null),wa(),nd=v(),nd!==K?(wa(),Se=Pa(),Se!==K?(ya=Va,Va={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ib?"BOTH":Ib},nd]}}):(N=Va,Va=K)):(N=Va,Va=K)):(N=Va,Va=K)):(N=Va,Va=K));Ra=Va;if(Ra===K){var hb=N;var nc=N;if(f.substr(N,8).toLowerCase()===Te){var yf=f.substr(N,8);N+=8}else yf=K,0===ta&&a(od);if(yf!==K){var ee=N;ta++;var jg=J();ta--;jg===K?ee=void 0:(N=ee,ee=K);ee!==K?(ya=nc,nc="POSITION"):(N=nc,nc=K)}else N=nc,
nc=K;if(nc!==K){wa();var kg=Na();if(kg!==K){wa();var zf=v();if(zf!==K){wa();var lg=ia();if(lg!==K){wa();var Af=v();if(Af!==K){wa();var mg=Pa();mg!==K?(ya=hb,hb={type:"function",name:"position",args:{type:"expression-list",value:[zf,Af]}}):(N=hb,hb=K)}else N=hb,hb=K}else N=hb,hb=K}else N=hb,hb=K}else N=hb,hb=K}else N=hb,hb=K;Ra=hb;if(Ra===K){var ib=N;var oc=N;if(f.substr(N,4).toLowerCase()===Oc){var Bf=f.substr(N,4);N+=4}else Bf=K,0===ta&&a(fe);if(Bf!==K){var ge=N;ta++;var ng=J();ta--;ng===K?ge=void 0:
(N=ge,ge=K);ge!==K?(ya=oc,oc="CAST"):(N=oc,oc=K)}else N=oc,oc=K;if(oc!==K){wa();var og=Na();if(og!==K){wa();var Cf=v();if(Cf!==K){wa();var pc=N;if(f.substr(N,2).toLowerCase()===Jb){var Df=f.substr(N,2);N+=2}else Df=K,0===ta&&a(Ja);if(Df!==K){var he=N;ta++;var pg=J();ta--;pg===K?he=void 0:(N=he,he=K);he!==K?(ya=pc,pc="AS"):(N=pc,pc=K)}else N=pc,pc=K;var qg=pc;if(qg!==K){wa();var Oa=N;var qc=N;if(f.substr(N,7).toLowerCase()===Pc){var Ef=f.substr(N,7);N+=7}else Ef=K,0===ta&&a(Wa);if(Ef!==K){var ie=N;
ta++;var rg=J();ta--;rg===K?ie=void 0:(N=ie,ie=K);ie!==K?(ya=qc,qc="INTEGER"):(N=qc,qc=K)}else N=qc,qc=K;var Sa=qc;Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"integer"}});Oa=Sa;if(Oa===K){Oa=N;var rc=N;if(f.substr(N,8).toLowerCase()===pd){var Ff=f.substr(N,8);N+=8}else Ff=K,0===ta&&a(ab);if(Ff!==K){var je=N;ta++;var sg=J();ta--;sg===K?je=void 0:(N=je,je=K);je!==K?(ya=rc,rc="SMALLINT"):(N=rc,rc=K)}else N=rc,rc=K;Sa=rc;Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"smallint"}});Oa=Sa;if(Oa===
K){Oa=N;var sc=N;if(f.substr(N,5).toLowerCase()===Ub){var Gf=f.substr(N,5);N+=5}else Gf=K,0===ta&&a(xb);if(Gf!==K){var ke=N;ta++;var tg=J();ta--;tg===K?ke=void 0:(N=ke,ke=K);ke!==K?(ya=sc,sc="FLOAT"):(N=sc,sc=K)}else N=sc,sc=K;Sa=sc;Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"float"}});Oa=Sa;if(Oa===K){Oa=N;var tc=N;if(f.substr(N,4).toLowerCase()===Ue){var Hf=f.substr(N,4);N+=4}else Hf=K,0===ta&&a(ug);if(Hf!==K){var le=N;ta++;var vg=J();ta--;vg===K?le=void 0:(N=le,le=K);le!==K?(ya=tc,tc="REAL"):
(N=tc,tc=K)}else N=tc,tc=K;Sa=tc;Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"real"}});Oa=Sa;if(Oa===K&&(Oa=N,Sa=va(),Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"date"}}),Oa=Sa,Oa===K&&(Oa=N,Sa=oa(),Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"timestamp"}}),Oa=Sa,Oa===K&&(Oa=N,Sa=xa(),Sa!==K&&(ya=Oa,Sa={type:"data-type",value:{type:"time"}}),Oa=Sa,Oa===K)))){Oa=N;var uc=N;if(f.substr(N,7).toLowerCase()===lb){var If=f.substr(N,7);N+=7}else If=K,0===ta&&a(wg);if(If!==K){var me=N;ta++;var xg=
J();ta--;xg===K?me=void 0:(N=me,me=K);me!==K?(ya=uc,uc="VARCHAR"):(N=uc,uc=K)}else N=uc,uc=K;Sa=uc;if(Sa!==K){wa();var yg=Na();if(yg!==K){wa();var Jf=L();if(Jf!==K){wa();var zg=Pa();zg!==K?(ya=Oa,Oa={type:"data-type",value:{type:"varchar",size:parseInt(Jf)}}):(N=Oa,Oa=K)}else N=Oa,Oa=K}else N=Oa,Oa=K}else N=Oa,Oa=K}}}}var Kf=Oa;if(Kf!==K){wa();var Ag=Pa();Ag!==K?(ya=ib,ib={type:"function",name:"cast",args:{type:"expression-list",value:[Cf,Kf]}}):(N=ib,ib=K)}else N=ib,ib=K}else N=ib,ib=K}else N=ib,
ib=K}else N=ib,ib=K}else N=ib,ib=K;Ra=ib;if(Ra===K){var Kb=N;var mb=N;var qd=G();qd!==K&&(ya=mb);mb=qd;if(mb===K)if(mb=N,96===f.charCodeAt(N)?(qd=ne,N++):(qd=K,0===ta&&a(Lf)),qd!==K){var oe=[];if(vc.test(f.charAt(N))){var Lb=f.charAt(N);N++}else Lb=K,0===ta&&a(Mf);if(Lb!==K)for(;Lb!==K;)oe.push(Lb),vc.test(f.charAt(N))?(Lb=f.charAt(N),N++):(Lb=K,0===ta&&a(Mf));else oe=K;oe!==K?(96===f.charCodeAt(N)?(Lb=ne,N++):(Lb=K,0===ta&&a(Lf)),Lb!==K?(ya=mb,mb=oe.join("")):(N=mb,mb=K)):(N=mb,mb=K)}else N=mb,mb=
K;var Nf=mb;if(Nf!==K){wa();var Bg=Na();if(Bg!==K){wa();var pe=t();pe===K&&(pe=null);wa();var Cg=Pa();Cg!==K?(ya=Kb,Kb={type:"function",name:Nf,args:pe?pe:{type:"expression-list",value:[]}}):(N=Kb,Kb=K)}else N=Kb,Kb=K}else N=Kb,Kb=K;Ra=Kb;if(Ra===K){var yb;var Za=N;var Ve=Ea();if(Ve!==K){wa();var rd=v();if(rd!==K){wa();var sd=[];for(yb=la();yb!==K;)sd.push(yb),yb=la();yb=wa();var qe=La();qe!==K?(ya=Za,Za={type:"case-expression",format:"simple",operand:rd,clauses:sd,else:null}):(N=Za,Za=K)}else N=
Za,Za=K}else N=Za,Za=K;if(Za===K)if(Za=N,Ve=Ea(),Ve!==K)if(wa(),rd=v(),rd!==K){wa();sd=[];for(yb=la();yb!==K;)sd.push(yb),yb=la();yb=wa();qe=pa();if(qe!==K){wa();var Dg=La();Dg!==K?(ya=Za,Za={type:"case-expression",format:"simple",operand:rd,clauses:sd,else:qe.value}):(N=Za,Za=K)}else N=Za,Za=K}else N=Za,Za=K;else N=Za,Za=K;var We=Za;if(We===K){var zb;var bb=N;var Xe=Ea();if(Xe!==K){wa();var td=[];for(zb=ca();zb!==K;)td.push(zb),zb=ca();zb=wa();var re=La();re!==K?(ya=bb,bb={type:"case-expression",
format:"searched",clauses:td,else:null}):(N=bb,bb=K)}else N=bb,bb=K;if(bb===K)if(bb=N,Xe=Ea(),Xe!==K){wa();td=[];for(zb=ca();zb!==K;)td.push(zb),zb=ca();zb=wa();re=pa();if(re!==K){wa();var Eg=La();Eg!==K?(ya=bb,bb={type:"case-expression",format:"searched",clauses:td,else:re.value}):(N=bb,bb=K)}else N=bb,bb=K}else N=bb,bb=K;We=bb}Ra=We;if(Ra===K){var wc=N;var Fg=N;var se;var ud=N;var Of=I();if(Of!==K){var Pf=[];for(se=M();se!==K;)Pf.push(se),se=M();ya=ud;ud=Of+Pf.join("")}else N=ud,ud=K;var Qf=ud;
Qf!==K&&(ya=Fg);var Mb=Qf;if(Mb!==K){ya=wc;var Ye=Mb;Mb=/^CURRENT_DATE$/i.test(Ye)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ye)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Ye}}wc=Mb;if(wc===K){wc=N;var xc=N;if(Y()!==K){var te;var Gg=N;var Ze=[];for(te=R();te!==K;)Ze.push(te),te=R();ya=Gg;var Hg=Ze=Ze.join("");var Ig=Y();Ig!==K?(ya=xc,xc=Hg):(N=xc,xc=K)}else N=xc,xc=K;Mb=xc;Mb!==K&&(ya=wc,Mb={type:"column-reference",table:"",column:Mb,delimited:!0});
wc=Mb}Ra=wc;if(Ra===K&&(Ra=fa(),Ra===K)){Ra=N;var Jg=Na();if(Jg!==K){wa();var $e=v();if($e!==K){wa();var Kg=Pa();Kg!==K?(ya=Ra,$e.paren=!0,Ra=$e):(N=Ra,Ra=K)}else N=Ra,Ra=K}else N=Ra,Ra=K}}}}}}}}}return Ra}function G(){var W;var aa=N;var ea=I();if(ea!==K){var sa=[];for(W=J();W!==K;)sa.push(W),W=J();ya=aa;aa=ea+sa.join("")}else N=aa,aa=K;return aa}function I(){if(af.test(f.charAt(N))){var W=f.charAt(N);N++}else W=K,0===ta&&a(bf);return W}function J(){if(yc.test(f.charAt(N))){var W=f.charAt(N);N++}else W=
K,0===ta&&a(ue);return W}function M(){if(qb.test(f.charAt(N))){var W=f.charAt(N);N++}else W=K,0===ta&&a(vd);return W}function R(){if(qb.test(f.charAt(N))){var W=f.charAt(N);N++}else W=K,0===ta&&a(vd);if(W===K)if(W=N,Y()!==K){var aa=Y();aa!==K?(ya=W,W='"'):(N=W,W=K)}else N=W,W=K;return W}function Y(){if(Ab.test(f.charAt(N))){var W=f.charAt(N);N++}else W=K,0===ta&&a(zc);return W}function fa(){var W;var aa=W=N;if(64===f.charCodeAt(N)){var ea=cf;N++}else ea=K,0===ta&&a(Qc);if(ea!==K){var sa=G();sa!==
K?aa=ea=[ea,sa]:(N=aa,aa=K)}else N=aa,aa=K;aa!==K&&(ya=W,aa={type:"parameter",value:aa[1]});return aa}function O(){var W=N;if(f.substr(N,7).toLowerCase()===Ac){var aa=f.substr(N,7);N+=7}else aa=K,0===ta&&a(Rc);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="LEADING"):(N=W,W=K)}else N=W,W=K;W===K&&(W=N,f.substr(N,8).toLowerCase()===wd?(aa=f.substr(N,8),N+=8):(aa=K,0===ta&&a(xd)),aa!==K?(aa=N,ta++,ea=J(),ta--,ea===K?aa=void 0:(N=aa,aa=K),aa!==K?(ya=W,W="TRAILING"):
(N=W,W=K)):(N=W,W=K),W===K&&(W=N,f.substr(N,4).toLowerCase()===df?(aa=f.substr(N,4),N+=4):(aa=K,0===ta&&a(ef)),aa!==K?(aa=N,ta++,ea=J(),ta--,ea===K?aa=void 0:(N=aa,aa=K),aa!==K?(ya=W,W="BOTH"):(N=W,W=K)):(N=W,W=K)));return W}function Q(){var W=N;var aa=N;var ea=Z();if(ea!==K){wa();var sa=Na();if(sa!==K)if(wa(),sa=da(),sa!==K){wa();var Ca=Pa();Ca!==K?(ya=aa,aa={type:"interval-period",period:ea.value,precision:sa,secondary:null}):(N=aa,aa=K)}else N=aa,aa=K;else N=aa,aa=K}else N=aa,aa=K;aa===K&&(aa=
N,ea=Z(),ea!==K&&(ya=aa,ea={type:"interval-period",period:ea.value,precision:null,secondary:null}),aa=ea);if(aa!==K)if(wa(),ea=N,f.substr(N,2).toLowerCase()===Bb?(sa=f.substr(N,2),N+=2):(sa=K,0===ta&&a(Lg)),sa!==K?(sa=N,ta++,Ca=J(),ta--,Ca===K?sa=void 0:(N=sa,sa=K),sa!==K?(ya=ea,ea="TO"):(N=ea,ea=K)):(N=ea,ea=K),ea!==K){wa();ea=N;sa=Z();sa!==K&&(ya=ea,sa={type:"interval-period",period:sa.value,precision:null,secondary:null});ea=sa;if(ea===K){ea=N;sa=Fa();if(sa!==K)if(wa(),sa=Na(),sa!==K)if(wa(),sa=
da(),sa!==K)if(wa(),Ca=Ta(),Ca!==K)if(wa(),Ca=ba(),Ca!==K){wa();var Ha=Pa();Ha!==K?(ya=ea,ea={type:"interval-period",period:"second",precision:sa,secondary:Ca}):(N=ea,ea=K)}else N=ea,ea=K;else N=ea,ea=K;else N=ea,ea=K;else N=ea,ea=K;else N=ea,ea=K;ea===K&&(ea=N,sa=Fa(),sa!==K?(wa(),sa=Na(),sa!==K?(wa(),sa=da(),sa!==K?(wa(),Ca=Pa(),Ca!==K?(ya=ea,ea={type:"interval-period",period:"second",precision:sa,secondary:null}):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K)):(N=ea,ea=K),ea===K&&(ea=N,sa=Fa(),sa!==K&&
(ya=ea,sa={type:"interval-period",period:"second",precision:null,secondary:null}),ea=sa))}ea!==K?(ya=W,W={type:"interval-qualifier",start:aa,end:ea}):(N=W,W=K)}else N=W,W=K;else N=W,W=K;W===K&&(W=N,ea=Z(),ea!==K?(wa(),aa=Na(),aa!==K?(wa(),aa=ba(),aa!==K?(wa(),sa=Pa(),sa!==K?(ya=W,W={type:"interval-period",period:ea.value,precision:aa,secondary:null}):(N=W,W=K)):(N=W,W=K)):(N=W,W=K)):(N=W,W=K),W===K&&(W=N,ea=Z(),ea!==K&&(ya=W,ea={type:"interval-period",period:ea.value,precision:null,secondary:null}),
W=ea,W===K&&(W=N,ea=Fa(),ea!==K?(wa(),aa=Na(),aa!==K?(wa(),aa=da(),aa!==K?(wa(),sa=Ta(),sa!==K?(wa(),ea=ba(),ea!==K?(wa(),sa=Pa(),sa!==K?(ya=W,W={type:"interval-period",period:"second",precision:aa,secondary:ea}):(N=W,W=K)):(N=W,W=K)):(N=W,W=K)):(N=W,W=K)):(N=W,W=K)):(N=W,W=K),W===K&&(W=N,ea=Fa(),ea!==K?(wa(),aa=Na(),aa!==K?(wa(),aa=ba(),aa!==K?(wa(),sa=Pa(),sa!==K?(ya=W,W={type:"interval-period",period:"second",precision:aa,secondary:null}):(N=W,W=K)):(N=W,W=K)):(N=W,W=K)):(N=W,W=K),W===K&&(W=N,
ea=Fa(),ea!==K&&(ya=W,ea={type:"interval-period",period:"second",precision:null,secondary:null}),W=ea)))));return W}function Z(){var W=N;var aa=Ia();aa!==K&&(ya=W,aa={type:"string",value:"day"});W=aa;W===K&&(W=N,aa=Da(),aa!==K&&(ya=W,aa={type:"string",value:"hour"}),W=aa,W===K&&(W=N,aa=Ga(),aa!==K&&(ya=W,aa={type:"string",value:"minute"}),W=aa,W===K&&(W=N,aa=Ba(),aa!==K&&(ya=W,aa={type:"string",value:"month"}),W=aa,W===K&&(W=N,aa=Aa(),aa!==K&&(ya=W,aa={type:"string",value:"year"}),W=aa))));return W}
function ba(){var W=N;var aa=L();aa!==K&&(ya=W,aa=parseFloat(aa));return aa}function da(){var W=N;var aa=L();aa!==K&&(ya=W,aa=parseFloat(aa));return aa}function P(){var W=U();W===K&&(W=fa());return W}function U(){var W=N;if(39===f.charCodeAt(N)){var aa=Sc;N++}else aa=K,0===ta&&a(Cb);aa===K&&(f.substr(N,2)===Tc?(aa=Tc,N+=2):(aa=K,0===ta&&a(ve)));if(aa!==K){aa=[];var ea=N;if(f.substr(N,2)===Bc){var sa=Bc;N+=2}else sa=K,0===ta&&a(yd);sa!==K&&(ya=ea,sa="'");ea=sa;ea===K&&(ob.test(f.charAt(N))?(ea=f.charAt(N),
N++):(ea=K,0===ta&&a(zd)));for(;ea!==K;)aa.push(ea),ea=N,f.substr(N,2)===Bc?(sa=Bc,N+=2):(sa=K,0===ta&&a(yd)),sa!==K&&(ya=ea,sa="'"),ea=sa,ea===K&&(ob.test(f.charAt(N))?(ea=f.charAt(N),N++):(ea=K,0===ta&&a(zd)));39===f.charCodeAt(N)?(ea=Sc,N++):(ea=K,0===ta&&a(Cb));ea!==K?(ya=W,W={type:"string",value:aa.join("")}):(N=W,W=K)}else N=W,W=K;return W}function ca(){var W=N;if(Ua()!==K){wa();var aa=v();if(aa!==K){wa();var ea=$a();ea!==K?(wa(),ea=v(),ea!==K?(ya=W,W={type:"when-clause",operand:aa,value:ea}):
(N=W,W=K)):(N=W,W=K)}else N=W,W=K}else N=W,W=K;return W}function la(){var W=N;if(Ua()!==K){wa();var aa=v();if(aa!==K){wa();var ea=$a();ea!==K?(wa(),ea=v(),ea!==K?(ya=W,W={type:"when-clause",operand:aa,value:ea}):(N=W,W=K)):(N=W,W=K)}else N=W,W=K}else N=W,W=K;return W}function pa(){var W=N;var aa=N;if(f.substr(N,4).toLowerCase()===Ad){var ea=f.substr(N,4);N+=4}else ea=K,0===ta&&a(Mg);if(ea!==K){ea=N;ta++;var sa=J();ta--;sa===K?ea=void 0:(N=ea,ea=K);ea!==K?(ya=aa,aa="ELSE"):(N=aa,aa=K)}else N=aa,aa=
K;aa!==K?(wa(),aa=v(),aa!==K?(ya=W,W={type:"else-clause",value:aa}):(N=W,W=K)):(N=W,W=K);return W}function na(){var W=L();if(W===K){W=N;if(45===f.charCodeAt(N)){var aa=vb;N++}else aa=K,0===ta&&a(Ic);aa===K&&(43===f.charCodeAt(N)?(aa=pb,N++):(aa=K,0===ta&&a(Hc)));if(aa!==K){var ea=L();ea!==K?(ya=W,W=aa[0]+ea):(N=W,W=K)}else N=W,W=K}return W}function ra(){var W=N;if(46===f.charCodeAt(N)){var aa=we;N++}else aa=K,0===ta&&a(Uc);aa!==K?(aa=L(),aa===K&&(aa=null),ya=W,W="."+(null!=aa?aa:"")):(N=W,W=K);return W}
function ua(){var W;var aa=W=N;if(xe.test(f.charAt(N))){var ea=f.charAt(N);N++}else ea=K,0===ta&&a(Bd);ea!==K?(ff.test(f.charAt(N))?(ea=f.charAt(N),N++):(ea=K,0===ta&&a(rb)),ea===K&&(ea=null),ya=aa,aa="e"+(null===ea?"":ea)):(N=aa,aa=K);aa!==K?(ea=L(),ea!==K?(ya=W,W=aa+ea):(N=W,W=K)):(N=W,W=K);return W}function L(){var W=N;var aa=[];var ea=T();if(ea!==K)for(;ea!==K;)aa.push(ea),ea=T();else aa=K;aa!==K&&(ya=W,aa=aa.join(""));return aa}function T(){if(ye.test(f.charAt(N))){var W=f.charAt(N);N++}else W=
K,0===ta&&a(ze);return W}function ia(){var W=N;if(f.substr(N,2).toLowerCase()===Nb){var aa=f.substr(N,2);N+=2}else aa=K,0===ta&&a(Cd);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="IN"):(N=W,W=K)}else N=W,W=K;return W}function ka(){var W=N;if(f.substr(N,2).toLowerCase()===Dd){var aa=f.substr(N,2);N+=2}else aa=K,0===ta&&a(Ed);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="IS"):(N=W,W=K)}else N=W,W=K;return W}function qa(){var W=
N;if(f.substr(N,4).toLowerCase()===Ob){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Cc);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="LIKE"):(N=W,W=K)}else N=W,W=K;return W}function S(){var W=N;if(f.substr(N,3).toLowerCase()===Ae){var aa=f.substr(N,3);N+=3}else aa=K,0===ta&&a(Fd);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="NOT"):(N=W,W=K)}else N=W,W=K;return W}function V(){var W=N;if(f.substr(N,3).toLowerCase()===Vb){var aa=
f.substr(N,3);N+=3}else aa=K,0===ta&&a(Vc);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="AND"):(N=W,W=K)}else N=W,W=K;return W}function X(){var W=N;if(f.substr(N,2).toLowerCase()===Be){var aa=f.substr(N,2);N+=2}else aa=K,0===ta&&a(Ce);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="OR"):(N=W,W=K)}else N=W,W=K;return W}function ha(){var W=N;if(f.substr(N,7).toLowerCase()===Wb){var aa=f.substr(N,7);N+=7}else aa=K,0===ta&&a(gf);if(aa!==
K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="BETWEEN"):(N=W,W=K)}else N=W,W=K;return W}function ja(){var W=N;if(f.substr(N,4).toLowerCase()===Dc){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(hf);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="FROM"):(N=W,W=K)}else N=W,W=K;return W}function ma(){var W=N;if(f.substr(N,4).toLowerCase()===Ec){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Pb);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=
void 0:(N=aa,aa=K);aa!==K?(ya=W,W="TRIM"):(N=W,W=K)}else N=W,W=K;return W}function oa(){var W=N;if(f.substr(N,9).toLowerCase()===Gd){var aa=f.substr(N,9);N+=9}else aa=K,0===ta&&a(De);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="TIMESTAMP"):(N=W,W=K)}else N=W,W=K;return W}function va(){var W=N;if(f.substr(N,4).toLowerCase()===Wc){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(jf);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="DATE"):
(N=W,W=K)}else N=W,W=K;return W}function xa(){var W=N;if(f.substr(N,4).toLowerCase()===Xc){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(kf);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="TIME"):(N=W,W=K)}else N=W,W=K;return W}function za(){var W=N;if(f.substr(N,8).toLowerCase()===Hd){var aa=f.substr(N,8);N+=8}else aa=K,0===ta&&a(Ng);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="INTERVAL"):(N=W,W=K)}else N=W,W=K;return W}function Aa(){var W=
N;if(f.substr(N,4).toLowerCase()===Id){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Og);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="YEAR"):(N=W,W=K)}else N=W,W=K;return W}function Ba(){var W=N;if(f.substr(N,5).toLowerCase()===Qb){var aa=f.substr(N,5);N+=5}else aa=K,0===ta&&a(Pg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="MONTH"):(N=W,W=K)}else N=W,W=K;return W}function Ia(){var W=N;if(f.substr(N,3).toLowerCase()===Yc){var aa=
f.substr(N,3);N+=3}else aa=K,0===ta&&a(Qg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="DAY"):(N=W,W=K)}else N=W,W=K;return W}function Da(){var W=N;if(f.substr(N,4).toLowerCase()===Jd){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Rg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="HOUR"):(N=W,W=K)}else N=W,W=K;return W}function Ga(){var W=N;if(f.substr(N,6).toLowerCase()===Zc){var aa=f.substr(N,6);N+=6}else aa=K,0===ta&&a(Sg);
if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="MINUTE"):(N=W,W=K)}else N=W,W=K;return W}function Fa(){var W=N;if(f.substr(N,6).toLowerCase()===lf){var aa=f.substr(N,6);N+=6}else aa=K,0===ta&&a(Tg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="SECOND"):(N=W,W=K)}else N=W,W=K;return W}function Ea(){var W=N;if(f.substr(N,4).toLowerCase()===Rb){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Ug);if(aa!==K){aa=N;ta++;var ea=J();ta--;
ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="CASE"):(N=W,W=K)}else N=W,W=K;return W}function La(){var W=N;if(f.substr(N,3).toLowerCase()===$c){var aa=f.substr(N,3);N+=3}else aa=K,0===ta&&a(Vg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="END"):(N=W,W=K)}else N=W,W=K;return W}function Ua(){var W=N;if(f.substr(N,4).toLowerCase()===Kd){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Wg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,
W="WHEN"):(N=W,W=K)}else N=W,W=K;return W}function $a(){var W=N;if(f.substr(N,4).toLowerCase()===Db){var aa=f.substr(N,4);N+=4}else aa=K,0===ta&&a(Xg);if(aa!==K){aa=N;ta++;var ea=J();ta--;ea===K?aa=void 0:(N=aa,aa=K);aa!==K?(ya=W,W="THEN"):(N=W,W=K)}else N=W,W=K;return W}function Ta(){if(44===f.charCodeAt(N)){var W=Xb;N++}else W=K,0===ta&&a(Yg);return W}function Na(){if(40===f.charCodeAt(N)){var W=ad;N++}else W=K,0===ta&&a(Zg);return W}function Pa(){if(41===f.charCodeAt(N)){var W=Ee;N++}else W=K,
0===ta&&a($g);return W}function wa(){var W;var aa=[];for(W=Qa();W!==K;)aa.push(W),W=Qa();return aa}function Qa(){if(mf.test(f.charAt(N))){var W=f.charAt(N);N++}else W=K,0===ta&&a(ah);return W}function db(W,aa,ea,sa){W={type:"binary-expression",operator:W,left:aa,right:ea};void 0!==sa&&(W.escape=sa);return W}function jb(W,aa){for(var ea=0;ea<aa.length;ea++)W=db(aa[ea][1],W,aa[ea][3]);return W}e=void 0!==e?e:{};var K={},sb=e.grammarSource,bd={start:n},Ld=n,cd="!",Fc="\x3d",dd="\x3e\x3d",ed="\x3e",Eb=
"\x3c\x3d",fd="\x3c\x3e",Xa="\x3c",Fb="!\x3d",pb="+",vb="-",$b="||",Sb="*",Qd="/",cf="@",Sc="'",Tc="N'",Bc="''",we=".",Ke="null",Je="true",Td="false",Nb="in",Dd="is",Ob="like",nb="escape",Ae="not",Vb="and",Be="or",Wb="between",Dc="from",kd="for",lc="substring",Zd="extract",Ec="trim",Te="position",Gd="timestamp",Wc="date",Xc="time",Ac="leading",wd="trailing",df="both",Oc="cast",Jb="as",Pc="integer",pd="smallint",Ub="float",Ue="real",lb="varchar",Bb="to",Hd="interval",Id="year",Nc="timezone_hour",Ne=
"timezone_minute",Qb="month",Yc="day",Jd="hour",Zc="minute",lf="second",Rb="case",$c="end",Kd="when",Db="then",Ad="else",Xb=",",ad="(",Ee=")",ne="`",af=/^[A-Za-z_\x80-\uFFFF]/,yc=/^[A-Za-z0-9_]/,qb=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ab=/^["]/,ob=/^[^']/,ye=/^[0-9]/,xe=/^[eE]/,ff=/^[+\-]/,mf=/^[ \t\n\r]/,vc=/^[^`]/,ub=b("!",!1),cb=b("\x3d",!1),kb=b("\x3e\x3d",!1),Gc=b("\x3e",!1),Od=b("\x3c\x3d",!1),Zb=b("\x3c\x3e",!1),Ge=b("\x3c",!1),He=b("!\x3d",!1),Hc=b("+",!1),Ic=b("-",!1),Pd=b("||",!1),Ie=b("*",!1),Rd=
b("/",!1),bf=p([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),ue=p([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),vd=p([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),zc=p(['"'],!1,!1),Qc=b("@",!1),Cb=b("'",!1),ve=b("N'",!1),yd=b("''",!1),zd=p(["'"],!0,!1),Uc=b(".",!1),ze=p([["0","9"]],!1,!1),Bd=p(["e","E"],!1,!1),rb=p(["+","-"],!1,!1),Tb=b("NULL",!0),bc=b("TRUE",!0),Lc=b("FALSE",!0),Cd=b("IN",!0),Ed=b("IS",!0),Cc=b("LIKE",!0),Nd=b("ESCAPE",!0),Fd=b("NOT",!0),Vc=b("AND",!0),Ce=
b("OR",!0),gf=b("BETWEEN",!0),hf=b("FROM",!0),ld=b("FOR",!0),wb=b("SUBSTRING",!0),hc=b("EXTRACT",!0),Pb=b("TRIM",!0),od=b("POSITION",!0),De=b("TIMESTAMP",!0),jf=b("DATE",!0),kf=b("TIME",!0),Rc=b("LEADING",!0),xd=b("TRAILING",!0),ef=b("BOTH",!0),fe=b("CAST",!0),Ja=b("AS",!0),Wa=b("INTEGER",!0),ab=b("SMALLINT",!0),xb=b("FLOAT",!0),ug=b("REAL",!0),wg=b("VARCHAR",!0),Lg=b("TO",!0),Ng=b("INTERVAL",!0),Og=b("YEAR",!0),Xf=b("TIMEZONE_HOUR",!0),Zf=b("TIMEZONE_MINUTE",!0),Pg=b("MONTH",!0),Qg=b("DAY",!0),Rg=
b("HOUR",!0),Sg=b("MINUTE",!0),Tg=b("SECOND",!0),Ug=b("CASE",!0),Vg=b("END",!0),Wg=b("WHEN",!0),Xg=b("THEN",!0),Mg=b("ELSE",!0),Yg=b(",",!1),Zg=b("(",!1),$g=b(")",!1),ah=p([" ","\t","\n","\r"],!1,!1),Lf=b("`",!1),Mf=p(["`"],!0,!1),N=0,ya=0,Md=[{line:1,column:1}],tb=0,Fe=[],ta=0;if("startRule"in e){if(!(e.startRule in bd))throw Error("Can't start parsing from rule \""+e.startRule+'".');Ld=bd[e.startRule]}var nf=Ld();if(nf!==K&&N===f.length)return nf;nf!==K&&N<f.length&&a({type:"end"});throw function(W,
aa,ea){return new m(m.buildMessage(W,aa),W,aa,ea)}(Fe,tb<f.length?f.charAt(tb):null,tb<f.length?d(tb,tb+1):d(tb,tb));}}})})(x);var w=x.exports;class C{static parse(r){return w.parse(r)}}g.WhereGrammar=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/fieldType":function(){define(["exports","../../core/jsonMap"],function(g,q){q=new q.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",
esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});g.kebabDict=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(g,q,x){const w=new x,C=new x,r=new x,m={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,esriGeometryPolygon:q.convertToPolygon,esriGeometryMultipoint:q.convertToMultipoint},k=(f,e)=>"_geVersion"!==f?e:void 0;g.cleanFromGeometryEngine=function(f){return f&&"_geVersion"in f?JSON.parse(JSON.stringify(f,k)):f};g.getGeometry=function(f,e,l,b,p,
c,d=e,a=l){const n=e&&d,t=l&&a;b=null!=b?"coords"in b?b:b.geometry:null;if(null==b)return null;if(p)return e=q.generalizeOptimizedGeometry(C,b,e,l,f,p,d,a),c&&(e=q.quantizeOptimizedGeometry(r,e,n,t,f,c)),m[f]?.(e,n,t)??null;if(c)return c=q.quantizeOptimizedGeometry(r,b,e,l,f,c,d,a),m[f]?.(c,n,t)??null;q.removeZMValues(w,b,e,l,d,a);return m[f]?.(w,n,t)??null};g.transformCentroid=function(f,e,l,b=f.hasZ,p=f.hasM){if(null==e)return null;const c=f.hasZ&&b,d=f.hasM&&p;return l?(f=q.quantizeOptimizedGeometry(r,
e,f.hasZ,f.hasM,"esriGeometryPoint",l,b,p),q.convertToPoint(f,c,d)):q.convertToPoint(e,c,d)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(g,q,x,w,C,r,m){function k(a,n){if(!n)return null;
if("x"in n){var t={x:0,y:0};[t.x,t.y]=a(n.x,n.y,l);null!=n.z&&(t.z=n.z);null!=n.m&&(t.m=n.m);return t}return"xmin"in n?(t={xmin:0,ymin:0,xmax:0,ymax:0},[t.xmin,t.ymin]=a(n.xmin,n.ymin,l),[t.xmax,t.ymax]=a(n.xmax,n.ymax,l),n.hasZ&&(t.zmin=n.zmin,t.zmax=n.zmax,t.hasZ=!0),n.hasM&&(t.mmin=n.mmin,t.mmax=n.mmax,t.hasM=!0),t):"rings"in n?{rings:f(n.rings,a),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:f(n.paths,a),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:e(n.points,a),hasM:n.hasM,hasZ:n.hasZ}:null}function f(a,
n){const t=[];for(const v of a)t.push(e(v,n));return t}function e(a,n){const t=[];for(const v of a)a=n(v[0],v[1],[0,0]),t.push(a),2<v.length&&a.push(v[2]),3<v.length&&a.push(v[3]);return t}const l=[0,0],b=k.bind(null,m.lngLatToXY),p=k.bind(null,m.xyToLngLat);class c{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(a,n,t,v){if(!a?.length||!n||!t||r.equals(n,t))return a;a={geometries:a,inSpatialReference:n,outSpatialReference:t,geographicTransformation:v,
resolve:x.createResolver()};this._jobs.push(a);this._timer??(this._timer=setTimeout(this._process,10));return a.resolve.promise}_process(){this._timer=null;const a=this._jobs.shift();if(a){var {geometries:n,inSpatialReference:t,outSpatialReference:v,resolve:y,geographicTransformation:h}=a;m.canProject(t,v)?r.isWebMercator(v)?y(n.map(b)):y(n.map(p)):y(w.projectMany(C.jsonAdapter,n,t,v,h,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const d=new c;g.checkProjectionSupport=
async function(a,n){a&&n&&(a=Array.isArray(a)?a.map(t=>null!=t.geometry?t.geometry.spatialReference:null).filter(q.isSome):[a],await w.initializeProjection(a.map(t=>({source:t,dest:n}))))};g.project=function(a,n,t,v){if(!a)return a;t||(t=n,n=a.spatialReference);return r.isValid(n)&&r.isValid(t)&&!r.equals(n,t)?m.canProject(n,t)?(a=r.isWebMercator(t)?b(a):p(a),a.spatialReference=t,a):w.projectMany(C.jsonAdapter,[a],n,t,null,v)[0]:a};g.projectMany=function(a,n,t,v){return d.push(a,n,t,v)};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(g){class q{constructor(m,k,f){this.x=m;this.y=k;this.spatialReference=f;this.m=this.z=void 0}}class x{constructor(m,k,f,e){this.rings=m;this.spatialReference=k;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)}}class w{constructor(m,k,f,e){this.paths=m;this.spatialReference=k;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)}}class C{constructor(m,k,f,e){this.points=
m;this.spatialReference=k;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)}}class r{constructor(m,k,f,e,l){this.xmin=m;this.ymin=k;this.xmax=f;this.ymax=e;this.spatialReference=l;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}g.jsonAdapter={convertToGEGeometry:function(m,k){return null==k?null:m.convertJSONToGeometry(k)},exportPoint:function(m,k,f){f=new q(m.getPointX(k),m.getPointY(k),f);const e=m.hasZ(k),l=m.hasM(k);e&&(f.z=m.getPointZ(k));l&&(f.m=m.getPointM(k));return f},exportPolygon:function(m,
k,f){return new x(m.exportPaths(k),f,m.hasZ(k),m.hasM(k))},exportPolyline:function(m,k,f){return new w(m.exportPaths(k),f,m.hasZ(k),m.hasM(k))},exportMultipoint:function(m,k,f){return new C(m.exportPoints(k),f,m.hasZ(k),m.hasM(k))},exportExtent:function(m,k,f){var e=m.hasZ(k);const l=m.hasM(k);f=new r(m.getXMin(k),m.getYMin(k),m.getXMax(k),m.getYMax(k),f);e&&(e=m.getZExtent(k),f.zmin=e.vmin,f.zmax=e.vmax);l&&(m=m.getMExtent(k),f.mmin=m.vmin,f.mmax=m.vmax);return f}};Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(g){g.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,
supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,
tileMaxRecordCount:void 0};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),function(g,
q,x,w,C,r,m,k,f,e,l,b,p){function c(t,v,y,h){const A=h.x-y.x;h=h.y-y.y;v=Math.min(1,Math.max(0,((v.x-y.x)*A+(v.y-y.y)*h)/(A*A+h*h)));t.x=y.x+A*v;t.y=y.y+h*v}function d(t,v){return t?v?4:3:v?3:2}class a{constructor(t,v,y){this.items=t;this.query=v;this.geometryType=y.geometryType;this.hasM=y.hasM;this.hasZ=y.hasZ;this.fieldsIndex=y.fieldsIndex;this.objectIdField=y.objectIdField;this.spatialReference=y.spatialReference;this.featureAdapter=y.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=
new k(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const {groupByFieldsForStatistics:v,having:y,outStatistics:h}=this.query;if(!v?.length)return 1;const A=new Map,E=new Map,z=new Set;for(const B of h){var {statisticType:F}=B;F="exceedslimit"!==F?B.onStatisticField:void 0;if(!E.has(F)){var D=[];for(const u of v){const H=this._getAttributeValues(t,u,A);D.push(H)}E.set(F,this._calculateUniqueValues(D,t.returnDistinctValues))}F=
E.get(F);for(const u in F){const {data:H,items:G}=F[u];D=H.join(",");y&&!t.validateItems(G,y)||z.add(D)}}return z.size}async createQueryResponse(){let t;t=this.query.outStatistics?this.query.outStatistics.some(v=>"exceedslimit"===v.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const v=this.query.geometry;m.isValid(this.query.outSR)&&!m.equals(v.spatialReference,
this.query.outSR)?t.queryGeometry=f.cleanFromGeometryEngine({spatialReference:this.query.outSR,...e.project(v,v.spatialReference,this.query.outSR)}):t.queryGeometry=f.cleanFromGeometryEngine({spatialReference:this.query.outSR,...v})}return t}createSnappingResponse(t,v){const y=this.featureAdapter,h=d(this.hasZ,this.hasM),{point:A,mode:E}=t,z="number"===typeof t.distance?t.distance:t.distance.x,F="number"===typeof t.distance?t.distance:t.distance.y,D={candidates:[]},B="esriGeometryPolygon"===this.geometryType;
v=this._getPointCreator(E,this.spatialReference,v);const u=new n(null,0),H=new n(null,0),G={x:0,y:0,z:0};for(const O of this.items){var I=y.getGeometry(O);if(null==I)continue;const {coords:Q,lengths:Z}=I;u.coords=Q;H.coords=Q;if(t.returnEdge){I=0;for(var J=0;J<Z.length;J++){var M=Z[J];for(var R=0;R<M;R++,I+=h){var Y=u;Y.coordsIndex=I;if(R!==M-1){const ba=H;ba.coordsIndex=I+h;const da=G;c(G,A,Y,ba);var fa=(A.x-da.x)/z;const P=(A.y-da.y)/F;fa=fa*fa+P*P;1>=fa&&D.candidates.push(l.makeEdgeCandidate(y.getObjectId(O),
v(da),Math.sqrt(fa),v(Y),v(ba)))}}}}if("none"!==t.vertexMode)if(I=B?Q.length-h:Q.length,"all"===t.vertexMode)for(J=0;J<I;J+=h)M=u,M.coordsIndex=J,R=(A.x-M.x)/z,Y=(A.y-M.y)/F,R=R*R+Y*Y,1>=R&&D.candidates.push(l.makeVertexCandidate(y.getObjectId(O),v(M),Math.sqrt(R)));else if("ends"===t.vertexMode){I=[0];B||I.push(Q.length-h);for(const ba of I)I=u,I.coordsIndex=ba,J=(A.x-I.x)/z,M=(A.y-I.y)/F,J=J*J+M*M,1>=J&&D.candidates.push(l.makeVertexCandidate(y.getObjectId(O),v(I),Math.sqrt(J)))}}D.candidates.sort((O,
Q)=>O.distance-Q.distance);return D}_getPointCreator(t,v,y){const h=null==y||m.equals(v,y)?E=>E:E=>e.project(E,v,y),{hasZ:A}=this;return"3d"===t?A?({x:E,y:z,z:F})=>h({x:E,y:z,z:F}):({x:E,y:z})=>h({x:E,y:z,z:0}):({x:E,y:z})=>h({x:E,y:z})}async createSummaryStatisticsResponse(t){const {field:v,valueExpression:y,normalizationField:h,normalizationType:A,normalizationTotal:E,minValue:z,maxValue:F,scale:D,timeZone:B}=t;var u=this.fieldsIndex.get(v);t=b.isDateField(u)||b.isDateOnlyField(u)||b.isTimestampOffsetField(u);
const H=await this._getDataValues({field:v,valueExpression:y,normalizationField:h,normalizationType:A,normalizationTotal:E,scale:D,timeZone:B}),G=p.isNullCountSupported({normalizationType:A,normalizationField:h,minValue:z,maxValue:F}),I={value:.5,fieldType:u?.type};u=b.isStringField(u)?p.calculateStringStatistics({values:H,supportsNullCount:G,percentileParams:I}):p.calculateStatistics({values:H,minValue:z,maxValue:F,useSampleStdDev:!A,supportsNullCount:G,percentileParams:I});return p.processSummaryStatisticsResult(u,
t)}async createUniqueValuesResponse(t){const {field:v,valueExpression:y,domains:h,returnAllCodedValues:A,scale:E,timeZone:z}=t;var F=await this._getDataValues({field:v,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:y,scale:E,timeZone:z},!1);F=p.calculateUniqueValuesCount(F);return p.createUVResult(F,h,A,t.fieldDelimiter)}async createClassBreaksResponse(t){const {field:v,valueExpression:y,normalizationField:h,normalizationType:A,normalizationTotal:E,classificationMethod:z,
standardDeviationInterval:F,minValue:D,maxValue:B,numClasses:u,scale:H,timeZone:G}=t;t=await this._getDataValues({field:v,valueExpression:y,normalizationField:h,normalizationType:A,normalizationTotal:E,scale:H,timeZone:G});t=p.calculateClassBreaks(t,{field:v,normalizationField:h,normalizationType:A,normalizationTotal:E,classificationMethod:z,standardDeviationInterval:F,minValue:D,maxValue:B,numClasses:u});return p.resolveCBResult(t,z)}async createHistogramResponse(t){const {field:v,valueExpression:y,
normalizationField:h,normalizationType:A,normalizationTotal:E,classificationMethod:z,standardDeviationInterval:F,minValue:D,maxValue:B,numBins:u,scale:H,timeZone:G}=t;t=await this._getDataValues({field:v,valueExpression:y,normalizationField:h,normalizationType:A,normalizationTotal:E,scale:H,timeZone:G});return p.calculateHistogram(t,{field:v,normalizationField:h,normalizationType:A,normalizationTotal:E,classificationMethod:z,standardDeviationInterval:F,minValue:D,maxValue:B,numBins:u})}_sortFeatures(t,
v,y){if(1<t.length&&v?.length)for(const h of v.reverse()){v=h.split(" ");const A=v[0],E=this.fieldsIndex.get(A);v=v[1]?"desc"===v[1].toLowerCase():!1;const z=p.getAttributeComparator(E?.type,v);t.sort((F,D)=>{F=y(F,A,E);D=y(D,A,E);return z(F,D)})}}_createFeatureQueryResponse(t){const v=this.items,{geometryType:y,hasM:h,hasZ:A,objectIdField:E,spatialReference:z}=this,{outFields:F,outSR:D,quantizationParameters:B,resultRecordCount:u,resultOffset:H,returnZ:G,returnM:I}=t,J=null!=u?v.length>(H||0)+u:
!1,M=F&&(F.includes("*")?[...this.fieldsIndex.fields]:F.map(R=>this.fieldsIndex.get(R)));return{exceededTransferLimit:J,features:this._createFeatures(t,v),fields:M,geometryType:y,hasM:h&&I,hasZ:A&&G,objectIdFieldName:E,spatialReference:f.cleanFromGeometryEngine(D||z),transform:B&&r.toQuantizationTransform(B)||null}}_createFeatures(t,v){const y=new k(t,this.featureAdapter,this.fieldsIndex),{hasM:h,hasZ:A}=this,{orderByFields:E,quantizationParameters:z,returnGeometry:F,returnCentroid:D,maxAllowableOffset:B,
resultOffset:u,resultRecordCount:H,returnZ:G=!1,returnM:I=!1}=t,J=A&&G,M=h&&I;t=[];var R=0;v=[...v];this._sortFeatures(v,E,(O,Q,Z)=>y.getFieldValue(O,Q,Z));if(this.geometryType&&(F||D)){var Y=r.toQuantizationTransform(z)??void 0;if(F&&!D)for(var fa of v)t[R++]={attributes:y.getAttributes(fa),geometry:f.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(fa),B,Y,J,M)};else if(!F&&D)for(const O of v)t[R++]={attributes:y.getAttributes(O),centroid:f.transformCentroid(this,
this.featureAdapter.getCentroid(O,this),Y)};else for(const O of v)t[R++]={attributes:y.getAttributes(O),centroid:f.transformCentroid(this,this.featureAdapter.getCentroid(O,this),Y),geometry:f.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),B,Y,J,M)}}else for(Y of v)(fa=y.getAttributes(Y))&&(t[R++]={attributes:fa});R=u||0;null!=H&&(t=t.slice(R,Math.min(t.length,R+H)));return t}_createExceedsLimitQueryResponse(t){var v=!1;let y=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY;
v=Number.POSITIVE_INFINITY;for(const A of t.outStatistics??[])if("exceedslimit"===A.statisticType){y=null!=A.maxPointCount?A.maxPointCount:Number.POSITIVE_INFINITY;h=null!=A.maxRecordCount?A.maxRecordCount:Number.POSITIVE_INFINITY;v=null!=A.maxVertexCount?A.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)v=this.items.length>y;else if(this.items.length>h)v=!0;else{t=d(this.hasZ,this.hasM);const A=this.featureAdapter;v=this.items.reduce((E,z)=>{z=A.getGeometry(z);
return E+(null!=z&&z.coords.length||0)},0)/t>v}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(v)}}]}}async _createStatisticsQueryResponse(t){var v={attributes:{}};const y=[],h=new Map,A=new Map,E=new Map,z=new Map,F=new k(t,this.featureAdapter,this.fieldsIndex);var D=t.outStatistics;const {groupByFieldsForStatistics:B,having:u,orderByFields:H,resultRecordCount:G}=
t;t=B?.length;const I=!!t,J=I?B[0]:null,M=I&&!this.fieldsIndex.get(J);for(const Q of D??[]){const {outStatisticFieldName:Z,statisticType:ba}=Q;D=Q;const da="exceedslimit"!==ba?Q.onStatisticField:void 0,P="percentile_disc"===ba||"percentile_cont"===ba;var R="EnvelopeAggregate"===ba||"CentroidAggregate"===ba||"ConvexHullAggregate"===ba;const U=I&&1===t&&(da===J||M)&&"count"===ba;if(I){if(!E.has(da)){var Y=[];for(const ca of B){var fa=this._getAttributeValues(F,ca,h);Y.push(fa)}E.set(da,this._calculateUniqueValues(Y,
R?!1:F.returnDistinctValues))}Y=E.get(da);if(!Y)continue;fa=Object.keys(Y);for(const ca of fa){const {count:la,data:pa,items:na,itemPositions:ra}=Y[ca];fa=pa.join(",");if(!u||F.validateItems(na,u)){const ua=z.get(fa)||{attributes:{}};if(R){ua.aggregateGeometries||(ua.aggregateGeometries={});const {aggregateGeometries:T,outStatisticFieldName:ia}=await this._getAggregateGeometry(D,na);ua.aggregateGeometries[ia]=T}else{var O=null;if(U)O=la;else{const T=this._getAttributeValues(F,da,h);O=ra.map(ia=>T[ia]);
O=P&&"statisticParameters"in D?this._getPercentileValue(D,O):this._getStatisticValue(D,O,null,F.returnDistinctValues)}ua.attributes[Z]=O}let L=0;B.forEach((T,ia)=>ua.attributes[this.fieldsIndex.get(T)?T:`EXPR_${++L}`]=pa[ia]);z.set(fa,ua)}}}else if(R){v.aggregateGeometries||(v.aggregateGeometries={});const {aggregateGeometries:ca,outStatisticFieldName:la}=await this._getAggregateGeometry(D,this.items);v.aggregateGeometries[la]=ca}else R=this._getAttributeValues(F,da,h),v.attributes[Z]=P&&"statisticParameters"in
D?this._getPercentileValue(D,R):this._getStatisticValue(D,R,A,F.returnDistinctValues);D="min"!==ba&&"max"!==ba||!b.isStringField(this.fieldsIndex.get(da))&&!this._isAnyDateField(da)?null:this.fieldsIndex.get(da)?.type;y.push({name:Z,alias:Z,type:D||"esriFieldTypeDouble"})}v=I?Array.from(z.values()):[v];this._sortFeatures(v,H,(Q,Z)=>Q.attributes[Z]);G&&(v.length=Math.min(G,v.length));return{fields:y,features:v}}_isAnyDateField(t){t=this.fieldsIndex.get(t);return b.isDateField(t)||b.isDateOnlyField(t)||
b.isTimestampOffsetField(t)||b.isTimeOnlyField(t)}async _getAggregateGeometry(t,v){const {convexHull:y,union:h}=await new Promise((G,I)=>g(["../../../geometry/geometryEngineJSON"],G,I)),{statisticType:A,outStatisticFieldName:E}=t,{featureAdapter:z,spatialReference:F,geometryType:D,hasZ:B,hasM:u}=this;v=v.map(G=>f.getGeometry(D,B,u,z.getGeometry(G)));const H=y(F,v,!0)[0];t={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===A?(v=H?C.getPolygonExtent(H):C.getGeometryExtent(h(F,
v)),t.aggregateGeometries={...v,spatialReference:F},t.outStatisticFieldName=E||"extent"):"CentroidAggregate"===A?(v=H?w.polygonCentroid(H):w.extentCentroid(C.getGeometryExtent(h(F,v))),t.aggregateGeometries={x:v[0],y:v[1],spatialReference:F},t.outStatisticFieldName=E||"centroid"):"ConvexHullAggregate"===A&&(t.aggregateGeometries=H,t.outStatisticFieldName=E||"convexHull");return t}_getStatisticValue(t,v,y,h){const {onStatisticField:A,statisticType:E}=t;t=null;t=y?.has(A)?y.get(A):b.isStringField(this.fieldsIndex.get(A))||
this._isAnyDateField(A)?p.calculateStringStatistics({values:v,returnDistinct:h}):p.calculateStatistics({values:h?[...(new Set(v))]:v,minValue:null,maxValue:null,useSampleStdDev:!0});y&&y.set(A,t);return t["var"===E?"variance":E]}_getPercentileValue(t,v){const {onStatisticField:y,statisticParameters:h,statisticType:A}=t,{value:E,orderBy:z}=h;t=this.fieldsIndex.get(y);return p.calculatePercentile(v,{value:E,orderBy:z,fieldType:t?.type,isDiscrete:"percentile_disc"===A})}_getAttributeValues(t,v,y){if(y.has(v))return y.get(v);
const h=this.fieldsIndex.get(v),A=this.items.map(E=>t.getFieldValue(E,v,h));y.set(v,A);return A}_calculateUniqueValues(t,v){const y={},h=this.items,A=h.length;for(let E=0;E<A;E++){const z=h[E],F=[];for(const B of t)F.push(B[E]);const D=F.join(",");null==y[D]?y[D]={count:1,data:F,items:[z],itemPositions:[E]}:(v||y[D].count++,y[D].items.push(z),y[D].itemPositions.push(E))}return y}async _getDataValues(t,v=!0){const y=new k(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:h,scale:A,
timeZone:E}=t;return h?y.getExpressionValues(this.items,h,{viewingMode:"map",scale:A,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},E):y.getDataValues(this.items,x.clone(t),v)}}class n{constructor(t,v){this.coords=t;this.coordsIndex=v}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}q.QueryEngineResult=a;Object.defineProperty(q,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(g,q){function x({scale:D,translate:B},u){return Math.round((u-B[0])/D[0])}function w({scale:D,translate:B},u){return Math.round((B[1]-u)/D[1])}function C(D,B,u){const H=[];let G,I,J,M;for(let R=0;R<u.length;R++){const Y=u[R];if(0<R){if(J=x(D,Y[0]),M=w(D,Y[1]),J!==G||M!==I)H.push(B(Y,J-G,M-I)),G=J,I=M}else G=x(D,Y[0]),I=w(D,Y[1]),H.push(B(Y,G,I))}return 0<H.length?H:null}function r(D,
B,u,H){return C(D,u?H?F:z:H?z:E,B)}function m(D,B,u,H){const G=[];u=u?H?F:z:H?z:E;for(H=0;H<B.length;H++){const I=C(D,u,B[H]);I&&3<=I.length&&G.push(I)}return G.length?G:null}function k(D,B,u,H){const G=[];u=u?H?F:z:H?z:E;for(H=0;H<B.length;H++){const I=C(D,u,B[H]);I&&2<=I.length&&G.push(I)}return G.length?G:null}function f({scale:D,translate:B},u){return u*D[0]+B[0]}function e({scale:D,translate:B},u){return B[1]-u*D[1]}function l(D,B,u){const H=Array(u.length);if(!u.length)return H;const [G,I]=
D.scale;let J=f(D,u[0][0]);D=e(D,u[0][1]);H[0]=B(u[0],J,D);for(let M=1;M<u.length;M++){const R=u[M];J+=R[0]*G;D-=R[1]*I;H[M]=B(R,J,D)}return H}function b(D,B,u){const H=Array(u.length);for(let G=0;G<u.length;G++)H[G]=l(D,B,u[G]);return H}function p(D,B,u,H){return l(D,u?H?F:z:H?z:E,B)}function c(D,B,u,H){return b(D,u?H?F:z:H?z:E,B)}function d(D,B,u,H){return b(D,u?H?F:z:H?z:E,B)}function a(D,B,u){let [H,G]=u[0],I=Math.min(H,B[0]),J=Math.min(G,B[1]),M=Math.max(H,B[2]);B=Math.max(G,B[3]);for(let R=
1;R<u.length;R++){const [Y,fa]=u[R];H+=Y;G+=fa;0>Y&&(I=Math.min(I,H));0<Y&&(M=Math.max(M,H));0>fa?J=Math.min(J,G):0<fa&&(B=Math.max(B,G))}D[0]=I;D[1]=J;D[2]=M;D[3]=B;return D}function n(D,B){if(!B.length)return null;D[0]=D[1]=Number.POSITIVE_INFINITY;D[2]=D[3]=Number.NEGATIVE_INFINITY;for(let u=0;u<B.length;u++)a(D,D,B[u]);return D}function t(D,B,u,H,G){B.xmin=x(D,u.xmin);B.ymin=w(D,u.ymin);B.xmax=x(D,u.xmax);B.ymax=w(D,u.ymax);B!==u&&(H&&(B.zmin=u.zmin,B.zmax=u.zmax),G&&(B.mmin=u.mmin,B.mmax=u.mmax));
return B}function v(D,B,u,H,G){B.points=r(D,u.points,H,G)??[];return B}function y(D,B,u,H,G){B.x=x(D,u.x);B.y=w(D,u.y);B!==u&&(H&&(B.z=u.z),G&&(B.m=u.m));return B}function h(D,B,u,H,G){D=m(D,u.rings,H,G);if(!D)return null;B.rings=D;return B}function A(D,B,u,H,G){D=k(D,u.paths,H,G);if(!D)return null;B.paths=D;return B}const E=(D,B,u)=>[B,u],z=(D,B,u)=>[B,u,D[2]],F=(D,B,u)=>[B,u,D[2],D[3]];g.equals=function(D,B){if(D===B||null==D&&null==B)return!0;if(null==D||null==B)return!1;let u,H,G,I;D&&"upperLeft"===
D.originPosition?(u=D.translate[0],H=D.translate[1],D=D.scale[0]):(u=null!=D.extent?D.extent.xmin:0,H=null!=D.extent?D.extent.ymax:0,D=D.tolerance);B&&"upperLeft"===B.originPosition?(G=B.translate[0],I=B.translate[1],B=B.scale[0]):(G=null!=B.extent?B.extent.xmin:0,I=null!=B.extent?B.extent.ymax:0,B=B.tolerance);return u===G&&H===I&&D===B};g.getQuantizedBoundsCoordsArray=a;g.getQuantizedBoundsCoordsArrayArray=n;g.getQuantizedBoundsPaths=function(D){return n([0,0,0,0],D)};g.getQuantizedBoundsPoints=
function(D){const B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return a(B,B,D)};g.getQuantizedBoundsRings=function(D){return n([0,0,0,0],D)};g.quantizeBounds=function(D,B,u){B[0]=x(D,u[0]);B[3]=w(D,u[1]);B[2]=x(D,u[2]);B[1]=w(D,u[3]);return B};g.quantizeExtent=t;g.quantizeGeometry=function(D,B){return D&&B?q.isPoint(B)?y(D,{},B,!1,!1):q.isPolyline(B)?A(D,{},B,!1,!1):q.isPolygon(B)?h(D,{},B,!1,!1):q.isMultipoint(B)?v(D,{},B,!1,!1):q.isExtent(B)?
t(D,{},B,!1,!1):null:null};g.quantizeMultipoint=v;g.quantizePaths=k;g.quantizePoint=y;g.quantizePoints=r;g.quantizePolygon=h;g.quantizePolyline=A;g.quantizeRings=m;g.quantizeX=x;g.quantizeY=w;g.toQuantizationTransform=function(D){return D?{originPosition:"upper-left"===D.originPosition?"upperLeft":"lower-left"===D.originPosition?"lowerLeft":D.originPosition,scale:D.tolerance?[D.tolerance,D.tolerance]:[1,1],translate:null!=D.extent?[D.extent.xmin,D.extent.ymax]:[0,0]}:null};g.unquantizeBounds=function(D,
B,u){return u?(B[0]=f(D,u[0]),B[1]=e(D,u[3]),B[2]=f(D,u[2]),B[3]=e(D,u[1]),B):[f(D,B[0]),e(D,B[3]),f(D,B[2]),e(D,B[1])]};g.unquantizeCoordsArray=l;g.unquantizeCoordsArrayArray=b;g.unquantizeExtent=function(D,B,u,H,G){B.xmin=f(D,u.xmin);B.ymin=e(D,u.ymin);B.xmax=f(D,u.xmax);B.ymax=e(D,u.ymax);B!==u&&(H&&(B.zmin=u.zmin,B.zmax=u.zmax),G&&(B.mmin=u.mmin,B.mmax=u.mmax));return B};g.unquantizeMultipoint=function(D,B,u,H,G){null!=u&&(B.points=p(D,u.points,H,G));return B};g.unquantizePaths=c;g.unquantizePoint=
function(D,B,u,H,G){if(null==u)return B;B.x=f(D,u.x);B.y=e(D,u.y);B!==u&&(H&&(B.z=u.z),G&&(B.m=u.m));return B};g.unquantizePoints=p;g.unquantizePolygon=function(D,B,u,H,G){null!=u&&(B.rings=d(D,u.rings,H,G));return B};g.unquantizePolyline=function(D,B,u,H,G){null!=u&&(B.paths=c(D,u.paths,H,G));return B};g.unquantizeRings=d;g.unquantizeX=f;g.unquantizeY=e;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(g,q,x,w,C,r){class m{constructor(k,f,e){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=k.returnDistinctValues??!1;this.fieldsIndex=e;this.featureAdapter=f;if((f=k.outFields)&&!f.includes("*")){this.outFields=f;k=0;for(const b of f){var l=g.getExpressionFromFieldName(b);l=(f=this.fieldsIndex.get(l))?null:g.getWhereClause(l,e);f=f?f.name:g.getAliasFromFieldName(b)||`FIELD_EXP_${k++}`;this._fieldDataCache.set(b,{alias:f,clause:l})}}}countDistinctValues(k){if(!this.returnDistinctValues)return k.length;
k.forEach(f=>this.getAttributes(f));return this._returnDistinctMap.size}getAttributes(k){k=this._processAttributesForOutFields(k);return this._processAttributesForDistinctValues(k)}getFieldValue(k,f,e){const l=e?e.name:f;let b=null;this._fieldDataCache.has(l)?b=this._fieldDataCache.get(l)?.clause:e||(b=g.getWhereClause(f,this.fieldsIndex),this._fieldDataCache.set(l,{alias:l,clause:b}));return e?this.featureAdapter.getAttribute(k,l):b?.calculateValue(k,this.featureAdapter)}getDataValues(k,f,e=!0){const l=
f.normalizationType,b=f.normalizationTotal,p=this.fieldsIndex.get(f.field),c=x.isDateOnlyField(p)||x.isTimestampOffsetField(p),d=x.isTimeOnlyField(p);return k.map(a=>{let n=f.field&&this.getFieldValue(a,f.field,this.fieldsIndex.get(f.field));f.field2?(n=`${C.processNullValue(n)}${f.fieldDelimiter}${C.processNullValue(this.getFieldValue(a,f.field2,this.fieldsIndex.get(f.field2)))}`,f.field3&&(n=`${n}${f.fieldDelimiter}${C.processNullValue(this.getFieldValue(a,f.field3,this.fieldsIndex.get(f.field3)))}`)):
"string"===typeof n&&e&&(c?n=n?(new Date(n)).getTime():null:d&&(n=n?w.timeOnlyToMilliseconds(n):null));l&&Number.isFinite(n)&&(a="field"===l&&f.normalizationField?this.getFieldValue(a,f.normalizationField,this.fieldsIndex.get(f.normalizationField)):null,n=C.getNormalizedValue(n,l,a,b));return n})}async getExpressionValues(k,f,e,l,b){const {arcadeUtils:p}=await r.loadArcade(),c=p.hasGeometryOperations(f);c&&await p.enableGeometryOperations();const d=p.createFunction(f),a=p.getViewInfo(e),n={fields:this.fieldsIndex.fields};
return k.map(t=>{t={attributes:this.featureAdapter.getAttributes(t),layer:n,geometry:c?{...q.getGeometry(l.geometryType,l.hasZ,l.hasM,this.featureAdapter.getGeometry(t)),spatialReference:e?.spatialReference}:null};t=p.createExecContext(t,a,b);return p.executeFunction(d,t)})}validateItem(k,f){this._fieldDataCache.has(f)||this._fieldDataCache.set(f,{alias:f,clause:g.getWhereClause(f,this.fieldsIndex)});return this._fieldDataCache.get(f)?.clause?.testFeature(k,this.featureAdapter)??!1}validateItems(k,
f){this._fieldDataCache.has(f)||this._fieldDataCache.set(f,{alias:f,clause:g.getWhereClause(f,this.fieldsIndex)});return this._fieldDataCache.get(f)?.clause?.testSet(k,this.featureAdapter)??!1}_processAttributesForOutFields(k){const f=this.outFields;if(!f?.length)return this.featureAdapter.getAttributes(k);const e={};for(const l of f){const {alias:b,clause:p}=this._fieldDataCache.get(l);e[b]=p?p.calculateValue(k,this.featureAdapter):this.featureAdapter.getAttribute(k,b)}return e}_processAttributesForDistinctValues(k){if(null==
k||!this.returnDistinctValues)return k;var f=this.outFields,e=[];if(f)for(const b of f){var {alias:l}=this._fieldDataCache.get(b);e.push(k[l])}else for(l in k)e.push(k[l]);f=`${(f||["*"]).join(",")}=${e.join(",")}`;e=this._returnDistinctMap.get(f)||0;this._returnDistinctMap.set(f,++e);return 1<e?null:k}}return m})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c){function d(h){h=y.exec(h);if(!h)return null;const {hh:A,mm:E,ss:z,ms:F}=h.groups;return Number(A)*C.millisecondsPerTimeUnit.hours+Number(E)*C.millisecondsPerTimeUnit.minutes+Number(z)*C.millisecondsPerTimeUnit.seconds+Number(F||0)}function a(h,A){h=null!=h?h:"";null!=A&&A&&(h=h?"("+h+") AND ("+A+")":A);return h}function n(h){const A=h.layer;return h.fields.filter(E=>!A.getField(E))}function t(h){const A=h.layer;return h.fields.filter(E=>{E=A.getFieldUsageInfo(E);
return!E||!E.supportsStatistics})}let v=null;const y=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;g.calculateHeatmapStats=function(h,A=18,E,z,F,D){const B=new Float64Array(F*D);A=Math.round(w.pt2px(A));let u=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY;var G=0;let I=0,J=0,M=0;E=e.createValueFunction(z,E);for(const {geometry:Y,attributes:fa}of h){const {x:O,y:Q}=Y;h=Math.max(0,O-A);G=Math.max(0,Q-A);z=Math.min(D,Q+A);const Z=Math.min(F,O+A),ba=+E(fa);
for(let da=G;da<z;da++)for(let P=h;P<Z;P++){G=da*F+P;const U=e.evaluateDensityKernel(P-O,da-Q,A);var R=B[G];G=B[G]+=U*ba;R=G-R;I+=R;J+=R*R;G<u&&(u=G);G>H&&(H=G);M++}}return M?{mean:I/M,stdDev:Math.sqrt((J-I*I/M)/M),min:u,max:H,mid:(H-u)/2,count:M}:{mean:0,stddev:0,min:0,max:0,mid:0,count:0}};g.getDataValues=async function(h,A,E=!0){if(!A)return[];const {field:z,field2:F,field3:D,fieldDelimiter:B,fieldInfos:u,timeZone:H}=h;var G=z&&u?.find(da=>da.name.toLowerCase()===z.toLowerCase());const I=G?f.isTimeOnlyField(G):
!1,J=G?l.isAnyDateField(G):!1,M=h.valueExpression,R=h.normalizationType,Y=h.normalizationField,fa=h.normalizationTotal,O=[];G=h.viewInfoParams;let Q=null,Z=null;if(M){if(!v){const {arcadeUtils:da}=await p.loadArcade();v=da}v.hasGeometryOperations(M)&&await v.enableGeometryOperations();Q=v.createFunction(M);Z=G?v.getViewInfo({viewingMode:G.viewingMode,scale:G.scale,spatialReference:new r(G.spatialReference)}):null}h=h.fieldInfos;const ba=A[0]&&"declaredClass"in A[0]&&"esri.Graphic"===A[0].declaredClass||
!h?null:{fields:h};A.forEach(da=>{var P=da.attributes;if(M){var U=v.createExecContext(ba?{...da,layer:ba}:da,Z,H);U=v.executeFunction(Q,U)}else P&&(U=P[z],F?(U=`${b.processNullValue(U)}${B}${b.processNullValue(P[F])}`,D&&(U=`${U}${B}${b.processNullValue(P[D])}`)):"string"===typeof U&&E&&(J?U=U?(new Date(U)).getTime():null:I&&(U=U?d(U):null)));R&&"number"===typeof U&&isFinite(U)&&(P=P&&parseFloat(P[Y]),U=b.getNormalizedValue(U,R,P,fa));O.push(U)});return O};g.getRangeExpr=function(h,A,E){A=null!=A?
h+" \x3e\x3d "+A:"";h=null!=E?h+" \x3c\x3d "+E:"";E="";return(E=A&&h?a(A,h):A||h)?"("+E+")":""};g.getSQLFilterForNormalization=function(h){const A=h.field,E=h.normalizationType;h=h.normalizationField;let z;if("field"===E)z="(NOT "+h+" \x3d 0)";else if("log"===E||"natural-log"===E||"square-root"===E)z=`(${A} > 0)`;return z};g.getSumOfAttributesExpr=function(h,A,E){const z=[],F=[],D=[],B=[],u=[];h.forEach((I,J)=>{const M=I.field?"field":"expression",R=I.field||I.valueExpression;I.field?(u.push(R),F.push(`var ${M}${J} = Number($feature["${R}"]);`)):
(z.push(`function getValueForExpr${J}() {\n  ${R} \n}`),F.push(`var ${M}${J} = Number(getValueForExpr${J}());`));E||D.push(`${M}${J} = IIf(${M}${J} < 0, 0, ${M}${J});`);B.push(`${M}${J}`)});h="return sum;";const H=z.length?null:u.reduce((I,J)=>`${I} + ${J}`);let G=null;A||E?A?E||(h="return IIf(sum \x3e\x3d 0, sum, null);",H&&(G=`(( ${H} ) >= 0)`)):(h="return IIf(sum !\x3d 0, sum, null);",H&&(G=`(( ${H} ) <> 0)`)):(h="return IIf(sum \x3e 0, sum, null);",H&&(G=`(( ${H} ) > 0)`));return{valueExpression:[z.length?
z.join("\n"):"",F.join("\n"),D.join("\n"),`var sum = ${B.join(" + ")};`,h].filter(Boolean).join("\n\n"),sqlExpression:H,sqlWhere:G}};g.mergeWhereClauses=a;g.quantizeFeatures=function(h,A,E,z){const F=k.isWrappable(E)?k.getInfo(E):null,D=F?Math.round((F.valid[1]-F.valid[0])/A.scale[0]):null;return h.map(B=>{const u=new c(B.geometry);m.quantizePoint(A,u,u,u.hasZ,u.hasM);if(F){var H=D??0,G=z[0];0>u.x?u.x+=H:u.x>G&&(u.x-=H)}B.geometry=u;return B})};g.timeOnlyToMilliseconds=d;g.verifyBasicFieldValidity=
function(h,A,E){const z=n({layer:h,fields:A});if(z.length)return new x(E,"Unknown fields: "+z.join(", ")+". You can only use fields defined in the layer schema");h=t({layer:h,fields:A});if(h.length)return new x(E,"Unsupported fields: "+h.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};g.verifyFieldType=function(h,A,E,z){let F;A?A.name!==h.objectIdField&&z.includes(A.type)||(F=new x(E,"'field' should be one of these types: "+z.join(","))):
F=new x(E,"'field' is not defined in the layer schema");return F};g.verifyFilterValidty=function(h,A){if(h&&"intersects"!==h.spatialRelationship)return new x(A,"Only 'intersects' spatialRelationship is supported for featureFilter")};g.verifyNumericField=function(h,A,E){let z;A?A.name!==h.objectIdField&&f.isNumericField(A)||(z=new x(E,"'field' should be one of these numeric types: "+f.numericTypes.join(","))):z=new x(E,"'field' is not defined in the layer schema");return z};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/core/screenUtils":function(){define(["exports"],function(g){function q(w){return w?72*w/96:0}const x=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;g.castRenderScreenPointArray=function(w){return w};g.castRenderScreenPointArray3=function(w){return w};g.castScreenPointArray=function(w){return w};g.createRenderScreenPoint=function(w=0,C=0){return{x:w,y:C}};g.createRenderScreenPointArray=function(w=0,C=0){return[w,C]};g.createRenderScreenPointArray3=function(w=0,C=
0,r=0){return[w,C,r]};g.createScreenPoint=function(w=0,C=0){return{x:w,y:C}};g.createScreenPointArray=function(w=0,C=0){return[w,C]};g.pt2px=function(w){return w?w/72*96:0};g.px2pt=q;g.screenPointArrayToObject=function(w,C){return C?(C.x=w[0],C.y=w[1],C):{x:w[0],y:w[1]}};g.screenPointObjectToArray=function(w,C){return C?(C[0]=w.x,C[1]=w.y,2<C.length&&(C[2]=0),C):[w.x,w.y]};g.toPt=function(w){if("string"===typeof w){var C=w.match(x);if(C){var r=Number(C[1]);C=C[3]&&C[3].toLowerCase();w="-"===w.charAt(0);
r="px"===C?q(r):r;return w?-r:r}console.warn("screenUtils.toPt: input not recognized!");return null}return w};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/timeUtils":function(){define(["exports","../intl/date","../time/timeZoneUtils","../chunks/datetime"],function(g,q,x,w){function C(k,f,e){return 0===k?0:k*m[f]/m[e]}function r(k){switch(k){case "milliseconds":return"millisecond";case "seconds":return"second";case "minutes":return"minute";case "hours":return"hour";case "days":return"day";
case "weeks":return"week";case "months":return"month";case "years":return"year"}}const m={milliseconds:1,seconds:1E3,minutes:6E4,hours:36E5,days:864E5,weeks:6048E5,months:26784E5,years:31536E6,decades:31536E7,centuries:31536E8};g.convertTime=C;g.isValidDate=function(k){return k instanceof Date&&!isNaN(k.getTime())};g.makeUTCTime=function(k,f,e="milliseconds"){f=new Date(C(f,e,"milliseconds"));f.setUTCFullYear(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate());return f};g.mergeTimeExtents=function(k,
f){return k&&f?k.intersection(f):k||f};g.millisecondsPerTimeUnit=m;g.offsetDate=function(k,f,e,l=x.system){l=new w.IANAZone(q.resolveTimeZone(l));k=w.DateTime.fromJSDate(k,{zone:l});l="decades"===e||"centuries"===e?"year":r(e);"decades"===e&&(f*=10);"centuries"===e&&(f*=100);return k.plus({[l]:f}).toJSDate()};g.offsetDateUTC=function(k,f,e="milliseconds"){k=k.getTime();f=C(f,e,"milliseconds");return new Date(k+f)};g.resetUTCDate=function(k,f){k=new Date(k.getTime());k.setUTCFullYear(f.getFullYear(),
f.getMonth(),f.getDate());return k};g.timeSinceUTCMidnight=function(k,f="milliseconds"){const e=C(k.getUTCHours(),"hours","milliseconds"),l=C(k.getUTCMinutes(),"minutes","milliseconds"),b=C(k.getUTCSeconds(),"seconds","milliseconds");k=k.getUTCMilliseconds();return C(e+l+b+k,"milliseconds",f)};g.truncateDate=function(k,f,e=x.system){e=new w.IANAZone(q.resolveTimeZone(e));k=w.DateTime.fromJSDate(k,{zone:e});if("decades"===f||"centuries"===f)return k=k.startOf("year"),{year:e}=k,k.set({year:e-e%("decades"===
f?10:100)}).toJSDate();f=r(f);return k.startOf(f).toJSDate()};g.truncateLocalTime=function(k){const f=new Date(0);f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0);f.setFullYear(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate());return f};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec4","../../chunks/vec4f64"],function(g,q,x,w,C){function r(e,
l,b,p){let {color:c,ratio:d}=l,{color:a,ratio:n}=b;n===d&&(1===n?d-=1E-6:n+=1E-6);l=q.clamp((p-d)/(n-d),0,1);w.lerp(e,c.toArray(),a.toArray(),l)}function m(e,l,b,p,c){e=new Uint32Array(e*e);l="buffer"in l?l:new Float64Array(l);b="buffer"in b?new Uint32Array(b.buffer):new Uint32Array((new Uint8Array(b)).buffer);c=b.length/(c-p);for(let d=0;d<l.length;d++)e[d]=b[q.clamp(Math.floor((l[d]-p)*c),0,b.length-1)];return e.buffer}function k(e,l,b){e=Math.sqrt(e**2+l**2)/b;return 1<e?0:3/(Math.PI*b**2)*(1-
e**2)**2}function f(e,l){return null!=e?"string"===typeof l?b=>-1*+b.readAttribute(e):b=>+b.readAttribute(e)+l:b=>1}g.calculateHeatmapIntensityInfoReaders=function(e,l,b,p){const {radius:c,fieldOffset:d,field:a}=l;l=Math.round(x.pt2px(c));const n=new Float64Array(b*p);let t=Number.NEGATIVE_INFINITY;const v=f(a,d),y=new Set;for(const z of e)for(e=z.getCursor();e.next();){var h=e.getObjectId();if(y.has(h))continue;y.add(h);h=e.readLegacyPointGeometry();if(-128>h.x||h.x>=b+128||-128>h.y||h.y>p+128)continue;
const F=+v(e),D=Math.max(0,Math.round(h.x)-l);var A=Math.max(0,Math.round(h.y)-l);const B=Math.min(p,Math.round(h.y)+l),u=Math.min(b,Math.round(h.x)+l);for(;A<B;A++)for(let H=D;H<u;H++){var E=A*b+H;const G=k(h.x-H,h.y-A,l);E=n[E]+=G*F;E>t&&(t=E)}}return{matrix:n.buffer,max:t}};g.createHeatmapImageData=m;g.createValueFunction=function(e,l){return"function"===typeof e?e:e?"string"===typeof l?b=>-1*+b[e]:b=>+b[e]+l:()=>1};g.createValueFunctionCursor=f;g.drawHeatmap=function(e,l,b,p,c,d){e.canvas.width=
e.canvas.height=l;e.clearRect(0,0,l,l);const a=e.getImageData(0,0,l,l);b&&p&&a.data.set(new Uint8ClampedArray(m(l,b,p,c,d)));e.putImageData(a,0,0)};g.evaluateDensityKernel=k;g.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return x.px2pt(2.4*e)};g.generateGradient=function(e){const l=new Uint8ClampedArray(2048);e=e.filter(({ratio:a})=>0<=a&&1>=a).sort((a,n)=>a.ratio-n.ratio).map(({color:a,ratio:n})=>({color:a,ratio:Math.max(n,.001)}));if(1>e.length)return l;let b=e[0],p=e[0],c=1;const d=
C.create();for(let a=0;512>a;a++){const n=(a+.5)/512;for(;n>p.ratio&&c<e.length;)b=p,p=e[c++];r(d,b,p,n);l.set(d,4*a)}return l};g.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return x.pt2px(e)/2.4};g.magicKernelDensityRadiusInflationFactor=2.4;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),
function(g,q,x,w,C,r){function m(c){return String(c).padStart(2,"0")}function k(c,d,a){if("date"===d||"number"===d){"number"===d&&(c=new Date(c));d=a?c.getFullYear():c.getUTCFullYear();const n=m((a?c.getMonth():c.getUTCMonth())+1),t=m(a?c.getDate():c.getUTCDate()),v=m(a?c.getHours():c.getUTCHours()),y=m(a?c.getMinutes():c.getUTCMinutes());c=m(a?c.getSeconds():c.getUTCSeconds());c=`TIMESTAMP'${d}-${n}-${t} ${v}:${y}:${c}'`}return c}function f(c,d){if(d instanceof Date)return"date";if("number"===typeof d)return"number";
if("string"===typeof d&&(c=c.getField(d),"\x3cnow\x3e"!==d.toLowerCase()&&x.isDateField(c)))return"field"}const e={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},b=new Set(["integer","small-integer"]);let p=null;g.castIntegerFieldToFloat=function(c){return`cast(${c} as float)`};g.dateTypes=["date","date-only","timestamp-offset"];
g.defaultBasemapGroups=e;g.fieldDelimiter=",";g.formatAnyDate=function(c,d){const {format:a,timeZoneOptions:n,fieldType:t}=d??{};let v;n&&({timeZone:y,timeZoneName:v}=r.getTimeZoneFormattingOptions(n.layerTimeZone,n.datesInUnknownTimezone,n.viewTimeZone,q.convertDateFormatToIntlOptions(a||"short-date-short-time"),t));if("string"===typeof c&&isNaN(Date.parse("time-only"===t?`1970-01-01T${c}Z`:c)))return c;switch(t){case "date-only":var y=q.convertDateFormatToIntlOptions(a||"short-date");return"string"===
typeof c?q.formatDateOnly(c,{...y}):q.formatDate(c,{...y,timeZone:r.utc});case "time-only":return y=q.convertDateFormatToIntlOptions(a||"short-time"),"string"===typeof c?q.formatTimeOnly(c,y):q.formatDate(c,{...y,timeZone:r.utc});case "timestamp-offset":if(!y&&"string"===typeof c&&(new Date(c)).toISOString()!==c)return c;y=(d=a||n?q.convertDateFormatToIntlOptions(a||"short-date-short-time"):void 0)?{...d,timeZone:y,timeZoneName:v}:void 0;return"string"===typeof c?q.formatTimestamp(c,y):q.formatDate(c,
y);default:return d=a||n?q.convertDateFormatToIntlOptions(a||"short-date-short-time"):void 0,q.formatDate("string"===typeof c?new Date(c):c,d?{...d,timeZone:y,timeZoneName:v}:void 0)}};g.getBasemapGroup=function(c,d=e){for(const a in d)if(d[a].includes(c))return a};g.getBasemapId=function(c,d,a=!0){let n=null;c&&("string"===typeof c?d.includes(c)&&(n=c):n=C.getWellKnownBasemapId(c));return a?n||"gray":n};g.getDateDiffSQL=function(c,d,a,n){const {hasQueryEngine:t}=c;a=k(a,f(c,a),t);c=k(d,f(c,d),t);
c=`(${a} - ${c})`;n=l[n];d="/";1>n&&(n=1/n,d="*");return{sqlExpression:1===n?c:`(${c} ${d} ${n})`,sqlWhere:null}};g.getDateType=f;g.getFieldsList=async function(c){const {field:d,field2:a,field3:n,normalizationField:t,valueExpression:v}=c;c=[];v&&(p||({arcadeUtils:c}=await w.loadArcade(),p=c),c=p.extractFieldNames(v));d&&c.push(d);a&&c.push(a);n&&c.push(n);t&&c.push(t);return c};g.getNormalizationType=function(c){let d=c.normalizationType;d||(c.normalizationField?d="field":null!=c.normalizationTotal&&
(d="percent-of-total"));return d??void 0};g.isAnyDateField=function(c){return x.isDateField(c)||x.isDateOnlyField(c)||x.isTimestampOffsetField(c)};g.isIntegerField=function(c,d){c=d&&c.getField(d);return!!c&&b.has(c.type)};g.unitValueInDays=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define("exports ../Basemap ../config ../core/Collection ../core/Logger ../core/maybe ../core/urlUtils ../core/accessorSupport/ensureType ../layers/effects/utils ./basemapDefinitions".split(" "),
function(g,q,x,w,C,r,m,k,f,e){function l(G,I){let J;if("string"===typeof G){const M=G in e.esriBasemapDefinitions,R=!M&&G.includes("/");if(!M&&!R)return I=Object.entries(e.esriBasemapDefinitions).filter(([,Y])=>x.apiKey&&!Y.classic||!x.apiKey&&(Y.classic||Y.is3d)).map(([Y])=>`"${Y}"`).sort().join(", "),B.warn(`Unable to find basemap definition for: ${G}. Try one of these: ${I}`),null;I&&(J=I[G]);J||(J=M?q.fromId(G):new q({style:{id:G}}),I&&(I[G]=J))}else J=k.ensureType(q,G);J?.destroyed&&(B.warn("The provided basemap is already destroyed",
{basemap:J}),J=null);return J}function b(G){if(u)return u(G);let I=null;G=a(G);const J=!G?.baseLayers.length;for(const R in e.esriBasemapDefinitions){var M=y(e.esriBasemapDefinitions[R]);M=A(G,M,{mustMatchReferences:J});if("equal"===M){I=R;break}"base-layers-equal"===M&&(I=R)}return I}function p(G,I){const J=new w;G.forEach(M=>{const R=I.find(Y=>"scene"!==Y.type&&z(t(M),t(Y)))||M;J.includes(R)?J.push(M):J.push(R)});return J}function c(G){if(d(G.url))return!0;if("vector-tile"===G.type)for(const I in G.sourceNameToSource)if(d(G.sourceNameToSource[I]?.sourceUrl))return!0;
return!1}function d(G){if(!G)return!1;G=new m.Url(m.makeAbsolute(G));return!!G.authority&&H.test(G.authority)}function a(G){return G?!G.loaded&&G.resourceInfo?y(G.resourceInfo.data):{baseLayers:n(G.baseLayers),referenceLayers:n(G.referenceLayers)}:null}function n(G){return(w.isCollection(G)?G.toArray():G).map(t)}function t(G){return{type:G.type,effect:"effect"in G?G.effect:void 0,url:F("urlTemplate"in G&&G.urlTemplate||G.url||"styleUrl"in G&&G.styleUrl||""),minScale:"minScale"in G&&null!=G.minScale?
G.minScale:0,maxScale:"maxScale"in G&&null!=G.maxScale?G.maxScale:0,opacity:null!=G.opacity?G.opacity:1,visible:null!=G.visible?!!G.visible:!0,sublayers:"map-image"!==G.type&&"wms"!==G.type||null==G.sublayers?void 0:G.sublayers?.map(I=>({id:I.id,visible:I.visible})),activeLayerId:"wmts"===G.type?G.activeLayer?.id:void 0}}function v(G){return G.isReference||"ArcGISSceneServiceLayer"===G.layerType}function y(G){return G?{baseLayers:h((G.baseMapLayers??[]).filter(I=>!v(I))),referenceLayers:h((G.baseMapLayers??
[]).filter(I=>v(I)))}:null}function h(G){return G.map(I=>{let J;switch(I.layerType){case "VectorTileLayer":J="vector-tile";break;case "ArcGISTiledMapServiceLayer":J="tile";break;case "ArcGISSceneServiceLayer":J="scene";break;default:J="unknown"}return{type:J,effect:I.effect,url:F(I.templateUrl||I.urlTemplate||I.styleUrl||I.url),minScale:I.minScale??0,maxScale:I.maxScale??0,opacity:I.opacity??1,visible:null!=I.visibility?!!I.visibility:!0,sublayers:void 0,activeLayerId:void 0}})}function A(G,I,J){return null!=
G!==(null!=I)?"not-equal":G&&I?E(G.baseLayers,I.baseLayers)?E(G.referenceLayers,I.referenceLayers)?"equal":J.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function E(G,I){if(G.length!==I.length)return!1;for(let J=0;J<G.length;J++)if(!z(G[J],I[J]))return!1;return!0}function z(G,I){if(G.type!==I.type||G.url!==I.url||G.minScale!==I.minScale||G.maxScale!==I.maxScale||G.visible!==I.visible||G.opacity!==I.opacity||!f.effectEquals(G.effect,I.effect))return!1;if(null!=G.activeLayerId||
null!=I.activeLayerId)return G.activeLayerId===I.activeLayerId;if(null!=G.sublayers||null!=I.sublayers){if(null==G.sublayers||null==I.sublayers||G.sublayers.length!==I.sublayers.length)return!1;for(let J=0;J<G.sublayers.length;J++){const M=G.sublayers.at(J),R=I.sublayers.at(J);if(M?.id!==R?.id||M?.visible!==R?.visible)return!1}}return!0}function F(G){return G?m.normalize(G).replace(/^\s*https?:/i,"").toLowerCase():""}function D(G){return"portalItem"in G?G.portalItem?.thumbnailUrl:void 0}const B=C.getLogger("esri.support.basemapUtils");
let u;const H=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;g.clonePreservingTiledLayers=function(G,I=null){G=l(G);if(!G)return null;G=G.clone();I&&(G.baseLayers=p(G.baseLayers,I.baseLayers),G.referenceLayers=p(G.referenceLayers,I.referenceLayers));return G};g.contentEquals=function(G,I){if(G===I||null!=G?.portalItem?.id&&G.portalItem.id===I?.portalItem?.id)return!0;G=a(G);I=a(I);return"equal"===A(G,I,{mustMatchReferences:!0})};g.createCache=function(){return{}};g.destroyCache=function(G){for(const I in G)r.destroyMaybe(G[I]),
delete G[I]};g.ensureType=l;g.findSpatialReference=function(G,I){if(null==I||null==G)return{spatialReference:null,updating:!1};if("not-loaded"===I.loadStatus)return I.load(),{spatialReference:null,updating:!0};if(I.spatialReference)return{spatialReference:I.spatialReference,updating:!1};if(0===I.baseLayers.length)return{spatialReference:null,updating:!1};I=I.baseLayers.at(0);switch(I.loadStatus){case "not-loaded":I.load();case "loading":return{spatialReference:null,updating:!0};case "failed":return{spatialReference:null,
updating:!1}}I=(("supportedSpatialReferences"in I?I.supportedSpatialReferences:null)||["tileInfo"in I?I.tileInfo?.spatialReference:I.spatialReference]).filter(Boolean);const J=G.spatialReference;return J?{spatialReference:I.find(M=>J.equals(M))??I[0]??null,updating:!1}:{spatialReference:I[0],updating:!1}};g.getBasemapThumbnailUrl=function(G){if(!G)return null;var {thumbnailUrl:I}=G;return I?I:(I=b(G))?e.esriBasemapDefinitions[I].thumbnailUrl:r.mappedFind(G.baseLayers,D)};g.getWellKnownBasemapId=b;
g.hasDeveloperBasemapLayer=function(G){return!!G?.baseLayers.concat(G.referenceLayers).some(c)};g.isBasemap3D=function(G){return"Web Scene"===G.portalItem?.type};g.isBasemapInBeta=function(G){return!!G?.portalItem?.tags?.some(I=>"beta"===I.toLowerCase())};g.isBasemapLayer=function(G,I){return G.basemap?.referenceLayers?.some(J=>J.uid===I)||G.basemap?.baseLayers?.some(J=>J.uid===I)};g.isDeveloperBasemapLayer=c;g.overrideGetWellKnownBasemapId=function(G){u=G};Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/Basemap":function(){define("require ./chunks/tslib.es6 ./request ./core/Collection ./core/collectionUtils ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./support/BasemapStyle ./webdoc/support/writeUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E){var z;let F=0;r=z=class extends r.JSONSupportMixin(k){constructor(u){super(u);this.thumbnailUrl=this.style=this.spatialReference=this.portalItem=this.id=null;this.title="Basemap";this.id=Date.now().toString(16)+"-basemap-"+F++;this.baseLayers=new w;this.referenceLayers=new w;const H=G=>{G.parent&&G.parent!==this&&"remove"in G.parent&&G.parent.remove(G);G.parent=this;"elevation"===G.type&&e.getLogger(this).error(`Layer '${G.title}, id:${G.id}' of type '${G.type}' is not supported as a basemap layer and will therefore be ignored.`)};
this.addHandles([this.baseLayers.on("after-add",G=>H(G.item)),this.referenceLayers.on("after-add",G=>H(G.item)),this.baseLayers.on("after-remove",G=>{G.item.parent=null}),this.referenceLayers.on("after-remove",G=>{G.item.parent=null})])}initialize(){this.when().catch(u=>{e.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,u)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var u=this.baseLayers.toArray();for(const H of u)H.destroy();
u=this.referenceLayers.toArray();for(const H of u)H.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem=l.destroyMaybe(this.portalItem)}normalizeCtorArgs(u){u&&"resourceInfo"in u&&(this._set("resourceInfo",u.resourceInfo),u={...u},delete u.resourceInfo);return u}set baseLayers(u){this._set("baseLayers",C.referenceSetter(u,this._get("baseLayers")))}_writeBaseLayers(u,H,G){const I=[];u&&(G={...G,layerContainerType:"basemap"},this.baseLayers.forEach(J=>{J=E.getLayerJSON(J,
G.webmap?G.webmap.getLayerJSONFromResourceInfo(J):null,G);null!=J&&I.push(J)}),this.referenceLayers.forEach(J=>{const M=E.getLayerJSON(J,G.webmap?G.webmap.getLayerJSONFromResourceInfo(J):null,G);null!=M&&("scene"!==J.type&&(M.isReference=!0),I.push(M))}));H.baseMapLayers=I}set referenceLayers(u){this._set("referenceLayers",C.referenceSetter(u,this._get("referenceLayers")))}writeTitle(u,H){H.title=u||"Basemap"}load(u){this.addResolvingPromise(this._loadFromSource(u));return Promise.resolve(this)}loadAll(){return f.loadAll(this,
u=>{u(this.baseLayers,this.referenceLayers)})}clone(){const u={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(H=>m.isClonable(H)?H.clone():H),referenceLayers:this.referenceLayers.map(H=>m.isClonable(H)?H.clone():H)};this.loaded&&(u.loadStatus="loaded");return(new z({resourceInfo:this.resourceInfo})).set(u)}read(u,H){this.resourceInfo||this._set("resourceInfo",{data:u,context:H});super.read(u,H)}write(u,H){u=u||{};H?.origin||(H={origin:"web-map",...H});super.write(u,
H);!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(u.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(G=>{G=m.clone(G);G.url&&p.isProtocolRelative(G.url)&&(G.url=`https:${G.url}`);G.templateUrl&&p.isProtocolRelative(G.templateUrl)&&(G.templateUrl=`https:${G.templateUrl}`);return G}));return u}async _loadFromSource(u){const {resourceInfo:H,portalItem:G,style:I}=this;b.throwIfAborted(u);const J=[];H?(J.push(this._loadLayersFromJSON(H.data,H.context?H.context.url:null,u)),H.data.id&&!H.data.title&&
J.push(h.getBasemapTitle(H.data.id).then(M=>{M&&this.read({title:M},H.context)}))):G?J.push(this._loadFromItem(G,u)):I&&J.push(this._loadFromStylesService(I,u));await Promise.all(J)}async _loadLayersFromJSON(u,H,G){const I=this.resourceInfo?.context,J=this.portalItem?.portal||I?.portal||null,M=B[I?.origin||""]??"web-map",{populateOperationalLayers:R}=await new Promise((fa,O)=>g(["./layers/support/layersCreator"],fa,O)),Y=[];b.throwIfAborted(G);if(u.baseMapLayers&&Array.isArray(u.baseMapLayers)){H=
{context:{...I,origin:M,url:H,portal:J,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const fa=O=>"web-scene"===M&&"ArcGISSceneServiceLayer"===O.layerType||O.isReference;G=R(this.baseLayers,u.baseMapLayers.filter(O=>!fa(O)),H);Y.push(G);u=R(this.referenceLayers,u.baseMapLayers.filter(fa),H);Y.push(u)}await Promise.allSettled(Y)}async _loadFromItem(u,H){const G=await (await u.load(H)).fetchData("json",H),I=p.urlToObject(u.itemUrl??"");this._set("resourceInfo",{data:G.baseMap??{},
context:{origin:D[u.type||""]??"web-map",portal:u.portal||v.getDefault(),url:I}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:G.spatialReference},this.resourceInfo.context);this.read({title:u.title,thumbnailUrl:u.thumbnailUrl},{origin:"portal-item",portal:u.portal||v.getDefault(),url:I});return this._loadLayersFromJSON(this.resourceInfo.data,I,H)}async _loadFromStylesService(u,H){var G=`${u.serviceUrl}/${u.id}`;u=(await x(G,{query:{language:u.getLanguageParamValue()},
signal:H?.signal})).data;if(u.baseMap&&Array.isArray(u.baseMap.baseMapLayers))for(const I of u.baseMap.baseMapLayers)if(!I.customParameters&&I.styleUrl?.includes("?")){const J=p.urlToObject(I.styleUrl);J.query&&(I.styleUrl=J.path,I.customParameters=J.query)}G=p.urlToObject(G);this._set("resourceInfo",{data:u.baseMap??{},context:{origin:"web-map",url:G}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:u.spatialReference},this.resourceInfo.context);return this._loadLayersFromJSON(this.resourceInfo.data,
G,H)}static fromId(u){return(u=h.esriBasemapDefinitions[u])?u.itemId?new z({portalItem:{id:u.itemId,portal:{url:"https://www.arcgis.com"}}}):z.fromJSON(u,{origin:u.is3d?"web-scene":"web-map"}):null}};q.__decorate([c.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(u,H,G,I){this._writeBaseLayers(u,H,I)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:w}},writer(u,H,G,I){this._writeBaseLayers(u,H,I)}}}}}})],r.prototype,"baseLayers",null);q.__decorate([c.property({type:String,
json:{origins:{"web-scene":{write:!0}}}})],r.prototype,"id",void 0);q.__decorate([c.property({type:y})],r.prototype,"portalItem",void 0);q.__decorate([c.property()],r.prototype,"referenceLayers",null);q.__decorate([c.property({readOnly:!0})],r.prototype,"resourceInfo",void 0);q.__decorate([c.property({type:t})],r.prototype,"spatialReference",void 0);q.__decorate([c.property({type:A})],r.prototype,"style",void 0);q.__decorate([c.property()],r.prototype,"thumbnailUrl",void 0);q.__decorate([c.property({type:String,
json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],r.prototype,"title",void 0);q.__decorate([n.writer("title")],r.prototype,"writeTitle",null);r=z=q.__decorate([a.subclass("esri.Basemap")],r);const D={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},B={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"};return r})},"esri/core/collectionUtils":function(){define(["exports","./Collection"],function(g,q){g.castForReferenceSetter=function(x){return x};g.referenceSetter=
function(x,w,C=q){w||(w=new C);if(w===x)return w;w.removeAll();x&&(Array.isArray(x)||"items"in x&&Array.isArray(x.items))?w.addMany(x):x&&w.add(x);return w};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/Loadable":function(){define("../chunks/tslib.es6 ./Error ./maybe ./Promise ./promiseUtils ./Warning ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m,k){const f=e=>{e=class extends e{constructor(...l){super(...l);
this.loadError=this._loadController=null;this.loadStatus="not-loaded";this._set("loadWarnings",[]);this.addResolvingPromise(new Promise(b=>{const p=this.load.bind(this);this.load=c=>{const d=new Promise((a,n)=>{const t=C.onAbortOrThrow(c,n);this.destroyed&&n(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this}));this.when(a,n).finally(()=>{t&&t.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");
const a=this._loadController=new AbortController;p({signal:a.signal})}b();return d}}));this.when(()=>{this._set("loadStatus","loaded");this._loadController=null},b=>{this._set("loadStatus","failed");this._set("loadError",b);this._loadController=null})}destroy(){this._loadController&&(this._loadController=x.abortMaybe(this._loadController),this._promiseProps.abort());this._set("loadError",null);this._set("loadWarnings",[])}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){if(this.isFulfilled())return this;
this._set("loadError",new q("load:cancelled","Cancelled"));this._loadController?.abort();this._promiseProps.abort();return this}};g.__decorate([m.property({readOnly:!0})],e.prototype,"loaded",null);g.__decorate([m.property({readOnly:!0})],e.prototype,"loadError",void 0);g.__decorate([m.property({clonable:!1})],e.prototype,"loadStatus",void 0);g.__decorate([m.property({type:[r],readOnly:!0})],e.prototype,"loadWarnings",null);return e=g.__decorate([k.subclass("esri.core.Loadable")],e)};w=class extends f(w.EsriPromise){};
w=g.__decorate([k.subclass("esri.core.Loadable")],w);(function(e){e.LoadableMixin=f;e.isLoadable=function(l){return!(!l||!l.load)}})(w||(w={}));return w})},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],function(g,q,x,w,C){var r;(function(f){f[f.PENDING=0]="PENDING";f[f.RESOLVED=1]="RESOLVED";f[f.REJECTED=2]="REJECTED"})(r||(r={}));class m{constructor(){this._resolver=w.createResolver();this._status=r.PENDING;
this._resolvingPromises=[];this._resolver.promise.then(()=>{this._status=r.RESOLVED;this._cleanUp()},()=>{this._status=r.REJECTED;this._cleanUp()});this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(f){this._resolvingPromises.push(f);this._tryResolve()}isResolved(){return this._status===r.RESOLVED}isRejected(){return this._status===r.REJECTED}isFulfilled(){return this._status!==r.PENDING}abort(){this._resolver.reject(w.createAbortError())}_cleanUp(){this._resolvingPromises=
this._allPromise=null}_tryResolve(){if(!this.isFulfilled()){var f=w.createResolver(),e=[...this._resolvingPromises,f.promise],l=this._allPromise=Promise.all(e);l.then(()=>{this.isFulfilled()||this._allPromise!==l||this._resolver.resolve()},b=>{this.isFulfilled()||this._allPromise!==l||w.isAbortError(b)||this._resolver.reject(b)});f.resolve()}}}const k=f=>{f=class extends f{constructor(...e){super(...e);this._promiseProps=new m;this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,
l){return this._promiseProps.promise.then(()=>this).then(e,l)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return f=q.__decorate([C.subclass("esri.core.Promise")],f)};g.EsriPromise=class extends k(x){};g.EsriPromise=q.__decorate([C.subclass("esri.core.Promise")],g.EsriPromise);g.EsriPromiseMixin=k;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/loadAll":function(){define(["exports",
"./asyncUtils","./Collection","./Loadable"],function(g,q,x,w){async function C(r,m){const k=[],f=(...l)=>{for(const b of l)null!=b&&(Array.isArray(b)?f(...b):x.isCollection(b)?b.forEach(p=>f(p)):w.isLoadable(b)&&k.push(b))};m(f);let e=null;await q.map(k,async l=>{l=await q.result("loadAll"in l&&"function"===typeof l.loadAll?l.loadAll():l.load());!1!==l.ok||e||(e=l)});if(e)throw e.error;return r}g.loadAll=async function(r,m){await r.load();return C(r,m)};g.loadAllChildren=C;Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/portal/Portal":function(){define("require ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/JSONSupport ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ../intl/locale ./portalDefault ./PortalGroup ./PortalQueryParams ./PortalQueryResult ./PortalUser ../support/apiKeyUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E,z){function F(I){const J=w.id;return()=>{const M=I.deref();M&&J.findCredential(M.restUrl)&&M.signIn().catch(()=>{})}}const D=I=>Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"}));var B;let u;const H={PortalGroup:()=>Promise.resolve({default:y}),PortalItem:()=>new Promise((I,J)=>g(["./PortalItem"],M=>I(D(M)),J)),PortalUser:()=>Promise.resolve({default:E})};m=B=class extends m.JSONSupportMixin(k){constructor(I){super(I);
this.access=this._esriIdCredentialCreateHandle=null;this.allSSL=!1;this.authMode="auto";this.bingKey=this.basemapGalleryGroupQuery3D=this.basemapGalleryGroupQuery=this.authorizedCrossOriginDomains=null;this.canProvisionDirectPurchase=this.canListPreProvisionedItems=this.canListData=this.canListApps=!1;this.canSearchPublic=!0;this.canSignInIDP=this.canSignInArcGIS=this.canSharePublic=this.canShareBingPublic=!1;this.colorSetsGroupQuery=null;this.commentsEnabled=!1;this.livingAtlasGroupQuery=this.galleryTemplatesGroupQuery=
this.featuredItemsGroupQuery=this.featuredGroups=this.eueiEnabled=this.devBasemapGalleryGroupQuery=this.description=this.defaultVectorBasemap=this.defaultExtent=this.defaultDevBasemap=this.defaultBasemap=this.customBaseUrl=this.culture=this.created=null;this.hasCategorySchema=!1;this.ipCntryCode=this.id=this.httpsPort=this.httpPort=this.homePageFeaturedContentCount=this.homePageFeaturedContent=this.helperServices=null;this.isReadOnly=this.isPortal=!1;this.rotatorPanels=this.region=this.portalProperties=
this.portalMode=this.portalHostname=this.name=this.modified=this.maxTokenExpirationMinutes=this.layerTemplatesGroupQuery=null;this.showHomePageDescription=!1;this.sourceJSON=null;this.supportsHostedServices=!1;this.units=this.templatesGroupQuery=this.symbolSetsGroupQuery=null;this.url=x.portalUrl;this.user=this.urlKey=null;this.use3dBasemaps=!0;this.useVectorBasemaps=this.useStandardizedQuery=!1;this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(I){return"string"===typeof I?{url:I}:I}destroy(){G.unregister(this);
this.defaultBasemap=f.destroyMaybe(this.defaultBasemap);this.defaultDevBasemap=f.destroyMaybe(this.defaultDevBasemap);this.defaultVectorBasemap=f.destroyMaybe(this.defaultVectorBasemap);this._esriIdCredentialCreateHandle=f.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(I){if(I)for(const J of I)x.request.trustedServers.includes(J)||x.request.trustedServers.push(J);return I}readDefaultBasemap(I){return this._readBasemap(I)}readDefaultDevBasemap(I){return this._readBasemap(I)}readDefaultVectorBasemap(I){return this._readBasemap(I)}get extraQuery(){const I=
!this.user?.orgId||this.canSearchPublic;return this.id&&!I?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let I=this.url;if(I){const J=I.indexOf("/sharing");I=0<J?I.substring(0,J):this.url.replace(/\/+$/,"");I+="/sharing/rest"}return I}get thumbnailUrl(){const I=this.restUrl,J=this.thumbnail;return I&&J?this._normalizeSSL(I+"/portals/self/resources/"+J):null}readUrlKey(I){return I?I.toLowerCase():
I}readUser(I){let J=null;I&&(J=E.fromJSON(I),J.portal=this);return J}load(I){const J=(new Promise((M,R)=>g(["../Basemap"],Y=>M(D(Y)),R))).then(({default:M})=>{e.throwIfAborted(I);u=M}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,I)).then(M=>{if(w.id){const R=w.id;this.credential=R.findCredential(this.restUrl);this.credential||this.authMode!==B.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=R.on("credential-create",F(new WeakRef(this))),
G.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=M;this.read(M)});this.addResolvingPromise(J);return Promise.resolve(this)}async createElevationLayers(){await this.load();const I=this._getHelperService("defaultElevationLayers"),J=(await new Promise((M,R)=>g(["../layers/ElevationLayer"],Y=>M(D(Y)),R))).default;return I?I.map(M=>new J({id:M.id,url:M.url})):[]}async fetchBasemaps(I,J){const M=await this._fetchBasemaps(I,J);!0===J?.include3d&&!1!==this.use3dBasemaps&&(I=await this._fetchBasemaps3D(I,
J),M.unshift(...I));return M}fetchCategorySchema(I){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",I).then(J=>J.categorySchema):e.isAborted(I)?Promise.reject(e.createAbortError()):Promise.resolve([])}fetchFeaturedGroups(I){const J=this.featuredGroups,M=new h;M.num=100;M.sortField="title";if(J&&J.length){const R=[];for(const Y of J)R.push(`(title:"${Y.title}" AND owner:${Y.owner})`);M.query=R.join(" OR ");return this.queryGroups(M,I).then(Y=>Y.results)}return e.isAborted(I)?
Promise.reject(e.createAbortError()):Promise.resolve([])}fetchRegions(I){const J=this.user?.culture||this.culture||t.getLocale();return this.request(this.restUrl+"/portals/regions",{...I,query:{culture:J}})}fetchSettings(I){const J=this.user?.culture||this.culture||t.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...I,query:{culture:J}})}static getDefault(){return v.ensureDefaultPortalInstance(()=>new B)}queryGroups(I,J){return this.queryPortal("/community/groups",I,"PortalGroup",
J)}queryItems(I,J){return this.queryPortal("/search",I,"PortalItem",J)}queryUsers(I,J){I.sortField||(I.sortField="username");return this.queryPortal("/community/users",I,"PortalUser",J)}fetchSelf(I=this.authMode,J=!1,M){const R=this.restUrl+"/portals/self";I={authMode:I,query:{culture:t.getLocale().toLowerCase()},...M};"auto"===I.authMode&&(I.authMode="no-prompt");J&&(I.query.default=!0);return this.request(R,I)}queryPortal(I,J,M,R){const Y=b.ensureType(h,J),fa=O=>this.request(this.restUrl+I,{...Y.toRequestOptions(this),
...R}).then(Q=>{const Z=Y.clone();Z.start=Q.nextStart;return new A({nextQueryParams:Z,queryParams:Y,total:Q.total,results:B._resultsToTypedArray(O,{portal:this},Q,R)})}).then(Q=>Promise.all(Q.results.map(Z=>"function"===typeof Z.when?Z.when():Q)).then(()=>Q,Z=>{e.throwIfAbortError(Z);return Q}));return M&&H[M]?H[M]().then(({default:O})=>{e.throwIfAborted(R);return fa(O)}):fa()}signIn(){if(this.authMode===B.AUTH_MODE_ANONYMOUS)return Promise.reject(new r("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));
if("failed"===this.loadStatus)return Promise.reject(this.loadError);const I=J=>Promise.resolve().then(()=>{if("not-loaded"===this.loadStatus)return J||(this.authMode="immediate"),this.load().then(()=>null);if("loading"===this.loadStatus)return this.load().then(()=>{if(this.credential)return null;this.credential=J;return this.fetchSelf("immediate")});if(this.user&&this.credential===J)return null;this.credential=J;return this.fetchSelf("immediate")}).then(M=>{M&&(this.sourceJSON=M,this.read(M))});return w.id?
w.id.getCredential(this.restUrl).then(J=>I(J)):I(this.credential)}normalizeUrl(I){const J=this.credential?.token;return this._normalizeSSL(J?I+(I.includes("?")?"\x26":"?")+"token\x3d"+J:I)}requestToTypedArray(I,J,M){return this.request(I,J).then(R=>{const Y=B._resultsToTypedArray(M,{portal:this},R);return Promise.all(Y.map(fa=>"function"===typeof fa.when?fa.when():R)).then(()=>Y,()=>Y)})}request(I,J={}){const M={f:"json",...J.query},{authMode:R=this.authMode===B.AUTH_MODE_ANONYMOUS?"anonymous":"auto",
body:Y=null,cacheBust:fa=!1,method:O="auto",responseType:Q="json",signal:Z}=J;J={authMode:R,body:Y,cacheBust:fa,method:O,query:M,responseType:Q,timeout:0,signal:Z};return C(this._normalizeSSL(I),J).then(ba=>ba.data)}toJSON(){throw new r("internal:not-yet-implemented","Portal.toJSON is not yet implemented");}static fromJSON(I){if(!I)return null;if(I.declaredClass)throw Error("JSON object is already hydrated");return new B({sourceJSON:I})}_getHelperService(I){const J=this.helperServices&&this.helperServices[I];
if(!J)throw new r("portal:service-not-found",`The \`helperServices\` do not include an entry named "${I}"`);return J}async _fetchBasemaps(I,J){const M=new h;M.query=I||(x.apiKey&&z.supportsApiKey(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);M.disableExtraQuery=!0;I=await this.queryGroups(M,J);if(!I.total)return[];I=I.results[0];M.num=100;M.query='type:"Web Map" -type:"Web Application"';M.sortField=I.sortField||
"name";M.sortOrder=I.sortOrder||"desc";J=await I.queryItems(M,J);return J.total?J.results.filter(R=>"Web Map"===R.type).map(R=>new u({portalItem:R})):[]}async _fetchBasemaps3D(I,J){I=I||this.basemapGalleryGroupQuery3D;if(!I)return[];I=new h({query:I,disableExtraQuery:!0});var M=await this.queryGroups(I,J);if(!M.total)return[];M=M.results[0];I.num=100;I.query='type:"Web Scene"';I.sortField=M.sortField||"name";I.sortOrder=M.sortOrder||"desc";J=await M.queryItems(I,J);return J.total?J.results.filter(R=>
"Web Scene"===R.type).map(R=>new u({portalItem:R})):[]}_normalizeSSL(I){return I.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(I){return I?(I=u.fromJSON(I),I.portalItem={portal:this},I):null}static _resultsToTypedArray(I,J,M,R){let Y=[];if(M){const fa=null!=R?R.signal:null;Y=M.listings||M.notifications||M.userInvitations||M.tags||M.items||M.groups||M.comments||M.provisions||M.results||M.relatedItems||M;if(I||J)Y=Y.map(O=>{O=Object.assign(I?I.fromJSON(O):O,J);"function"===typeof O.load&&
O.load(fa);return O})}else Y=[];return Y}};m.AUTH_MODE_ANONYMOUS="anonymous";m.AUTH_MODE_AUTO="auto";m.AUTH_MODE_IMMEDIATE="immediate";q.__decorate([l.property()],m.prototype,"access",void 0);q.__decorate([l.property()],m.prototype,"allSSL",void 0);q.__decorate([l.property()],m.prototype,"authMode",void 0);q.__decorate([l.property()],m.prototype,"authorizedCrossOriginDomains",void 0);q.__decorate([d.reader("authorizedCrossOriginDomains")],m.prototype,"readAuthorizedCrossOriginDomains",null);q.__decorate([l.property()],
m.prototype,"basemapGalleryGroupQuery",void 0);q.__decorate([l.property({json:{name:"3DBasemapGalleryGroupQuery"}})],m.prototype,"basemapGalleryGroupQuery3D",void 0);q.__decorate([l.property()],m.prototype,"bingKey",void 0);q.__decorate([l.property()],m.prototype,"canListApps",void 0);q.__decorate([l.property()],m.prototype,"canListData",void 0);q.__decorate([l.property()],m.prototype,"canListPreProvisionedItems",void 0);q.__decorate([l.property()],m.prototype,"canProvisionDirectPurchase",void 0);
q.__decorate([l.property()],m.prototype,"canSearchPublic",void 0);q.__decorate([l.property()],m.prototype,"canShareBingPublic",void 0);q.__decorate([l.property()],m.prototype,"canSharePublic",void 0);q.__decorate([l.property()],m.prototype,"canSignInArcGIS",void 0);q.__decorate([l.property()],m.prototype,"canSignInIDP",void 0);q.__decorate([l.property()],m.prototype,"colorSetsGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"commentsEnabled",void 0);q.__decorate([l.property({type:Date})],
m.prototype,"created",void 0);q.__decorate([l.property()],m.prototype,"credential",void 0);q.__decorate([l.property()],m.prototype,"culture",void 0);q.__decorate([l.property()],m.prototype,"currentVersion",void 0);q.__decorate([l.property()],m.prototype,"customBaseUrl",void 0);q.__decorate([l.property()],m.prototype,"defaultBasemap",void 0);q.__decorate([d.reader("defaultBasemap")],m.prototype,"readDefaultBasemap",null);q.__decorate([l.property()],m.prototype,"defaultDevBasemap",void 0);q.__decorate([d.reader("defaultDevBasemap")],
m.prototype,"readDefaultDevBasemap",null);q.__decorate([l.property({type:n})],m.prototype,"defaultExtent",void 0);q.__decorate([l.property()],m.prototype,"defaultVectorBasemap",void 0);q.__decorate([d.reader("defaultVectorBasemap")],m.prototype,"readDefaultVectorBasemap",null);q.__decorate([l.property()],m.prototype,"description",void 0);q.__decorate([l.property()],m.prototype,"devBasemapGalleryGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"eueiEnabled",void 0);q.__decorate([l.property({readOnly:!0})],
m.prototype,"extraQuery",null);q.__decorate([l.property()],m.prototype,"featuredGroups",void 0);q.__decorate([l.property()],m.prototype,"featuredItemsGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"galleryTemplatesGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"livingAtlasGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"hasCategorySchema",void 0);q.__decorate([l.property()],m.prototype,"helpBase",void 0);q.__decorate([l.property()],m.prototype,"helperServices",
void 0);q.__decorate([l.property()],m.prototype,"helpMap",void 0);q.__decorate([l.property()],m.prototype,"homePageFeaturedContent",void 0);q.__decorate([l.property()],m.prototype,"homePageFeaturedContentCount",void 0);q.__decorate([l.property()],m.prototype,"httpPort",void 0);q.__decorate([l.property()],m.prototype,"httpsPort",void 0);q.__decorate([l.property()],m.prototype,"id",void 0);q.__decorate([l.property()],m.prototype,"ipCntryCode",void 0);q.__decorate([l.property({readOnly:!0})],m.prototype,
"isOrganization",null);q.__decorate([l.property()],m.prototype,"isPortal",void 0);q.__decorate([l.property()],m.prototype,"isReadOnly",void 0);q.__decorate([l.property({readOnly:!0})],m.prototype,"itemPageUrl",null);q.__decorate([l.property()],m.prototype,"layerTemplatesGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"maxTokenExpirationMinutes",void 0);q.__decorate([l.property({type:Date})],m.prototype,"modified",void 0);q.__decorate([l.property()],m.prototype,"name",void 0);q.__decorate([l.property()],
m.prototype,"portalHostname",void 0);q.__decorate([l.property()],m.prototype,"portalMode",void 0);q.__decorate([l.property()],m.prototype,"portalProperties",void 0);q.__decorate([l.property()],m.prototype,"region",void 0);q.__decorate([l.property({readOnly:!0})],m.prototype,"restUrl",null);q.__decorate([l.property()],m.prototype,"rotatorPanels",void 0);q.__decorate([l.property()],m.prototype,"showHomePageDescription",void 0);q.__decorate([l.property()],m.prototype,"sourceJSON",void 0);q.__decorate([l.property()],
m.prototype,"staticImagesUrl",void 0);q.__decorate([l.property({json:{name:"2DStylesGroupQuery"}})],m.prototype,"stylesGroupQuery2d",void 0);q.__decorate([l.property({json:{name:"stylesGroupQuery"}})],m.prototype,"stylesGroupQuery3d",void 0);q.__decorate([l.property()],m.prototype,"supportsHostedServices",void 0);q.__decorate([l.property()],m.prototype,"symbolSetsGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"templatesGroupQuery",void 0);q.__decorate([l.property()],m.prototype,"thumbnail",
void 0);q.__decorate([l.property({readOnly:!0})],m.prototype,"thumbnailUrl",null);q.__decorate([l.property()],m.prototype,"units",void 0);q.__decorate([l.property()],m.prototype,"url",void 0);q.__decorate([l.property()],m.prototype,"urlKey",void 0);q.__decorate([d.reader("urlKey")],m.prototype,"readUrlKey",null);q.__decorate([l.property()],m.prototype,"user",void 0);q.__decorate([d.reader("user")],m.prototype,"readUser",null);q.__decorate([l.property()],m.prototype,"use3dBasemaps",void 0);q.__decorate([l.property()],
m.prototype,"useStandardizedQuery",void 0);q.__decorate([l.property()],m.prototype,"useVectorBasemaps",void 0);q.__decorate([l.property()],m.prototype,"vectorBasemapGalleryGroupQuery",void 0);q=m=B=q.__decorate([a.subclass("esri.portal.Portal")],m);const G=new FinalizationRegistry(I=>{I.remove()});return q})},"esri/portal/portalDefault":function(){define(["exports"],function(g){let q;g.clearDefaultPortalInstance=function(){q=void 0};g.ensureDefaultPortalInstance=function(x){if(!q||q.destroyed)q=x();
return q};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/portal/PortalGroup":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./PortalQueryParams".split(" "),function(g,q,x,w,C,r,m,k,f){var e;x=e=class extends x.JSONSupport{constructor(l){super(l);this.id=this.description=this.created=this.access=null;
this.isInvitationOnly=!1;this.title=this.tags=this.sourceJSON=this.sortOrder=this.sortField=this.snippet=this.portal=this.owner=this.modified=null}get thumbnailUrl(){const l=this.url,b=this.thumbnail;return l&&b&&this.portal?this.portal?.normalizeUrl(`${l}/info/${b}?f=json`):null}get url(){const l=this.portal?.restUrl;return l?l+"/community/groups/"+this.id:null}fetchCategorySchema(l){return this.portal.request(this.url+"/categorySchema",l).then(b=>{b=b.categorySchema||[];return b.some(p=>"contentCategorySetsGroupQuery.LivingAtlas"===
p.source)?this._fetchCategorySchemaSet("LivingAtlas",l):b})}fetchMembers(l){return this.portal.request(this.url+"/users",l)}getThumbnailUrl(l){let b=this.thumbnailUrl;b&&l&&(b+=`&w=${l}`);return b}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");}static fromJSON(l){if(!l)return null;if(l.declaredClass)throw Error("JSON object is already hydrated");const b=new e;b.sourceJSON=l;b.read(l);return b}queryItems(l,b){l=C.ensureType(f,l);const p=this.portal;
if(5<parseFloat(p.currentVersion))return l=l||new f,p.queryPortal(`/content/groups/${this.id}/search`,l,"PortalItem",b);l=l?l.clone():new f;l.query="group:"+this.id+(l.query?" "+l.query:"");return p.queryItems(l,b)}_fetchCategorySchemaSet(l,b){const p=this.portal;return p.fetchSelf(p.authMode,!0,b).then(c=>{if(c=c.contentCategorySetsGroupQuery){const d=new f;d.disableExtraQuery=!0;d.num=1;d.query=c;return p.queryGroups(d,b)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found");
}).then(c=>{if(c.total){c=c.results[0];const d=new f;d.num=1;d.query=`typekeywords:"${l}"`;return c.queryItems(d,b)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found");}).then(c=>c.total?c.results[0].fetchData("json",b).then(d=>{d=d?.categorySchema;return d?.length?d:[]}):[])}};g.__decorate([w.property()],x.prototype,"access",void 0);g.__decorate([w.property({type:Date})],x.prototype,"created",void 0);g.__decorate([w.property()],x.prototype,"description",
void 0);g.__decorate([w.property()],x.prototype,"id",void 0);g.__decorate([w.property()],x.prototype,"isInvitationOnly",void 0);g.__decorate([w.property({type:Date})],x.prototype,"modified",void 0);g.__decorate([w.property()],x.prototype,"owner",void 0);g.__decorate([w.property()],x.prototype,"portal",void 0);g.__decorate([w.property()],x.prototype,"snippet",void 0);g.__decorate([w.property()],x.prototype,"sortField",void 0);g.__decorate([w.property()],x.prototype,"sortOrder",void 0);g.__decorate([w.property()],
x.prototype,"sourceJSON",void 0);g.__decorate([w.property()],x.prototype,"tags",void 0);g.__decorate([w.property()],x.prototype,"thumbnail",void 0);g.__decorate([w.property({readOnly:!0})],x.prototype,"thumbnailUrl",null);g.__decorate([w.property()],x.prototype,"title",void 0);g.__decorate([w.property({readOnly:!0})],x.prototype,"url",null);return x=e=g.__decorate([k.subclass("esri.portal.PortalGroup")],x)})},"esri/portal/PortalQueryParams":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e){var l;const b=new x.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});q=l=class extends q{constructor(p){super(p);this.categories=null;this.disableExtraQuery=!1;this.filter=this.extent=null;this.num=10;this.sortField=this.query=null;this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(p){"asc"!==p&&"desc"!==p||this._set("sortOrder",p)}clone(){return new l({categories:this.categories?w.clone(this.categories):
null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(p,c){let d=[];this.categories&&(d=this.categories.map(t=>Array.isArray(t)?JSON.stringify(t):t));let a="";if(this.extent){var n=e.project(this.extent,f.WGS84);null!=n&&(a=`${n.xmin},${n.ymin},${n.xmax},${n.ymax}`)}n=this.query;!this.disableExtraQuery&&p.extraQuery&&(n="("+n+")"+
p.extraQuery);p={categories:d,bbox:a,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};this.sortField&&(p.sortField=this.sortField.split(",").map(t=>b.toJSON(t.trim())).join(","),p.sortOrder=this.sortOrder);return{query:{...c,...p}}}};g.__decorate([C.property()],q.prototype,"categories",void 0);g.__decorate([C.property()],q.prototype,"disableExtraQuery",void 0);g.__decorate([C.property({type:k})],q.prototype,"extent",void 0);g.__decorate([C.property()],q.prototype,
"filter",void 0);g.__decorate([C.property()],q.prototype,"num",void 0);g.__decorate([C.property()],q.prototype,"query",void 0);g.__decorate([C.property()],q.prototype,"sortField",void 0);g.__decorate([C.property()],q.prototype,"sortOrder",null);g.__decorate([C.property()],q.prototype,"start",void 0);return q=l=g.__decorate([m.subclass("esri.portal.PortalQueryParams")],q)})},"esri/portal/PortalQueryResult":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m){q=class extends q{constructor(k){super(k);this.total=this.results=this.queryParams=this.nextQueryParams=null}};g.__decorate([x.property()],q.prototype,"nextQueryParams",void 0);g.__decorate([x.property()],q.prototype,"queryParams",void 0);g.__decorate([x.property()],q.prototype,"results",void 0);g.__decorate([x.property()],q.prototype,"total",void 0);return q=g.__decorate([m.subclass("esri.portal.PortalQueryResult")],q)})},"esri/portal/PortalUser":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){var b;w=b=class extends w.JSONSupport{constructor(...p){super(...p);this.userType=this.username=this.units=this.sourceJSON=this.roleId=this.role=this.region=this.privileges=this.preferredView=this.portal=this.orgId=this.modified=this.fullName=this.email=this.description=this.culture=this.created=this.access=null}get thumbnailUrl(){const p=this.url,c=this.thumbnail;return p&&c?this.portal.normalizeUrl(`${p}/info/${c}?f=json`):null}get userContentUrl(){const p=this.portal?.restUrl;
return p?`${p}/content/users/${this.username}`:null}get url(){const p=this.portal?.restUrl;return p?`${p}/community/users/${this.username}`:null}addItem(p){const c=p&&p.item;var d=p?.data;p=p?.folder;const a={method:"post"};c&&(a.query=c.createPostQuery(),null!=d&&("string"===typeof d?a.query.text=d:"object"===typeof d&&(a.query.text=JSON.stringify(d))));d=this.userContentUrl;p&&(d+="/"+("string"===typeof p?p:p.id));return this.portal.request(d+"/addItem",a).then(n=>{c.id=n.id;c.portal=this.portal;
return c.loaded?c.reload():c.load()})}deleteItem(p){let c=this.userContentUrl;p.ownerFolder&&(c+="/"+p.ownerFolder);return this.portal.request(c+`/items/${p.id}/delete`,{method:"post"}).then(()=>{p.id=null;p.portal=null})}deleteItems(p){const c=this.userContentUrl+"/deleteItems";var d=p.map(a=>a.id);return d.length?(d={method:"post",query:{items:d.join(",")}},this.portal.request(c,d).then(()=>{p.forEach(a=>{a.id=null;a.portal=null})})):Promise.resolve(void 0)}fetchFolders(){return this.portal.request(this.userContentUrl??
"",{query:{num:1}}).then(p=>p&&p.folders?p.folders.map(c=>{c=e.fromJSON(c);c.portal=this.portal;return c}):[])}fetchGroups(){return this.portal.request(this.url??"").then(p=>p&&p.groups?p.groups.map(c=>{c=l.fromJSON(c);c.portal=this.portal;return c}):[])}fetchItems(p){const c=p??{};let d=this.userContentUrl??"";c.folder&&(d+="/"+c.folder.id);let a;return(new Promise((n,t)=>g(["./PortalItem"],v=>n(Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}))),
t))).then(({default:n})=>{a=n;return this.portal.request(d,{query:{folders:!1,num:c.num||10,start:c.start||1,sortField:c.sortField||"created",sortOrder:c.sortOrder||"asc"}})}).then(n=>{let t;return n?.items?(t=n.items.map(v=>{v=a.fromJSON(v);v.portal=this.portal;return v}),Promise.all(t.map(v=>v.load())).catch(v=>v).then(()=>({items:t,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(p=>p.tags)}getThumbnailUrl(p){let c=
this.thumbnailUrl;c&&p&&(c+=`&w=${p}`);return c}queryFavorites(p){return this.favGroupId?(this._favGroup||(this._favGroup=new l({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(p)):Promise.reject(new x("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new x("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented");}static fromJSON(p){if(!p)return null;if(p.declaredClass)throw Error("JSON object is already hydrated");
const c=new b;c.sourceJSON=p;c.read(p);return c}};q.__decorate([C.property()],w.prototype,"access",void 0);q.__decorate([C.property({type:Date})],w.prototype,"created",void 0);q.__decorate([C.property()],w.prototype,"culture",void 0);q.__decorate([C.property()],w.prototype,"description",void 0);q.__decorate([C.property()],w.prototype,"email",void 0);q.__decorate([C.property()],w.prototype,"favGroupId",void 0);q.__decorate([C.property()],w.prototype,"fullName",void 0);q.__decorate([C.property({type:Date})],
w.prototype,"modified",void 0);q.__decorate([C.property()],w.prototype,"orgId",void 0);q.__decorate([C.property()],w.prototype,"portal",void 0);q.__decorate([C.property()],w.prototype,"preferredView",void 0);q.__decorate([C.property()],w.prototype,"privileges",void 0);q.__decorate([C.property()],w.prototype,"region",void 0);q.__decorate([C.property()],w.prototype,"role",void 0);q.__decorate([C.property()],w.prototype,"roleId",void 0);q.__decorate([C.property()],w.prototype,"sourceJSON",void 0);q.__decorate([C.property()],
w.prototype,"thumbnail",void 0);q.__decorate([C.property({readOnly:!0})],w.prototype,"thumbnailUrl",null);q.__decorate([C.property()],w.prototype,"units",void 0);q.__decorate([C.property({readOnly:!0})],w.prototype,"userContentUrl",null);q.__decorate([C.property({readOnly:!0})],w.prototype,"url",null);q.__decorate([C.property()],w.prototype,"username",void 0);q.__decorate([C.property()],w.prototype,"userType",void 0);return w=b=q.__decorate([f.subclass("esri.portal.PortalUser")],w)})},"esri/portal/PortalFolder":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k){x=class extends x.JSONSupport{constructor(f){super(f);this.username=this.title=this.portal=this.id=this.created=null}get url(){const f=this.portal?.restUrl;return f?`${f}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented");}};g.__decorate([w.property({type:Date})],x.prototype,"created",void 0);g.__decorate([w.property()],x.prototype,"id",void 0);g.__decorate([w.property()],x.prototype,
"portal",void 0);g.__decorate([w.property()],x.prototype,"title",void 0);g.__decorate([w.property({readOnly:!0})],x.prototype,"url",null);g.__decorate([w.property()],x.prototype,"username",void 0);return x=g.__decorate([k.subclass("esri.portal.PortalFolder")],x)})},"esri/portal/PortalItem":function(){define("require ../chunks/tslib.es6 ../assets ../kernel ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ./Portal ./PortalItemResource ./PortalRating".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n){var t;const v=new Set("Map Service;Feature Service;Feature Collection;Scene Service;Image Service;Stream Service;Vector Tile Service;GeoJson;CSV;KML;WFS;WMTS;WMS;Feed".split(";")),y=new Set(["KML","GeoJson","CSV"]);r=t=class extends r.JSONSupportMixin(k){static from(h){return l.ensureClass(t,h)}constructor(h){super(h);this.id=this.groupCategories=this.extent=this.description=this.culture=this.created=this.categories=this.avgRating=this.applicationProxies=
this.apiKey=this.accessInformation=this.access=null;this.isOrgItem=!1;this.url=this.typeKeywords=this.type=this.title=this.tags=this.spatialReference=this.sourceUrl=this.sourceJSON=this.snippet=this.size=this.screenshots=this.portal=this.ownerFolder=this.owner=this.numViews=this.numRatings=this.numComments=this.name=this.modified=this.licenseInfo=this.itemControl=null}destroy(){this.portal=null}get displayName(){const h=this.type,A=this.typeKeywords||[];let E=h;"Feature Service"===h||"Feature Collection"===
h?E=A.includes("Table")?"Table":A.includes("Route Layer")?"Route Layer":A.includes("Markup")?"Markup":"Feature Layer":"Image Service"===h?E=A.includes("Elevation 3D Layer")?"Elevation Layer":A.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===h?E="Scene Layer":"Video Service"===h?E="Video Layer":"Scene Package"===h?E="Scene Layer Package":"Stream Service"===h?E="Feature Layer":"Geoprocessing Service"===h?E=A.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===
h?E="Locator":"Geoenrichment Service"===h?E="GeoEnrichment Service":"Microsoft Powerpoint"===h?E="Microsoft PowerPoint":"GeoJson"===h?E="GeoJSON":"Globe Service"===h?E="Globe Layer":"Vector Tile Service"===h?E="Tile Layer":"netCDF"===h?E="NetCDF":"Map Service"===h?E=A.includes("Spatiotemporal")||!A.includes("Hosted Service")&&!A.includes("Tiled")||A.includes("Relational")?"Map Image Layer":"Tile Layer":h&&h.toLowerCase().includes("add in")?E=h.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===
h?E="Big Data File Share":"Compact Tile Package"===h?E="Tile Package (tpkx)":"OGCFeatureServer"===h?E="OGC Feature Layer":"web mapping application"===h&&A.includes("configurableApp")?E="Instant App":"Insights Page"===h?E="Insights Report":"Excalibur Imagery Project"===h&&(E="Excalibur Project");return E}readExtent(h){return h&&h.length?new c(h[0][0],h[0][1],h[1][0],h[1][1]):null}get iconUrl(){var h=this.type?.toLowerCase()||"";const A=this.typeKeywords||[];var E=!1;let z=!1,F=!1,D=!1,B=!1,u=!1;E=
!1;0<h.indexOf("service")||"feature collection"===h||"kml"===h||"wms"===h||"wmts"===h||"wfs"===h?(E=A.includes("Hosted Service"),"feature service"===h||"feature collection"===h||"kml"===h||"wfs"===h?(z=A.includes("Table"),F=A.includes("Route Layer"),D=A.includes("Markup"),B=A.includes("Spatiotemporal"),u=A.includes("UtilityNetwork"),h=B&&z?"spatiotemporaltable":z?"table":F?"routelayer":D?"markup":B?"spatiotemporal":E?"featureshosted":u?"utilitynetwork":"features"):h="map service"===h||"wms"===h||
"wmts"===h?E||A.includes("Tiled")||"wmts"===h?"maptiles":"mapimages":"scene service"===h?A.includes("Line")?"sceneweblayerline":A.includes("3DObject")?"sceneweblayermultipatch":A.includes("Point")?"sceneweblayerpoint":A.includes("IntegratedMesh")?"sceneweblayermesh":A.includes("PointCloud")?"sceneweblayerpointcloud":A.includes("Polygon")?"sceneweblayerpolygon":A.includes("Building")?"sceneweblayerbuilding":A.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===h?A.includes("Elevation 3D Layer")?
"elevationlayer":A.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===h?"streamlayer":"video service"===h?A.includes("Live Stream")?"livestreamvideolayer":"videolayer":"vector tile service"===h?"vectortile":"datastore catalog service"===h?"datastorecollection":"geocoding service"===h?"geocodeservice":"geoprocessing service"===h?A.includes("Web Tool")?"tool":"layers":"geodata service"===h?"geodataservice":"3dtiles service"===h?"3dtileslayer":"layers"):h="web map"===h||"cityengine web scene"===
h?"maps":"web scene"===h?A.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===h&&A.includes("configurableApp")?"instantapps":"web mapping application"===h||"mobile application"===h||"application"===h||"operation view"===h||"desktop application"===h?"apps":"map document"===h||"map package"===h||"published map"===h||"scene document"===h||"globe document"===h||"basemap package"===h||"mobile basemap package"===h||"mobile map package"===h||"project package"===h||
"project template"===h||"pro map"===h||"layout"===h||"layer"===h&&A.includes("ArcGIS Pro")||"explorer map"===h&&A.indexOf("Explorer Document")?"mapsgray":"service definition"===h||"csv"===h||"shapefile"===h||"cad drawing"===h||"geojson"===h||"netcdf"===h||"administrative report"===h?"datafiles":"explorer add in"===h||"desktop add in"===h||"windows viewer add in"===h||"windows viewer configuration"===h?"appsgray":"360 vr experience"===h?"360vr":"arcgis pro add in"===h||"arcgis pro configuration"===
h?"addindesktop":"rule package"===h||"file geodatabase"===h||"sqlite geodatabase"===h||"csv collection"===h||"kml collection"===h||"windows mobile package"===h||"map template"===h||"desktop application template"===h||"gml"===h||"arcpad package"===h||"code sample"===h||"document link"===h||"earth configuration"===h||"operations dashboard add in"===h||"rules package"===h||"image"===h||"workflow manager package"===h||"explorer map"===h&&A.includes("Explorer Mapping Application")||A.includes("Document")?
"datafilesgray":"network analysis service"===h||"geoprocessing service"===h||"geodata service"===h||"geometry service"===h||"geoprocessing package"===h||"locator package"===h||"geoprocessing sample"===h||"workflow manager service"===h?"toolsgray":"layer"===h||"layer package"===h||"explorer layer"===h?"layersgray":"scene package"===h?"scenepackage":"3dtiles package"===h?"3dtileslayerpackage":"mobile scene package"===h?"mobilescenepackage":"tile package"===h||"compact tile package"===h?"tilepackage":
"task file"===h?"taskfile":"report template"===h?"report-template":"statistical data collection"===h?"statisticaldatacollection":"insights workbook"===h?"workbook":"insights model"===h?"insightsmodel":"insights page"===h?"insightspage":"insights theme"===h?"insightstheme":"hub initiative"===h?"hubinitiative":"hubpage"===h?"hubpage":"hub event"===h?"hubevent":"hub site application"===h?"hubsite":"hub project"===h?"hubproject":"relational database connection"===h?"relationaldatabaseconnection":"big data file share"===
h?"datastorecollection":"image collection"===h?"imagecollection":"style"===h?"style":"desktop style"===h?"desktopstyle":"dashboard"===h?"dashboard":"raster function template"===h?"rasterprocessingtemplate":"vector tile package"===h?"vectortilepackage":"ortho mapping project"===h?"orthomappingproject":"ortho mapping template"===h?"orthomappingtemplate":"solution"===h?"solutions":"geopackage"===h?"geopackage":"deep learning package"===h?"deeplearningpackage":"real time analytic"===h?"realtimeanalytics":
"big data analytic"===h?"bigdataanalytics":"feed"===h?"feed":"excalibur imagery project"===h?"excaliburimageryproject":"notebook"===h?"notebook":"storymap"===h?"storymap":"survey123 add in"===h?"survey123addin":"mission"===h?"mission":"mission report"===h?"missionreport":"mission template"===h?"missiontemplate":"quickcapture project"===h?"quickcaptureproject":"pro report"===h?"proreport":"pro report template"===h?"proreporttemplate":"urban model"===h?"urbanmodel":"web experience"===h?"experiencebuilder":
"web experience template"===h?"webexperiencetemplate":"experience builder widget"===h?"experiencebuilderwidget":"experience builder widget package"===h?"experiencebuilderwidgetpackage":"workflow"===h?"workflow":"insights script"===h?"insightsscript":"kernel gateway connection"===h?"kernelgatewayconnection":"hub initiative template"===h?"hubinitiativetemplate":"storymap theme"===h?"storymaptheme":"knowledge graph"===h?"knowledgegraph":"knowledge studio project"===h?"knowledgestudio":"native application"===
h?"nativeapp":"native application installer"===h?"nativeappinstaller":"link chart"===h?"linkchart":"investigation"===h?"investigation":"ogcfeatureserver"===h?"features":"pro project"===h?"proproject":"insights workbook package"===h?"insightsworkbookpackage":"apache parquet"===h?"apacheparquet":"notebook code snippets"===h||"notebook code snippet library"===h?"notebookcodesnippets":"suitability model"===h?"suitabilitymodel":"esri classifier definition"===h?"classifierdefinition":"esri classification schema"===
h?"classificationschema":"insights data engineering workbook"===h?"dataengineeringworkbook":"insights data engineering model"===h?"dataengineeringmodel":"deep learning studio project"===h?"deeplearningproject":"discussion"===h?"discussion":"allsource project"===h?"allsourceproject":"api key"===h?"apikey":"data pipeline"===h?"datapipelines":"group layer"===h?(E=A.includes("Map"))?"layergroup2d":"layergroup":"media layer"===h?"onlinemedialayer":"form"===h?A.includes("Survey123")?"survey":"datafilesgray":
"maps";return h?x.getAssetUrl("esri/images/portal/"+h+"16.png"):null}get isLayer(){return null!=this.type&&v.has(this.type)}get itemCdnUrl(){let h=this.itemUrl;h&&w.id&&!w.id.findCredential(h)&&(h=w.id._normalizeAGOLorgDomain(h),h=h.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),h=h.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),h=h.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com"));return h}get itemPageUrl(){const h=this.portal?.itemPageUrl;
return h&&this.id?`${h}?id=${this.id}`:null}get itemUrl(){const h=this.portal?.restUrl;return h&&this.id?`${h}/content/items/${this.id}`:null}get thumbnailUrl(){const h=this.itemUrl,A=this.thumbnail;return h&&A?this.portal?.normalizeUrl(`${h}/info/${A}?f=json`)??null:null}get userItemUrl(){const h=this.portal?.restUrl;if(!h)return null;const A=this.owner||this.portal?.user?.username;return A?`${h}/content/users/${this.ownerFolder?`${A}/${this.ownerFolder}`:A}/items/${this.id}`:null}load(h){const A=
this.portal??(this.portal=d.getDefault()),E=A.load(h).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?A.request(this.itemUrl,{signal:null!=h?h.signal:null,query:{token:this.apiKey}}):{}).then(z=>{this.sourceJSON=z;this.read(z)});this.addResolvingPromise(E);return Promise.resolve(this)}async addRating(h){const A={method:"post",query:{}};h instanceof n&&(h=h.rating);null==h||isNaN(h)||"number"!==typeof h||(A.query.rating=h);if(!this.portal)return null;await this.portal.request(this.itemUrl+
"/addRating",A);return new n({rating:h,created:new Date})}clone(){var h={access:this.access,accessInformation:this.accessInformation,applicationProxies:m.clone(this.applicationProxies),avgRating:this.avgRating,categories:m.clone(this.categories),created:m.clone(this.created),culture:this.culture,description:this.description,extent:m.clone(this.extent),groupCategories:m.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:m.clone(this.modified),
name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:m.clone(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};this.loaded&&(h.loadStatus="loaded");h=(new t({sourceJSON:this.sourceJSON})).set(h);
h._set("isOrgItem",this.isOrgItem);return h}createPostQuery(){const h=this.toJSON();for(var A of["tags","typeKeywords","categories"])h[A]=h[A]?.join(", ");({extent:A}=h);A&&(h.extent=JSON.stringify(A));return h}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(h="json",A){return this.portal.request(this.itemUrl+"/data",{responseType:h,...A,query:{token:this.apiKey}})}async fetchRating(h){h=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},
...h});return null!=h.rating?(h.created=new Date(h.created),new n(h)):null}fetchRelatedItems(h,A){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...h,token:this.apiKey},...A},t)}getThumbnailUrl(h){let A=this.thumbnailUrl;A&&h&&(A+=`&w=${h}`);return A}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(h=>{this.sourceJSON=h;this.read(h);return this})}update(h){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>
{const A=h?.data,E={method:"post"};E.query=this.createPostQuery();for(const z in E.query)null===E.query[z]&&(E.query[z]="");E.query.clearEmptyFields=!0;null!=A&&("string"===typeof A?E.query.text=A:"object"===typeof A&&(E.query.text=JSON.stringify(A)));return this.portal.request(`${this.userItemUrl}/update`,E).then(()=>this.reload())}):Promise.reject(new C("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(h){if(!this.id)throw new C("portal:item-does-not-exist",
"The item does not exist yet");await this.load();const {portal:A,itemUrl:E}=this;await A.signIn();const {copyResources:z,folder:F,tags:D,title:B}=h||{};h={method:"post",query:{copyPrivateResources:"all"===z,folder:"string"===typeof F?F:F?.id,includeResources:!!z,tags:D?.join(","),title:B}};({itemId:h}=await A.request(`${E}/copy`,h));return new t({id:h,portal:A})}updateThumbnail(h){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const A=h.thumbnail,E=h.filename,z={method:"post"};
if("string"===typeof A)f.isDataProtocol(A)?z.query={data:A}:z.query={url:f.makeAbsolute(A)},null!=E&&(z.query.filename=E);else{const F=new FormData;null!=E?F.append("file",A,E):F.append("file",A);z.body=F}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,z).then(()=>this.reload())}):Promise.reject(new C("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(h={},A){const {fetchResources:E}=await new Promise((z,F)=>g(["./support/resourceUtils"],
z,F));return E(this,h,A)}async addResource(h,A,E){const {addOrUpdateResource:z}=await new Promise((F,D)=>g(["./support/resourceUtils"],F,D));h.portalItem=this;return z(h,"add",A,E)}async removeResource(h,A){const {removeResource:E}=await new Promise((z,F)=>g(["./support/resourceUtils"],z,F));if(h.portalItem&&h.portalItem.itemUrl!==this.itemUrl)throw new C("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return E(this,h,A)}async removeAllResources(h){const {removeAllResources:A}=
await new Promise((E,z)=>g(["./support/resourceUtils"],E,z));return A(this,h)}resourceFromPath(h){return new a({portalItem:this,path:h})}toJSON(){var h=this.extent;h={accessInformation:this.accessInformation,categories:m.clone(this.categories),created:this.created?.getTime(),description:this.description,extent:h&&[[h.xmin,h.ymin],[h.xmax,h.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,
snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};return m.fixJson(h)}static fromJSON(h){if(!h)return null;if(h.declaredClass)throw Error("JSON object is already hydrated");return new t({sourceJSON:h})}_getPostQuery(){const h=this.toJSON();for(const A in h)"tags"===A&&null!==h[A]&&(h[A]=h[A].join(", ")),"typeKeywords"===A&&null!==
h[A]&&(h[A]=h[A].join(", ")),"extent"===A&&h[A]&&(h[A]=JSON.stringify(h[A]));return h}};q.__decorate([e.property({type:["private","shared","org","public"]})],r.prototype,"access",void 0);q.__decorate([e.property()],r.prototype,"accessInformation",void 0);q.__decorate([e.property({type:String})],r.prototype,"apiKey",void 0);q.__decorate([e.property({json:{read:{source:"appProxies"}}})],r.prototype,"applicationProxies",void 0);q.__decorate([e.property()],r.prototype,"avgRating",void 0);q.__decorate([e.property()],
r.prototype,"categories",void 0);q.__decorate([e.property({type:Date})],r.prototype,"created",void 0);q.__decorate([e.property()],r.prototype,"culture",void 0);q.__decorate([e.property()],r.prototype,"description",void 0);q.__decorate([e.property({readOnly:!0})],r.prototype,"displayName",null);q.__decorate([e.property({type:c})],r.prototype,"extent",void 0);q.__decorate([b.reader("extent")],r.prototype,"readExtent",null);q.__decorate([e.property()],r.prototype,"groupCategories",void 0);q.__decorate([e.property({readOnly:!0})],
r.prototype,"iconUrl",null);q.__decorate([e.property()],r.prototype,"id",void 0);q.__decorate([e.property({readOnly:!0})],r.prototype,"isLayer",null);q.__decorate([e.property({type:Boolean,readOnly:!0})],r.prototype,"isOrgItem",void 0);q.__decorate([e.property()],r.prototype,"itemControl",void 0);q.__decorate([e.property({readOnly:!0})],r.prototype,"itemPageUrl",null);q.__decorate([e.property({readOnly:!0})],r.prototype,"itemUrl",null);q.__decorate([e.property()],r.prototype,"licenseInfo",void 0);
q.__decorate([e.property({type:Date})],r.prototype,"modified",void 0);q.__decorate([e.property()],r.prototype,"name",void 0);q.__decorate([e.property()],r.prototype,"numComments",void 0);q.__decorate([e.property()],r.prototype,"numRatings",void 0);q.__decorate([e.property()],r.prototype,"numViews",void 0);q.__decorate([e.property()],r.prototype,"owner",void 0);q.__decorate([e.property()],r.prototype,"ownerFolder",void 0);q.__decorate([e.property({type:d})],r.prototype,"portal",void 0);q.__decorate([e.property()],
r.prototype,"screenshots",void 0);q.__decorate([e.property()],r.prototype,"size",void 0);q.__decorate([e.property()],r.prototype,"snippet",void 0);q.__decorate([e.property()],r.prototype,"sourceJSON",void 0);q.__decorate([e.property({type:String})],r.prototype,"sourceUrl",void 0);q.__decorate([e.property({type:String})],r.prototype,"spatialReference",void 0);q.__decorate([e.property()],r.prototype,"tags",void 0);q.__decorate([e.property()],r.prototype,"thumbnail",void 0);q.__decorate([e.property({readOnly:!0})],
r.prototype,"thumbnailUrl",null);q.__decorate([e.property()],r.prototype,"title",void 0);q.__decorate([e.property()],r.prototype,"type",void 0);q.__decorate([e.property()],r.prototype,"typeKeywords",void 0);q.__decorate([e.property({type:String,json:{read(h,A){y.has(A.type)&&(A=this.portal?.restUrl,h||(h=A&&this.id?`${A}/content/items/${this.id}/data`:null));return h}}})],r.prototype,"url",void 0);q.__decorate([e.property({readOnly:!0})],r.prototype,"userItemUrl",null);return r=t=q.__decorate([p.subclass("esri.portal.PortalItem")],
r)})},"esri/portal/PortalItemResource":function(){define("require ../chunks/tslib.es6 ../core/Accessor ../core/Error ../core/Logger ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m,k,f,e,l){x=class extends x{constructor(b){super(b);this.portalItem=null}normalizeCtorArgs(b){return b?.portalItem&&b.path?{...b,path:this._normalizePath(b.path,
b.portalItem)}:b}set path(b){null!=b&&r.isAbsolute(b)?C.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",b)}_castPath(b){return this._normalizePath(b,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?
`./resources/${this.path}`:null}fetch(b="json",p){const c=this.cdnUrl;if(null==c)throw new w("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(c,{responseType:b,query:{token:this.portalItem.apiKey},signal:p?.signal})}async update(b,p){const {addOrUpdateResource:c}=await new Promise((d,a)=>g(["./support/resourceUtils"],d,a));return c(this,"update",b,p)}hasPath(){return null!=this.path}_normalizePath(b,p){if(null==b)return b;
b=b.replace(/^\/+/,"");null!=p&&r.isAbsolute(b)&&(b=r.makeRelative(b,p.itemUrl));return b?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,"")}};q.__decorate([m.property()],x.prototype,"portalItem",void 0);q.__decorate([m.property({type:String,value:null})],x.prototype,"path",null);q.__decorate([k.cast("path")],x.prototype,"_castPath",null);q.__decorate([m.property({type:String,readOnly:!0})],x.prototype,"url",null);q.__decorate([m.property({type:String,readOnly:!0})],x.prototype,"cdnUrl",null);
q.__decorate([m.property({type:String,readOnly:!0})],x.prototype,"itemRelativeUrl",null);return x=q.__decorate([l.subclass("esri.portal.PortalItemResource")],x)})},"esri/portal/PortalRating":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m){q=class extends q{constructor(k){super(k);this.rating=this.created=
null}};g.__decorate([x.property()],q.prototype,"created",void 0);g.__decorate([x.property()],q.prototype,"rating",void 0);return q=g.__decorate([m.subclass("esri.portal.PortalRating")],q)})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(g,q,x){g.esriBasemapDefinitions={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",
styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get "dark-gray"(){return{...this["dark-gray-vector"],
id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,
opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",
layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,
opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",
title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},
"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",
layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",
is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",
layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",
layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},
"arcgis-imagery-standard":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",
isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray.jpg")},
title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},
title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo.jpg")},title:"Topographic",
baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",
showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",
baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",
title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",
baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",
title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",
title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,
title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",
baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",
title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",
showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",
title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",
title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};g.getBasemapTitle=async function(w){if(w){var C=w.includes("-vector")?w.slice(0,w.indexOf("-vector")):
w.includes("-3d")?w.slice(0,w.indexOf("-3d")):w,r=await x.fetchMessageBundle("esri/t9n/basemaps");return r[w]||r[C]}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/support/BasemapStyle":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../intl/locale".split(" "),function(g,q,x,w,C,r,m,k){const f=new Set("ar bs ca hr cs da nl en et fi fr de el he hu id it ja ko lv lt nb pl ro ru sr es sv th tr uk vi".split(" "));
q=class extends q{constructor(e){super(e);this.language=this.id=null;this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps"}getLanguageParamValue(){if(this.language)return this.language;var e=k.getLocale().toLowerCase();switch(e){case "pt-br":return"pt-BR";case "pt-pt":return"pt-PT";case "zh-cn":return"zh-CN";case "zh-hk":return"zh-HK";case "zh-tw":return"zh-TW"}e=k.getLanguage(e);return"pt"===e?"pt-BR":e&&f.has(e)?e:"global"}};g.__decorate([x.property()],q.prototype,
"id",void 0);g.__decorate([x.property()],q.prototype,"language",void 0);g.__decorate([x.property()],q.prototype,"serviceUrl",void 0);return q=g.__decorate([m.subclass("esri.support.BasemapStyle")],q)})},"esri/webdoc/support/writeUtils":function(){define("exports ../../core/Error ../../core/lang ../../core/object ../../core/accessorSupport/extensions/serializableProperty/writer ../../layers/support/layerUtils".split(" "),function(g,q,x,w,C,r){function m(e,l){"maxScale"in e&&(l.maxScale=C.numberToJSON(e.maxScale)??
void 0);"minScale"in e&&(l.minScale=C.numberToJSON(e.minScale)??void 0)}const k=new Set("bing-maps imagery imagery-tile map-image open-street-map tile unknown unsupported vector-tile web-tile wms wmts".split(" ")),f=new Set("csv feature geo-rss geojson group imagery imagery-tile kml map-image map-notes media ogc-feature oriented-imagery route stream subtype-group tile unknown unsupported vector-tile web-tile wfs wms wmts".split(" "));g.disableRestrictedWriting=function(e){k.add(e);f.add(e)};g.enableRestrictedWriting=
function(e){k.delete(e);f.delete(e)};g.getLayerJSON=function(e,l,b){if(!e.persistenceEnabled)return null;if(!("write"in e&&e.write))return b?.messages&&b.messages.push(new q("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(r.isFeatureCollectionLayer(e)&&!e.isTable)l=e.resourceInfo;else{if(b.restrictedWebMapWriting){var p="basemap"===b.layerContainerType?k:"operational-layers"===b.layerContainerType?f:null;p=null!=p?p.has(e.type)&&
!r.isFeatureCollectionLayer(e):!0}else p=!0;if(p)return l={},e.write(l,b)?l:null}if(null!=l){l=x.clone(l);if(b=l)r.isFeatureCollectionLayer(e)?(p=w.getDeepValue("featureCollection.layers",b)?.[0]?.layerDefinition)&&m(e,p):"group"!==e.type&&m(e,b);if(b&&(b.id=e.id,"blendMode"in e&&(b.blendMode=e.blendMode,"normal"===b.blendMode&&delete b.blendMode),b.opacity=C.numberToJSON(e.opacity)??void 0,b.title=e.title||"Layer",b.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if(r.isFeatureCollectionLayer(e)){if(b=
b.featureCollection)b.showLegend=e.legendEnabled}else b.showLegend=e.legendEnabled}return l};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request"],function(g,q,x){function w(r){return"scene"===r?.type}function C(r){r=r?.type;return"imagery-tile"===r||"tile"===r||"open-street-map"===r||"vector-tile"===r||"web-tile"===r||"wmts"===r}g.getEffectiveEditingEnabled=function(r){a:if("editingEnabled"in r)switch(r.type){case "csv":case "feature":case "geojson":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":var m=
!0;break a;default:m=!1}else m=!1;return m?"effectiveEditingEnabled"in r?r.effectiveEditingEnabled:r.editingEnabled:!1};g.getEffectiveLayerCapabilities=function(r){a:if("capabilities"in r)switch(r.type){case "csv":case "feature":case "geojson":case "imagery":case "knowledge-graph-sublayer":case "ogc-feature":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":case "wfs":var m=!0;break a;default:m=!1}else m=!1;return m?"effectiveCapabilities"in r?r.effectiveCapabilities:
r.capabilities:null};g.getOwningPortalUrl=async function(r,m){var k=q.id?.findServerInfo(r);if(null!=k?.currentVersion)return k.owningSystemUrl||null;k=r.toLowerCase().indexOf("/rest/services");if(-1===k)return null;r=`${r.substring(0,k)}/rest/info`;({data:m}=await x(r,{query:{f:"json"},responseType:"json",signal:null!=m?m.signal:null}));return m?.owningSystemUrl||null};g.getTileMaxtrixSetFromActiveLayer=function(r){if(r.activeLayer){const m=r.activeLayer.tileMatrixSet;if(m)return m;if(r=r.activeLayer.tileMatrixSets)return r}return null};
g.isBaseLayer=function(r){return null!=r?.parent&&"declaredClass"in r.parent&&"esri.Basemap"===r.parent.declaredClass&&r.parent.baseLayers.includes(r)};g.isBasemap3DSupportedLayer=function(r){return C(r)||w(r)};g.isBasemapSupportedTiledLayer=C;g.isFeatureCollectionLayer=function(r){return"feature"===r?.type&&!r.url&&"memory"===r.source?.type};g.isFeatureLayer=function(r){return null!=r&&"object"===typeof r&&"type"in r&&"feature"===r.type};g.isFeatureServiceLayer=function(r){return"feature"===r?.type&&
"feature-layer"===r.source?.type};g.isGraphicsLayer=function(r){return null!=r&&"object"===typeof r&&"type"in r&&"graphics"===r.type};g.isGroupLayer=function(r){return null!=r&&"type"in r&&"group"===r.type};g.isImageryTileLayer=function(r){return"imagery-tile"===r?.type};g.isKnowledgeGraphLayer=function(r){return null!=r&&"object"===typeof r&&"type"in r&&"knowledge-graph"===r.type&&"layers"in r};g.isLayerWithFeatureLayerSource=function(r){return("feature"===r?.type||"subtype-group"===r?.type)&&"feature-layer"===
r.source?.type};g.isMapNotesLayer=function(r){return null!=r&&"object"===typeof r&&"type"in r&&"map-notes"===r.type&&"sublayers"in r};g.isSceneLayer=w;g.isSceneServiceLayer=function(r){r=r?.type;return"building-scene"===r||"integrated-mesh"===r||"point-cloud"===r||"scene"===r};g.isSubtypeGroupLayer=function(r){return null!=r&&"object"===typeof r&&"type"in r&&"subtype-group"===r.type&&"sublayers"in r};g.isTable=function(r){return null!=r&&"object"===typeof r&&"isTable"in r&&!!r.isTable};g.isTiledLayer=
function(r){r=r?.type;return"base-tile"===r||"tile"===r||"elevation"===r||"imagery-tile"===r||"base-elevation"===r||"open-street-map"===r||"wcs"===r||"web-tile"===r||"wmts"===r||"vector-tile"===r};g.isVoxelLayer=function(r){return"voxel"===r?.type};g.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};g.serializeLayerDefinitions=function(r){const m=/[:;]/,k=[];let f=!1;if(r&&(r.forEach((e,
l)=>{k.push([l,e]);!f&&m.test(e)&&(f=!0)}),0<k.length)){if(f){const e={};k.forEach(l=>{e[l[0]]=l[1]});r=JSON.stringify(e)}else{const e=[];k.forEach(l=>{e.push(l[0]+":"+l[1])});r=e.join(";")}return r}return null};g.serializeTimeOptions=function(r){if(r){var m=[];r.forEach((k,f)=>{m.push('"'+f+'":'+JSON.stringify(k))});if(m.length)return"{"+m.join(",")+"}"}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(g,
q){g.canInterpolateEffects=function(x,w){const C=x.length>w.length?x:w;return(x.length>w.length?w:x).every((r,m)=>r.type===C[m].type)};g.effectEquals=function(x,w){x=JSON.stringify(x??null);w=JSON.stringify(w??null);return x===w};g.isEffectFunctions=function(x){return(x=x[0])?"type"in x:!1};g.normalizeEffects=function(x,w){const C=x.length>w.length?x:w;x=x.length>w.length?w:x;for(w=x.length;w<C.length;w++)x.push(q.createEffectWithInitialValues(C[w]))};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../chunks/mat4f32","./colorMatrixFunctions"],function(g,q,x,w,C){function r(c,d,a){return c+(d-c)*a}function m(c){return Math.round(1E3*x.px2pt(c))/1E3}class k{constructor(c,d,a){this.strength=c;this.radius=d;this.threshold=a;this.type="bloom"}interpolate(c,d,a){this.strength=r(c.strength,d.strength,a);this.radius=r(c.radius,d.radius,a);this.threshold=r(c.threshold,d.threshold,a)}clone(){return new k(this.strength,
this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:m(this.radius),strength:this.strength,threshold:this.threshold}}}class f{constructor(c){this.radius=c;this.type="blur"}interpolate(c,d,a){this.radius=Math.round(r(c.radius,d.radius,a))}clone(){return new f(this.radius)}toJSON(){return{type:"blur",radius:m(this.radius)}}}class e{constructor(c,d){this.type=c;this.amount=d;if("invert"===this.type||"grayscale"===this.type||"sepia"===this.type)this.amount=Math.min(this.amount,1)}get colorMatrix(){this._colorMatrix||
this._updateMatrix();return this._colorMatrix}interpolate(c,d,a){this.amount=r(c.amount,d.amount,a);this._updateMatrix()}clone(){return new e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const c=this._colorMatrix||w.create();switch(this.type){case "brightness":this._colorMatrix=C.brightness(c,this.amount);break;case "contrast":this._colorMatrix=C.contrast(c,this.amount);break;case "grayscale":this._colorMatrix=C.grayscale(c,this.amount);break;case "invert":this._colorMatrix=
C.invert(c,this.amount);break;case "saturate":this._colorMatrix=C.saturate(c,this.amount);break;case "sepia":this._colorMatrix=C.sepia(c,this.amount)}}}class l{constructor(c,d,a,n){this.offsetX=c;this.offsetY=d;this.blurRadius=a;this.color=n;this.type="drop-shadow"}interpolate(c,d,a){this.offsetX=r(c.offsetX,d.offsetX,a);this.offsetY=r(c.offsetY,d.offsetY,a);this.blurRadius=r(c.blurRadius,d.blurRadius,a);this.color[0]=Math.round(r(c.color[0],d.color[0],a));this.color[1]=Math.round(r(c.color[1],d.color[1],
a));this.color[2]=Math.round(r(c.color[2],d.color[2],a));this.color[3]=r(c.color[3],d.color[3],a)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const c=[...this.color];c[3]*=255;return{type:"drop-shadow",xoffset:m(this.offsetX),yoffset:m(this.offsetY),blurRadius:m(this.blurRadius),color:c}}}class b{constructor(c){this.angle=c;this.type="hue-rotate"}get colorMatrix(){this._colorMatrix||this._updateMatrix();return this._colorMatrix}interpolate(c,d,a){this.angle=
r(c.angle,d.angle,a);this._updateMatrix()}clone(){return new b(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const c=this._colorMatrix||w.create();this._colorMatrix=C.rotateHue(c,this.angle)}}class p{constructor(c){this.amount=c;this.type="opacity";this.amount=Math.min(this.amount,1)}interpolate(c,d,a){this.amount=r(c.amount,d.amount,a)}clone(){return new p(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}g.BloomEffect=k;g.BlurEffect=f;g.ColorMatrixEffect=
e;g.DropShadowEffect=l;g.HueRotateEffect=b;g.OpacityEffect=p;g.createEffectWithInitialValues=function(c){switch(c.type){case "grayscale":case "sepia":case "invert":return new e(c.type,0);case "saturate":case "brightness":case "contrast":return new e(c.type,1);case "opacity":return new p(1);case "hue-rotate":return new b(0);case "blur":return new f(0);case "drop-shadow":return new l(0,0,0,[...q.getNamedColor("transparent")]);case "bloom":return new k(0,0,1)}};Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/mat4f32":function(){define(["exports"],function(g){function q(){const k=new Float32Array(16);k[0]=1;k[5]=1;k[10]=1;k[15]=1;return k}function x(k){const f=new Float32Array(16);f[0]=k[0];f[1]=k[1];f[2]=k[2];f[3]=k[3];f[4]=k[4];f[5]=k[5];f[6]=k[6];f[7]=k[7];f[8]=k[8];f[9]=k[9];f[10]=k[10];f[11]=k[11];f[12]=k[12];f[13]=k[13];f[14]=k[14];f[15]=k[15];return f}function w(k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E){const z=new Float32Array(16);z[0]=k;z[1]=f;z[2]=e;z[3]=l;z[4]=b;z[5]=
p;z[6]=c;z[7]=d;z[8]=a;z[9]=n;z[10]=t;z[11]=v;z[12]=y;z[13]=h;z[14]=A;z[15]=E;return z}function C(k,f){return new Float32Array(k,f,16)}const r=q(),m=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r,clone:x,create:q,createView:C,fromValues:w},Symbol.toStringTag,{value:"Module"}));g.IDENTITY=r;g.clone=x;g.create=q;g.createView=C;g.fromValues=w;g.mat4f32=m})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../chunks/mat4"],function(g,q){g.brightness=(x,w)=>{x=
q.set(x,w,0,0,0,0,w,0,0,0,0,w,0,0,0,0,1);return q.transpose(x,x)};g.contrast=(x,w)=>{x=q.set(x,w,0,0,.5-.5*w,0,w,0,.5-.5*w,0,0,w,.5-.5*w,0,0,0,1);return q.transpose(x,x)};g.grayscale=(x,w)=>{w=1-w;x=q.set(x,.2126+.7874*w,.7152-.7152*w,.0722-.0722*w,0,.2126-.2126*w,.7152+.2848*w,.0722-.0722*w,0,.2126-.2126*w,.7152-.7152*w,.0722+.9278*w,0,0,0,0,1);return q.transpose(x,x)};g.invert=(x,w)=>{const C=1-2*w;x=q.set(x,C,0,0,w,0,C,0,w,0,0,C,w,0,0,0,1);return q.transpose(x,x)};g.rotateHue=(x,w)=>{const C=Math.sin(w*
Math.PI/180);w=Math.cos(w*Math.PI/180);x=q.set(x,.213+.787*w-.213*C,.715-.715*w-.715*C,.072-.072*w+.928*C,0,.213-.213*w+.143*C,.715+.285*w+.14*C,.072-.072*w-.283*C,0,.213-.213*w-.787*C,.715-.715*w+.715*C,.072+.928*w+.072*C,0,0,0,0,1);return q.transpose(x,x)};g.saturate=(x,w)=>{x=q.set(x,.213+.787*w,.715-.715*w,.072-.072*w,0,.213-.213*w,.715+.285*w,.072-.072*w,0,.213-.213*w,.715-.715*w,.072+.928*w,0,0,0,0,1);return q.transpose(x,x)};g.sepia=(x,w)=>{w=1-w;x=q.set(x,.393+.607*w,.769-.769*w,.189-.189*
w,0,.349-.349*w,.686+.314*w,.168-.168*w,0,.272-.272*w,.534-.534*w,.131+.869*w,0,0,0,0,1);return q.transpose(x,x)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat4":function(){define(["exports","./vec3f64","./common"],function(g,q,x){function w(L,T){L[0]=T[0];L[1]=T[1];L[2]=T[2];L[3]=T[3];L[4]=T[4];L[5]=T[5];L[6]=T[6];L[7]=T[7];L[8]=T[8];L[9]=T[9];L[10]=T[10];L[11]=T[11];L[12]=T[12];L[13]=T[13];L[14]=T[14];L[15]=T[15];return L}function C(L,T,ia,ka,qa,S,V,X,ha,ja,ma,
oa,va,xa,za,Aa,Ba){L[0]=T;L[1]=ia;L[2]=ka;L[3]=qa;L[4]=S;L[5]=V;L[6]=X;L[7]=ha;L[8]=ja;L[9]=ma;L[10]=oa;L[11]=va;L[12]=xa;L[13]=za;L[14]=Aa;L[15]=Ba;return L}function r(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function m(L,T){if(L===T){const ia=T[1],ka=T[2],qa=T[3],S=T[6],V=T[7],X=T[11];L[1]=T[4];L[2]=T[8];L[3]=T[12];L[4]=ia;L[6]=T[9];L[7]=T[13];L[8]=ka;L[9]=S;L[11]=T[14];L[12]=qa;L[13]=V;L[14]=X}else L[0]=T[0],
L[1]=T[4],L[2]=T[8],L[3]=T[12],L[4]=T[1],L[5]=T[5],L[6]=T[9],L[7]=T[13],L[8]=T[2],L[9]=T[6],L[10]=T[10],L[11]=T[14],L[12]=T[3],L[13]=T[7],L[14]=T[11],L[15]=T[15];return L}function k(L,T){f(L,T)||r(L);return L}function f(L,T){const ia=T[0],ka=T[1],qa=T[2],S=T[3],V=T[4],X=T[5],ha=T[6],ja=T[7],ma=T[8],oa=T[9],va=T[10],xa=T[11],za=T[12],Aa=T[13],Ba=T[14];T=T[15];const Ia=ia*X-ka*V,Da=ia*ha-qa*V,Ga=ia*ja-S*V,Fa=ka*ha-qa*X,Ea=ka*ja-S*X,La=qa*ja-S*ha,Ua=ma*Aa-oa*za,$a=ma*Ba-va*za,Ta=ma*T-xa*za,Na=oa*Ba-
va*Aa,Pa=oa*T-xa*Aa,wa=va*T-xa*Ba;let Qa=Ia*wa-Da*Pa+Ga*Na+Fa*Ta-Ea*$a+La*Ua;if(!Qa)return null;Qa=1/Qa;L[0]=(X*wa-ha*Pa+ja*Na)*Qa;L[1]=(qa*Pa-ka*wa-S*Na)*Qa;L[2]=(Aa*La-Ba*Ea+T*Fa)*Qa;L[3]=(va*Ea-oa*La-xa*Fa)*Qa;L[4]=(ha*Ta-V*wa-ja*$a)*Qa;L[5]=(ia*wa-qa*Ta+S*$a)*Qa;L[6]=(Ba*Ga-za*La-T*Da)*Qa;L[7]=(ma*La-va*Ga+xa*Da)*Qa;L[8]=(V*Pa-X*Ta+ja*Ua)*Qa;L[9]=(ka*Ta-ia*Pa-S*Ua)*Qa;L[10]=(za*Ea-Aa*Ga+T*Ia)*Qa;L[11]=(oa*Ga-ma*Ea-xa*Ia)*Qa;L[12]=(X*$a-V*Na-ha*Ua)*Qa;L[13]=(ia*Na-ka*$a+qa*Ua)*Qa;L[14]=(Aa*Da-
za*Fa-Ba*Ia)*Qa;L[15]=(ma*Fa-oa*Da+va*Ia)*Qa;return L}function e(L,T){const ia=T[0],ka=T[1],qa=T[2],S=T[3],V=T[4],X=T[5],ha=T[6],ja=T[7],ma=T[8],oa=T[9],va=T[10],xa=T[11],za=T[12],Aa=T[13],Ba=T[14];T=T[15];L[0]=X*(va*T-xa*Ba)-oa*(ha*T-ja*Ba)+Aa*(ha*xa-ja*va);L[1]=-(ka*(va*T-xa*Ba)-oa*(qa*T-S*Ba)+Aa*(qa*xa-S*va));L[2]=ka*(ha*T-ja*Ba)-X*(qa*T-S*Ba)+Aa*(qa*ja-S*ha);L[3]=-(ka*(ha*xa-ja*va)-X*(qa*xa-S*va)+oa*(qa*ja-S*ha));L[4]=-(V*(va*T-xa*Ba)-ma*(ha*T-ja*Ba)+za*(ha*xa-ja*va));L[5]=ia*(va*T-xa*Ba)-ma*
(qa*T-S*Ba)+za*(qa*xa-S*va);L[6]=-(ia*(ha*T-ja*Ba)-V*(qa*T-S*Ba)+za*(qa*ja-S*ha));L[7]=ia*(ha*xa-ja*va)-V*(qa*xa-S*va)+ma*(qa*ja-S*ha);L[8]=V*(oa*T-xa*Aa)-ma*(X*T-ja*Aa)+za*(X*xa-ja*oa);L[9]=-(ia*(oa*T-xa*Aa)-ma*(ka*T-S*Aa)+za*(ka*xa-S*oa));L[10]=ia*(X*T-ja*Aa)-V*(ka*T-S*Aa)+za*(ka*ja-S*X);L[11]=-(ia*(X*xa-ja*oa)-V*(ka*xa-S*oa)+ma*(ka*ja-S*X));L[12]=-(V*(oa*Ba-va*Aa)-ma*(X*Ba-ha*Aa)+za*(X*va-ha*oa));L[13]=ia*(oa*Ba-va*Aa)-ma*(ka*Ba-qa*Aa)+za*(ka*va-qa*oa);L[14]=-(ia*(X*Ba-ha*Aa)-V*(ka*Ba-qa*Aa)+za*
(ka*ha-qa*X));L[15]=ia*(X*va-ha*oa)-V*(ka*va-qa*oa)+ma*(ka*ha-qa*X);return L}function l(L){const T=L[0],ia=L[1],ka=L[2],qa=L[3],S=L[4],V=L[5],X=L[6],ha=L[7],ja=L[8],ma=L[9],oa=L[10],va=L[11],xa=L[12],za=L[13],Aa=L[14];L=L[15];return(T*V-ia*S)*(oa*L-va*Aa)-(T*X-ka*S)*(ma*L-va*za)+(T*ha-qa*S)*(ma*Aa-oa*za)+(ia*X-ka*V)*(ja*L-va*xa)-(ia*ha-qa*V)*(ja*Aa-oa*xa)+(ka*ha-qa*X)*(ja*za-ma*xa)}function b(L,T,ia){const ka=T[0],qa=T[1],S=T[2],V=T[3],X=T[4],ha=T[5],ja=T[6],ma=T[7],oa=T[8],va=T[9],xa=T[10],za=T[11],
Aa=T[12],Ba=T[13],Ia=T[14];T=T[15];let Da=ia[0],Ga=ia[1],Fa=ia[2],Ea=ia[3];L[0]=Da*ka+Ga*X+Fa*oa+Ea*Aa;L[1]=Da*qa+Ga*ha+Fa*va+Ea*Ba;L[2]=Da*S+Ga*ja+Fa*xa+Ea*Ia;L[3]=Da*V+Ga*ma+Fa*za+Ea*T;Da=ia[4];Ga=ia[5];Fa=ia[6];Ea=ia[7];L[4]=Da*ka+Ga*X+Fa*oa+Ea*Aa;L[5]=Da*qa+Ga*ha+Fa*va+Ea*Ba;L[6]=Da*S+Ga*ja+Fa*xa+Ea*Ia;L[7]=Da*V+Ga*ma+Fa*za+Ea*T;Da=ia[8];Ga=ia[9];Fa=ia[10];Ea=ia[11];L[8]=Da*ka+Ga*X+Fa*oa+Ea*Aa;L[9]=Da*qa+Ga*ha+Fa*va+Ea*Ba;L[10]=Da*S+Ga*ja+Fa*xa+Ea*Ia;L[11]=Da*V+Ga*ma+Fa*za+Ea*T;Da=ia[12];Ga=ia[13];
Fa=ia[14];Ea=ia[15];L[12]=Da*ka+Ga*X+Fa*oa+Ea*Aa;L[13]=Da*qa+Ga*ha+Fa*va+Ea*Ba;L[14]=Da*S+Ga*ja+Fa*xa+Ea*Ia;L[15]=Da*V+Ga*ma+Fa*za+Ea*T;return L}function p(L,T,ia){const ka=ia[0],qa=ia[1];ia=ia[2];if(T===L)L[12]=T[0]*ka+T[4]*qa+T[8]*ia+T[12],L[13]=T[1]*ka+T[5]*qa+T[9]*ia+T[13],L[14]=T[2]*ka+T[6]*qa+T[10]*ia+T[14],L[15]=T[3]*ka+T[7]*qa+T[11]*ia+T[15];else{const S=T[0],V=T[1],X=T[2],ha=T[3],ja=T[4],ma=T[5],oa=T[6],va=T[7],xa=T[8],za=T[9],Aa=T[10],Ba=T[11];L[0]=S;L[1]=V;L[2]=X;L[3]=ha;L[4]=ja;L[5]=ma;
L[6]=oa;L[7]=va;L[8]=xa;L[9]=za;L[10]=Aa;L[11]=Ba;L[12]=S*ka+ja*qa+xa*ia+T[12];L[13]=V*ka+ma*qa+za*ia+T[13];L[14]=X*ka+oa*qa+Aa*ia+T[14];L[15]=ha*ka+va*qa+Ba*ia+T[15]}return L}function c(L,T,ia){const ka=ia[0],qa=ia[1];ia=ia[2];L[0]=T[0]*ka;L[1]=T[1]*ka;L[2]=T[2]*ka;L[3]=T[3]*ka;L[4]=T[4]*qa;L[5]=T[5]*qa;L[6]=T[6]*qa;L[7]=T[7]*qa;L[8]=T[8]*ia;L[9]=T[9]*ia;L[10]=T[10]*ia;L[11]=T[11]*ia;L[12]=T[12];L[13]=T[13];L[14]=T[14];L[15]=T[15];return L}function d(L,T,ia,ka){let qa=ka[0],S=ka[1];ka=ka[2];let V=
Math.sqrt(qa*qa+S*S+ka*ka);var X=void 0,ha=void 0;let ja=void 0,ma=void 0,oa=void 0,va=void 0,xa=void 0,za=void 0,Aa=void 0,Ba=void 0,Ia=void 0,Da=void 0,Ga=void 0,Fa=void 0,Ea=void 0,La=void 0,Ua=void 0,$a=void 0,Ta=void 0,Na=void 0,Pa=void 0,wa=void 0;ha=X=void 0;if(V<x.getEpsilon())return null;V=1/V;qa*=V;S*=V;ka*=V;X=Math.sin(ia);ha=Math.cos(ia);ja=1-ha;ma=T[0];oa=T[1];va=T[2];xa=T[3];za=T[4];Aa=T[5];Ba=T[6];Ia=T[7];Da=T[8];Ga=T[9];Fa=T[10];Ea=T[11];La=qa*qa*ja+ha;Ua=S*qa*ja+ka*X;$a=ka*qa*ja-
S*X;Ta=qa*S*ja-ka*X;Na=S*S*ja+ha;Pa=ka*S*ja+qa*X;wa=qa*ka*ja+S*X;X=S*ka*ja-qa*X;ha=ka*ka*ja+ha;L[0]=ma*La+za*Ua+Da*$a;L[1]=oa*La+Aa*Ua+Ga*$a;L[2]=va*La+Ba*Ua+Fa*$a;L[3]=xa*La+Ia*Ua+Ea*$a;L[4]=ma*Ta+za*Na+Da*Pa;L[5]=oa*Ta+Aa*Na+Ga*Pa;L[6]=va*Ta+Ba*Na+Fa*Pa;L[7]=xa*Ta+Ia*Na+Ea*Pa;L[8]=ma*wa+za*X+Da*ha;L[9]=oa*wa+Aa*X+Ga*ha;L[10]=va*wa+Ba*X+Fa*ha;L[11]=xa*wa+Ia*X+Ea*ha;T!==L&&(L[12]=T[12],L[13]=T[13],L[14]=T[14],L[15]=T[15]);return L}function a(L,T,ia){const ka=Math.sin(ia);ia=Math.cos(ia);const qa=
T[4],S=T[5],V=T[6],X=T[7],ha=T[8],ja=T[9],ma=T[10],oa=T[11];T!==L&&(L[0]=T[0],L[1]=T[1],L[2]=T[2],L[3]=T[3],L[12]=T[12],L[13]=T[13],L[14]=T[14],L[15]=T[15]);L[4]=qa*ia+ha*ka;L[5]=S*ia+ja*ka;L[6]=V*ia+ma*ka;L[7]=X*ia+oa*ka;L[8]=ha*ia-qa*ka;L[9]=ja*ia-S*ka;L[10]=ma*ia-V*ka;L[11]=oa*ia-X*ka;return L}function n(L,T,ia){const ka=Math.sin(ia);ia=Math.cos(ia);const qa=T[0],S=T[1],V=T[2],X=T[3],ha=T[8],ja=T[9],ma=T[10],oa=T[11];T!==L&&(L[4]=T[4],L[5]=T[5],L[6]=T[6],L[7]=T[7],L[12]=T[12],L[13]=T[13],L[14]=
T[14],L[15]=T[15]);L[0]=qa*ia-ha*ka;L[1]=S*ia-ja*ka;L[2]=V*ia-ma*ka;L[3]=X*ia-oa*ka;L[8]=qa*ka+ha*ia;L[9]=S*ka+ja*ia;L[10]=V*ka+ma*ia;L[11]=X*ka+oa*ia;return L}function t(L,T,ia){const ka=Math.sin(ia);ia=Math.cos(ia);const qa=T[0],S=T[1],V=T[2],X=T[3],ha=T[4],ja=T[5],ma=T[6],oa=T[7];T!==L&&(L[8]=T[8],L[9]=T[9],L[10]=T[10],L[11]=T[11],L[12]=T[12],L[13]=T[13],L[14]=T[14],L[15]=T[15]);L[0]=qa*ia+ha*ka;L[1]=S*ia+ja*ka;L[2]=V*ia+ma*ka;L[3]=X*ia+oa*ka;L[4]=ha*ia-qa*ka;L[5]=ja*ia-S*ka;L[6]=ma*ia-V*ka;L[7]=
oa*ia-X*ka;return L}function v(L,T){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=T[0];L[13]=T[1];L[14]=T[2];L[15]=1;return L}function y(L,T){L[0]=T[0];L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=T[1];L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=T[2];L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function h(L,T,ia){if(0===T)return r(L);let ka=ia[0],qa=ia[1];ia=ia[2];let S=Math.sqrt(ka*ka+qa*qa+ia*ia),V=void 0,X=void 0,ha=void 0;if(S<x.getEpsilon())return null;S=1/S;ka*=S;
qa*=S;ia*=S;V=Math.sin(T);X=Math.cos(T);ha=1-X;L[0]=ka*ka*ha+X;L[1]=qa*ka*ha+ia*V;L[2]=ia*ka*ha-qa*V;L[3]=0;L[4]=ka*qa*ha-ia*V;L[5]=qa*qa*ha+X;L[6]=ia*qa*ha+ka*V;L[7]=0;L[8]=ka*ia*ha+qa*V;L[9]=qa*ia*ha-ka*V;L[10]=ia*ia*ha+X;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function A(L,T){const ia=Math.sin(T);T=Math.cos(T);L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=T;L[6]=ia;L[7]=0;L[8]=0;L[9]=-ia;L[10]=T;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function E(L,T){const ia=Math.sin(T);T=Math.cos(T);
L[0]=T;L[1]=0;L[2]=-ia;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=ia;L[9]=0;L[10]=T;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function z(L,T){const ia=Math.sin(T);T=Math.cos(T);L[0]=T;L[1]=ia;L[2]=0;L[3]=0;L[4]=-ia;L[5]=T;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function F(L,T,ia){var ka=T[0],qa=T[1],S=T[2],V=T[3],X=ka+ka,ha=qa+qa;const ja=S+S;T=ka*X;const ma=ka*ha;ka*=ja;const oa=qa*ha;qa*=ja;S*=ja;X*=V;ha*=V;V*=ja;L[0]=1-(oa+S);L[1]=ma+V;L[2]=ka-ha;
L[3]=0;L[4]=ma-V;L[5]=1-(T+S);L[6]=qa+X;L[7]=0;L[8]=ka+ha;L[9]=qa-X;L[10]=1-(T+oa);L[11]=0;L[12]=ia[0];L[13]=ia[1];L[14]=ia[2];L[15]=1;return L}function D(L,T){const ia=ua,ka=-T[0],qa=-T[1],S=-T[2],V=T[3],X=T[4],ha=T[5],ja=T[6],ma=T[7],oa=ka*ka+qa*qa+S*S+V*V;0<oa?(ia[0]=2*(X*V+ma*ka+ha*S-ja*qa)/oa,ia[1]=2*(ha*V+ma*qa+ja*ka-X*S)/oa,ia[2]=2*(ja*V+ma*S+X*qa-ha*ka)/oa):(ia[0]=2*(X*V+ma*ka+ha*S-ja*qa),ia[1]=2*(ha*V+ma*qa+ja*ka-X*S),ia[2]=2*(ja*V+ma*S+X*qa-ha*ka));F(L,T,ia);return L}function B(L,T){L[0]=
T[12];L[1]=T[13];L[2]=T[14];return L}function u(L,T){const ia=T[0],ka=T[1],qa=T[2],S=T[4],V=T[5],X=T[6],ha=T[8],ja=T[9];T=T[10];L[0]=Math.sqrt(ia*ia+ka*ka+qa*qa);L[1]=Math.sqrt(S*S+V*V+X*X);L[2]=Math.sqrt(ha*ha+ja*ja+T*T);return L}function H(L,T){const ia=T[0]+T[5]+T[10];let ka=0;0<ia?(ka=2*Math.sqrt(ia+1),L[3]=.25*ka,L[0]=(T[6]-T[9])/ka,L[1]=(T[8]-T[2])/ka,L[2]=(T[1]-T[4])/ka):T[0]>T[5]&&T[0]>T[10]?(ka=2*Math.sqrt(1+T[0]-T[5]-T[10]),L[3]=(T[6]-T[9])/ka,L[0]=.25*ka,L[1]=(T[1]+T[4])/ka,L[2]=(T[8]+
T[2])/ka):T[5]>T[10]?(ka=2*Math.sqrt(1+T[5]-T[0]-T[10]),L[3]=(T[8]-T[2])/ka,L[0]=(T[1]+T[4])/ka,L[1]=.25*ka,L[2]=(T[6]+T[9])/ka):(ka=2*Math.sqrt(1+T[10]-T[0]-T[5]),L[3]=(T[1]-T[4])/ka,L[0]=(T[8]+T[2])/ka,L[1]=(T[6]+T[9])/ka,L[2]=.25*ka);return L}function G(L,T,ia,ka){var qa=T[0],S=T[1],V=T[2],X=T[3],ha=qa+qa,ja=S+S,ma=V+V;T=qa*ha;const oa=qa*ja;qa*=ma;const va=S*ja;S*=ma;V*=ma;ha*=X;ja*=X;X*=ma;ma=ka[0];const xa=ka[1];ka=ka[2];L[0]=(1-(va+V))*ma;L[1]=(oa+X)*ma;L[2]=(qa-ja)*ma;L[3]=0;L[4]=(oa-X)*xa;
L[5]=(1-(T+V))*xa;L[6]=(S+ha)*xa;L[7]=0;L[8]=(qa+ja)*ka;L[9]=(S-ha)*ka;L[10]=(1-(T+va))*ka;L[11]=0;L[12]=ia[0];L[13]=ia[1];L[14]=ia[2];L[15]=1;return L}function I(L,T,ia,ka,qa){var S=T[0],V=T[1],X=T[2],ha=T[3],ja=S+S,ma=V+V,oa=X+X;T=S*ja;var va=S*ma,xa=S*oa;S=V*ma;V*=oa;var za=X*oa;X=ha*ja;ma*=ha;const Aa=ha*oa;var Ba=ka[0],Ia=ka[1];oa=ka[2];ka=qa[0];ha=qa[1];qa=qa[2];ja=(1-(S+za))*Ba;const Da=(va+Aa)*Ba;Ba*=xa-ma;va=(va-Aa)*Ia;za=(1-(T+za))*Ia;Ia*=V+X;xa=(xa+ma)*oa;V=(V-X)*oa;T=(1-(T+S))*oa;L[0]=
ja;L[1]=Da;L[2]=Ba;L[3]=0;L[4]=va;L[5]=za;L[6]=Ia;L[7]=0;L[8]=xa;L[9]=V;L[10]=T;L[11]=0;L[12]=ia[0]+ka-(ja*ka+va*ha+xa*qa);L[13]=ia[1]+ha-(Da*ka+za*ha+V*qa);L[14]=ia[2]+qa-(Ba*ka+Ia*ha+T*qa);L[15]=1;return L}function J(L,T){var ia=T[0],ka=T[1],qa=T[2];T=T[3];var S=ia+ia,V=ka+ka;const X=qa+qa;ia*=S;const ha=ka*S;ka*=V;const ja=qa*S,ma=qa*V;qa*=X;S*=T;V*=T;T*=X;L[0]=1-ka-qa;L[1]=ha+T;L[2]=ja-V;L[3]=0;L[4]=ha-T;L[5]=1-ia-qa;L[6]=ma+S;L[7]=0;L[8]=ja+V;L[9]=ma-S;L[10]=1-ia-ka;L[11]=0;L[12]=0;L[13]=0;L[14]=
0;L[15]=1;return L}function M(L,T,ia,ka,qa,S,V){const X=1/(ia-T),ha=1/(qa-ka),ja=1/(S-V);L[0]=2*S*X;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=2*S*ha;L[6]=0;L[7]=0;L[8]=(ia+T)*X;L[9]=(qa+ka)*ha;L[10]=(V+S)*ja;L[11]=-1;L[12]=0;L[13]=0;L[14]=V*S*2*ja;L[15]=0;return L}function R(L,T,ia,ka,qa){T=1/Math.tan(T/2);let S=void 0;L[0]=T/ia;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=T;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[11]=-1;L[12]=0;L[13]=0;L[15]=0;null!=qa&&Infinity!==qa?(S=1/(ka-qa),L[10]=(qa+ka)*S,L[14]=2*qa*ka*S):(L[10]=-1,L[14]=
-2*ka);return L}function Y(L,T,ia,ka){const qa=Math.tan(T.upDegrees*Math.PI/180),S=Math.tan(T.downDegrees*Math.PI/180),V=Math.tan(T.leftDegrees*Math.PI/180);T=Math.tan(T.rightDegrees*Math.PI/180);const X=2/(V+T),ha=2/(qa+S);L[0]=X;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=ha;L[6]=0;L[7]=0;L[8]=-((V-T)*X*.5);L[9]=(qa-S)*ha*.5;L[10]=ka/(ia-ka);L[11]=-1;L[12]=0;L[13]=0;L[14]=ka*ia/(ia-ka);L[15]=0;return L}function fa(L,T,ia,ka,qa,S,V){const X=1/(T-ia),ha=1/(ka-qa),ja=1/(S-V);L[0]=-2*X;L[1]=0;L[2]=0;L[3]=0;L[4]=
0;L[5]=-2*ha;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=2*ja;L[11]=0;L[12]=(T+ia)*X;L[13]=(qa+ka)*ha;L[14]=(V+S)*ja;L[15]=1;return L}function O(L,T,ia,ka){const qa=T[0],S=T[1];T=T[2];let V=qa-ia[0],X=S-ia[1];ia=T-ia[2];var ha=x.getEpsilon();if(Math.abs(V)<ha&&Math.abs(X)<ha&&Math.abs(ia)<ha)r(L);else{var ja=1/Math.sqrt(V*V+X*X+ia*ia);V*=ja;X*=ja;ia*=ja;ja=ka[0];var ma=ka[1];ha=ka[2];ka=ma*ia-ha*X;ha=ha*V-ja*ia;ma=ja*X-ma*V;(ja=Math.sqrt(ka*ka+ha*ha+ma*ma))?(ja=1/ja,ka*=ja,ha*=ja,ma*=ja):ma=ha=ka=0;var oa=
X*ma-ia*ha,va=ia*ka-V*ma,xa=V*ha-X*ka;(ja=Math.sqrt(oa*oa+va*va+xa*xa))?(ja=1/ja,oa*=ja,va*=ja,xa*=ja):xa=va=oa=0;L[0]=ka;L[1]=oa;L[2]=V;L[3]=0;L[4]=ha;L[5]=va;L[6]=X;L[7]=0;L[8]=ma;L[9]=xa;L[10]=ia;L[11]=0;L[12]=-(ka*qa+ha*S+ma*T);L[13]=-(oa*qa+va*S+xa*T);L[14]=-(V*qa+X*S+ia*T);L[15]=1}}function Q(L,T,ia,ka){const qa=T[0],S=T[1];T=T[2];var V=ka[0];const X=ka[1];var ha=ka[2];ka=qa-ia[0];let ja=S-ia[1];ia=T-ia[2];let ma=ka*ka+ja*ja+ia*ia;0<ma&&(ma=1/Math.sqrt(ma),ka*=ma,ja*=ma,ia*=ma);let oa=X*ia-
ha*ja;ha=ha*ka-V*ia;V=V*ja-X*ka;ma=oa*oa+ha*ha+V*V;0<ma&&(ma=1/Math.sqrt(ma),oa*=ma,ha*=ma,V*=ma);L[0]=oa;L[1]=ha;L[2]=V;L[3]=0;L[4]=ja*V-ia*ha;L[5]=ia*oa-ka*V;L[6]=ka*ha-ja*oa;L[7]=0;L[8]=ka;L[9]=ja;L[10]=ia;L[11]=0;L[12]=qa;L[13]=S;L[14]=T;L[15]=1;return L}function Z(L){return"mat4("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+", "+L[9]+", "+L[10]+", "+L[11]+", "+L[12]+", "+L[13]+", "+L[14]+", "+L[15]+")"}function ba(L){return Math.sqrt(L[0]**2+L[1]**2+L[2]**
2+L[3]**2+L[4]**2+L[5]**2+L[6]**2+L[7]**2+L[8]**2+L[9]**2+L[10]**2+L[11]**2+L[12]**2+L[13]**2+L[14]**2+L[15]**2)}function da(L,T,ia){L[0]=T[0]+ia[0];L[1]=T[1]+ia[1];L[2]=T[2]+ia[2];L[3]=T[3]+ia[3];L[4]=T[4]+ia[4];L[5]=T[5]+ia[5];L[6]=T[6]+ia[6];L[7]=T[7]+ia[7];L[8]=T[8]+ia[8];L[9]=T[9]+ia[9];L[10]=T[10]+ia[10];L[11]=T[11]+ia[11];L[12]=T[12]+ia[12];L[13]=T[13]+ia[13];L[14]=T[14]+ia[14];L[15]=T[15]+ia[15];return L}function P(L,T,ia){L[0]=T[0]-ia[0];L[1]=T[1]-ia[1];L[2]=T[2]-ia[2];L[3]=T[3]-ia[3];L[4]=
T[4]-ia[4];L[5]=T[5]-ia[5];L[6]=T[6]-ia[6];L[7]=T[7]-ia[7];L[8]=T[8]-ia[8];L[9]=T[9]-ia[9];L[10]=T[10]-ia[10];L[11]=T[11]-ia[11];L[12]=T[12]-ia[12];L[13]=T[13]-ia[13];L[14]=T[14]-ia[14];L[15]=T[15]-ia[15];return L}function U(L,T,ia){L[0]=T[0]*ia;L[1]=T[1]*ia;L[2]=T[2]*ia;L[3]=T[3]*ia;L[4]=T[4]*ia;L[5]=T[5]*ia;L[6]=T[6]*ia;L[7]=T[7]*ia;L[8]=T[8]*ia;L[9]=T[9]*ia;L[10]=T[10]*ia;L[11]=T[11]*ia;L[12]=T[12]*ia;L[13]=T[13]*ia;L[14]=T[14]*ia;L[15]=T[15]*ia;return L}function ca(L,T,ia,ka){L[0]=T[0]+ia[0]*
ka;L[1]=T[1]+ia[1]*ka;L[2]=T[2]+ia[2]*ka;L[3]=T[3]+ia[3]*ka;L[4]=T[4]+ia[4]*ka;L[5]=T[5]+ia[5]*ka;L[6]=T[6]+ia[6]*ka;L[7]=T[7]+ia[7]*ka;L[8]=T[8]+ia[8]*ka;L[9]=T[9]+ia[9]*ka;L[10]=T[10]+ia[10]*ka;L[11]=T[11]+ia[11]*ka;L[12]=T[12]+ia[12]*ka;L[13]=T[13]+ia[13]*ka;L[14]=T[14]+ia[14]*ka;L[15]=T[15]+ia[15]*ka;return L}function la(L,T){return L[0]===T[0]&&L[1]===T[1]&&L[2]===T[2]&&L[3]===T[3]&&L[4]===T[4]&&L[5]===T[5]&&L[6]===T[6]&&L[7]===T[7]&&L[8]===T[8]&&L[9]===T[9]&&L[10]===T[10]&&L[11]===T[11]&&L[12]===
T[12]&&L[13]===T[13]&&L[14]===T[14]&&L[15]===T[15]}function pa(L,T){if(L===T)return!0;const ia=L[0],ka=L[1],qa=L[2],S=L[3],V=L[4],X=L[5],ha=L[6],ja=L[7],ma=L[8],oa=L[9],va=L[10],xa=L[11],za=L[12],Aa=L[13],Ba=L[14];L=L[15];const Ia=T[0],Da=T[1],Ga=T[2],Fa=T[3],Ea=T[4],La=T[5],Ua=T[6],$a=T[7],Ta=T[8],Na=T[9],Pa=T[10],wa=T[11],Qa=T[12],db=T[13],jb=T[14];T=T[15];const K=x.getEpsilon();return Math.abs(ia-Ia)<=K*Math.max(1,Math.abs(ia),Math.abs(Ia))&&Math.abs(ka-Da)<=K*Math.max(1,Math.abs(ka),Math.abs(Da))&&
Math.abs(qa-Ga)<=K*Math.max(1,Math.abs(qa),Math.abs(Ga))&&Math.abs(S-Fa)<=K*Math.max(1,Math.abs(S),Math.abs(Fa))&&Math.abs(V-Ea)<=K*Math.max(1,Math.abs(V),Math.abs(Ea))&&Math.abs(X-La)<=K*Math.max(1,Math.abs(X),Math.abs(La))&&Math.abs(ha-Ua)<=K*Math.max(1,Math.abs(ha),Math.abs(Ua))&&Math.abs(ja-$a)<=K*Math.max(1,Math.abs(ja),Math.abs($a))&&Math.abs(ma-Ta)<=K*Math.max(1,Math.abs(ma),Math.abs(Ta))&&Math.abs(oa-Na)<=K*Math.max(1,Math.abs(oa),Math.abs(Na))&&Math.abs(va-Pa)<=K*Math.max(1,Math.abs(va),
Math.abs(Pa))&&Math.abs(xa-wa)<=K*Math.max(1,Math.abs(xa),Math.abs(wa))&&Math.abs(za-Qa)<=K*Math.max(1,Math.abs(za),Math.abs(Qa))&&Math.abs(Aa-db)<=K*Math.max(1,Math.abs(Aa),Math.abs(db))&&Math.abs(Ba-jb)<=K*Math.max(1,Math.abs(Ba),Math.abs(jb))&&Math.abs(L-T)<=K*Math.max(1,Math.abs(L),Math.abs(T))}function na(L){const T=x.getEpsilon(),ia=L[0],ka=L[1],qa=L[2],S=L[4],V=L[5],X=L[6],ha=L[8],ja=L[9];L=L[10];return Math.abs(1-(ia*ia+S*S+ha*ha))<=T&&Math.abs(1-(ka*ka+V*V+ja*ja))<=T&&Math.abs(1-(qa*qa+X*
X+L*L))<=T}function ra(L){return 1===L[0]&&0===L[1]&&0===L[2]&&0===L[4]&&1===L[5]&&0===L[6]&&0===L[8]&&0===L[9]&&1===L[10]}const ua=q.create();q=Object.freeze(Object.defineProperty({__proto__:null,add:da,adjoint:e,copy:w,determinant:l,equals:pa,exactEquals:la,frob:ba,fromQuat:J,fromQuat2:D,fromRotation:h,fromRotationTranslation:F,fromRotationTranslationScale:G,fromRotationTranslationScaleOrigin:I,fromScaling:y,fromTranslation:v,fromXRotation:A,fromYRotation:E,fromZRotation:z,frustum:M,getRotation:H,
getScaling:u,getTranslation:B,hasIdentityRotation:ra,identity:r,invert:f,invertOrIdentity:k,isOrthoNormal:na,lookAt:O,mul:b,multiply:b,multiplyScalar:U,multiplyScalarAndAdd:ca,ortho:fa,perspective:R,perspectiveFromFieldOfView:Y,rotate:d,rotateX:a,rotateY:n,rotateZ:t,scale:c,set:C,str:Z,sub:P,subtract:P,targetTo:Q,translate:p,transpose:m},Symbol.toStringTag,{value:"Module"}));g.add=da;g.adjoint=e;g.copy=w;g.determinant=l;g.equals=pa;g.exactEquals=la;g.frob=ba;g.fromQuat=J;g.fromQuat2=D;g.fromRotation=
h;g.fromRotationTranslation=F;g.fromRotationTranslationScale=G;g.fromRotationTranslationScaleOrigin=I;g.fromScaling=y;g.fromTranslation=v;g.fromXRotation=A;g.fromYRotation=E;g.fromZRotation=z;g.frustum=M;g.getRotation=H;g.getScaling=u;g.getTranslation=B;g.hasIdentityRotation=ra;g.identity=r;g.invert=f;g.invertOrIdentity=k;g.isOrthoNormal=na;g.lookAt=O;g.mat4=q;g.mul=b;g.multiply=b;g.multiplyScalar=U;g.multiplyScalarAndAdd=ca;g.ortho=fa;g.perspective=R;g.perspectiveFromFieldOfView=Y;g.rotate=d;g.rotateX=
a;g.rotateY=n;g.rotateZ=t;g.scale=c;g.set=C;g.str=Z;g.sub=P;g.subtract=P;g.targetTo=Q;g.translate=p;g.transpose=m})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(g,q,x){function w(G){return null==G||"string"===typeof G&&!G?"\x3cNull\x3e":G}function C(G){const I=null!=G.minValue||null!=G.maxValue,J=!!G.sqlExpression&&G.supportsSQLExpression;return!(null!=G.normalizationField||null!=G.normalizationType)&&
!I&&!J}function r(G){const {values:I,useSampleStdDev:J,supportsNullCount:M}=G;var R=Number.POSITIVE_INFINITY;let Y=Number.NEGATIVE_INFINITY,fa=null,O=null;var Q=null;let Z=null,ba=0;const da=null==G.minValue?-Infinity:G.minValue,P=null==G.maxValue?Infinity:G.maxValue;for(const U of I)Number.isFinite(U)?U>=da&&U<=P&&(fa=null===fa?U:fa+U,R=Math.min(R,U),Y=Math.max(Y,U),ba++):"string"===typeof U&&ba++;if(ba&&null!=fa){O=fa/ba;Q=0;for(const U of I)Number.isFinite(U)&&U>=da&&U<=P&&(Q+=(U-O)**2);Z=J?1<
ba?Q/(ba-1):0:0<ba?Q/ba:0;Q=Math.sqrt(Z)}else Y=R=null;R={avg:O,count:ba,max:Y,min:R,stddev:Q,sum:fa,variance:Z};M&&(R.nullcount=I.length-ba);G.percentileParams&&(R.median=m(I,G.percentileParams));return R}function m(G,I){const {fieldType:J,value:M,orderBy:R,isDiscrete:Y}=I,fa=k(J,"desc"===R);G=[...G].filter(ba=>null!=ba).sort((ba,da)=>fa(ba,da));if(0===G.length)return null;if(0>=M)return G[0];if(1<=M)return G[G.length-1];var O=(G.length-1)*M,Q=Math.floor(O);I=Q+1;O%=1;Q=G[Q];const Z=G[I];return I>=
G.length||Y||"string"===typeof Q||"string"===typeof Z?Q:Q*(1-O)+Z*O}function k(G,I){if(G){if(v.has(G))return I?u:H;if(y.has(G))return f(I,!1);if("esriFieldTypeTimestampOffset"===G)return I?F:z;const Y=f(I,!0);if("esriFieldTypeString"===G)return Y;if("esriFieldTypeGUID"===G||"esriFieldTypeGlobalID"===G)return(fa,O)=>Y(e(fa),e(O))}const J=I?1:-1,M=I?u:H,R=f(I,!0);return(Y,fa)=>"number"===typeof Y&&"number"===typeof fa?M(Y,fa):"string"===typeof Y&&"string"===typeof fa?R(Y,fa):J}function f(G,I){if(!I)return G?
B:D;const J=G?A:E;return G?(M,R)=>{const Y=J(M,R);if(null!=Y)return Y;M=M.toUpperCase();R=R.toUpperCase();return M>R?-1:M<R?1:0}:(M,R)=>{const Y=J(M,R);if(null!=Y)return Y;M=M.toUpperCase();R=R.toUpperCase();return M<R?-1:M>R?1:0}}function e(G){return G.substr(24,12)+G.substr(19,4)+G.substr(16,2)+G.substr(14,2)+G.substr(11,2)+G.substr(9,2)+G.substr(6,2)+G.substr(4,2)+G.substr(2,2)+G.substr(0,2)}function l(G){return"coded-value"!==G?.type?[]:G.codedValues.map(I=>I.code)}function b(G,I){const J=c({field:I.field,
normalizationType:I.normalizationType,normalizationField:I.normalizationField,classificationMethod:I.classificationMethod,standardDeviationInterval:I.standardDeviationInterval,breakCount:I.numClasses||5});G=p(G,I.minValue,I.maxValue);return x.createGenerateRendererClassBreaks({definition:J,values:G,normalizationTotal:I.normalizationTotal})}function p(G,I,J){const M=null==I?-Infinity:I,R=null==J?Infinity:J;return G.filter(Y=>Number.isFinite(Y)&&Y>=M&&Y<=R)}function c(G){const {breakCount:I,field:J,
normalizationField:M,normalizationType:R}=G,Y=G.classificationMethod||"equal-interval";return new q({breakCount:I,classificationField:J,classificationMethod:Y,normalizationField:"field"===R?M:void 0,normalizationType:R,standardDeviationInterval:"standard-deviation"===Y?G.standardDeviationInterval||1:void 0})}function d(G,I){const {field:J,classificationMethod:M,standardDeviationInterval:R,normalizationType:Y,normalizationField:fa,normalizationTotal:O,minValue:Q,maxValue:Z}=I,ba=I.numBins||10;let da=
I=null,P=null;M&&"equal-interval"!==M||Y?({classBreaks:G}=b(G,{field:J,normalizationType:Y,normalizationField:fa,normalizationTotal:O,classificationMethod:M,standardDeviationInterval:R,minValue:Q,maxValue:Z,numClasses:ba}),I=G[0].minValue,da=G[G.length-1].maxValue,P=G.map(U=>[U.minValue,U.maxValue])):(null!=Q&&null!=Z?(I=Q,da=Z):(G=r({values:G,minValue:Q,maxValue:Z,useSampleStdDev:!Y,supportsNullCount:C({normalizationType:Y,normalizationField:fa,minValue:Q,maxValue:Z})}),I=G.min??null,da=G.max??null),
P=n(I??0,da??0,ba));return{min:I,max:da,intervals:P}}function a(G,I){let J=-1;for(let M=G.length-1;0<=M;M--)if(I>=G[M][0]){J=M;break}return J}function n(G,I,J){const M=(I-G)/J,R=[];let Y;for(let fa=1;fa<=J;fa++)Y=G+M,Y=Number(Y.toFixed(16)),R.push([G,fa===J?I:Y]),G=Y;return R}const t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,v=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
y=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),h="min max avg stddev count sum variance nullcount median".split(" "),A=(G,I)=>null==G?null==I?0:1:null==I?-1:null,E=(G,I)=>null==G?null==I?0:-1:null==I?1:null,z=(G,I)=>E(G,I)??(G===I?0:(new Date(G)).getTime()-(new Date(I)).getTime()),F=(G,I)=>A(G,I)??(G===I?0:(new Date(I)).getTime()-(new Date(G)).getTime()),D=(G,I)=>E(G,I)??(G===I?0:G<I?-1:1),B=(G,I)=>A(G,I)??(G===I?0:G<I?1:-1),u=(G,I)=>A(G,I)??I-G,H=(G,I)=>E(G,I)??G-I;g.calculateClassBreaks=
b;g.calculateHistogram=function(G,I){var J=d(G,I);if(null==J.min&&null==J.max)return{bins:[],minValue:J.min,maxValue:J.max,normalizationTotal:I.normalizationTotal};const M=J.intervals,R=J.min??0;J=J.max??0;const Y=M.map((fa,O)=>({minValue:M[O][0],maxValue:M[O][1],count:0}));for(const fa of G)null!=fa&&fa>=R&&fa<=J&&(G=a(M,fa),-1<G&&Y[G].count++);return{bins:Y,minValue:R,maxValue:J,normalizationTotal:I.normalizationTotal}};g.calculatePercentile=m;g.calculateStatistics=r;g.calculateStringStatistics=
function(G){const I=G.returnDistinct?[...(new Set(G.values))]:G.values;var J=I.filter(R=>null!=R).sort();const M=J.length;J={count:M,min:J[0],max:J[M-1]};G.supportsNullCount&&(J.nullcount=I.length-M);G.percentileParams&&(J.median=m(I,G.percentileParams));return J};g.calculateUniqueValuesCount=function(G){const I={};for(let J of G){if(null==J||"string"===typeof J&&""===J.trim())J=null;null==I[J]?I[J]={count:1,data:J}:I[J].count++}return{count:I}};g.createClassBreaksDefinition=c;g.createUVResult=function(G,
I,J,M){G=G.count;const R=[];if(J&&I){J=[];var Y=l(I[0]);for(const fa of Y)if(I[1]){Y=l(I[1]);for(const O of Y)if(I[2]){Y=l(I[2]);for(const Q of Y)J.push(`${w(fa)}${M}${w(O)}${M}${w(Q)}`)}else J.push(`${w(fa)}${M}${w(O)}`)}else J.push(fa);for(const fa of J)G.hasOwnProperty(fa)||(G[fa]={data:fa,count:0})}for(const fa in G)I=G[fa],R.push({value:I.data,count:I.count,label:I.label});return{uniqueValueInfos:R}};g.getAttributeComparator=k;g.getEqualIntervalBins=n;g.getNormalizedValue=function(G,I,J,M){let R=
null;switch(I){case "log":0!==G&&(R=Math.log(G)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(M)&&0!==M&&(R=G/M*100);break;case "field":Number.isFinite(J)&&0!==J&&(R=G/J);break;case "natural-log":0<G&&(R=Math.log(G));break;case "square-root":0<G&&(R=G**.5)}return R};g.isNullCountSupported=C;g.processNullValue=w;g.processSummaryStatisticsResult=function(G,I){let J;for(J in G)h.includes(J)&&(Number.isFinite(G[J])||(G[J]=null));if(!I)return G;["avg","stddev","variance"].forEach(M=>{null!=
G[M]&&(G[M]=Math.ceil(G[M]??0))});return G};g.resolveCBResult=function(G,I){let J=G.classBreaks;const M=J[0]?.minValue,R=J[J.length-1]?.maxValue,Y="standard-deviation"===I;J=J.map(fa=>{const O=fa.label;fa={minValue:fa.minValue,maxValue:fa.maxValue,label:O};if(Y&&O){const Q=O.match(t)?.map(Z=>+Z.trim())??[];2===Q.length?(fa.minStdDev=Q[0],fa.maxStdDev=Q[1],0>Q[0]&&0<Q[1]&&(fa.hasAvg=!0)):1===Q.length&&(O.includes("\x3c")?(fa.minStdDev=null,fa.maxStdDev=Q[0]):O.includes("\x3e")&&(fa.minStdDev=Q[0],
fa.maxStdDev=null))}return fa});return{minValue:M,maxValue:R,classBreakInfos:J,normalizationTotal:G.normalizationTotal}};g.statisticTypes=h;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k,f){C=new q.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});q=new q.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});x=class extends x.JSONSupport{constructor(e){super(e);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};g.__decorate([k.enumeration({classBreaksDef:"class-breaks-definition"})],x.prototype,"type",void 0);g.__decorate([w.property({json:{write:!0}})],x.prototype,
"breakCount",void 0);g.__decorate([w.property({json:{write:!0}})],x.prototype,"classificationField",void 0);g.__decorate([w.property({type:String,json:{read:C.read,write:C.write}})],x.prototype,"classificationMethod",void 0);g.__decorate([w.property({json:{write:!0}})],x.prototype,"normalizationField",void 0);g.__decorate([w.property({json:{read:q.read,write:q.write}})],x.prototype,"normalizationType",void 0);g.__decorate([w.property({value:null,json:{write:!0}})],x.prototype,"standardDeviationInterval",
null);g.__decorate([w.property({value:null,json:{write:!0}})],x.prototype,"definedInterval",null);return x=g.__decorate([f.subclass("esri.rest.support.ClassBreaksDefinition")],x)})},"esri/core/accessorSupport/decorators/enumeration":function(){define(["exports","../../jsonMap","./property"],function(g,q,x){g.enumeration=function(w,C={}){w=w instanceof q.JSONMap?w:new q.JSONMap(w,C);w={type:C?.ignoreUnknown??!0?w.apiValues:String,json:{type:w.jsonValues,read:C?.readOnly?!1:{reader:w.read},write:{writer:w.write}}};
void 0!==C?.readOnly&&(w.readOnly=!!C.readOnly);void 0!==C?.default&&(w.json.default=C.default);void 0!==C?.name&&(w.json.name=C.name);void 0!==C?.nonNullable&&(w.nonNullable=C.nonNullable);return x.property(w)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(g,q){function x(p){var c=p.definition;const {classificationMethod:d,normalizationType:a,definedInterval:n}=c;c=c.breakCount??
1;const t=[];var v=p.values;if(0===v.length)return[];v=v.sort((F,D)=>F-D);var y=v[0],h=v[v.length-1];if("equal-interval"===d)if(v.length>=c){v=(h-y)/c;p=y;for(var A=1;A<c;A++){var E=Number((y+A*v).toFixed(6));t.push({minValue:p,maxValue:E,label:w(p,E,a)});p=E}t.push({minValue:p,maxValue:h,label:w(p,h,a)})}else v.forEach(F=>{t.push({minValue:F,maxValue:F,label:w(F,F,a)})});else if("natural-breaks"===d){v=C(v);p=r(v.uniqueValues,p.valueFrequency||v.valueFrequency,c);for(A=1;A<c;A++)v.uniqueValues.length>
A&&(E=Number(v.uniqueValues[p[A]].toFixed(6)),t.push({minValue:y,maxValue:E,label:w(y,E,a)}),y=E);t.push({minValue:y,maxValue:h,label:w(y,h,a)})}else if("quantile"===d)if(v.length>=c&&y!==h){p=Math.ceil(v.length/c);A=0;for(E=1;E<c;E++){var z=p+A-1;z>v.length&&(z=v.length-1);0>z&&(z=0);t.push({minValue:y,maxValue:v[z],label:w(y,v[z],a)});y=v[z];A+=p;p=Math.ceil((v.length-A)/(c-E))}t.push({minValue:y,maxValue:h,label:w(y,h,a)})}else for(c=-1,h=0;h<v.length;h++)y=v[h],y!==c&&(c=y,t.push({minValue:c,
maxValue:y,label:w(c,y,a)}),c=y);else if("standard-deviation"===d)if(p=f(v),A=e(v,p),0===A)t.push({minValue:v[0],maxValue:v[0],label:w(v[0],v[0],a)});else{v=k(y,h,c,p,A)*A;A=0;for(E=c;1<=E;E--)z=Number((p-(E-.5)*v).toFixed(6)),t.push({minValue:y,maxValue:z,label:w(y,z,a)}),y=z,A++;E=Number((p+.5*v).toFixed(6));t.push({minValue:y,maxValue:E,label:w(y,E,a)});y=E;A++;for(z=1;z<=c;z++)E=A===2*c?h:Number((p+(z+.5)*v).toFixed(6)),t.push({minValue:y,maxValue:E,label:w(y,E,a)}),y=E,A++}else if("defined-interval"===
d){if(!n)return t;c=v[0];h=v[v.length-1];v=Math.ceil((h-c)/n);y=c;for(p=1;p<v;p++)A=Number((c+p*n).toFixed(6)),t.push({minValue:y,maxValue:A,label:w(y,A,a)}),y=A;t.push({minValue:y,maxValue:h,label:w(y,h,a)})}return t}function w(p,c,d){let a=null;return a=p===c?d&&"percent-of-total"===d?p+"%":p.toString():d&&"percent-of-total"===d?p+"% - "+c+"%":p+" - "+c}function C(p){const c=[],d=[];let a=Number.MIN_VALUE,n=1,t=-1;for(let v=0;v<p.length;v++){const y=p[v];y===a?(n++,d[t]=n):null!==y&&(c.push(y),
a=y,n=1,d.push(n),t++)}return{uniqueValues:c,valueFrequency:d}}function r(p,c,d){var a=p.length;const n=[];d>a&&(d=a);for(var t=0;t<d;t++)n.push(Math.round(t*a/d-1));n.push(a-1);t=m(n,p,c,d);a=t.mean;t=t.sdcm;var v=d,y=0,h=0;let A=0,E=0,z=!0;for(let D=0;2>D&&z;D++){0===D&&(z=!1);for(var F=0;F<v-1;F++)for(;n[F+1]+1!==n[F+2];)if(n[F+1]+=1,y=l(F,n,p,c),A=y.sbMean,y=y.sbSdcm,h=l(F+1,n,p,c),E=h.sbMean,h=h.sbSdcm,y+h<t[F]+t[F+1])t[F]=y,t[F+1]=h,a[F]=A,a[F+1]=E,z=!0;else{--n[F+1];break}for(F=v-1;0<F;F--)for(;n[F]!==
n[F-1]+1;)if(--n[F],y=l(F-1,n,p,c),A=y.sbMean,y=y.sbSdcm,h=l(F,n,p,c),E=h.sbMean,h=h.sbSdcm,y+h<t[F-1]+t[F])t[F-1]=y,t[F]=h,a[F-1]=A,a[F]=E,z=!0;else{n[F]+=1;break}}z&&(t=m(n,p,c,d));return n}function m(p,c,d,a){let n=[];var t=[],v=[];let y=0;const h=[],A=[];for(var E=0;E<a;E++){var z=l(E,p,c,d);h.push(z.sbMean);A.push(z.sbSdcm);y+=A[E]}z=y;for(E=!0;E||y<z;){E=!1;n=[];for(t=0;t<a;t++)n.push(p[t]);for(v=0;v<a;v++)for(z=p[v]+1;z<=p[v+1];z++)if(t=c[z],0<v&&z!==p[v+1]&&Math.abs(t-h[v])>Math.abs(t-h[v-
1]))p[v]=z;else if(v<a-1&&p[v]!==z-1&&Math.abs(t-h[v])>Math.abs(t-h[v+1])){p[v+1]=z-1;break}z=y;y=0;t=[];v=[];for(let F=0;F<a;F++){t.push(h[F]);v.push(A[F]);const D=l(F,p,c,d);h[F]=D.sbMean;A[F]=D.sbSdcm;y+=A[F]}}if(y>z){for(c=0;c<a;c++)p[c]=n[c],h[c]=t[c],A[c]=v[c];y=z}return{mean:h,sdcm:A}}function k(p,c,d,a,n){p=Math.max(a-p,c-a)/n/d;return 1<=p?1:.5<=p?.5:.25}function f(p){let c=0;for(let d=0;d<p.length;d++)c+=p[d];return c/=p.length}function e(p,c){let d=0;for(let a=0;a<p.length;a++){const n=
p[a];d+=(n-c)*(n-c)}d/=p.length;return Math.sqrt(d)}function l(p,c,d,a){var n=0,t=0;for(var v=c[p]+1;v<=c[p+1];v++){const y=a[v];n+=d[v]*y;t+=y}0>=t&&b.warn("Exception in Natural Breaks calculation");n/=t;t=0;for(v=c[p]+1;v<=c[p+1];v++)t+=a[v]*(d[v]-n)**2;return{sbMean:n,sbSdcm:t}}const b=q.getLogger("esri.rest.support.generateRendererUtils");g.createGenerateRendererClassBreaks=function(p){const {normalizationTotal:c}=p;return{classBreaks:x(p),normalizationTotal:c}};g.createGenerateRendererUniqueValues=
function(p){p=C(p);const c=[],d=p.uniqueValues.length;for(let a=0;a<d;a++){const n=p.uniqueValues[a];c.push({value:n,count:p.valueFrequency[a],label:n.toString()})}return{uniqueValues:c}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(g){g.makeEdgeCandidate=function(q,x,w,C,r,m=!1){return{objectId:q,target:x,distance:w,type:"edge",start:C,end:r,draped:m}};g.makeVertexCandidate=function(q,x,w){return{objectId:q,
target:x,distance:w,type:"vertex"}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),function(g,q,x,w,C,r,m,k,f,e){async function l(n,t,v){if(!n)return null;
var {where:y}=n;n.where=y=y?.trim();if(!y||/^1 *= *1$/.test(y)||t&&t===y)n.where=null;if(!n.geometry)return n;t=await p(n);n.distance=0;n.units=null;"esriSpatialRelEnvelopeIntersects"===n.spatialRel&&({spatialReference:y}=n.geometry,t=r.getGeometryExtent(t),t.spatialReference=y);if(t){await e.checkProjectionSupport(t.spatialReference,v);y=t.spatialReference;t=b(t,v)&&m.isExtent(t)?{spatialReference:y,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t;y=(await k.normalizeCentralMeridian(m.fromJSON(t)))[0];
if(null==y)throw a;const h="quantizationParameters"in n&&n.quantizationParameters?.tolerance||"maxAllowableOffset"in n&&n.maxAllowableOffset||0;t=h&&b(t,v)?{densificationStep:8*h}:void 0;y=y.toJSON();t=e.project(y,y.spatialReference,v,t);if(!t)throw a;t.spatialReference=v;n.geometry=t}return n}function b(n,t){if(!n)return!1;const v=n.spatialReference;return(m.isExtent(n)||m.isPolygon(n)||m.isPolyline(n))&&!f.equals(v,t)&&!C.canProjectWithoutEngine(v,t)}async function p(n){const {distance:t,units:v}=
n,y=n.geometry;if(null==t||"vertexAttributes"in y)return y;var h=y.spatialReference;n=v?d.fromJSON(v):w.getUnitString(h);h=h&&(f.isGeographic(h)||f.isWebMercator(h))?y:await e.checkProjectionSupport(h,f.WGS84).then(()=>e.project(y,f.WGS84));return(await c())(h.spatialReference,h,t,n)}async function c(){return(await new Promise((n,t)=>g(["../../../geometry/geometryEngineJSON"],n,t))).geodesicBuffer}const d=new x.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",
esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),a=Object.freeze({});q.normalizeQuery=async function(n,t,v){const {outFields:y,orderByFields:h,groupByFieldsForStatistics:A,outStatistics:E}=n;if(y)for(var z=0;z<y.length;z++)y[z]=y[z].trim();if(h)for(z=0;z<h.length;z++)h[z]=h[z].trim();if(A)for(z=0;z<A.length;z++)A[z]=A[z].trim();if(E)for(z=0;z<E.length;z++)E[z].onStatisticField&&(E[z].onStatisticField=E[z].onStatisticField.trim());
n.geometry&&!n.outSR&&(n.outSR=n.geometry.spatialReference);return l(n,t,v)};q.normalizeQueryLike=l;q.queryEngineEmptyResult=a;q.unitsKebabDict=d;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),function(g,q,x,w,C,r){function m(b,p,c){const {outFields:d,orderByFields:a,returnDistinctValues:n,
outStatistics:t}=c,v=t?t.map(y=>y.outStatisticFieldName&&y.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(a&&0<a.length){const y=a.map(h=>{const A=h.toLowerCase();return A.includes(" asc")?A.split(" asc")[0]:A.includes(" desc")?A.split(" desc")[0]:h}).filter(h=>!v.includes(h));x.validateFields(b,p,y,{expressionName:"orderByFields",query:c})}if(d&&0<d.length)x.validateFields(b,p,d,{expressionName:"outFields",query:c});else if(n)throw new q("unsupported-query","outFields should be specified for returnDistinctValues",
{query:c});x.validateWhere(b,p,c.where,c)}function k(b,p,c){const {outStatistics:d,groupByFieldsForStatistics:a,having:n}=c;var t=a?.length,v=d?.length;if(n){if(!t||!v)throw new q("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:c});x.validateHaving(b,p,n,d,c)}if(v&&e(d)){v=d.map(y=>y.onStatisticField).filter(Boolean);x.validateFields(b,p,v,{expressionName:"onStatisticFields",query:c});t&&x.validateFields(b,p,a,{expressionName:"groupByFieldsForStatistics",
query:c});for(const y of d){const {onStatisticField:h,statisticType:A}=y;if(("percentile_disc"===A||"percentile_cont"===A)&&"statisticParameters"in y){if({statisticParameters:t}=y,!t)throw new q("unsupported-query","statisticParameters should be set for percentile type",{definition:y,query:c});}else b.get(h)&&"count"!==A&&"min"!==A&&"max"!==A&&x.validateFields(b,p,[h],{expressionName:`outStatistics with '${A}' statistic type`,allowedFieldTypes:l,query:c})}}}async function f(b,p,c,d){var a=[];c.valueExpression&&
({arcadeUtils:a}=await r.loadArcade(),a=a.extractFieldNames(c.valueExpression));c.field&&a.push(c.field);c.field2&&a.push(c.field2);c.field3&&a.push(c.field3);c.normalizationField&&a.push(c.normalizationField);if(!a.length&&!c.valueExpression)throw new q("unsupported-query","field or valueExpression is required",{params:c});x.validateFields(b,p,a,{expressionName:"statistics",query:d})}function e(b){return null!=b&&b.every(p=>"exceedslimit"!==p.statisticType)}const l=new Set([...x.numericFieldTypes,
...x.allDateAndTimeFieldTypes]);g.validateQuery=async function(b,{fieldsIndex:p,geometryType:c,spatialReference:d,availableFields:a}){if(0>(b.distance??0)||null!=b.geometryPrecision||b.multipatchOption&&"xyFootprint"!==b.multipatchOption||b.pixelSize||b.relationParam||b.text)throw new q("unsupported-query","Unsupported query options",{query:b});m(p,a,b);k(p,a,b);return Promise.all([C.checkSpatialQuerySupport(b,c,d),w.checkProjectionSupport(d,b.outSR)]).then(()=>b)};g.validateStatisticsQuery=async function(b,
p,{fieldsIndex:c,geometryType:d,spatialReference:a,availableFields:n}){if(0>(b.distance??0)||null!=b.geometryPrecision||b.multipatchOption||b.pixelSize||b.relationParam||b.text||b.outStatistics||b.groupByFieldsForStatistics||b.having||b.orderByFields)throw new q("unsupported-query","Unsupported query options",{query:b});m(c,n,b);return Promise.all([f(c,n,p,b),C.checkSpatialQuerySupport(b,d,a),w.checkProjectionSupport(a,b.outSR)]).then(()=>b)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(g,q,x,w,C,r,m,k,f,e,l,b){function p(){return new Promise((t,v)=>g(["../../../geometry/geometryEngineJSON"],t,v))}const c={esriSpatialRelIntersects:"intersects",
esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var d={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,
esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},a={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},n={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};q.canQueryWithRBush=function(t){if(r.isExtent(t))return!0;if(r.isPolygon(t)){for(const v of t.rings)if(5!==v.length||v[0][0]!==v[1][0]||v[0][0]!==v[4][0]||v[2][0]!==v[3][0]||v[0][1]!==v[3][1]||v[0][1]!==
v[4][1]||v[1][1]!==v[2][1])return!1;return!0}return!1};q.checkSpatialQuerySupport=async function(t,v,y){const {spatialRel:h,geometry:A}=t;if(A){if(null==h||!0!==d[h])throw new x("unsupported-query","Unsupported query spatial relationship",{query:t});if(m.isValid(A.spatialReference)&&m.isValid(y)){if(null==A||!0!==a[r.getJsonType(A)])throw new x("unsupported-query","Unsupported query geometry type",{query:t});if(null==v||!0!==n[v])throw new x("unsupported-query","Unsupported layer geometry type",{query:t});
if(t.outSR)return b.checkProjectionSupport(t.geometry?.spatialReference,t.outSR)}}};q.getSpatialQueryOperator=function(t,v,y,h,A){if(r.isPolygon(v)&&"esriGeometryPoint"===y&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const E=f.convertFromPolygon(new e,v,!1,!1);return Promise.resolve(z=>k.polygonContainsPoint(E,!1,!1,z))}if(r.isPolygon(v)&&"esriGeometryMultipoint"===y){const E=f.convertFromPolygon(new e,v,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve(z=>k.polygonContainsMultipoint(E,
!1,!1,z,h,A))}if(r.isExtent(v)&&"esriGeometryPoint"===y&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve(E=>w.extentContainsPoint(v,l.getGeometry(y,h,A,E)));if(r.isExtent(v)&&"esriGeometryMultipoint"===y&&"esriSpatialRelContains"===t)return Promise.resolve(E=>w.extentContainsMultipoint(v,l.getGeometry(y,h,A,E)));if(r.isExtent(v)&&"esriSpatialRelIntersects"===t){const E=C.getExtentIntersector(y);return Promise.resolve(z=>E(v,l.getGeometry(y,h,A,z)))}return p().then(E=>
{const z=E[c[t]].bind(null,v.spatialReference,v);return F=>z(l.getGeometry(y,h,A,F))})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(g,q){g.extentIntersectsExtent=q.extentIntersectsExtent;g.extentIntersectsMultipoint=q.extentIntersectsMultipoint;g.extentIntersectsPoint=q.extentIntersectsPoint;g.extentIntersectsPolygon=q.extentIntersectsPolygon;g.extentIntersectsPolyline=q.extentIntersectsPolyline;
g.extentIntersectsRings=q.extentIntersectsRings;g.getFeatureExtentIntersector=q.getFeatureExtentIntersector;g.isSelfIntersecting=q.isSelfIntersecting;g.segmentIntersects=q.segmentIntersects;g.getExtentIntersector=function(x){return"mesh"===x?q.extentIntersectsExtent:q.getFeatureExtentIntersector(x)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(g){function q(x,w,C,r,m){if(!x)return!1;w=w?C?4:3:C?3:2;const {coords:k,
lengths:f}=x;C=!1;x=0;for(const l of f){var e=x;for(let b=x,p=x+l*w;b<p;b+=w){e=b+w;e===p&&(e=x);const c=k[b],d=k[b+1],a=k[e];e=k[e+1];(d<m&&e>=m||e<m&&d>=m)&&c+(m-d)/(e-d)*(a-c)<r&&(C=!C)}x+=l*w}return C}g.polygonContainsCoords=q;g.polygonContainsMultipoint=function(x,w,C,r,m,k){m=m?k?4:3:k?3:2;const {coords:f,lengths:e}=r;if(!e)return!1;for(let l=0,b=0;l<e.length;l++,b+=m)if(!q(x,w,C,f[b],f[b+1]))return!1;return!0};g.polygonContainsPoint=function(x,w,C,r){return q(x,w,C,r.coords[0],r.coords[1])};
Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(g){function q(C,r,m,k,f){if(null!=k&&null!=f)return e=>{const l=C(e,r);e=C(e,m);return(null==l||l<=f)&&(null==e||e>=k)};if(null!=k)return e=>{e=C(e,m);return null==e||e>=k};if(null!=f)return e=>{e=C(e,r);return null==e||e<=f}}function x(C,r,m,k){if(null!=m&&null!=k&&m===k)return f=>C(f,r)===m;if(null!=m&&null!=k)return f=>{f=C(f,r);return null!=f&&f>=m&&f<=
k};if(null!=m)return f=>{f=C(f,r);return null!=f&&f>=m};if(null!=k)return f=>{f=C(f,r);return null!=f&&f<=k}}function w(){return()=>!1}g.getTimeExtent=async function(C,r){if(!C)return null;const m=r.featureAdapter,{startTimeField:k,endTimeField:f}=C;let e=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(k&&f)await r.forEach(b=>{const p=m.getAttribute(b,k);b=m.getAttribute(b,f);null==p||isNaN(p)||(e=Math.min(e,p));null==b||isNaN(b)||(l=Math.max(l,b))});else{const b=k||f;await r.forEach(p=>{p=
m.getAttribute(p,b);null==p||isNaN(p)||(e=Math.min(e,p),l=Math.max(l,p))})}return{start:e,end:l}};g.getTimeOperator=function(C,r,m){if(!r||!C)return null;const {startTimeField:k,endTimeField:f}=C;if(!k&&!f)return null;const {start:e,end:l}=r;if(null===e&&null===l)return null;if(void 0===e&&void 0===l)return w();C=m.getAttributeAsTimestamp?.bind(m)??m.getAttribute.bind(m);return k&&f?q(C,k,f,e,l):x(C,k||f,e,l)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define("../../core/Error ../../core/JSONSupport ../../core/Logger ../../core/MapUtils ../../core/sql/UnknownTimeZone ./fieldUtils ../../time/timeZoneUtils ../../chunks/datetime".split(" "),
function(g,q,x,w,C,r,m,k){function f(c){return c.trim().toLowerCase()}function e(c){const d=new Map;if(!c.fields)return d;const a=!0===c.datesInUnknownTimezone,{timeInfo:n,editFieldsInfo:t}=c;var v=(n?"startField"in n?n.startField:n.startTimeField:"")??"";const y=(n?"endField"in n?n.endField:n.endTimeField:"")??"",h="dateFieldsTimeZone"in c?c.dateFieldsTimeZone??null:c.dateFieldsTimeReference?m.fromTimeReference(c.dateFieldsTimeReference):null,A=t?"timeZone"in t?t.timeZone??h:t.dateFieldsTimeReference?
m.fromTimeReference(t.dateFieldsTimeReference):h??m.utc:null,E=n?"timeZone"in n?n.timeZone??h:n.timeReference?m.fromTimeReference(n.timeReference):h:null;v=new Map([[f(t?.creationDateField??""),A],[f(t?.editDateField??""),A],[f(v),E],[f(y),E]]);for(const {name:z,type:F}of c.fields)p.has(F)?d.set(z,m.unknown):"date"!==F&&"esriFieldTypeDate"!==F?d.set(z,null):a?d.set(z,m.unknown):(c=v.get(f(z??""))??h,d.set(z,c));return d}const l=new Map;class b{static fromJSON(c){return new b(c.fields,c.timeZoneByFieldName)}static fromLayer(c){return new b(c.fields??
[],e(c))}static fromLayerJSON(c){return new b(c.fields??[],e(c))}constructor(c=[],d){this._fieldsMap=new Map;this._normalizedFieldsMap=new Map;this._dateFieldsSet=new Set;this._numericFieldsSet=new Set;this._requiredFields=null;this.dateFields=[];this.numericFields=[];this.fields=c||[];this._timeZoneByFieldName=d?new Map(d):null;c=[];for(const a of this.fields){d=a?.name;const n=r.normalizeFieldName(d)?.toLowerCase()??"";if(d&&n){const t=f(d);this._fieldsMap.set(d,a);this._fieldsMap.set(t,a);this._normalizedFieldsMap.set(n,
a);c.push(`${t}:${a.type}:${this._timeZoneByFieldName?.get(d)}`);r.isDateField(a)?(this.dateFields.push(a),this._dateFieldsSet.add(a)):r.isNumericField(a)&&(this._numericFieldsSet.add(a),this.numericFields.push(a));r.isObjectIDField(a)||r.isGlobalIDField(a)||(a.editable=null==a.editable||!!a.editable,a.nullable=null==a.nullable||!!a.nullable)}}c.sort();this.uid=c.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const c of this.fields)r.isObjectIDField(c)||r.isGlobalIDField(c)||
c.nullable||void 0!==r.getFieldDefaultValue(c)||this._requiredFields.push(c)}return this._requiredFields}equals(c){return this.uid===c?.uid}has(c){return null!=this.get(c)}get(c){if(c){var d=this._fieldsMap.get(c);if(d)return d;(d=this._fieldsMap.get(f(c))??this._normalizedFieldsMap.get(r.normalizeFieldName(c)?.toLowerCase()??""))&&this._fieldsMap.set(c,d);return d}}getTimeZone(c){c=this.get(c&&"string"!==typeof c?c.name:c);return c?this._timeZoneByFieldName?this._timeZoneByFieldName.get(c.name):
"date"===c.type||"esriFieldTypeDate"===c.type?(x.getLogger("esri.layers.support.FieldsIndex").error(new g("getTimeZone:no-timezone-information",`no time zone information for field '${c.name}'`)),m.utc):p.has(c.type)?m.unknown:null:null}getLuxonTimeZone(c){const d=this.getTimeZone(c);return d?d===m.unknown?C.UnknownTimeZone.instance:d===m.utc?k.FixedOffsetZone.utcInstance:w.getOrCreateMapValue(l,d,()=>k.IANAZone.create(d)):null}isDateField(c){return this._dateFieldsSet.has(this.get(c))}isTimeOnlyField(c){return r.isTimeOnlyField(this.get(c))}isNumericField(c){return this._numericFieldsSet.has(this.get(c))}normalizeFieldName(c){return this.get(c)?.name??
void 0}toJSON(){return{fields:this.fields.map(c=>q.isSerializable(c)?c.toJSON():c),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}const p=new Set("time-only date-only timestamp-offset esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "));return b})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c){function d(D){return a.has(D)?a.get(D):"number"===typeof D?D:1}g.Task=void 0;(function(D){D[D.YIELD=1]="YIELD"})(g.Task||(g.Task={}));g.TaskPriority=void 0;(function(D){D.RESOURCE_CONTROLLER_IMMEDIATE="immediate";D.RESOURCE_CONTROLLER="schedule";D.SLIDE="slide";D.STREAM_DATA_LOADER="stream loader";D.ELEVATION_QUERY="elevation query";D.TERRAIN_SURFACE="terrain";D.SURFACE_GEOMETRY_UPDATES="surface geometry updates";D.LOD_RENDERER="LoD renderer";D.GRAPHICS_CORE=
"Graphics3D";D.I3S_CONTROLLER="I3S";D.POINT_CLOUD_LAYER="point cloud";D.FEATURE_TILE_FETCHER="feature fetcher";D.OVERLAY="overlay";D.STAGE="stage";D.GRAPHICS_DECONFLICTOR="graphics deconflictor";D.FILTER_VISIBILITY="Graphics3D filter visibility";D.SCALE_VISIBILITY="Graphics3D scale visibility";D.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";D.POINT_OF_INTEREST_FREQUENT="POI frequent";D.POINT_OF_INTEREST_INFREQUENT="POI infrequent";D.LABELER="labeler";D.FEATURE_QUERY_ENGINE="feature query";D.FEATURE_TILE_TREE=
"feature tile tree";D.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";D.ELEVATION_ALIGNMENT="elevation alignment";D.TEXT_TEXTURE_ATLAS="text texture atlas";D.TEXTURE_UNLOAD="texture unload";D.LINE_OF_SIGHT_TOOL="line of sight tool";D.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";D.ELEVATION_PROFILE="elevation profile";D.SNAPPING="snapping";D.SHADOW_ACCUMULATOR="shadow accumulator";D.CLOUDS_GENERATOR="clouds generator";D[D.NONE=0]="NONE";D[D.TEST_PRIO=1]="TEST_PRIO"})(g.TaskPriority||
(g.TaskPriority={}));const a=new Map([[g.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[g.TaskPriority.RESOURCE_CONTROLLER,4],[g.TaskPriority.SLIDE,0],[g.TaskPriority.STREAM_DATA_LOADER,0],[g.TaskPriority.ELEVATION_QUERY,0],[g.TaskPriority.TERRAIN_SURFACE,1],[g.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[g.TaskPriority.LOD_RENDERER,2],[g.TaskPriority.GRAPHICS_CORE,2],[g.TaskPriority.I3S_CONTROLLER,2],[g.TaskPriority.POINT_CLOUD_LAYER,2],[g.TaskPriority.FEATURE_TILE_FETCHER,2],[g.TaskPriority.OVERLAY,
4],[g.TaskPriority.STAGE,4],[g.TaskPriority.GRAPHICS_DECONFLICTOR,4],[g.TaskPriority.FILTER_VISIBILITY,4],[g.TaskPriority.SCALE_VISIBILITY,4],[g.TaskPriority.FRUSTUM_VISIBILITY,4],[g.TaskPriority.CLOUDS_GENERATOR,4],[g.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[g.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[g.TaskPriority.LABELER,8],[g.TaskPriority.FEATURE_QUERY_ENGINE,8],[g.TaskPriority.FEATURE_TILE_TREE,16],[g.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[g.TaskPriority.ELEVATION_ALIGNMENT,12],[g.TaskPriority.TEXT_TEXTURE_ATLAS,
12],[g.TaskPriority.TEXTURE_UNLOAD,12],[g.TaskPriority.LINE_OF_SIGHT_TOOL,16],[g.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[g.TaskPriority.SNAPPING,0],[g.TaskPriority.SHADOW_ACCUMULATOR,30]]),n=l.Milliseconds(6.5),t=l.Milliseconds(1),v=l.Milliseconds(30),y=l.Milliseconds(1E3/30),h=l.Milliseconds(100);var A;(function(D){class B{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(G=>G.needsUpdate)}constructor(){this._updating=e.signal(!0);this._microTaskQueued=
!1;this._frameNumber=0;this.performanceInfo={total:new r("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new H;this._state=c.RenderState.INTERACTING;this._tasks=new m;this._runQueue=new m;this._load=0;this._idleStateCallbacks=new m;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=f.watch(()=>p.SCHEDULER_LOG_SLOW_TASKS,I=>this._debug=I,f.initial);for(const I of Object.keys(g.TaskPriority))this.performanceInfo.tasks.set(g.TaskPriority[I],new r(g.TaskPriority[I]));
const G=this;this._test={FRAME_SAFETY_BUDGET:n,INTERACTING_BUDGET:y,IDLE_BUDGET:h,get availableBudget(){return G._budget.budget},usedBudget:0,getBudget:()=>G._budget,setBudget:I=>G._budget=I,updateTask:I=>this._updateTask(I),getState:I=>this._getState(I),getRuntime:I=>this._getRuntime(I),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(G=>G.remove());this._tasks.clear();C.removeMaybe(this._debugHandle);
this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(G){this._updatingChanged();G&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(G,I){const J=d(G);I=new u(this,G,I,J);this._tasks.push(I);this._updatingChanged();this.performanceInfo.tasks.has(G)||this.performanceInfo.tasks.set(G,new r(G));return I}registerIdleStateCallbacks(G,
I){const J={idleBegin:G,idleEnd:I};this._idleStateCallbacks.push(J);this.state===c.RenderState.IDLE&&this._idleUpdatesStartFired&&J.idleBegin();const M=this;return{remove:()=>this._removeIdleStateCallbacks(J),set idleBegin(R){M._idleUpdatesStartFired&&(J.idleEnd(),M._state===c.RenderState.IDLE&&R());J.idleBegin=R},set idleEnd(R){J.idleEnd=R}}}get load(){return this._load}set state(G){this._state!==G&&(this._state=G,this.state!==c.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this._idleStateCallbacks.forAll(I=>I.idleEnd())))}get state(){return this._state}updateBudget(G){this._test.usedBudget=0;++this._frameNumber;let I=n,J=G.frameDuration,M=t;switch(this.state){case c.RenderState.IDLE:I=l.Milliseconds(0);J=l.Milliseconds(Math.max(h,G.frameDuration));M=v;break;case c.RenderState.INTERACTING:J=l.Milliseconds(Math.max(y,G.frameDuration))}J=l.Milliseconds(J-G.elapsedFrameTime-I);if(this.state!==c.RenderState.IDLE&&J<t&&!this._forceTask)return this._forceTask=!0,!1;J=l.Milliseconds(Math.max(J,
M));this._budget.reset(J,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case c.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(G=>G.idleBegin()));this._runIdle();break;case c.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(l.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(G){this._idleUpdatesStartFired&&
G.idleEnd();this._idleStateCallbacks.removeUnordered(G)}removeTask(G){this._tasks.removeUnordered(G);this._runQueue.removeUnordered(G);this._updatingChanged()}_updateTask(G){this._tasks.forAll(I=>{I.name===G&&I.setPriority(G)})}_getState(G){if(this._runQueue.some(J=>J.name===G))return g.TaskState.SCHEDULED;let I=g.TaskState.IDLE;this._tasks.forAll(J=>{J.name===G&&J.needsUpdate&&(1>=J.schedulePriority?I=g.TaskState.READY:I!==g.TaskState.READY&&(I=g.TaskState.WAITING))});return I}_getRuntime(G){let I=
0;this._tasks.forAll(J=>{J.name===G&&(I+=J.runtime)});return I}_resetRuntimes(){this._tasks.forAll(G=>G.runtime=0)}_getRunning(){const G=new Map;this._tasks.forAll(J=>{J.needsUpdate&&G.set(J.name,(G.get(J.name)||0)+1)});if(0===G.size)return null;let I="";G.forEach((J,M)=>{I=1<J?I+` ${J}x ${M}`:I+` ${M}`});return I}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const G=this._tasks.reduce((I,J)=>J.needsUpdate?++I:I,0);this._load=.9*this._load+G*(1-.9)}_schedule(){this._runQueue.filterInPlace(G=>
{if(G.needsUpdate)return!0;G.schedulePriority=G.basePriority;return!1});for(this._tasks.forAll(G=>{0===G.basePriority&&G.needsUpdate&&!this._runQueue.includes(G)&&G.blockFrame!==this._frameNumber&&this._runQueue.unshift(G)});0===this._runQueue.length;){let G=!1;this._tasks.forAll(I=>{if(I.needsUpdate&&0!==I.schedulePriority&&0!==I.basePriority&&I.blockFrame!==this._frameNumber)switch(G=!0,I.schedulePriority){case 1:I.schedulePriority=0;this._runQueue.push(I);break;default:--I.schedulePriority}});
if(!G)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const G=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var I=this._budget.now();const J=this._runQueue.pop();this._budget.resetProgress();try{J.task.runTask(this._budget)===g.Task.YIELD&&(J.blockFrame=this._frameNumber)}catch(M){w.getLogger("esri.views.support.Scheduler").error(`Exception in task "${J.name}"`,M),J.blockFrame=this._frameNumber}!this._budget.hasProgressed&&J.blockFrame!==
this._frameNumber&&J.needsUpdate&&(J.blockFrame=this._frameNumber);J.schedulePriority=J.basePriority;I=this._budget.now()-I;J.runtime+=I;this._frameTaskTimes.set(J.priority,this._frameTaskTimes.get(J.priority)+I);this._debug&&I>2*this._budget.budget&&console.log("Task",J.name,"used",I,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-G);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-
G)}_startFrameTaskTimes(){for(const G of Object.keys(g.TaskPriority))this._frameTaskTimes.set(g.TaskPriority[G],0)}_recordFrameTaskTimes(G){this._frameTaskTimes.forEach((I,J)=>this.performanceInfo.tasks.get(J).record(I));this.performanceInfo.total.record(G)}get test(){return this._test}}D.Scheduler=B;class u{get task(){return this._task.value}get updating(){return this._queue.running}constructor(G,I,J,M){this._scheduler=G;this.name=I;this._basePriority=M;this.runtime=this.blockFrame=0;this._queue=
new b.PromiseQueue;this._handles=new q;this.schedulePriority=this._basePriority;this._task=e.signal(null!=J?J:this._queue);this._handles.add(f.when(()=>this.task.running,R=>G.taskRunningChanged(R)))}remove(){this.processQueue(E);this._scheduler.removeTask(this);this.schedule=F.schedule;this.reschedule=F.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(G){this.name=G;G=d(G);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=G;this._basePriority=
G}get priority(){return this.name}set priority(G){this.setPriority(G)}get needsUpdate(){return this.updating||this.task.running}schedule(G,I,J){return this._queue.push(G,I,J)}reschedule(G,I,J){return this._queue.unshift(G,I,J)}processQueue(G){this._queue.runTask(G)}}class H{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=c.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(G){if(this.done)return!1;!0===G()&&this.madeProgress();
return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(G){this._enabled=G}reset(G,I){this._begin=this.now();this._budget=G;this._state=I;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=
this._progressed=!1}get hasProgressed(){return this._progressed}}D.Budget=H})(A||(A={}));g.TaskState=void 0;(function(D){D.SCHEDULED="s";D.READY="r";D.WAITING="w";D.IDLE="i"})(g.TaskState||(g.TaskState={}));const E=(()=>{const D=new A.Budget;D.enabled=!1;return D})();class z{remove(){}processQueue(){}schedule(D,B,u){try{if(k.isAborted(B)){const H=k.createAbortError();return u?Promise.resolve(u(H)):Promise.reject(H)}return k.when(D(E))}catch(H){return Promise.reject(H)}}reschedule(D,B,u){return this.schedule(D,
B,u)}}const F=new z;g.ImmediateTask=F;g.getTaskPriority=d;g.newScheduler=function(){return new A.Scheduler};g.noBudget=E;g.taskPriorities=a;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(g,q,x,w){class C{constructor(r,m){this._observable=new w.SimpleObservable;this._value=r;this._equalityFunction=m}get value(){x.trackAccess(this._observable);
return this._value}set value(r){this._equalityFunction(r,this._value)||(this._value=r,this._observable.notify())}mutate(r){r(this._value);this._observable.notify()}}g.signal=function(r,m=q.equalsShallow){return new C(r,m)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal"],function(g,q,x){class w{constructor(){this._tasks=[];this._running=x.signal(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(r){for(;!r.done&&
this._process(r);)r.madeProgress()}push(r,m,k){this._running.value=!0;return new Promise((f,e)=>this._tasks.push(new C(f,e,r,m,k)))}unshift(r,m,k){this._running.value=!0;return new Promise((f,e)=>this._tasks.unshift(new C(f,e,r,m,k)))}_process(r){if(0===this._tasks.length)return!1;const m=this._tasks.shift();try{const k=q.isAborted(m.signal);if(k&&!m.abortCallback)m.reject(q.createAbortError());else{const f=k?m.abortCallback?.(q.createAbortError()):m.callback(r);q.isPromiseLike(f)?f.then(m.resolve,
m.reject):m.resolve(f)}}catch(k){m.reject(k)}this._running.value=0<this._tasks.length;return!0}cancelAll(){const r=q.createAbortError();for(const m of this._tasks)if(m.abortCallback){const k=m.abortCallback(r);m.resolve(k)}else m.reject(r);this._tasks.length=0;this._running.value=!1}}class C{constructor(r,m,k,f,e){this.resolve=r;this.reject=m;this.callback=k;this.signal=f;this.abortCallback=e}}g.PromiseQueue=w;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m){q=class extends q{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=!1}};g.__decorate([x.property()],q.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);g.__decorate([x.property()],q.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);q=g.__decorate([m.subclass("esri.views.support.DebugFlags")],q);return new q})},"esri/views/support/RenderState":function(){define(["exports"],function(g){g.RenderState=
void 0;var q=g.RenderState||(g.RenderState={});q[q.ANIMATING=0]="ANIMATING";q[q.INTERACTING=1]="INTERACTING";q[q.IDLE=2]="IDLE";Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStore2D":function(){define("exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../chunks/rbush ../../../../geometry/support/aaBoundingBox ./Store2D ./support/FeatureSetReaderPBFIndirect".split(" "),function(g,q,x,w,C,r,m,k){const f=
r.create(),e={getObjectId(b){return b.getObjectId()},getAttributes(b){return b.readAttributes()},getAttribute(b,p){return b.readAttribute(p)},getAttributeAsTimestamp(b,p){return b.readAttributeAsTimestamp(p)},cloneWithGeometry(b,p){return b},getGeometry(b){return b.readHydratedGeometry()},getCentroid(b,p){return b.readCentroid()}};class l extends m.Store2D{constructor(b,p,c){super(b,p);this.featureAdapter=e;this.events=new x;this._featureSetsByInstance=new Map;this._objectIdToDisplayId=new Map;this._spatialIndexInvalid=
!0;this._indexSearchCache=new q(50);this._index=C.rbush(9,d=>({minX:this._storage.getXMin(d),minY:this._storage.getYMin(d),maxX:this._storage.getXMax(d),maxY:this._storage.getYMax(d)}));this.mode=c}get storeStatistics(){let b=0,p=0,c=0;this.forEach(d=>{if(d=d.readGeometry())p+=d.isPoint?1:d.lengths.reduce((a,n)=>a+n,0),c+=d.isPoint?1:d.lengths.length,b+=1});return{featureCount:b,vertexCount:p,ringCount:c}}hasInstance(b){return this._featureSetsByInstance.has(b)}onTileData(b,p,c){if(null==p.addOrUpdate)return p;
p.addOrUpdate.attachStorage(this._storage);if("snapshot"===this.mode){for(var d=p.addOrUpdate.getCursor();d.next();){const a=d.getDisplayId();this.setComputedAttributes(this._storage,d,a,b.scale,c)}return p}this._featureSetsByInstance.set(p.addOrUpdate.instance,p.addOrUpdate);for(d=p.addOrUpdate.getCursor();d.next();)this._insertFeature(d,b.scale,c);this._spatialIndexInvalid=!0;this.events.emit("changed");return p}search(b){this._rebuildIndex();const p=b.id;var c=this._indexSearchCache.find(n=>n.tileId===
p);if(null!=c)return c.readers;c=new Map;b=this._searchIndex(b.bounds);const d=[];for(const n of b){var a=this._storage.getInstanceId(n);b=(4294901760&a)>>>16;a&=65535;c.has(b)||c.set(b,[]);c.get(b).push(a)}c.forEach((n,t)=>{t=this._featureSetsByInstance.get(t);d.push(k.FeatureSetReaderIndirect.from(t,n))});this._indexSearchCache.enqueue({tileId:p,readers:d});return d}insert(b){const p=b.getCursor(),c=this._storage;for(;p.next();){var d=p.getIndex();d|=p.instance<<16;const a=p.getObjectId(),n=this._objectIdToDisplayId.get(a)??
this._storage.createDisplayId();p.setDisplayId(n);c.setInstanceId(n,d);this._objectIdToDisplayId.set(a,n)}this._featureSetsByInstance.set(b.instance,b);this._spatialIndexInvalid=!0}remove(b){const p=this._objectIdToDisplayId.get(b);if(p){var c=this._storage.getInstanceId(p),d=65535&c;c=(4294901760&c)>>>16;var a=this._featureSetsByInstance.get(c);this._objectIdToDisplayId.delete(b);this._storage.releaseDisplayId(p);a.removeAtIndex(d);a.isEmpty&&this._featureSetsByInstance.delete(c);this._spatialIndexInvalid=
!0}}forEach(b){this._objectIdToDisplayId.forEach(p=>{p=this._storage.getInstanceId(p);p=this._lookupFeature(p);b(p)})}forEachUnsafe(b){this._objectIdToDisplayId.forEach(p=>{var c=this._storage.getInstanceId(p);p=65535&c;c=this._getFeatureSet((4294901760&c)>>>16);c.setIndex(p);b(c)})}forEachInBounds(b,p){b=this._searchIndex(b);for(const c of b)b=this.lookupFeatureByDisplayId(c,this._storage),p(b)}forEachBounds(b,p){this._rebuildIndex();for(const c of b)c.readGeometry()&&(b=c.getDisplayId(),r.fromRectValues(f,
this._storage.getXMin(b),this._storage.getYMin(b),this._storage.getXMax(b),this._storage.getYMax(b)),p(f))}sweepFeatures(b,p,c){this._spatialIndexInvalid=!0;this._objectIdToDisplayId.forEach((d,a)=>{b.has(d)||(p.releaseDisplayId(d),c&&c.unsetAttributeData(d),this._objectIdToDisplayId.delete(a))});this.events.emit("changed")}sweepFeatureSets(b){this._spatialIndexInvalid=!0;this._featureSetsByInstance.forEach((p,c)=>{b.has(c)||this._featureSetsByInstance.delete(c)})}lookupObjectId(b,p){b=this.lookupFeatureByDisplayId(b,
p);return null==b?null:b.getObjectId()}lookupDisplayId(b){return this._objectIdToDisplayId.get(b)}lookupFeatureByDisplayId(b,p){b=p.getInstanceId(b);return this._lookupFeature(b)}lookupByDisplayIdUnsafe(b){var p=this._storage.getInstanceId(b);b=65535&p;p=this._getFeatureSet((4294901760&p)>>>16);if(!p)return null;p.setIndex(b);return p}_insertFeature(b,p,c){const d=this._storage,a=b.getObjectId();var n=b.getIndex();n|=b.instance<<16;d.getInstanceId(b.getDisplayId());let t=this._objectIdToDisplayId.get(a);
t||(t=d.createDisplayId(),this._objectIdToDisplayId.set(a,t),this._spatialIndexInvalid=!0);b.setDisplayId(t);d.setInstanceId(t,n);this.setComputedAttributes(d,b,t,p,c)}_searchIndex(b){this._rebuildIndex();return this._index.search({minX:b[0],minY:b[1],maxX:b[2],maxY:b[3]})}_rebuildIndex(){if(this._spatialIndexInvalid){var b=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach(p=>{for(p=p.getCursor();p.next();){const c=p.getDisplayId();this._storage.setBounds(c,p)&&b.push(c)}}):this._objectIdToDisplayId.forEach(p=>
{const c=this._storage.getInstanceId(p);this._storage.setBounds(p,this._lookupFeature(c))&&b.push(p)});this._index.clear();this._index.load(b);this._indexSearchCache.clear();this._spatialIndexInvalid=!1}}_lookupFeature(b){var p=this._getFeatureSet((4294901760&b)>>>16);if(p)return p=p.getCursor(),p.setIndex(65535&b),p}_getFeatureSet(b){return this._featureSetsByInstance.get(b)}}g.FeatureStore2D=l;g.featureAdapter=e;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class g{constructor(q){this._start=
this.size=0;this.maxSize=q;this._buffer=Array(q)}get entries(){return this._buffer}enqueue(q){if(this.size===this.maxSize){const x=this._buffer[this._start];this._buffer[this._start]=q;this._start=(this._start+1)%this.maxSize;return x}this._buffer[(this._start+this.size++)%this.maxSize]=q;return null}dequeue(){if(0===this.size)return null;const q=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return q}peek(){return 0===this.size?null:
this._buffer[this._start]}find(q){if(0===this.size)return null;for(const x of this._buffer)if(null!=x&&q(x))return x;return null}clear(q){let x=this.dequeue();for(;null!=x;)q&&q(x),x=this.dequeue()}}return g})},"esri/chunks/rbush":function(){define(["exports","./quickselect"],function(g,q){function x(d,a){if(!(this instanceof x))return new x(d,a);this._maxEntries=Math.max(4,d||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));a&&("function"===typeof a?this.toBBox=a:this._initFormat(a));
this.clear()}function w(d,a){C(d,0,d.children.length,a,d)}function C(d,a,n,t,v){v||(v=p(null));v.minX=Infinity;v.minY=Infinity;v.maxX=-Infinity;v.maxY=-Infinity;for(var y;a<n;a++)y=d.children[a],r(v,d.leaf?t(y):y);return v}function r(d,a){d.minX=Math.min(d.minX,a.minX);d.minY=Math.min(d.minY,a.minY);d.maxX=Math.max(d.maxX,a.maxX);d.maxY=Math.max(d.maxY,a.maxY);return d}function m(d,a){return d.minX-a.minX}function k(d,a){return d.minY-a.minY}function f(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function e(d){return d.maxX-
d.minX+(d.maxY-d.minY)}function l(d,a){return d.minX<=a.minX&&d.minY<=a.minY&&a.maxX<=d.maxX&&a.maxY<=d.maxY}function b(d,a){return a.minX<=d.maxX&&a.minY<=d.maxY&&a.maxX>=d.minX&&a.maxY>=d.minY}function p(d){return{children:d,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function c(d,a,n,t,v){for(var y=[a,n],h;y.length;)n=y.pop(),a=y.pop(),n-a<=t||(h=a+Math.ceil((n-a)/t/2)*t,q.quickselect(d,h,a,n,v),y.push(a,h,h,n))}x.prototype={all:function(){return this._all(this.data,
[])},search:function(d){var a=this.data,n=[],t=this.toBBox;if(!b(d,a))return n;for(var v=[],y,h,A,E;a;){y=0;for(h=a.children.length;y<h;y++)A=a.children[y],E=a.leaf?t(A):A,b(d,E)&&(a.leaf?n.push(A):l(d,E)?this._all(A,n):v.push(A));a=v.pop()}return n},collides:function(d){var a=this.data,n=this.toBBox;if(!b(d,a))return!1;for(var t=[],v,y,h,A;a;){v=0;for(y=a.children.length;v<y;v++)if(h=a.children[v],A=a.leaf?n(h):h,b(d,A)){if(a.leaf||l(d,A))return!0;t.push(h)}a=t.pop()}return!1},load:function(d){if(!d||
!d.length)return this;if(d.length<this._minEntries){for(var a=0,n=d.length;a<n;a++)this.insert(d[a]);return this}d=this._build(d.slice(),0,d.length-1,0);this.data.children.length?this.data.height===d.height?this._splitRoot(this.data,d):(this.data.height<d.height&&(a=this.data,this.data=d,d=a),this._insert(d,this.data.height-d.height-1,!0)):this.data=d;return this},insert:function(d){d&&this._insert(d,this.data.height-1);return this},clear:function(){this.data=p([]);return this},remove:function(d,
a){if(!d)return this;for(var n=this.data,t=this.toBBox(d),v=[],y=[],h,A,E,z;n||v.length;){n||(n=v.pop(),A=v[v.length-1],h=y.pop(),z=!0);if(n.leaf){a:{E=d;var F=n.children,D=a;if(D){for(var B=0;B<F.length;B++)if(D(E,F[B])){E=B;break a}E=-1}else E=F.indexOf(E)}if(-1!==E){n.children.splice(E,1);v.push(n);this._condense(v);break}}z||n.leaf||!l(n,t)?A?(h++,n=A.children[h],z=!1):n=null:(v.push(n),y.push(h),h=0,A=n,n=n.children[0])}return this},toBBox:function(d){return d},compareMinX:m,compareMinY:k,toJSON:function(){return this.data},
fromJSON:function(d){this.data=d;return this},_all:function(d,a){for(var n=[];d;)d.leaf?a.push.apply(a,d.children):n.push.apply(n,d.children),d=n.pop();return a},_build:function(d,a,n,t){var v=n-a+1,y=this._maxEntries;if(v<=y){var h=p(d.slice(a,n+1));w(h,this.toBBox);return h}t||(t=Math.ceil(Math.log(v)/Math.log(y)),y=Math.ceil(v/Math.pow(y,t-1)));h=p([]);h.leaf=!1;h.height=t;v=Math.ceil(v/y);y=v*Math.ceil(Math.sqrt(y));var A;for(c(d,a,n,y,this.compareMinX);a<=n;a+=y){var E=Math.min(a+y-1,n);c(d,
a,E,v,this.compareMinY);for(A=a;A<=E;A+=v){var z=Math.min(A+v-1,E);h.children.push(this._build(d,A,z,t-1))}}w(h,this.toBBox);return h},_chooseSubtree:function(d,a,n,t){for(var v,y,h,A,E,z,F,D;;){t.push(a);if(a.leaf||t.length-1===n)break;F=D=Infinity;v=0;for(y=a.children.length;v<y;v++)h=a.children[v],E=f(h),z=(Math.max(h.maxX,d.maxX)-Math.min(h.minX,d.minX))*(Math.max(h.maxY,d.maxY)-Math.min(h.minY,d.minY))-E,z<D?(D=z,F=E<F?E:F,A=h):z===D&&E<F&&(F=E,A=h);a=A||a.children[0]}return a},_insert:function(d,
a,n){var t=this.toBBox;n=n?d:t(d);t=[];var v=this._chooseSubtree(n,this.data,a,t);v.children.push(d);for(r(v,n);0<=a;)if(t[a].children.length>this._maxEntries)this._split(t,a),a--;else break;this._adjustParentBBoxes(n,t,a)},_split:function(d,a){var n=d[a],t=n.children.length,v=this._minEntries;this._chooseSplitAxis(n,v,t);t=this._chooseSplitIndex(n,v,t);t=p(n.children.splice(t,n.children.length-t));t.height=n.height;t.leaf=n.leaf;w(n,this.toBBox);w(t,this.toBBox);a?d[a-1].children.push(t):this._splitRoot(n,
t)},_splitRoot:function(d,a){this.data=p([d,a]);this.data.height=d.height+1;this.data.leaf=!1;w(this.data,this.toBBox)},_chooseSplitIndex:function(d,a,n){var t,v;var y=v=Infinity;for(t=a;t<=n-a;t++){var h=C(d,0,t,this.toBBox);var A=C(d,t,n,this.toBBox);var E=Math.max(0,Math.min(h.maxX,A.maxX)-Math.max(h.minX,A.minX))*Math.max(0,Math.min(h.maxY,A.maxY)-Math.max(h.minY,A.minY));h=f(h)+f(A);if(E<y){y=E;var z=t;v=h<v?h:v}else E===y&&h<v&&(v=h,z=t)}return z},_chooseSplitAxis:function(d,a,n){var t=d.leaf?
this.compareMinX:m,v=d.leaf?this.compareMinY:k,y=this._allDistMargin(d,a,n,t);a=this._allDistMargin(d,a,n,v);y<a&&d.children.sort(t)},_allDistMargin:function(d,a,n,t){d.children.sort(t);t=this.toBBox;var v=C(d,0,a,t),y=C(d,n-a,n,t),h=e(v)+e(y),A;for(A=a;A<n-a;A++){var E=d.children[A];r(v,d.leaf?t(E):E);h+=e(v)}for(A=n-a-1;A>=a;A--)E=d.children[A],r(y,d.leaf?t(E):E),h+=e(y);return h},_adjustParentBBoxes:function(d,a,n){for(;0<=n;n--)r(a[n],d)},_condense:function(d){for(var a=d.length-1,n;0<=a;a--)0===
d[a].children.length?0<a?(n=d[a-1].children,n.splice(n.indexOf(d[a]),1)):this.clear():w(d[a],this.toBBox)},_initFormat:function(d){var a=["return a"," - b",";"];this.compareMinX=new Function("a","b",a.join(d[0]));this.compareMinY=new Function("a","b",a.join(d[1]));this.toBBox=new Function("a","return {minX: a"+d[0]+", minY: a"+d[1]+", maxX: a"+d[2]+", maxY: a"+d[3]+"};")}};g.rbush=x})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(g,q){var x={exports:{}};x.exports;
(function(w){(function(C){C=C();void 0!==C&&(w.exports=C)})(function(){function C(k,f,e,l,b){for(;l>e;){if(600<l-e){var p=l-e+1,c=f-e+1,d=Math.log(p),a=.5*Math.exp(2*d/3);d=.5*Math.sqrt(d*a*(p-a)/p)*(0>c-p/2?-1:1);C(k,f,Math.max(e,Math.floor(f-c*a/p+d)),Math.min(l,Math.floor(f+(p-c)*a/p+d)),b)}p=k[f];c=e;a=l;r(k,e,f);for(0<b(k[l],p)&&r(k,e,l);c<a;){r(k,c,a);c++;for(a--;0>b(k[c],p);)c++;for(;0<b(k[a],p);)a--}0===b(k[e],p)?r(k,e,a):(a++,r(k,a,l));a<=f&&(e=a+1);f<=a&&(l=a-1)}}function r(k,f,e){var l=
k[f];k[f]=k[e];k[e]=l}function m(k,f){return k<f?-1:k>f?1:0}return function(k,f,e,l,b){C(k,f,e||0,l||k.length-1,b||m)}})})(x);q=q.getDefaultExportFromCjs(x.exports);g.quickselect=q})},"esri/views/2d/layers/features/Store2D":function(){define("require exports ../../../../core/has ../../../../core/accessorSupport/diffUtils ../../../../support/arcadeOnDemand ../../arcade/callExpressionWithCursor".split(" "),function(g,q,x,w,C,r){class m{constructor(k,f){this._canCacheExpressionValue=!1;this._sourceInfo=
k;this._storage=f;this._bitsets={computed:f.getBitset(f.createBitset())}}get storage(){return this._storage}invalidate(){this._bitsets.computed.clear()}async updateSchema(k,f){var e=w.diff(this._schema,f);if((this._schema=f)&&null!=e&&w.hasDiff(e,"attributes")){x("esri-2d-update-debug")&&console.debug("Applying Update - Store:",e);this._bitsets.computed.clear();k.targets[f.name]=!0;k=f.attributes;f=[];e=[];for(const l in k){const b=k[l];switch(b.type){case "expression":f.push(this._createArcadeComputedField(b));
break;case "label-expression":f.push(this._createLabelArcadeComputedField(b));break;case "statistic":e.push(b)}}this._computedFields=await Promise.all(f);this._canCacheExpressionValue=!this._computedFields.some(l=>"expression"===l.type&&null!=l.expression&&l.expression.referencesScale());this._statisticFields=e}}setComputedAttributes(k,f,e,l,b){var p=this._bitsets.computed;if(!this._canCacheExpressionValue||!p.has(e)){p.set(e);for(const c of this._computedFields)switch(p=this._evaluateField(f,c,l,
b),c.resultType){case "numeric":k.setComputedNumericAtIndex(e,c.fieldIndex,p);break;case "string":k.setComputedStringAtIndex(e,c.fieldIndex,p)}}}async _createArcadeComputedField(k){return{...k,expression:await C.createRendererExpression(k.valueExpression,this._sourceInfo.spatialReference,this._sourceInfo.fieldsIndex)}}async _createLabelArcadeComputedField(k){var f=this._sourceInfo.spatialReference;const e=this._sourceInfo.fieldsIndex,{createLabelFunction:l}=await new Promise((b,p)=>g(["../../../../layers/support/labelFormatUtils"],
b,p));f=await l(k.label,e,f);return{...k,builder:f}}_evaluateField(k,f,e,l){switch(f.type){case "label-expression":return k=k.readArcadeFeature(),f.builder.evaluate(k,l)||"";case "expression":return{expression:f}=f,r(f,k,{$view:{scale:e,timeZone:l}})}}}q.Store2D=m;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],function(g,q,x,w){function C(p){return p instanceof x?Object.keys(p.items):
p instanceof q?w.getProperties(p).keys():p?Object.keys(p):[]}function r(p,c){return p instanceof x?p.items[c]:p[c]}function m(p,c){return Array.isArray(p)&&Array.isArray(c)?p.length!==c.length:!1}function k(p){return p?p.declaredClass:null}function f(p,c){const d=p.diff;if(d&&"function"===typeof d)return d(p,c);const a=C(p),n=C(c);if(0!==a.length||0!==n.length){if(!a.length||!n.length||m(p,c))return{type:"complete",oldValue:p,newValue:c};var t=n.filter(h=>!a.includes(h)),v=a.filter(h=>!n.includes(h));
v=a.filter(h=>n.includes(h)&&r(p,h)!==r(c,h)).concat(t,v).sort();if((t=k(p))&&b.has(t)&&v.length)return{type:"complete",oldValue:p,newValue:c};var y;t=p instanceof q&&c instanceof q;for(const h of v){v=r(p,h);const A=r(c,h);if((t||"function"!==typeof v&&"function"!==typeof A)&&v!==A&&(null!=v||null!=A)){if(d&&d[h]&&"function"===typeof d[h])v=d[h]?.(v,A);else if(v instanceof Date&&A instanceof Date){if(v.getTime()===A.getTime())continue;v={type:"complete",oldValue:v,newValue:A}}else v="object"===typeof v&&
"object"===typeof A&&k(v)===k(A)?f(v,A):{type:"complete",oldValue:v,newValue:A};null!=v&&(null!=y?y.diff[h]=v:y={type:"partial",diff:{[h]:v}})}}return y}}function e(p,c){if(null==p)return!1;c=c.split(".");for(const d of c){if("complete"===p.type)break;if("partial"===p.type){if(p=p.diff[d],!p)return!1}else return!1}return!0}function l(p){if(null==p)return!0;switch(p.type){case "complete":return!1;case "collection":for(const c of p.added)if(!l(c))return!1;for(const c of p.removed)if(!l(c))return!1;
for(const c of p.changed)if(!l(c))return!1;return!0;case "partial":for(const c in p.diff)if(!l(p.diff[c]))return!1;return!0}}const b=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);g.diff=function(p,c){if("function"!==typeof p&&"function"!==typeof c&&(null!=p||null!=c))return null==p||null==c||"object"===typeof p&&"object"===typeof c&&k(p)!==k(c)?{type:"complete",oldValue:p,newValue:c}:f(p,c)};g.hasDiff=e;
g.hasDiffAny=function(p,c){for(const d of c)if(e(p,d))return!0;return!1};g.isEmpty=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["../../../core/Logger"],function(g){return function(q,x,w){if(null==q)return null;const C=x.readArcadeFeature();x.contextTimeZone=w.$view?.timeZone;try{return q.evaluate({...w,$feature:C},q.services)}catch(r){return g.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
r),null}}})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFIndirect":function(){define(["exports","./FeatureSetReader"],function(g,q){class x extends q.FeatureSetReader{static from(w,C){return new x(w.copy(),C)}constructor(w,C){super(q.FeatureSetReader.createInstance(),w.fullSchema());this._currentIndex=-1;this._reader=w;this._indices=C}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const w=
new x(this._reader.copy(),this._indices);w._currentIndex=this._currentIndex;return w}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length?(this._reader.setIndex(this._indices[this._currentIndex]),!0):!1}setArcadeSpatialReference(w){this._reader.setArcadeSpatialReference(w)}attachStorage(w){this._reader.attachStorage(w)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(w){this._reader.contextTimeZone=
w}getStorage(){return this._reader.getStorage()}getComputedNumeric(w){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(w,C){return this._reader.setComputedNumericAtIndex(C,0)}getComputedString(w){return this._reader.getComputedStringAtIndex(0)}setComputedString(w,C){return this._reader.setComputedStringAtIndex(0,C)}getComputedNumericAtIndex(w){return this._reader.getComputedNumericAtIndex(w)}setComputedNumericAtIndex(w,C){this._reader.setComputedNumericAtIndex(w,C)}getComputedStringAtIndex(w){return this._reader.getComputedStringAtIndex(w)}setComputedStringAtIndex(w,
C){return this._reader.setComputedStringAtIndex(w,C)}transform(w,C,r,m){const k=this.copy();k._reader=this._reader.transform(w,C,r,m);return k}readAttribute(w,C=!1){return this._reader.readAttribute(w,C)}readAttributes(){return this._reader.readAttributes()}joinAttributes(w){return this._reader.joinAttributes(w)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(w){return this.readAttribute(w,!0)}hasField(w){return this._reader.hasField(w)}setField(w,
C){return this._reader.setField(w,C)}keys(){return this._reader.keys()}castToText(w=!1){return this._reader.castToText(w)}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(w){return this._reader.setDisplayId(w)}getGroupId(){return this._reader.getGroupId()}setGroupId(w){return this._reader.setGroupId(w)}getXHydrated(){return this._reader.getXHydrated()}getYHydrated(){return this._reader.getYHydrated()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(w){return this._reader.setIndex(w)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_readAttribute(w,
C){throw Error("Error: Should not be called. Underlying _reader should be used instead");}_readAttributes(){throw Error("Error: Should not be called. Underlying _reader should be used instead");}}g.FeatureSetReaderIndirect=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c){let d=0;q=w("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const a=q[0],n=q[1],t=q[2],v=q[3];q=w("featurelayer-simplify-payload-size-factors")??[1,2,4];const y=q[0],h=q[1],A=q[2],E=w("featurelayer-simplify-mobile-factor")??2,z=w("esri-mobile");class F{constructor(D,B){this.type="FeatureSetReader";this.arcadeDeclaredClass="esri.arcade.Feature";this.seen=!1;this._ty=this._tx=this.instance=0;this._sy=this._sx=1;this._deleted=null;this._joined=[];this._contextTimeZone=
this._objectIdToIndex=null;this._level=0;this.instance=D;this._layerSchema=B}static createInstance(){d++;return d=65535<d?0:d}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(D){this._contextTimeZone=D}set level(D){this._level=D}getAreaSimplificationThreshold(D,B){let u=1;const H=z?E:1;4E6<B?u=A*H:1E6<B?u=h*H:5E5<B?u=y*H:1E5<B&&(u=H);B=0;4E3<D?B=v*u:2E3<D?B=t*u:100<D?B=n:15<D&&(B=a);D=8;4>this._level?
D=1:5>this._level?D=2:6>this._level&&(D=4);return B*D}createQuantizedExtrudedGeometry(D,B){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(D,B):this._createQuantizedExtrudedQuad(D,B)}_createQuantizedExtrudedQuad(D,B){return new l([5],[D-1,B,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(D,B){return new l([2],[D-1,B+1,1,-1])}parseTimestampOffset(D){return D}setArcadeSpatialReference(D){this._arcadeSpatialReference=D}attachStorage(D){this._storage=D}getQuantizationTransform(){throw Error("Unable to find transform for featureSet");
}getStorage(){return this._storage}getComputedNumeric(D){return this.getComputedNumericAtIndex(0)}setComputedNumeric(D,B){return this.setComputedNumericAtIndex(B,0)}getComputedString(D){return this.getComputedStringAtIndex(0)}setComputedString(D,B){return this.setComputedStringAtIndex(0,B)}getComputedNumericAtIndex(D){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),D)}setComputedNumericAtIndex(D,B){this._storage.setComputedNumericAtIndex(this.getDisplayId(),D,B)}getComputedStringAtIndex(D){return this._storage.getComputedStringAtIndex(this.getDisplayId(),
D)}setComputedStringAtIndex(D,B){return this._storage.setComputedStringAtIndex(this.getDisplayId(),D,B)}transform(D,B,u,H){const G=this.copy();G._tx+=D;G._ty+=B;G._sx*=u;G._sy*=H;return G}readAttributeAsTimestamp(D){D=this.readAttribute(D);return"string"===typeof D?(new Date(D)).getTime():"number"===typeof D||null==D?D:null}readAttribute(D,B=!1){var u=this._readAttribute(D,B);if(void 0!==u)return u;for(const H of this._joined)if(H.setIndex(this.getIndex()),u=H._readAttribute(D,B),void 0!==u)return u}readAttributes(){const D=
this._readAttributes();for(const B of this._joined){B.setIndex(this.getIndex());const u=B._readAttributes();for(const H of Object.keys(u))D[H]=u[H]}return D}joinAttributes(D){this._joined.push(D)}readArcadeFeature(){return this}hasField(D){return this.fields.has(D)}geometry(){var D=this.readHydratedGeometry();D=e.convertToGeometry(D,this.geometryType,this.hasZ,this.hasM);if(D=c.fromJSON(D))D.spatialReference=this._arcadeSpatialReference;return D}autocastArcadeDate(D,B){return B&&B instanceof Date?
this.isUnknownDateTimeField(D)?x.ArcadeDate.unknownDateJSToArcadeDate(B):x.ArcadeDate.dateJSAndZoneToArcadeDate(B,this.contextTimeZone??b.system):B}isUnknownDateTimeField(D){return this._layerSchema.fieldsIndex.getTimeZone(D)===b.unknown}field(D){let B=this.fields.get(D);if(B)switch(B.type){case "date-only":case "esriFieldTypeDateOnly":return r.DateOnly.fromReader(this.readAttribute(D,!1));case "time-only":case "esriFieldTypeTimeOnly":return m.TimeOnly.fromReader(this.readAttribute(D,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return x.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(D,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(D,this.readAttribute(D,!0));default:return this.readAttribute(D,!1)}for(const u of this._joined)if(u.setIndex(this.getIndex()),B=u.fields.get(D))switch(B.type){case "date-only":case "esriFieldTypeDateOnly":return r.DateOnly.fromReader(u._readAttribute(D,!1));case "time-only":case "esriFieldTypeTimeOnly":return m.TimeOnly.fromReader(u._readAttribute(D,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return x.ArcadeDate.fromReaderAsTimeStampOffset(u._readAttribute(D,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(D,u._readAttribute(D,!0));default:return this.readAttribute(D,!1)}throw Error(`Field ${D} does not exist`);}setField(D,B){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(D=>D.name)}castToText(D=!1){if(!D)return JSON.stringify(this.readLegacyFeature());D=this.readLegacyFeature();if(!D)return JSON.stringify(null);D={geometry:D.geometry,attributes:{...(D.attributes??
{})}};for(const B in D.attributes){const u=D.attributes[B];u instanceof Date&&(D.attributes[B]=u.getTime())}return JSON.stringify(D)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(D=null){return{attributes:this._readAttributes(),geometry:!0===D?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(D,B=null){return Promise.resolve(this.castAsJson(B))}removeIds(D){if(null==this._objectIdToIndex){var B=new Map;const u=this.getCursor();for(;u.next();){const H=
u.getObjectId();C.assertIsSome(H);B.set(H,u.getIndex())}this._objectIdToIndex=B}B=this._objectIdToIndex;for(const u of D)B.has(u)&&this.removeAtIndex(B.get(u))}removeAtIndex(D){null==this._deleted&&(this._deleted=p.StaticBitSet.create(this.getSize()));this._deleted.set(D)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const D=this.getCursor();for(;D.next();)yield D.readOptimizedFeature()}_getExists(){return null==
this._deleted||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;var D=this.readUnquantizedGeometry();if(!D||D.hasIndeterminateRingOrder)return null;D=k.GeometryCursor.fromOptimized(D,this.geometryType);D.yFactor*=-1;return(D=f.getLabelPoint(D))?(D[1]*=-1,new l([],D)):null}copyInto(D){D.seen=this.seen;D._storage=this._storage;D._arcadeSpatialReference=this._arcadeSpatialReference;D._joined=this._joined;D._tx=this._tx;D._ty=this._ty;D._sx=
this._sx;D._sy=this._sy;D._deleted=this._deleted;D._objectIdToIndex=this._objectIdToIndex;D.contextTimeZone=this.contextTimeZone}}g.FeatureSetReader=F;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(g,q,x,w,C){function r(b){if(w.isPolygon(b))b=[b.rings,"esriGeometryPolygon"];else if(w.isPolyline(b))b=[b.paths,
"esriGeometryPolyline"];else if(w.isMultipoint(b))b=[[b.points],"esriGeometryMultipoint"];else if(w.isExtent(b))b=[[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]],"esriGeometryEnvelope"];else if(w.isPoint(b)){const p=[b.x,b.y];b.z&&p.push(b.z);b.m&&p.push(b.m);b=[[[p]],"esriGeometryPoint"]}else b=[[],"esriGeometryPolyline"];return b}class m{static fromOptimized(b,p,c=!1,d=!1){return(new k).initialize(b,p,c,d,1)}static fromJSON(b,p=!1,c=!1){const [d,a]=r(b);return(new f).initialize(d,
a,p,c,1)}static fromOptimizedCIM(b,p,c=!1,d=!1){return(new e).initialize(b,p,c,d,1)}static fromJSONCIM(b,p=!1,c=!1){const [d,a]=r(b);return(new l).initialize(d,a,p,c,1)}static fromFeatureSetReader(b){const p=b.readGeometryForDisplay();b=b.geometryType;return p&&b?this.fromOptimized(p,b):null}static fromFeatureSetReaderCIM(b){const p=b.readGeometryForDisplay();b=b.geometryType;return p&&b?this.fromOptimizedCIM(p,b):null}static createEmptyOptimized(b,p=!1,c=!1){return(new k).initialize(new C,b,p,c,
1)}static createEmptyJSON(b,p=!1,c=!1){return(new f).initialize([],b,p,c,1)}static createEmptyOptimizedCIM(b,p=!1,c=!1){return(new e).initialize(new C,b,p,c,1)}static createEmptyJSONCIM(b,p=!1,c=!1){return(new l).initialize([],b,p,c,1)}asJSON(){const b=x.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:b[0][0][0],ymin:b[0][0][1],xmax:b[0][2][0],ymax:b[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:b.flat()}:"esriGeometryPoint"===this.geometryType?{x:b[0][0][0],
y:b[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:b}:{paths:b}}getCurrentRingArea(){if(!this||3>this.pathSize)return 0;let b=0,p,c;this.seekPathStart();if(!this.nextPoint())return 0;p=this.x;c=this.y;const d=p,a=c;for(;this.nextPoint();)b+=(p-this.x)*(c+this.y),p=this.x,c=this.y;return-.5*(b+(p-d)*(c+a))}invertY(){this.yFactor*=-1}}class k extends m{constructor(){super(...arguments);this._end=-1}initialize(b,p,c,d,a){this.hasZ=c;this.hasM=d;this.geometryType=p;this._stride=2+Number(c)+
Number(d);this._geometry=b;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=a;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(b){if(0<=b&&b<this.totalSize){if(this._pathIndex<b)for(;this._pathIndex<b&&this.nextPath(););else if(this._pathIndex>b)for(;this._pathIndex>b&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=
this._end}seekInPath(b){b=this._pathOffset+b*this._stride;return 0<=b&&b<this._end?(this._pointOffset=b,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){0<=this._pathIndex&&(this._pathOffset+=this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex]));this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*(this._geometry.isPoint?1:
this._geometry.lengths[this._pathIndex+1]);return++this._pathIndex<this.totalSize}prevPath(){this._end=this._pathOffset;this._pathOffset-=this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex-1]);this._pointOffset=this._pathOffset-this._stride;return 0<=--this._pathIndex}pathLength(){const b=this._end,p=this._stride,c=this._geometry.coords;let d=0;for(let a=this._pathOffset+p;a<b;a+=p){const n=c[a]-c[a-p],t=c[a+1]-c[a-p+1];d+=Math.sqrt(n*n+t*t)}return d}startPath(){this._geometry.lengths.push(0)}pushPath(b){this.startPath();
this.pushPoints(b)}pushPoint(b){for(let p=0;p<this._stride;++p)this._geometry.coords.push(b[p]);this._geometry.lengths[this.totalSize-1]++}pushXY(b,p){this._geometry.coords.push(b,p);this._geometry.lengths[this.totalSize-1]++}pushPoints(b){for(const p of b)for(let c=0;c<this._stride;++c)this._geometry.coords.push(p[c]);this._geometry.lengths[this.totalSize-1]+=b.length}pushCursor(b){b=b.asOptimized();this._geometry.coords.push(...b.coords);this._geometry.lengths.push(...b.lengths)}asOptimized(){const b=
this._geometry.clone();if(1!==this.yFactor)for(let p=1;p<b.coords.length;p+=this._stride)b.coords[p]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(b.lengths.length=0);return b}isClosed(){const b=this._geometry.coords,p=this._pathOffset,c=this._end-this._stride;for(let d=0;d<this._stride;d++)if(b[p+d]!==b[c+d])return!1;return!0}clone(){return(new k).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.coords.length/
this._stride}get pathSize(){const {lengths:b}=this._geometry;return 0>this._pathIndex||this._pathIndex>b.length-1?0:b[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(b){this._geometry.coords[this._pointOffset]=b}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(b){this._geometry.coords[this._pointOffset+1]=this.yFactor*b}get z(){return this._geometry.coords[this._pointOffset+2]}set z(b){this._geometry.coords[this._pointOffset+
2]=b}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(b){this._geometry.coords[this._pointOffset+3]=b}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class f extends m{initialize(b,p,c,d,a){this._paths=b;this.geometryType=p;this.hasZ=c;this.hasM=d;this._pathIndex=this._pointIndex=-1;this.yFactor=a;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(b){return 0<=b&&b<this.totalSize?
(this._pathIndex=b,this._pointIndex=-1,this._currentPath=this._paths[b],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(b){return 0<=b&&b<this._currentPath.length?(this._pointIndex=b,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=
this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){this._pointIndex=-1;this._currentPath=this._paths[--this._pathIndex];return 0<=this._pathIndex}pathLength(){const b=this._currentPath.length,p=this._currentPath;let c=0;for(let a=1;a<b;a++){var d=p[a-1];const n=p[a],t=n[0]-d[0];d=n[1]-d[1];c+=Math.sqrt(t*t+d*d)}return c}startPath(){this._paths.push([])}pushPath(b){this._paths.push(b)}pushPoint(b){this._paths[this.totalSize-
1].push(b)}pushXY(b,p){this._paths[this.totalSize-1].push([b,p])}pushPoints(b){this._paths[this.totalSize-1].push(...b)}pushCursor(b){b=x.collectMultipath(b);for(const p of b)this.pushPath(p)}asOptimized(){const b=new C;if("esriGeometryPoint"===this.geometryType)b.coords.push(...this._paths[0][0]),b.lengths.length=0;else for(const p of this._paths){for(const c of p)b.coords.push(c[0]),b.coords.push(c[1]*this.yFactor),this.hasZ&&b.coords.push(c[2]),this.hasM&&b.coords.push(c[this._mIndex]);b.lengths.push(p.length)}return b}isClosed(){const b=
this._currentPath[0],p=this._currentPath[this._currentPath.length-1];for(let c=0;c<b.length;c++)if(b[c]!==p[c])return!1;return!0}clone(){return(new f).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(b=>b.length).reduce((b,p)=>b+p)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(b){this._currentPoint[0]=
b}get y(){return this.yFactor*this._currentPoint[1]}set y(b){this._currentPoint[1]=this.yFactor*b}get z(){return this._currentPoint[2]}set z(b){this._currentPoint[2]=b}get m(){return this._currentPoint[this._mIndex]}set m(b){this._currentPoint[this._mIndex]=b}get pathIndex(){return this._pathIndex}}class e extends k{initialize(b,p,c,d,a){super.initialize(b,p,c,d,a);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(n=>new Set));return this}startPath(){super.startPath();
this._controlPoints.push(new Set)}clone(){const b=(new e).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);b._controlPoints=this._controlPoints;return b}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(b){this._controlPoints[this.pathIndex].add(b)}getControlPointAt(b){return this._controlPoints[this.pathIndex].has(b)}}class l extends f{initialize(b,
p,c,d,a){return super.initialize(b,p,c,d,a)}clone(){return(new l).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,1)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(b){this._paths[this.pathIndex][b][4]=1}getControlPointAt(b){return 1===this._paths[this.pathIndex][b][4]}}g.GeometryCursor=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),
function(g,q,x,w,C,r,m){function k(d,a){let n=0,t,v,y,h;for(a.reset();a.nextPath()&&a.nextPoint();)for(t=a.x,v=a.y;a.nextPoint();t=y,v=h)y=a.x,h=a.y,v>d[1]!==h>d[1]&&(0<(y-t)*(d[1]-v)-(h-v)*(d[0]-t)?n++:n--);return 0!==n}function f(d,a,n){if(n&&k(d,a))return{coord:d,distance:0};n=Infinity;let t=0,v=0;var y=[0,0];let h=[0,0];const A=[0,0];for(a.reset();a.nextPath()&&a.nextPoint();)if(!(2>a.pathSize))for(y[0]=a.x,y[1]=a.y;a.nextPoint();y=h)h=[a.x,a.y],r.projectPointOnLineSeg(A,d,y,h),y=b(d,A),y<n&&
(n=y,t=A[0],v=A[1]);return{coord:[t,v],distance:Math.sqrt(n)}}function e(d,a,n,t){n=[a,0];let v=Infinity,y=Infinity,h=!1,A=!1;a=[[a,t[1]-1],[a,t[3]+1]];t=[0,0];const E=[0,0],z=[0,0],F=[[0,0],[0,0]],D=x.create();for(d.reset();d.nextPath()&&d.nextPoint();)if(!(2>d.pathSize))for(F[0][0]=d.x,F[0][1]=d.y;d.nextPoint();F[0][0]=F[1][0],F[0][1]=F[1][1]){F[1][0]=d.x;F[1][1]=d.y;a:{var B=D;var u=F;if(2>u.length){B=null;break a}B||(B=x.create());const [G,I]=u[0],[J,M]=u[1];B[0]=Math.min(G,J);B[1]=Math.min(I,
M);B[2]=Math.max(G,J);B[3]=Math.max(I,M)}if(null!==B){E[0]=a[0][0];E[1]=a[0][1];z[0]=a[1][0];z[1]=a[1][1];a:{B=D;u=E;var H=z;let G=l(u,B),I=l(H,B);const J=B[0],M=B[1],R=B[2],Y=B[3];if(G&I){B=0;break a}if(!(G|I)){B=4;break a}const fa=(G?1:0)|(I?2:0);do{const O=H[0]-u[0],Q=H[1]-u[1];if(O>Q)G&3?(G&1?(u[1]+=Q*(J-u[0])/O,u[0]=J):(u[1]+=Q*(R-u[0])/O,u[0]=R),G=l(u,B)):I&3?(I&1?(H[1]+=Q*(J-H[0])/O,H[0]=J):(H[1]+=Q*(R-H[0])/O,H[0]=R),I=l(H,B)):G?(G&4?(u[0]+=O*(M-u[1])/Q,u[1]=M):(u[0]+=O*(Y-u[1])/Q,u[1]=Y),
G=l(u,B)):(I&4?(H[0]+=O*(M-H[1])/Q,H[1]=M):(H[0]+=O*(Y-H[1])/Q,H[1]=Y),I=l(H,B));else if(G&12?(G&4?(u[0]+=O*(M-u[1])/Q,u[1]=M):(u[0]+=O*(Y-u[1])/Q,u[1]=Y),G=l(u,B)):I&12?(I&4?(H[0]+=O*(M-H[1])/Q,H[1]=M):(H[0]+=O*(Y-H[1])/Q,H[1]=Y),I=l(H,B)):G?(G&1?(u[1]+=Q*(J-u[0])/O,u[0]=J):(u[1]+=Q*(R-u[0])/O,u[0]=R),G=l(u,B)):(I&1?(H[1]+=Q*(J-H[0])/O,H[0]=J):(H[1]+=Q*(R-H[0])/O,H[0]=R),I=l(H,B)),G&I){B=0;break a}}while(G|I);B=fa}0!==B&&m.segmentIntersects(a[0],a[1],F[0],F[1],t)&&(B=t[1],v>y?B<v&&(v=B,h=!0):B<y&&
(y=B,A=!0))}}h&&A?n[1]=(v+y)/2:n[0]=n[1]=NaN;return n}function l(d,a){return(d[0]<a[0]?1:0)|(d[0]>a[2]?1:0)<<1|(d[1]<a[1]?1:0)<<2|(d[1]>a[3]?1:0)<<3}function b(d,a){return(d[0]-a[0])*(d[0]-a[0])+(d[1]-a[1])*(d[1]-a[1])}function p(d,a){if(d<a)return-1;if(d>a)return 1;if(d===a)return 0;d=isNaN(d);a=isNaN(a);return d<a?-1:d>a?1:0}class c{constructor(d,a,n,t){this.x=d;this.y=a;this.cellSize=n;this.distancefromCellCenter=r.distanceFromPointToPolygon(d,a,t);this.maxDistanceToPolygon=this.distancefromCellCenter+
this.cellSize*Math.SQRT2}}g.getLabelPoint=function(d){if(0===d.totalSize)return null;var a=w.getCursorBoundsXY(d);if(!a)return null;var n=8.8818E-14*(Math.abs(a[0])+Math.abs(a[2])+Math.abs(a[1])+Math.abs(a[3])+1),t=0,v=0;d.reset();for(var y=0;d.nextPath();y++){var h=d.getCurrentRingArea();h>v&&(v=h,t=y)}d.seekPath(t);if(0===d.pathSize)return null;d.seekPathStart();h=w.getCursorPathBounds(d);if(Math.abs(v)<=2*n*n)return[(h[0]+h[2])/2,(h[1]+h[3])/2];d.seekPathStart();var A=C.ringCentroidCursorXY(d,
x.create());if(null===A)return null;if(4>d.totalPoints)return A;v=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];t=[NaN,NaN,NaN,NaN];y=[NaN,NaN,NaN,NaN];var E=!1,z=f(A,d,!0);0===z.distance&&(E=!0,v[0][0]=A[0],v[0][1]=A[1],z=f(A,d,!1));t[0]=z.distance;y[0]=0;var F=[NaN,NaN];let D=!1,B=.25,u=-1;z=NaN;do{z=NaN;var H=h[0];v[1]=e(d,H+(h[2]-H)*B,n,a);isNaN(v[1][0])||isNaN(v[1][1])||(z=f(v[1],d,!1),z=z.distance);if(!isNaN(z)&&z>n&&k(v[1],d))D=!0,t[1]=z,y[1]=b(v[1],A);else if(!isNaN(z)&&z>u&&(u=z,F[0]=v[1][0],
F[1]=v[1][1]),B-=.01,.1>B)if(0<=u)D=!0,t[1]=u,v[1][0]=F[0],v[1][1]=F[1],y[1]=b(v[1],A);else break}while(!D);D=!1;B=.5;u=-1;H=.01;let G=1;do{z=NaN;var I=h[0];v[2]=e(d,I+(h[2]-I)*B,n,a);isNaN(v[2][0])||isNaN(v[2][1])||(z=f(v[2],d,!1),z=z.distance);if(!isNaN(z)&&z>n&&k(v[2],d))D=!0,t[2]=z,y[2]=b(v[2],A);else if(!isNaN(z)&&z>u)u=z,F[0]=v[2][0],F[1]=v[2][1];else if(z>u&&(u=z,F[0]=v[2][0],F[1]=v[2][1]),B=.5+H*G,H+=.01,G*=-1,.3>B||.7<B)if(0<=u)D=!0,t[2]=u,v[2][0]=F[0],v[2][1]=F[1],y[2]=b(v[2],A);else break}while(!D);
D=!1;B=.75;u=-1;do if(z=NaN,H=h[0],v[3]=e(d,H+(h[2]-H)*B,n,a),isNaN(v[3][0])||isNaN(v[3][1])||(z=f(v[3],d,!1),z=z.distance),!isNaN(z)&&z>n&&k(v[3],d))D=!0,t[3]=z,y[3]=b(v[3],A);else if(z>u&&(u=z,F[0]=v[3][0],F[1]=v[3][1]),B+=.01,.9<B)if(0<=u)D=!0,t[3]=u,v[3][0]=F[0],v[3][1]=F[1],y[3]=b(v[3],A);else break;while(!D);d=[0,1,2,3];a=E?0:1;for(h=a;4>h;h++)for(E=a;3>E;E++)A=y[E],F=y[E+1],0<p(A,F)&&(n=d[E],d[E]=d[E+1],d[E+1]=n,y[E]=F,y[E+1]=A);y=a;for(h=n=0;4>a;a++){switch(a){case 0:h=2*t[d[a]];break;case 1:h=
1.66666666*t[d[a]];break;case 2:h=1.33333333*t[d[a]];break;case 3:h=t[d[a]]}h>n&&(n=h,y=d[a])}return v[y]};g.getPolylabelPoint=function(d){if(!d.nextPath()||!d.pathSize)return null;var a=w.getCursorPathBounds(d),n=a[2]-a[0],t=a[3]-a[1];if(0===n||0===t)return[a[0]+n/2,a[1]+t/2];const v=Math.max(Math.min(n,t)/100,1),y=new q((E,z)=>z.maxDistanceToPolygon-E.maxDistanceToPolygon);t=Math.min(n,t);n=t/2;let h=0,A=0;for(h=a[0];h<a[2];h+=t)for(A=a[1];A<a[3];A+=t)y.enqueue(new c(h+n,A+n,n,d));d.reset();d.nextPath();
a=C.ringsCentroidCursor(d);if(null===a)return null;for(a=new c(a[0],a[1],0,d);0<y.size;)t=y.dequeue(),t.distancefromCellCenter>a.distancefromCellCenter&&(a=t),t.maxDistanceToPolygon-a.distancefromCellCenter<=v||(n=t.cellSize/2,y.enqueue(new c(t.x-n,t.y-n,n,d)),y.enqueue(new c(t.x+n,t.y-n,n,d)),y.enqueue(new c(t.x-n,t.y+n,n,d)),y.enqueue(new c(t.x+n,t.y+n,n,d)));return[a.x,a.y]};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class g{constructor(x=
q){this._data=[];this._compare=x}get size(){return this._data.length}enqueue(x){if(null!=x){var {_data:w,_compare:C}=this;w.push(x);x=w.length-1>>>0;for(var r=w[x];0<x;){const m=x-1>>1,k=w[m];if(0>=C(k,r))w[m]=r,w[x]=k,x=m;else break}}}dequeue(){const {_data:x,_compare:w}=this,C=x[0];var r=x.pop();if(0===x.length)return C;x[0]=r;r=0;const m=x.length,k=x[0];let f;let e=null;for(;;){var l=2*r+1;const b=2*r+2;e=null;l<m&&(f=x[l],0<w(f,k)&&(e=l));b<m&&(l=x[b],null===e&&0>=w(l,k)||null!==e&&0>=w(l,f))&&
(e=b);if(null===e)break;x[r]=x[e];x[e]=k;r=e}return C}}const q=(x,w)=>x<w?-1:x>w?1:0;return g})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(g){class q{static fromBuffer(x,w){return new q(x,w)}static create(x,w=4294967295){x=new Uint32Array(Math.ceil(x/32));return new q(x,w)}constructor(x,w){this._mask=0;this._buf=x;this._mask=w}_getIndex(x){return Math.floor(x/32)}has(x){x&=this._mask;return!!(this._buf[this._getIndex(x)]&1<<x%32)}hasRange(x,w){for(;x%
32&&x!==w;){if(this.has(x))return!0;x++}for(;w%32&&x!==w;){if(this.has(x))return!0;w--}if(x===w)return!1;for(x/=32;x!==w/32;x++)if(this._buf[x])return!0;return!1}set(x){x&=this._mask;const w=this._getIndex(x);this._buf[w]|=1<<x%32}setRange(x,w){for(;x%32&&x!==w;)this.set(x++);for(;w%32&&x!==w;)this.set(w--);if(x!==w)for(x/=32;x!==w/32;x++)this._buf[x]=4294967295}unset(x){x&=this._mask;const w=this._getIndex(x);this._buf[w]&=4294967295^1<<x%32}resize(x){const w=this._buf;x=new Uint32Array(Math.ceil(x/
32));x.set(w);this._buf=x}or(x){for(let w=0;w<this._buf.length;w++)this._buf[w]|=x._buf[w];return this}and(x){for(let w=0;w<this._buf.length;w++)this._buf[w]&=x._buf[w];return this}xor(x){for(let w=0;w<this._buf.length;w++)this._buf[w]^=x._buf[w];return this}ior(x){for(let w=0;w<this._buf.length;w++)this._buf[w]|=~x._buf[w];return this}iand(x){for(let w=0;w<this._buf.length;w++)this._buf[w]&=~x._buf[w];return this}ixor(x){for(let w=0;w<this._buf.length;w++)this._buf[w]^=~x._buf[w];return this}any(){for(let x=
0;x<this._buf.length;x++)if(this._buf[x])return!0;return!1}copy(x){for(let w=0;w<this._buf.length;w++)this._buf[w]=x._buf[w];return this}clone(){return new q(this._buf.slice(),this._mask)}clear(){for(let x=0;x<this._buf.length;x++)this._buf[x]=0}forEachSet(x){for(let w=0;w<this._buf.length;w++){let C=this._buf[w],r=32*w;if(C)for(;C;)C&1&&x(r),C>>>=1,r++}}countSet(){let x=0;this.forEachSet(w=>{x++});return x}}g.StaticBitSet=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/createSource":function(){define("exports ../../../../../layers/support/arcgisLayerUrl ./DrillDownFeatureSource ./PagedFeatureSource ./SnapshotFeatureSource ./StreamSource".split(" "),
function(g,q,x,w,C,r){g.createSource=function(m,k,f,e,l,b,p){a:{switch(m.type){case "snapshot":m={type:"feature",origin:"snapshot",featureCount:m.featureCount??0,serviceInfo:m,onMessage:l,outSR:f,tileInfoView:e,canAcceptRequest:b,store:p,arcadeLayerSchema:k};break a;case "stream":m={type:"stream",serviceInfo:m,onMessage:l,outSR:f,canAcceptRequest:b,arcadeLayerSchema:k};break a;case "memory":case "on-demand":p=m.source;p=Array.isArray(p)?"local":"path"in p&&q.isHostedAgolService(p.path)?"hosted":"unknown";
m={type:"feature",serviceInfo:m,onMessage:l,outSR:f,origin:p,tileInfoView:e,canAcceptRequest:b,arcadeLayerSchema:k};break a}m=void 0}switch(m.type){case "feature":switch(m.origin){case "hosted":case "local":return new w.PagedFeatureSource(m);case "snapshot":return new C.SnapshotFeatureSource(m);default:case "unknown":return new x.DrillDownFeatureSource(m)}case "stream":return new r.StreamSource(m)}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/arcgisLayerUrl":function(){define(["exports",
"../../core/urlUtils","../../chunks/persistableUrlUtils"],function(g,q,x){function w(b){if(null==b)return null;b=q.urlToObject(b);b=b?.path.match(f)||b?.path.match(e);if(!b)return null;const [,p,c,d,a]=b;b=c.indexOf("/");return{title:r(-1!==b?c.slice(b+1):c),serverType:m[d.toLowerCase()],sublayer:null!=a&&""!==a?parseInt(a,10):null,url:{path:p}}}function C(b){return(b=q.urlToObject(b).path.match(l))?{serviceUrl:b[1],sublayerId:Number(b[2])}:null}function r(b){b=b.replaceAll(/\s*[/_]+\s*/g," ");return b[0].toUpperCase()+
b.slice(1)}const m={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},k=Object.values(m),f=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${k.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${k.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;g.cleanTitle=r;g.isArcGISUrl=
function(b){return!!f.test(b)};g.isHostedAgolService=function(b){if(!b)return!1;b=b.toLowerCase();const p=b.includes(".arcgis.com/");b=b.includes("//services")||b.includes("//tiles")||b.includes("//features");return p&&b};g.isServerOrServicesAGOLUrl=function(b){if(!b)return!1;b=(new q.Url(q.makeAbsolute(b))).authority?.toLowerCase();return"server.arcgisonline.com"===b||"services.arcgisonline.com"===b};g.isWmsServer=function(b){if(!b)return!1;var p=b.toLowerCase();b=p.includes("/services/");const c=
p.includes("/mapserver/wmsserver"),d=p.includes("/imageserver/wmsserver");p=p.includes("/wmsserver");return b&&(c||d||p)};g.parse=w;g.parseNonStandardSublayerUrl=C;g.sanitizeUrl=function(b,p){return b?q.removeTrailingSlash(q.removeQueryParameters(b,p)):b};g.sanitizeUrlWithLayerId=function(b){let {url:p}=b;if(!p)return{url:p};p=q.removeQueryParameters(p,b.logger);const c=q.urlToObject(p),d=w(c.path);let a=void 0;null!=d?(null!=d.sublayer&&null==b.layer.layerId&&(a=d.sublayer),p=d.url.path):b.nonStandardUrlAllowed&&
(b=C(c.path),null!=b&&(p=b.serviceUrl,a=b.sublayerId));return{url:q.removeTrailingSlash(p),layerId:a}};g.serverTypes=k;g.titleFromUrlAndName=function(b,p){const c=[];b&&(b=w(b),null!=b&&b.title&&c.push(b.title));p&&(p=r(p),c.push(p));if(2===c.length){if(c[0].toLowerCase().includes(c[1].toLowerCase()))return c[0];if(c[1].toLowerCase().includes(c[0].toLowerCase()))return c[1]}return c.join(" - ")};g.writeUrlWithLayerId=function(b,p,c,d,a){x.write(p,d,"url",a);d.url&&null!=b.layerId&&(d.url=q.join(d.url,
c,b.layerId.toString()))};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/persistableUrlUtils":function(){define(["exports","../core/urlUtils"],function(g,q){function x(c,d){var a=d?.url?.path;c&&a&&(c=q.makeAbsolute(c,a,{preserveProtocolRelative:!0}),d.portalItem&&d.readResourcePaths&&(a=q.makeRelative(c,d.portalItem.itemUrl),null!=a&&b.test(a)&&d.readResourcePaths.push(d.portalItem.resourceFromPath(a).path)));return e(c,d?.portal)}function w(c,d,a=g.MarkKeep.YES){if(null==
c)return c;!q.isAbsolute(c)&&d?.blockedRelativeUrls&&d.blockedRelativeUrls.push(c);let n=q.makeAbsolute(c);if(d){var t=d.verifyItemRelativeUrls?.rootPath||d.url?.path;if(t){t=e(t,d.portal);const v=e(n,d.portal);n=q.makeRelative(v,t,t);null!=n&&n!==v&&n!==c&&d.verifyItemRelativeUrls&&d.verifyItemRelativeUrls.writtenUrls.push(n)}}n=f(n,d?.portal);q.isAbsolute(n)&&(n=q.normalize(n));d?.resources&&d?.portalItem&&!q.isAbsolute(n)&&!q.isDataProtocol(n)&&a===g.MarkKeep.YES&&d.resources.toKeep.push({resource:d.portalItem.resourceFromPath(n),
compress:!1});return n}function C(c,d,a){return x(c,a)}function r(c,d,a,n){c=w(c,n);void 0!==c&&(d[a]=c)}function m(c){return(c?.match(l)??null)?.[1]??null}function k(c){c=c?.match(l)??null;if(null==c)return null;c=c[2];const d=c.lastIndexOf("/");if(-1===d){const {path:t,extension:v}=q.splitPathExtension(c);return{prefix:null,filename:t,extension:v}}const {path:a,extension:n}=q.splitPathExtension(c.slice(d+1));return{prefix:c.slice(0,d),filename:a,extension:n}}function f(c,d){return d&&!d.isPortal&&
d.urlKey&&d.customBaseUrl?q.changeDomain(c,`${d.urlKey}.${d.customBaseUrl}`,d.portalHostname):c}function e(c,d){if(!d||d.isPortal||!d.urlKey||!d.customBaseUrl)return c;const a=`${d.urlKey}.${d.customBaseUrl}`,n=q.getAppUrl();return q.hasSameOrigin(n,`${n.scheme}://${a}`)?q.changeDomain(c,d.portalHostname,a):q.changeDomain(c,a,d.portalHostname)}const l=/\/items\/([^\/]+)\/resources\/(.*)/,b=/^\.\/resources\//;g.MarkKeep=void 0;(function(c){c[c.YES=0]="YES";c[c.NO=1]="NO"})(g.MarkKeep||(g.MarkKeep=
{}));const p=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return g.MarkKeep},ensureMainOnlineDomain:f,fromJSON:x,itemIdFromResourceUrl:m,prefixAndFilenameFromResourceUrl:k,read:C,toJSON:w,write:r},Symbol.toStringTag,{value:"Module"}));g.ensureMainOnlineDomain=f;g.fromJSON=x;g.itemIdFromResourceUrl=m;g.persistableUrlUtils=p;g.prefixAndFilenameFromResourceUrl=k;g.read=C;g.toJSON=w;g.write=r})},"esri/views/2d/layers/features/sources/DrillDownFeatureSource":function(){define(["exports",
"../../../../../core/has","../../../../../core/promiseUtils","./BaseFeatureSource"],function(g,q,x,w){var C=(q=q("esri-mobile"))?1:4,r=q?1:3;class m extends w.BaseFeatureSource{constructor(k){super(k)}async _fetchDataTile(k){const f=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,e=this._subscriptions.get(k.key.id),l=e.signal,b=k.getQuantizationParameters();let p=0;const c=async(d,a)=>{const n=this._queryInfo,t=this.createTileQuery(d,{maxRecordCountFactor:f?r:void 0,returnExceededLimitFeatures:!1,
quantizationParameters:b});p++;try{const y=await this.enqueueQuery({tile:k,query:t,signal:l,depth:a});p--;x.throwIfAborted(l);if(y)if(n!==this._queryInfo)c(d,a);else if(y.exceededTransferLimit&&a<C)for(const h of d.createChildTiles())c(h,a+1);else{var v={id:k.id,addOrUpdate:y,end:0===p,type:"append"};e.add({query:t,message:v});this._onMessage(v)}}catch(y){x.isAbortError(y)||(d={id:k.id,addOrUpdate:null,end:!0,type:"append"},e.add({query:t,message:d}),this._onMessage(d))}};c(k,0)}}g.DrillDownFeatureSource=
m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/BaseFeatureSource":function(){define("exports ../../../../../request ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/promiseUtils ../controllers/support/sourceAdapters ./DataTileSource ../../../../support/QueueProcessor".split(" "),function(g,q,x,w,C,r,m,k,f){class e extends k.DataTileSource{constructor(l){super(l);this.type="feature";this.mode=
"on-demand";this._adapter=m.createSourceAdapter(l.serviceInfo);this._queue=new f.QueueProcessor({concurrency:8,process:async b=>{r.throwIfAborted(b);if(null!=b.tile){var p=b.tile.key.id,{signal:c}=b;p=w("esri-tiles-debug")?{tile:p.replaceAll("/","."),depth:b.depth}:void 0;c=await this._adapter.executeQuery(b.query,{signal:c,query:{...p,...this._schema?.customParameters}});c.level=b.tile.key.level;return c}return this._adapter.executeQuery(b.query,{...b,query:this._schema?.customParameters})}});this._patchQueue=
new f.QueueProcessor({concurrency:8,process:async b=>{r.throwIfAborted(b);if(null!=b.tile){var p=b.tile.key.id,{signal:c}=b;p=w("esri-tiles-debug")?{tile:p.replaceAll("/","."),depth:b.depth}:void 0;c=await this._adapter.executeQuery(b.query,{signal:c,query:{...p,...this._schema?.customParameters}});c.level=b.tile.key.level;return c}return this._adapter.executeQuery(b.query,{...b,query:this._schema?.customParameters})}})}destroy(){super.destroy();this._adapter.destroy();this._queue.destroy();this._patchQueue.destroy()}enqueueQuery(l,
b){return this.updatingHandles.addPromise(this._queue.push(l,b))}enqueuePatchQuery(l,b){return this.updatingHandles.addPromise(this._patchQueue.push(l,b))}get maxRecordCountFactor(){const {query:l}=this._serviceInfo.capabilities;return l.supportsMaxRecordCountFactor?4:null}get maxPageSize(){const {query:l}=this._serviceInfo.capabilities;return(l.maxRecordCount??8E3)*(this.maxRecordCountFactor??1)}get pageSize(){return Math.min(8E3,this.maxPageSize)}enableEvent(l,b){}subscribe(l,b){b=super.subscribe(l,
b);this._fetchDataTile(l).catch(p=>{r.isAbortError(p)||C.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource").error(new x("mapview-query-error","Encountered error when fetching tile",{tile:l,error:p}))});return b}unsubscribe(l){super.unsubscribe(l)}readers(l){return this._subscriptions.get(l).readers()}async query(l,b={}){return this._adapter.executeQuery(l,{...b,query:{...(b.query??{}),...this._schema?.customParameters}})}async queryLastEditDate(){const l=this._serviceInfo.source;
return(await q(l.path,{query:{...l.query,f:"json"},responseType:"json"})).data.editingInfo.lastEditDate}createTileQuery(l,b={}){const p=this._serviceInfo.geometryType,c=this.createQuery(b);c.quantizationParameters=b.quantizationParameters??l.getQuantizationParameters();c.resultType="tile";c.geometry=l.extent;if(this._serviceInfo.capabilities.query.supportsQuantization)"esriGeometryPolyline"===p&&(c.maxAllowableOffset=l.resolution*w("feature-polyline-generalization-factor"));else if("esriGeometryPolyline"===
p||"esriGeometryPolygon"===p)c.maxAllowableOffset=l.resolution,"esriGeometryPolyline"===p&&(c.maxAllowableOffset*=w("feature-polyline-generalization-factor"));l=this._serviceInfo.capabilities.query;c.defaultSpatialReferenceEnabled=l.supportsDefaultSpatialReference;c.compactGeometryEnabled=l.supportsCompactGeometry;return c}async _executePatchQuery(l,b,p,c){b=b.clone();b.outFields=[this._serviceInfo.objectIdField,...p];b.returnCentroid=!1;b.returnGeometry=!1;return await this.enqueuePatchQuery({tile:l,
query:b,signal:c.signal,depth:null!=b.start?b.start/8E3:0})}async _resend(l,b){const {query:p,message:c}=l,d=null!=p.outFields?p.outFields:[];l=this._queryInfo.outFields;const a=l.filter(n=>!d.includes(n));if(null==c.addOrUpdate)this._onMessage({...c,type:"append"});else if(a.length)try{const n=this._subscriptions.get(c.id).tile,t=await this._executePatchQuery(n,p,a,b);r.throwIfAborted(b);p.outFields=l;c.addOrUpdate.joinAttributes(t);this._onMessage({...c,end:c.end,type:"append"})}catch(n){}else this._onMessage({...c,
type:"append"})}async _resendSubscription(l){w("esri-2d-update-debug")&&console.debug(l.tile.id,"Resend Subscription");if(l.empty)return this._onMessage({id:l.tile.id,addOrUpdate:null,end:!1,type:"append"});const b=l.signal;for(const p of l.requests.done)await this._resend(p,{signal:b});if(null!=l.edits)return this._onMessage(l.edits)}async resend(){const l=Array.from(this._subscriptions.values());await Promise.all(l.map(b=>this._resendSubscription(b)))}}g.BaseFeatureSource=e;Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/controllers/support/sourceAdapters":function(){define("exports ../../../../../../core/has ../../../../../../core/workers/Connection ../../../../../../geometry/support/quantizationUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../layers/support/FieldsIndex ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),
function(g,q,x,w,C,r,m,k,f,e){async function l(n){const t=new x;await t.open(n,{});return t}class b{constructor(n){this.service=n;this._arcadeLayerSchema={...n,fieldsIndex:m.fromJSON(n.fieldsIndex)}}destroy(){}}class p extends b{constructor(n){super(n);this._portsOpen=l(n.source).then(t=>this.client=t)}destroy(){this.client.close();this.client=null}async executeQuery(n,t){await this._portsOpen;n=await this.client.invoke("queryFeatures",n.toJSON(),t);return f.FeatureSetReaderJSON.fromFeatureSet(n,
this._arcadeLayerSchema)}}class c extends b{async executeQuery(n,t){({data:t}=await k.executeQueryPBFBuffer(this.service.source,n,t));return e.FeatureSetReaderPBF.fromBuffer(t,this._arcadeLayerSchema,!n.quantizationParameters)}}class d extends b{async executeQuery(n,t){const {source:v,capabilities:y,spatialReference:h,objectIdField:A,geometryType:E}=this.service;if(null!=n.quantizationParameters&&!y.query.supportsQuantization){const z=n.clone();n=w.toQuantizationTransform(z.quantizationParameters);
z.quantizationParameters=null;({data:t}=await k.executeQuery(v,z,h,t));t=C.convertFromFeatureSet(t,A);C.quantizeOptimizedFeatureSet(n,t);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(t,this._arcadeLayerSchema)}({data:n}=await k.executeQuery(v,n,this.service.spatialReference,t));"esriGeometryPoint"===E&&(n.features=n.features?.filter(z=>null!=z.geometry?(z=z.geometry,Number.isFinite(z.x)&&Number.isFinite(z.y)):!0));return f.FeatureSetReaderJSON.fromFeatureSet(n,this._arcadeLayerSchema)}}class a extends b{async executeQuery(n,
t){var {capabilities:v}=this.service;if(n.quantizationParameters&&!v.query.supportsQuantization){const y=n.clone();v=w.toQuantizationTransform(y.quantizationParameters);y.quantizationParameters=null;n=await r.queryOptimizedFeatureSet(this.service.source,n,t);C.quantizeOptimizedFeatureSet(v,n);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(n,this._arcadeLayerSchema)}n=await r.queryOptimizedFeatureSet(this.service.source,n,t);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(n,this._arcadeLayerSchema)}}
g.SourceAdapter=b;g.createSourceAdapter=function(n){const {capabilities:t}=n;return"ogc-source"===n.source?.type?new a(n):Array.isArray(n.source)?new p(n):t.query.supportsFormatPBF&&q("featurelayer-pbf")?new c(n):new d(n)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define("../handleUtils ../Logger ../promiseUtils ../Queue ./connectionRegistry ./RemoteClient".split(" "),function(g,q,x,w,C,r){class m{constructor(){this._inUseClients=[];
this._clients=[];this._clientPromises=[];this._ongoingJobsQueue=new w}destroy(){this.close()}get closed(){return!this._clients?.length}open(k,f){return new Promise((e,l)=>{let b=!0;const p=c=>{x.throwIfAborted(f.signal);b&&(b=!1,c())};this._clients.length=k.length;this._clientPromises.length=k.length;this._inUseClients.length=k.length;for(let c=0;c<k.length;++c){const d=k[c];x.isPromiseLike(d)?this._clientPromises[c]=d.then(a=>{this._clients[c]=new r(a,f,this._ongoingJobsQueue);p(e);return this._clients[c]},
()=>{p(l);return null}):(this._clients[c]=new r(d,f,this._ongoingJobsQueue),this._clientPromises[c]=Promise.resolve(this._clients[c]),p(e))}})}broadcast(k,f,e){const l=Array(this._clientPromises.length);for(let b=0;b<this._clientPromises.length;++b)l[b]=this._clientPromises[b].then(p=>p?.invoke(k,f,e));return l}close(){let k;for(;k=this._ongoingJobsQueue.pop();)k.resolver.reject(x.createAbortError(`Worker closing, aborting job calling '${k.methodName}'`));for(const f of this._clientPromises)f.then(e=>
e?.close());this._clients.length=0;this._clientPromises.length=0;this._inUseClients.length=0;C.unregister(this)}invoke(k,f,e){let l;Array.isArray(e)?(q.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),l={transferList:e}):l=e;e=x.createResolver();this._ongoingJobsQueue.push({methodName:k,data:f,invokeOptions:l,resolver:e});for(k=0;k<this._clientPromises.length;k++)(f=this._clients[k])?f.jobAdded():this._clientPromises[k].then(b=>
b?.jobAdded());return e.promise}on(k,f){return Promise.all(this._clientPromises).then(()=>g.handlesGroup(this._clients.map(e=>e.on(k,f))))}openPorts(){return new Promise(k=>{const f=Array(this._clientPromises.length);let e=f.length;for(let l=0;l<this._clientPromises.length;++l)this._clientPromises[l].then(b=>{b&&(f[l]=b.openPort());0===--e&&k(f)})})}get test(){return{numClients:this._clients.length}}}return m})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],
function(g,q){class x{constructor(w=C=>C.values().next().value){this._peeker=w;this._observable=new q.SimpleObservable;this._items=new Set}get length(){g.trackAccess(this._observable);return this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0!==this.length){for(var w of this._items);return w}}peek(){if(0!==this.length)return this._peeker(this._items)}push(w){this.contains(w)||(this._items.add(w),this._observable.notify())}contains(w){g.trackAccess(this._observable);
return this._items.has(w)}pop(){if(0!==this.length){var w=this.peek();this._items.delete(w);this._observable.notify();return w}}popLast(){if(0!==this.length){var w=this.last();this._items.delete(w);this._observable.notify();return w}}remove(w){this.contains(w)&&(this._items.delete(w),this._observable.notify())}filter(w){const C=this.length;this._items.forEach(r=>{w(r)||this._items.delete(r)});C!==this._items.size&&this._observable.notify();return this}*[Symbol.iterator](){g.trackAccess(this._observable);
yield*this._items}}return x})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(g){const q=new FinalizationRegistry(x=>{x.close()});g.register=function(x,w){q.register(x,w,w)};g.unregister=function(x){q.unregister(x)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/ogc/ogcFeatureUtils":function(){define("exports ../../geometry ../../request ../../core/Error ../../core/Logger ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../graphics/featureConversionUtils ../graphics/OptimizedFeatureSet ../graphics/sources/geojson/geojson ../graphics/sources/support/clientSideDefaults ../support/FieldsIndex ../support/fieldType ../../time/timeZoneUtils ../../geometry/SpatialReference".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d){async function a(z,F,D){const {collection:B,layerDefinition:u,maxRecordCount:H,queryParameters:{apiKey:G,customParameters:I},spatialReference:J,supportedCrs:M}=z;({links:z}=B);var R=A(z,"items","application/geo+json")||A(z,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==R)throw new w("ogc-feature-layer:missing-items-page","Missing items url");const {geometry:Y,num:fa,start:O,timeExtent:Q,where:Z}=F;if(F.objectIds)throw new w("ogc-feature-layer:query-by-objectids-not-supported",
"Queries with objectids are not supported");z=d.fromJSON(J);F=F.outSpatialReference??z;z=F.isWGS84?null:n(F,M);var ba=y(Y,M);const da=v(Q);({data:R}=await x(R.href,{...D,query:{...I,...ba,crs:z,datetime:da,query:null!=Z&&Z&&"1\x3d1"!==Z?Z:null,limit:fa??(null!=O&&void 0!==O?10:H),startindex:O,token:G},headers:{accept:"application/geo+json"}}));D=!1;R.links&&(D=!!R.links.find(ra=>"next"===ra.rel));!D&&Number.isInteger(R.numberMatched)&&Number.isInteger(R.numberReturned)&&(D=R.numberReturned<R.numberMatched);
const {fields:P,geometryType:U,hasZ:ca,objectIdField:la}=u;R=e.createOptimizedFeatures(R,{geometryType:U,hasZ:ca,objectIdField:la});if(!z&&F.isWebMercator)for(var pa of R)null!=pa.geometry&&null!=U&&(ba=k.convertToGeometry(pa.geometry,U,ca,!1),ba.spatialReference=d.WGS84,pa.geometry=k.convertFromGeometry(m.project(ba,F)));for(var na of R)na.objectId=na.attributes[la];pa=z||!z&&F.isWebMercator?F.toJSON():r.WGS84;na=new f;na.exceededTransferLimit=D;na.features=R;na.fields=P;na.geometryType=U;na.hasZ=
ca;na.objectIdFieldName=la;na.spatialReference=pa;return na}function n(z,F){const {isWebMercator:D,wkid:B}=z;return B?(z=D?F[3857]??F[102100]??F[102113]??F[900913]:F[z.wkid])?`${"http://www.opengis.net/def/crs/"}${z}`:null:null}function t(z){if(null==z)return"";const {xmin:F,ymin:D,xmax:B,ymax:u}=z;return`${F},${D},${B},${u}`}function v(z){if(null==z)return null;const {start:F,end:D}=z;return`${null!=F?F.toISOString():".."}/${null!=D?D.toISOString():".."}`}function y(z,F){if(null==z||"extent"!==z.type)return null;
const {spatialReference:D}=z;if(!D||D.isWGS84)return{bbox:t(z)};F=n(D,F);return null!=F?{bbox:t(z),"bbox-crs":F}:D.isWebMercator?{bbox:t(m.project(z,d.WGS84))}:null}function h(z){z=z.extent?.spatial;if(!z)return null;var F=z.bbox[0],D=4===F.length;z=F[0];const B=F[1],u=D?void 0:F[2],H=D?F[2]:F[3],G=D?F[3]:F[4];F=D?void 0:F[5];D=d.WGS84.toJSON();return{xmin:z,ymin:B,xmax:H,ymax:G,zmin:u,zmax:F,spatialReference:D}}function A(z,F,D){return z.find(B=>B.rel===F&&B.type===D)||z.find(B=>B.rel===F&&!B.type)}
const E=C.getLogger("esri.layers.graphics.sources.ogcfeature");g.crsDefault="http://www.opengis.net/def/crs/OGC/1.3/CRS84";g.crsPrefix="http://www.opengis.net/def/crs/";g.getCollectionDefinition=async function(z,F,D={},B=5){var {links:u}=z;u=A(u,"items","application/geo+json")||A(u,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==u)throw new w("ogc-feature-layer:missing-items-page","Missing items url");({data:D}=await x(u.href,{signal:D.signal,query:{limit:B,...D.customParameters,
token:D.apiKey},headers:{accept:"application/geo+json"}}));e.validateGeoJSON(D);const H=e.inferLayerProperties(D,{geometryType:F.geometryType});D=F.fields||H.fields||[];B=null!=F.hasZ?F.hasZ:H.hasZ;u=H.geometryType;const G=F.objectIdField||H.objectIdFieldName||"OBJECTID";F=F.timeInfo;var I=D.find(({name:R})=>R===G);if(I)I.editable=!1,I.nullable=!1;else{if(!H.objectIdFieldType)throw new w("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");D.unshift({name:G,
alias:G,type:"number"===H.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}G!==H.objectIdFieldName&&(I=D.find(({name:R})=>R===H.objectIdFieldName))&&(I.type="esriFieldTypeInteger");D===H.fields&&0<H.unknownFields.length&&E.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:H.unknownFields}});for(var J of D){null==J.name&&(J.name=J.alias);null==J.alias&&(J.alias=
J.name);"esriFieldTypeOID"!==J.type&&"esriFieldTypeGlobalID"!==J.type&&(J.editable=null==J.editable||!!J.editable,J.nullable=null==J.nullable||!!J.nullable);if(!J.name)throw new w("ogc-feature-layer:invalid-field-name","field name is missing",{field:J});if(!p.kebabDict.jsonValues.includes(J.type))throw new w("ogc-feature-layer:invalid-field-type",`invalid type for field "${J.name}"`,{field:J});}if(F){var M;J=new b(D);F.startTimeField&&((I=J.get(F.startTimeField))?(F.startTimeField=I.name,I.type="esriFieldTypeDate"):
F.startTimeField=null);F.endTimeField&&((I=J.get(F.endTimeField))?(F.endTimeField=I.name,I.type="esriFieldTypeDate"):F.endTimeField=null);F.trackIdField&&((J=J.get(F.trackIdField))?F.trackIdField=J.name:(F.trackIdField=null,E.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:F}})));(M=F).timeReference||(M.timeReference={timeZoneIANA:c.utc});F.startTimeField||F.endTimeField||(E.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",
details:{timeInfo:F}}),F=null)}M=u?l.createDrawingInfo(u):null;z=h(z);return{drawingInfo:M,extent:z,geometryType:u,fields:D,hasZ:!!B,objectIdField:G,timeInfo:F}};g.getServerCollections=async function(z,F={}){({links:z}=z);z=A(z,"data","application/json")||A(z,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==z)throw new w("ogc-feature-layer:missing-collections-page","Missing collections url");const {apiKey:D,customParameters:B,signal:u}=F;({data:F}=await x(z.href,{signal:u,
headers:{accept:"application/json"},query:{...B,token:D}}));return F};g.getServerConformance=async function(z,F={}){({links:z}=z);z=A(z,"conformance","application/json")||A(z,"http://www.opengis.net/def/rel/ogc/1.0/conformance","application/json");if(null==z)throw new w("ogc-feature-layer:missing-conformance-page","Missing conformance url");const {apiKey:D,customParameters:B,signal:u}=F;({data:F}=await x(z.href,{signal:u,headers:{accept:"application/json"},query:{...B,token:D}}));return F};g.getServerLandingPage=
async function(z,F={}){const {apiKey:D,customParameters:B,signal:u}=F;({data:z}=await x(z,{signal:u,headers:{accept:"application/json"},query:{...B,token:D}}));return z};g.getServerOpenApi=async function(z,F={}){z=A(z.links,"service-desc","application/vnd.oai.openapi+json;version\x3d3.0");if(null==z)return E.warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const {apiKey:D,customParameters:B,signal:u}=F;({data:F}=await x(z.href,{signal:u,
headers:{accept:"application/vnd.oai.openapi+json;version\x3d3.0"},query:{...B,token:D}}));return F};g.getSpatialReferenceWkid=function(z){z=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(z)?.groups;if(!z)return null;const {authority:F,code:D}=z;switch(F.toLowerCase()){case "ogc":switch(D.toLowerCase()){case "crs27":return d.GCS_NAD_1927.wkid;case "crs83":return 4269;case "crs84":case "crs84h":return d.WGS84.wkid;default:return null}case "esri":case "epsg":return z=
Number.parseInt(D,10),Number.isNaN(z)?null:z;default:return null}};g.queryFeatureSetJSON=async function(z,F,D){z=await a(z,F,D);return k.convertToFeatureSet(z)};g.queryOptimizedFeatureSet=a;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define("exports ../../../../core/date ../../../../core/Error ../../../../geometry/support/spatialReferenceUtils ../../OptimizedFeature ../../OptimizedGeometry ../../../support/fieldUtils".split(" "),
function(g,q,x,w,C,r,m){function*k(h){switch(h.type){case "Feature":yield h;break;case "FeatureCollection":for(const A of h.features)A&&(yield A)}}function*f(h){if(h)switch(h.type){case "Point":yield h.coordinates;break;case "LineString":case "MultiPoint":yield*h.coordinates;break;case "MultiLineString":case "Polygon":for(const A of h.coordinates)yield*A;break;case "MultiPolygon":for(const A of h.coordinates)for(const E of A)yield*E}}function*e(h,A={}){const {geometryType:E,objectIdField:z}=A;for(const F of h){const {geometry:D,
properties:B,id:u}=F;if(D&&y[D.type]!==E)continue;h=B||{};let H=void 0;z&&(H=h[z],null==u||H||(h[z]=H=u));yield new C.OptimizedFeature(D?c(new r,D,A):null,h,null,H??void 0)}}function l(h){for(const A of h)if(2<A.length)return!0;return!1}function b(h){let A=0;for(let E=0;E<h.length;E++){const z=h[E],F=h[(E+1)%h.length];A+=z[0]*F[1]-F[0]*z[1]}return 0>=A}function p(h){const A=h[0],E=h[h.length-1];A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]||h.push(A);return h}function c(h,A,E){switch(A.type){case "LineString":return n(h,
A.coordinates,E),h;case "MultiLineString":for(const F of A.coordinates)n(h,F,E);return h;case "MultiPoint":return n(h,A.coordinates,E),h;case "MultiPolygon":for(var z of A.coordinates)for(d(h,z[0],E),A=1;A<z.length;A++)a(h,z[A],E);return h;case "Point":return v(h,A.coordinates,E),h;case "Polygon":z=A.coordinates;d(h,z[0],E);for(A=1;A<z.length;A++)a(h,z[A],E);return h}}function d(h,A,E){A=p(A);b(A)?n(h,A,E):t(h,A,E)}function a(h,A,E){A=p(A);b(A)?t(h,A,E):n(h,A,E)}function n(h,A,E){for(const z of A)v(h,
z,E);h.lengths.push(A.length)}function t(h,A,E){for(let z=A.length-1;0<=z;z--)v(h,A[z],E);h.lengths.push(A.length)}function v(h,A,E){const [z,F,D]=A;h.coords.push(z,F);E.hasZ&&h.coords.push(D||0)}const y={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};g.createOptimizedFeatures=function(h,A){return Array.from(e(k(h),A))};g.getGeometryType=function(h){return y[h]};
g.inferLayerProperties=function(h,A={}){const E=[];var z=new Set;const F=new Set;var D=!1;let B=null,u=!1,H=void 0;({geometryType:A=null}=A);var G=!1;for(const I of k(h)){const {geometry:J,properties:M,id:R}=I;if(J&&(A||(A=y[J.type]),y[J.type]!==A))continue;D||(D=f(J),D=l(D));!u&&(u=null!=R)&&(H=typeof R,M&&(B=Object.keys(M).filter(Y=>M[Y]===R)));M&&B&&u&&null!=R&&(1<B.length?B=B.filter(Y=>M[Y]===R):1===B.length&&(B=M[B[0]]===R?B:[]));if(!G&&M){h=!0;for(const Y in M){if(z.has(Y))continue;G=M[Y];if(null==
G){h=!1;F.add(Y);continue}a:switch(typeof G){case "string":G=q.isISO8601Date(G)?"esriFieldTypeDate":"esriFieldTypeString";break a;case "number":G="esriFieldTypeDouble";break a;default:G="unknown"}if("unknown"===G){F.add(Y);continue}F.delete(Y);z.add(Y);const fa=m.normalizeFieldName(Y);fa&&E.push({name:fa,alias:Y,type:G})}G=h}}if(z=m.normalizeFieldName(1===B?.length&&B[0]||null)??void 0)for(const I of E)if(I.name===z&&m.isNumericField(I)){I.type="esriFieldTypeOID";break}return{fields:E,geometryType:A,
hasZ:D,objectIdFieldName:z,objectIdFieldType:H,unknownFields:Array.from(F)}};g.validateGeoJSON=function(h,A=4326){if(!h)throw new x("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==h.type&&"FeatureCollection"!==h.type)throw new x("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:h});({crs:h}=h);if(h){var E="string"===typeof h?h:"name"===h.type?h.properties.name:"EPSG"===h.type?h.properties.code:null;A=w.isWGS84({wkid:A})?RegExp(".*(CRS84H?|4326)$",
"i"):new RegExp(`.*(${A})$`,"i");if(!E||!A.test(E))throw new x("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:h});}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(g){function q(m){const k=new Date(m);if(Number.isNaN(k.getTime()))m=!1;else{var f=!0;if(r&&/\d+\W*$/.test(m)&&(m=m.match(/[a-zA-Z]{2,}/))){f=!1;let e=0;for(;!f&&e<=m.length;)f=!C.test(m[e]),e++;f=!f}m=f}return m?Number.isNaN(k.getTime())?null:k.getTime()-
6E4*k.getTimezoneOffset():null}function x(m){m=w.exec(m);if(!m?.groups)return null;m=m.groups;const k=+m.year,f=+m.month-1,e=+m.day,l=+(m.hours??0),b=+(m.minutes??0),p=+(m.seconds??0);if(23<l||59<b||59<p)return null;var c=m.ms??"0";c=c?+c.padEnd(3,"0").substring(0,3):0;m=m.isUTC||!m.offsetSign?Date.UTC(k,f,e,l,b,p,c):6E4*("+"===m.offsetSign?-1:1)*(60*+m.offsetHours+ +m.offsetMinutes)+Date.UTC(k,f,e,l,b,p,c);return Number.isNaN(m)?null:m}const w=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,
C=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,r=!Number.isNaN((new Date("technology 10")).getTime());g.isDateString=function(m){return null!=x(m)||null!=q(m)};g.isISO8601Date=function(m){return w.test(m)};g.parseDate=function(m){return x(m)??q(m)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define(["exports",
"../../../../core/has","../../../../core/lang","../../data/QueryEngineCapabilities","../../../../symbols/support/defaultsJSON"],function(g,q,x,w,C){const r=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let m=1;g.createCapabilities=function(k,f){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:k},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:f,supportsDelete:f,
supportsEditing:f,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:f,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:w.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:f,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,
supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}};g.createDefaultAttributesFunction=function(k,f){if(q("esri-csp-restrictions"))return()=>({[f]:null,...k});try{let e=`this.${f} = null;`;for(const b in k){const p=r.test(b)?`.${b}`:`["${b}"]`;e+=`this${p} = ${JSON.stringify(k[b])};`}const l=(new Function(`\n      return class AttributesClass$${m++} {\n        constructor() {\n          ${e};\n        }\n      }\n    `))();
return()=>new l}catch(e){return()=>({[f]:null,...k})}};g.createDefaultTemplate=function(k={}){return[{name:"New Feature",description:"",prototype:{attributes:x.clone(k)}}]};g.createDrawingInfo=function(k){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===k||"esriGeometryMultipoint"===k?C.defaultPointSymbolJSON:"esriGeometryPolyline"===k?C.defaultPolylineSymbolJSON:C.defaultPolygonSymbolJSON}}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],
function(g){const q=[252,146,31,255],x={type:"esriSMS",style:"esriSMSCircle",size:6,color:q,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},w={type:"esriSLS",style:"esriSLSSolid",width:.75,color:q};g.defaultColor=q;g.defaultOutlineColor=[153,153,153,255];g.defaultPointSymbolJSON=x;g.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}};g.defaultPolylineSymbolJSON=
w;g.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0};g.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5};g.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null};g.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",
color:[0,0,0,255],width:1.5};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define("exports ../../../request ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../operations/urlUtils ./pbfQueryUtils ./queryZScale".split(" "),function(g,q,x,w,C,r,m,k,f){function e(c,d){if(d&&"extent"===c.type)return`${c.xmin},${c.ymin},${c.xmax},${c.ymax}`;
if(d&&"point"===c.type)return`${c.x},${c.y}`;c=c.toJSON();delete c.spatialReference;return JSON.stringify(c)}function l(c,d){const a=c.geometry,n=c.toJSON();delete n.compactGeometryEnabled;delete n.defaultSpatialReferenceEnabled;let t,v,y;null!=a&&(v=a.spatialReference,y=r.srToRESTValue(v),n.geometryType=w.getJsonType(a),n.geometry=e(a,c.compactGeometryEnabled),n.inSR=y);n.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(","));n.objectIds&&(n.objectIds=n.objectIds.join(","));
n.orderByFields&&(n.orderByFields=n.orderByFields.join(","));!n.outFields||!n.returnDistinctValues&&(d?.returnCountOnly||d?.returnExtentOnly||d?.returnIdsOnly)?delete n.outFields:n.outFields.includes("*")?n.outFields="*":n.outFields=n.outFields.join(",");n.outSR?(n.outSR=r.srToRESTValue(n.outSR),t=c.outSpatialReference):a&&(n.returnGeometry||n.returnCentroid)&&(n.outSR=n.inSR,t=v);n.returnGeometry&&delete n.returnGeometry;n.outStatistics&&(n.outStatistics=JSON.stringify(n.outStatistics));n.fullText&&
(n.fullText=JSON.stringify(n.fullText));n.pixelSize&&(n.pixelSize=JSON.stringify(n.pixelSize));n.quantizationParameters&&(c.defaultSpatialReferenceEnabled&&null!=v&&null!=c.quantizationParameters?.extent&&v.equals(c.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(n.quantizationParameters));n.parameterValues&&(n.parameterValues=JSON.stringify(n.parameterValues));n.rangeValues&&(n.rangeValues=JSON.stringify(n.rangeValues));
n.dynamicDataSource&&(n.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource);if(n.timeExtent){const {start:h,end:A}=n.timeExtent;if(null!=h||null!=A)n.time=h===A?h:`${null==h?"null":h},${null==A?"null":A}`;delete n.timeExtent}c.defaultSpatialReferenceEnabled&&null!=v&&null!=t&&v.equals(t)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR);return n}function b(c,d,a){return p(c,d,"pbf",a)}async function p(c,d,a,n={},t={}){c="string"===typeof c?x.urlToObject(c):c;var v=(await C.normalizeCentralMeridian(d.geometry?
[d.geometry]:[],null,{signal:n.signal}))?.[0];null!=v&&(d=d.clone(),d.geometry=v);v=m.mapParameters({...c.query,f:a,...t,...l(d,t)});return q(x.join(c.path,null==d.formatOf3DObjects||t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly?"query":"query3d"),{...n,responseType:"pbf"===a?"array-buffer":"json",query:{...v,...n.query}})}g.encodeGeometry=e;g.executeQuery=async function(c,d,a,n){c=null!=d.timeExtent&&d.timeExtent.isEmpty?{data:{features:[]}}:await p(c,d,"json",n);f.applyFeatureSetZUnitScaling(d,
a,c.data);return c};g.executeQueryForCount=function(c,d,a){return null!=d.timeExtent&&d.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):p(c,d,"json",a,{returnIdsOnly:!0,returnCountOnly:!0})};g.executeQueryForExtent=async function(c,d,a){if(null!=d.timeExtent&&d.timeExtent.isEmpty)return{data:{count:0,extent:null}};c=await p(c,d,"json",a,{returnExtentOnly:!0,returnCountOnly:!0});d=c.data;if(d.hasOwnProperty("extent"))return c;if(d.features)throw Error("Layer does not support extent calculation.");
if(d.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");return c};g.executeQueryForIds=function(c,d,a){return null!=d.timeExtent&&d.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):p(c,d,"json",a,{returnIdsOnly:!0})};g.executeQueryPBF=async function(c,d,a,n){if(null!=d.timeExtent&&d.timeExtent.isEmpty)return{data:a.createFeatureResult()};c=await b(c,d,n);c.data=k.parsePBFFeatureQuery(c.data,a);return c};g.executeQueryPBFBuffer=b;g.queryToQueryStringParameters=
l;g.runQuery=p;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(g){function q(x){const w={};for(const C in x){if("declaredClass"===C)continue;const r=x[C];if(null!=r&&"function"!==typeof r)if(Array.isArray(r)){w[C]=[];for(let m=0;m<r.length;m++)w[C][m]=q(r[m])}else"object"===typeof r?r.toJSON&&(w[C]=JSON.stringify(r)):w[C]=r}return w}g.mapParameters=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(g,q){g.parsePBFFeatureQuery=function(x,w){var C=q.parseFeatureQuery(x,w);x=C.queryResult.featureResult;w=C.queryResult.queryGeometry;C=C.queryResult.queryGeometryType;if(x&&x.features&&x.features.length&&x.objectIdFieldName){const r=x.objectIdFieldName;for(const m of x.features)m.attributes&&(m.objectId=m.attributes[r])}x&&(x.queryGeometry=w,x.queryGeometryType=C);return x};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(g,q,x,w,C){function r(z){return z>=h.length?null:h[z]}function m(z,F,D){z=z.asUnsafe();for(D=F.createPointGeometry(D);z.next();)switch(z.tag()){case 3:var B=z.getUInt32();B=z.pos()+B;let u=0;for(;z.pos()<B;)F.addCoordinatePoint(D,z.getSInt64(),u++);break;
default:z.skip()}return D}function k(z,F,D){z=z.asUnsafe();const B=F.createGeometry(D);for(D=2+(D.hasZ?1:0)+(D.hasM?1:0);z.next();)switch(z.tag()){case 2:var u=z.getUInt32();u=z.pos()+u;for(var H=0;z.pos()<u;)F.addLength(B,z.getUInt32(),H++);break;case 3:u=z.getUInt32();u=z.pos()+u;H=0;for(F.allocateCoordinates(B);z.pos()<u;)F.addCoordinate(B,z.getSInt64(),H),H++,H===D&&(H=0);break;default:z.skip()}return B}function f(z){z=z.asUnsafe();const F=new w;let D="esriGeometryPoint";for(;z.next();)switch(z.tag()){case 2:var B=
z.getUInt32();for(B=z.pos()+B;z.pos()<B;)F.lengths.push(z.getUInt32());break;case 3:B=z.getUInt32();for(B=z.pos()+B;z.pos()<B;)F.coords.push(z.getSInt64());break;case 1:D=C.optimizedGeometryTypes[z.getEnum()];break;default:z.skip()}return{queryGeometry:F,queryGeometryType:D}}function e(z){for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();case 3:return z.getDouble();case 4:return z.getSInt32();case 5:return z.getUInt32();case 6:return z.getInt64();
case 7:return z.getUInt64();case 8:return z.getSInt64();case 9:return z.getBool();default:return z.skip(),null}return null}function l(z){z=z.asUnsafe();const F={type:r(0)};for(;z.next();)switch(z.tag()){case 1:F.name=z.getString();break;case 2:F.type=r(z.getEnum());break;case 3:F.alias=z.getString();break;case 4:var D=z.getEnum();D=D>=A.length?null:A[D];F.sqlType=D;break;case 5:z.skip();break;case 6:F.defaultValue=z.getString();break;default:z.skip()}return F}function b(z){const F={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:F.name=
z.getString();break;case 2:F.isSystemMaintained=z.getBool();break;default:z.skip()}return F}function p(z,F,D,B){const u=F.createFeature(D);let H=0;for(;z.next();)switch(z.tag()){case 1:const G=B[H++].name;u.attributes[G]=z.processMessage(e);break;case 2:u.geometry=z.processMessageWithArgs(k,F,D);break;case 4:u.centroid=z.processMessageWithArgs(m,F,D);break;default:z.skip()}return u}function c(z){const F=[1,1,1,1];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:F[0]=z.getDouble();break;case 2:F[1]=
z.getDouble();break;case 4:F[2]=z.getDouble();break;case 3:F[3]=z.getDouble();break;default:z.skip()}return F}function d(z){const F=[0,0,0,0];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:F[0]=z.getDouble();break;case 2:F[1]=z.getDouble();break;case 4:F[2]=z.getDouble();break;case 3:F[3]=z.getDouble();break;default:z.skip()}return F}function a(z){const F={originPosition:0>=E.length?null:E[0]};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:var D=z.getEnum();F.originPosition=D>=E.length?
null:E[D];break;case 2:F.scale=z.processMessage(c);break;case 3:F.translate=z.processMessage(d);break;default:z.skip()}return F}function n(z){const F={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:F.shapeAreaFieldName=z.getString();break;case 2:F.shapeLengthFieldName=z.getString();break;case 3:F.units=z.getString();break;default:z.skip()}return F}function t(z,F){for(F=F.createSpatialReference();z.next();)switch(z.tag()){case 1:F.wkid=z.getUInt32();break;case 5:F.wkt=z.getString();break;case 2:F.latestWkid=
z.getUInt32();break;case 3:F.vcsWkid=z.getUInt32();break;case 4:F.latestVcsWkid=z.getUInt32();break;default:z.skip()}return F}function v(z,F){const D=F.createFeatureResult();z=z.asUnsafe();D.geometryType=0>=F.geometryTypes.length?null:F.geometryTypes[0];let B=!1;for(;z.next();)switch(z.tag()){case 1:D.objectIdFieldName=z.getString();break;case 3:D.globalIdFieldName=z.getString();break;case 4:D.geohashFieldName=z.getString();break;case 5:D.geometryProperties=z.processMessage(n);break;case 7:var u=
z.getEnum();D.geometryType=u>=F.geometryTypes.length?null:F.geometryTypes[u];break;case 8:D.spatialReference=z.processMessageWithArgs(t,F);break;case 10:D.hasZ=z.getBool();break;case 11:D.hasM=z.getBool();break;case 12:D.transform=z.processMessage(a);break;case 9:D.exceededTransferLimit=z.getBool();break;case 13:F.addField(D,z.processMessage(l));break;case 15:B||(F.prepareFeatures(D),B=!0);F.addFeature(D,z.processMessageWithArgs(p,F,D,D.fields));break;case 2:D.uniqueIdField=z.processMessage(b);break;
default:z.skip()}F.finishFeatureResult(D);return D}function y(z,F){const D={};let B=null;for(;z.next();)switch(z.tag()){case 4:B=z.processMessageWithArgs(f);break;case 1:D.featureResult=z.processMessageWithArgs(v,F);break;default:z.skip()}null!=B&&D.featureResult&&F.addQueryGeometry(D,B);return D}const h="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeBigInteger esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "),
A="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),E=["upperLeft","lowerLeft"];g.parseFeatureQuery=function(z,F){try{const D=new x(new Uint8Array(z),new DataView(z));
for(z={};D.next();)switch(D.tag()){case 2:z.queryResult=D.processMessageWithArgs(y,F);break;default:D.skip()}return z}catch(D){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:D});}};g.parseField=l;g.parseFieldType=r;g.parseTransform=a;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define("exports ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/OptimizedFeature ../../../layers/graphics/OptimizedFeatureSet ../../../layers/graphics/OptimizedGeometry".split(" "),
function(g,q,x,w,C,r){const m=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class k{constructor(f){this._options=f;this.geometryTypes=m;this._vertexDimension=this._coordinatePtr=0}createFeatureResult(){return new C}prepareFeatures(f){this._vertexDimension=2;f.hasZ&&this._vertexDimension++;f.hasM&&this._vertexDimension++}finishFeatureResult(f){if(f?.features&&f.hasZ&&this._options.sourceSpatialReference&&f.spatialReference&&!x.equals(f.spatialReference,
this._options.sourceSpatialReference)&&!f.spatialReference.vcsWkid){var e=q.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference),l=q.getMetersPerVerticalUnitForSR(f.spatialReference);e/=l;if(1!==e)for(const b of f.features)if(w.hasGeometry(b))for(f=b.geometry.coords,l=2;l<f.length;l+=3)f[l]*=e}}addFeature(f,e){f.features.push(e)}createFeature(){return new w.OptimizedFeature}createSpatialReference(){return{wkid:0}}createGeometry(){return new r}addField(f,e){f.fields.push(e)}allocateCoordinates(f){f.coords.length=
f.lengths.reduce((e,l)=>e+l,0)*this._vertexDimension;this._coordinatePtr=0}addCoordinate(f,e){f.coords[this._coordinatePtr++]=e}addCoordinatePoint(f,e){f.coords.push(e)}addLength(f,e){f.lengths.push(e)}addQueryGeometry(f,e){f.queryGeometry=e.queryGeometry;f.queryGeometryType=e.queryGeometryType}createPointGeometry(){return new r}}g.OptimizedFeatureSetParserContext=k;g.optimizedGeometryTypes=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports",
"../../../geometry/support/zscale"],function(g,q){g.applyFeatureSetZUnitScaling=function(x,w,C){if(C?.features&&C.hasZ&&(x=q.getGeometryZScaler(C.geometryType,w,x.outSpatialReference),null!=x))for(const r of C.features)x(r.geometry)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex",
"./FeatureSetReader"],function(g,q,x,w,C){function r({coords:k,lengths:f}){let e=0;for(const l of f){for(f=1;f<l;f++)k[2*(e+f)]+=k[2*(e+f)-2],k[2*(e+f)+1]+=k[2*(e+f)-1];e+=l}}class m extends C.FeatureSetReader{static fromFeatures(k,f){const {objectIdField:e,geometryType:l}=f,b=q.convertFromFeatures([],k,l,!1,!1,e);for(let p=0;p<b.length;p++)b[p].displayId=k[p].displayId;return m.fromOptimizedFeatures(b,f)}static fromFeatureSet(k,f){k=q.convertFromFeatureSet(k,f.objectIdField);return m.fromOptimizedFeatureSet(k,
f)}static fromOptimizedFeatureSet(k,f){var {features:e}=k;e=m.fromOptimizedFeatures(e,f);e._exceededTransferLimit=k.exceededTransferLimit;e._transform=k.transform;e._fieldsIndex=new w(f.fields);return e}static fromOptimizedFeatures(k,f,e){const l=C.FeatureSetReader.createInstance();k=new m(l,k,f);k._fieldsIndex=new w(f.fields);k._transform=e;return k}constructor(k,f,e){super(k,e);this._exceededTransferLimit=!1;this._featureIndex=-1;this._fieldsIndex=null;this._geometryType=e?.geometryType;this._features=
f}get fields(){return this._fieldsIndex}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(k){const f=new Set(k);this._features=this._features.filter(e=>!(null!=e.objectId&&f.has(e.objectId)))}append(k){for(const f of k)this._features.push(f)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let k=
"";for(const f in this._current.attributes)k+=this._current.attributes[f];return k}getIndex(){return this._featureIndex}setIndex(k){this._featureIndex=k}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(k){this._current.displayId=k}getGroupId(){return this._current.groupId}setGroupId(k){this._current.groupId=k}copy(){const k=new m(this.instance,this._features,this.fullSchema());this.copyInto(k);return k}next(){for(;++this._featureIndex<this._features.length&&
!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return q.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const k=this.readUnquantizedGeometry();return q.convertToGeometry(k,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const k=this.readCentroid();return null==k?null:{x:k.coords[0]*
this._sx+this._tx,y:k.coords[1]*this._sy+this._ty}}readGeometryArea(){return x.hasGeometry(this._current)?q.getQuantizedArea(this._current.geometry,2):0}readUnquantizedGeometry(){var k=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!k)return k;k=k.clone();r(k);return k}readHydratedGeometry(){var k=this._current.geometry;if(null==k)return null;k=k.clone();null!=this._transform&&q.unquantizeOptimizedGeometry(k,k,this.hasZ,this.hasM,this._transform);return k}getXHydrated(){if(!x.hasGeometry(this._current))return 0;
const k=this._current.geometry.coords[0],f=this.getQuantizationTransform();return null==f?k:k*f.scale[0]+f.translate[0]}getYHydrated(){if(!x.hasGeometry(this._current))return 0;const k=this._current.geometry.coords[1],f=this.getQuantizationTransform();return null==f?k:f.translate[1]-k*f.scale[1]}getX(){return x.hasGeometry(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return x.hasGeometry(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!x.hasGeometry(this._current)){if(null!=
this._current.centroid){const [e,l]=this._current.centroid.coords;return this.createQuantizedExtrudedGeometry(e,l)}return null}const k=this._current.geometry.clone();if(k.isPoint)return k.coords[0]=k.coords[0]*this._sx+this._tx,k.coords[1]=k.coords[1]*this._sy+this._ty,k;let f=0;for(const e of k.lengths)k.coords[2*f]=k.coords[2*f]*this._sx+this._tx,k.coords[2*f+1]=k.coords[2*f+1]*this._sy+this._ty,f+=e;return k}readCentroid(){return x.hasGeometry(this._current)?this._computeCentroid():this._current.centroid}_readAttribute(k,
f){var e=this._fieldsIndex.get(k);if(e){e=this._current.attributes[e.name];if(null==e)return e;"esriFieldTypeTimestampOffset"===this.fields.get(k)?.type&&(e=this.parseTimestampOffset(e));return f&&this.fields.isDateField(k)?new Date(e):e}}copyInto(k){super.copyInto(k);k._featureIndex=this._featureIndex;k._transform=this._transform;k._fieldsIndex=this._fieldsIndex}_readAttributes(){return this._current.attributes}}g.FeatureSetReaderJSON=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/FeatureSetReaderPBF":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/pbf ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ./FeatureSetReader ./FeatureSetReaderPBFHeader".split(" "),function(g,q,x,w,C,r,m,k,f,e){function l(a){if(a<=c.small.delta.length)return c.small;if(a<=c.large.delta.length)return c.large;
c.large.delta=new Int32Array(Math.round(1.25*a));c.large.decoded=new Int32Array(Math.round(1.25*a));return c.large}function b(a){var n=a.getLength();for(n=a.pos()+n;a.pos()<n&&a.next();)switch(a.tag()){case 1:return a.getString();case 2:return a.getFloat();case 3:return a.getDouble();case 4:return a.getSInt32();case 5:return a.getUInt32();case 6:return a.getInt64();case 7:return a.getUInt64();case 8:return a.getSInt64();case 9:return a.getBool();default:return a.skip(),null}return null}function p(a,
n,t,v){return 0===a*v-t*n&&0<a*t+n*v}const c={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(128E3),decoded:new Int32Array(128E3)}};class d extends f.FeatureSetReader{static fromBuffer(a,n,t=!1){var v=n.geometryType;a:{try{const A=new C(new Uint8Array(a),new DataView(a));for(;A.next();)switch(A.tag()){case 2:b:{for(var y=A.getMessage();y.next();)switch(y.tag()){case 1:var h=y.getMessage();break b;default:y.skip()}h=null}break a;default:A.skip()}}catch(A){a=
new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:A}),x.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(a)}h=null}a=h;t=e.parseHeader(a,"esriGeometryPoint"===v,t);v=f.FeatureSetReader.createInstance();return new d(v,a,t,n)}constructor(a,n,t,v){super(a,v);this._isPoints=this._hasNext=!1;this._featureIndex=-1;this._featureOffset=0;this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0};
this._geometryType=v.geometryType;this._reader=n;this._header=t;this._hasNext=t.hasFeatures;this._isPoints="esriGeometryPoint"===v.geometryType}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get _size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(a){this._cache.area=
0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;this._cache.optFeature=void 0;this._featureIndex=a}getAttributeHash(){let a="";for(const n of this._header.fields.fields)a+=this._readAttributeAtIndex(n.index)+".";return a}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(a){this._header.displayIds[this._featureIndex]=
a}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(a){this._header.groupIds[this._featureIndex]=a}readLegacyFeature(){if(void 0===this._cache.legacyFeature){var a=this.readCentroid();a={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:(a&&{x:a.coords[0],y:a.coords[1]})??null};return this._cache.legacyFeature=a}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){const a=
new m.OptimizedFeature(this.readGeometry(),this.readAttributes(),this.readCentroid());a.objectId=this.getObjectId();a.displayId=this.getDisplayId();return this._cache.optFeature=a}return this._cache.optFeature}getXHydrated(){const a=this._header.centroid[2*this._featureIndex],n=this.getQuantizationTransform();return null==n?a:a*n.scale[0]+n.translate[0]}getYHydrated(){const a=this._header.centroid[2*this._featureIndex+1],n=this.getQuantizationTransform();return null==n?a:n.translate[1]-a*n.scale[1]}getX(){return this._header.centroid[2*
this._featureIndex]*this._sx+this._tx}getY(){return this._header.centroid[2*this._featureIndex+1]*this._sy+this._ty}readLegacyPointGeometry(){const a=this.getX(),n=this.getY();return{x:a,y:n}}readLegacyGeometry(a){a=this.readUnquantizedGeometry(a);return r.convertToGeometry(a,this.geometryType,!1,!1)}readLegacyCentroid(){const a=this.readCentroid();if(!a)return null;const [n,t]=a.coords;return{x:n,y:t}}readGeometryArea(){this._cache.area||this.readGeometry(!0);return this._cache.area}readUnquantizedGeometry(a=
!1){if(void 0===this._cache.unquantGeometry){a=this.readGeometry(a);if(!a)return this._cache.unquantGeometry=void 0,null;var n=l(a.coords.length).decoded;a=a.clone(n);n=a.coords;let t=0;for(const v of a.lengths){for(let y=1;y<v;y++){const h=2*(t+y),A=2*(t+y-1);n[h]+=n[A];n[h+1]+=n[A+1]}t+=v}return this._cache.unquantGeometry=a}return this._cache.unquantGeometry}readHydratedGeometry(){if(this._isPoints){if(268435455===this._header.centroid[2*this._featureIndex])return null;var a=this.getXHydrated(),
n=this.getYHydrated();return new k([],[a,n])}a=this.readGeometry();if(!a)return null;a=a.clone();n=this.getQuantizationTransform();null!=n&&r.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,n);return a}readGeometry(a=!1){if(void 0===this._cache.geometry){var n=null;if(this._isPoints){if(268435455===this._header.centroid[2*this._featureIndex])return null;a=this.getX();n=this.getY();n=new k([],[a,n])}else{const t=this._header.offsets.geometry[this._featureIndex],v=this._reader;if(0===t){a=this._readServerCentroid();
if(!a)return null;const [y,h]=a.coords;return this.createQuantizedExtrudedGeometry(y,h)}v.move(t);try{if(n=a?this._parseGeometryForDisplay(v):this._parseGeometry(v),!n){const y=this._readServerCentroid();if(!y)return null;const [h,A]=y.coords;return this.createQuantizedExtrudedGeometry(h,A)}}catch(y){return console.error("Failed to parse geometry!",y),null}}return this._cache.geometry=n}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){let a=void 0;(a=this._computeCentroid())||
(a=this._readServerCentroid());this._cache.centroid=a??void 0;return a??null}return this._cache.centroid}copy(){var a=this._reader.clone();a=new d(this.instance,a,this._header,this.fullSchema());this.copyInto(a);return a}next(){this._cache.area=0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;for(this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readAttribute(a,
n){const t=this._header.fields.get(a);if(null!=t){var v=this._readAttributeAtIndex(t.index);"esriFieldTypeTimestampOffset"===this.fields.get(a)?.type&&(v=this.parseTimestampOffset(v));a=this._header.fields.isDateField(t.name);return n&&null!=v?a?new Date(v):v:v}}_readAttributes(){const a={};for(const n of this._header.fields.fields)a[n.name]=this._readAttributeAtIndex(n.index);return a}copyInto(a){super.copyInto(a);a._featureIndex=this._featureIndex;a._featureOffset=this._featureOffset;a._hasNext=
this._hasNext}_readAttributeAtIndex(a){const n=this._reader;n.move(this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+a]);return b(n)}_readServerCentroid(){const a=this._header.centroid[2*this._featureIndex]+this._tx;return 268435455===a?null:new k([],[a,this._header.centroid[2*this._featureIndex+1]+this._ty])}_parseGeometry(a){a=a.asUnsafe();var n=a.getLength();n=a.pos()+n;const t=[],v=[];for(;a.pos()<n&&a.next();)switch(a.tag()){case 2:var y=a.getUInt32();for(y=a.pos()+y;a.pos()<
y;)v.push(a.getUInt32());break;case 3:y=a.getUInt32();y=a.pos()+y;t.push(a.getSInt32()+this._tx);t.push(a.getSInt32()+this._ty);this.hasZ&&a.getSInt32();for(this.hasM&&a.getSInt32();a.pos()<y;)t.push(a.getSInt32()),t.push(a.getSInt32()),this.hasZ&&a.getSInt32(),this.hasM&&a.getSInt32();break;default:a.skip()}return t.length?new k(v,t):null}_parseGeometryForDisplay(a){a=a.asUnsafe();var n=a.getLength();const t=a.pos()+n,v=[];n=[];let y=0,h=0;var A=null;let E=0;const z="esriGeometryPolygon"===this.geometryType;
for(;a.pos()<t&&a.next();)switch(a.tag()){case 2:A=a.getUInt32();for(A=a.pos()+A;a.pos()<A;){var F=a.getUInt32();v.push(F);y+=F}A=l(2*y).delta;break;case 3:a.getUInt32();F=2+(this.hasZ?1:0)+(this.hasM?1:0);w.assertIsSome(A);for(var D of v)if(h+F*D>A.length)for(var B=0;B<D;B++)a.getSInt32(),a.getSInt32(),this.hasZ&&a.getSInt32(),this.hasM&&a.getSInt32();else if(z){B=this.getAreaSimplificationThreshold(D,this._header.vertexCount);var u=2,H=1,G=a.getSInt32(),I=a.getSInt32();A[h++]=G;A[h++]=I;this.hasZ&&
a.getSInt32();this.hasM&&a.getSInt32();var J=a.getSInt32(),M=a.getSInt32();this.hasZ&&a.getSInt32();for(this.hasM&&a.getSInt32();u<D;){var R=a.getSInt32();let Y=a.getSInt32();this.hasZ&&a.getSInt32();this.hasM&&a.getSInt32();const fa=G+J,O=I+M,Q=fa+R,Z=O+Y;.5*Math.abs(G*O+fa*Z+Q*I-G*Z-fa*I-Q*O)>=B?(E+=-.5*(fa-G)*(O+I),1<H&&p(A[h-2],A[h-1],J,M)?(A[h-2]+=J,A[h-1]+=M):(A[h++]=J,A[h++]=M,H++),G=fa,I=O):(R+=J,Y+=M);J=R;M=Y;u++}3>H?h-=2*H:(E+=-.5*(G+J-G)*(I+M+I),p(A[h-2],A[h-1],J,M)?(A[h-2]+=J,A[h-1]+=
M,n.push(H)):(A[h++]=J,A[h++]=M,n.push(++H)))}else{B=0;u=a.getSInt32();H=a.getSInt32();this.hasZ&&a.getSInt32();this.hasM&&a.getSInt32();A[h++]=u;A[h++]=H;B+=1;for(G=1;G<D;G++)I=a.getSInt32(),J=a.getSInt32(),M=u+I,R=H+J,E+=-.5*(M-u)*(R+H),this.hasZ&&a.getSInt32(),this.hasM&&a.getSInt32(),2<G&&p(A[h-2],A[h-1],I,J)?(A[h-2]+=I,A[h-1]+=J):(A[h++]=I,A[h++]=J,B+=1),u=M,H=R;n.push(B)}break;default:a.skip()}this._cache.area=E;if(!n.length)return null;if(this._tx||this._ty){D=0;w.assertIsSome(A);for(const Y of n)A[2*
D]+=this._tx,A[2*D+1]+=this._ty,D+=Y}return new k(n,A)}}g.FeatureSetReaderPBF=d;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFHeader":function(){define(["exports","../../../../../core/Error","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(g,q,x,w){class C{constructor(){this.exceededTransferLimit=this.hasFeatures=!1;this.vertexCount=this.objectIdFieldIndex=
this.featureCount=this.fieldCount=0;this.offsets={attributes:[],geometry:[]};this.centroid=[]}}g.FeatureSetHeader=C;g.parseHeader=function(r,m,k=!1){r=r.asUnsafe();const f=r.pos(),e=new C;let l=0,b=0,p=null,c=null,d=null,a=!1;const n=[];for(;r.next();)switch(r.tag()){case 1:p=r.getString();break;case 3:c=r.getString();break;case 12:d=r.processMessage(w.parseTransform);break;case 9:e.exceededTransferLimit=r.getBool();if(e.exceededTransferLimit){e.offsets.geometry=k?new Float64Array(8E3):new Int32Array(8E3);
e.centroid=k?new Float64Array(16E3):new Int32Array(16E3);for(var t=0;t<e.centroid.length;t++)e.centroid[t]=268435455}break;case 13:t=r.processMessage(w.parseField);t.index=l++;n.push(t);break;case 15:t=r.getLength();t=r.pos()+t;if(!e.exceededTransferLimit){var v=e.centroid;e.offsets.geometry.push(0);v.push(268435455);v.push(268435455)}!a&&e.exceededTransferLimit&&(a=!0,e.offsets.attributes=k?new Float64Array(8E3*l):new Uint32Array(8E3*l));for(v=b*l;r.pos()<t&&r.next();)switch(r.tag()){case 1:a?e.offsets.attributes[v++]=
r.pos():e.offsets.attributes.push(r.pos());var y=r.getLength();r.skipLen(y);break;case 2:if(m)for(y=r.getLength(),y=r.pos()+y;r.pos()<y&&r.next();)switch(r.tag()){case 3:r.getUInt32();var h=r.getSInt64(),A=r.getSInt64();e.centroid[2*b]=h;e.centroid[2*b+1]=A;break;default:r.skip()}else e.offsets.geometry[b]=r.pos(),y=r.getLength(),e.vertexCount+=y,r.skipLen(y);break;case 4:y=r.getLength();for(y=r.pos()+y;r.pos()<y&&r.next();)switch(r.tag()){case 3:r.getUInt32();h=r.getSInt64();A=r.getSInt64();e.centroid[2*
b]=h;e.centroid[2*b+1]=A;break;default:r.skip()}break;default:r.skip()}b++;e.hasFeatures=!0;break;default:r.skip()}m=p||c;if(!m)throw new q("FeatureSet has no objectId or globalId field name");e.fields=new x(n);e.featureCount=b;e.fieldCount=l;e.objectIdFieldIndex=e.fields.get(m)?.index;e.transform=d;e.displayIds=new Uint32Array(e.featureCount);e.groupIds=new Uint16Array(e.featureCount);r.move(f);return e};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/DataTileSource":function(){define("exports ../../../../../TimeExtent ../../../../../core/Evented ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../core/support/UpdatingHandles ../../../../../layers/support/arcgisLayerUrl ../../../../../rest/support/Query ./DataTileSubscription ../support/UpdateToken".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){function b(c,d){const a=new Set;c&&c.forEach(n=>a.add(n));d&&d.forEach(n=>a.add(n));return a.has("*")?["*"]:Array.from(a)}class p{constructor(c){this.updatingHandles=new m.UpdatingHandles;this.events=new x;this._resolver=C.createResolver();this._didEdit=!1;this._subscriptions=new Map;this._outSR=c.outSR;this._serviceInfo=c.serviceInfo;this._onTileUpdateMessage=c.onMessage;this._arcadeLayerSchema=c.arcadeLayerSchema}destroy(){for(const c of this._subscriptions.values())c.abort();
this.updatingHandles.destroy()}get subscriptions(){return this._subscriptions.values()}async _onMessage(c){const d=this._subscriptions.get(c.id);if(d)return c={...c,remove:c.remove??[],status:c.status??l.UpdateToken.empty()},C.ignoreAbortErrors(this._onTileUpdateMessage(c,d.options))}update(c,d){var a=d.fields.length;d.outFields=b(this._schema?.outFields,d.outFields);d.outFields=d.outFields.length>=.75*a?["*"]:d.outFields;d.outFields.sort();if(a=r.diff(this._schema,d)){w("esri-2d-update-debug")&&
console.debug("Applying Update - Source:",a);var n="orderByFields"in this._serviceInfo&&this._serviceInfo.orderByFields?this._serviceInfo.orderByFields:this._serviceInfo.objectIdField+" ASC",t=this._serviceInfo.source;n={returnCentroid:!(null!==t&&"object"===typeof t&&"path"in t&&k.isHostedAgolService(t.path))&&"esriGeometryPolygon"===this._serviceInfo.geometryType,returnGeometry:!0,timeReferenceUnknownClient:"stream"!==this._serviceInfo.type&&this._serviceInfo.timeReferenceUnknownClient,outFields:d.outFields,
outSpatialReference:this._outSR,orderByFields:[n],where:d.definitionExpression||"1\x3d1",gdbVersion:d.gdbVersion,historicMoment:d.historicMoment,timeExtent:d.timeExtent?q.fromJSON(d.timeExtent):null};t=this._schema&&r.hasDiff(a,"outFields");this._schema&&r.hasDiffAny(a,["timeExtent","definitionExpression","gdbVersion","historicMoment","customParameters"])&&(c.why.mesh.push("Layer filter and/or custom parameters changed"),c.why.source.push("Layer filter and/or custom parameters changed"),c.mesh=!0,
c.source=!0,c.queryFilter=!0);t&&(c.why.source.push("Layer required fields changed"),c.source=!0);r.diff(n,this._queryInfo)&&(this._queryInfo=n);this._schema=d;this._resolver.resolve()}}whenInitialized(){return this._resolver.promise}async applyUpdate(c){c.queryFilter||c.source&&this._didEdit?(this.refresh(c.version),this._didEdit=!1):(this._subscriptions.forEach(d=>d.applyUpdate(c)),await this.resend())}refresh(c,d){for(const a of this._tiles())this.unsubscribe(a),this.subscribe(a,c)}subscribe(c,
d){d=new e.DataTileSubscription(c,d);this._subscriptions.set(c.id,d);return d}unsubscribe(c){const d=this.getSubscription(c.id);null!=d&&d.abort();this._subscriptions.delete(c.id)}createQuery(c={}){return new f({...this._queryInfo,historicMoment:this._queryInfo.historicMoment?new Date(this._queryInfo.historicMoment):null,...c})}getSubscription(c){return this._subscriptions.has(c)?this._subscriptions.get(c):null}async queryLastEditDate(){throw Error("Service does not support query type");}async query(c,
d){throw Error("Service does not support query");}*_tiles(){const c=Array.from(this._subscriptions.values());for(const d of c)yield d.tile}async edit(c,d){return this.updatingHandles.addPromise(this._edit(c,d))}async _edit(c,d){var a=Array.from(this._subscriptions.values());const n=a.map(({tile:t})=>t);for(const t of a)t.removeIds(d);c.length&&(a=n.map(t=>{const v=this.createTileQuery(t);v.objectIds=c;return{tile:t,query:v}}).map(async({tile:t,query:v})=>({tile:t,result:await this.query(v,{query:{tile:w("esri-tiles-debug")?
t.id.replaceAll("/","."):void 0}}),query:v})),a=(await C.eachAlwaysValues(a)).map(async({tile:t,result:v})=>{(v.hasFeatures||d.length||c.length)&&(t=this._subscriptions.get(t.key.id))&&t.edit(v,c)}),await Promise.allSettled(a));this._didEdit=!0}}g.DataTileSource=p;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/TimeExtent":function(){define("./chunks/tslib.es6 ./core/JSONSupport ./core/timeUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/arrayUtils ./core/has ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./time/timeZoneUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){var b;q=b=class extends q.JSONSupport{static get allTime(){return p}static get empty(){return c}constructor(d){super(d);this.start=this.end=null}readEnd(d,a){return null!=a.end?new Date(a.end):null}writeEnd(d,a){a.end=d?.getTime()??null}get isAllTime(){return this.equals(b.allTime)}get isEmpty(){return this.equals(b.empty)}readStart(d,a){return null!=a.start?new Date(a.start):null}writeStart(d,a){a.start=d?.getTime()??null}clone(){return new b({end:this.end,start:this.start})}equals(d){if(!d)return!1;
const a=this.start?.getTime()??this.start,n=this.end?.getTime()??this.end,t=d.start?.getTime()??d.start;d=d.end?.getTime()??d.end;return a===t&&n===d}expandTo(d,a=l.system){if(this.isEmpty||this.isAllTime)return this.clone();let n=this.start;n&&(n=x.truncateDate(n,d,a));let t=this.end;if(t){const v=x.truncateDate(t,d,a);t=t.getTime()===v.getTime()?v:x.offsetDate(v,1,d,a)}return new b({start:n,end:t})}intersection(d){if(!d)return this.clone();if(this.isEmpty||d.isEmpty)return b.empty;if(this.isAllTime)return d.clone();
if(d.isAllTime)return this.clone();var a=this.start?.getTime()??-Infinity;const n=this.end?.getTime()??Infinity,t=d.start?.getTime()??-Infinity;d=d.end?.getTime()??Infinity;let v,y;t>=a&&t<=n?v=t:a>=t&&a<=d&&(v=a);n>=t&&n<=d?y=n:d>=a&&d<=n&&(y=d);return null==v||null==y||isNaN(v)||isNaN(y)?b.empty:(a=new b,a.start=-Infinity===v?null:new Date(v),a.end=Infinity===y?null:new Date(y),a)}offset(d,a,n=l.system){if(this.isEmpty||this.isAllTime)return this.clone();const t=new b,{start:v,end:y}=this;null!=
v&&(t.start=x.offsetDate(v,d,a,n));null!=y&&(t.end=x.offsetDate(y,d,a,n));return t}union(d){if(!d||d.isEmpty)return this.clone();if(this.isEmpty)return d.clone();if(this.isAllTime||d.isAllTime)return p.clone();const a=null!=this.start&&null!=d.start?new Date(Math.min(this.start.getTime(),d.start.getTime())):null;d=null!=this.end&&null!=d.end?new Date(Math.max(this.end.getTime(),d.end.getTime())):null;return new b({start:a,end:d})}};g.__decorate([w.property({type:Date,json:{write:{allowNull:!0}}})],
q.prototype,"end",void 0);g.__decorate([k.reader("end")],q.prototype,"readEnd",null);g.__decorate([e.writer("end")],q.prototype,"writeEnd",null);g.__decorate([w.property({readOnly:!0,json:{read:!1}})],q.prototype,"isAllTime",null);g.__decorate([w.property({readOnly:!0,json:{read:!1}})],q.prototype,"isEmpty",null);g.__decorate([w.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"start",void 0);g.__decorate([k.reader("start")],q.prototype,"readStart",null);g.__decorate([e.writer("start")],
q.prototype,"writeStart",null);q=b=g.__decorate([f.subclass("esri.TimeExtent")],q);const p=new q,c=new q({start:void 0,end:void 0});return q})},"esri/rest/support/Query":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../../layers/support/source/DataLayerSource ./FullTextSearch ./QuantizationParameters ./StatisticDefinition ../../geometry/SpatialReference ../../geometry/Point".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v){var y;const h=new w.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});w=new w.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let A=y=class extends C.JSONSupport{static from(E){return b.ensureClass(y,E)}constructor(E){super(E);this.aggregateIds=null;this.cacheHint=void 0;this.compactGeometryEnabled=!1;this.datumTransformation=null;this.defaultSpatialReferenceEnabled=!1;this.dynamicDataSource=this.distance=void 0;this.geometry=this.gdbVersion=this.fullText=this.formatOf3DObjects=null;
this.geometryPrecision=void 0;this.historicMoment=this.having=this.groupByFieldsForStatistics=null;this.maxAllowableOffset=void 0;this.maxRecordCountFactor=1;this.multipatchOption=null;this.num=void 0;this.resultType=this.relationParameter=this.rangeValues=this.quantizationParameters=this.pixelSize=this.parameterValues=this.outStatistics=this.outSpatialReference=this.outFields=this.orderByFields=this.objectIds=null;this.returnDistinctValues=this.returnCentroid=!1;this.returnExceededLimitFeatures=
!0;this.returnQueryGeometry=this.returnGeometry=!1;this.returnZ=this.returnM=void 0;this.sourceSpatialReference=null;this.spatialRelationship="intersects";this.start=void 0;this.timeExtent=this.text=this.sqlFormat=null;this.timeReferenceUnknownClient=!1;this.where=this.units=null}castDatumTransformation(E){return"number"===typeof E||"object"===typeof E?E:null}writeHistoricMoment(E,z){z.historicMoment=E&&E.getTime()}writeParameterValues(E,z){if(E){const F={};for(const D in E){const B=E[D];Array.isArray(B)?
F[D]=B.map(u=>u instanceof Date?u.getTime():u):F[D]=B instanceof Date?B.getTime():B}z.parameterValues=F}}writeStart(E,z){z.resultOffset=this.start;z.resultRecordCount=this.num||10;z.where="1\x3d1"}writeWhere(E,z){z.where=E||"1\x3d1"}clone(){return new y(r.clone({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,
fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,
outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,
returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};A.MAX_MAX_RECORD_COUNT_FACTOR=5;g.__decorate([m.property({json:{write:!0}})],A.prototype,"aggregateIds",void 0);g.__decorate([m.property({type:Boolean,
json:{write:!0}})],A.prototype,"cacheHint",void 0);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],A.prototype,"compactGeometryEnabled",void 0);g.__decorate([m.property({json:{write:!0}})],A.prototype,"datumTransformation",void 0);g.__decorate([k.cast("datumTransformation")],A.prototype,"castDatumTransformation",null);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],A.prototype,"defaultSpatialReferenceEnabled",void 0);g.__decorate([m.property({type:Number,
json:{write:{overridePolicy(E){return{enabled:0<E}}}}})],A.prototype,"distance",void 0);g.__decorate([m.property({type:c.DataLayerSource,json:{write:!0}})],A.prototype,"dynamicDataSource",void 0);g.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"formatOf3DObjects",void 0);g.__decorate([m.property({type:[d],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&0<this.fullText.length}}}}})],A.prototype,"fullText",void 0);g.__decorate([m.property({type:String,
json:{write:!0}})],A.prototype,"gdbVersion",void 0);g.__decorate([m.property({types:q.geometryTypes,json:{read:p.fromJSON,write:!0}})],A.prototype,"geometry",void 0);g.__decorate([m.property({type:Number,json:{write:!0}})],A.prototype,"geometryPrecision",void 0);g.__decorate([m.property({type:[String],json:{write:!0}})],A.prototype,"groupByFieldsForStatistics",void 0);g.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"having",void 0);g.__decorate([m.property({type:Date})],A.prototype,
"historicMoment",void 0);g.__decorate([l.writer("historicMoment")],A.prototype,"writeHistoricMoment",null);g.__decorate([m.property({type:Number,json:{write:!0}})],A.prototype,"maxAllowableOffset",void 0);g.__decorate([m.property({type:Number,cast(E){return 1>E?1:E>A.MAX_MAX_RECORD_COUNT_FACTOR?A.MAX_MAX_RECORD_COUNT_FACTOR:E},json:{write:{overridePolicy(E){return{enabled:1<E}}}}})],A.prototype,"maxRecordCountFactor",void 0);g.__decorate([m.property({type:["xyFootprint"],json:{write:!0}})],A.prototype,
"multipatchOption",void 0);g.__decorate([m.property({type:Number,json:{read:{source:"resultRecordCount"}}})],A.prototype,"num",void 0);g.__decorate([m.property({json:{write:!0}})],A.prototype,"objectIds",void 0);g.__decorate([m.property({type:[String],json:{write:!0}})],A.prototype,"orderByFields",void 0);g.__decorate([m.property({type:[String],json:{write:!0}})],A.prototype,"outFields",void 0);g.__decorate([m.property({type:t,json:{name:"outSR",write:!0}})],A.prototype,"outSpatialReference",void 0);
g.__decorate([m.property({type:[n],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&0<this.outStatistics.length}}}}})],A.prototype,"outStatistics",void 0);g.__decorate([m.property({json:{write:!0}})],A.prototype,"parameterValues",void 0);g.__decorate([l.writer("parameterValues")],A.prototype,"writeParameterValues",null);g.__decorate([m.property({type:v,json:{write:!0}})],A.prototype,"pixelSize",void 0);g.__decorate([m.property({type:a,json:{write:!0}})],A.prototype,
"quantizationParameters",void 0);g.__decorate([m.property({type:[Object],json:{write:!0}})],A.prototype,"rangeValues",void 0);g.__decorate([m.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],A.prototype,"relationParameter",void 0);g.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"resultType",void 0);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],
A.prototype,"returnCentroid",void 0);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],A.prototype,"returnDistinctValues",void 0);g.__decorate([m.property({type:Boolean,json:{default:!0,write:!0}})],A.prototype,"returnExceededLimitFeatures",void 0);g.__decorate([m.property({type:Boolean,json:{write:!0}})],A.prototype,"returnGeometry",void 0);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],A.prototype,"returnQueryGeometry",void 0);g.__decorate([m.property({type:Boolean,
json:{default:!1,write:!0}})],A.prototype,"returnM",void 0);g.__decorate([m.property({type:Boolean,json:{write:{overridePolicy(E){return{enabled:E}}}}})],A.prototype,"returnZ",void 0);g.__decorate([m.property({type:t,json:{write:!0}})],A.prototype,"sourceSpatialReference",void 0);g.__decorate([f.enumeration(h,{ignoreUnknown:!1,name:"spatialRel"})],A.prototype,"spatialRelationship",void 0);g.__decorate([m.property({type:Number,json:{read:{source:"resultOffset"}}})],A.prototype,"start",void 0);g.__decorate([l.writer("start"),
l.writer("num")],A.prototype,"writeStart",null);g.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"sqlFormat",void 0);g.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"text",void 0);g.__decorate([m.property({type:x,json:{write:!0}})],A.prototype,"timeExtent",void 0);g.__decorate([m.property({type:Boolean,json:{default:!1,write:!0}})],A.prototype,"timeReferenceUnknownClient",void 0);g.__decorate([f.enumeration(w,{ignoreUnknown:!1}),m.property({json:{write:{overridePolicy(E){return{enabled:!!E&&
null!=this.distance&&0<this.distance}}}}})],A.prototype,"units",void 0);g.__decorate([m.property({type:String,json:{write:{overridePolicy(E){return{enabled:null!=E||null!=this.start&&0<this.start}}}}})],A.prototype,"where",void 0);g.__decorate([l.writer("where")],A.prototype,"writeWhere",null);return A=y=g.__decorate([e.subclass("esri.rest.support.Query")],A)})},"esri/layers/support/source/DataLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/extensions/serializableProperty/reader ../Field ./MapLayerSource ./QueryTableDataSource ./RasterDataSource ./TableDataSource".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a){function n(){h||(h=l.createTypeReader({types:t()}));return h}function t(){A||(A={key:"type",base:null,typeMap:{"data-layer":g.DataLayerSource,"map-layer":p.MapLayerSource}});return A}var v,y;x=x.strict()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});g.JoinTableDataSource=v=class extends w.JSONSupport{constructor(E){super(E);this.type="join-table"}readLeftTableSource(E,z,F){return n()(E,z,F)}castLeftTableSource(E){return e.ensureOneOfType(t(),
E)}readRightTableSource(E,z,F){return n()(E,z,F)}castRightTableSource(E){return e.ensureOneOfType(t(),E)}clone(){const {leftTableKey:E,rightTableKey:z,leftTableSource:F,rightTableSource:D,joinType:B}=this,u={leftTableKey:E,rightTableKey:z,leftTableSource:F?.clone()??void 0,rightTableSource:D?.clone()??void 0,joinType:B};return new v(u)}};q.__decorate([m.enumeration({joinTable:"join-table"})],g.JoinTableDataSource.prototype,"type",void 0);q.__decorate([C.property({type:String,json:{write:!0}})],g.JoinTableDataSource.prototype,
"leftTableKey",void 0);q.__decorate([C.property({type:String,json:{write:!0}})],g.JoinTableDataSource.prototype,"rightTableKey",void 0);q.__decorate([C.property({json:{write:!0}})],g.JoinTableDataSource.prototype,"leftTableSource",void 0);q.__decorate([k.reader("leftTableSource")],g.JoinTableDataSource.prototype,"readLeftTableSource",null);q.__decorate([r.cast("leftTableSource")],g.JoinTableDataSource.prototype,"castLeftTableSource",null);q.__decorate([C.property({json:{write:!0}})],g.JoinTableDataSource.prototype,
"rightTableSource",void 0);q.__decorate([k.reader("rightTableSource")],g.JoinTableDataSource.prototype,"readRightTableSource",null);q.__decorate([r.cast("rightTableSource")],g.JoinTableDataSource.prototype,"castRightTableSource",null);q.__decorate([m.enumeration(x)],g.JoinTableDataSource.prototype,"joinType",void 0);g.JoinTableDataSource=v=q.__decorate([f.subclass("esri.layers.support.source.JoinTableDataSource")],g.JoinTableDataSource);let h=null,A=null;r={key:"type",base:null,typeMap:{"join-table":g.JoinTableDataSource,
"query-table":c.QueryTableDataSource,raster:d.RasterDataSource,table:a.TableDataSource}};g.DataLayerSource=y=class extends w.JSONSupport{constructor(E){super(E);this.type="data-layer"}clone(){const {fields:E,dataSource:z}=this;return new y({fields:E,dataSource:z})}};q.__decorate([m.enumeration({dataLayer:"data-layer"})],g.DataLayerSource.prototype,"type",void 0);q.__decorate([C.property({type:[b],json:{write:!0}})],g.DataLayerSource.prototype,"fields",void 0);q.__decorate([C.property({types:r,json:{write:!0}})],
g.DataLayerSource.prototype,"dataSource",void 0);g.DataLayerSource=y=q.__decorate([f.subclass("esri.layers.support.source.DataLayerSource")],g.DataLayerSource);g.DataLayerSource.from=e.ensureType(g.DataLayerSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Field":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./domains ./fieldType".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b){var p;const c=new q.JSONMap({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});q=p=class extends x.JSONSupport{constructor(d){super(d);
this.alias=null;this.defaultValue=void 0;this.domain=this.description=null;this.editable=!0;this.length=void 0;this.name=null;this.nullable=!0;this.valueType=this.type=null;this.visible=!0}readDescription(d,{description:a}){d=null;try{d=a?JSON.parse(a):null}catch(n){}return d?.value??null}readValueType(d,{description:a}){d=null;try{d=a?JSON.parse(a):null}catch(n){}return d?c.fromJSON(d.fieldValueType):null}clone(){return new p({alias:this.alias,defaultValue:this.defaultValue,description:this.description,
domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"alias",void 0);g.__decorate([w.property({type:[String,Number],json:{write:{allowNull:!0}}})],q.prototype,"defaultValue",void 0);g.__decorate([w.property()],q.prototype,"description",void 0);g.__decorate([f.reader("description")],q.prototype,
"readDescription",null);g.__decorate([w.property({types:l.types,json:{read:{reader:l.fromJSON},write:!0}})],q.prototype,"domain",void 0);g.__decorate([w.property({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0);g.__decorate([w.property({type:C.Integer,json:{write:{overridePolicy(d){return{enabled:Number.isFinite(d)}}}}})],q.prototype,"length",void 0);g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"name",void 0);g.__decorate([w.property({type:Boolean,json:{write:!0}})],
q.prototype,"nullable",void 0);g.__decorate([k.enumeration(b.kebabDict)],q.prototype,"type",void 0);g.__decorate([w.property()],q.prototype,"valueType",void 0);g.__decorate([f.reader("valueType",["description"])],q.prototype,"readValueType",null);g.__decorate([w.property({type:Boolean,json:{read:!1}})],q.prototype,"visible",void 0);return q=p=g.__decorate([e.subclass("esri.layers.support.Field")],q)})},"esri/layers/support/domains":function(){define("exports ../../core/has ./CodedValueDomain ./Domain ./InheritedDomain ./RangeDomain".split(" "),
function(g,q,x,w,C,r){q={key:"type",base:w,typeMap:{range:r,"coded-value":x,inherited:C}};g.CodedValueDomain=x;g.DomainBase=w;g.InheritedDomain=C;g.RangeDomain=r;g.fromJSON=function(m){if(!m?.type)return null;switch(m.type){case "range":return r.fromJSON(m);case "codedValue":return x.fromJSON(m);case "inherited":return C.fromJSON(m)}return null};g.types=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CodedValueDomain":function(){define("../../chunks/tslib.es6 ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./CodedValue ./Domain".split(" "),
function(g,q,x,w,C,r,m,k){var f;w=f=class extends k{constructor(e){super(e);this.codedValues=null;this.type="coded-value"}getName(e){let l=null;if(this.codedValues){const b=String(e);this.codedValues.some(p=>{String(p.code)===b&&(l=p.name);return!!l})}return l}clone(){return new f({codedValues:q.clone(this.codedValues),name:this.name})}};g.__decorate([x.property({type:[m.CodedValue],json:{write:!0}})],w.prototype,"codedValues",void 0);g.__decorate([C.enumeration({codedValue:"coded-value"})],w.prototype,
"type",void 0);return w=f=g.__decorate([r.subclass("esri.layers.support.CodedValueDomain")],w)})},"esri/layers/support/CodedValue":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m,k){var f;g.CodedValue=f=class extends x.JSONSupport{constructor(e){super(e);this.code=this.name=
null}clone(){return new f({name:this.name,code:this.code})}};q.__decorate([w.property({type:String,json:{write:!0}})],g.CodedValue.prototype,"name",void 0);q.__decorate([w.property({type:[String,Number],json:{write:!0}})],g.CodedValue.prototype,"code",void 0);g.CodedValue=f=q.__decorate([k.subclass("esri.layers.support.CodedValue")],g.CodedValue);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Domain":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k,f){q=new q.JSONMap({inherited:"inherited",codedValue:"coded-value",range:"range"});x=class extends x.JSONSupport{constructor(e){super(e);this.type=this.name=null}};g.__decorate([w.property({type:String,json:{write:!0}})],x.prototype,"name",void 0);g.__decorate([k.enumeration(q)],x.prototype,"type",void 0);return x=g.__decorate([f.subclass("esri.layers.support.Domain")],x)})},"esri/layers/support/InheritedDomain":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(g,q,x,w,C,r,m,k,f){var e;q=e=class extends f{constructor(l){super(l);this.type="inherited"}clone(){return new e}};g.__decorate([m.enumeration({inherited:"inherited"})],q.prototype,"type",void 0);return q=e=g.__decorate([k.subclass("esri.layers.support.InheritedDomain")],q)})},"esri/layers/support/RangeDomain":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(g,q,x,w,C,r,m,k){var f;x=f=class extends k{constructor(e){super(e);this.minValue=this.maxValue=null;this.type="range"}clone(){return new f({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};g.__decorate([q.property({json:{type:[Number],read:{source:"range",reader(e,l){return l.range?.[1]}},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,l,b){l[b]=[this.minValue||0,e]}}}})],x.prototype,"maxValue",void 0);g.__decorate([q.property({json:{type:[Number],
read:{source:"range",reader(e,l){return l.range?.[0]}},write:{target:"range",writer(e,l,b){l[b]=[e,this.maxValue||0]}}}})],x.prototype,"minValue",void 0);g.__decorate([r.enumeration({range:"range"})],x.prototype,"type",void 0);return x=f=g.__decorate([m.subclass("esri.layers.support.RangeDomain")],x)})},"esri/layers/support/source/MapLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k,f){var e;g.MapLayerSource=e=class extends x.JSONSupport{constructor(l){super(l);this.type="map-layer"}clone(){const {mapLayerId:l,gdbVersion:b}=this;return new e({mapLayerId:l,gdbVersion:b})}};q.__decorate([k.enumeration({mapLayer:"map-layer"})],g.MapLayerSource.prototype,"type",void 0);q.__decorate([w.property({type:C.Integer,json:{write:!0}})],g.MapLayerSource.prototype,"mapLayerId",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],g.MapLayerSource.prototype,
"gdbVersion",void 0);g.MapLayerSource=e=q.__decorate([f.subclass("esri.layers.support.source.MapLayerSource")],g.MapLayerSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/QueryTableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../geometry ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b){var p;g.QueryTableDataSource=p=class extends w.JSONSupport{constructor(c){super(c);this.type="query-table"}clone(){const {workspaceId:c,query:d,oidFields:a,spatialReference:n,geometryType:t}=this,v={workspaceId:c,query:d,oidFields:a,spatialReference:n?.clone()??void 0,geometryType:t};return new p(v)}};q.__decorate([f.enumeration({queryTable:"query-table"})],g.QueryTableDataSource.prototype,"type",void 0);q.__decorate([C.property({type:String,json:{write:!0}})],g.QueryTableDataSource.prototype,
"workspaceId",void 0);q.__decorate([C.property({type:String,json:{write:!0}})],g.QueryTableDataSource.prototype,"query",void 0);q.__decorate([C.property({type:String,json:{write:!0}})],g.QueryTableDataSource.prototype,"oidFields",void 0);q.__decorate([C.property({type:l,json:{write:!0}})],g.QueryTableDataSource.prototype,"spatialReference",void 0);q.__decorate([f.enumeration(b.featureGeometryTypeKebabDictionary)],g.QueryTableDataSource.prototype,"geometryType",void 0);g.QueryTableDataSource=p=q.__decorate([e.subclass("esri.layers.support.source.QueryTableDataSource")],
g.QueryTableDataSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/RasterDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m,k,f){var e;g.RasterDataSource=
e=class extends x.JSONSupport{constructor(l){super(l);this.type="raster"}clone(){const {workspaceId:l,dataSourceName:b}=this;return new e({workspaceId:l,dataSourceName:b})}};q.__decorate([k.enumeration({raster:"raster"})],g.RasterDataSource.prototype,"type",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],g.RasterDataSource.prototype,"dataSourceName",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],g.RasterDataSource.prototype,"workspaceId",void 0);g.RasterDataSource=
e=q.__decorate([f.subclass("esri.layers.support.source.RasterDataSource")],g.RasterDataSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/TableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k,f){var e;g.TableDataSource=e=class extends x.JSONSupport{constructor(l){super(l);this.type="table"}clone(){const {workspaceId:l,gdbVersion:b,dataSourceName:p}=this;return new e({workspaceId:l,gdbVersion:b,dataSourceName:p})}};q.__decorate([k.enumeration({table:"table"})],g.TableDataSource.prototype,"type",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],g.TableDataSource.prototype,"workspaceId",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],
g.TableDataSource.prototype,"gdbVersion",void 0);q.__decorate([w.property({type:String,json:{write:!0}})],g.TableDataSource.prototype,"dataSourceName",void 0);g.TableDataSource=e=q.__decorate([f.subclass("esri.layers.support.source.TableDataSource")],g.TableDataSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FullTextSearch":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k){q=class extends q.ClonableMixin(x.JSONSupport){constructor(f){super(f);this.searchType=this.searchTerm=this.operator=this.onFields=null}};g.__decorate([w.property({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&0<this.onFields.length}}}}})],q.prototype,"onFields",void 0);g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"operator",void 0);g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"searchTerm",
void 0);g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"searchType",void 0);return q=g.__decorate([k.subclass("esri.rest.support.FullTextSearch")],q)})},"esri/core/Clonable":function(){define("exports ../chunks/tslib.es6 ./Accessor ./has ./lang ./Logger ./maybe ./accessorSupport/PropertyOrigin ./accessorSupport/utils ./accessorSupport/decorators/subclass".split(" "),function(g,q,x,w,C,r,m,k,f,e){w=l=>{l=class extends l{clone(){var b=f.getProperties(this);m.assertIsSome(b,"unable to clone instance of non-accessor class");
var p=b.metadatas;const c=b.store,d={};b=new Map;for(var a in p){var n=p[a];const t=c?.originOf(a),v=n.clonable;if(n.readOnly||!1===v||t!==k.OriginId.USER&&t!==k.OriginId.DEFAULTS&&t!==k.OriginId.WEB_MAP&&t!==k.OriginId.WEB_SCENE)continue;n=this[a];let y=null;y="function"===typeof v?v(n):"reference"===v?n:C.tryClone(n);if(null==n||null!=y)t===k.OriginId.DEFAULTS?b.set(a,y):d[a]=y}p=new (Object.getPrototypeOf(this).constructor)(d);if(b.size&&(a=f.getProperties(p)?.store))for(const [t,v]of b)a.set(t,
v,k.OriginId.DEFAULTS);return p}};return l=q.__decorate([e.subclass("esri.core.Clonable")],l)};g.Clonable=class extends w(x){};g.Clonable=q.__decorate([e.subclass("esri.core.Clonable")],g.Clonable);g.ClonableMixin=w;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/QuantizationParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/Extent".split(" "),
function(g,q,x,w,C,r,m,k,f){var e;q=new x.JSONMap({upperLeft:"upper-left",lowerLeft:"lower-left"});w=e=class extends w.JSONSupport{constructor(l){super(l);this.extent=null;this.mode="view";this.originPosition="upper-left";this.tolerance=1}clone(){return new e(C.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};g.__decorate([r.property({type:f,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],w.prototype,"extent",void 0);
g.__decorate([r.property({type:["view","edit"],json:{write:!0}})],w.prototype,"mode",void 0);g.__decorate([r.property({type:String,json:{read:q.read,write:q.write}})],w.prototype,"originPosition",void 0);g.__decorate([r.property({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],w.prototype,"tolerance",void 0);return w=e=g.__decorate([k.subclass("esri.rest.support.QuantizationParameters")],w)})},"esri/rest/support/StatisticDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer".split(" "),
function(g,q,x,w,C,r,m,k){var f;q=new q.JSONMap({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});x=f=class extends x.JSONSupport{constructor(e){super(e);this.maxVertexCount=this.maxRecordCount=this.maxPointCount=void 0;this.statisticParameters=
this.statisticType=this.outStatisticFieldName=this.onStatisticField=null}writeStatisticParameters(e,l){if("percentile-continuous"===this.statisticType||"percentile-discrete"===this.statisticType)l.statisticParameters=w.clone(e)}clone(){return new f({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:w.clone(this.statisticParameters)})}};
g.__decorate([C.property({type:Number,json:{write:!0}})],x.prototype,"maxPointCount",void 0);g.__decorate([C.property({type:Number,json:{write:!0}})],x.prototype,"maxRecordCount",void 0);g.__decorate([C.property({type:Number,json:{write:!0}})],x.prototype,"maxVertexCount",void 0);g.__decorate([C.property({type:String,json:{write:!0}})],x.prototype,"onStatisticField",void 0);g.__decorate([C.property({type:String,json:{write:!0}})],x.prototype,"outStatisticFieldName",void 0);g.__decorate([C.property({type:String,
json:{read:{source:"statisticType",reader:q.read},write:{target:"statisticType",writer:q.write}}})],x.prototype,"statisticType",void 0);g.__decorate([C.property({type:Object})],x.prototype,"statisticParameters",void 0);g.__decorate([k.writer("statisticParameters")],x.prototype,"writeStatisticParameters",null);return x=f=g.__decorate([m.subclass("esri.rest.support.StatisticDefinition")],x)})},"esri/views/2d/layers/features/sources/DataTileSubscription":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/CircularArray ../../../../../core/has ../../../../../core/promiseUtils ../support/FeatureSetReaderJSON ../support/UpdateToken".split(" "),
function(g,q,x,w,C,r,m){class k{constructor(f,e){this.requests={done:[],stream:new x(10)};this._edits=null;this._abortController=new AbortController;this._version=0;this.didSend=this._isDone=!1;this.tile=f;this._version=e;this._resolver=C.createResolver();this._resolver.promise.catch(l=>C.throwIfNotAbortError(l))}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length&&null==this.edits}get edits(){return this._edits}get done(){return this._resolver.promise}get isDone(){return this._isDone}resolve(){this._isDone=
!0;this._resolver.resolve()}clear(){this.requests.done=[]}applyUpdate(f){this.requests.done.forEach(e=>e.message.status.unset(f));this._version=f.version;null!=this._edits&&this._edits.status.unset(f)}add(f){f.message.status=f.message.status??m.UpdateToken.empty();f.message.status.version=this._version;w("esri-2d-update-debug")&&console.debug(this.tile.id,"DataTileSubscription:add",this._version);f.message.end&&(this.requests.done.forEach(e=>{null!=e.message&&e.message.end&&(e.message.end=!1)}),this._resolver.resolve(),
this._isDone=!0);this.requests.done.push(f)}edit(f,e){const l=f.getQuantizationTransform(),b=f.fullSchema(),p=Array.from(f.features()).filter(q.isSome),c=p.map(d=>d.objectId);e=[...e,...c];this.removeIds(e);this._invalidate();null==this._edits?this._edits={type:"append",addOrUpdate:r.FeatureSetReaderJSON.fromOptimizedFeatures(p,b,l),id:this.tile.id,status:m.UpdateToken.empty(),end:!0}:(this.requests.done.forEach(d=>d.message.end=!1),this._edits.addOrUpdate.append(f.features()))}*readers(){for(const {message:f}of this.requests.done)null!=
f.addOrUpdate&&(yield f.addOrUpdate);null!=this._edits?.addOrUpdate&&(yield this._edits.addOrUpdate)}_invalidate(){for(const f of this.requests.done)f.message.status=m.UpdateToken.empty();null!=this._edits&&(this._edits.status=m.UpdateToken.empty())}removeIds(f){this._invalidate();for(const {message:e}of this.requests.done){const l=e.addOrUpdate;null!=l&&(l.removeIds(f),l.isEmpty&&(w("esri-2d-update-debug")&&console.debug("Removing FeatureSetReader"),e.addOrUpdate=null))}null!=this._edits?.addOrUpdate&&
this._edits.addOrUpdate.removeIds(f);this.requests.done=this.requests.done.filter(e=>e.message.addOrUpdate||e.message.end)}abort(){this._abortController.abort();this._resolver.reject(C.createAbortError())}}g.DataTileSubscription=k;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/UpdateToken":function(){define(["exports"],function(g){class q{constructor(){this.version=0;this.source=!1;this.targets={feature:!1,aggregate:!1};this.storage={filters:!1,
data:!1};this.queryFilter=this.mesh=!1;this.why={mesh:[],source:[]}}static create(x){const w=new q;let C;for(C in x){const r=x[C];if("object"===typeof r)for(const m in r){const k=m;w[C][k]=r[k]}w[C]=r}return w}static empty(){return q.create({})}static all(){return q.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}unset(x){this.version=x.version;x.source&&(this.source=!1);x.targets.feature&&(this.targets.feature=!1);x.targets.aggregate&&(this.targets.aggregate=
!1);x.storage.filters&&(this.storage.filters=!1);x.storage.data&&(this.storage.data=!1);x.mesh&&(this.mesh=!1);x.queryFilter&&(this.queryFilter=!1)}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){let x=0,w="";if(this.mesh){x+=20;w+="-\x3e (20) Mesh needs update\n";for(const C of this.why.mesh)w+=`    + ${C}\n`}if(this.source){x+=10;w+="-\x3e (10) The source needs update\n";for(const C of this.why.source)w+=
`    + ${C}\n`}this.targets.feature&&(x+=5,w+="-\x3e (5) Feature target parameters changed\n");this.storage.filters&&(x+=5,w+="-\x3e (5) Feature filter parameters changed\n");this.targets.aggregate&&(x+=4,w+="-\x3e (4) Aggregate target parameters changed\n");this.storage.data&&(x+=1,w+="-\x3e (1) Texture storage parameters changed");console.debug(`Applying ${5>x?"Fastest":10>x?"Fast":15>x?"Moderate":20>x?"Slow":"Very Slow"} update of cost ${x}/45 `);console.debug(w)}toJSON(){return{queryFilter:this.queryFilter,
source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh}}}g.UpdateToken=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(g,q,x,w,C,r,m){class k{constructor(e,l){this.item=e;this.controller=l;this.promise=null}}class f{constructor(e){this._task=this._schedule=
null;this._deferreds=new C;this._controllers=new C;this._processingItems=new C;this._pausedSignal=m.signal(!1);this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new w(e.peeker);this.process=e.process;const l=e.scheduler;e.priority&&l&&(this._task=l.registerTask(e.priority,this))}destroy(){this.clear();this._schedule=q.removeMaybe(this._schedule);this._task=q.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+
this._queue.length}abort(e){(e=this._controllers.get(e))&&e.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(l=>e.push(l));this._controllers.clear();e.forEach(l=>l.abort());this._processingItems.clear();this._cancelNext()}forEach(e){this._deferreds.forEach((l,b)=>e(b))}get(e){return(e=this._deferreds.get(e))?e.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,
l){const b=this.get(e);if(b)return b;const p=new AbortController;let c=null;l&&(c=x.onAbort(l,()=>p.abort()));const d=()=>{a.remove();null!=c&&c.remove();this._deferreds.delete(e);this._controllers.delete(e);this._queue.remove(e);this._processingItems.delete(e);this._scheduleNext()},a=x.onAbortOrThrow(p.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort();d();n.reject(x.createAbortError())}),n=x.createResolver();this._deferreds.set(e,n);this._controllers.set(e,p);n.promise.then(d,
d);this._queue.push(e);this._scheduleNext();return n.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(l=>e.push(l));this._processingItems.clear();for(const l of e)this._queue.push(l.item),l.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());
this.clear();return e}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=r.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&
(this._schedule.remove(),this._schedule=null)}_processResult(e,l){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(l))}_processError(e,l){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(l))}_canProcessFulfillment(e){return this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e?!0:!1}_process(e){if(null!=e){var l=new AbortController,b=new k(e,l);this._processingItems.set(e,b);try{var p=this.process(e,l.signal)}catch(c){this._processError(b,
c)}x.isPromiseLike(p)?(b.promise=p,p.then(c=>this._processResult(b,c),c=>this._processError(b,c))):this._processResult(b,p)}}get test(){return{update:e=>this.runTask(e)}}}g.QueueProcessor=f;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(g,q){class x{constructor(){this._map=new Map;this._observable=new q.SimpleObservable}get size(){g.trackAccess(this._observable);
return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(w){(w=this._map.delete(w))&&this._observable.notify();return w}entries(){g.trackAccess(this._observable);return this._map.entries()}forEach(w,C){g.trackAccess(this._observable);this._map.forEach((r,m)=>w.call(C,r,m,this),C)}get(w){g.trackAccess(this._observable);return this._map.get(w)}has(w){g.trackAccess(this._observable);return this._map.has(w)}keys(){g.trackAccess(this._observable);return this._map.keys()}set(w,
C){this._map.set(w,C);this._observable.notify();return this}values(){g.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){g.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return x})},"esri/views/2d/layers/features/sources/PagedFeatureSource":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/promiseUtils","./BaseFeatureSource"],function(g,
q,x,w,C){class r extends C.BaseFeatureSource{constructor(m){super(m)}async _fetchDataTile(m){const k=this._subscriptions.get(m.key.id);let f=!1,e=0,l=0;const b=(d,a)=>{l--;w.throwIfAborted(k);const n=m.id,t=d.reader;d=d.query;t.exceededTransferLimit?(a={id:n,addOrUpdate:t,end:f&&0===l,type:"append"},k.add({message:a,query:d}),this._onMessage(a)):(f=!0,a={id:n,addOrUpdate:t,end:0===l,type:"append"},k.add({message:a,query:d}),this._onMessage(a))};let p=0,c=0;for(;!f&&20>c++;){let d;for(let a=0;a<p+
1;a++){const n=e++;l++;d=this._fetchDataTilePage(m,n,k).then(t=>t&&b(t,n)).catch(t=>{f=!0;if(!w.isAbortError(t)){x.getLogger("esri.views.2d.layers.features.sources.PagedFeatureSource").error(new q("mapview-query-error","Encountered error when fetching tile",{tile:m,error:t}));t={id:m.id,addOrUpdate:null,end:f,type:"append"};var v={start:this.pageSize*e,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:m.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(v.maxRecordCountFactor=
this.maxRecordCountFactor);v=this.createTileQuery(m,v);k.add({message:t,query:v});this._onMessage(t)}})}await d;w.throwIfAborted(k);p=Math.min(p+2,6)}}async _fetchDataTilePage(m,k,f){w.throwIfAborted(f);const e=this._queryInfo;var l={start:this.pageSize*k,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:m.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(l.maxRecordCountFactor=this.maxRecordCountFactor);l=this.createTileQuery(m,l);try{const b=await this.enqueueQuery({tile:m,
query:l,signal:f.signal,depth:k});w.throwIfAborted(f);return b?e!==this._queryInfo?this._fetchDataTilePage(m,k,f):{reader:b,query:l}:null}catch(b){return w.throwIfNotAbortError(b),null}}}g.PagedFeatureSource=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/SnapshotFeatureSource":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ./BaseFeatureSource ../support/FeatureSetReaderPBFIndirect ../support/UpdateToken".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){function b(c,d,a){var n=c.getXHydrated();c=c.getYHydrated();n=d.getColumnForX(n);n=Math.floor(d.normalizeCol(n));d=Math.floor(d.getRowForY(c));return`${a}/${d}/${n}`}function p(c,d){if(null==c)return null;d=d.transform;const a=c.getQuantizationTransform();if(null==a){const [F,D]=d.scale,[B,u]=d.translate;return c.transform(-B/F,u/D,1/F,1/-D)}const [n,t]=a.scale,[v,y]=a.translate,[h,A]=d.scale,[E,z]=d.translate;return c.transform((v-E)/h,(-y+z)/A,n/h,t/A)}g.SnapshotFeatureSource=
class extends f.BaseFeatureSource{constructor(c){super(c);this.mode="snapshot";this._loading=!0;this._controller=new AbortController;this._downloadPromise=null;this._didSendEnd=!1;this._queries=[];this._hasAggregates=this._invalidated=!1;this._random=new m(1E3);this._store=c.store;this._markedIdsBufId=this._store.storage.createBitset()}destroy(){super.destroy();this._controller.abort()}get loading(){return this._loading}get _signal(){return this._controller.signal}update(c,d){super.update(c,d);this._featureCount??
(this._featureCount=d.initialFeatureCount);null!=d.changedFeatureCount&&(this._featureCount=d.changedFeatureCount);this._hasAggregates=!!c.targets?.aggregate}async resend(c=!1){await this._downloadPromise;this._invalidated||c?(c=this._featureCount,C.assertIsSome(c,"Expected featureCount to be defined"),this._invalidated=!1,this._subscriptions.forEach(d=>d.clear()),this._downloadPromise=this._download(c),await this._downloadPromise):(c=this._queries.map(({query:d,reader:a})=>this._sendPatchQuery(d,
a)),await Promise.all(c),this._subscriptions.forEach(d=>{d.requests.done.forEach(a=>this._onMessage(a.message))}))}async refresh(c,d){d&&(this._featureCount=d.featureCount);await this.resend(!0)}async _sendPatchQuery(c,d){const a=null!=c.outFields?c.outFields:[],n=this._queryInfo.outFields,t=n.filter(h=>!a.includes(h));if(t.length){var v=c.clone(),y=this._signal;v.returnGeometry=!1;v.returnCentroid=!1;v.outFields=t;c.outFields=n;c=await this.enqueueQuery({query:v,depth:0,signal:y});r.throwIfAborted({signal:y});
d.joinAttributes(c)}}async _fetchDataTile(c){this._downloadPromise??(this._downloadPromise=this._download(this._featureCount));var d=this._store.search(c);const a=this._subscriptions.get(c.key.id),n=d.length-1;for(let v=0;v<n;v++){var t=p(d[v],c);t={type:"append",id:c.id,addOrUpdate:t,end:!1,status:l.UpdateToken.empty()};a.add({query:null,message:t});this._hasAggregates||await r.after(1);this._onMessage(t)}d=p(0<=n?d[n]:null,c);c={type:"append",id:c.id,addOrUpdate:d,end:this._didSendEnd,status:l.UpdateToken.empty()};
a.add({query:null,message:c});this._onMessage(c)}async _download(c){try{await this.whenInitialized();const d=this._store.storage.getBitset(this._markedIdsBufId),a=new Set;d.clear();const n=Array.from({length:Math.ceil(c/this.pageSize)},(t,v)=>v).sort((t,v)=>this._random.getInt()-this._random.getInt()).map(t=>this._downloadPage(t,d,a));await Promise.all(n);this._store.sweepFeatures(d,this._store.storage);this._store.sweepFeatureSets(a)}catch(d){w.getLogger("esri.views.2d.layers.features.sources.SnapshotFeatureSource").error("mapview-snapshot-source",
"Encountered and error when downloading feature snapshot",d)}this._sendEnd();this._loading=!1}async _downloadPage(c,d,a){var n=this.pageSize;n={start:c*n,num:n,cacheHint:!0};null!=this.maxRecordCountFactor&&(n.maxRecordCountFactor=this.maxRecordCountFactor);n=this.createQuery(n);const t=this._signal;c=await this.enqueueQuery({query:n,depth:c,signal:t});r.throwIfAborted({signal:t});this._queries.push({query:n,reader:c});this._store.insert(c);a.add(c.instance);for(a=c.getCursor();a.next();)d.set(a.getDisplayId());
this._send(c)}_send(c){if(this._subscriptions.size){var d=null,a=new Map,n=new Set,t=new Map;this._subscriptions.forEach(y=>{var h=y.tile;a.set(h.key.id,null);d=h.tileInfoView;n.add(h.level);const {row:A,col:E}=h.key;h=`${h.level}/${A}/${E}`;const z=t.get(h)??[];z.push(y);t.set(h,z)});for(const y of n){const h=d.getLODInfoAt(y),A=c.getCursor();for(;A.next();){var v=b(A,h,y);const E=A.getIndex();if(t.has(v))for(const z of t.get(v)){v=z.tile.id;let F=a.get(v);null==F&&(F=[],a.set(v,F));F.push(E)}}}a.forEach((y,
h)=>{if(null!=y){const A=this._subscriptions.get(h);y=p(e.FeatureSetReaderIndirect.from(c,y),A.tile);h={type:"append",id:h,addOrUpdate:y,end:!1,status:l.UpdateToken.empty()};A.add({query:null,message:h});this._onMessage(h)}})}}_sendEnd(){this._subscriptions.forEach(c=>{const d={type:"append",id:c.tile.id,addOrUpdate:null,end:!0,status:l.UpdateToken.empty()};c.add({query:null,message:d});this._onMessage(d)});this._didSendEnd=!0}};g.SnapshotFeatureSource=q.__decorate([k.subclass("esri.view.2d.layers.features.sources.SnapshotFeatureSource")],
g.SnapshotFeatureSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamSource":function(){define("exports ../../../../../core/handleUtils ../../../../../core/has ../../../../../chunks/rbush ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../../../layers/graphics/data/StreamFeatureManager ../../../../../layers/graphics/sources/connections/createConnection ./DataTileSource ./StreamConnectionState ../support/FeatureSetReaderJSON ../support/UpdateToken".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b){function p(t,v){const y=t.weakClone();if(null!=t.geometry){const h=C.quantizeX(v,t.geometry.coords[0]);t=C.quantizeY(v,t.geometry.coords[1]);y.geometry=new r([],[h,t])}return y}function c(t){switch(t){case "esriGeometryPoint":return p;default:return(v,y)=>{const h=v.weakClone(),A=new r;v=C.quantizeOptimizedGeometry(A,v.geometry,!1,!1,t,y,!1,!1);h.geometry=v;return h}}}function d(t){switch(t){case "esriGeometryPoint":return v=>null!=v.geometry?{minX:v.geometry.coords[0],
minY:v.geometry.coords[1],maxX:v.geometry.coords[0],maxY:v.geometry.coords[1]}:{minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};default:return v=>{let y=Infinity,h=Infinity,A=-Infinity,E=-Infinity;null!=v.geometry&&v.geometry.forEachVertex((z,F)=>{y=Math.min(y,z);h=Math.min(h,F);A=Math.max(A,z);E=Math.max(E,F)});return{minX:y,minY:h,maxX:A,maxY:E}}}}class a{constructor(t,v){this.onUpdate=t;this._geometryType=v;this._objectIdToFeature=new Map;this._index=null}get _features(){const t=[];
this._objectIdToFeature.forEach(v=>t.push(v));return t}add(t){this._objectIdToFeature.set(t.objectId,t);this._index=null}get(t){return this._objectIdToFeature.has(t)?this._objectIdToFeature.get(t):null}forEach(t){this._objectIdToFeature.forEach(t)}search(t){if(!this._index){var v=this._features;const y=w.rbush(9,d(this._geometryType));y.load(v);this._index=y}return this._index.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}clear(){this._index=null;this._objectIdToFeature.clear()}removeById(t){const v=
this._objectIdToFeature.get(t);return v?(this._objectIdToFeature.delete(t),this._index=null,v):null}update(t,v){this.onUpdate(t,v)}get size(){return this._objectIdToFeature.size}}class n extends f.DataTileSource{constructor(t){super(t);this.type="stream";this._level=this._updateIntervalId=0;this._isPaused=!1;this._updateInfo={websocket:0,client:0};this._inUpdate=!1;var {outSR:v}=t;const {geometryType:y,objectIdField:h,timeInfo:A,purgeOptions:E,source:z,spatialReference:F,serviceFilter:D,maxReconnectionAttempts:B,
maxReconnectionInterval:u,updateInterval:H,customParameters:G,enabledEventTypes:I}=t.serviceInfo,J=new a(this._onUpdate.bind(this),y),M=new m.StreamFeatureManager(J,h,A,E);v=k.createConnection(z,F,v,y,D,B,u,G??{});this._connectionState=new e.StreamConnectionState({connection:v});this._store=J;this._manager=M;this._connection=v;this._quantize=c(y);this._enabledEventTypes=new Set(I);this._handlesGroup=q.handlesGroup([this._connection.on("data-received",R=>this._onFeature(R)),this._connection.on("message-received",
R=>this._onWebSocketMessage(R))]);this._initUpdateInterval=()=>{let R=performance.now();this._updateIntervalId=setInterval(()=>{var Y=performance.now(),fa=Y-R;2500<fa&&(R=Y,Y=Math.round(this._updateInfo.client/(fa/1E3)),fa=Math.round(this._updateInfo.websocket/(fa/1E3)),this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:Y,websocket:fa}));t.canAcceptRequest()&&!this._inUpdate&&this._manager.checkForUpdates()},H)};(this._isPaused=t.serviceInfo.isPaused)||this._initUpdateInterval()}destroy(){super.destroy();
this._clearUpdateInterval();this._connection.destroy();this._handlesGroup?.remove()}_fetchDataTile(){}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState.errorString}updateCustomParameters(t){this._connection.updateCustomParameters(t)}pauseStream(){this._isPaused||(this._isPaused=!0,this._clearUpdateInterval())}resumeStream(){this._isPaused&&(this._isPaused=!1,this._initUpdateInterval())}sendMessageToSocket(t){this._connection.sendMessageToSocket(t)}sendMessageToClient(t){this._isPaused&&
"type"in t&&"clear"===t.type?(this._store.clear(),this._subscriptions.forEach((v,y)=>{v.didSend&&v.tile.level===this._level&&this._onMessage({type:"append",id:y,addOrUpdate:null,clear:!0,end:!0})})):this._connection.sendMessageToClient(t)}enableEvent(t,v){v?this._enabledEventTypes.add(t):this._enabledEventTypes.delete(t)}subscribe(t,v){v=super.subscribe(t,v);this._level=t.level;const y=this._getTileFeatures(t);this._onMessage({type:"append",id:t.key.id,addOrUpdate:y,end:!0});v.didSend=!0;return v}unsubscribe(t){super.unsubscribe(t)}*readers(t){t=
this._subscriptions.get(t);({tile:t}=t);yield this._getTileFeatures(t)}createTileQuery(t){throw Error("Service does not support tile  queries");}async resend(){this._subscriptions.forEach(t=>{({tile:t}=t);t={type:"append",id:t.id,addOrUpdate:this._getTileFeatures(t),end:!0};this._onMessage(t)})}_getTileFeatures(t){const v=this._store.search(t).map(y=>this._quantize(y,t.transform));return l.FeatureSetReaderJSON.fromOptimizedFeatures(v,this._arcadeLayerSchema,t.transform)}_onWebSocketMessage(t){this._enabledEventTypes.has("message-received")&&
this.events.emit("message-received",t);if("type"in t)switch(t.type){case "delete":if(t.objectIds)for(const v of t.objectIds)this._manager.removeById(v);if(t.trackIds)for(const v of t.trackIds)this._manager.removeByTrackId(v);break;case "clear":this._store.forEach(v=>this._manager.removeById(v.objectId))}}_onFeature(t){this._updateInfo.websocket++;try{this._enabledEventTypes.has("data-received")&&this.events.emit("data-received",t);const v=C.convertFromFeature(t,this._serviceInfo.geometryType,!1,!1,
this._serviceInfo.objectIdField);this._manager.add(v)}catch(v){}}_clearUpdateInterval(){clearInterval(this._updateIntervalId);this._updateIntervalId=0}async _onUpdate(t,v){this._inUpdate=!0;try{null!=t&&(this._updateInfo.client+=t.length);this._subscriptions.forEach((h,A)=>{h.didSend&&h.tile.level===this._level&&this._onMessage({type:"append",id:A,addOrUpdate:null,clear:!0,end:!1})});const y=[];this._subscriptions.forEach((h,A)=>{if(h.didSend&&h.tile.level===this._level){var E=this._getTileFeatures(h.tile);
A={type:"append",id:A,addOrUpdate:E,remove:[],end:!1,status:b.UpdateToken.empty()};h.requests.stream.enqueue(A);y.push(this._onMessage(A))}});await Promise.all(y);this._subscriptions.forEach((h,A)=>{h.didSend&&h.tile.level===this._level&&this._onMessage({type:"append",id:A,addOrUpdate:null,end:!0})})}catch{}this._inUpdate=!1}}g.StreamSource=n;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/StreamFeatureManager":function(){define(["exports","../../../core/CircularArray",
"../../../core/mathUtils"],function(g,q,x){class w{constructor(C,r,m,k,f=128){this._trackIdToObservations=new Map;this._idCounter=0;this._lastPurge=performance.now();this._addOrUpdated=new Map;this._removed=[];this._maxAge=0;this._timeInfo=m;this._purgeOptions=k;this.store=C;this.objectIdField=r;this.purgeInterval=f;this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(C){this._removed.push(C)}removeByTrackId(C){if(C=this._trackIdToObservations.get(C))for(const r of C.entries)this._removed.push(r)}add(C){if(this._useGeneratedIds){var r=
this._nextId();C.attributes[this.objectIdField]=r;C.objectId=r}else C.objectId=C.attributes[this.objectIdField];r=C.objectId;this._addOrUpdated.set(r,C);this._maxAge=Math.max(this._maxAge,C.attributes[this._timeInfo.startTimeField]);if(this._timeInfo.trackIdField){C=C.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(C)){const m=x.clamp(null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1E3,0,1E3);this._trackIdToObservations.set(C,new q(m))}r=this._trackIdToObservations.get(C)?.enqueue(r);
null!=r&&(this._addOrUpdated.has(r)?this._addOrUpdated.delete(r):this._removed.push(r))}else null==this._trackIdLessObservations&&(this._trackIdLessObservations=new q(1E5)),this._trackIdLessObservations.enqueue(r)}checkForUpdates(){const C=this._getToAdd();var r=this._getToRemove();const m=performance.now();m-this._lastPurge>=this.purgeInterval&&(this._purge(m),this._lastPurge=m);const k=[];if(null!=r)for(var f of r){const e=this.store.removeById(f);null!=e&&k.push(e)}f=[];if(null!=C){r=new Set(r??
[]);for(const e of C)r.has(e.objectId)||(e.attributes.__esri_timestamp__=m,this.store.add(e),f.push(e))}(f.length||k?.length)&&this.store.update(f,k)}_getToAdd(){if(!this._addOrUpdated.size)return null;const C=Array(this._addOrUpdated.size);let r=0;this._addOrUpdated.forEach(m=>C[r++]=m);this._addOrUpdated.clear();return C}_getToRemove(){const C=this._removed;if(!this._removed.length)return null;this._removed=[];return C}_nextId(){const C=this._idCounter;this._idCounter=(this._idCounter+1)%4294967294+
1;return C}_purge(C){const r=this._purgeOptions;null!=r&&(this._purgeSomeByDisplayCount(r),this._purgeByAge(r),this._purgeByAgeReceived(C,r),this._purgeTracks())}_purgeSomeByDisplayCount(C){if(C.displayCount){var r=this.store.size;if(r>C.displayCount){if(this._timeInfo.trackIdField)for(const m of this._trackIdToObservations.values())if(r>C.displayCount&&m.size){const k=m.dequeue();this._removed.push(k);r--}if(null!=this._trackIdLessObservations)for(C=r-C.displayCount;0<C--;)r=this._trackIdLessObservations.dequeue(),
null!=r&&this._removed.push(r)}}}_purgeByAge(C){const r=this._timeInfo?.startTimeField;if(C.age&&r){var m=this._maxAge-6E4*C.age;this.store.forEach(k=>{k.attributes[r]<m&&this._removed.push(k.objectId)})}}_purgeByAgeReceived(C,r){if(r.ageReceived){var m=C-6E4*r.ageReceived;this.store.forEach(k=>{k.attributes.__esri_timestamp__<m&&this._removed.push(k.objectId)})}}_purgeTracks(){this._trackIdToObservations.forEach((C,r)=>{0===C.size&&this._trackIdToObservations.delete(r)})}}g.StreamFeatureManager=
w;g.defaultStreamIdField="__esri_stream_id__";g.esriTimestamp="__esri_timestamp__";Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/createConnection":function(){define(["exports","./GeoEventConnection","./WebSocketConnection","../../../support/ClientSideConnection"],function(g,q,x,w){g.createConnection=function(C,r,m,k,f,e,l,b){r={source:C,sourceSpatialReference:r,spatialReference:m,geometryType:k,filter:f,maxReconnectionAttempts:e,maxReconnectionInterval:l,
customParameters:b};return C?C.path.startsWith("wss://")||C.path.startsWith("ws://")?new x.WebSocketConnection(r):new q(r):new w.ClientSideConnection(r)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/GeoEventConnection":function(){define("require ../../../../chunks/tslib.es6 ../../../../geometry ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./WebSocketConnection ../../../../rest/query/operations/query ../../../../rest/support/Query ../../../../geometry/support/jsonUtils ../../../../geometry/SpatialReference".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n){const t={maxQueryDepth:5,maxRecordCountFactor:3};x=class extends p.WebSocketConnection{constructor(v){super({...t,...v});this._relatedFeatures=this._buddyServicesQuery=null}async _open(){var v=await this._fetchServiceDefinition(this._config.source);v.timeInfo.trackIdField||r.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");
v=this._fetchWebSocketUrl(v.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices());await this._buddyServicesQuery;await this._tryCreateWebSocket(v);const {filter:y,outFields:h}=this._config;this.destroyed||this._setFilter(y,h)}_onMessage(v){if("attributes"in v){let y;try{y=this._enrich(v),null!=this._featureZScaler&&this._featureZScaler(y.geometry)}catch(h){r.getLogger(this).error(new C("geoevent-connection","Failed to parse message",
h));return}this.onFeature(y)}else this.onMessage(v)}async _fetchServiceDefinition(v){return this._serviceDefinition=v=(await w(v.path,{query:{f:"json",...this._config.customParameters},responseType:"json"})).data}_fetchWebSocketUrl(v,y){const {urls:h,token:A}=v[0];v=this._inferWebSocketBaseUrl(h);return k.addQueryParameters(`${v}/subscribe`,{outSR:""+y.wkid,token:A})}_inferWebSocketBaseUrl(v){if(1===v.length)return v[0];for(const y of v)if(y.includes("wss"))return y;r.getLogger(this).error(new C("geoevent-connection",
"Unable to infer WebSocket url",v));return null}async _setFilter(v,y){const h=this._websocket;if(null!=h&&(null!=v||null!=y)){v=JSON.stringify({filter:this._serializeFilter(v,y)});var A=!1,E=m.createResolver();h.onmessage=z=>{z=JSON.parse(z.data);z.filter&&(z.error&&(r.getLogger(this).error(new C("geoevent-connection","Failed to set service filter",z.error)),this._set("errorString",`Could not set service filter - ${z.error}`),E.reject(z.error)),this._setWebSocketJSONParseHandler(h),A=!0,E.resolve())};
h.send(v);setTimeout(()=>{A||(this.destroyed||this._websocket!==h||r.getLogger(this).error(new C("geoevent-connection","Server timed out when setting filter")),E.reject())},1E4);return E.promise}}_serializeFilter(v,y){const h={};if(null==v&&null==y)return h;if(v?.geometry)try{const A=a.fromJSON(v.geometry);if("extent"!==A.type)throw new C(`Expected extent but found type ${A.type}`);h.geometry=JSON.stringify(A.shiftCentralMeridian())}catch(A){r.getLogger(this).error(new C("geoevent-connection","Encountered an error when setting connection geometryDefinition",
A))}v?.where&&"1 \x3d 1"!==v.where&&"1\x3d1"!==v.where&&(h.where=v.where);null!=y&&(h.outFields=y.join(","));return h}_enrich(v){if(!this._relatedFeatures)return v;const y=this._relatedFeatures.get(v.attributes[this._serviceDefinition.relatedFeatures.joinField]);if(!y)return r.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",v),v;const {attributes:h,geometry:A}=y;for(const E in h)v.attributes[E]=h[E];A&&(v.geometry=A);v.geometry||v.centroid||
r.getLogger(this).error(new C("geoevent-connection","Found malformed feature - no geometry found",v));return v}async _queryBuddyServices(){try{const {relatedFeatures:v,keepLatestArchive:y}=this._serviceDefinition,h=this._queryRelatedFeatures(v),A=this._queryArchive(y);await h;const E=await A;if(E)for(const z of E.features)this.onFeature(this._enrich(z))}catch(v){r.getLogger(this).error(new C("geoevent-connection","Encountered an error when querying buddy services",{error:v}))}}async _queryRelatedFeatures(v){v&&
(v=await this._queryBuddy(v.featuresUrl),this._addRelatedFeatures(v))}async _queryArchive(v){if(v)return this._queryBuddy(v.featuresUrl)}async _queryBuddy(v){const y=new (await new Promise((B,u)=>g(["../../../FeatureLayer"],H=>B(Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}))),u))).default({url:v});var {capabilities:h}=await y.load();const A=h.query.supportsMaxRecordCountFactor,E=h.query.supportsPagination;h=h.query.supportsCentroid;const z=this._config.maxRecordCountFactor;
var F=y.capabilities.query.maxRecordCount;F=A?F*z:F;const D=new d;D.outFields=this._config.outFields??["*"];D.where=this._config.filter?.where??"1\x3d1";D.returnGeometry=!0;D.returnExceededLimitFeatures=!0;D.outSpatialReference=n.fromJSON(this._config.spatialReference);h&&(D.returnCentroid=!0);A&&(D.maxRecordCountFactor=z);if(E)return D.num=F,y.destroy(),this._queryPages(v,D);v=await c.executeQuery(v,D,this._config.sourceSpatialReference);y.destroy();return v.data}async _queryPages(v,y,h=[],A=0){y.start=
null!=y.num?A*y.num:null;const {data:E}=await c.executeQuery(v,y,this._config.sourceSpatialReference);if(E.exceededTransferLimit&&A<(this._config.maxQueryDepth??0))return E.features.forEach(z=>h.push(z)),this._queryPages(v,y,h,A+1);h.forEach(z=>E.features.push(z));return E}_addRelatedFeatures(v){const y=new Map;v=v.features;const h=this._serviceDefinition.relatedFeatures.joinField;for(const A of v)y.set(A.attributes[h],A);this._relatedFeatures=y}};return x=q.__decorate([b.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],
x)})},"esri/layers/graphics/sources/connections/WebSocketConnection":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/zscale ../../../support/StreamConnection".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p){var c;(function(d){d[d.CONNECTING=0]="CONNECTING";d[d.OPEN=1]="OPEN";d[d.CLOSING=2]="CLOSING";d[d.CLOSED=3]="CLOSED"})(c||(c={}));g.WebSocketConnection=class extends p{constructor(d){super();this._outstandingMessages=[];this.errorString=null;const {geometryType:a,spatialReference:n,sourceSpatialReference:t}=d;this._config=d;this._featureZScaler=b.getGeometryZScaler(a,t,n);this._open()}async _open(){await this._tryCreateWebSocket();this.destroyed||await this._handshake()}destroy(){super.destroy();
null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close());this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case c.CONNECTING:case c.OPEN:return"connected";case c.CLOSING:case c.CLOSED:return"disconnected"}}sendMessageToSocket(d){null==this._websocket?this._outstandingMessages.push(d):this._websocket.send(JSON.stringify(d))}sendMessageToClient(d){this._onMessage(d)}updateCustomParameters(d){this._config.customParameters=
d;null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(d=this._config.source.path,a=1E3,n=0){try{if(!this.destroyed){var t=r.addQueryParameters(d,this._config.customParameters??{});this._websocket=await this._createWebSocket(t);this.notifyChange("connectionStatus")}}catch(v){if(t=a/1E3,this._config.maxReconnectionAttempts&&n>=this._config.maxReconnectionAttempts)w.getLogger(this).error(new x("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),
this.destroy();else return w.getLogger(this).error(new x("websocket-connection",`Failed to connect. Attempting to reconnect in ${t}s`,v)),await C.after(a),this._tryCreateWebSocket(d,Math.min(1.5*a,1E3*this._config.maxReconnectionInterval),n+1)}}_setWebSocketJSONParseHandler(d){d.onmessage=a=>{try{const n=JSON.parse(a.data);this._onMessage(n)}catch(n){w.getLogger(this).error(new x("websocket-connection","Failed to parse message, invalid JSON",{error:n}))}}}_createWebSocket(d){return new Promise((a,
n)=>{const t=new WebSocket(d);t.onopen=()=>{t.onopen=null;this.destroyed?(t.onclose=null,t.close()):(t.onclose=v=>this._onClose(v),t.onerror=v=>this._onError(v),this._setWebSocketJSONParseHandler(t),a(t))};t.onclose=v=>{t.onopen=t.onclose=null;n(v)}})}async _handshake(d=1E4){const a=this._websocket;if(null!=a){var n=C.createResolver(),t=a.onmessage,{filter:v,outFields:y,spatialReference:h}=this._config;n.timeout(d);a.onmessage=A=>{let E=null;try{E=JSON.parse(A.data)}catch(z){}E&&"object"===typeof E||
(w.getLogger(this).error(new x("websocket-connection","Protocol violation. Handshake failed - malformed message",A.data)),n.reject(),this.destroy());E.spatialReference?.wkid!==h?.wkid&&(w.getLogger(this).error(new x("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${h.wkid}`,A.data)),n.reject(),this.destroy());"json"!==E.format&&(w.getLogger(this).error(new x("websocket-connection","Protocol violation. Handshake failed - format is not set",A.data)),n.reject(),this.destroy());
v&&E.filter!==v&&w.getLogger(this).error(new x("websocket-connection","Tried to set filter, but server doesn't support it"));y&&E.outFields!==y&&w.getLogger(this).error(new x("websocket-connection","Tried to set outFields, but server doesn't support it"));a.onmessage=t;for(const z of this._outstandingMessages)a.send(JSON.stringify(z));this._outstandingMessages=[];n.resolve()};a.send(JSON.stringify({filter:v,outFields:y,format:"json",spatialReference:{wkid:h.wkid}}));return n.promise}}_onMessage(d){this.onMessage(d);
if("type"in d)switch(d.type){case "features":case "featureResult":for(const a of d.features)null!=this._featureZScaler&&this._featureZScaler(a.geometry),this.onFeature(a)}}_onError(d){this._set("errorString","Encountered an error over WebSocket connection");w.getLogger(this).error("websocket-connection","Encountered an error over WebSocket connection")}_onClose(d){this._websocket=null;this.notifyChange("connectionStatus");1E3!==d.code&&w.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${d.code}`);
this.destroyed||this._open()}};q.__decorate([m.property()],g.WebSocketConnection.prototype,"connectionStatus",null);q.__decorate([m.property()],g.WebSocketConnection.prototype,"errorString",void 0);g.WebSocketConnection=q.__decorate([l.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],g.WebSocketConnection);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/StreamConnection":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m,k){x=class extends x.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new q("stream-connection",this.errorString):null}onFeature(f){this.emit("data-received",f)}onMessage(f){this.emit("message-received",f)}};g.__decorate([w.property({readOnly:!0})],x.prototype,"connectionError",null);return x=g.__decorate([k.subclass("esri.layers.support.StreamConnection")],x)})},"esri/layers/support/ClientSideConnection":function(){define("exports ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/zscale ./StreamConnection".split(" "),
function(g,q,x,w,C,r,m,k,f){g.ClientSideConnection=class extends f{constructor(e){super();this.connectionStatus="connected";this.errorString=null;const {geometryType:l,spatialReference:b,sourceSpatialReference:p}=e;this._featureZScaler=k.getGeometryZScaler(l,p,b)}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if("type"in e)switch(e.type){case "features":case "featureResult":for(const l of e.features)null!=this._featureZScaler&&this._featureZScaler(l.geometry),this.onFeature(l)}this.onMessage(e)}};
q.__decorate([x.property()],g.ClientSideConnection.prototype,"connectionStatus",void 0);q.__decorate([x.property()],g.ClientSideConnection.prototype,"errorString",void 0);g.ClientSideConnection=q.__decorate([m.subclass("esri.layers.support.ClientSideConnection")],g.ClientSideConnection);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamConnectionState":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor",
"../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass"],function(g,q,x,w,C){g.StreamConnectionState=class extends x{constructor(r){super(r)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}};q.__decorate([w.property()],g.StreamConnectionState.prototype,"connection",void 0);q.__decorate([w.property()],g.StreamConnectionState.prototype,"connectionStatus",null);q.__decorate([w.property()],
g.StreamConnectionState.prototype,"errorString",null);g.StreamConnectionState=q.__decorate([C.subclass("esri.views.2d.layers.features.sources.StreamConnectionState")],g.StreamConnectionState);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("require ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../core/support/UpdatingHandles ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/util/debug ../tileRenderers/support/visualVariablesUtils ../../../../webgl/enums".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d){function a(E,z){return F=>z(E(F))}const n=w.getLogger("esri.views.layers.2d.features.support.AttributeStore"),t=p.createDebugLogger(p.debugAttrUpdates,n);var v=x("esri-shared-array-buffer"),y=x("esri-atomics");class h{constructor(E,z,F,D){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:B,layout:u,textureOnly:H}=D;this.textureOnly=H||!1;this.pixelType=B;this._ctype=z;this.layout=u;this._resetRange();this._shared=E;this.size=F;H||
(this.data=this._initData(B,F,E,z))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(E,z){const F=this.data;for(let D=0;D<this.size*this.size;D++)F[D*this.texelSize+E]&=~z;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(E,z){const F=this.data;for(let D=0;D<this.size*this.size;D++)F[D*this.texelSize+E]|=255&z;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(E,z,F){const D=this.data;for(const B of F)D[B*this.texelSize+E]|=z,this.dirtyStart=
Math.min(this.dirtyStart,B),this.dirtyEnd=Math.max(this.dirtyEnd,B)}setComponentTexel(E,z,F){this.data[F*this.texelSize+E]|=z;this.dirtyStart=Math.min(this.dirtyStart,F);this.dirtyEnd=Math.max(this.dirtyEnd,F)}unsetComponentTexel(E,z,F){this.data[F*this.texelSize+E]&=~z;this.dirtyStart=Math.min(this.dirtyStart,F);this.dirtyEnd=Math.max(this.dirtyEnd,F)}getData(E,z){E=l.getDisplayIdTexel(E);return this.data[E*this.texelSize+z]}setData(E,z,F){E=l.getDisplayIdTexel(E);0===(this.layout&1<<z)?n.error("mapview-attributes-store",
"Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[E*this.texelSize+z]=F,this.dirtyStart=Math.min(this.dirtyStart,E),this.dirtyEnd=Math.max(this.dirtyEnd,E))}lock(){this.pixelType===d.PixelType.UNSIGNED_BYTE&&this._shared&&y&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===d.PixelType.UNSIGNED_BYTE&&this._shared&&y&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(E){this.size=E;this.textureOnly||(E=this._initData(this.pixelType,
E,this._shared,this._ctype),E.set(this.data),this.data=E)}toMessage(){const E=this.dirtyStart,z=this.dirtyEnd;var F=this.texelSize;if(E>z)return null;this._resetRange();const D=this.pixelType,B=this.layout,u=this.data;F=!this._shared&&"local"!==this._ctype&&u.slice(E*F,(z+1)*F)||null;return{start:E,end:z,data:F,pixelType:D,layout:B}}_initData(E,z,F,D){F=F&&"local"!==D?SharedArrayBuffer:ArrayBuffer;E=b.getPixelArrayCtor(E);z=new E(new F(z*z*4*E.BYTES_PER_ELEMENT));for(E=0;E<z.length;E+=4)z[E+1]=255;
return z}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class A{constructor(E,z){this._client=E;this.config=z;this.updatingHandles=new k.UpdatingHandles;this._blocks=[];this._filters=Array(e.maxFilters);this._attributeComputeInfo=null;this._targetType=0;this._abortController=new AbortController;this._hasScaleExpr=!1;this._size=32;this._currUpdate=this._nextUpdate=null;this._idsToHighlight=new Set;E=z.supportsTextureFloat?d.PixelType.FLOAT:d.PixelType.UNSIGNED_BYTE;t(`Creating AttributeStore ${v?
"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:d.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:d.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:d.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:E,layout:15},{pixelType:E,layout:15},{pixelType:E,layout:15},{pixelType:E,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort();this.updatingHandles.destroy()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return 0<
this._idsToHighlight.size}isUpdating(){const E=this.updatingHandles.updating||!!this._nextUpdate;x("esri-2d-log-updating")&&console.log(`Updating AttributeStore: ${E}\n  -> updatingHandles ${this.updatingHandles.updating} (currUpdate: ${!!this._currUpdate})\n  -> nextUpdate: ${!!this._nextUpdate}\n`);return E}update(E,z){this.config=z;z=z.schema.processors[0].storage;const F=m.diff(this._schema,z);if(E.targets.feature||E.targets.aggregate)E.storage.data=!0;if(F&&(x("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",
F),E.storage.data=!0,this._schema=z,this._attributeComputeInfo=null,null!=z)){switch(z.target){case "feature":this._targetType=l.displayIdTypeFeature;break;case "aggregate":this._targetType=l.displayIdTypeAggregate}if("subtype"===z.type){this._attributeComputeInfo={isSubtype:!0,subtypeField:z.subtypeField,map:new Map};for(const D in z.mapping)if(E=z.mapping[D],null!=E?.vvMapping)for(const B of E.vvMapping)this._bindAttribute(B,parseInt(D,10))}else{this._attributeComputeInfo={isSubtype:!1,map:new Map};
if(null!=z.vvMapping)for(const D of z.vvMapping)this._bindAttribute(D);if(null!=z.attributeMapping)for(const D of z.attributeMapping)this._bindAttribute(D)}}}onTileData(E,z){if(null!=z.addOrUpdate)for(E=z.addOrUpdate.getCursor();E.next();)z=E.getDisplayId(),this.setAttributeData(z,E)}async setHighlight(E,z){const F=this._getBlock(0);z=z.map(D=>l.getDisplayIdTexel(D));F.lock();F.unsetComponentAllTexels(0,1);F.setComponent(0,1,z);F.unlock();this._idsToHighlight.clear();for(const D of E)this._idsToHighlight.add(D);
await this.sendUpdates()}async updateFilters(E,z,F){x("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters");const {service:D,spatialReference:B}=F;({filters:z}=z);z=z.map((u,H)=>this._updateFilter(u,H,D,B));z=(await Promise.all(z)).some(u=>u);x("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters - finsihed");z&&(E.storage.filters=!0,x("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(E,z,F,D){const B=l.getDisplayIdTexel(E);
this._ensureSizeForTexel(B);this._getBlock(z).setData(E,F,D)}getData(E,z,F){return this._getBlock(z).getData(E,F)}getHighlightFlag(E){return this._idsToHighlight.has(E)?e.highlightFlag:0}unsetAttributeData(E){E=l.getDisplayIdTexel(E);this._getBlock(0).setData(E,0,0)}setAttributeData(E,z){const F=l.getDisplayIdTexel(E);this._ensureSizeForTexel(F);this._getBlock(0).setData(F,0,this.getFilterFlags(z));if(this._targetType===l.getDisplayIdType(E)){E=this._attributeComputeInfo;var D=this.config.supportsTextureFloat?
1:2,B=null;E&&(B=E.isSubtype?E.map.get(z.readAttribute(E.subtypeField)):E.map,B?.size&&B.forEach((u,H)=>{const G=H*D%4;H=this._getBlock(Math.floor(H*D/4)+e.attributeDataVv);u=u(z);if(this.config.supportsTextureFloat)H.setData(F,G,u);else if(u===e.nanMagicNumber)H.setData(F,G,255),H.setData(F,G+1,255);else{u=C.clamp(Math.round(u),-32767,32766)+32768;const I=(u&65280)>>8;H.setData(F,G,u&255);H.setData(F,G+1,I)}}))}}sendUpdates(){x("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate");
if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=r.createResolver(),this.updatingHandles.addPromise(this._nextUpdate.promise),this._nextUpdate.promise;const E={blocks:this._blocks.map(z=>null!=z?z.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{var z=()=>{this._currUpdate=null;if(this._nextUpdate){const F=this._nextUpdate;this._nextUpdate=null;this.sendUpdates().then(()=>F.resolve())}else x("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::No additional updates queued")};
x("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::client.update");z=this.updatingHandles.addPromise(this._client.update(E,this._signal).then(z).catch(z));this._client.render(this._signal);return z}).catch(z=>{if(r.isAbortError(z))return this._createResourcesPromise=null,this._createResources();n.error(new q("mapview-attribute-store","Encountered an error during client update",z))})}_ensureSizeForTexel(E){for(;E>=this._size*this._size&&!this._expand(););}_bindAttribute(E,z){function F(){const {normalizationField:I}=
E;return I?J=>{const M=J.readAttribute(I);return M?J.readAttribute(E.field)/M:null}:J=>J.readAttribute(E.field)}function D(){E.normalizationField&&n.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported.");return I=>I.getComputedNumericAtIndex(E.fieldIndex)}let B;if(null!=E.fieldIndex)B=D();else if(E.field)B=F();else return;const {valueRepresentation:u}=E;u&&(B=a(B,I=>c.getVisualVariableSizeValueRepresentationRatio(I,u)));const H=I=>null===I||
isNaN(I)||Infinity===I||-Infinity===I?e.nanMagicNumber:I,G=this._attributeComputeInfo;if(G.isSubtype){const I=G.map.get(z)??new Map;I.set(E.binding,a(B,H));G.map.set(z,I)}else G.map.set(E.binding,a(B,H))}_createResources(){if(null!=this._createResourcesPromise)return this._createResourcesPromise;this._getBlock(e.attributeDataAnimation);this._getBlock(e.attributeDataGpgpu);t("Initializing AttributeStore");var E={shared:v&&"local"!==this._client.type,size:this._size,blocks:this._blocks.map(z=>null!=
z?{textureOnly:z.textureOnly,buffer:z.buffer,pixelType:z.pixelType}:null)};this._createResourcesPromise=E=this._client.initialize(E,this._signal).catch(z=>{r.isAbortError(z)?this._createResourcesPromise=null:n.error(new q("mapview-attribute-store","Encountered an error during client initialization",z))});E.then(()=>null==this._createResourcesPromise?this._createResources():void 0);return E}_getBlock(E){var z=this._blocks[E];if(null!=z)return z;t(`Initializing AttributeBlock at index ${E}`);z=new h(v,
this._client.type,this._size,this._blockDescriptors[E]);this._blocks[E]=z;this._createResourcesPromise=null;return z}_expand(){if(this._size<this.config.maxTextureSize){const E=this._size<<=1;t("Expanding block size to",E,this._blocks);for(const z of this._blocks)z?.expand(E);this._createResourcesPromise=null;this._size=E;return 0}n.error(new q("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}async _updateFilter(E,z,F,D){const B=this._filters[z];if(!B&&!E||(null!=B&&
B.hash)===JSON.stringify(E))return!1;if(null==E){if(!B)return!1;E=1<<z+1;F=this._getBlock(0);this._filters[z]=null;F.setComponentAllTexels(0,E);this.sendUpdates();return!0}await (await this._getFilter(z,F)).update(E,D);return!0}async _getFilter(E,z){var F=this._filters[E];if(null!=F)return F;({default:F}=await new Promise((D,B)=>g(["./FeatureFilter"],u=>D(Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}))),B)));z=new F({geometryType:z.geometryType,
hasM:!1,hasZ:!1,timeInfo:z.timeInfo,fieldsIndex:f.fromJSON(z.fieldsIndex)});return this._filters[E]=z}isVisible(E){return!!(this._getBlock(0).getData(E,0)&2)}getFilterFlags(E){let z=0;var F=l.getDisplayIdFilterMask(E.getDisplayId());for(let B=0;B<this._filters.length;B++){var D=this._filters[B];D=!(F&1<<B)||null==D||D.check(E);z|=(D?1:0)<<B}F=0;this._idsToHighlight.size&&(E=E.getObjectId(),F=this.getHighlightFlag(E));return z<<1|F}}return A})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],
function(g){g.aggregateValidFiltersMask=254;g.createDisplayId=function(q,x){return((x?8388608:0)|q)>>>0};g.displayIdTexelMask=8388607;g.displayIdTypeAggregate=1;g.displayIdTypeFeature=0;g.displayIdTypeMask=8388608;g.getDisplayIdFilterMask=q=>1===(q&8388608)>>>23?254:255;g.getDisplayIdTexel=q=>q&8388607;g.getDisplayIdType=q=>(q&8388608)>>>23;g.isAggregateId=function(q){return 1===(q&8388608)>>>23};g.nonAggregateValidFiltersMask=255;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ./enums ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(g,q,x,w,C,r,m){function k(J){const M={};for(const R of J)M[R.name]=R.strideInBytes;return M}function f(J){switch(J){case C.WGLGeometryType.MARKER:return A;case C.WGLGeometryType.FILL:return E;case C.WGLGeometryType.LINE:return z;case C.WGLGeometryType.TEXT:return F;case C.WGLGeometryType.LABEL:return D}}function e(J){switch(J%4){case 0:case 2:return 4;case 1:case 3:return 1}}function l(J){switch(J){case r.DataType.BYTE:case r.DataType.UNSIGNED_BYTE:return 1;case r.DataType.SHORT:case r.DataType.UNSIGNED_SHORT:return 2;
case r.DataType.FLOAT:case r.DataType.INT:case r.DataType.UNSIGNED_INT:return 4}}function b(J){const M={};for(const R in J){let Y=0;M[R]=J[R].map(fa=>{const O=new m.VertexElementDescriptor(fa.name,fa.count,fa.type,Y,0,fa.normalized||!1);Y+=fa.count*l(fa.type);return O});M[R]?.forEach(fa=>fa.stride=Y)}return M}const p=x.getLogger("esri.views.2d.engine.webgl.Utils"),c=k([{name:"geometry",strideInBytes:36}]),d=k([{name:"geometry",strideInBytes:12}]),a=k([{name:"geometry",strideInBytes:36}]),n=k([{name:"geometry",
strideInBytes:24}]),t=k([{name:"geometry",strideInBytes:12}]),v=k([{name:"geometry",strideInBytes:40}]),y=k([{name:"geometry",strideInBytes:36}]),h=k([{name:"geometry",strideInBytes:36}]),A=["geometry"],E=["geometry"],z=["geometry"],F=["geometry"],D=["geometry"];x={geometry:r.Usage.STATIC_DRAW};const B=new Map,u=J=>null!=J&&J.startsWith("data:image/gif"),H=J=>null!=J&&J.startsWith("data:image/png"),G=J=>{if(!J)return!1;J=J.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(J)&&/[\dz]$/i.test(J)&&
4<J.length?!0:!1},I=J=>"fill"===J.type&&"CIMMarkerPlacementInsidePolygon"===J?.cim?.markerPlacement?.type;g.allocateTypedArrayBuffer=function(J,M){switch(M%4){case 0:case 2:return new Uint32Array(Math.floor(J*M/4));case 1:case 3:return new Uint8Array(J*M)}};g.allocateTypedArrayBufferwithData=function(J,M){switch(M%4){case 0:case 2:return new Uint32Array(J);case 1:case 3:return new Uint8Array(J)}};g.cVboInfo=x;g.charCodes=function(J){const M=[];for(let R=0;R<J.length;R++)M.push(J.charCodeAt(R));return M};
g.copyMeshData=function(J,M,R,Y,fa,O,Q){for(const da in O){var Z=O[da].stride,ba=e(Z);const P=O[da].data,U=R[da].data;if(null==P||null==U)continue;const ca=Z*fa.vertexCount/ba,la=Z*J/ba;Z=Z*fa.vertexFrom/ba;for(ba=0;ba<ca;++ba)U[ba+la]=P[ba+Z]}if(null!=Q&&null!=Y)for(R=fa.indexCount,O=0;O<R;++O)Y[O+M]=Q[O+fa.indexFrom]-fa.vertexFrom+J};g.createGeometryData=function(J,M){const R=[];for(let Y=0;5>Y;++Y){const fa=f(Y),O={};for(const Q of fa)O[Q]={data:M(Y,Q)};R.push({data:J(Y),buffers:O})}return R};
g.createProgramDescriptor=(J,M)=>{if(!B.has(J)){const fa=b(M);var R=fa;var Y={};for(const O in R){const Q=R[O];Y[O]=Q?.length?Q[0].stride:0}R=Y;Y=new Map;for(const O in M)for(const Q of M[O])Y.set(Q.name,Q.location);B.set(J,{strides:R,bufferLayouts:fa,attributes:Y})}return B.get(J)};g.forEachGeometryType=function(J){J(C.WGLGeometryType.FILL);J(C.WGLGeometryType.LINE);J(C.WGLGeometryType.MARKER);J(C.WGLGeometryType.TEXT);J(C.WGLGeometryType.LABEL)};g.getBytes=l;g.getCapType=function(J){switch(J){case "butt":return w.CapType.BUTT;
case "round":return w.CapType.ROUND;case "square":return w.CapType.SQUARE;default:return p.error(new q("mapview-invalid-type",`Cap type ${J} is not a valid option. Defaulting to round`)),w.CapType.ROUND}};g.getJoinType=function(J){switch(J){case "miter":return w.JoinType.MITER;case "bevel":return w.JoinType.BEVEL;case "round":return w.JoinType.ROUND;default:return p.error(new q("mapview-invalid-type",`Join type ${J} is not a valid option. Defaulting to round`)),w.JoinType.ROUND}};g.getNamedBuffers=
f;g.getPMSResourceSize=function(J){const M="width"in J&&J.width||"size"in J&&J.size||0;return"maxVVSize"in J&&J.maxVVSize||M};g.getPixelArrayCtor=function(J){switch(J){case r.PixelType.UNSIGNED_BYTE:return Uint8Array;case r.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case r.PixelType.FLOAT:return Float32Array;default:p.error(new q("webgl-utils",`Unable to handle type ${J}`))}};g.getPixelBytes=function(J){switch(J){case r.PixelType.UNSIGNED_BYTE:return 1;case r.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;
case r.PixelType.FLOAT:return 4;default:p.error(new q("webgl-utils",`Unable to handle type ${J}`))}};g.getStrides=function(J,M){switch(J){case C.WGLGeometryType.MARKER:switch(M){case C.WGLSymbologyType.HEATMAP:return d;default:return c}case C.WGLGeometryType.FILL:switch(M){case C.WGLSymbologyType.DOT_DENSITY:return t;case C.WGLSymbologyType.SIMPLE:case C.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return n;default:return a}case C.WGLGeometryType.LINE:return v;case C.WGLGeometryType.TEXT:return y;case C.WGLGeometryType.LABEL:return h}};
g.getUrl=J=>"imageData"in J&&J.imageData&&"contentType"in J&&J.contentType?`data:${J.contentType};base64,${J.imageData}`:"url"in J?J.url:null;g.getVVType=function(J){switch(J){case "opacity":return C.VVType.OPACITY;case "color":return C.VVType.COLOR;case "rotation":return C.VVType.ROTATION;case "size":return C.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${J}`),null}};g.is3D=J=>J.type&&J.type.toLowerCase().includes("3d");g.isDefined=function(J){return null!=J};g.isGIF=J=>"url"in
J&&J.url&&(J.url.includes(".gif")||u(J.url))||"contentType"in J&&"image/gif"===J.contentType||"imageData"in J&&u(J.imageData);g.isGIFDataUri=u;g.isImageResource=J=>!!("url"in J&&J.url)||!!("imageData"in J&&J.imageData);g.isMarkerPlacementInsidePolygon=I;g.isNumber=function(J){return"number"===typeof J};g.isPNG=J=>"url"in J&&J.url&&(J.url.includes(".png")||H(J.url))||"contentType"in J&&"image/png"===J.contentType||"imageData"in J&&H(J.imageData);g.isPNGDataUri=H;g.isSVGResource=J=>"path"in J&&G(J.path);
g.isSimple=function(J){switch(J.type){case "line":return"CIMSolidStroke"===J.cim.type&&!J.dashTemplate;case "fill":return"CIMSolidFill"===J.cim.type;case "esriSFS":return"esriSFSSolid"===J.style||"esriSFSNull"===J.style;case "esriSLS":return"esriSLSSolid"===J.style||"esriSLSNull"===J.style;default:return!1}};g.isValidSVG=G;g.shouldRepeat=function(J){switch("cim"in J?J.cim.type:J.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":return!1;case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":return I(J);
default:return!0}};g.strideToPackingFactor=e;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(["exports"],function(g){g.WGLGeometryType=void 0;(function(q){q[q.FILL=0]="FILL";q[q.LINE=1]="LINE";q[q.MARKER=2]="MARKER";q[q.TEXT=3]="TEXT";q[q.LABEL=4]="LABEL"})(g.WGLGeometryType||(g.WGLGeometryType={}));g.WGLDrawPhase=void 0;(function(q){q[q.NONE=0]="NONE";q[q.MAP=1]="MAP";q[q.LABEL=2]="LABEL";q[q.LABEL_ALPHA=4]="LABEL_ALPHA";q[q.HITTEST=
8]="HITTEST";q[q.HIGHLIGHT=16]="HIGHLIGHT";q[q.CLIP=32]="CLIP";q[q.DEBUG=64]="DEBUG";q[q.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(g.WGLDrawPhase||(g.WGLDrawPhase={}));g.VVType=void 0;(function(q){q[q.SIZE=0]="SIZE";q[q.COLOR=1]="COLOR";q[q.OPACITY=2]="OPACITY";q[q.ROTATION=3]="ROTATION"})(g.VVType||(g.VVType={}));g.WGLVVFlag=void 0;(function(q){q[q.NONE=0]="NONE";q[q.OPACITY=1]="OPACITY";q[q.COLOR=2]="COLOR";q[q.ROTATION=4]="ROTATION";q[q.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";q[q.SIZE_SCALE_STOPS=
16]="SIZE_SCALE_STOPS";q[q.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";q[q.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(g.WGLVVFlag||(g.WGLVVFlag={}));g.WGLVVTarget=void 0;(function(q){q[q.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";q[q.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";q[q.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";q[q.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(g.WGLVVTarget||(g.WGLVVTarget={}));g.MosaicType=void 0;(function(q){q[q.SPRITE=0]="SPRITE";q[q.GLYPH=1]=
"GLYPH"})(g.MosaicType||(g.MosaicType={}));g.WGLSymbologyType=void 0;(function(q){q[q.DEFAULT=0]="DEFAULT";q[q.SIMPLE=1]="SIMPLE";q[q.DOT_DENSITY=2]="DOT_DENSITY";q[q.OUTLINE_FILL=3]="OUTLINE_FILL";q[q.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE";q[q.HEATMAP=5]="HEATMAP";q[q.PIE_CHART=6]="PIE_CHART"})(g.WGLSymbologyType||(g.WGLSymbologyType={}));Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(g){g.createDebugLogger=
(q,x)=>q&&((...w)=>x.warn("DEBUG:",...w))||(()=>null);g.debugAttrUpdates=!1;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define("exports ../../../../../../core/screenUtils ../../../../engine/webgl/color ../../../../engine/webgl/definitions ../../../../engine/webgl/enums ../../../../engine/webgl/visualVariablesUtils".split(" "),function(g,q,x,w,C,r){function m(c){return{value:c.value,size:q.toPt(c.size)}}
function k(c){return(c??[]).map(d=>m(d))}function f(c){return"string"===typeof c||"number"===typeof c?q.toPt(c):{type:"size",expression:c.expression,stops:k(c.stops)}}function e(c){const d={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"===typeof c.field)if(c.stops){if(8<c.stops.length)return null;c=c.stops;for(var a=0;8>a;++a){const n=c[Math.min(a,c.length-1)];d.values[a]=n.value;d.opacities[a]=n.opacity}}else return null;else if(c.stops&&0<=c.stops.length)for(c=c.stops&&0<=c.stops.length?
c.stops[0].opacity:0,a=0;8>a;a++)d.values[a]=Infinity,d.opacities[a]=c;else return null;return d}function l(c,d,a){c[4*d]=a.r/255;c[4*d+1]=a.g/255;c[4*d+2]=a.b/255;c[4*d+3]=a.a}function b(c){if(null==c||c.normalizationField)return null;const d={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"===typeof c.field)if(c.stops){if(8<c.stops.length)return null;d.field=c.field;c=c.stops;for(var a=0;8>a;++a){const n=c[Math.min(a,c.length-
1)];d.values[a]=n.value;l(d.colors,a,n.color)}}else return null;else if(c.stops&&0<=c.stops.length)for(c=c.stops&&0<=c.stops.length&&c.stops[0].color,a=0;8>a;a++)d.values[a]=Infinity,l(d.colors,a,c);else return null;for(c=0;32>c;c+=4)x.premultiplyAlpha(d.colors,c,!0);return d}const p=c=>{const d=[],a=[];c=k(c);const n=c.length;for(let t=0;6>t;t++){const v=c[Math.min(t,n-1)];d.push(v.value);a.push(null==v.size?w.nanMagicNumber:q.pt2px(v.size))}return{values:new Float32Array(d),sizes:new Float32Array(a)}};
g.convertColorVariable=b;g.convertVisualVariables=function(c){const d=c&&0<c.length?{}:null,a=d?{}:null;if(!d||!a)return{vvFields:d,vvRanges:a};for(const n of c)if(n.field&&(d[n.type]=n.field),"size"===n.type)switch(a.size||(a.size={}),c=n,r.getTypeOfSizeVisualVariable(c)){case C.WGLVVFlag.SIZE_MINMAX_VALUE:a.size.minMaxValue={minDataValue:c.minDataValue,maxDataValue:c.maxDataValue,minSize:f(c.minSize),maxSize:f(c.maxSize)};break;case C.WGLVVFlag.SIZE_SCALE_STOPS:a.size.scaleStops={stops:k(c.stops)};
break;case C.WGLVVFlag.SIZE_FIELD_STOPS:if(c.levels){const t={};for(const v in c.levels)t[v]=p(c.levels[v]);a.size.fieldStops={type:"level-dependent",levels:t}}else a.size.fieldStops={type:"static",...p(c.stops)};break;case C.WGLVVFlag.SIZE_UNIT_VALUE:a.size.unitValue={unit:c.valueUnit,valueRepresentation:c.valueRepresentation??void 0}}else"color"===n.type?a.color=b(n):"opacity"===n.type?a.opacity=e(n):"rotation"===n.type&&(a.rotation={type:n.rotationType});return{vvFields:d,vvRanges:a}};g.getVisualVariableSizeValueRepresentationRatio=
function(c,d){if(!c||!d)return c;switch(d){case "radius":case "distance":return 2*c;case "area":return Math.sqrt(c)}return c};g.normalizeSizeElement=f;g.normalizeSizeStops=k;g.stopToSizeStop=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(g,q){g.premultiplyAlpha=function(x,w=0,C=!1){const r=x[w+3];x[w]*=r;x[w+1]*=r;x[w+2]*=r;C||(x[w+3]*=255);return x};g.premultiplyAlphaRGBA=function(x){if(!x)return 0;
const {r:w,g:C,b:r,a:m}=x;return q.i8888to32(w*m,C*m,r*m,255*m)};g.premultiplyAlphaRGBAArray=function(x){if(!x)return 0;const [w,C,r,m]=x;return q.i8888to32(m/255*w,m/255*C,m/255*r,m)};g.writeColor=function(x,w,C=0){if(null==w)x[C]=0,x[C+1]=0,x[C+2]=0,x[C+3]=0;else{var {r,g:m,b:k,a:f}=w;x[C]=r*f/255;x[C+1]=m*f/255;x[C+2]=k*f/255;x[C+3]=f}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(g){function q(C,r,m){return Math.round(Math.max(Math.min(C,
m),r))}const x=new Float32Array(1),w=new Uint32Array(x.buffer);g.i16=function(C){return q(C,-32768,32767)};g.i1616to32=function(C,r){return 65535&C|r<<16};g.i32=function(C){return q(C,-2147483648,2147483647)};g.i8=function(C){return q(C,-128,127)};g.i8816to32=function(C,r,m){return C&255|(r&255)<<8|m<<16};g.i8888to32=function(C,r,m,k){return C&255|(r&255)<<8|(m&255)<<16|k<<24};g.numTo32=function(C){return C|0};g.toFloat32=function(C){w[0]=C;return x[0]};g.toUint32=function(C){x[0]=C;return w[0]};
g.u16=function(C){return q(C,0,65535)};g.u32=function(C){return q(C,0,4294967295)};g.u32to4Xu8=function(C){return[C&255,(C&65280)>>>8,(C&16711680)>>>16,(C&4278190080)>>>24]};g.u4u4to8=function(C,r){return 15&C|(15&r)<<4};g.u8=function(C){return q(C,0,255)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define(["exports","../../../../core/Error","../../../../core/Logger","./enums","./Utils"],function(g,q,x,w,C){g.getTypeOfSizeVisualVariable=
function(r){if(C.isNumber(r.minDataValue)&&C.isNumber(r.maxDataValue)&&null!=r.minSize&&null!=r.maxSize)return w.WGLVVFlag.SIZE_MINMAX_VALUE;if((r.expression&&"view.scale"===r.expression||r.valueExpression&&"$view.scale"===r.valueExpression)&&Array.isArray(r.stops))return w.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=r.field||r.expression&&"view.scale"!==r.expression||r.valueExpression&&"$view.scale"!==r.valueExpression)&&(Array.isArray(r.stops)||"levels"in r&&r.levels))return w.WGLVVFlag.SIZE_FIELD_STOPS;
if((null!=r.field||r.expression&&"view.scale"!==r.expression||r.valueExpression&&"$view.scale"!==r.valueExpression)&&null!=r.valueUnit)return w.WGLVVFlag.SIZE_UNIT_VALUE;x.getLogger("esri.views.2d.engine.webgl").error(new q("mapview-bad-type","Found invalid size VisualVariable",r));return w.WGLVVFlag.NONE};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/BinStore":function(){define("exports ../../../../../geometry ../../../../../core/Evented ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../../../geohash/GeohashTree ../../../../../geohash/geohashUtils ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Ellipsoid ../../../../../geometry/support/spatialReferenceUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../layers/graphics/data/projectionSupport ../../../../../layers/support/FieldsIndex ../../../engine/webgl/DisplayId ../FeatureStore2D ../Store2D ./FeatureSetReaderJSON ../../../../../geometry/SpatialReference ../../../../../geometry/Polygon ../../../../../geometry/Extent".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E){const z=C.getLogger("esri.view.2d.layers.features.support.BinStore"),F=f.create();class D extends v.Store2D{constructor(B,u,H,G){super(B,H);this.type="bin";this.events=new x;this.objectIdField="aggregateId";this.featureAdapter=t.featureAdapter;this._geohashLevel=5;this._geohashBuf=[];this._serviceInfo=G;this.geometryInfo=B.geometryInfo;this._spatialReference=u;this._projectionSupportCheck=d.checkProjectionSupport(u,h.WGS84);this._bitsets.geohash=
H.getBitset(H.createBitset());this._bitsets.inserted=H.getBitset(H.createBitset())}destroy(){this._tree&&this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}async updateSchema(B,u){const H=this._schema;try{await super.updateSchema(B,u),await this._projectionSupportCheck}catch(I){}this._fields=this._schema.params.fields;this._fieldsIndex=new a(this._fields);const G=r.diff(H,u);if(u&&(null!=G||B.source||B.storage.filters)){if(r.hasDiff(G,
"params.fields")||r.hasDiff(G,"params")||!this._tree||B.source)this._tree&&this._tree.destroy(),this._tree=new m.GeohashTree(this._statisticFields,this._serviceInfo),this._tree.onRelease=I=>I.displayId&&this._storage.releaseDisplayId(I.displayId),this._geohashLevel=this._schema.params.fixedBinLevel,this._rebuildTree(),w("esri-2d-update-debug")&&z.info("Aggregate mesh needs update due to tree changing");w("esri-2d-update-debug")&&z.info("Aggregate mesh needs update due to tree changing");B.targets[u.name]=
!0;B.mesh=!1}else H&&(B.mesh=!0)}clear(){this._rebuildTree()}sweepFeatures(B,u){this._bitsets.inserted.forEachSet(H=>{B.has(H)||(H=u.lookupByDisplayIdUnsafe(H),this._remove(H))})}sweepAggregates(B,u,H){}onTileData(B,u,H,G,I,J=!0){if(!this._schema||null==u.addOrUpdate)return u;this.events.emit("changed");var M=this._getTransforms(B,this._spatialReference);const R=u.addOrUpdate.getCursor();for(;R.next();)this._update(R,G);if(u.status.mesh||!J)return u;G=[];this._getBinsForTile(G,B,M,H);u.addOrUpdate=
y.FeatureSetReaderJSON.fromOptimizedFeatures(G,{fields:this.fields,fieldsIndex:this._fieldsIndex,geometryType:"esriGeometryPolygon",objectIdField:this.objectIdField});u.addOrUpdate.attachStorage(H);u.end=!0;u.isRepush||(u.clear=!0);for(M=u.addOrUpdate.getCursor();M.next();)G=M.getDisplayId(),this._bitsets.computed.unset(G),this.setComputedAttributes(H,M,G,B.scale,I);return u}forEachBin(B){this._tree.forEach(B)}forEach(B){this._tree.forEach(u=>{u.depth===this._geohashLevel&&(u=this._toFeatureJSON(u),
u=y.FeatureSetReaderJSON.fromFeatures([u],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,fields:this.fields,fieldsIndex:this._fieldsIndex}).getCursor(),u.next(),B(u))})}forEachInBounds(B,u){}forEachBounds(B,u){const {hasM:H,hasZ:G}=this.geometryInfo;for(const I of B)B=b.getBoundsOptimizedGeometry(F,I.readGeometry(),G,H),null!=B&&u(B)}onTileUpdate(B){}getAggregate(B){const u=n.createDisplayId(B,!0);return(B=this._tree.findIf(H=>H.displayId===u))?this._toFeatureJSON(B):
null}getAggregates(){return this._tree.findAllIf(B=>B.depth===this._geohashLevel).map(this._toFeatureJSON.bind(this))}getDisplayId(B){return this._tree.findIf(u=>u.id===B)?.displayId}getFeatureDisplayIdsForAggregate(B){const u=this._tree.findIf(H=>H.id===B);return null!=u?Array.from(u.displayIds):[]}getDisplayIdForReferenceId(B){return this._tree.findIf(u=>1===u.displayIds.size&&u.displayIds.has(B))?.displayId}_toFeatureJSON(B){const u=this._spatialReference;return{displayId:B.displayId,attributes:B.getAttributes(),
geometry:b.convertToGeometry(B.getGeometry(u),"esriGeometryPolygon",!1,!1),centroid:null}}_rebuildTree(){this._bitsets.computed.clear();this._bitsets.inserted.clear();this._tree&&this._tree.clear()}_remove(B){const u=B.getDisplayId(),H=B.getXHydrated(),G=B.getYHydrated(),I=this._geohashBuf[2*u],J=this._geohashBuf[2*u+1];this._bitsets.inserted.has(u)&&(this._bitsets.inserted.unset(u),this._tree.removeCursor(B,H,G,I,J,this._geohashLevel))}_update(B,u){const H=B.getDisplayId(),G=this._bitsets.inserted;
u=u.isVisible(H);var I=G.has(H);u!==I&&(u?(u=B.getXHydrated(),I=B.getYHydrated(),this._setGeohash(H,u,I)&&(this._tree.insertCursor(B,H,u,I,this._geohashBuf[2*H],this._geohashBuf[2*H+1],this._geohashLevel),G.set(H))):this._remove(B))}_setGeohash(B,u,H){if(this._bitsets.geohash.has(B))return!0;const G=this._geohashBuf;if(this._spatialReference.isWebMercator)u=u/e.earth.radius*57.29577951308232,k.setGeohashBuf(G,B,57.29577951308232*(Math.PI/2-2*Math.atan(Math.exp(-H/e.earth.radius))),u-360*Math.floor((u+
180)/360),12);else{H=d.project({x:u,y:H},this._spatialReference,h.WGS84);if(!H)return!1;k.setGeohashBuf(G,B,H.y,H.x,12)}this._bitsets.geohash.set(B);return!0}_getBinsForTile(B,u,H,G){try{var I=this._getGeohashBounds(u);const J=this._tree.getBins(I);for(const M of J){M.displayId||(M.displayId=G.createDisplayId(!0));I=null;const R=M.getGeometry(this._spatialReference,H.tile);R||(I=M.getGeometryCentroid(this._spatialReference,H.tile));const Y=new p.OptimizedFeature(R,M.getAttributes(),I);Y.objectId=
M.id;Y.displayId=M.displayId;B.push(Y)}}catch(J){z.error("Unable to get bins for tile",u.key.id)}}_getGeohash(B,u,H){const G={geohashX:0,geohashY:0};k.setGeohashXY(G,u,B,H);return G}_getGeohashBounds(B){const u=this._getGeohashLevel(B.key.level),H=[B.extent.xmin,B.extent.ymin,B.extent.xmax,B.extent.ymax];var G=A.fromExtent(E.fromBounds(H,this._spatialReference));B=d.project(G,this._spatialReference,h.WGS84,{densificationStep:64*B.resolution});B=b.convertFromPolygon(new c,B,!1,!1);var I=B.coords.filter((M,
R)=>!(R%2)),J=B.coords.filter((M,R)=>R%2);B=Math.min(...I);G=Math.min(...J);I=Math.max(...I);J=Math.max(...J);B=this._getGeohash(B,G,u);G=this._getGeohash(I,J,u);return{bounds:H,geohashBounds:{xLL:B.geohashX,yLL:B.geohashY,xTR:G.geohashX,yTR:G.geohashY},level:u}}_getGeohashLevel(B){return this._schema.params.fixedBinLevel}_getTransforms(B,u){const H={originPosition:"upperLeft",scale:[B.resolution,B.resolution],translate:[B.bounds[0],B.bounds[3]]};u=l.getInfo(u);if(!u)return{tile:H,left:null,right:null};
const [G,I]=u.valid;return{tile:H,left:{...H,translate:[I,B.bounds[3]]},right:{...H,translate:[G-I+B.bounds[0],B.bounds[3]]}}}}g.BinStore=D;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashTree":function(){define("exports ../core/CircularArray ./geohashUtils ../geometry/SpatialReference ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport ../views/2d/layers/features/support/FeatureSetReaderJSON".split(" "),
function(g,q,x,w,C,r,m,k){class f{constructor(l=[],b,p=8096){this.onRelease=c=>{};this._nodes=0;this._root=new e(this,0,0,0);this._statisticFields=l;this._pool=p?new q(8096):null;this._serviceInfo=b}destroy(){this.clear()}_acquire(l,b,p){this._nodes++;let c=null;null!=this._pool&&(c=this._pool.dequeue());null!=c?c.realloc(l,b,p):c=new e(this,l,b,p);return c}_release(l){this.onRelease(l);this._nodes--;null!=this._pool&&this._pool.enqueue(l)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){return this._pool?.size??
0}get depth(){let l=0;this.forEach(b=>l=Math.max(l,b.depth));return l}dropLevels(l){this.forEach(b=>{if(b.depth>=l)for(let p=0;p<b.children.length;p++){const c=b.children[p];c&&this._release(c)}});this.forEach(b=>{if(b.depth>=l)for(let p=0;p<b.children.length;p++)b.children[p]=null})}clear(){this.forEach(l=>this._release(l));this._root=new e(this,0,0,0)}insert(l,b,p=0){const c=k.FeatureSetReaderJSON.fromOptimizedFeatures([l],this._serviceInfo).getCursor();c.next();const d=c.readGeometry();if(d){var [a,
n]=d.coords;this.insertCursor(c,l.displayId,a,n,l.geohashX,l.geohashY,b,p)}}insertCursor(l,b,p,c,d,a,n,t=0){let v=this._root,y=0,h=0,A=0;for(;null!==v;){v.depth>=t&&(v.count+=1,v.xTotal+=p,v.yTotal+=c,v.xGeohashTotal+=d,v.yGeohashTotal+=a,v.referenceId=b,this._updateStatisticsCursor(l,v,1));if(y>=n){v.add(b);break}var E=Math.ceil((y+1)/2),z=Math.floor((y+1)/2);const D=1-y%2;var F=30-(3*E+2*z);E=30-(2*E+3*z);F=(d&7*D+3*(1-D)<<F)>>F;E=(a&3*D+7*(1-D)<<E)>>E;z=F+E*(8*D+4*(1-D));const B=2*D+3*(1-D);h=
h<<3*D+2*(1-D)|F;A=A<<B|E;null==v.children[z]&&(v.children[z]=this._acquire(h,A,y+1));y+=1;v=v.children[z]}}remove(l,b){const p=k.FeatureSetReaderJSON.fromOptimizedFeatures([l],this._serviceInfo).getCursor();p.next();const c=p.readGeometry();if(c){var [d,a]=c.coords;this.removeCursor(p,d,a,l.geohashX,l.geohashY,b)}}removeCursor(l,b,p,c,d,a){let n=this._root,t=0;for(;null!==n;){--n.count;n.xTotal-=b;n.yTotal-=p;n.xGeohashTotal-=c;n.yGeohashTotal-=d;this._updateStatisticsCursor(l,n,-1);if(t>=a){n.remove(l.getDisplayId());
break}var v=Math.ceil((t+1)/2);const A=Math.floor((t+1)/2);var y=1-t%2,h=30-(3*v+2*A);v=30-(2*v+3*A);y=((c&7*y+3*(1-y)<<h)>>h)+((d&3*y+7*(1-y)<<v)>>v)*(8*y+4*(1-y));h=n.children[y];1===h?.count&&(this._release(h),n.children[y]=null);t+=1;n=h}}forEach(l){let b=this._root;for(;null!==b;){const p=this._linkChildren(b)||b.next;l(b);b=p}}find(l,b,p){return this._root.find(l,b,p,0,0,0)}findIf(l){let b=null;this.forEach(p=>{l(p)&&(b=p)});return b}findAllIf(l){const b=[];this.forEach(p=>{l(p)&&b.push(p)});
return b}findSingleOccupancyNode(l,b,p,c,d){let a=this._root;for(;null!==a;){var n=a.depth,t=a.xNode,v=a.yNode;const F=1-n%2;var y=a.xGeohashTotal/a.count,h=a.yGeohashTotal/a.count;if(1===a.count&&l<y&&y<=p&&b<h&&h<=c)return a;if(n>=d)a=a.next;else{h=Math.ceil((n+1)/2);n=Math.floor((n+1)/2);y=30-(3*h+2*n);var A=30-(2*h+3*n),E=~((1<<y)-1),z=~((1<<A)-1);t<<=3*F+2*(1-F);v<<=2*F+3*(1-F);n=Math.max(t,(l&E)>>y);h=Math.max(v,(b&z)>>A);y=Math.min(t+8*F+4*(1-F),(p&E)>>y);A=Math.min(v+4*F+8*(1-F),(c&z)>>A);
for(E=z=null;h<=A;h++)for(let D=n;D<=y;D++){const B=a.children[D-t+(h-v)*(8*F+4*(1-F))];B&&(z||(z=B,z.next=a.next),E&&(E.next=B),E=B,B.next=a.next)}a=z||a.next}}return null}getRegionDisplayIds(l){let b=this._root;const {bounds:p,geohashBounds:c,level:d}=l,[a,n,t,v]=p,y=[];for(;null!==b;){l=b.depth;var h=b.xNode,A=b.yNode;if(l>=d)l=b.xTotal/b.count,h=b.yTotal/b.count,l>=a&&l<=t&&h>=n&&h<=v&&b.displayIds.forEach(H=>y.push(H)),b=b.next;else{var E=Math.ceil((l+1)/2),z=Math.floor((l+1)/2);l=1-l%2;var F=
30-(3*E+2*z),D=30-(2*E+3*z),B=~((1<<F)-1),u=~((1<<D)-1);h<<=3*l+2*(1-l);A<<=2*l+3*(1-l);E=Math.max(h,(c.xLL&B)>>F);z=Math.max(A,(c.yLL&u)>>D);F=Math.min(h+8*l+4*(1-l),(c.xTR&B)>>F);D=Math.min(A+4*l+8*(1-l),(c.yTR&u)>>D);for(B=u=null;z<=D;z++)for(let H=E;H<=F;H++){const G=b.children[H-h+(z-A)*(8*l+4*(1-l))];G&&(u||(u=G,u.next=b.next),B&&(B.next=G),B=G,G.next=b.next)}b=u||b.next}}return y}getRegionStatistics(l){var b=this._root;let p=0,c=0,d=0;const a={},{bounds:n,geohashBounds:t,level:v}=l,[y,h,A,
E]=n;for(l=0;null!==b;){var z=b.depth,F=b.xNode,D=b.yNode;if(z>=v)z=b.xTotal/b.count,F=b.yTotal/b.count,z>y&&z<=A&&F>h&&F<=E&&(p+=b.count,c+=b.xTotal,d+=b.yTotal,1===b.count&&(l=b.referenceId),this._aggregateStatistics(a,b.statistics)),b=b.next;else{var B=Math.ceil((z+1)/2),u=Math.floor((z+1)/2);z=1-z%2;var H=30-(3*B+2*u),G=30-(2*B+3*u),I=~((1<<H)-1),J=~((1<<G)-1);F<<=3*z+2*(1-z);D<<=2*z+3*(1-z);B=Math.max(F,(t.xLL&I)>>H);u=Math.max(D,(t.yLL&J)>>G);H=Math.min(F+8*z+4*(1-z),(t.xTR&I)>>H);G=Math.min(D+
4*z+8*(1-z),(t.yTR&J)>>G);I=J=null;for(let M=u;M<=G;M++)for(let R=B;R<=H;R++){const Y=b.children[R-F+(M-D)*(8*z+4*(1-z))];if(Y)if(M!==u&&M!==G&&R!==B&&R!==H){const fa=Y.xTotal/Y.count,O=Y.yTotal/Y.count;fa>y&&fa<=A&&O>h&&O<=E&&(p+=Y.count,c+=Y.xTotal,d+=Y.yTotal,1===Y.count&&(l=Y.referenceId),this._aggregateStatistics(a,Y.statistics))}else J||(J=Y,J.next=b.next),I&&(I.next=Y),I=Y,Y.next=b.next}b=J||b.next}}b=this.normalizeStatistics(a,p);return{count:p,attributes:b,xTotal:c,yTotal:d,referenceId:l}}getBins(l){const b=
[],{geohashBounds:p,level:c}=l;for(l=this._root;null!==l;){var d=l.depth,a=l.xNode,n=l.yNode;if(d>=c)b.push(l),l=l.next;else{var t=Math.ceil((d+1)/2),v=Math.floor((d+1)/2);d=1-d%2;var y=30-(3*t+2*v),h=30-(2*t+3*v),A=~((1<<y)-1),E=~((1<<h)-1);a<<=3*d+2*(1-d);n<<=2*d+3*(1-d);t=Math.max(a,(p.xLL&A)>>y);v=Math.max(n,(p.yLL&E)>>h);y=Math.min(a+8*d+4*(1-d),(p.xTR&A)>>y);h=Math.min(n+4*d+8*(1-d),(p.yTR&E)>>h);for(A=E=null;v<=h;v++)for(let z=t;z<=y;z++){const F=l.children[z-a+(v-n)*(8*d+4*(1-d))];F&&(E||
(E=F,E.next=l.next),A&&(A.next=F),A=F,F.next=l.next)}l=E||l.next}}return b}_linkChildren(l){let b=null,p=null;for(let c=0;c<=l.children.length;c++){const d=l.children[c];d&&(b||(b=d,b.next=l.next),p&&(p.next=d),p=d,d.next=l.next)}return b}_updateStatisticsCursor(l,b,p){for(const a of this._statisticFields){const n=a.name,t=a.inField?l.readAttribute(a.inField):l.getComputedNumericAtIndex(a.inFieldIndex);switch(a.statisticType){case "min":if(isNaN(t))break;if(!b.statistics[n]){b.statistics[n]={value:t};
break}b.statistics[n].value=Math.min(b.statistics[n].value,t);break;case "max":if(isNaN(t))break;if(!b.statistics[n]){b.statistics[n]={value:t};break}b.statistics[n].value=Math.max(b.statistics[n].value,t);break;case "sum":case "avg":b.statistics[n]||(b.statistics[n]={value:0,nanCount:0});var c=b.statistics[n].value,d=b.statistics[n].nanCount??0;null==t||isNaN(t)?b.statistics[n].nanCount=d+p:b.statistics[n].value=c+p*t;break;case "avg_angle":b.statistics[n]||(b.statistics[n]={x:0,y:0,nanCount:0});
c=b.statistics[n].x;d=b.statistics[n].y;const v=b.statistics[n].nanCount??0,y=Math.PI/180;null==t||isNaN(t)?b.statistics[n].nanCount=v+p:(b.statistics[n].x=c+p*Math.cos(t*y),b.statistics[n].y=d+p*Math.sin(t*y));break;case "mode":b.statistics[n]||(b.statistics[n]={}),b.statistics[n][t]=(b.statistics[n][t]||0)+p}}}_aggregateStatistics(l,b){for(const p of this._statisticFields){const c=p.name;switch(p.statisticType){case "min":if(!l[c]){l[c]={value:b[c].value};break}l[c].value=Math.min(l[c].value,b[c].value);
break;case "max":if(!l[c]){l[c]={value:b[c].value};break}l[c].value=Math.max(l[c].value,b[c].value);break;case "sum":case "avg":case "avg_angle":case "mode":l[c]||(l[c]={});for(const d in b[c])l[c][d]=(l[c][d]||0)+b[c][d]}}}normalizeStatistics(l,b){const p={};for(const d of this._statisticFields){const a=d.name;switch(d.statisticType){case "min":case "max":var c=l[a];if(!b||!c)break;p[a]=c.value;break;case "count":if(!b)break;p[a]=b;break;case "sum":if(!b)break;const {value:n,nanCount:t}=l[a];if(!(b-
t))break;p[a]=n;break;case "avg":if(!b)break;const {value:v,nanCount:y}=l[a];if(!(b-y))break;p[a]=v/(b-y);break;case "avg_angle":if(!b)break;const {x:h,y:A,nanCount:E}=l[a];if(!(b-E))break;p[a]=180/Math.PI*Math.atan2(A/(b-E),h/(b-E));break;case "mode":c=l[a];let z=0,F=0,D=null;for(const B in c){const u=c[B];u===z?F+=1:u>z&&(z=u,F=1,D=B)}p[a]="null"===D||1<F?null:D}}return p}}class e{constructor(l,b,p,c){this.yTotal=this.xTotal=this.count=0;this.statistics={};this.referenceId=this.displayId=0;this.displayIds=
new Set;this.next=null;this.yGeohashTotal=this.xGeohashTotal=this.yNode=this.xNode=this.depth=0;this._tree=l;this.children=Array(32);for(l=0;l<this.children.length;l++)this.children[l]=null;this.xNode=b;this.yNode=p;this.depth=c}realloc(l,b,p){for(let c=0;c<this.children.length;c++)this.children[c]=null;this.xNode=l;this.yNode=b;this.depth=p;this.next=null;this.count=this.yTotal=this.xTotal=this.referenceId=this.displayId=this.yGeohashTotal=this.xGeohashTotal=0;this.statistics={};this.displayIds.clear();
return this}get id(){return`${this.xNode}.${this.yNode}`}add(l){this.displayIds.add(l)}remove(l){this.displayIds.delete(l)}getAttributes(){const l=this._tree.normalizeStatistics(this.statistics,this.count);l.referenceId=null;l.aggregateId=this.id;l.aggregateCount=this.count;return l}getGeometry(l,b){const p=this.getLngLatBounds(),[c,d,a,n]=p;l=m.project({rings:[[[c,d],[c,n],[a,n],[a,d],[c,d]]]},w.WGS84,l);l=C.convertFromPolygon(new r,l,!1,!1);return null!=b?C.quantizeOptimizedGeometry(new r,l,!1,
!1,"esriGeometryPolygon",b,!1,!1):l}getGeometryCentroid(l,b){const p=this.getLngLatBounds(),[c,d,a,n]=p;l=m.project({x:(c+a)/2,y:(d+n)/2},w.WGS84,l);l=C.convertFromPoint(new r,l);return null!=b?C.quantizeOptimizedGeometry(new r,l,!1,!1,"esriGeometryPoint",b,!1,!1):l}getLngLatBounds(){var l=this.depth;const b=Math.ceil(l/2);l=Math.floor(l/2);return x.decodeGeohashXY({geohashX:this.xNode<<30-(3*b+2*l),geohashY:this.yNode<<30-(2*b+3*l)},this.depth)}find(l,b,p,c,d,a){if(c>=p)return this;var n=1-c%2;const t=
3*n+2*(1-n),v=2*n+3*(1-n),y=30-d-t,h=30-a-v;n=this.children[((l&7*n+3*(1-n)<<y)>>y)+((b&3*n+7*(1-n)<<h)>>h)*(8*n+4*(1-n))];return null==n?null:n.find(l,b,p,c+1,d+t,a+v)}}g.GeohashNode=e;g.GeohashTree=f;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/geohashUtils":function(){define(["exports"],function(g){function q(l){return 57>=l?l-48:104>=l?l-88:107>=l?l-89:110>=l?l-90:l-91}function x(l,b,p){l[0]=b;l[1]=p;return l}function w(l,b){const p=(l[0]+l[1])/2,c=!b;l[0]=c*l[0]+
b*p;l[1]=c*p+b*l[1]}function C(l,b){b=b>(l[0]+l[1])/2;w(l,b);return b}function r(l,b){return b?1&l|(4&l)>>1|(16&l)>>2:(2&l)>>1|(8&l)>>2}function m(l,b){return b?(2&l)>>1|(8&l)>>2:1&l|(4&l)>>1|(16&l)>>2}function k(l,b,p){var c=!((l.length-1)%2);const d=l.substring(0,l.length-1);var a=q(l.charCodeAt(l.length-1)),n=0,t=0;let v=0;var y=0;c?(n=8,t=4,v=1&a|(4&a)>>1|(16&a)>>2,y=(2&a)>>1|(8&a)>>2):(n=4,t=8,y=1&a|(4&a)>>1|(16&a)>>2,v=(2&a)>>1|(8&a)>>2);b=v+b;a=y+p;p=Math.floor(b/n);y=Math.floor(a/t);n=b-p*
n;t=a-y*t;c="0123456789bcdefghjkmnpqrstuvwxyz"[c?n&1|(t&1)<<1|(n&2)<<1|(t&2)<<2|(n&4)<<2:t&1|(n&1)<<1|(t&2)<<1|(n&2)<<2|(t&4)<<2];return 1<l.length&&(p||y)?k(d,p,y)+c:d+c}const f=new Float64Array(2),e=new Float64Array(2);g.convertGeohash32ToXY=function(l,b){let p=l=0,c=30,d=30;for(let t=0;t<b.length;t++){var a=b.charCodeAt(t),n=q(a);a=0===t%2;const v=r(n,a);n=m(n,a);c-=a?3:2;d-=a?2:3;l|=v<<c;p|=n<<d}return{geohashX:l,geohashY:p}};g.decodeBase32Char=q;g.decodeGeohash=function(l,b){const p=x(f,-90,
90),c=x(e,-180,180);for(let a=0;a<b.length;a++){var d=b.charCodeAt(a);d=q(d);0===a%2?(w(c,!!(16&d)),w(c,!!(4&d)),w(c,!!(1&d)),w(p,!!(8&d)),w(p,!!(2&d))):(w(p,!!(16&d)),w(p,!!(4&d)),w(p,!!(1&d)),w(c,!!(8&d)),w(c,!!(2&d)))}l[0]=(p[0]+p[1])/2;l[1]=(c[0]+c[1])/2;return l};g.decodeGeohashXY=function(l,b){let p=-90,c=90,d=-180,a=180;for(let A=0;A<b;A++){var n=Math.ceil((A+1)/2),t=Math.floor((A+1)/2),v=1-A%2,y=30-(3*n+2*t),h=30-(2*n+3*t);t=3*v+2*(1-v);n=2*v+3*(1-v);y=(7*v+3*(1-v)<<y&l.geohashX)>>y;v=(3*
v+7*(1-v)<<h&l.geohashY)>>h;for(--t;0<=t;t--){h=(d+a)/2;const E=y&1<<t?1:0;d=(1-E)*d+E*h;a=(1-E)*h+E*a}for(--n;0<=n;n--)y=(p+c)/2,t=v&1<<n?1:0,p=(1-t)*p+t*y,c=(1-t)*y+t*c}return[d,p,a,c]};g.encodeBase32Char=function(l){return"0123456789bcdefghjkmnpqrstuvwxyz"[l]};g.encodeGeohash=function(l,b,p){let c="";const d=x(f,-90,90),a=x(e,-180,180);for(let n=0;n<p;n++){let t=0;n%2?(t|=C(d,l)<<4,t|=C(a,b)<<3,t|=C(d,l)<<2,t|=C(a,b)<<1,t|=C(d,l)<<0):(t|=C(a,b)<<4,t|=C(d,l)<<3,t|=C(a,b)<<2,t|=C(d,l)<<1,t|=C(a,
b)<<0);c+="0123456789bcdefghjkmnpqrstuvwxyz"[t]}return c};g.getRelativeGeohash=k;g.setGeohashBuf=function(l,b,p,c,d){d%2&&(d+=1);let a=0,n=0,t=-90,v=90,y=-180,h=180;for(let F=0;F<d/2;F++){for(var A=0;5>A;A++){var E=(y+h)/2,z=c>E?1:0;a|=z<<29-(A+5*F);y=(1-z)*y+z*E;h=(1-z)*E+z*h}for(A=0;5>A;A++)E=(t+v)/2,z=p>E?1:0,n|=z<<29-(A+5*F),t=(1-z)*t+z*E,v=(1-z)*E+z*v}l[2*b]=a;l[2*b+1]=n};g.setGeohashXY=function(l,b,p,c){c%2&&(c+=1);let d=0,a=0,n=-90,t=90,v=-180,y=180;for(let z=0;z<c/2;z++){for(var h=0;5>h;h++){var A=
(v+y)/2,E=p>A?1:0;d|=E<<29-(h+5*z);v=(1-E)*v+E*A;y=(1-E)*A+E*y}for(h=0;5>h;h++)A=(n+t)/2,E=b>A?1:0,a|=E<<29-(h+5*z),n=(1-E)*n+E*A,t=(1-E)*A+E*t}l.geohashX=d;l.geohashY=a};g.unpackXBits=r;g.unpackYBits=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ClusterStore":function(){define("exports ../../../../../geometry ../../../../../core/Evented ../../../../../core/has ../../../../../core/accessorSupport/diffUtils ../../../../../geohash/GeohashTree ../../../../../geohash/geohashUtils ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Ellipsoid ../../../../../geometry/support/spatialReferenceUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../layers/graphics/data/projectionSupport ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../FeatureStore2D ../Store2D ./FeatureSetReaderJSON ../../../../../geometry/SpatialReference ../../../../../geometry/Polygon ../../../../../geometry/Extent".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E){const z=k.create();class F extends b.OptimizedFeatureWithGeometry{constructor(B,u,H,G,I){super(new p([],[u,H]),G,null,B);this.geohashBoundsInfo=I}get count(){return this.attributes.cluster_count}static create(B,u,H,G,I,J,M,R){u=new F(u,H,G,J,M);u.displayId=B.createDisplayId(!0);u.referenceId=R;u.tileLevel=I;return u}update(B,u,H,G,I,J){this.geometry.coords[0]=B;this.geometry.coords[1]=u;this.tileLevel=H;this.attributes=G;this.geohashBoundsInfo=
I;this.referenceId=null;this.referenceId=J;return this}toJSON(){return{attributes:{...this.attributes,aggregateId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}}class D extends v.Store2D{constructor(B,u,H,G){super(B,H);this.type="cluster";this.events=new x;this.objectIdField="aggregateId";this.featureAdapter=t.featureAdapter;this._tileLevel=this._geohashLevel=0;this._aggregateValueRanges={};this._aggregateValueRangesChanged=
!1;this._geohashBuf=[];this._clusters=new Map;this._tiles=new Map;this._serviceInfo=G;this.geometryInfo=B.geometryInfo;this._spatialReference=u;this._projectionSupportCheck=c.checkProjectionSupport(u,h.WGS84);this._bitsets.geohash=H.getBitset(H.createBitset());this._bitsets.inserted=H.getBitset(H.createBitset())}destroy(){this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}async updateSchema(B,u){const H=this._schema;try{await super.updateSchema(B,
u),await this._projectionSupportCheck}catch(I){}this._fields=[...this._schema.params.fields,{name:"referenceId",alias:"referenceId",type:"esriFieldTypeInteger"}];this._fields.some(I=>"cluster_count"===I.name)||this._fields.push({name:"cluster_count",alias:"cluster_count",type:"esriFieldTypeInteger"});this._fieldsIndex=new d(this._fields);const G=C.diff(H,u);if(u&&(null!=G||B.source||B.storage.filters)){if(C.hasDiff(G,"params.fields")||!this._tree||B.source)this._tree&&this._tree.destroy(),this._tree=
new r.GeohashTree(this._statisticFields,this._serviceInfo),this._rebuildTree(),w("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing");w("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",G);B.targets[u.name]=!0;B.mesh=!1;this._aggregateValueRanges={}}else H&&(B.mesh=!0)}clear(){this._rebuildTree()}sweepFeatures(B,u){this._bitsets.inserted.forEachSet(H=>{B.has(H)||(H=u.lookupByDisplayIdUnsafe(H),this._remove(H))})}sweepAggregates(B,u,H){this._clusters.forEach((G,
I)=>{G&&G.tileLevel!==H&&(B.releaseDisplayId(G.displayId),u.unsetAttributeData(G.displayId),this._clusters.delete(I))})}onTileData(B,u,H,G,I,J=!0){if(!this._schema||null==u.addOrUpdate)return u;this.events.emit("changed");var M=this._getTransforms(B,this._spatialReference);const R=u.addOrUpdate.getCursor();for(;R.next();)this._update(R,G);if(u.status.mesh||!J)return u;G=[];this._getClustersForTile(G,B,this._schema.params.clusterRadius,H,M);u.addOrUpdate=y.FeatureSetReaderJSON.fromOptimizedFeatures(G,
{fields:this.fields,fieldsIndex:this._fieldsIndex,geometryType:"esriGeometryPoint",objectIdField:this.objectIdField});u.addOrUpdate.attachStorage(H);u.clear=!0;u.end=!0;for(M=u.addOrUpdate.getCursor();M.next();)G=M.getDisplayId(),this._bitsets.computed.unset(G),this.setComputedAttributes(H,M,G,B.scale,I);this._aggregateValueRangesChanged&&u.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1);return u}onTileUpdate({added:B,removed:u}){B.length&&
(this._tileLevel=B=B[0].level,this._setGeohashLevel(B));if(this._schema){var H=this._schema.params.clusterRadius;u.forEach(G=>{this._tiles.delete(G.key.id);this._markTileClustersForDeletion(G,H)})}}getAggregate(B){for(const u of this._clusters.values())if((u?.displayId&n.displayIdTexelMask)===(B&n.displayIdTexelMask))return u.toJSON();return null}getAggregates(){const B=[];for(const u of this._clusters.values())u?.tileLevel===this._tileLevel&&B.push(u.toJSON());return B}getDisplayId(B){return(B=this._clusters.get(B))?
B.displayId:null}getFeatureDisplayIdsForAggregate(B){return(B=this._clusters.get(B))?this._tree.getRegionDisplayIds(B.geohashBoundsInfo):[]}getDisplayIdForReferenceId(B){for(const u of this._clusters.values())if(u?.referenceId===B)return u.displayId;return null}getAggregateValueRanges(){return this._aggregateValueRanges}forEach(B){this._clusters.forEach(u=>{u&&(u=u.toJSON(),u=y.FeatureSetReaderJSON.fromFeatures([u],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,
fields:this.fields,fieldsIndex:this._fieldsIndex}).getCursor(),u.next(),B(u))})}forEachInBounds(B,u){}forEachBounds(B,u){const {hasM:H,hasZ:G}=this.geometryInfo;for(const I of B)B=l.getBoundsOptimizedGeometry(z,I.readGeometry(),G,H),null!=B&&u(B)}size(){let B=0;this.forEach(u=>B++);return B}_rebuildTree(){this._bitsets.computed.clear();this._bitsets.inserted.clear();this._tree&&this._tree.clear()}_remove(B){const u=B.getDisplayId(),H=B.getXHydrated(),G=B.getYHydrated(),I=this._geohashBuf[2*u],J=this._geohashBuf[2*
u+1];this._bitsets.inserted.has(u)&&(this._bitsets.inserted.unset(u),this._tree.removeCursor(B,H,G,I,J,this._geohashLevel))}_update(B,u){const H=B.getDisplayId(),G=this._bitsets.inserted;u=u.isVisible(H);var I=G.has(H);u!==I&&(u?(u=B.getXHydrated(),I=B.getYHydrated(),this._setGeohash(H,u,I)&&(this._tree.insertCursor(B,H,u,I,this._geohashBuf[2*H],this._geohashBuf[2*H+1],this._geohashLevel),G.set(H))):this._remove(B))}_setGeohash(B,u,H){if(this._bitsets.geohash.has(B))return!0;const G=this._geohashBuf;
if(this._spatialReference.isWebMercator)u=u/f.earth.radius*57.29577951308232,m.setGeohashBuf(G,B,57.29577951308232*(Math.PI/2-2*Math.atan(Math.exp(-H/f.earth.radius))),u-360*Math.floor((u+180)/360),12);else{H=c.project({x:u,y:H},this._spatialReference,h.WGS84);if(!H)return!1;m.setGeohashBuf(G,B,H.y,H.x,12)}this._bitsets.geohash.set(B);return!0}_getClustersForTile(B,u,H,G,I,J=!0){var M=2*H;H=Math.ceil(2**u.key.level*a.tileSize/M)+1;var R=Math.ceil(this._schema.params.clusterPixelBuffer/M)+0,Y=Math.ceil(a.tileSize/
M);const {row:fa,col:O}=u.key;var Q=Math.floor(O*a.tileSize/M)-R;M=Math.floor(fa*a.tileSize/M)-R;const Z=Q+Y+2*R;R=M+Y+2*R;for(Y=u.tileInfoView.getLODInfoAt(u.key.level);Q<=Z;Q++)for(let ca=M;ca<=R;ca++){var ba=Q;Y.wrap&&(ba=0>Q?Q+H:Q%H);var da=Y.wrap&&0>Q,P=Y.wrap&&Q%H!==Q;ba=this._lookupCluster(G,Y,u.key.level,ba,ca,u);if(null!=ba){var U=null;I&&(U=da?I.left:P?I.right:I.tile);J&&null==U||!ba.count||null==U||!J||(da=ba.geometry.clone(),P=ba.attributes,da.coords[0]=l.quantizeX(U,da.coords[0]),da.coords[1]=
l.quantizeY(U,da.coords[1]),1===ba.count&&null!=ba.referenceId&&(P={...ba.attributes,referenceId:ba.referenceId}),U=new b.OptimizedFeature(da,P),U.displayId=ba.displayId,B.push(U))}}}_getGeohashLevel(B){return Math.min(Math.ceil(B/2+2),12)}_setGeohashLevel(B){B=this._getGeohashLevel(B);B=1*(Math.floor(B/1)+1)-1;this._geohashLevel!==B&&(this._geohashLevel=B,this._rebuildTree(),this._bitsets.geohash.clear())}_getTransforms(B,u){const H={originPosition:"upperLeft",scale:[B.resolution,B.resolution],translate:[B.bounds[0],
B.bounds[3]]};u=e.getInfo(u);if(!u)return{tile:H,left:null,right:null};const [G,I]=u.valid;return{tile:H,left:{...H,translate:[I,B.bounds[3]]},right:{...H,translate:[G-I+B.bounds[0],B.bounds[3]]}}}_getClusterId(B,u,H){return(B&15)<<28|(u&16383)<<14|H&16383}_markForDeletion(B,u,H){B=this._getClusterId(B,u,H);this._clusters.delete(B)}_getClusterBounds(B,u,H){var G=this._schema.params.clusterRadius,I=2*G;u=H%2?u*I:u*I-G;const J=H*I;G=u+I;H=2**B.level*a.tileSize;B.wrap&&0>u&&(u=0);B.wrap&&G>H&&(G=H);
H=J/a.tileSize;G/=a.tileSize;I=(J-I)/a.tileSize;u=B.getXForColumn(u/a.tileSize);H=B.getYForRow(H);G=B.getXForColumn(G);B=B.getYForRow(I);return[u,H,G,B]}_getGeohash(B,u,H){const G={geohashX:0,geohashY:0};m.setGeohashXY(G,u,B,H);return G}_getGeohashBounds(B,u){const H=this._getGeohashLevel(B.key.level);if(this._spatialReference.isWebMercator){const [Y,fa,O,Q]=u;var G=fa,I=O,J=Q,M=B=u=0,R=0;u=Y/f.earth.radius*57.29577951308232;u-=360*Math.floor((u+180)/360);B=57.29577951308232*(Math.PI/2-2*Math.atan(Math.exp(-G/
f.earth.radius)));M=I/f.earth.radius*57.29577951308232;M-=360*Math.floor((M+180)/360);R=57.29577951308232*(Math.PI/2-2*Math.atan(Math.exp(-J/f.earth.radius)));J={geohashX:0,geohashY:0};G={geohashX:0,geohashY:0};m.setGeohashXY(J,B,u,H);m.setGeohashXY(G,R,M,H);return{bounds:[Y,fa,O,Q],geohashBounds:{xLL:J.geohashX,yLL:J.geohashY,xTR:G.geohashX,yTR:G.geohashY},level:H}}J=A.fromExtent(E.fromBounds(u,this._spatialReference));B=c.project(J,this._spatialReference,h.WGS84,{densificationStep:64*B.resolution});
if(!B)return null;B=l.convertFromPolygon(new p,B,!1,!1);M=B.coords.filter((Y,fa)=>!(fa%2));R=B.coords.filter((Y,fa)=>fa%2);B=Math.min(...M);J=Math.min(...R);M=Math.max(...M);R=Math.max(...R);B=this._getGeohash(B,J,H);J=this._getGeohash(M,R,H);return{bounds:u,geohashBounds:{xLL:B.geohashX,yLL:B.geohashY,xTR:J.geohashX,yTR:J.geohashY},level:H}}_lookupCluster(B,u,H,G,I,J){const M=this._getClusterId(H,G,I),R=this._clusters.get(M);u=this._getClusterBounds(u,G,I);J=this._getGeohashBounds(J,u);if(null==
J)return null;var Y=this._tree.getRegionStatistics(J);const {count:fa,xTotal:O,yTotal:Q,referenceId:Z}=Y;G=fa?O/fa:0;I=fa?Q/fa:0;if(0===fa)return this._clusters.set(M,null),null;Y={cluster_count:fa,...Y.attributes};B=null!=R?R.update(G,I,H,Y,J,Z):F.create(B,M,G,I,H,Y,J,Z);if(0===fa){const [ba,da,P,U]=u;B.geometry.coords[0]=(ba+P)/2;B.geometry.coords[1]=(da+U)/2}this._clusters.set(M,B);this._updateAggregateValueRangeForCluster(B,B.tileLevel);return B}_updateAggregateValueRangeForCluster(B,u){const H=
this._aggregateValueRanges[u]||{minValue:Infinity,maxValue:0},G=H.minValue,I=H.maxValue;H.minValue=Math.min(G,B.count);H.maxValue=Math.max(I,B.count);this._aggregateValueRanges[u]=H;if(G!==H.minValue||I!==H.maxValue)this._aggregateValueRangesChanged=!0}_markTileClustersForDeletion(B,u){var H=2*u;u=Math.ceil(a.tileSize/H);const {row:G,col:I}=B.key,J=Math.floor(I*a.tileSize/H);H=Math.floor(G*a.tileSize/H);for(let M=J;M<J+u;M++)for(let R=H;R<H+u;R++)this._markForDeletion(B.key.level,M,R)}}g.ClusterInfo=
F;g.ClusterStore=D;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define(["exports","../../../engine/webgl/DisplayId","./DisplayIdGenerator","./StaticBitSet"],function(g,q,x,w){function C(m,k,f){if(!(m.length>k))for(;m.length<=k;)m.push(f)}class r{constructor(){this._numerics=[];this._strings=[];this._idGenerator=new x.DisplayIdGenerator;this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=
[]}createBitset(){const m=this._bitsets.length;this._bitsets.push(w.StaticBitSet.create(this._allocatedSize,q.displayIdTexelMask));return m+1}getBitset(m){return this._bitsets[m-1]}_expand(){this._allocatedSize<<=1;for(const m of this._bitsets)m.resize(this._allocatedSize)}_ensureNumeric(m,k){this._numerics[m]||(this._numerics[m]=[]);C(this._numerics[m],k,0)}_ensureInstanceId(m){C(this._instanceIds,m,0)}_ensureString(m,k){this._strings[m]||(this._strings[m]=[]);C(this._strings[m],k,null)}createDisplayId(m=
!1){const k=this._idGenerator.createId();k>this._allocatedSize&&this._expand();return q.createDisplayId(k,m)}releaseDisplayId(m){for(const k of this._bitsets)k.unset(m);return this._idGenerator.releaseId(m&q.displayIdTexelMask)}getComputedNumeric(m,k){return this.getComputedNumericAtIndex(m&q.displayIdTexelMask,0)}setComputedNumeric(m,k,f){return this.setComputedNumericAtIndex(m&q.displayIdTexelMask,f,0)}getComputedString(m,k){return this.getComputedStringAtIndex(m&q.displayIdTexelMask,0)}setComputedString(m,
k,f){return this.setComputedStringAtIndex(m&q.displayIdTexelMask,0,f)}getComputedNumericAtIndex(m,k){m&=q.displayIdTexelMask;this._ensureNumeric(k,m);return this._numerics[k][m]}setComputedNumericAtIndex(m,k,f){m&=q.displayIdTexelMask;this._ensureNumeric(k,m);this._numerics[k][m]=f}getInstanceId(m){m&=q.displayIdTexelMask;this._ensureInstanceId(m);return this._instanceIds[m]}setInstanceId(m,k){m&=q.displayIdTexelMask;this._ensureInstanceId(m);this._instanceIds[m]=k}getComputedStringAtIndex(m,k){m&=
q.displayIdTexelMask;this._ensureString(k,m);return this._strings[k][m]}setComputedStringAtIndex(m,k,f){m&=q.displayIdTexelMask;this._ensureString(k,m);this._strings[k][m]=f}getXMin(m){return this._bounds[4*(m&q.displayIdTexelMask)]}getYMin(m){return this._bounds[4*(m&q.displayIdTexelMask)+1]}getXMax(m){return this._bounds[4*(m&q.displayIdTexelMask)+2]}getYMax(m){return this._bounds[4*(m&q.displayIdTexelMask)+3]}setBounds(m,k){k=k.readHydratedGeometry();if(!k?.coords.length)return!1;let f=Infinity,
e=Infinity,l=-Infinity,b=-Infinity;k.forEachVertex((p,c)=>{f=Math.min(f,p);e=Math.min(e,c);l=Math.max(l,p);b=Math.max(b,c)});m&=q.displayIdTexelMask;C(this._bounds,4*m+4,0);this._bounds[4*m]=f;this._bounds[4*m+1]=e;this._bounds[4*m+2]=l;this._bounds[4*m+3]=b;return!0}}g.ComputedAttributeStorage=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(g,q){class x{constructor(){this._freeIds=
[];this._idCounter=1}createId(w=!1){return q.createDisplayId(this._getFreeId(),w)}releaseId(w){this._freeIds.push(w)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}g.DisplayIdGenerator=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/TileStore":function(){define("../../../../../core/Evented ../../../../../core/has ../../../../../chunks/rbush ./Tile ../../../tiling/TileCoverage ../../../tiling/TileKey".split(" "),
function(g,q,x,w,C,r){const m={added:[],removed:[]},k=new Set,f=new r(0,0,0,0);class e extends g{constructor(l){super();this._tiles=new Map;this._index=x.rbush(9,q("esri-csp-restrictions")?b=>({minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this.tiles=[];this.tileScheme=l}destroy(){this.clear()}clear(){this.tiles.length=0;this._tiles.clear();this._index.clear()}has(l){return this._tiles.has(l)}get(l){return this._tiles.get(l)}boundsIntersections(l){return this._index.search({minX:l[0],
minY:l[1],maxX:l[2],maxY:l[3]})}updateTiles(l){const b={added:[],removed:[]};for(const p of l.added)if(!this.has(p)){const c=new w.Tile(this.tileScheme,p);this._tiles.set(p,c);this._index.insert(c);b.added.push(c)}for(const p of l.removed)this.has(p)&&(l=this.get(p),this._tiles.delete(p),this._index.remove(l),b.removed.push(l));this.tiles.length=0;this._tiles.forEach(p=>this.tiles.push(p));(b.added.length||b.removed.length)&&this.emit("update",b)}setViewState(l){if(l=this.tileScheme.getTileCoverage(l,
0)){var {spans:b,lodInfo:p}=l,{level:c}=p;if(0<b.length)for(const {row:a,colFrom:n,colTo:t}of b)for(var d=n;d<=t;d++){const v=f.set(c,a,p.normalizeCol(d),p.getWorldForColumn(d)).id;k.add(v);if(!this.has(v)){const y=new w.Tile(this.tileScheme,v);this._tiles.set(v,y);this._index.insert(y);this.tiles.push(y);m.added.push(y)}}for(c=this.tiles.length-1;0<=c;c--)d=this.tiles[c],k.has(d.id)||(this._tiles.delete(d.id),this.tiles.splice(c,1),this._index.remove(d),m.removed.push(d));(m.added.length||m.removed.length)&&
this.emit("update",m);C.pool.release(l);k.clear();m.added.length=0;m.removed.length=0}}}return e})},"esri/views/2d/layers/features/support/Tile":function(){define("exports ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../rest/support/QuantizationParameters ../../../tiling/TileKey".split(" "),function(g,q,x,w,C,r){class m{constructor(k,f){this.key=new r(0,0,0,0);this.bounds=w.create();this.objectIds=new Set;this.key.set(f);f=
k.getLODInfoAt(this.key);this.tileInfoView=k;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=f.resolution;this.scale=f.scale;this.level=f.level}get id(){return this.key.id}get extent(){return x.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const k=this.key.getChildKeys(),f=q.acquire();for(let e=0;e<k.length;e++)f[e]=
new m(this.tileInfoView,k[e]);return f}getQuantizationParameters(){return C.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}g.Tile=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(g){class q{static getId(x,w,C,r){return"object"===
typeof x?`${x.level}/${x.row}/${x.col}/${x.world}`:`${x}/${w}/${C}/${r}`}constructor(x,w,C,r){this.set(x,w,C,r)}get key(){return this}get id(){return this.toString()}set id(x){this.set(x)}get hash(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(x,w,C,r){this.set(x,w,C,r)}contains(x){const w=x.level-this.level;return 0<=w&&this.row===x.row>>w&&this.col===x.col>>w&&this.world===x.world}equals(x){return this.level===x.level&&this.row===x.row&&this.col===x.col&&
this.world===x.world}clone(){return new q(this)}release(){this.world=this.col=this.row=this.level=0}set(x,w,C,r){if(null==x)this.world=this.col=this.row=this.level=0;else if("object"===typeof x)this.level=x.level||0,this.row=x.row||0,this.col=x.col||0,this.world=x.world||0;else if("string"===typeof x){const [m,k,f,e]=x.split("/");this.level=parseFloat(m);this.row=parseFloat(k);this.col=parseFloat(f);this.world=parseFloat(e)}else this.level=+x,this.row=+w,this.col=+C,this.world=+r||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=
this.level?null:new q(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const x=this.level+1,w=this.row<<1,C=this.col<<1,r=this.world;return[new q(x,w,C,r),new q(x,w,C+1,r),new q(x,w+1,C,r),new q(x,w+1,C+1,r)]}compareRowMajor(x){return this.row<x.row?-1:this.row>x.row?1:this.col<x.col?-1:this.col>x.col?1:0}}q.pool=new g(q,null,null,25,50);return q})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool"],function(g){class q{constructor(){this.spans=[]}acquire(x){this.lodInfo=
x}release(){this.lodInfo=null;this.spans.length=0}forEach(x,w){const {spans:C,lodInfo:r}=this,{level:m}=r;if(0!==C.length)for(const {row:k,colFrom:f,colTo:e}of C)for(let l=f;l<=e;l++)x.call(w,m,k,r.normalizeCol(l),r.getWorldForColumn(l))}}q.pool=new g(q);return q})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(g,q,x,w,C){const r=new w("0/0/0/0");class m{static create(e,l){e[1]>
l[1]&&([e,l]=[l,e]);const [b,p]=e,[c,d]=l;e=c-b;l=d-p;l=0!==l?e/l:0;const a=(Math.ceil(p)-p)*l,n=(Math.floor(p)-p)*l;return new m(b,Math.floor(p),Math.ceil(d),l,0>e?a:n,0>e?n:a,0>e?c:b,0>e?b:c)}constructor(e,l,b,p,c,d,a,n){this.x=e;this.ymin=l;this.ymax=b;this.invM=p;this.leftAdjust=c;this.rightAdjust=d;this.leftBound=a;this.rightBound=n}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}
const k=[[0,0],[0,0],[0,0],[0,0]];class f{constructor(e,l=null,b=e.lods[0].level,p=e.lods[e.lods.length-1].level){this.tileInfo=e;this.fullExtent=l;this.scales=[];this._infoByScale={};this._infoByLevel={};const c=e.lods.filter(a=>a.level>=b&&a.level<=p);this.minScale=c[0].scale;this.maxScale=c[c.length-1].scale;const d=this._lodInfos=c.map(a=>q.create(e,a,l));c.forEach((a,n)=>{this._infoByLevel[a.level]=d[n];this._infoByScale[a.scale]=d[n];this.scales[n]=a.scale},this);this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"===
typeof e?e:e.level]}getTileBounds(e,l,b=!1){r.set(l);return(l=this._infoByLevel[r.level])?l.getTileBounds(e,r,b):e}getTileCoords(e,l,b=!1){r.set(l);return(l=this._infoByLevel[r.level])?l.getTileCoords(e,r,b):e}getTileCoverage(e,l=192,b=!0,p="closest"){if(!b&&(e.scale>this.minScale||e.scale<this.maxScale))return null;b="closest"===p?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale);p=x.pool.acquire(b);const c=this._wrap;var d=Infinity;let a=-Infinity;const n=p.spans;k[0][0]=
k[0][1]=k[1][1]=k[3][0]=-l;k[1][0]=k[2][0]=e.size[0]+l;k[2][1]=k[3][1]=e.size[1]+l;for(t of k)e.toMap(t,t),t[0]=b.getColumnForX(t[0]),t[1]=b.getRowForY(t[1]);e=[];var t=3;for(l=0;4>l;l++)k[l][1]===k[t][1]?t=l:(t=m.create(k[l],k[t]),d=Math.min(t.ymin,d),a=Math.max(t.ymax,a),void 0===e[t.ymin]&&(e[t.ymin]=[]),e[t.ymin].push(t),t=l);if(null==d||null==a||100<a-d)return null;for(l=[];d<a;){null!=e[d]&&(l=l.concat(e[d]));t=Infinity;var v=-Infinity;for(var y=l.length-1;0<=y;y--){var h=l[y];t=Math.min(t,
h.getLeftCol());v=Math.max(v,h.getRightCol())}t=Math.floor(t);v=Math.floor(v);if(d>=b.first[1]&&d<=b.last[1])if(c)if(b.size[0]<b.worldSize[0])for(y=Math.floor(v/b.worldSize[0]),h=Math.floor(t/b.worldSize[0]);h<=y;h++)n.push(new C(d,Math.max(b.getFirstColumnForWorld(h),t),Math.min(b.getLastColumnForWorld(h),v)));else n.push(new C(d,t,v));else t>b.last[0]||v<b.first[0]||(t=Math.max(t,b.first[0]),v=Math.min(v,b.last[0]),n.push(new C(d,t,v)));d+=1;for(t=l.length-1;0<=t;t--)v=l[t],v.ymax>=d?v.incrRow():
l.splice(t,1)}return p}getTileParentId(e){r.set(e);e=this._lodInfos.indexOf(this._infoByLevel[r.level])-1;if(0>e)return null;this._getTileIdAtLOD(r,this._lodInfos[e],r);return r.id}getTileResolution(e){return(e=this._infoByLevel["object"===typeof e?e.level:e])?e.resolution:-1}getTileScale(e){return(e=this._infoByLevel[e.level])?e.scale:-1}intersects(e,l){r.set(l);l=this._infoByLevel[r.level];const b=e.lodInfo;if(b.resolution>l.resolution){this._getTileIdAtLOD(r,b,r);var p=b.denormalizeCol(r.col,r.world);
for(var c of e.spans)if(c.row===r.row&&c.colFrom<=p&&c.colTo>=p)return!0}if(b.resolution<l.resolution){const [a,n,t,v]=e.spans.reduce((y,h)=>{y[0]=Math.min(y[0],h.row);y[1]=Math.max(y[1],h.row);y[2]=Math.min(y[2],h.colFrom);y[3]=Math.max(y[3],h.colTo);return y},[Infinity,-Infinity,Infinity,-Infinity]);p=l.denormalizeCol(r.col,r.world);e=b.getColumnForX(l.getXForColumn(p));c=b.getRowForY(l.getYForRow(r.row));p=b.getColumnForX(l.getXForColumn(p+1))-1;l=b.getRowForY(l.getYForRow(r.row+1))-1;return!(e>
v||p<t||c>n||l<a)}const d=b.denormalizeCol(r.col,r.world);return e.spans.some(a=>a.row===r.row&&a.colFrom<=d&&a.colTo>=d)}normalizeBounds(e,l,b){e[0]=l[0];e[1]=l[1];e[2]=l[2];e[3]=l[3];this._wrap&&(l=g.getInfo(this.tileInfo.spatialReference),b=-b*(l.valid[1]-l.valid[0]),e[0]+=b,e[2]+=b);return e}getSmallestInfoForScale(e){const l=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>l[0])return this._infoByScale[l[0]];for(let b=1;b<l.length-1;b++)if(e>l[b]+1E-6)return this._infoByScale[l[b-
1]];return this._infoByScale[l[l.length-1]]}getClosestInfoForScale(e){const l=this.scales;if(this._infoByScale[e])return this._infoByScale[e];e=l.reduce((b,p)=>Math.abs(p-e)<Math.abs(b-e)?p:b,l[0]);return this._infoByScale[e]}scaleToLevel(e){const l=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let b=l.length-1;0<=b;b--)if(e<l[b])return b===l.length-1?this._infoByScale[l[l.length-1]].level:this._infoByScale[l[b]].level+(l[b]-e)/(l[b]-l[b+1]);return this._infoByScale[l[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,
l,b){const p=this._infoByLevel[b.level];e.set(b);if(l.resolution<p.resolution)return null;if(l.resolution===p.resolution)return e;e.level=l.level;e.col=Math.floor(b.col*p.resolution/l.resolution+.01);e.row=Math.floor(b.row*p.resolution/l.resolution+.01);return e}}return f})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(g,q){function x(r,m,k){r[0]=m;r[1]=k;return r}const w=new q("0/0/0/0");class C{static create(r,m,k=null){var f=
g.getInfo(r.spatialReference);const e=m.origin||[r.origin.x,r.origin.y],l=[r.size[0]*m.resolution,r.size[1]*m.resolution],b=[-Infinity,-Infinity],p=[Infinity,Infinity],c=[Infinity,Infinity];null!=k&&(x(b,Math.max(0,Math.floor((k.xmin-e[0])/l[0])),Math.max(0,Math.floor((e[1]-k.ymax)/l[1]))),x(p,Math.max(0,Math.floor((k.xmax-e[0])/l[0])),Math.max(0,Math.floor((e[1]-k.ymin)/l[1]))),x(c,p[0]-b[0]+1,p[1]-b[1]+1));const {cols:d,rows:a}=m;!k&&d&&a&&(x(b,d[0],a[0]),x(p,d[1],a[1]),x(c,d[1]-d[0]+1,a[1]-a[0]+
1));let n;r.isWrappable?(r=[Math.ceil(Math.round((f.valid[1]-f.valid[0])/m.resolution)/r.size[0]),c[1]],f=[Math.floor((f.origin[0]-e[0])/l[0]),b[1]],k=[r[0]+f[0]-1,p[1]],n=!0):(f=b,k=p,r=c,n=!1);return new C(m.level,m.resolution,m.scale,e,b,p,c,l,f,k,r,n)}constructor(r,m,k,f,e,l,b,p,c,d,a,n){this.level=r;this.resolution=m;this.scale=k;this.origin=f;this.first=e;this.last=l;this.size=b;this.norm=p;this.worldStart=c;this.worldEnd=d;this.worldSize=a;this.wrap=n}normalizeCol(r){if(!this.wrap)return r;
const m=this.worldSize[0];return 0>r?m-1-Math.abs((r+1)%m):r%m}denormalizeCol(r,m){return this.wrap?this.worldSize[0]*m+r:r}getWorldForColumn(r){return this.wrap?Math.floor(r/this.worldSize[0]):0}getFirstColumnForWorld(r){return r*this.worldSize[0]+this.first[0]}getLastColumnForWorld(r){return r*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(r){return(r-this.origin[0])/this.norm[0]}getXForColumn(r){return this.origin[0]+r*this.norm[0]}getRowForY(r){return(this.origin[1]-r)/this.norm[1]}getYForRow(r){return this.origin[1]-
r*this.norm[1]}getTileBounds(r,m,k=!1){w.set(m);var f=k?w.col:this.denormalizeCol(w.col,w.world),e=w.row;m=this.getXForColumn(f);k=this.getYForRow(e+1);f=this.getXForColumn(f+1);e=this.getYForRow(e);r[0]=m;r[1]=k;r[2]=f;r[3]=e;return r}getTileCoords(r,m,k=!1){w.set(m);m=k?w.col:this.denormalizeCol(w.col,w.world);Array.isArray(r)?x(r,this.getXForColumn(m),this.getYForRow(w.row)):(r.x=this.getXForColumn(m),r.y=this.getYForRow(w.row));return r}}return C})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class g{constructor(q,
x,w){this.row=q;this.colFrom=x;this.colTo=w}}return g})},"esri/views/2d/layers/features/processors/SymbolProcessor":function(){define("../../../../../chunks/tslib.es6 ../../../../../core/BidiText ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/accessorSupport/diffUtils ../../../../../geometry/SpatialReference ../../../engine/webgl/DisplayId ../../../engine/webgl/enums ../../../engine/webgl/mesh/MeshData ../../../engine/webgl/mesh/factories/WGLMeshFactory ../../../engine/webgl/mesh/templates/WGLTemplateStore ../../../engine/webgl/util/Matcher ../textUtils ./BaseProcessor ../support/ResourceManagerProxy".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h){function A(z,F){return(!z.minScale||z.minScale>=F-F/4)&&(!z.maxScale||z.maxScale<=F+F/2)}function E(z){z=z.message;const F={message:{data:{},tileKey:z.tileKey,tileKeyOrigin:z.tileKeyOrigin,version:z.version},transferList:[]};for(const u in z.data){const H=u;var D=z.data[H];F.message.data[H]=null;if(null!=D){var B=D.stride;const G=D.indices.slice(0),I=D.vertices.slice(0),J=D.records.slice(0);D=D.metrics?.slice(0);B={stride:B,indices:G,vertices:I,
records:J,metrics:D};F.transferList.push(G,I,J);F.message.data[H]=B}}return F}x=class extends y{constructor(){super(...arguments);this.type="symbol";this._matchers={feature:null,aggregate:null};this._bufferData=new Map;this._bufferIds=new Map}initialize(){this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this))]);this._resourceManagerProxy=new h(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(z){this._bufferIds.forEach(F=>
{F.forEach(z)})}async update(z,F){F=F.schema.processors[0];if("symbol"===F.type){var D=l.diff(this._schema,F);if(l.hasDiff(D,"mesh")||l.hasDiff(D,"target"))z.mesh=!0,z.why?.mesh.push("Symbology changed"),this._schema=F,this._factory=this._createFactory(F),this._factory.update(F,this.tileStore.tileScheme.tileInfo)}}onTileMessage(z,F,D,B){m.throwIfAborted(B);return this._onTileData(z,F,D,B)}onTileClear(z,F){F={clear:!0,end:F};this._bufferData.delete(z.key.id);this._bufferIds.delete(z.key.id);return this.remoteClient.invoke("tileRenderer.onTileData",
{tileKey:z.id,data:F})}onTileError(z,F,D){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:z.id,error:F},{signal:D.signal})}onTileUpdate(z){for(const F of z.removed)this._bufferData.has(F.key.id)&&this._bufferData.delete(F.key.id),this._bufferIds.has(F.key.id)&&this._bufferIds.delete(F.key.id);for(const F of z.added)this._bufferData.forEach(D=>{for(const B of D)B.message.tileKey===F.id&&this._updateTileMesh("append",F,E(B),[],!1,!1,null)})}_addBufferData(z,F){this._bufferData.has(z)||
this._bufferData.set(z,[]);this._bufferData.get(z)?.push(E(F))}_createFactory(z){const {geometryType:F,objectIdField:D,fields:B}=this.service;var u=b.fromJSON(this.spatialReference);u={geometryType:F,fields:B,spatialReference:u};const H=new n.WGLTemplateStore((J,M)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",J,M),this.tileStore.tileScheme.tileInfo),{matcher:G,aggregateMatcher:I}=z.mesh;this._store=H;this._matchers.feature=t.createMatcher(G,H,u,this._resourceManagerProxy);this._matchers.aggregate=
I?t.createMatcher(I,H,u,this._resourceManagerProxy):null;return new a.WGLMeshFactory(F,D,H)}async _onTileData(z,F,D,B){m.throwIfAborted(B);const {type:u,addOrUpdate:H,remove:G,clear:I,end:J}=F;var M=!!this._schema.mesh.sortKey;if(!H)return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:z.id,data:{type:u,addOrUpdate:null,remove:G,clear:I,end:J,sort:M}},B);D=this._processFeatures(z,H,D,B,F.status?.version);try{var R=await D;if(null==R)return this.remoteClient.invoke("tileRenderer.onTileData",
{tileKey:z.id,data:{type:u,addOrUpdate:null,remove:G,clear:I,end:J,sort:M}},B);M=[];for(const Y of R){R=!1;const fa=Y.message.bufferIds,O=z.key.id,Q=Y.message.tileKey;if(O!==Q&&null!=fa){if(!this.tileStore.get(Q)){this._addBufferData(O,Y);M.push(Y);continue}let Z=this._bufferIds.get(Q);Z||(Z=new Set,this._bufferIds.set(Q,Z));const ba=Array.from(fa);for(const da of ba)if(Z.has(da)){R=!0;break}else Z.add(da)}R||(this._addBufferData(O,Y),M.push(Y))}await Promise.all(M.map(Y=>{const fa=z.key.id===Y.message.tileKey;
return this._updateTileMesh(u,z,Y,fa?F.remove:[],fa&&F.end,!!F.clear,B.signal)}))}catch(Y){this._handleError(z,Y,B)}}async _updateTileMesh(z,F,D,B,u,H,G){const I=D.message.tileKey,J=!!this._schema.mesh.sortKey;I!==F.key.id&&(u=!1);z={type:z,addOrUpdate:D?.message,remove:B,clear:H,end:u,sort:J};D={transferList:D?.transferList??[],signal:G};m.throwIfAborted(D);return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:I,data:z},D)}async _processFeatures(z,F,D,B,u){if(null==F||!F.hasFeatures)return null;
const H={transform:z.transform,hasZ:!1,hasM:!1},G=this._factory,I={viewingMode:"",scale:z.scale},J=await this._matchers.feature,M=await this._matchers.aggregate;m.throwIfAborted(B);const R=this._getLabelInfos(z,F);await G.analyze(F.getCursor(),this._resourceManagerProxy,J,M,H,I);m.throwIfAborted(B);return this._writeFeatureSet(z,F,H,R,G,D,u)}_writeFeatureSet(z,F,D,B,u,H,G){const I=F.getSize(),J=this._schema.mesh.matcher.symbologyType;H=new d.MeshData(z.key.id,{features:I,records:I,metrics:0},J,H,
J!==c.WGLSymbologyType.HEATMAP,G);G={viewingMode:"",scale:z.scale};for(F=F.getCursor();F.next();)try{const M=F.getDisplayId(),R=null!=B?B.get(M):null;u.writeCursor(H,F,D,G,z.level,R,this._resourceManagerProxy)}catch(M){}return H.serialize(z.tileInfoView.tileInfo.isWrappable)}_handleError(z,F,D){return m.isAbortError(F)?Promise.resolve():this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:z.id,error:F.message},{signal:D.signal})}_getLabelingSchemaForScale(z){var F=this._schema.mesh.labels;
if(null==F)return null;if("subtype"===F.type){const D={type:"subtype",classes:{}};let B=!1;for(const u in F.classes){const H=F.classes[u].filter(G=>A(G,z.scale));B=B||!!H.length;D.classes[u]=H}return B?D:null}F=F.classes.filter(D=>A(D,z.scale));return F.length?{type:"simple",classes:F}:null}_getLabels(z,F){if("subtype"===F.type){const D=this.service.subtypeField;r.assertIsSome(D,"Expected to find subtype Field");z=z.readAttribute(D);return null==z?[]:F.classes[z]??[]}return F.classes}_getLabelInfos(z,
F){z=this._getLabelingSchemaForScale(z);if(null==z)return null;const D=new Map;for(F=F.getCursor();F.next();){const u=F.getDisplayId(),H=[],G=p.isAggregateId(u),I=G&&1!==F.readAttribute("cluster_count")?"aggregate":"feature";var B=this._getLabels(F,z);for(const J of B){if(J.target!==I)continue;B=F.getStorage();B=G&&"feature"===I?B.getComputedStringAtIndex(F.readAttribute("referenceId"),J.fieldIndex):B.getComputedStringAtIndex(u,J.fieldIndex);if(!B)continue;B=q.bidiText(B.toString());const M=B[1];
this._store.getMosaicItem(J.symbol,v.codepoints(B[0])).then(R=>{H[J.index]={glyphs:R.glyphMosaicItems??[],rtl:M,index:J.index}})}D.set(u,H)}return D}};return x=g.__decorate([e.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],x)})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(g,q){const x=new q;g.bidiText=function(w){if(null==w)return["",!1];if(!x.hasBidiChar(w))return[w,!1];let C;C="rtl"===x.checkContextual(w)?"IDNNN":"ICNNN";return[x.bidiTransform(w,
C,"VLYSN"),!0]};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define("exports ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ../DisplayId ../enums ../Utils ./VertexDataWriter ../../../layers/features/support/tileUtils".split(" "),function(g,q,x,w,C,r,m,k,f,e,l){function b(d){switch(d){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}
function p(d){switch(d){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class c{constructor(d,a,n,t,v,y=0){this.hasRecords=this._hasAggregate=!1;this._data={self:new Map,neighbors:[]};this._version=0;this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0};this.hint=a;this.tileKey=d;this._hasAggregate=t;this._pixelBufferEnabled=
v;this._version=y;this._symbologyType=n}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(d){const a=[];a.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self));this._data.neighbors.forEach((n,t)=>{var v=1<<t;t=b(v);v=p(v);t=l.getPow2NeighborKey(new x(this.tileKey),t,v,d);t=this._serializeTileVertexData(this.tileKey,t.id,n.vertexData);t.message.bufferIds=n.displayIds;a.push(t)});return a}_serializeTileVertexData(d,
a,n){const t=[];n={[k.WGLGeometryType.MARKER]:n.get(k.WGLGeometryType.MARKER)?.serialize(t),[k.WGLGeometryType.FILL]:n.get(k.WGLGeometryType.FILL)?.serialize(t),[k.WGLGeometryType.LINE]:n.get(k.WGLGeometryType.LINE)?.serialize(t),[k.WGLGeometryType.TEXT]:n.get(k.WGLGeometryType.TEXT)?.serialize(t),[k.WGLGeometryType.LABEL]:n.get(k.WGLGeometryType.LABEL)?.serialize(t)};return{message:{tileKeyOrigin:d,tileKey:a,data:n,version:this._version},transferList:t}}featureStart(d,a){this._current.insertAfter=
d;this._current.sortKey=a}featureEnd(){}recordStart(d,a,n,t){this._current.writer=this._getVertexWriter(n);this._current.overlaps=0;this._current.indexStart=this._current.writer.indexCount;this._current.vertStart=this._current.writer.vertexCount;this._current.bufferingEnabled=t;this._current.id=d;this._current.materialKey=a;this._current.geometryType=n;this._current.isDotDensity=!1;this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(d){this._current.writer.vertexEnsureSize(d)}indexEnsureSize(d){this._current.writer.indexEnsureSize(d)}vertexBounds(d,
a,n,t){this._current.bufferingEnabled&&this._addOverlap(d,a,n,t)}vertexWrite(d){this._current.writer.writeVertex(d)}vertexWriteF32(d){this._current.writer.writeVertexF32(d)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(d){this._current.writer.writeIndex(d)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(d,a,n,t,v,y,h,A){this._current.writer=this._getVertexWriter(k.WGLGeometryType.LABEL);const E=
this._current.writer.metricWriter;E.push(m.getDisplayIdTexel(d));E.push(a);E.push(n);E.push(t);E.push(v);E.push(y);E.push(h);E.push(A);E.push(255);this._current.metricBoxLenPointer=E.push(0)}metricEnd(){const d=this._current.writer.metricWriter;0===d.getValue(this._current.metricBoxLenPointer)&&d.seek(d.length-10)}metricBoxWrite(d,a,n,t){const v=this._current.writer.metricWriter;v.incr(this._current.metricBoxLenPointer);v.push(0);v.push(0);v.push(d);v.push(a);v.push(n);v.push(t)}recordEnd(){var d=
this._current.vertStart,a=this._current.writer.vertexCount-d;if(!a)return!1;this.hasRecords=!0;var n=this._current.indexStart;this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,n,this._current.writer.indexCount-n,d,a,this._current.sortKey);if(!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===k.WGLGeometryType.LABEL)return!0;d=this._current.writer;for(a=0;8>a;a++){var t=1<<a;if(this._current.overlaps&
t){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});n=this._data.neighbors[a];var v=this._current.geometryType;if(!n.vertexData.has(v)){var y=f.getStrides(v,this._symbologyType).geometry;y=new e.VertexDataWriter(v,y,r.patchPixelBufferAllocSize);n.vertexData.set(v,y)}v=n.vertexData.get(this._current.geometryType);y=4096*-b(t);t=4096*-p(t);v?.copyLastFrom(d,y,t);n.displayIds.add(this._current.id)}}return!0}_addOverlap(d,a,n,t){this._current.overlaps|=255^((d<
0+n?148:d>=r.tileSize-n?41:189)|(a<0+t?224:a>=r.tileSize-t?7:231))}_getVertexWriter(d){if(!this._data.self.has(d)){const a=this._data.self,n=f.getStrides(d,this._symbologyType).geometry;a.set(d,new e.VertexDataWriter(d,n,this.hint.records))}return this._data.self.get(d)}}g.MeshData=c;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../support/QueueProcessor".split(" "),
function(g,q,x,w,C,r,m,k,f,e){function l(a,n){a.length=0;n.forEach(t=>a.push(t));return a}const b=new Set,p=[],c=new Map,d=[0,0];q=class extends q{constructor(a){super(a);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:a,process:n,strategy:t}=this;this._queue=new e.QueueProcessor({concurrency:a,process:(v,y)=>{v=this._keyToItem.get(v);return n(v,{signal:y})},peeker:"scale-first"===t?v=>this._peekByScaleFirst(v):v=>this._peekByCenterFirst(v)})}destroy(){this.clear();
this._queue=x.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(a){this._queue.abort("string"===typeof a?a:a.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(a){return"string"===typeof a?this._keyToItem.has(a):this._keyToItem.has(a.id)}isOngoing(a){a="string"===typeof a?a:a.id;return this.has(a)&&this._queue.isOngoing(a)}pause(){this._queue.pause()}push(a){const n=a.key.id;if(this._queue.has(n))return this._queue.get(n);
const t=this._queue.push(n),v=()=>{this._keyToItem.delete(n)};this._keyToItem.set(n,a);t.then(v,v);return t}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(a){if(!this.state)return a.values().next().value;const n=this.tileInfoView;let t=Number.NEGATIVE_INFINITY,v=Number.POSITIVE_INFINITY;a.forEach(z=>{z=this._keyToItem.get(z);const F=this.tileInfoView.getTileScale(z.key);c.has(F)||(c.set(F,[]),t=Math.max(F,t),v=Math.min(F,v));c.get(F).push(z.key);b.add(F)});let y=this.state.scale;
c.has(y)||(l(p,b),p.sort((z,F)=>z-F),y=p.reduce((z,F)=>Math.abs(F-y)<Math.abs(z-y)?F:z,p[0]));y=Math.min(y,t);y=Math.max(y,v);a=c.get(y);const h=n.getClosestInfoForScale(y),A=h.getColumnForX(this.state.center[0]),E=h.getRowForY(this.state.center[1]);a.sort((z,F)=>{const D=h.denormalizeCol(z.col,z.world),B=h.denormalizeCol(F.col,F.world);return Math.sqrt((A-D)*(A-D)+(E-z.row)*(E-z.row))-Math.sqrt((A-B)*(A-B)+(E-F.row)*(E-F.row))});b.clear();c.clear();return a[0].id}_peekByCenterFirst(a){if(!this.state)return a.values().next().value;
const n=this.tileInfoView,t=this.state.center;let v=Number.POSITIVE_INFINITY,y;a.forEach(h=>{h=this._keyToItem.get(h);n.getTileCoords(d,h.key);const A=f.distance(d,t);A<v&&(v=A,y=h.key)});return y.id}};g.__decorate([w.property({constructOnly:!0})],q.prototype,"concurrency",void 0);g.__decorate([w.property({constructOnly:!0})],q.prototype,"process",void 0);g.__decorate([w.property()],q.prototype,"state",void 0);g.__decorate([w.property({constructOnly:!0})],q.prototype,"strategy",void 0);g.__decorate([w.property({constructOnly:!0})],
q.prototype,"tileInfoView",void 0);return q=g.__decorate([k.subclass("esri.views.2d.tiling.TileQueue")],q)})},"esri/chunks/vec2":function(){define(["exports","./common"],function(g,q){function x(Q,Z){Q[0]=Z[0];Q[1]=Z[1];return Q}function w(Q,Z,ba){Q[0]=Z;Q[1]=ba;return Q}function C(Q,Z,ba){Q[0]=Z[0]+ba[0];Q[1]=Z[1]+ba[1];return Q}function r(Q,Z,ba){Q[0]=Z[0]-ba[0];Q[1]=Z[1]-ba[1];return Q}function m(Q,Z,ba){Q[0]=Z[0]*ba[0];Q[1]=Z[1]*ba[1];return Q}function k(Q,Z,ba){Q[0]=Z[0]/ba[0];Q[1]=Z[1]/ba[1];
return Q}function f(Q,Z){Q[0]=Math.ceil(Z[0]);Q[1]=Math.ceil(Z[1]);return Q}function e(Q,Z){Q[0]=Math.floor(Z[0]);Q[1]=Math.floor(Z[1]);return Q}function l(Q,Z,ba){Q[0]=Math.min(Z[0],ba[0]);Q[1]=Math.min(Z[1],ba[1]);return Q}function b(Q,Z,ba){Q[0]=Math.max(Z[0],ba[0]);Q[1]=Math.max(Z[1],ba[1]);return Q}function p(Q,Z){Q[0]=Math.round(Z[0]);Q[1]=Math.round(Z[1]);return Q}function c(Q,Z,ba){Q[0]=Z[0]*ba;Q[1]=Z[1]*ba;return Q}function d(Q,Z,ba,da){Q[0]=Z[0]+ba[0]*da;Q[1]=Z[1]+ba[1]*da;return Q}function a(Q,
Z){const ba=Z[0]-Q[0];Q=Z[1]-Q[1];return Math.sqrt(ba*ba+Q*Q)}function n(Q,Z){const ba=Z[0]-Q[0];Q=Z[1]-Q[1];return ba*ba+Q*Q}function t(Q){const Z=Q[0];Q=Q[1];return Math.sqrt(Z*Z+Q*Q)}function v(Q){const Z=Q[0];Q=Q[1];return Z*Z+Q*Q}function y(Q,Z){Q[0]=-Z[0];Q[1]=-Z[1];return Q}function h(Q,Z){Q[0]=1/Z[0];Q[1]=1/Z[1];return Q}function A(Q,Z){var ba=Z[0];const da=Z[1];ba=ba*ba+da*da;0<ba&&(ba=1/Math.sqrt(ba),Q[0]=Z[0]*ba,Q[1]=Z[1]*ba);return Q}function E(Q,Z){return Q[0]*Z[0]+Q[1]*Z[1]}function z(Q,
Z,ba){Z=Z[0]*ba[1]-Z[1]*ba[0];Q[0]=Q[1]=0;Q[2]=Z;return Q}function F(Q,Z,ba,da){const P=Z[0];Z=Z[1];Q[0]=P+da*(ba[0]-P);Q[1]=Z+da*(ba[1]-Z);return Q}function D(Q,Z){Z=Z||1;const ba=2*q.RANDOM()*Math.PI;Q[0]=Math.cos(ba)*Z;Q[1]=Math.sin(ba)*Z;return Q}function B(Q,Z,ba){const da=Z[0];Z=Z[1];Q[0]=ba[0]*da+ba[2]*Z;Q[1]=ba[1]*da+ba[3]*Z;return Q}function u(Q,Z,ba){const da=Z[0];Z=Z[1];Q[0]=ba[0]*da+ba[2]*Z+ba[4];Q[1]=ba[1]*da+ba[3]*Z+ba[5];return Q}function H(Q,Z,ba){const da=Z[0];Z=Z[1];Q[0]=ba[0]*da+
ba[3]*Z+ba[6];Q[1]=ba[1]*da+ba[4]*Z+ba[7];return Q}function G(Q,Z,ba){const da=Z[0];Z=Z[1];Q[0]=ba[0]*da+ba[4]*Z+ba[12];Q[1]=ba[1]*da+ba[5]*Z+ba[13];return Q}function I(Q,Z,ba,da){const P=Z[0]-ba[0];Z=Z[1]-ba[1];const U=Math.sin(da);da=Math.cos(da);Q[0]=P*da-Z*U+ba[0];Q[1]=P*U+Z*da+ba[1];return Q}function J(Q,Z){var ba=Q[0];Q=Q[1];const da=Z[0];Z=Z[1];let P=ba*ba+Q*Q;0<P&&(P=1/Math.sqrt(P));let U=da*da+Z*Z;0<U&&(U=1/Math.sqrt(U));ba=(ba*da+Q*Z)*P*U;return 1<ba?0:-1>ba?Math.PI:Math.acos(ba)}function M(Q){return"vec2("+
Q[0]+", "+Q[1]+")"}function R(Q,Z){return Q[0]===Z[0]&&Q[1]===Z[1]}function Y(Q,Z){const ba=Q[0];Q=Q[1];const da=Z[0];Z=Z[1];const P=q.getEpsilon();return Math.abs(ba-da)<=P*Math.max(1,Math.abs(ba),Math.abs(da))&&Math.abs(Q-Z)<=P*Math.max(1,Math.abs(Q),Math.abs(Z))}function fa(Q,Z,ba,da,P){let U=Z[0]-ba[0];ba=Z[1]-ba[1];P=(da[0]*U+da[1]*ba)*(P-1);U=da[0]*P;ba=da[1]*P;Q[0]=Z[0]+U;Q[1]=Z[1]+ba;return Q}const O=Object.freeze(Object.defineProperty({__proto__:null,add:C,angle:J,ceil:f,copy:x,cross:z,dist:a,
distance:a,div:k,divide:k,dot:E,equals:Y,exactEquals:R,floor:e,inverse:h,len:t,length:t,lerp:F,max:b,min:l,mul:m,multiply:m,negate:y,normalize:A,projectAndScale:fa,random:D,rotate:I,round:p,scale:c,scaleAndAdd:d,set:w,sqrDist:n,sqrLen:v,squaredDistance:n,squaredLength:v,str:M,sub:r,subtract:r,transformMat2:B,transformMat2d:u,transformMat3:H,transformMat4:G},Symbol.toStringTag,{value:"Module"}));g.add=C;g.angle=J;g.ceil=f;g.copy=x;g.cross=z;g.dist=a;g.distance=a;g.div=k;g.divide=k;g.dot=E;g.equals=
Y;g.exactEquals=R;g.floor=e;g.inverse=h;g.len=t;g.length=t;g.lerp=F;g.max=b;g.min=l;g.mul=m;g.multiply=m;g.negate=y;g.normalize=A;g.projectAndScale=fa;g.random=D;g.rotate=I;g.round=p;g.scale=c;g.scaleAndAdd=d;g.set=w;g.sqrDist=n;g.sqrLen=v;g.squaredDistance=n;g.squaredLength=v;g.str=M;g.sub=r;g.subtract=r;g.transformMat2=B;g.transformMat2d=u;g.transformMat3=H;g.transformMat4=G;g.vec2=O})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache",
"./TileCoverage","./TileKey"],function(g,q,x,w){const C=new w(0,0,0,0),r=new Map,m=[],k=[];class f{constructor(e){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=e.acquireTile;this.releaseTile=e.releaseTile;this.tileInfoView=e.tileInfoView;null!=e.resampling&&(this.resampling=e.resampling);e.cachePolicy&&(this.cachePolicy=e.cachePolicy);e.coveragePolicy&&(this.coveragePolicy=
e.coveragePolicy);null!=e.buffer&&(this.buffer=e.buffer);e.cacheSize&&(this._tileCache=new q(e.cacheSize,this.tileInfoView,l=>{this.releaseTile(l)}))}destroy(){this.tileIndex.clear()}update(e){const {resampling:l,tileIndex:b}=this,{scale:p,center:c,resolution:d}=e.state,{minScale:a,maxScale:n}=this.tileInfoView,t=!e.stationary&&p>this._previousScale;this._previousScale=p;if(!l&&(p>a||p<n))this.tiles.length=0,this.clear();else if(e=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,
this.coveragePolicy)){var {spans:v,lodInfo:y}=e,{level:h}=y;this.tiles.length=0;b.forEach(F=>F.visible=!0);var A=0,E=0;if(0<v.length)for(const {row:F,colFrom:D,colTo:B}of v)for(var z=D;z<=B;z++){A++;const u=C.set(h,F,y.normalizeCol(z),y.getWorldForColumn(z)).id;let H=b.get(u);if(H)H.isReady?(r.set(u,H),E++):t||this._addParentTile(u,r);else{if(this._tileCache?.has(u)){if(H=this._tileCache.pop(u),this.tileIndex.set(u,H),H.isReady){r.set(u,H);E++;continue}}else H=this.acquireTile(C),this.tileIndex.set(u,
H);t||this._addParentTile(u,r)}}A=E===A;for(const [F,D]of b)r.has(F)||(C.set(F),E=this.tileInfoView.intersects(e,C),z="purge"===this.cachePolicy?C.level!==h:C.level>h,!E||!t&&A?!z&&E||m.push(D):D.isReady?z&&"purge"===this.cachePolicy&&this._hasReadyAncestor(C,h)?m.push(D):k.push(D):z&&m.push(D));for(const F of k)F.isReady&&r.set(F.key.id,F);for(const F of m)this._tileCache?this._tileCache.add(F):this.releaseTile(F),b.delete(F.key.id);for(const F of r.values())this.tiles.push(F);for(const F of b.values())r.has(F.key.id)||
(F.visible=!1);this._tileCache?.prune(h,c,d);x.pool.release(e);k.length=0;m.length=0;r.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:e}=this;for(const l of e.values())this.releaseTile(l);e.clear()}refresh(e){for(const l of this.tileIndex.values())this.tiles.includes(l)?e(l):m.push(l);for(const l of m)this.releaseTile(l),this.tileIndex.delete(l.key.id);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,l){let b=null;for(;;){e=
this.tileInfoView.getTileParentId(e);if(!e)break;if(this.tileIndex.has(e)){if(b=this.tileIndex.get(e),b?.isReady){l.has(b.key.id)||l.set(b.key.id,b);break}}else if(this._tileCache?.has(e)&&(b=this._tileCache.pop(e),this.tileIndex.set(e,b),b?.isReady)){l.has(b.key.id)||l.set(b.key.id,b);break}}}_hasReadyAncestor(e,l){const b=g.create();this.tileInfoView.getTileBounds(b,e,!0);for(const p of this.tileIndex.values())if(p.isReady&&p.key.level>=l&&p.key.level<e.level){const c=g.create();this.tileInfoView.getTileBounds(c,
p.key,!0);if(g.contains(c,b))return!0}return!1}}return f})},"esri/views/2d/tiling/TileCache":function(){define(["../../../chunks/vec2"],function(g){class q{constructor(x,w,C){this.maxSize=x;this._tileInfoView=w;this._removedFunc=C;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(x){return this._tilePerId.has(x)}get(x){return this._tilePerId.get(x)}pop(x){const w=this._tilePerId.get(x);if(w){var C=this._tileKeysPerLevel[w.key.level];this._tilePerId["delete"](x);
for(let r=0;r<C.length;r++)if(C[r].id===x){C.splice(r,1);break}w.visible=!0;return w}}add(x){x.visible=!1;const w=x.key,C=w.id;this._tilePerId.has(C)||(this._tilePerId.set(C,x),x=w.level,this._tileKeysPerLevel[x]||(this._tileKeysPerLevel[x]=[]),this._tileKeysPerLevel[x].push(w))}prune(x,w,C){let r=this._tilePerId.size;if(!(r<=this.maxSize)){for(var m=this._tileKeysPerLevel.length-1;r>this.maxSize&&0<=m;)m!==x&&(r=this._pruneAroundCenterTile(r,w,C,m)),m--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,
w,C,x))}}_pruneAroundCenterTile(x,w,C,r){r=this._tileKeysPerLevel[r];if(!r||0===r.length)return x;const {size:m,origin:k}=this._tileInfoView.tileInfo,f=C*m[0],e=C*m[1],l=[0,0],b=[0,0];for(r.sort((p,c)=>{l[0]=k.x+f*(p.col+.5);l[1]=k.y-e*(p.row+.5);b[0]=k.x+f*(c.col+.5);b[1]=k.y-e*(c.row+.5);return g.squaredDistance(l,w)-g.squaredDistance(b,w)});0<r.length&&(C=r.pop(),this._removeTile(C.id),x--,x!==this.maxSize););return x}_removeTile(x){const w=this._tilePerId.get(x);this._removedFunc&&w&&this._removedFunc(w);
this._tilePerId["delete"](x)}}return q})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../definitions","./heuristics","../util/Writer"],function(g,q,x,w){class C{constructor(r,m,k){this._start={index:0,vertex:0};k=x.getMeshSizeHint(r,m,k);m/=4;this.geometryType=r;this._records=new w(Int32Array,k.recordBytes);this._indices=new w(Uint32Array,k.indexBytes);this._vertices=new w(Uint32Array,k.vertexBytes);this._metrics=new w(Float32Array,0);this._strideInt=m}serialize(r){const m=
this._records.buffer(),k=this._indices.buffer(),f=this._vertices.buffer(),e=this._metrics.length?this._metrics.buffer():null,l=4*this._strideInt;r.push(m,k,f);return{stride:l,records:m,indices:k,vertices:f,metrics:e}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/q.displayRecordIntPerElement}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(r){this._vertices.ensureSize(r)}indexEnsureSize(r){this._indices.ensureSize(r)}recordStart(){this._start.index=
this._indices.length;this._start.vertex=this._vertices.length}recordEnd(r,m,k,f,e,l,b,p){this._records.push(r);this._records.push(m??0);this._records.push(k);this._records.push(f);this._records.push(e);this._records.push(l);this._records.push(b);this._records.writeF32(p)}writeIndex(r){this._indices.push(r)}writeVertex(r){this._vertices.push(r)}writeVertexF32(r){this._vertices.writeF32(r)}copyLastFrom(r,m,k){var f=r._records.length-q.displayRecordIntPerElement;const e=r._records.getValue(f),l=r._records.getValue(f+
1),b=r._records.getValue(f+2),p=r._records.getValue(f+4),c=r._records.getValue(f+6);f=r._records.getValue(f+7);const d=this._vertices.length;var a=(r._start.vertex-this._vertices.length)/this._strideInt;const n=this._indices.length,t=this.vertexCount;for(var v=r._start.index;v!==r._indices.length;v++){const y=r._indices.getValue(v);this._indices.push(y-a)}for(a=r._start.vertex;a!==r._vertices.length;a++)v=r._vertices.getValue(a),this._vertices.push(v);for(r=d;r<=this._vertices.length;r+=this._strideInt)this._vertices.i1616Add(r,
m,k);this._records.push(e);this._records.push(l);this._records.push(b);this._records.push(n);this._records.push(p);this._records.push(t);this._records.push(c);this._records.push(f)}}g.VertexDataWriter=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/heuristics":function(){define(["exports","../definitions","../enums"],function(g,q,x){const w=new Map;w.set(x.WGLGeometryType.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4});w.set(x.WGLGeometryType.LINE,
{multiplier:1,indicesPerRecord:24,verticesPerRecord:8});w.set(x.WGLGeometryType.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10});w.set(x.WGLGeometryType.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});w.set(x.WGLGeometryType.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});g.getMeshSizeHint=function(C,r,m){const {indicesPerRecord:k,multiplier:f,verticesPerRecord:e}=w.get(C);return{recordBytes:m*q.displayRecordIntPerElement*Uint32Array.BYTES_PER_ELEMENT,indexBytes:f*
k*m*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:f*e*m*r}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class g{get length(){return this._pos}constructor(q,x){this._pos=0;x=x?this._roundToNearest(x,q.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(x);this._buffer=new q(this._array);this._ctor=q;this._i16View=new Int16Array(this._array)}_roundToNearest(q,x){q=Math.round(q);return 1===x?q:q+(x-q%x)}_ensureSize(q){if(this._pos+
q>=this._buffer.length){q=this._roundToNearest(1.25*(this._array.byteLength+q*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);q=new ArrayBuffer(q);const x=new this._ctor(q);x.set(this._buffer,0);this._array=q;this._buffer=x;this._i16View=new Int16Array(this._array)}}ensureSize(q){this._ensureSize(q)}writeF32(q){this._ensureSize(1);const x=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=q;this._pos++;return x}push(q){this._ensureSize(1);const x=this._pos;this._buffer[this._pos++]=
q;return x}writeFixed(q){this._buffer[this._pos++]=q}setValue(q,x){this._buffer[q]=x}i1616Add(q,x,w){this._i16View[2*q]+=x;this._i16View[2*q+1]+=w}getValue(q){return this._buffer[q]}incr(q){if(this._buffer.length<q)throw Error("Increment index overflows the target buffer");this._buffer[q]++}decr(q){this._buffer[q]--}writeRegion(q){this._ensureSize(q.length);const x=this._pos;this._buffer.set(q,this._pos);this._pos+=q.length;return x}writeManyFrom(q,x,w){for(this._ensureSize(w-x);x!==w;x++)this.writeFixed(q._buffer[x])}buffer(){const q=
this._array.slice(0,4*this._pos);this.destroy();return q}toArray(){return[...this._buffer]}seek(q){this._pos=q}destroy(){this._buffer=this._array=null}}return g})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(g){g.getPow2NeighborKey=function(q,x,w,C){q=q.clone();const r=1<<q.level;x=q.col+x;w=q.row+w;C&&0>x?(q.col=x+r,--q.world):x>=r?(q.col=x-r,q.world+=1):q.col=x;q.row=w;return q};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("exports ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../../../geometry/libtess ../../DisplayId ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(g,q,x,w,C,r,m,k){class f{constructor(e,l,b){this._geometryType=e;this._idField=l;this._templateStore=b}update(e,l){null!=e.mesh.labels&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,l));this._schema=e}_createLabelTemplates(e,l){const b=new Map;if("simple"===e.type){for(var p of e.classes)e=r.fromLabelClass(p,l),b.set(p.index,e);return b}for(const c in e.classes){p=e.classes[c];for(const d of p)p=r.fromLabelClass(d,l),b.set(d.index,p)}return b}get templates(){return this._templateStore}async analyze(e,
l,b,p,c,d,a){if(!x.isAborted(a)){var n;"dictionary"===b?.type&&(n=await b.analyze(this._idField,e.copy(),l,c,d,a));for(l=0;e.next();){var t=null;t=n?n[l++]:null!=p&&C.isAggregateId(e.getDisplayId())&&1!==e.readAttribute("cluster_count")?p.match(this._idField,e,this._geometryType,c,d):b.match(this._idField,e,this._geometryType,c,d);e.setGroupId(t);if(k.isDynamicId(t)){t=this._templateStore.getDynamicTemplateGroup(t).templates;for(const v of t)v&&v.analyze&&v.analyze(this._templateStore,e,c,d)}}await w.loadLibtess();
return this._templateStore.finalize(a)}}async analyzeGraphics(e,l,b,p,c,d){if(!x.isAborted(d)){e=e.getCursor();for(b&&await b.analyze(this._idField,e.copy(),l,p,c,d);e.next();){l=e.getGroupId();if(null==l||-1===l)l=b?.match(this._idField,e,e.geometryType,p,c),e.setGroupId(l);if(k.isDynamicId(l)){const a=this._templateStore.getDynamicTemplateGroup(l).templates;for(const n of a)n&&n.analyze&&n.analyze(this._templateStore,e,p,c)}e.setGroupId(l)}await w.loadLibtess();return this._templateStore.finalize(d)}}writeGraphic(e,
l,b,p){const c=l.getGroupId(),d=l.getDisplayId(),a=this._templateStore.getTemplateGroup(c);e.featureStart(l.insertAfter,0);if(null!=d){if(k.isDynamicId(c))for(const n of a.templates)n&&n.bindFeature(l,null,null);if(a){for(const n of a.templates)n&&n.write(e,l,b,p);e.featureEnd()}}}writeCursor(e,l,b,p,c,d,a){const n=l.getGroupId(),t=l.getDisplayId();var v=this._templateStore.getTemplateGroup(n);const y=v.templates;v=this._getSortKeyValue(l,v);e.featureStart(0,v);if(null!=t&&y){if(k.isDynamicId(n))for(const h of y)h.bindFeature(l,
b,p);for(const h of y)h.write(e,l,c,a);y.length&&null!=d&&(b=d&&this._findLabelRef(y),this._writeLabels(e,l,d,b,c,a));e.featureEnd()}}_getSortKeyValue(e,l){const b=this._schema.mesh.sortKey;if(null==b)return 0;let p=0;p=!0===b.byRenderer&&null!=l.sortKey?l.sortKey:null!=b.fieldIndex?e.getComputedNumericAtIndex(b.fieldIndex):null!=b.field?e.readAttribute(b.field):e.readAttribute(this._idField);p*="asc"===b.order?1:-1;return null==p||isNaN(p)?0:p}_findLabelRef(e){for(const l of e)if(l instanceof m)return l;
return null}_writeLabels(e,l,b,p,c,d){for(const a of b)if(null!=a&&a){const {glyphs:n,rtl:t,index:v}=a;if(b=this._labelTemplates.get(v))b.setZoomLevel(c),b.bindReferenceTemplate(p),b.bindTextInfo(n,t),b.write(e,l,null,d)}}}g.WGLMeshFactory=f;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./segmentUtils ./WGLTextTemplate".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d){const a=q.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),n=(y,h="mapview-labeling")=>a.error(new g(h,y)),t=function(y){const h=new Map;return A=>{h.has(A)||h.set(A,y(A));return h.get(A)}}(y=>{let h=0;if(0===y)return Infinity;for(;!(y%2);)h++,y/=2;return h});class v extends d{constructor(y,h,A,E){super(y,A.font?.size,A.haloSize||0,A.font?.size,A.color&&f.premultiplyAlphaRGBAArray(A.color)||0,A.haloColor&&f.premultiplyAlphaRGBAArray(A.haloColor)||0,
A.horizontalAlignment,A.verticalAlignment,k.isMapAligned(h.labelPlacement)?m.Alignment.MAP:m.Alignment.SCREEN,A.font?.decoration,!1,A.angle||0,A.xoffset,A.yoffset,A.lineWidth,A.lineHeight,null,null,!1,null,null,A.backgroundColor&&f.premultiplyAlphaRGBAArray(A.backgroundColor),A.borderLineColor&&f.premultiplyAlphaRGBAArray(A.borderLineColor),A.borderLineSize);this._zoomLevel=this._refOffsetY=this._refOffsetX=this._refPlacementDirY=this._refPlacementDirX=this._refPlacementPadding=this._outLineLabelAngle=
0;this.geometryType=l.WGLGeometryType.LABEL;this._allowOverrun=h.allowOverrun??!1;this._repeatLabel=h.repeatLabel??!0;this._labelPosition=h.labelPosition??"curved";var z=!!h.minScale&&E.scaleToZoom(h.minScale)||0;z=x.clamp(z,0,25.5);E=!!h.maxScale&&E.scaleToZoom(h.maxScale)||255;E=x.clamp(E,0,25.5);const [F,D]=k.getAlignmentFromPlacement(h.labelPlacement);this._xAlignD=F;this._yAlignD=D;this._minZoom=z;this._maxZoom=E;this._minBackgroundZoom=z;this._maxBackgroundZoom=E;this._refPlacementPadding=w.pt2px(A.haloSize)+
e.textPlacementPadding;this._repeatLabelDistance=h.repeatLabelDistance?w.pt2px(h.repeatLabelDistance):128;y=p.LabelMaterialKey.load(y);y.sdf=!0;this._materialKey=y.data}static fromLabelClass(y,h){if("esriServerLinePlacementCenterAlong"===y.labelPlacement){const A=y.symbol;A.xoffset=0;A.yoffset=0;A.angle=0;A.font.decoration="none"}return new v(y.materialKey,y,y.symbol,h)}get _shapedBox(){return this._shapingInfo.bounds}setZoomLevel(y){this._zoomLevel=y}bindReferenceTemplate(y){let h=k.getXDirection(this._xAlignD),
A=k.getYDirection(this._yAlignD);this._refOffsetY=this._refOffsetX=0;if(null==y)this._refSymbolAndPlacementOffset=b.i8888to32(0,0,Math.floor(127*h+127),Math.floor(127*A+127));else{if("circle"===y.boundsType&&(h||A)){var E=Math.sqrt(h*h+A*A);h/=E;A/=E}E=Math.max(y.height,y.width);this._refSymbolAndPlacementOffset=b.i8888to32(4*this._refPlacementPadding,E,Math.floor(127*h+127),Math.floor(127*A+127));this._referenceSize=E;this._refPlacementDirX=h;this._refPlacementDirY=A;this._refOffsetX=y.xOffset;this._refOffsetY=
y.yOffset}}_write(y,h){if(null!=this._shapingInfo){var A=this._shapingInfo,E=h.getDisplayId(),z="esriGeometryPolygon"===h.geometryType?h.readLegacyCentroid():h.readLegacyGeometry();if(z)switch(this._current={out:y,inId:E,inShaping:A,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===h.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&a.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),
h.geometryType){case "esriGeometryPolyline":this._placeLineLabels(z);break;case "esriGeometryPoint":case "esriGeometryPolygon":this._placePointLabels(z);break;default:n(`Geometry of type ${h.geometryType} is not supported`)}}}_isVisible(y,h){const A=Math.floor(this._current.zoomLevel*e.minMaxZoomPrecisionFactor);return Math.floor(y*e.minMaxZoomPrecisionFactor)<=A&&A<=Math.floor(h*e.minMaxZoomPrecisionFactor)}_placePointLabels(y){const {out:h,inId:A,inShaping:E}=this._current;this._writeGlyphs(h,A,
y,E)}_placeLineLabels(y){y=c.smoothPaths(y.paths,this._current.inShaping.bounds.width);const h=this._placeSubdivGlyphs.bind(this),A=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const E of y)c.pathDivide(E,A,h,this._repeatLabel)}_placeSubdivGlyphs(y,h,A,E){var z=t(h),F=this._shapedBox.width/2,D=Math.sqrt(this._repeatLabelDistance)/2;A=Math.min(A,E-A);F=this._current.inShaping.isMultiline?25:Math.log2(A/(D+F/2));z=Math.max(this._minZoom,this._current.zoomLevel+1-(0===h?F:Math.min(z,F)));
F=this._current.zoomLevel-z;D=this._shapedBox.width/2*2**F;this._current.inShaping.isMultiline?0===h&&this._placeStraight(y,z):this._allowOverrun&&0>F?this._placeStraightAlong(y,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(y,z):"curved"===this._labelPosition&&this._placeCurved(y,z,D)}_placeStraight(y,h){const {out:A,inId:E,inShaping:z}=this._current,F=Math.ceil((180/Math.PI*y.angle+180)%360);this._outLineLabelAngle=Math.round(254/360*Math.ceil(180/Math.PI*y.angle%360));
this._writeGlyphs(A,E,y,z,h);this._outLineLabelAngle=Math.round(254/360*F);this._writeGlyphs(A,E,y,z,h)}_placeCurved(y,h,A){const {out:E,inId:z}=this._current;E.metricStart(z,h,y.x,y.y,0,0,0,0);const F=y.clone(),D=(180/Math.PI*y.angle+180)%360;this._outLineLabelAngle=Math.round(180/Math.PI*y.angle%360*(254/360));this._placeFirst(F,h,1);this._placeBack(y,F,h,A,1);this._placeForward(y,F,h,A,1);this._outLineLabelAngle=Math.round(254/360*D);this._placeFirst(F,h,0);this._placeBack(y,F,h,A,0);this._placeForward(y,
F,h,A,0);E.metricEnd()}_placeStraightAlong(y,h){const {out:A,inId:E,inShaping:z}=this._current;A.metricStart(E,h,y.x,y.y,0,0,0,0);const F=y.clone(),D=180/Math.PI*y.angle%360,B=(180/Math.PI*y.angle+180)%360;var u=0<z.glyphs.length&&(this._borderLineColor||this._backgroundColor);this._maxBackgroundZoom=25;this._minBackgroundZoom=Math.max(h,0);if(u){u=p.LabelMaterialKey.load(this._materialKey);u.textureBinding=z.glyphs[0].textureBinding;const H=C.fromRotation(r.create(),-y.angle),[G,I]=z.shapeBackground(H);
this._outLineLabelAngle=Math.round(254/360*D);A.recordStart(E,u.data,this.geometryType,!0);this._writeBackgroundGeometry(A,E,y,G,I);A.recordEnd();this._outLineLabelAngle=Math.round(254/360*B);A.recordStart(E,u.data,this.geometryType,!0);this._writeBackgroundGeometry(A,E,y,G,I);A.recordEnd()}this._outLineLabelAngle=Math.round(254/360*D);this._placeFirst(F,h,1,!0);this._outLineLabelAngle=Math.round(254/360*B);this._placeFirst(F,h,0,!0);A.metricEnd()}_placeBack(y,h,A,E,z){const F=y.clone();for(y=y.backwardLength+
0;F.prev()&&!(y>=E);)this._placeOnSegment(F,h,y,A,-1,z),y+=F.length+0}_placeForward(y,h,A,E,z){const F=y.clone();for(y=y.remainingLength+0;F.next()&&!(y>=E);)this._placeOnSegment(F,h,y,A,1,z),y+=F.length+0}_placeFirst(y,h,A,E=!1){const z=this._current.inShaping;var F=z.glyphs;const D=this._current.zoomLevel,{out:B,inId:u}=this._current;for(const H of F)F=H.x>z.bounds.x?A:1-A,F=Math.max(0,D+Math.log2(Math.abs(H.x+H.width/2-z.bounds.x)/(F*y.remainingLength+(1-F)*y.backwardLength))),F=Math.max(h,E?0:
F),H.maxZoom=25,H.angle=y.angle+(1-A)*Math.PI,H.minZoom=F,this._writeGlyph(B,u,y.x,y.y,H),A&&this._isVisible(H.minZoom,H.maxZoom)&&(F=H.bounds,B.metricBoxWrite(F.center[0],F.center[1],F.width,F.height))}_placeOnSegment(y,h,A,E,z,F){var D=this._current.inShaping.glyphs;const {out:B,inId:u}=this._current,H=this._current.inShaping,G=this._current.zoomLevel;var I=y.x+y.dx/y.length*-z*A,J=y.y+y.dy/y.length*-z*A;for(const R of D)if((D=R.x>H.bounds.x?F:1-F)&&1===z||!D&&-1===z){var M=Math.abs(R.x+R.width/
2-H.bounds.x);D=Math.max(0,G+Math.log2(M/A)-.1);M=Math.max(E,G+Math.log2(M/(A+y.length+0)));0!==D&&(R.angle=y.angle+(1-F)*Math.PI,R.minZoom=M,R.maxZoom=D,this._writeGlyph(B,u,I,J,R),F&&this._isVisible(R.minZoom,R.maxZoom)&&(D=R.bounds,B.metricBoxWrite(D.center[0]+(y.x-h.x),D.center[1]+(y.y-h.y),D.width,D.height)))}}_writeGlyphs(y,h,A,E,z=this._minZoom){if(!(0>A.x||512<=A.x||0>A.y||512<=A.y)){if(0<E.glyphs.length&&(this._borderLineColor||this._backgroundColor)){var F=p.LabelMaterialKey.load(this._materialKey);
F.textureBinding=E.glyphs[0].textureBinding;y.recordStart(h,F.data,this.geometryType,!0);this._writeBackgroundGeometry(y,h,A,E.bounds,E.background);y.recordEnd()}F=A.x+this._refOffsetX;A=A.y-this._refOffsetY;for(const D of E.glyphs)D.minZoom=z,D.maxZoom=this._maxZoom,this._writeGlyph(y,h,F,A,D);E=E.boundsT;y.metricStart(h,z,F,A,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey);y.metricBoxWrite(E.center[0],E.center[1],E.width,E.height);y.metricEnd()}}_writeVertexCommon(y,
h,A,E){const z=this._color,F=this._haloColor,D=b.i8888to32(0,0,this._size,this._haloSize);E=b.i8888to32(Math.floor(Math.max(E.minZoom,this._minZoom)*e.minMaxZoomPrecisionFactor),Math.floor(Math.min(E.maxZoom,this._maxZoom)*e.minMaxZoomPrecisionFactor),this._outLineLabelAngle,0);y.vertexWrite(A);y.vertexWrite(h);y.vertexWrite(z);y.vertexWrite(F);y.vertexWrite(D);y.vertexWrite(this._refSymbolAndPlacementOffset);y.vertexWrite(E)}_writeBackgroundVertex(y,h,A,E,z,F){const D=b.i8888to32(0,0,this._size,
this._haloSize),B=b.i8888to32(0,0,0,0),u=b.i8888to32(Math.floor(this._minBackgroundZoom*e.minMaxZoomPrecisionFactor),Math.floor(this._maxBackgroundZoom*e.minMaxZoomPrecisionFactor),this._outLineLabelAngle,1);y.vertexWrite(A);y.vertexWrite(h);y.vertexWrite(E);y.vertexWrite(B);y.vertexWrite(D);y.vertexWrite(this._refSymbolAndPlacementOffset);y.vertexWrite(u);y.vertexWrite(z);y.vertexWrite(F);y.vertexEnd()}}return v})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(g,q){function x(z,
F){z[0]=F[0];z[1]=F[1];z[2]=F[2];z[3]=F[3];z[4]=F[4];z[5]=F[5];return z}function w(z){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=0;z[5]=0;return z}function C(z,F,D,B,u,H,G){z[0]=F;z[1]=D;z[2]=B;z[3]=u;z[4]=H;z[5]=G;return z}function r(z,F){const D=F[0],B=F[1],u=F[2],H=F[3],G=F[4];F=F[5];let I=D*H-B*u;if(!I)return null;I=1/I;z[0]=H*I;z[1]=-B*I;z[2]=-u*I;z[3]=D*I;z[4]=(u*F-H*G)*I;z[5]=(B*G-D*F)*I;return z}function m(z){return z[0]*z[3]-z[1]*z[2]}function k(z,F,D){const B=F[0],u=F[1],H=F[2],G=F[3],I=F[4];F=F[5];
const J=D[0],M=D[1],R=D[2],Y=D[3],fa=D[4];D=D[5];z[0]=B*J+H*M;z[1]=u*J+G*M;z[2]=B*R+H*Y;z[3]=u*R+G*Y;z[4]=B*fa+H*D+I;z[5]=u*fa+G*D+F;return z}function f(z,F,D){const B=F[0],u=F[1],H=F[2],G=F[3],I=F[4];F=F[5];const J=Math.sin(D);D=Math.cos(D);z[0]=B*D+H*J;z[1]=u*D+G*J;z[2]=B*-J+H*D;z[3]=u*-J+G*D;z[4]=I;z[5]=F;return z}function e(z,F,D){const B=F[1],u=F[2],H=F[3],G=F[4],I=F[5],J=D[0];D=D[1];z[0]=F[0]*J;z[1]=B*J;z[2]=u*D;z[3]=H*D;z[4]=G;z[5]=I;return z}function l(z,F,D){const B=F[0],u=F[1],H=F[2],G=
F[3],I=F[4];F=F[5];const J=D[0];D=D[1];z[0]=B;z[1]=u;z[2]=H;z[3]=G;z[4]=B*J+H*D+I;z[5]=u*J+G*D+F;return z}function b(z,F){const D=Math.sin(F);F=Math.cos(F);z[0]=F;z[1]=D;z[2]=-D;z[3]=F;z[4]=0;z[5]=0;return z}function p(z,F){z[0]=F[0];z[1]=0;z[2]=0;z[3]=F[1];z[4]=0;z[5]=0;return z}function c(z,F){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=F[0];z[5]=F[1];return z}function d(z){return"mat2d("+z[0]+", "+z[1]+", "+z[2]+", "+z[3]+", "+z[4]+", "+z[5]+")"}function a(z){return Math.sqrt(z[0]**2+z[1]**2+z[2]**2+z[3]**
2+z[4]**2+z[5]**2+1)}function n(z,F,D){z[0]=F[0]+D[0];z[1]=F[1]+D[1];z[2]=F[2]+D[2];z[3]=F[3]+D[3];z[4]=F[4]+D[4];z[5]=F[5]+D[5];return z}function t(z,F,D){z[0]=F[0]-D[0];z[1]=F[1]-D[1];z[2]=F[2]-D[2];z[3]=F[3]-D[3];z[4]=F[4]-D[4];z[5]=F[5]-D[5];return z}function v(z,F,D){z[0]=F[0]*D;z[1]=F[1]*D;z[2]=F[2]*D;z[3]=F[3]*D;z[4]=F[4]*D;z[5]=F[5]*D;return z}function y(z,F,D,B){z[0]=F[0]+D[0]*B;z[1]=F[1]+D[1]*B;z[2]=F[2]+D[2]*B;z[3]=F[3]+D[3]*B;z[4]=F[4]+D[4]*B;z[5]=F[5]+D[5]*B;return z}function h(z,F){return z[0]===
F[0]&&z[1]===F[1]&&z[2]===F[2]&&z[3]===F[3]&&z[4]===F[4]&&z[5]===F[5]}function A(z,F){const D=z[0],B=z[1],u=z[2],H=z[3],G=z[4];z=z[5];const I=F[0],J=F[1],M=F[2],R=F[3],Y=F[4];F=F[5];const fa=q.getEpsilon();return Math.abs(D-I)<=fa*Math.max(1,Math.abs(D),Math.abs(I))&&Math.abs(B-J)<=fa*Math.max(1,Math.abs(B),Math.abs(J))&&Math.abs(u-M)<=fa*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(H-R)<=fa*Math.max(1,Math.abs(H),Math.abs(R))&&Math.abs(G-Y)<=fa*Math.max(1,Math.abs(G),Math.abs(Y))&&Math.abs(z-F)<=
fa*Math.max(1,Math.abs(z),Math.abs(F))}const E=Object.freeze(Object.defineProperty({__proto__:null,add:n,copy:x,determinant:m,equals:A,exactEquals:h,frob:a,fromRotation:b,fromScaling:p,fromTranslation:c,identity:w,invert:r,mul:k,multiply:k,multiplyScalar:v,multiplyScalarAndAdd:y,rotate:f,scale:e,set:C,str:d,sub:t,subtract:t,translate:l},Symbol.toStringTag,{value:"Module"}));g.add=n;g.copy=x;g.determinant=m;g.equals=A;g.exactEquals=h;g.frob=a;g.fromRotation=b;g.fromScaling=p;g.fromTranslation=c;g.identity=
w;g.invert=r;g.mat2d=E;g.mul=k;g.multiply=k;g.multiplyScalar=v;g.multiplyScalarAndAdd=y;g.rotate=f;g.scale=e;g.set=C;g.str=d;g.sub=t;g.subtract=t;g.translate=l})},"esri/chunks/mat2df32":function(){define(["exports"],function(g){function q(){const f=new Float32Array(6);f[0]=1;f[3]=1;return f}function x(f){const e=new Float32Array(6);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];return e}function w(f,e,l,b,p,c){const d=new Float32Array(6);d[0]=f;d[1]=e;d[2]=l;d[3]=b;d[4]=p;d[5]=c;return d}
function C(f,e){return new Float32Array(f,e,6)}function r(f,e,l,b){const p=e[b];e=e[b+1];f[b]=l[0]*p+l[2]*e+l[4];f[b+1]=l[1]*p+l[3]*e+l[5]}function m(f,e,l,b=0,p=0,c=2){for(p=p||e.length/c;b<p;b++)r(f,e,l,b*c)}const k=Object.freeze(Object.defineProperty({__proto__:null,clone:x,create:q,createView:C,fromValues:w,transform:r,transformMany:m},Symbol.toStringTag,{value:"Module"}));g.clone=x;g.create=q;g.createView=C;g.fromValues=w;g.mat2df32=k;g.transform=r;g.transformMany=m})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports"],
function(g){g.HAlign=void 0;(function(q){q[q.Left=-1]="Left";q[q.Center=0]="Center";q[q.Right=1]="Right"})(g.HAlign||(g.HAlign={}));g.VAlign=void 0;(function(q){q[q.Top=1]="Top";q[q.Center=0]="Center";q[q.Bottom=-1]="Bottom";q[q.Baseline=2]="Baseline"})(g.VAlign||(g.VAlign={}));g.getAlignmentFromPlacement=function(q){switch(q){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return[g.HAlign.Right,g.VAlign.Bottom];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return[g.HAlign.Center,
g.VAlign.Bottom];case "above-right":case "esriServerPointLabelPlacementAboveRight":return[g.HAlign.Left,g.VAlign.Bottom];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return[g.HAlign.Right,g.VAlign.Center];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return[g.HAlign.Center,g.VAlign.Center];case "center-right":case "esriServerPointLabelPlacementCenterRight":return[g.HAlign.Left,g.VAlign.Center];
case "below-left":case "esriServerPointLabelPlacementBelowLeft":return[g.HAlign.Right,g.VAlign.Top];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return[g.HAlign.Center,g.VAlign.Top];case "below-right":case "esriServerPointLabelPlacementBelowRight":return[g.HAlign.Left,g.VAlign.Top];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return[g.HAlign.Center,g.VAlign.Center];default:return console.debug(`Found invalid placement type ${q}`),
[g.HAlign.Center,g.VAlign.Center]}};g.getJustification=function(q){switch(q){case "left":return g.HAlign.Left;case "right":return g.HAlign.Right;case "center":return g.HAlign.Center}};g.getXAnchorDirection=function(q){switch(q){case "left":return g.HAlign.Left;case "right":return g.HAlign.Right;case "center":return g.HAlign.Center}};g.getXDirection=function(q){switch(q){case g.HAlign.Right:return-1;case g.HAlign.Center:return 0;case g.HAlign.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${q}`),
0}};g.getYAnchorDirection=function(q){switch(q){case "top":return g.VAlign.Top;case "middle":return g.VAlign.Center;case "baseline":return g.VAlign.Baseline;case "bottom":return g.VAlign.Bottom}};g.getYDirection=function(q){switch(q){case g.VAlign.Top:return 1;case g.VAlign.Center:return 0;case g.VAlign.Bottom:case g.VAlign.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${q}`),0}};g.isMapAligned=function(q){switch(q){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;
default:return!1}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define(["exports","../../../../../core/Error","../alignmentUtils","../enums"],function(g,q,x,w){function C(t){return t===w.WGLSymbologyType.SIMPLE||t===w.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function r(t){return t===w.WGLSymbologyType.OUTLINE_FILL||t===w.WGLSymbologyType.OUTLINE_FILL_SIMPLE}const m=Object.keys(w.WGLSymbologyType).filter(t=>"number"===typeof w.WGLSymbologyType[t]).reduce((t,
v)=>({...t,[v]:w.WGLSymbologyType[v]}),{});class k{static load(t){const v=this.shared;v.data=t;return v}constructor(t){this._data=0;this._data=t}set data(t){this._data=t??0}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t??!1)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,
8)}set textureBinding(t){this.setBits(t,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(t){this.setBits(t,21,26)}get geometryTypeString(){switch(this.geometryType){case w.WGLGeometryType.FILL:return"fill";case w.WGLGeometryType.MARKER:return"marker";case w.WGLGeometryType.LINE:return"line";case w.WGLGeometryType.TEXT:return"text";case w.WGLGeometryType.LABEL:return"label";default:throw new q(`Unable to handle unknown geometryType: ${this.geometryType}`);}}setBit(t,v){t=1<<t;this._data=
v?this._data|t:this._data&~t}bit(t){return(this._data&1<<t)>>t}setBits(t,v,y){for(let h=v,A=0;h<y;h++,A++)this.setBit(h,0!==(t&1<<A))}bits(t,v){let y=0;for(let h=t,A=0;h<v;h++,A++)y|=this.bit(h)<<A;return y}hasVV(){return!1}setVV(t,v){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:w.WGLSymbologyType[this.symbologyType],options:m,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}}k.shared=new k(0);const f=
t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(v){this.setBit(16,v)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(v){this.setBit(17,v)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(v){this.setBit(18,v)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(v){this.setBit(19,v)}hasSizeVV(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}hasVV(){return super.hasVV()||
this.hasSizeVV()}setVV(v,y){super.setVV(v,y);{var h=this.geometryType;const A=w.WGLVVFlag.SIZE_FIELD_STOPS|w.WGLVVFlag.SIZE_MINMAX_VALUE|w.WGLVVFlag.SIZE_SCALE_STOPS|w.WGLVVFlag.SIZE_UNIT_VALUE,E=(v&(w.WGLVVTarget.FIELD_TARGETS_OUTLINE|w.WGLVVTarget.MINMAX_TARGETS_OUTLINE|w.WGLVVTarget.SCALE_TARGETS_OUTLINE|w.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;y=h===w.WGLGeometryType.LINE&&y.isOutline||h===w.WGLGeometryType.FILL&&r(y.symbologyType)?A&E:A&~E}v&=y;this.vvSizeMinMaxValue=!!(v&w.WGLVVFlag.SIZE_MINMAX_VALUE);
this.vvSizeFieldStops=!!(v&w.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(v&w.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(v&w.WGLVVFlag.SIZE_SCALE_STOPS)}},e=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(v){this.setBit(15,v)}hasVV(){return super.hasVV()||this.vvRotation}setVV(v,y){super.setVV(v,y);this.vvRotation=!y.isOutline&&!!(v&w.WGLVVFlag.ROTATION)}},l=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(v){this.setBit(13,v)}hasVV(){return super.hasVV()||
this.vvColor}setVV(v,y){super.setVV(v,y);this.vvColor=!y.isOutline&&!!(v&w.WGLVVFlag.COLOR)}},b=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(v){this.setBit(14,v)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(v,y){super.setVV(v,y);this.vvOpacity=!y.isOutline&&!!(v&w.WGLVVFlag.OPACITY)}};class p extends l(b(f(k))){static load(t){const v=this.shared;v.data=t;return v}static from(t){const {symbologyType:v,vvFlags:y}=t,h=this.load(0);h.geometryType=w.WGLGeometryType.FILL;
h.symbologyType=v;v!==w.WGLSymbologyType.DOT_DENSITY&&h.setVV(y,t);return h.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class c extends l(b(e(f(k)))){static load(t){const v=this.shared;v.data=t;return v}static from(t){const {symbologyType:v,vvFlags:y}=t,h=this.load(0);h.geometryType=
w.WGLGeometryType.MARKER;h.symbologyType=v;v!==w.WGLSymbologyType.HEATMAP&&h.setVV(y,t);return h.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}c.shared=new c(0);class d extends l(b(f(k))){static load(t){const v=this.shared;v.data=t;return v}static from(t){const v=this.load(0);
v.geometryType=w.WGLGeometryType.LINE;v.symbologyType=t.symbologyType;v.setVV(t.vvFlags,t);return v.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}d.shared=new d(0);class a extends l(b(e(f(k)))){static load(t){const v=this.shared;v.data=t;return v}static from(t){const v=this.load(0);v.geometryType=
w.WGLGeometryType.TEXT;v.symbologyType=t.symbologyType;v.setVV(t.vvFlags,t);return v.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}a.shared=new a(0);class n extends f(k){static load(t){const v=this.shared;v.data=t;return v}static from(t){const v=this.load(0);v.geometryType=
w.WGLGeometryType.LABEL;v.symbologyType=t.symbologyType;v.setVV(t.vvFlags,t);v.mapAligned=x.isMapAligned(t.placement);return v.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}n.shared=new n(0);g.FillMaterialKey=p;g.LabelMaterialKey=n;g.LineMaterialKey=d;g.MarkerMaterialKey=c;g.MaterialKeyBase=k;g.TextMaterialKey=a;g.createMaterialKey=function(t,
v){switch(t){case w.WGLGeometryType.FILL:return p.from(v);case w.WGLGeometryType.LINE:return d.from(v);case w.WGLGeometryType.MARKER:return c.from(v);case w.WGLGeometryType.TEXT:return a.from(v);case w.WGLGeometryType.LABEL:return n.from(v);default:throw Error(`Unable to createMaterialKey for unknown geometryType ${t}`);}};g.hasOutlineFillSymbology=function(t){return r(t.symbologyType)};g.hasSimpleSymbology=function(t){return C(t.symbologyType)};g.hydrateMaterialKey=function(t){switch(k.load(t).geometryType){case w.WGLGeometryType.MARKER:return new c(t);
case w.WGLGeometryType.FILL:return new p(t);case w.WGLGeometryType.LINE:return new d(t);case w.WGLGeometryType.TEXT:return new a(t);case w.WGLGeometryType.LABEL:return new n(t)}};g.isOutlineFillSymbology=r;g.isSimpleSymbology=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","./util"],function(g,q){function x(k){return k.length-1}function w(k){let f=0;for(let e=0;e<x(k);e++)f+=C(k,e);return f}function C(k,
f,e=1){const [l,b]=k[f+1];return Math.sqrt(l*l+b*b)*e}function r(k,f,e,l,b){if(!(e<f)){var p=l.clone().seek(e/2);null!=p&&(k(p.clone(),e,b),e=(e-f)/2,p=p.seek(f/2),r(k,f,e,l,b+1),r(k,f,e,p,b+1))}}class m{constructor(k,f,e,l,b){this._segments=k;this._index=f;this._distance=e;this._xStart=l;this._yStart=b;this._done=!1}static create(k){return new m(k,0,0,k[0][0],k[0][1])}clone(){return new m(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(k){return this._index===k._index||
k._index===this._index-1&&(0===this._distance||1===k._distance)||k._index===this._index+1&&(1===this._distance||0===k._distance)}leq(k){return this._index<k._index||this._index===k._index&&this._distance<=k._distance}geq(k){return this._index>k._index||this._index===k._index&&this._distance>=k._distance}get _segment(){return this._segments[this._index+1]}get angle(){const k=this.dy;let f=Math.acos((0*k+-1*-this.dx)/(1*this.length));0<k&&(f=2*Math.PI-f);return f}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+
this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:k,dy:f}=this;return Math.sqrt(k*k+f*f)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=
this._index-1}hasNext(){return this._index+1<x(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(k,f){var e=this.backwardLength;if(k<=e)return this._distance=(e-k)/this.length,this;for(e=this.backwardLength;this.prev();){if(e+this.length>k)return this._seekBackwards(k-
e);e+=this.length}this._distance=0;return f?this:null}seek(k,f=!1){if(0>k)return this._seekBackwards(Math.abs(k),f);if(k<=this.remainingLength)return this._distance=(this.backwardLength+k)/this.length,this;let e=this.remainingLength;for(;this.next();){if(e+this.length>k)return this.seek(k-e,f);e+=this.length}this._distance=1;return f?this:null}}g.SegmentCursor=m;g.pathDivide=function(k,f,e,l=!0){const b=w(k);k=m.create(k);const p=b/2;if(l){l=Math.floor(Math.max((b-f)/2,0)/f);k.seek(p-l*f);for(let c=
-l;c<=l;c++)512>k.x&&0<=k.x&&512>k.y&&0<=k.y&&e(k.clone(),c,p+c*f,b),k.seek(f)}else k.seek(p),e(k.clone(),0,p+0*f,b)};g.pathLength=w;g.pathSubdivide=function(k,f,e){r(e,f,w(k),m.create(k),0)};g.segmentAt=function(k,f){return k[f+1]};g.segmentCount=x;g.segmentLength=C;g.smoothPaths=function(k,f){for(let F=0;F<k.length;F++){let D=k[F];a:{var e=D,l=f;if(0>=l)break a;const B=e.length;if(3>B)break a;const u=[];var b=0;u.push(0);for(var p=1;p<B;p++)b+=q.dist(e[p],e[p-1]),u.push(b);l=Math.min(l,.2*b);b=
[];b.push(e[0][0]);b.push(e[0][1]);p=e[B-1][0];const H=e[B-1][1];var c=q.sub([0,0],e[0],e[1]);q.normalize(c);e[0][0]+=l*c[0];e[0][1]+=l*c[1];q.sub(c,e[B-1],e[B-2]);q.normalize(c);e[B-1][0]+=l*c[0];e[B-1][1]+=l*c[1];for(c=1;c<B;c++)u[c]+=l;u[B-1]+=l;c=.5*l;for(let G=1;G<B-1;G++){let I=0,J=0,M=0;for(var d=G-1;0<=d&&!(u[d+1]<u[G]-c);d--){var a=c+u[d+1]-u[G],n=u[d+1]-u[d],t=u[G]-u[d]<c?1:a/n;if(1E-6>Math.abs(t))break;var v=t*t,y=t*a-.5*v*n,h=t*n/l,A=e[d+1],E=e[d][0]-A[0],z=e[d][1]-A[1];I+=h/y*(A[0]*t*
a+.5*v*(a*E-n*A[0])-v*t*n*E/3);J+=h/y*(A[1]*t*a+.5*v*(a*z-n*A[1])-v*t*n*z/3);M+=h}for(d=G+1;d<B&&!(u[d-1]>u[G]+c);d++){a=c-u[d-1]+u[G];n=u[d]-u[d-1];t=u[d]-u[G]<c?1:a/n;if(1E-6>Math.abs(t))break;v=t*t;y=t*a-.5*v*n;h=t*n/l;A=e[d-1];E=e[d][0]-A[0];z=e[d][1]-A[1];I+=h/y*(A[0]*t*a+.5*v*(a*E-n*A[0])-v*t*n*E/3);J+=h/y*(A[1]*t*a+.5*v*(a*z-n*A[1])-v*t*n*z/3);M+=h}b.push(I/M);b.push(J/M)}b.push(p);b.push(H);for(let G=0,I=0;G<B;G++)e[G][0]=b[I++],e[G][1]=b[I++]}e=[];e.push(D[0]);for(l=1;l<D.length;l++){const [B,
u]=D[l-1],[H,G]=D[l];e.push([Math.round(H-B),Math.round(G-u)])}D=k[F]=e}return k};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["exports"],function(g){function q(x,w){return Math.sqrt(x*x+w*w)}g.defaultMaxZoom=100;g.defaultMinZoom=0;g.dist=function(x,w){return q(x[0]-w[0],x[1]-w[1])};g.getLimitCosine=function(x=2){return 1/Math.max(x,1)};g.getMinMaxZoom=function(x,w){const C=!!x?.minScale&&w.scaleToZoom(x.minScale)||
0;x=!!x?.maxScale&&w.scaleToZoom(x.maxScale)||100;return[C,x]};g.isExtent=function(x){return void 0!==x.xmin&&void 0!==x.ymin&&void 0!==x.xmax&&void 0!==x.ymax};g.isMultipoint=function(x){return void 0!==x.points};g.isPoint=function(x){return void 0!==x.x&&void 0!==x.y};g.isPolygon=function(x){return void 0!==x.rings};g.isPolyline=function(x){return void 0!==x.paths};g.len=q;g.normalize=function(x){const w=q(x[0],x[1]);x[0]/=w;x[1]/=w};g.sub=function(x,w,C){x[0]=w[0]-C[0];x[1]=w[1]-C[1];return x};
Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("../../../../../../core/BidiText ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLMeshTemplate".split(" "),function(g,q,x,w,C,r,m,k,f,e,l){class b extends e(l){constructor(p,c,d,a,n,t,v,y,h,A,E,z,F,D,B,u,H,G,I,
J,M,R,Y,fa){super();this._xOffset=q.pt2px(F);this._yOffset=q.pt2px(D);this._decoration=A||"none";this._backgroundColor=R;this._borderLineColor=Y;this._borderLineSize=fa;this._color=n;this._haloColor=t;this._haloSize=Math.min(Math.floor(5*q.pt2px(q.toPt(d))),127);this._size=Math.min(Math.round(q.pt2px(c)),127);c=Math.min(Math.round(q.pt2px(a||c)),127);this._referenceSize=Math.round(Math.sqrt(256*c));this._scale=this._size/r.glyphSize;this._angle=z;this._justify=w.getJustification(v||"center");this._xAlignD=
w.getXAnchorDirection(v||"center");this._yAlignD=w.getYAnchorDirection(y||"baseline");this._baseline="baseline"===(y||"baseline");this._bitset=(h===x.Alignment.MAP?1:0)|(E?1:0)<<1;p=k.MaterialKeyBase.load(p);p.sdf=!0;this._materialKey=p.data;this._lineWidth=q.pt2px(B)||512;this._lineHeight=u||1;this._textPlacement=H;this._effects=G;this._isCIM=I??!1;this._minMaxZoom=m.i1616to32(Math.round(J*r.minMaxZoomPrecisionFactor),Math.round(M*r.minMaxZoomPrecisionFactor))}static fromText(p,c){const d=p.font?.size,
a=new b(p.materialKey,d,p.haloSize||0,d,p.color&&C.premultiplyAlphaRGBAArray(p.color)||0,p.haloColor&&C.premultiplyAlphaRGBAArray(p.haloColor)||0,p.horizontalAlignment,p.verticalAlignment,x.Alignment.SCREEN,p.font?.decoration,!1,p.angle||0,p.xoffset||0,p.yoffset||0,p.lineWidth||0,p.lineHeight||0,null,null,!1,f.defaultMinZoom,f.defaultMaxZoom,p.backgroundColor&&C.premultiplyAlphaRGBAArray(p.backgroundColor),p.borderLineColor&&C.premultiplyAlphaRGBAArray(p.borderLineColor),p.borderLineSize),[,n]=g.bidiText(p.text);
a.bindTextInfo(c??[],n);a._vertexBoundsScale=p.maxVVSize&&d?p.maxVVSize/d:1;return a}static fromCIMText(p,c,d){var a=p.scaleFactor||1;const n=p.size*p.sizeRatio*a,[t,v]=f.getMinMaxZoom(p.scaleInfo,d);d=new b(p.materialKey,n,p.outlineSize*p.sizeRatio,p.referenceSize,C.premultiplyAlphaRGBA(p.color),C.premultiplyAlphaRGBA(p.outlineColor),p.horizontalAlignment,p.verticalAlignment,p.alignment,p.decoration,p.colorLocked??!1,p.angle,p.offsetX*p.sizeRatio*a,p.offsetY*p.sizeRatio*a,p.lineWidth||512,1,p.markerPlacement,
p.effects,!0,t,v,p.backgroundColor?C.premultiplyAlphaRGBA(p.backgroundColor):void 0,p.borderLineColor?C.premultiplyAlphaRGBA(p.borderLineColor):void 0,p.borderLineWidth);[,a]=g.bidiText(p.text);d.bindTextInfo(c,a);d._vertexBoundsScale=p.maxVVSize?p.maxVVSize/n:1;return d}}return b})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./shapingUtils".split(" "),
function(g,q,x,w,C,r,m,k){const f=r.i1616to32(4,4),e=r.i1616to32(16,4),l=r.i1616to32(4,2),b=r.i1616to32(4,6),p=[l,l,b,b],c=[l,b,l,b],d=[b,b,f,f],a=[f,f,b,b],n=[b,f,b,f],t=[f,b,f,b];return v=>class extends v{constructor(...y){super(...y);this._isCIM=!1;this._vertexBoundsScale=1;this.geometryType=C.WGLGeometryType.TEXT;this._aux=r.i8888to32(0,0,this._referenceSize,this._bitset)}bindTextInfo(y,h){this._shapingInfo=y?.length?k.shapeGlyphs(y,h,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,
yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:w.magicLabelLineHeight*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize}):null}_write(y,h,A,E){const z=h.getDisplayId();this._writeGeometry(y,h,z,A,E)}_writeGeometry(y,h,A,E,z){const F=this._shapingInfo;if(null!=F){if(this._textPlacement)return this._writePlacedText(y,
A,F,E,h,z);h=z?z.asOptimized():"esriGeometryPolygon"===h.geometryType?h.readCentroid():h.readGeometryForDisplay();if(null!=h){if(h.isPoint){const [D,B]=h.coords;return!y.hasAggregates&&y.hasPixelBufferEnabled&&(0>D||512<=D||0>B||512<=B)?void 0:this._writeGlyphs(y,A,{x:D,y:B},F)}h.forEachVertex((D,B)=>this._writeGlyphs(y,A,{x:D,y:B},F))}}}_writePlacedText(y,h,A,E,z,F){var D=this._textPlacement;if(z=F||q.GeometryCursor.fromFeatureSetReaderCIM(z))if(E=x.CIMMarkerPlacementHelper.getPlacement(z,-1,D,g.pt2px(1),
y.tileKey,E.geometryEngine)){D=A.bounds;D=Math.sqrt(D.height*D.height+D.width*D.width);for(var B;B=E.next();)z=B.tx,F=-B.ty,0<=z+D&&512>z-D&&0<=F+D&&512>F-D&&(B=-B.getAngle(),A.setRotation(B),this._writeGlyphs(y,h,{x:z,y:F},A),A.setRotation(-B))}}_writeGlyphs(y,h,A,E){const z=m.MaterialKeyBase.load(this._materialKey),F=r.i1616to32(Math.round(8*A.x),Math.round(8*A.y)),D=this._vertexBoundsScale,{bounds:B,background:u,glyphs:H}=E;0<H.length&&(this._borderLineColor||this._backgroundColor)&&(z.textureBinding=
H[0].textureBinding,y.recordStart(h,z.data,this.geometryType,!0),this._writeBackgroundGeometry(y,h,A,B,u),y.recordEnd());const G=2*Math.max(B.width,B.height);for(const I of E.glyphs)z.textureBinding=I.textureBinding,y.recordStart(h,z.data,this.geometryType,!0),y.vertexBounds(A.x+B.x+this._xOffset,A.y+B.y-this._yOffset,G*D,G*D),this._writeVertices(y,h,F,I),y.recordEnd()}_writeGlyph(y,h,A,E,z){var F=m.MaterialKeyBase.load(this._materialKey);const D=r.i1616to32(Math.round(8*A),Math.round(8*E));F.textureBinding=
z.textureBinding;y.recordStart(h,F.data,this.geometryType,!0);F=z.bounds;const B=this._vertexBoundsScale;y.vertexBounds(A+F.x*B,E+F.y*B,F.width*B,F.height*B);this._writeVertices(y,h,D,z);y.recordEnd()}_writeVertices(y,h,A,E){const z=y.vertexCount();this._writeVertexCommon(y,h,A,E);y.vertexWrite(E.offsets.upperLeft);y.vertexWrite(E.texcoords.upperLeft);y.vertexEnd();this._writeVertexCommon(y,h,A,E);y.vertexWrite(E.offsets.upperRight);y.vertexWrite(E.texcoords.upperRight);y.vertexEnd();this._writeVertexCommon(y,
h,A,E);y.vertexWrite(E.offsets.lowerLeft);y.vertexWrite(E.texcoords.lowerLeft);y.vertexEnd();this._writeVertexCommon(y,h,A,E);y.vertexWrite(E.offsets.lowerRight);y.vertexWrite(E.texcoords.lowerRight);y.vertexEnd();y.indexWrite(z+0);y.indexWrite(z+1);y.indexWrite(z+2);y.indexWrite(z+1);y.indexWrite(z+3);y.indexWrite(z+2)}_writeVertexCommon(y,h,A,E){E=this._color;const z=this._haloColor,F=r.i8888to32(0,0,this._referenceSize,this._bitset),D=r.i8888to32(0,0,this._size,this._haloSize);y.vertexWrite(A);
y.vertexWrite(h);y.vertexWrite(E);y.vertexWrite(z);y.vertexWrite(D);y.vertexWrite(F);y.vertexWrite(this._minMaxZoom)}_writeBackgroundVertex(y,h,A,E,z,F){const D=r.i8888to32(0,1,this._referenceSize,this._bitset),B=r.i8888to32(0,0,this._size,this._haloSize),u=r.i8888to32(0,0,0,0);y.vertexWrite(A);y.vertexWrite(h);y.vertexWrite(E);y.vertexWrite(u);y.vertexWrite(B);y.vertexWrite(D);y.vertexWrite(this._minMaxZoom);y.vertexWrite(z);y.vertexWrite(F);y.vertexEnd()}_writeBackgroundQuad(y,h,A,E,z,F){const D=
y.vertexCount();this._writeBackgroundVertex(y,h,A,E,z.upperLeft,F[0]);this._writeBackgroundVertex(y,h,A,E,z.upperRight,F[1]);this._writeBackgroundVertex(y,h,A,E,z.lowerLeft,F[2]);this._writeBackgroundVertex(y,h,A,E,z.lowerRight,F[3]);y.indexWrite(D+0);y.indexWrite(D+1);y.indexWrite(D+2);y.indexWrite(D+1);y.indexWrite(D+3);y.indexWrite(D+2)}_writeBackgroundGeometry(y,h,A,E,z){const F=r.i1616to32(Math.round(8*A.x),Math.round(8*A.y)),{x:D,y:B,width:u,height:H}=E;E=2*Math.max(u,H);y.vertexBounds(A.x+
D+this._xOffset,A.y+B-this._yOffset,E*this._vertexBoundsScale,E*this._vertexBoundsScale);this._backgroundColor&&this._writeBackgroundQuad(y,h,F,this._backgroundColor,z.main,[e,e,e,e]);if(this._borderLineColor||this._backgroundColor){const [G,I,J,M,R]=this._borderLineColor&&this._borderLineSize&&0<this._borderLineSize?[p,p,c,c,this._borderLineColor]:[d,a,n,t,this._backgroundColor];this._writeBackgroundQuad(y,h,F,R,z.top,G);this._writeBackgroundQuad(y,h,F,R,z.bot,I);this._writeBackgroundQuad(y,h,F,
R,z.left,J);this._writeBackgroundQuad(y,h,F,R,z.right,M)}}}})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(g,q){class x{static getPlacement(w,C,r,m,k,f){const e=q.getPlacementOperator(r);if(!e)return null;-1===C&&w.invertY();return e.execute(w,r,m,k,f)}}g.CIMMarkerPlacementHelper=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A){g.getEffectOperator=function(E){if(!E)return null;switch(E.type){case "CIMGeometricEffectAddControlPoints":return q.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return x.EffectArrow.local();case "CIMGeometricEffectBuffer":return w.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return C.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return r.EffectCut.local();case "CIMGeometricEffectDashes":return m.EffectDashes.local();
case "CIMGeometricEffectDonut":return k.EffectDonut.local();case "CIMGeometricEffectJog":return f.EffectJog.local();case "CIMGeometricEffectMove":return e.EffectMove.local();case "CIMGeometricEffectOffset":return l.EffectOffset.local();case "CIMGeometricEffectReverse":return b.EffectReverse.local();case "CIMGeometricEffectRotate":return p.EffectRotate.local();case "CIMGeometricEffectScale":return c.EffectScale.local();case "CIMGeometricEffectWave":return d.EffectWave.local()}return null};g.getPlacementOperator=
function(E){if(!E)return null;switch(E.type){case "CIMMarkerPlacementAlongLineSameSize":return a.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return n.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return t.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return v.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return y.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return h.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return A.PlacementPolygonCenter.local()}return null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(g){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(w,C,r,m,k){return new x(w,C,r)}}q.instance=null;class x{constructor(w,C,r){this._inputGeometries=w;this._angleTolerance=void 0!==C.angleTolerance?C.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let w=this._inputGeometries.next();for(;w;){if("esriGeometryPolygon"===w.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===w.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===w.geometryType){if(this._maxCosAngle)return w;this._isClosed=!0}else{w=this._inputGeometries.next();continue}for(;w.nextPath();)this._processPath(w);w.reset();return w}return null}_processPath(w){if(w.nextPoint()){const C=
w.x,r=w.y;let m=C,k=r,f=w.pathSize,e=0,l=0,b=0,p=0,c=0,d=0;this._isClosed&&++f;for(let a=1;w.nextPoint()||a<f;++a){let n,t;this._isClosed&&a===f-1?(n=C,t=r):(n=w.x,t=w.y);const v=n-m,y=t-k,h=Math.sqrt(v*v+y*y);1<a&&0<h&&0<b&&(e*v+l*y)/h/b<=this._maxCosAngle&&w.setControlPointAt(a-1);1===a&&(p=v,c=y,d=h);0<h&&(m=n,k=t,e=v,l=y,b=h)}this._isClosed&&0<b&&0<d&&(e*p+l*c)/d/b<=this._maxCosAngle&&w.setControlPointAt(0)}}}g.EffectAddControlPoints=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(g,q,x,w,C,r){const m=r.GeometricEffectArrowType.OpenEnded;class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(e,l,b,p,c){return new f(e,l,b)}}k.instance=null;class f extends w.PathEffectCursor{constructor(e,l,b){super(e,!1,!0);this._curveHelper=new C.CurveHelper;this._width=
(void 0!==l.width?l.width:5)*b;this._arrowType=void 0!==l.geometricEffectArrowType?l.geometricEffectArrowType:void 0!==l.arrowType?l.arrowType:m;this._offsetFlattenError=C.pixelTolerance*b}processPath(e){const l=q.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(l,e,!0);break;case r.GeometricEffectArrowType.Block:this._constructSimpleArrow(l,e,!1);break;case r.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(l,e)}return l}_constructSimpleArrow(e,
l,b){var p=l.pathLength(),c=this._width;p<2*c&&(c=p/2);var d=this._curveHelper.getSubCurve(l,0,p-c);if(d&&d.nextPath()&&(d.seekPathStart(),p=c/2,!this._curveHelper.isEmpty(d)&&(d=x.collectPath(d),c=this._constructOffset(d,-p)))&&(d=this._constructOffset(d,p))){var a=this._constructArrowBasePoint(c,-p/2);a&&(p=this._constructArrowBasePoint(d,p/2))&&(l.seekInPath(l.pathSize-1),l=[l.x,l.y],e.pushPath(d),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(l),
e.nextPoint(),e.setControlPoint(),e.pushPoint(a),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),b||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(d[0])),e.reset())}}_constructCrossedArrow(e,l){var b=l.pathLength(),p=this._width;b<3.732050807568877*p&&(p=b/3.732050807568877);l.seekPathStart();var c=this._curveHelper.getSubCurve(l,0,b-2.732050807568877*p);if(c){c.nextPath();var d=p/2;if(!this._curveHelper.isEmpty(c)){var a=x.collectPath(c);if(c=
this._constructOffset(a,d))if(a=this._constructOffset(a,-d))if(b=this._curveHelper.getSubCurve(l,0,b-p))if(b.nextPath(),!this._curveHelper.isEmpty(b)&&(b=x.collectPath(b),p=this._constructOffset(b,d))){var n=this._constructOffset(b,-d);if(n&&(b=p[p.length-1],p=this._constructArrowBasePoint(p,d/2))){var t=n[n.length-1];if(d=this._constructArrowBasePoint(n,-d/2))l.seekInPath(l.pathSize-1),l=[l.x,l.y],e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(t),e.nextPoint(),e.setControlPoint(),
e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(l),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoints(a.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}}}}}_constructOffset(e,l){return this._curveHelper.offset(e,l,r.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,l){if(!e||2>e.length)return null;var b=e[e.length-2];e=e[e.length-1];b=[e[0]-b[0],
e[1]-b[1]];this._curveHelper.normalize(b);return[e[0]+b[1]*l,e[1]-b[0]*l]}}g.EffectArrow=k;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(g,q){class x{constructor(C,r=!0,m=!0,k=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!r&&"esriGeometryPolygon"===C.geometryType||!m&&"esriGeometryPolyline"===C.geometryType?null:C;this.geomUnitsPerPoint=k;this.iteratePath=!1;this.internalPlacement=
new q.Placement}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.nextPath();){this.geometryCursor.seekPathStart();const C=this.processPath(this.geometryCursor);if(C)return C}return this.geometryCursor=null}}class w{constructor(C,r,m,k=0){this.isClosed=!1;this.inputGeometries=C;this.acceptPolygon=r;this.acceptPolyline=m;this.geomUnitsPerPoint=k;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var C=this.inputGeometries.next();C&&
!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===C.geometryType||"esriGeometryEnvelope"===C.geometryType,this.multiPathCursor=C);)C=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),C=this.processPath(this.multiPathCursor))return C;this.multiPathCursor=null}}}g.PathEffectCursor=w;g.PathTransformationCursor=x;g.getId=function(C){return C[4]};g.setId=function(C,r){C[4]=r};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(g){class q{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(w,C){this.tx=w;this.ty=C}setTranslateZ(w){this.tz=w}setRotateCS(w,C){this.rz=void 0;this.rzCos=w;this.rzSin=
C}setRotate(w){this.rz=w;this.rzSin=this.rzCos=void 0}setRotateY(w){this.ry=w}setScale(w){this.s=w}setMeasure(w){this.m=w}}class x{next(){return null}}g.EmptyPlacementCursor=x;g.Placement=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(g,q,x){class w{constructor(C,r){}isEmpty(C){if(!C.nextPoint())return!0;let r,m,k,f;r=C.x;for(m=C.y;C.nextPoint();r=m,m=f)if(k=C.x,f=C.y,
k!==r||f!==m)return C.seekPathStart(),!1;C.seekPathStart();return!0}normalize(C){const r=Math.sqrt(C[0]*C[0]+C[1]*C[1]);0!==r&&(C[0]/=r,C[1]/=r)}getLength(C,r,m,k){C=m-C;r=k-r;return Math.sqrt(C*C+r*r)}getSegLength(C){const [[r,m],[k,f]]=C;return this.getLength(r,m,k,f)}getCoord2D(C,r,m,k,f){return[C+(m-C)*f,r+(k-r)*f]}getSegCoord2D(C,r){const [[m,k],[f,e]]=C;return this.getCoord2D(m,k,f,e,r)}getAngle(C,r,m,k,f){return Math.atan2(k-r,m-C)}getAngleCS(C,r,m,k,f){C=m-C;r=k-r;k=Math.sqrt(C*C+r*r);return 0<
k?[C/k,r/k]:[1,0]}getSegAngleCS(C,r){const [[m,k],[f,e]]=C;return this.getAngleCS(m,k,f,e,r)}cut(C,r,m,k,f,e){f=0>=f?[C,r]:this.getCoord2D(C,r,m,k,f);C=1<=e?[m,k]:this.getCoord2D(C,r,m,k,e);return[f,C]}getSubCurve(C,r,m){const k=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(k,C,r,m)?k:null}appendSubCurve(C,r,m,k){C.startPath();r.seekPathStart();let f=0;var e=!0;if(!r.nextPoint())return!1;var l=r.x;let b=r.y;for(;r.nextPoint();){const p=this.getLength(l,
b,r.x,r.y);if(0!==p){if(e){if(f+p>m){const c=(m-f)/p;let d=1;e=!1;f+p>=k&&(d=(k-f)/p,e=!0);(l=this.cut(l,b,r.x,r.y,c,d))&&C.pushPoints(l);if(e)break;e=!1}}else{if(f+p>k){(r=this.cut(l,b,r.x,r.y,0,(k-f)/p))&&C.pushPoint(r[1]);break}C.pushXY(r.x,r.y)}f+=p}l=r.x;b=r.y}return!0}getCIMPointAlong(C,r){if(!C.nextPoint())return null;let m=0,k,f,e,l;k=C.x;for(f=C.y;C.nextPoint();k=e,f=l){e=C.x;l=C.y;const b=this.getLength(k,f,e,l);if(0!==b){if(m+b>r)return this.getCoord2D(k,f,e,l,(r-m)/b);m+=b}}return null}offset(C,
r,m,k,f){if(!C||2>C.length)return null;var e=0,l=C[e++];for(f=e;e<C.length;){var b=C[e];if(b[0]!==l[0]||b[1]!==l[1])e!==f&&(C[f]=C[e]),l=C[f++];e++}(e=C[0][0]===C[f-1][0]&&C[0][1]===C[f-1][1])&&--f;if(f<(e?3:2))return null;b=[];l=e?C[f-1]:null;let p=C[0];for(let t=0;t<f;t++){const v=t===f-1?e?C[0]:null:C[t+1];if(l)if(v){var c=[v[0]-p[0],v[1]-p[1]];this.normalize(c);var d=[p[0]-l[0],p[1]-l[1]];this.normalize(d);var a=d[0]*c[1]-d[1]*c[0],n=d[0]*c[0]+d[1]*c[1];if(0===a&&1===n){p=v;continue}if(0<=a===
0>=r)1>n&&(c=[c[0]-d[0],c[1]-d[1]],this.normalize(c),d=Math.sqrt((1+n)/2),d>1/k&&(d=-Math.abs(r)/d,b.push([p[0]-c[0]*d,p[1]-c[1]*d])));else switch(m){case x.GeometricEffectOffsetMethod.Mitered:if(l=Math.sqrt((1+n)/2),0<l&&1/l<k){c=[c[0]-d[0],c[1]-d[1]];this.normalize(c);d=Math.abs(r)/l;b.push([p[0]-c[0]*d,p[1]-c[1]*d]);break}case x.GeometricEffectOffsetMethod.Bevelled:b.push([p[0]+d[1]*r,p[1]-d[0]*r]);b.push([p[0]+c[1]*r,p[1]-c[0]*r]);break;case x.GeometricEffectOffsetMethod.Rounded:if(1>n){b.push([p[0]+
d[1]*r,p[1]-d[0]*r]);l=Math.floor(2.5*(1-n));if(0<l){a=n=1/l;for(let y=1;y<l;y++,a+=n){const h=[d[1]*(1-a)+c[1]*a,-d[0]*(1-a)-c[0]*a];this.normalize(h);b.push([p[0]+h[0]*r,p[1]+h[1]*r])}}b.push([p[0]+c[1]*r,p[1]-c[0]*r])}break;default:0>a?(b.push([p[0]+(d[1]+d[0])*r,p[1]+(d[1]-d[0])*r]),b.push([p[0]+(c[1]-c[0])*r,p[1]-(c[0]+c[1])*r])):(l=Math.sqrt((1+Math.abs(n))/2),c=[c[0]-d[0],c[1]-d[1]],this.normalize(c),d=r/l,b.push([p[0]-c[0]*d,p[1]-c[1]*d]))}}else c=[p[0]-l[0],p[1]-l[1]],this.normalize(c),b.push([p[0]+
c[1]*r,p[1]-c[0]*r]);else c=[v[0]-p[0],v[1]-p[1]],this.normalize(c),b.push([p[0]+c[1]*r,p[1]-c[0]*r]);l=p;p=v}if(b.length<(e?3:2))return null;e&&b.push([b[0][0],b[0][1]]);return b}}g.CurveHelper=w;g.pixelTolerance=.03;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(g,q,x,w,C,r,m,k){class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(l,b,p,c,d,a){return new e(l,b,p,c,d,a)}}f.instance=null;class e{constructor(l,b,p,c,d,a){this._inputGeometries=l;this._tileKey=c;this._geometryEngine=d;this._curveHelper=new r.CurveHelper;this._size=(void 0!==b.size?b.size:1)*p;this._maxInflateSize=a*p;this._offsetFlattenError=r.pixelTolerance*p}next(){for(var l;l=this._inputGeometries.next();){if(0===this._size)return l;if("esriGeometryEnvelope"===
l.geometryType)if(0<this._size){var b=x.GeometryCursor.createEmptyOptimizedCIM(l.geometryType),p=w.collectMultipath(l)[0];if(p=this._curveHelper.offset(p,this._size,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return b.pushPath(p),b}else if(0>this._size&&(b=l.asJSON(),0<Math.min(b.xmax-b.xmin,b.ymax-b.ymin)+2*this._size))return x.GeometryCursor.fromJSONCIM({xmin:b.xmin-this._size,xmax:b.xmax+this._size,ymin:b.ymin-this._size,ymax:b.ymax+this._size});b=this._geometryEngine;if(null==
b)break;if(l=this._tileKey?C.clipCursorToTileExtent(l,this._maxInflateSize):l)return(l=b.buffer(k.WebMercator,l.asJSON(),this._size,1))?x.GeometryCursor.fromJSONCIM(l):null}return null}}g.EffectBuffer=f;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(g,q,x){let w;class C{constructor(r){this._geometry=r}next(){const r=this._geometry;this._geometry=
null;return r}}g.SimpleEffectCursor=C;g.clipCursorToTileExtent=function(r,m){w||(w=new x.TileClipper(0,0,0,1));var k="esriGeometryPolygon"===r.geometryType;const f=k?3:2;w.reset(k?x.GeometryType.Polygon:x.GeometryType.LineString);w.setPixelMargin(m+1);w.setExtent(512);let e;for(;r.nextPath();)if(!(r.pathSize<f)){r.nextPoint();m=r.x;e=-r.y;for(w.moveTo(m,e);r.nextPoint();)m=r.x,e=-r.y,w.lineTo(m,e);k&&w.close()}if(k=w.result(!1)){r=q.GeometryCursor.createEmptyOptimizedCIM(r.geometryType);for(const l of k){r.startPath();
for(const b of l)r.pushXY(b.x,-b.y)}r.reset();return r}return null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(g,q,x,w,C){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(k,f,e,l,b){return new m(k,f,e)}}r.instance=null;class m{constructor(k,f,
e){this._defaultPointSize=20;this._inputGeometries=k;this._geomUnitsPerPoint=e;this._rule=f.rule??C.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*e}next(){for(var k;k=this._inputGeometries.next();)if((k=this._processGeom(x.collectMultipath(k)))&&k.length)return q.GeometryCursor.fromJSONCIM({paths:k});return null}_clone(k){return[k[0],k[1]]}_mid(k,f){return[(k[0]+f[0])/2,(k[1]+f[1])/2]}_mix(k,f,e,l){return[k[0]*f+e[0]*l,k[1]*f+e[1]*l]}_add(k,f){return[k[0]+
f[0],k[1]+f[1]]}_add2(k,f,e){return[k[0]+f,k[1]+e]}_sub(k,f){return[k[0]-f[0],k[1]-f[1]]}_dist(k,f){return Math.sqrt((k[0]-f[0])*(k[0]-f[0])+(k[1]-f[1])*(k[1]-f[1]))}_norm(k){return Math.sqrt(k[0]*k[0]+k[1]*k[1])}_normalize(k,f=1){f/=this._norm(k);k[0]*=f;k[1]*=f}_leftPerpendicular(k){const f=k[0];k[0]=-k[1];k[1]=f}_leftPerp(k){return[-k[1],k[0]]}_rightPerpendicular(k){const f=-k[0];k[0]=k[1];k[1]=f}_rightPerp(k){return[k[1],-k[0]]}_dotProduct(k,f){return k[0]*f[0]+k[1]*f[1]}_crossProduct(k,f){return k[0]*
f[1]-k[1]*f[0]}_rotateDirect(k,f,e){const l=k[0]*e+k[1]*f;k[0]=k[0]*f-k[1]*e;k[1]=l}_makeCtrlPt(k){k=[k[0],k[1]];w.setId(k,1);return k}_addAngledTicks(k,f,e,l){const b=this._sub(e,f);this._normalize(b);var p=this._crossProduct(b,this._sub(l,f));l=0<p?this._rightPerp(b):this._leftPerp(b);p=Math.abs(p)/2;const c=[];c.push([f[0]+(l[0]-b[0])*p,f[1]+(l[1]-b[1])*p]);c.push(f);c.push(e);c.push([e[0]+(l[0]+b[0])*p,e[1]+(l[1]+b[1])*p]);k.push(c)}_addBezier2(k,f,e,l,b){if(0===b--)k.push(l);else{var p=this._mid(f,
e);e=this._mid(e,l);var c=this._mid(p,e);this._addBezier2(k,f,p,c,b);this._addBezier2(k,c,e,l,b)}}_addBezier3(k,f,e,l,b,p){if(0===p--)k.push(b);else{var c=this._mid(f,e),d=this._mid(e,l);l=this._mid(l,b);e=this._mid(c,d);d=this._mid(d,l);var a=this._mid(e,d);this._addBezier3(k,f,c,e,a,p);this._addBezier3(k,a,d,l,b,p)}}_add90DegArc(k,f,e,l,b){l=b??0<this._crossProduct(this._sub(e,f),this._sub(l,f));b=this._mid(f,e);const p=this._sub(b,f);l?this._leftPerpendicular(p):this._rightPerpendicular(p);b[0]+=
p[0];b[1]+=p[1];this._addBezier3(k,f,this._mix(f,.33333,b,.66667),this._mix(e,.33333,b,.66667),e,4)}_addArrow(k,f,e){var l=f[0],b=f[1],p=f[f.length-1],c=this._sub(l,b);this._normalize(c);const d=this._crossProduct(c,this._sub(p,b));b=.5*d;var a=this._leftPerp(c);const n=[p[0]-a[0]*d,p[1]-a[1]*d];var t=f.length-1;p=[];p.push(e?[-a[0],-a[1]]:a);var v=[-c[0],-c[1]];for(e=1;e<t-1;e++){c=this._sub(f[e+1],f[e]);this._normalize(c);var y=this._dotProduct(c,v);a=this._crossProduct(c,v);y=Math.sqrt((1+y)/2);
v=this._sub(c,v);this._normalize(v);v[0]/=y;v[1]/=y;p.push(0>a?[-v[0],-v[1]]:v);v=c}p.push(this._rightPerp(v));for(t=p.length-1;0<t;t--)k.push([f[t][0]+p[t][0]*b,f[t][1]+p[t][1]*b]);k.push([n[0]+p[0][0]*b,n[1]+p[0][1]*b]);k.push([n[0]+p[0][0]*d,n[1]+p[0][1]*d]);k.push(l);k.push([n[0]-p[0][0]*d,n[1]-p[0][1]*d]);k.push([n[0]-p[0][0]*b,n[1]-p[0][1]*b]);for(l=1;l<p.length;l++)k.push([f[l][0]-p[l][0]*b,f[l][1]-p[l][1]*b])}_cp2(k,f,e){return 2<=k.length?k[1]:this._add2(k[0],f*this._defaultSize,e*this._defaultSize)}_cp3(k,
f,e,l){if(3<=k.length)return k[2];e=this._mix(k[0],1-e,f,e);k=this._sub(f,k[0]);this._normalize(k);this._rightPerpendicular(k);return[e[0]+k[0]*l*this._defaultSize,e[1]+k[1]*l*this._defaultSize]}_arrowPath(k){if(2<k.length)return k;const f=k[0];k=this._cp2(k,-4,0);const e=this._sub(f,k);this._normalize(e);const l=this._rightPerp(e);return[f,k,[f[0]+(l[0]-e[0])*this._defaultSize,f[1]+(l[1]-e[1])*this._defaultSize]]}_arrowLastSeg(k){var f=k[0];const e=this._cp2(k,-4,0);if(3<=k.length)f=k[k.length-1];
else{k=this._sub(f,e);this._normalize(k);const l=this._rightPerp(k);f=[f[0]+(l[0]-k[0])*this._defaultSize,f[1]+(l[1]-k[1])*this._defaultSize]}return[e,f]}_processGeom(k){if(!k)return null;const f=[];for(const e of k){if(!e||0===e.length)continue;const l=e.length;let b=e[0];switch(this._rule){case C.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const p=this._cp2(e,0,-1),c=this._cp3(e,p,.5,4),d=[];d.push(c);d.push(this._mid(b,p));f.push(d);break;case C.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const a=
this._cp2(e,0,-1);f.push([a,b]);break;case C.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const n=this._cp2(e,-4,1),t=this._cp3(e,n,.882353,-1.94),v=[];v.push(this._mid(n,t));v.push(b);f.push(v);break;case C.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const y=this._cp2(e,-4,1),h=this._cp3(e,y,.882353,-1.94),A=this._sub(h,y);let E;E=0<this._crossProduct(A,this._sub(b,y))?this._rightPerp(E):this._leftPerp(A);const z=[];z.push([y[0]+(E[0]-A[0])/3,y[1]+(E[1]-A[1])/
3]);z.push(y);z.push(h);z.push([h[0]+(E[0]+A[0])/3,h[1]+(E[1]+A[1])/3]);f.push(z);break;case C.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const F=this._cp2(e,0,-1),D=this._cp3(e,F,.5,3),B=this._mid(b,F),u=this._sub(B,D);this._normalize(u);const H=this._crossProduct(u,this._sub(b,D));this._leftPerpendicular(u);const G=[];G.push(b);G.push([D[0]+u[0]*H,D[1]+u[1]*H]);f.push(G);const I=[];I.push([D[0]-u[0]*H,D[1]-u[1]*H]);I.push(F);f.push(I);break;case C.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const J=
this._cp2(e,0,-1),M=this._cp3(e,J,.5,3),R=this._mid(b,J),Y=this._sub(R,M);this._normalize(Y);const fa=this._crossProduct(Y,this._sub(b,M));this._leftPerpendicular(Y);const O=[];O.push([M[0]+Y[0]*fa,M[1]+Y[1]*fa]);O.push([M[0]-Y[0]*fa,M[1]-Y[1]*fa]);f.push(O);break;case C.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const Q=this._cp2(e,0,-1),Z=this._cp3(e,Q,.5,4),ba=this._mid(b,Q),da=this._sub(ba,Z);this._normalize(da);const P=this._crossProduct(da,this._sub(b,Z));this._leftPerpendicular(da);
const U=[];U.push([Z[0]+da[0]*P*.8,Z[1]+da[1]*P*.8]);U.push([ba[0]+.8*(b[0]-ba[0]),ba[1]+.8*(b[1]-ba[1])]);f.push(U);f.push([Z,ba]);const ca=[];ca.push([Z[0]-da[0]*P*.8,Z[1]-da[1]*P*.8]);ca.push([ba[0]+.8*(Q[0]-ba[0]),ba[1]+.8*(Q[1]-ba[1])]);f.push(ca);break;case C.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const la=this._cp2(e,0,-1),pa=this._cp3(e,la,.5,4),na=this._mid(b,la);let ra=this._sub(la,b);const ua=Math.cos(Math.PI/18),L=Math.sin(Math.PI/18),T=Math.sqrt((1+ua)/2),ia=Math.sqrt((1-
ua)/2),ka=[];let qa;0<this._crossProduct(ra,this._sub(pa,b))?(ka.push(b),ra=this._sub(b,na),qa=la):(ka.push(la),ra=this._sub(la,na),qa=b);this._rotateDirect(ra,T,ia);ra[0]/=T;ra[1]/=T;for(let Ja=1;18>=Ja;Ja++)ka.push(this._add(na,ra)),this._rotateDirect(ra,ua,L);ka.push(qa);f.push(ka);break;case C.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const S=this._cp2(e,0,-1),V=this._cp3(e,S,1,-1);let X=this._sub(b,S);this._normalize(X);const ha=this._crossProduct(X,this._sub(V,S))/2;this._leftPerpendicular(X);
const ja=[S[0]+X[0]*ha,S[1]+X[1]*ha];X=this._sub(S,ja);const ma=Math.cos(Math.PI/18);let oa=Math.sin(Math.PI/18);0<ha&&(oa=-oa);const va=[S];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(X,ma,oa),va.push(this._add(ja,X));f.push(va);break;case C.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const xa=this._cp2(e,0,-2),za=this._cp3(e,xa,1,-1);let Aa;if(4<=l)Aa=e[3];else{const Ja=this._sub(b,xa);Aa=this._add(za,Ja)}const Ba=this._dist(xa,za)/2/.75,Ia=this._sub(xa,b);this._normalize(Ia,Ba);const Da=
this._sub(za,Aa);this._normalize(Da,Ba);f.push([Aa,za]);const Ga=[this._clone(za)];this._addBezier3(Ga,za,this._add(za,Da),this._add(xa,Ia),xa,4);Ga.push(b);f.push(Ga);break;case C.GeometricEffectControlMeasureLineRule.OpenCircle:const Fa=this._cp2(e,-2,0),Ea=this._sub(Fa,b),La=Math.cos(Math.PI/18),Ua=-Math.sin(Math.PI/18),$a=[Fa];for(let Ja=1;33>=Ja;Ja++)this._rotateDirect(Ea,La,Ua),$a.push(this._add(b,Ea));f.push($a);break;case C.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Ta=
this._cp2(e,0,-1);let Na;if(3<=l)Na=e[2];else{const Ja=this._sub(Ta,b),Wa=this._leftPerp(Ja);Na=[b[0]+Wa[0]-.25*Ja[0],b[1]+Wa[1]-.25*Ja[1]]}let Pa;if(4<=l)Pa=e[3];else{const Ja=this._mid(b,Ta),Wa=this._sub(b,Ta);this._normalize(Wa);this._leftPerpendicular(Wa);const ab=this._crossProduct(Wa,this._sub(Na,Ja));this._rightPerpendicular(Wa);Pa=[Na[0]+Wa[0]*ab*2,Na[1]+Wa[1]*ab*2]}const wa=this._sub(Ta,b);let Qa,db;Qa=0<this._crossProduct(wa,this._sub(Na,b))?this._rightPerp(wa):this._leftPerp(wa);db=[];
db.push(Na);db.push(b);db.push([b[0]+(Qa[0]-wa[0])/3,b[1]+(Qa[1]-wa[1])/3]);f.push(db);Qa=0<this._crossProduct(wa,this._sub(Pa,Ta))?this._rightPerp(Qa):this._leftPerp(wa);db=[];db.push([Ta[0]+(Qa[0]+wa[0])/3,Ta[1]+(Qa[1]+wa[1])/3]);db.push(Ta);db.push(Pa);f.push(db);break;case C.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const jb=this._cp2(e,0,2),K=this._cp3(e,jb,0,1);let sb;if(4<=l)sb=e[3];else{const Ja=this._sub(jb,b);sb=this._add(K,Ja)}this._addAngledTicks(f,b,jb,this._mid(K,
sb));this._addAngledTicks(f,K,sb,this._mid(b,jb));break;case C.GeometricEffectControlMeasureLineRule.GapExtentMidline:const bd=this._cp2(e,2,0),Ld=this._cp3(e,bd,0,1);let cd;if(4<=l)cd=e[3];else{const Ja=this._sub(bd,b);cd=this._add(Ld,Ja)}const Fc=[];Fc.push(this._mid(b,Ld));Fc.push(this._mid(bd,cd));f.push(Fc);break;case C.GeometricEffectControlMeasureLineRule.Chevron:const dd=this._cp2(e,-1,-1);let ed;if(3<=l)ed=e[2];else{const Ja=this._sub(dd,b);this._leftPerpendicular(Ja);ed=this._add(b,Ja)}f.push([dd,
this._makeCtrlPt(b),ed]);break;case C.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Eb=this._cp2(e,0,-2),fd=this._cp3(e,Eb,.5,-1);let Xa=this._sub(Eb,b);const Fb=this._norm(Xa);Xa[0]/=Fb;Xa[1]/=Fb;const pb=this._crossProduct(Xa,this._sub(fd,b));let vb=this._dotProduct(Xa,this._sub(fd,b));vb<.05*Fb?vb=.05*Fb:vb>.95*Fb&&(vb=.95*Fb);const $b=[b[0]+Xa[0]*vb,b[1]+Xa[1]*vb];this._leftPerpendicular(Xa);let Sb=[];Sb.push([$b[0]-Xa[0]*pb,$b[1]-Xa[1]*pb]);Sb.push([$b[0]+Xa[0]*pb,$b[1]+Xa[1]*
pb]);f.push(Sb);const Qd=[Eb[0]+Xa[0]*pb,Eb[1]+Xa[1]*pb];Xa=this._sub(Eb,Qd);const cf=Math.cos(Math.PI/18);let Sc=Math.sin(Math.PI/18);0>pb&&(Sc=-Sc);Sb=[b,Eb];for(let Ja=1;9>=Ja;Ja++)this._rotateDirect(Xa,cf,Sc),Sb.push(this._add(Qd,Xa));f.push(Sb);break;case C.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Tc=this._cp2(e,2,0),Bc=this._mid(b,Tc),we=this._sub(Tc,Bc),Ke=Math.cos(Math.PI/18),Je=Math.sin(Math.PI/18),Td=[b,Tc];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(we,Ke,Je),Td.push(this._add(Bc,
we));f.push(Td);break;case C.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Nb=this._cp2(e,0,-2),Dd=this._cp3(e,Nb,1,-2),Ob=this._mid(b,Nb),nb=this._sub(Dd,Nb);this._normalize(nb);const Ae=Math.abs(this._crossProduct(nb,this._sub(Ob,Nb)))/2,Vb=this._dist(Nb,Dd),Be=[Nb,b];Be.push([b[0]+nb[0]*Vb*.5,b[1]+nb[1]*Vb*.5]);f.push(Be);const Wb=[];Wb.push([Ob[0]-nb[0]*Ae,Ob[1]-nb[1]*Ae]);Wb.push([Ob[0]+nb[0]*Vb*.375,Ob[1]+nb[1]*Vb*.375]);w.setId(Wb[Wb.length-1],1);Wb.push([Ob[0]+nb[0]*Vb*
.75,Ob[1]+nb[1]*Vb*.75]);f.push(Wb);f.push([Nb,Dd]);break;case C.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const Dc=this._cp2(e,3,0),kd=this._cp3(e,Dc,.5,-1),lc=this._sub(kd,Dc);this._normalize(lc);const Zd=this._crossProduct(lc,this._sub(kd,b));this._leftPerpendicular(lc);this._addAngledTicks(f,b,Dc,kd);this._addAngledTicks(f,this._mix(b,1,lc,Zd),this._mix(Dc,1,lc,Zd),this._mid(b,Dc));break;case C.GeometricEffectControlMeasureLineRule.Parallel:const Ec=this._cp2(e,3,0),Te=this._cp3(e,
Ec,.5,-1),Gd=this._sub(Ec,b);this._normalize(Gd);const Wc=this._leftPerp(Gd),Xc=this._crossProduct(Gd,this._sub(Te,b));let Ac=[b,Ec];f.push(Ac);Ac=[];Ac.push([b[0]+Wc[0]*Xc,b[1]+Wc[1]*Xc]);Ac.push([Ec[0]+Wc[0]*Xc,Ec[1]+Wc[1]*Xc]);f.push(Ac);break;case C.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const wd=this._cp2(e,3,0),df=this._cp3(e,wd,.5,-1),Oc=this._mid(b,wd),Jb=this._sub(wd,b);this._normalize(Jb);const Pc=this._crossProduct(Jb,this._sub(df,b));this._leftPerpendicular(Jb);
const pd=[];pd.push([Oc[0]-Jb[0]*Pc*.25,Oc[1]-Jb[1]*Pc*.25]);pd.push([Oc[0]+Jb[0]*Pc*1.25,Oc[1]+Jb[1]*Pc*1.25]);f.push(pd);break;case C.GeometricEffectControlMeasureLineRule.ParallelOffset:const Ub=this._cp2(e,3,0),Ue=this._cp3(e,Ub,.5,-1),lb=this._sub(Ub,b);this._normalize(lb);const Bb=this._crossProduct(lb,this._sub(Ue,b));this._leftPerpendicular(lb);const Hd=[];Hd.push([b[0]-lb[0]*Bb,b[1]-lb[1]*Bb]);Hd.push([Ub[0]-lb[0]*Bb,Ub[1]-lb[1]*Bb]);f.push(Hd);const Id=[];Id.push([b[0]+lb[0]*Bb,b[1]+lb[1]*
Bb]);Id.push([Ub[0]+lb[0]*Bb,Ub[1]+lb[1]*Bb]);f.push(Id);break;case C.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Nc=this._cp2(e,3,0),Ne=this._cp3(e,Nc,.5,-1),Qb=this._sub(Nc,b);this._normalize(Qb);const Yc=this._crossProduct(Qb,this._sub(Ne,b));this._leftPerpendicular(Qb);const Jd=[];Jd.push([b[0]-Qb[0]*Yc,b[1]-Qb[1]*Yc]);Jd.push([Nc[0]-Qb[0]*Yc,Nc[1]-Qb[1]*Yc]);f.push(Jd);break;case C.GeometricEffectControlMeasureLineRule.OffsetSame:const Zc=this._cp2(e,3,0),lf=this._cp3(e,Zc,.5,
-1),Rb=this._sub(Zc,b);this._normalize(Rb);const $c=this._crossProduct(Rb,this._sub(lf,b));this._leftPerpendicular(Rb);const Kd=[];Kd.push([b[0]+Rb[0]*$c,b[1]+Rb[1]*$c]);Kd.push([Zc[0]+Rb[0]*$c,Zc[1]+Rb[1]*$c]);f.push(Kd);break;case C.GeometricEffectControlMeasureLineRule.CircleWithArc:let Db=this._cp2(e,3,0);const Ad=this._cp3(e,Db,.5,-1);let Xb,ad;if(4<=l)Xb=e[3],ad=0<this._crossProduct(this._sub(Xb,Db),this._sub(Ad,Db));else{Xb=Db;ad=0<this._crossProduct(this._sub(Xb,b),this._sub(Ad,b));const Ja=
24*this._geomUnitsPerPoint,Wa=this._sub(Xb,b);this._normalize(Wa,Ja);const ab=Math.sqrt(2)/2;this._rotateDirect(Wa,ab,ad?ab:-ab);Db=this._add(b,Wa)}const Ee=this._sub(Db,b),ne=Math.cos(Math.PI/18),af=Math.sin(Math.PI/18),yc=[Db];for(let Ja=1;36>=Ja;Ja++)this._rotateDirect(Ee,ne,af),yc.push(this._add(b,Ee));this._add90DegArc(yc,Db,Xb,Ad,ad);w.setId(yc[yc.length-8],1);f.push(yc);break;case C.GeometricEffectControlMeasureLineRule.DoubleJog:let qb=this._cp2(e,-3,1),Ab;Ab=3<=l?e[2]:this._add(b,this._sub(b,
qb));let ob;if(4<=l)ob=e[3];else{const Ja=b;b=qb;ob=Ab;const Wa=this._dist(b,Ja),ab=this._dist(ob,Ja);let xb=30*this._geomUnitsPerPoint;.5*Wa<xb&&(xb=.5*Wa);.5*ab<xb&&(xb=.5*ab);qb=this._mix(b,xb/Wa,Ja,(Wa-xb)/Wa);Ab=this._mix(ob,xb/ab,Ja,(ab-xb)/ab)}const ye=this._mid(b,qb),xe=this._mid(ob,Ab),ff=this._dist(b,qb),mf=this._dist(Ab,ob);let vc=Math.min(ff,mf)/8;vc=Math.min(vc,24*this._geomUnitsPerPoint);const ub=Math.cos(Math.PI/4);let cb=this._sub(b,qb);this._normalize(cb,vc);0<this._crossProduct(cb,
this._sub(ob,qb))?this._rotateDirect(cb,ub,-ub):this._rotateDirect(cb,ub,ub);let kb=[];kb.push(qb);kb.push(this._add(ye,cb));kb.push(this._sub(ye,cb));kb.push(b);f.push(kb);cb=this._sub(ob,Ab);this._normalize(cb,vc);0>this._crossProduct(cb,this._sub(b,Ab))?this._rotateDirect(cb,ub,ub):this._rotateDirect(cb,ub,-ub);kb=[];kb.push(Ab);kb.push(this._add(xe,cb));kb.push(this._sub(xe,cb));kb.push(ob);f.push(kb);break;case C.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Gc=this._cp2(e,
-4,1),Od=this._cp3(e,Gc,.882353,-1.94),Zb=this._sub(Od,Gc);0<this._crossProduct(Zb,this._sub(b,Gc))?this._rightPerpendicular(Zb):this._leftPerpendicular(Zb);const Ge=[Zb[0]/8,Zb[1]/8],He=this._sub(this._mid(Gc,Od),Ge);f.push([He,b]);break;case C.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Hc=this._arrowPath(e),Ic=[];let Pd=Hc.length-2;for(;Pd--;)Ic.push(Hc[Pd]);f.push(Ic);break;case C.GeometricEffectControlMeasureLineRule.MultivertexArrow:const Ie=this._arrowPath(e),Rd=[];
this._addArrow(Rd,Ie,!1);f.push(Rd);break;case C.GeometricEffectControlMeasureLineRule.CrossedArrow:const bf=this._arrowPath(e),ue=[];this._addArrow(ue,bf,!0);f.push(ue);break;case C.GeometricEffectControlMeasureLineRule.ChevronArrow:const [vd,zc]=this._arrowLastSeg(e),Qc=10*this._geomUnitsPerPoint,Cb=this._sub(b,vd);this._normalize(Cb);const ve=this._crossProduct(Cb,this._sub(zc,vd)),yd=this._leftPerp(Cb),zd=[zc[0]-yd[0]*ve*2,zc[1]-yd[1]*ve*2],Uc=[];Uc.push([zc[0]+Cb[0]*Qc,zc[1]+Cb[1]*Qc]);Uc.push(b);
Uc.push([zd[0]+Cb[0]*Qc,zd[1]+Cb[1]*Qc]);f.push(Uc);break;case C.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [ze,Bd]=this._arrowLastSeg(e),rb=this._sub(b,ze);this._normalize(rb);const Tb=this._crossProduct(rb,this._sub(Bd,ze));this._leftPerpendicular(rb);const bc=[Bd[0]-rb[0]*Tb,Bd[1]-rb[1]*Tb],Lc=[];Lc.push([bc[0]+rb[0]*Tb*.5,bc[1]+rb[1]*Tb*.5]);Lc.push(this._mid(bc,b));Lc.push([bc[0]-rb[0]*Tb*.5,bc[1]-rb[1]*Tb*.5]);f.push(Lc);break;case C.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [Cd,
Ed]=this._arrowLastSeg(e),Cc=this._sub(b,Cd);this._normalize(Cc);const Nd=this._crossProduct(Cc,this._sub(Ed,Cd));this._leftPerpendicular(Cc);f.push([Cd,[Ed[0]-Cc[0]*Nd,Ed[1]-Cc[1]*Nd]]);break;case C.GeometricEffectControlMeasureLineRule.Arch:const Fd=this._cp2(e,0,-1),Vc=this._cp3(e,Fd,.5,1),Ce=this._sub(b,Fd),gf=this._mix(Vc,1,Ce,.55),hf=this._mix(Vc,1,Ce,-.55),ld=[b];this._addBezier2(ld,b,gf,Vc,4);this._addBezier2(ld,Vc,hf,Fd,4);f.push(ld);break;case C.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const wb=
this._cp2(e,-4,1),hc=this._cp3(e,wb,.882353,-1.94),Pb=this._sub(hc,wb);0<this._crossProduct(Pb,this._sub(b,wb))?this._rightPerpendicular(Pb):this._leftPerpendicular(Pb);const od=[Pb[0]/8,Pb[1]/8],De=this._sub(this._mid(wb,hc),od),jf=this._sub(this._mix(wb,.75,hc,.25),od),kf=this._sub(this._mix(wb,.25,hc,.75),od),Rc=[wb];this._addBezier2(Rc,wb,jf,De,3);this._addBezier2(Rc,De,kf,hc,3);f.push(Rc);for(let Ja=0;8>Ja;Ja++){const Wa=Rc[2*Ja+1],ab=[this._clone(Wa)];ab.push(this._add(Wa,[Pb[0]/4,Pb[1]/4]));
f.push(ab)}break;case C.GeometricEffectControlMeasureLineRule.Arc90Degrees:const xd=this._cp2(e,0,-1),ef=this._cp3(e,xd,.5,1),fe=[xd];this._add90DegArc(fe,xd,b,ef);f.push(fe);break;default:f.push(e)}}return f}}g.EffectControlMeasureLine=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=
new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends x.PathEffectCursor{constructor(m,k,f){super(m,!0,!0);this._curveHelper=new w.CurveHelper;this._beginCut=(void 0!==k.beginCut?k.beginCut:1)*f;this._endCut=(void 0!==k.endCut?k.endCut:1)*f;this._middleCut=(void 0!==k.middleCut?k.middleCut:0)*f;this._invert=void 0!==k.invert?k.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(m){const {_beginCut:k,
_endCut:f,_middleCut:e}=this,l=m.pathLength(),b=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===k&&0===f&&0===e)for(b.startPath();m.nextPoint();)b.pushXY(m.x,m.y);else k+f+e<l&&(0===e?this._curveHelper.appendSubCurve(b,m,k,l-f):(this._curveHelper.appendSubCurve(b,m,k,.5*(l-e)),this._curveHelper.appendSubCurve(b,m,.5*(l+e),l-f)));else if(0!==k||0!==f||0!==e)if(k+f+e>=l)for(b.startPath();m.nextPoint();)b.pushXY(m.x,m.y);else this._curveHelper.appendSubCurve(b,
m,0,k),this._curveHelper.appendSubCurve(b,m,.5*(l-e),.5*(l+e)),this._curveHelper.appendSubCurve(b,m,l-f,f);return 0===b.totalSize?null:b}}g.EffectCut=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker".split(" "),function(g,q,x,w,C,r){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(f,
e,l,b,p){return new k(f,e,l)}}m.instance=null;class k extends w.PathEffectCursor{constructor(f,e,l){super(f,!0,!0);this._firstCurve=null;this._walker=new r.GeometryWalker;this._walker.updateTolerance(l);this._endings=e.lineDashEnding;this._customDashPos=-(e.offsetAlongLine??0)*l;this._offsetAtEnd=(e.customEndingOffset??0)*l;this._pattern=new r.DashPattern;this._pattern.init(e.dashTemplate,!0);this._pattern.scale(l)}processPath(f){if(0===this._pattern.length())return this.iteratePath=!1,f=x.collectPath(f),
q.GeometryCursor.fromJSONCIM({paths:[f]});if(!this.iteratePath){var e=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case C.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case C.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case C.LineDashEnding.NoConstraint:this.isClosed||(e=!1);break;case C.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var l=
f.pathLength();if(this._pattern.isEmpty()||l<.1*this._pattern.length()||!this._walker.init(f,this._pattern,e))return f=x.collectPath(f),q.GeometryCursor.fromJSONCIM({paths:[f]})}if(this.iteratePath)f=this._pattern.nextValue();else{switch(this._endings){default:e=.5*this._pattern.firstValue();break;case C.LineDashEnding.HalfGap:e=.5*-this._pattern.lastValue();break;case C.LineDashEnding.FullGap:e=-this._pattern.lastValue();break;case C.LineDashEnding.FullPattern:e=0;break;case C.LineDashEnding.NoConstraint:case C.LineDashEnding.Custom:e=
-this._customDashPos}f=e/this._pattern.length();f-=Math.floor(f);e=f*this._pattern.length();this._pattern.reset();f=this._pattern.nextValue();for(l=!1;e>=f;)e-=f,f=this._pattern.nextValue(),l=!l;f-=e;l?(this._walker.nextPosition(f),f=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(f),f=this._pattern.nextValue(),this._walker.nextPosition(f),f=this._pattern.nextValue())}if(e=this._walker.nextCurve(f))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)e.pushXY(this._firstCurve.x,
this._firstCurve.y);this._firstCurve=null}}else f=this._pattern.nextValue(),!this._walker.nextPosition(f)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(e.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,e=this._firstCurve,this._firstCurve=null;e?.reset();return e}}g.EffectDashes=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor",
"./CurveHelper"],function(g,q,x){class w{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(k,f,e=!0){this._setEmpty();if(!k||0===k.length)return!1;for(let l=0;l<k.length;l++){let b=Math.abs(k[l]);e&&1E-7>b&&(b=1E-7);this._values.push(b);this._length+=b}f&&k.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(k){const f=
this._values?this._values.length:0;for(let e=0;e<f;++e)this._values[e]*=k;this._length*=k;this.extPtGap*=k;this.ctrlPtGap*=k}addValue(k){this._length+=k;this._values.push(k)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=
this._length=0;this._currentValue=-1;this._values.length=0}}class C{constructor(){this.pt=null;this.sa=this.ca=0}}g.EndType=void 0;(function(k){k[k.FAIL=0]="FAIL";k[k.END=1]="END";k[k.CONTINUE=2]="CONTINUE"})(g.EndType||(g.EndType={}));class r{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(k){k.segment=this.segment;k.segmentLength=this.segmentLength;k.abscissa=this.abscissa;k.isPathEnd=
this.isPathEnd;k.isPartEnd=this.isPartEnd}}class m extends x.CurveHelper{constructor(k=0,f=!1){super(k,f);this._tolerance=x.pixelTolerance;this._currentPosition=new r}updateTolerance(k){this._tolerance=x.pixelTolerance*k}init(k,f,e=!0){e?(this._patternLength=f.length(),this._partExtPtGap=f.extPtGap,this._partCtrlPtGap=f.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=k;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(k,
f=g.EndType.FAIL){const e=new r;if(!this._nextPosition(k,e,null,f))return!1;e.copyTo(this._currentPosition);return!0}curPointAndAngle(k){k.pt=this._getPoint(this._currentPosition);const [f,e]=this._getAngleCS(this._currentPosition);k.ca=f;k.sa=e}nextPointAndAngle(k,f,e=g.EndType.FAIL){const l=new r;if(!this._nextPosition(k,l,null,e))return!1;l.copyTo(this._currentPosition);f.pt=this._getPoint(l);const [b,p]=this._getAngleCS(l);f.ca=b;f.sa=p;return!0}nextCurve(k){if(0===k)return null;const f=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
f.startPath();f.nextPath();const e=new r;if(!this._nextPosition(k,e,f,g.EndType.END))return null;e.copyTo(this._currentPosition);return f}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(k){this._pathCursor.seekInPath(k);return[this._pathCursor.x,this._pathCursor.y]}getSeg(k){const f=this.getPt(k);k=this.getPt(k+1);return[f,k]}_nextPosition(k,f,e,l){if(this._currentPosition.isPathEnd)return!1;var b=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(b/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(f);f.abscissa+k*this._partLengthRatio>f.segmentLength+this._tolerance;)if(e&&(0===e.pathSize&&(0===b?(b=f.segment[0],e.pushXY(b[0],b[1])):e.pushPoint(this.getSegCoord2D(f.segment,b))),b=f.segment[1],e.pushXY(b[0],b[1])),b=0,k-=(f.segmentLength-f.abscissa)/this._partLengthRatio,this._partSegCount)f.segment=this._nextSegment(),f.segmentLength=this.getSegLength(f.segment),f.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(l===
g.EndType.FAIL)return!1;f.segmentLength=this.getSegLength(f.segment);f.isPartEnd=!0;l===g.EndType.END?(f.abscissa=f.segmentLength,f.isPathEnd=!0):f.abscissa=f.segmentLength+k;return!0}this._currentPosition.copyTo(f)}f.abscissa+=k*this._partLengthRatio;e&&(0===e.pathSize&&(0===b?e.pushPoint(f.segment[0]):e.pushPoint(this.getSegCoord2D(f.segment,b))),k=f.abscissa/f.segmentLength,1===k?e.pushPoint(f.segment[1]):e.pushPoint(this.getSegCoord2D(f.segment,k)));!this._partSegCount&&Math.abs(f.abscissa-f.segmentLength)<
this._tolerance&&(f.isPathEnd=this._partIsLast,f.isPartEnd=!0);return!0}_getPoint(k){return this.getSegCoord2D(this._currentPosition.segment,0>=k.segmentLength?0:k.abscissa/k.segmentLength)}_getAngleCS(k){return this.getSegAngleCS(this._currentPosition.segment,0>=k.segmentLength?0:k.abscissa/k.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=
0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var k=this._partSegCount;k;)this._previousSegment(),--k;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=
!1;--this._partSegCount;k=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(k);k=k+this._partSegCount+1;k>=this._pathCursor.pathSize&&(k=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(k);if(0<this._patternLength){k=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const f=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let e=Math.round((this._partLength-(k+f))/this._patternLength);0>=e&&(e=0<k+f?0:1);this._partLengthRatio=this._partLength/(k+f+e*
this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}g.DashPattern=w;g.GeometryWalker=m;g.Pos=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),
function(g,q,x,w,C,r){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(f,e,l,b,p,c){return new k(f,e,l,b,p,c)}}m.instance=null;class k{constructor(f,e,l,b,p,c){this._inputGeometries=f;this._tileKey=b;this._geometryEngine=p;this._maxInflateSize=c*l;this._width=(void 0!==e.width?e.width:2)*l;this._option=e.option}next(){for(var f;f=this._inputGeometries.next();){if("esriGeometryEnvelope"===f.geometryType&&0<this._width){var e=f.asJSON();return 0>Math.min(e.xmax-
e.xmin,e.ymax-e.ymin)-2*this._width?f:x.GeometryCursor.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===f.geometryType){if(0===this._width)return f.clone();var l=this._geometryEngine;if(null==l)break;if(f=this._tileKey?
w.clipCursorToTileExtent(f,this._maxInflateSize):f.clone()){if(l=l.buffer(r.WebMercator,f.asJSON(),-this._width,1))for(e of l.rings)e&&f.pushPath(e.reverse());return f}}}return null}}g.EffectDonut=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,
k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends x.PathEffectCursor{constructor(m,k,f){super(m,!1,!0);this._curveHelper=new w.CurveHelper;this._length=(void 0!==k.length?k.length:20)*f;this._angle=void 0!==k.angle?k.angle:225;this._position=void 0!==k.position?k.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(m){const k=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(m))return null;m.seekInPath(0);const f=m.x,e=m.y;m.seekInPath(m.pathSize-1);const l=m.x;m=m.y;this._curveHelper.normalize([l-f,m-e]);const b=f+(l-f)*this._position/100,p=e+(m-e)*this._position/100,c=Math.cos((90-this._angle)/180*Math.PI);let d=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(d=-d);this._mirror=!this._mirror;k.pushPath([[f,e],[b-this._length/2*c,p-this._length/2*d],[b+this._length/2*c,p+this._length/2*d],[l,m]]);return k}}g.EffectJog=C;Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(g){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(w,C,r,m,k){return new x(w,C,r)}}q.instance=null;class x{constructor(w,C,r){this._inputGeometries=w;this._offsetX=void 0!==C.offsetX?C.offsetX*r:0;this._offsetY=void 0!==C.offsetY?C.offsetY*r:0}next(){let w=this._inputGeometries.next();for(;w;){if(0<w.totalSize)return this._move(w.clone(),this._offsetX,
this._offsetY);w=this._inputGeometries.next()}return null}_move(w,C,r){for(;w.nextPath();)for(;w.nextPoint();)w.x+=C,w.y+=r;w.reset();return w}}g.EffectMove=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(g,q,x,w,C,r,m,k,f){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(b,p,c,d,a,n){return new l(b,p,c,d,a,n)}}e.instance=null;class l{constructor(b,p,c,d,a,n){this._inputGeometries=b;this._tileKey=d;this._geometryEngine=a;this._curveHelper=new m.CurveHelper;this._offset=(p.offset??1)*c;this._method=p.method;this._maxInflateSize=n*c;this._option=p.option;this._offsetFlattenError=m.pixelTolerance*c}next(){for(var b;b=this._inputGeometries.next();){if(0===
this._offset)return b.clone();if("esriGeometryEnvelope"===b.geometryType){if(this._method===k.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var p=w.collectPath(b);if(p=this._curveHelper.offset(p,-this._offset,this._method,4,this._offsetFlattenError))return b=x.GeometryCursor.createEmptyOptimizedCIM(b.geometryType),b.pushPath(p),b;break}p=b.asJSON();if(C.isExtent(p)&&0<Math.min(p.xmax-p.xmin,p.ymax-p.ymin)+2*this._offset)return x.GeometryCursor.fromJSONCIM({xmin:p.xmin-this._offset,xmax:p.xmax+
this._offset,ymin:p.ymin-this._offset,ymax:p.ymax+this._offset})}p=this._geometryEngine;if(null!=p&&(b=this._tileKey?r.clipCursorToTileExtent(b,this._maxInflateSize):b.clone()))return(b=p.offset(f.WebMercator,b.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?x.GeometryCursor.fromJSONCIM(b):null}return null}}g.EffectOffset=e;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(g){class q{static local(){null===
q.instance&&(q.instance=new q);return q.instance}execute(w,C,r,m,k){return new x(w,C,r)}}q.instance=null;class x{constructor(w,C,r){this._inputGeometries=w;this._reverse=void 0!==C.reverse?C.reverse:!0}next(){for(var w=this._inputGeometries.next();w;){if(!this._reverse)return w;if("esriGeometryPolyline"===w.geometryType){for(w=w.clone();w.nextPath();)for(let C=0;C<w.pathSize/2;C++){w.seekInPath(C);const r=w.x,m=w.y;w.seekInPath(w.pathSize-C-1);const k=w.x,f=w.y;w.x=r;w.y=m;w.seekInPath(C);w.x=k;w.y=
f}w.reset();return w}w=this._inputGeometries.next()}return null}}g.EffectReverse=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(g,q){class x{static local(){null===x.instance&&(x.instance=new x);return x.instance}execute(C,r,m,k,f){return new w(C,r,m)}}x.instance=null;class w{constructor(C,r,m){this._inputGeometries=C;this._rotateAngle=void 0!==r.angle?r.angle*Math.PI/
180:0}next(){let C=this._inputGeometries.next();for(;C;){if(0===this._rotateAngle||"esriGeometryPoint"===C.geometryType)return C;if(0<C.totalSize){var r=q.getCursorBoundsXY(C);const m=(r[2]+r[0])/2;r=(r[3]+r[1])/2;C.reset();return this._rotate(C.clone(),m,r)}C=this._inputGeometries.next()}return null}_rotate(C,r,m){const k=Math.cos(this._rotateAngle),f=Math.sin(this._rotateAngle);for(;C.nextPath();)for(;C.nextPoint();){const e=C.x-r,l=C.y-m;C.x=r+e*k-l*f;C.y=m+e*f+l*k}C.reset();return C}}g.EffectRotate=
x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(g,q){class x{static local(){null===x.instance&&(x.instance=new x);return x.instance}execute(C,r,m,k,f){return new w(C,r,m)}}x.instance=null;class w{constructor(C,r,m){this._inputGeometries=C;this._xFactor=void 0!==r.XScaleFactor?r.XScaleFactor:1.15;this._yFactor=void 0!==r.YScaleFactor?r.YScaleFactor:1.15}next(){const C=
this._inputGeometries.next();if(C){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===C.geometryType)return C;if(0<C.totalSize){var r=q.getCursorBoundsXY(C);const m=(r[2]+r[0])/2;r=(r[3]+r[1])/2;C.reset();return this._scaleCursor(C.clone(),m,r)}}return null}_scaleCursor(C,r,m){for(;C.nextPath();)for(;C.nextPoint();)C.x=r+(C.x-r)*this._xFactor,C.y=m+(C.y-m)*this._yFactor;C.reset();return C}}g.EffectScale=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports",
"../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r{constructor(m,k,f){this._inputGeometries=m;this._height=(void 0!==k.amplitude?k.amplitude:2)*f;this._period=(void 0!==k.period?k.period:3)*f;this._style=k.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));
this._pattern=new w.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new w.GeometryWalker;this._walker.updateTolerance(f)}next(){for(var m=this._inputGeometries.next();m;){if(0===this._height||0===this._period||(m=this._processGeom(m)))return m;m=this._inputGeometries.next()}return null}_processGeom(m){const k=q.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(;m.nextPath();){k.startPath();const f=m.pathLength();if(this._walker.init(m,this._pattern))switch(this._style){default:this._constructCurve(k,
f,!1);break;case x.GeometricEffectWaveform.Square:this._constructSquare(k,f);break;case x.GeometricEffectWaveform.Triangle:this._constructTriangle(k,f);break;case x.GeometricEffectWaveform.Random:this._constructCurve(k,f,!0)}else for(;m.nextPoint();)k.pushXY(m.x,m.y)}return k}_constructCurve(m,k,f){var e=Math.round(k/this._period);0===e&&(e=1);const l=this._period/16,b=1/(16*e+1);k=2*Math.PI*k/(k/e);e=2*Math.PI*Math.random();const p=2*Math.PI*Math.random(),c=2*Math.PI*Math.random(),d=.75-Math.random()/
2,a=.75-Math.random()/2,n=new w.Pos;this._walker.curPointAndAngle(n);m.pushPoint(n.pt);let t=0;for(;;)if(this._walker.nextPointAndAngle(l,n)){const v=t;t+=b;let y;if(f){const h=this._height/2*(1+.3*Math.sin(d*k*v+e));y=h*Math.sin(k*v+p);y+=h*Math.sin(a*k*v+c);y/=2}else y=.5*this._height*Math.sin(.5*k*v);m.pushXY(n.pt[0]-y*n.sa,n.pt[1]+y*n.ca)}else{m.pushPoint(this._walker.getPathEnd());break}}_constructSquare(m,k){Math.round(k/this._period);for(k=!0;;){let f=!1;if(this._walker.curPositionIsValid()){const e=
new w.Pos;this._walker.curPointAndAngle(e);const l=new w.Pos;if(this._walker.nextPointAndAngle(this._period,l)){const b=new w.Pos;this._walker.nextPointAndAngle(this._period,b)&&(k?(m.pushPoint(e.pt),k=!1):m.pushPoint(e.pt),m.pushXY(e.pt[0]-this._height/2*e.sa,e.pt[1]+this._height/2*e.ca),m.pushXY(l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca),m.pushXY(l.pt[0]+this._height/2*l.sa,l.pt[1]-this._height/2*l.ca),m.pushXY(b.pt[0]+this._height/2*b.sa,b.pt[1]-this._height/2*b.ca),f=!0)}}if(!f){m.pushPoint(this._walker.getPathEnd());
break}}}_constructTriangle(m,k){Math.round(k/this._period);for(k=!0;;){let f=!1;if(this._walker.curPositionIsValid()){const e=new w.Pos;this._walker.curPointAndAngle(e);const l=new w.Pos;if(this._walker.nextPointAndAngle(this._period/2,l)){const b=new w.Pos;this._walker.nextPointAndAngle(this._period,b)&&(this._walker.nextPosition(this._period/2)&&(k?(m.pushPoint(e.pt),k=!1):m.pushPoint(e.pt),m.pushXY(l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca),m.pushXY(b.pt[0]+this._height/2*b.sa,b.pt[1]-
this._height/2*b.ca)),f=!0)}}if(!f){m.pushPoint(this._walker.getPathEnd());break}}}}g.EffectWave=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends q.PathTransformationCursor{constructor(m,
k,f){super(m);this._geometryWalker=new w.GeometryWalker;this._geometryWalker.updateTolerance(f);this._angleToLine=k.angleToLine??!0;this._offset=(k.offset?k.offset:0)*f;this._originalEndings=k.endings;this._offsetAtEnd=(k.customEndingOffset?k.customEndingOffset:0)*f;this._position=-(k.offsetAlongLine?k.offsetAlongLine:0)*f;this._pattern=new w.DashPattern;this._pattern.init(k.placementTemplate,!1);this._pattern.scale(f);this._endings=this._originalEndings}processPath(m){if(this._pattern.isEmpty())return null;
if(this.iteratePath)var k=this._pattern.nextValue();else{this._endings=this._originalEndings===x.PlacementEndings.WithFullGap&&this.isClosed?x.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let f=!0;switch(this._endings){case x.PlacementEndings.NoConstraint:k=-this._position;k=this._adjustPosition(k);f=!1;break;default:k=-this._pattern.lastValue()/2;break;case x.PlacementEndings.WithFullGap:k=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();
break;case x.PlacementEndings.WithMarkers:k=0;break;case x.PlacementEndings.Custom:k=-this._position,k=this._adjustPosition(k),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(m,this._pattern,f))return null;this._pattern.reset();for(m=0;k>m;)k-=m,m=this._pattern.nextValue();k=m-k;this.iteratePath=!0}m=new w.Pos;if(!this._geometryWalker.nextPointAndAngle(k,m)||this._endings===x.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===
x.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(m.pt[0]-this._offset*m.sa,m.pt[1]+this._offset*m.ca);this._angleToLine&&this.internalPlacement.setRotateCS(m.ca,m.sa);return this.internalPlacement}_adjustPosition(m){m/=this._pattern.length();m-=Math.floor(m);return m*this._pattern.length()}}g.PlacementAlongLineSameSize=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends q.PathTransformationCursor{constructor(m,k,f){super(m,!1,!0);this._curveHelper=new x.CurveHelper;this._angleToLine=void 0!==k.angleToLine?k.angleToLine:!0;this._offset=void 0!==k.offset?k.offset*f:0;this._type=k.extremityPlacement;this._position=void 0!==k.offsetAlongLine?k.offsetAlongLine*
f:0;this._beginProcessed=!1}processPath(m){let k;switch(this._type){default:this._beginProcessed?(k=this._atExtremities(m,this._position,!1),this.iteratePath=this._beginProcessed=!1):(k=this._atExtremities(m,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case w.ExtremityPlacement.JustBegin:k=this._atExtremities(m,this._position,!0);break;case w.ExtremityPlacement.JustEnd:k=this._atExtremities(m,this._position,!1);case w.ExtremityPlacement.None:}return k}_atExtremities(m,k,f){f||
m.seekPathEnd();if(f?m.nextPoint():m.prevPoint()){let e=0,[l,b]=[0,0],[p,c]=[m.x,m.y];for(;f?m.nextPoint():m.prevPoint();){l=p;b=c;p=m.x;c=m.y;const d=this._curveHelper.getLength(l,b,p,c);if(e+d>k){m=(k-e)/d;const [a,n]=this._curveHelper.getAngleCS(l,b,p,c,m);m=this._curveHelper.getCoord2D(l,b,p,c,m);this.internalPlacement.setTranslate(m[0]-this._offset*n,m[1]+this._offset*a);this._angleToLine&&this.internalPlacement.setRotateCS(-a,-n);return this.internalPlacement}e+=d}}return null}}g.PlacementAtExtremities=
C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(g,q,x){class w{static local(){null===w.instance&&(w.instance=new w);return w.instance}execute(r,m,k,f,e){return new C(r,m,k)}}w.instance=null;class C extends q.PathTransformationCursor{constructor(r,m,k){super(r);this._walker=new x.GeometryWalker;this._walker.updateTolerance(k);this._angleToLine=void 0!==
m.angleToLine?m.angleToLine:!0;this._offset=void 0!==m.offset?m.offset*k:0;this._beginGap=void 0!==m.beginPosition?m.beginPosition*k:0;this._endGap=void 0!==m.endPosition?m.endPosition*k:0;this._flipFirst=void 0!==m.flipFirst?m.flipFirst:!0;this._pattern=new x.DashPattern;this._pattern.init(m.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(r){if(this._pattern.isEmpty())return null;if(this.iteratePath){r=this._pattern.nextValue()*
this._subPathLen;var m=this._beginGap+r;r=m-this._prevPos;this._prevPos=m}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=r.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(r,this._pattern,!1))return null;this._pattern.reset();r=this._pattern.nextValue()*this._subPathLen;m=this._beginGap+r;r=m-this._prevPos;this._prevPos=m;this.iteratePath=!0}m=new x.Pos;if(!this._walker.nextPointAndAngle(r,
m,x.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(m.pt[0]-this._offset*m.sa,m.pt[1]+this._offset*m.ca);r=this._isFirst&&this._flipFirst;let k;this._angleToLine?(k=m.ca,m=m.sa):(k=1,m=0);r&&(k=-k,m=-m);this.internalPlacement.setRotateCS(k,m);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}g.PlacementAtRatioPositions=w;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports",
"../../../core/RandomLCG","../CIMPlacements","../enums"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f,e,l)}}C.instance=null;class r{constructor(m,k,f,e,l){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(k.stepX??16)*f;this._stepY=Math.abs(k.stepY??16)*f;this._stepX=Math.round(128*
this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=k.gridType??w.PlacementGridType.Fixed;if(this._gridType===w.PlacementGridType.Random)this._randomLCG=new q(1*(k.seed??13)),this._randomness=(k.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=k.gridAngle??0;this._shiftOddRows=k.shiftOddRows??!1;this._offsetX=
(k.offsetX??0)*f;this._offsetY=(k.offsetY??0)*f;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=
this._graphicOriginX=0;if(null!=e){const [b,p,c,d]=e.split("/");k=parseFloat(b);f=parseFloat(p);e=parseFloat(c);this._graphicOriginX=512*-(parseFloat(d)*2**k+e);this._graphicOriginY=512*f;this._testInsidePolygon=!0}this._internalPlacement=new x.Placement;this._calculateMinMax(m);this._geometryCursor=m}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!r._randValues){r._randValues=[];for(let m=0;24>m;m++)for(let k=0;24>k;k++)r._randValues.push(this._randomLCG.getFloat()),
r._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(m){this._yMax=this._yMin=this._xMax=this._xMin=0;let k,f,e,l,b,p,c,d;k=f=c=b=Number.MAX_VALUE;e=l=d=p=-Number.MAX_VALUE;var a=1!==this._cosAngle;for(m.reset();m.nextPath();)for(;m.nextPoint();){var n=m.x;var t=m.y;var v=n-this._graphicOriginX-this._offsetX;var y=t-this._graphicOriginY-this._offsetY;if(a){var h=this._cosAngle*v-this._sinAngle*y;v=this._sinAngle*v+this._cosAngle*y}else h=v,v=y;k=Math.min(k,h);e=Math.max(e,h);f=Math.min(f,
v);l=Math.max(l,v);b=Math.min(b,t);p=Math.max(p,t);c=Math.min(c,n);d=Math.max(d,n)}b=b!==Number.MAX_VALUE?b:-512-this._stepY;p=p!==-Number.MAX_VALUE?p:this._stepY;c=c!==Number.MAX_VALUE?c:-this._stepX;d=d!==-Number.MAX_VALUE?d:512+this._stepX;this._polygonMin=(this._verticalSubdivision=p-b>=d-c)?b:c;if(this._testInsidePolygon){h=0-this._graphicOriginX-this._offsetX-this._stepX;t=512-this._graphicOriginX-this._offsetX+this._stepX;n=-512-this._graphicOriginY-this._offsetY-this._stepY;v=0-this._graphicOriginY-
this._offsetY+this._stepY;if(a){a=[[h,n],[h,v],[t,n],[t,v]];h=n=Number.MAX_VALUE;t=v=-Number.MAX_VALUE;for(const A of a)a=this._cosAngle*A[0]-this._sinAngle*A[1],y=this._sinAngle*A[0]+this._cosAngle*A[1],h=Math.min(h,a),t=Math.max(t,a),n=Math.min(n,y),v=Math.max(v,y)}k=k!==Number.MAX_VALUE?Math.max(k,h):h;f=f!==Number.MAX_VALUE?Math.max(f,n):n;e=e!==-Number.MAX_VALUE?Math.min(e,t):t;l=l!==-Number.MAX_VALUE?Math.min(l,v):v}this._xMin=Math.round(k/this._stepX);this._xMax=Math.round(e/this._stepX);this._yMin=
Math.round(f/this._stepY);this._yMax=Math.round(l/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(m,c,d,b,p)}_buildAccelerationMap(m,k,f,e,l){m.reset();const b=new Map,p=this._verticalSubdivision;f=p?l-e:f-k;l=Math.ceil(f/10);if(!(1>=l)){f=Math.floor(f/l);l++;this._delta=f;var c,d;if(p){l=-512-this._stepY;var a=this._stepY;var n=e}else l=-this._stepX,a=512+this._stepX,n=k;for(;m.nextPath();)if(!(2>m.pathSize)&&m.nextPoint()){var t=m.x;for(c=m.y;m.nextPoint();t=
k,c=e){k=m.x;e=m.y;if(p){if(c===e||c<l&&e<l||c>a&&e>a)continue;var v=Math.min(c,e);var y=Math.max(c,e)}else{if(t===k||t<l&&k<l||t>a&&k>a)continue;v=Math.min(t,k);y=Math.max(t,k)}for(;v<y;){var h=d=Math.floor((v-n)/f),A=t,E=c,z=k,F=e,D=b;let B=D.get(h);B||(B=[],D.set(h,B));B.push([[A,E],[z,F]]);v+=f}v=Math.floor((y-n)/f);v>d&&(y=k,h=e,A=b,E=A.get(v),E||(E=[],A.set(v,E)),E.push([[t,c],[y,h]]))}}this._accelerationMap=b}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>
this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var m=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(m+=.5*this._stepX);const k=this._currentY*this._stepY+this._offsetY;this._currentX++;let f;if(this._gridType===w.PlacementGridType.Random){const e=(this._currentX%24+24)%24,l=(this._currentY%24+24)%24;f=this._graphicOriginX+m+this._stepX*this._randomness*(.5-r._randValues[24*l+e])*2/3;m=this._graphicOriginY+k+
this._stepY*this._randomness*(.5-r._randValues[24*l+e+1])*2/3}else f=this._graphicOriginX+this._cosAngle*m+this._sinAngle*k,m=this._graphicOriginY-this._sinAngle*m+this._cosAngle*k;if(!this._testInsidePolygon||this._isInsidePolygon(f,m,this._geometryCursor))return this._internalPlacement.setTranslate(f,m),this._internalPlacement}}_isInsidePolygon(m,k,f){if(null==this._accelerationMap){var e=0,l;let c;m+=1E-6;k+=1E-6;for(f.reset();f.nextPath();)if(f.nextPoint()){var b=f.x;for(l=f.y;f.nextPoint();b=
p,l=c){var p=f.x;c=f.y;l>k!==c>k&&(0<(p-b)*(k-l)-(c-l)*(m-b)?e++:e--)}}return 0!==e}m+=1E-6;k+=1E-6;f=this._verticalSubdivision;l=this._accelerationMap.get(Math.floor(((f?k:m)-this._polygonMin)/this._delta));if(!l)return!1;b=0;for(e of l){l=e[0];p=e[1];if(f){if(l[1]>k===p[1]>k)continue;l=(p[0]-l[0])*(k-l[1])-(p[1]-l[1])*(m-l[0])}else{if(l[0]>m===p[0]>m)continue;l=(p[1]-l[1])*(m-l[0])-(p[0]-l[0])*(k-l[1])}0<l?b++:b--}return 0!==b}}g.PlacementInsidePolygon=C;Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(g,q,x,w){class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends q.PathTransformationCursor{constructor(m,k,f){super(m);this._curveHelper=new x.CurveHelper;this._angleToLine=void 0!==k.angleToLine?k.angleToLine:!0;this._offset=void 0!==k.offset?k.offset*f:0;
this._relativeTo=k.relativeTo;this._position=void 0!==k.startPointOffset?k.startPointOffset*f:0;this._epsilon=.001*f}processPath(m){var k=this._position;if(this._relativeTo===w.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(m.nextPoint()){let [f,e]=[m.x,m.y],[l,b]=[0,0];for(;m.nextPoint();){l=m.x;b=m.y;k=this._curveHelper.getLength(f,e,l,b);if(k<this._epsilon){f=l;e=b;continue}m=.5+this._position/k;const [p,c]=this._curveHelper.getAngleCS(f,e,l,b,m);m=this._curveHelper.getCoord2D(f,
e,l,b,m);this.internalPlacement.setTranslate(m[0]-this._offset*c,m[1]+this._offset*p);this._angleToLine&&this.internalPlacement.setRotateCS(p,c);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(m,k,this._relativeTo===w.PlacementOnLineRelativeTo.LineEnd)}onLine(m,k,f){let e=!1;switch(this._relativeTo){default:m.seekPathStart();k=m.pathLength()/2+k;break;case w.PlacementOnLineRelativeTo.LineBeginning:break;case w.PlacementOnLineRelativeTo.LineEnd:e=!0}f?m.seekPathEnd():
m.seekPathStart();let l=0;if(f?m.prevPoint():m.nextPoint()){let [b,p]=[m.x,m.y],[c,d]=[0,0];for(;f?m.prevPoint():m.nextPoint();){c=m.x;d=m.y;const a=this._curveHelper.getLength(b,p,c,d);if(l+a>k){m=(k-l)/a;const [n,t]=this._curveHelper.getAngleCS(b,p,c,d,m);m=this._curveHelper.getCoord2D(b,p,c,d,m);f=e?-this._offset:this._offset;this.internalPlacement.setTranslate(m[0]-f*t,m[1]+f*n);this._angleToLine&&(e?this.internalPlacement.setRotateCS(-n,-t):this.internalPlacement.setRotateCS(n,t));return this.internalPlacement}b=
c;p=d;l+=a}}return null}}g.PlacementOnLine=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(g,q,x){function w(m,k){const f=Math.PI;for(;Math.abs(k-m)>f+2E-15;)k=k-m>f?k-2*f:k+2*f;return(m+k)/2}class C{static local(){null===C.instance&&(C.instance=new C);return C.instance}execute(m,k,f,e,l){return new r(m,k,f)}}C.instance=null;class r extends q.PathTransformationCursor{constructor(m,
k,f){super(m);this._curveHelper=new x.CurveHelper;this._angleToLine=void 0!==k.angleToLine?k.angleToLine:!0;this._offset=void 0!==k.offset?k.offset*f:0;this._endPoints=void 0!==k.placeOnEndPoints?k.placeOnEndPoints:!0;this._controlPoints=void 0!==k.placeOnControlPoints?k.placeOnControlPoints:!0;this._regularVertices=void 0!==k.placeOnRegularVertices?k.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(m){this.iteratePath||(this._preparePath(m),this.iteratePath=!0);if(this._tagIterator>=
this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;m=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(m[2]);let k=m[0],f=m[1];if(0!==this._offset){const e=Math.cos(m[2]);k-=this._offset*Math.sin(m[2]);f+=this._offset*e}this.internalPlacement.setTranslate(k,f);this._tagIterator++;return this.internalPlacement}_preparePath(m){this._tagIterator=this._tags.length=0;m.seekPathStart();const k=m.isClosed();let f=0,e=!1,l=0,b=0;m.seekPathStart();
if(m.nextPoint()){let p=m.x,c=m.y,d=m.getControlPoint(),a=!0,n=m.nextPoint();for(;n;){const t=m.x,v=m.y,y=m.getControlPoint();if(this._angleToLine||0!==this._offset)l=this._curveHelper.getAngle(p,c,t,v,0);a?(a=!1,k?(f=l,e=d):(this._endPoints||this._controlPoints&&d)&&this._tags.push([p,c,l])):d?this._controlPoints&&this._tags.push([p,c,w(b,l)]):this._regularVertices&&this._tags.push([p,c,w(b,l)]);if(this._angleToLine||0!==this._offset)b=this._curveHelper.getAngle(p,c,t,v,1);(n=m.nextPoint())||(k?
y||e?this._controlPoints&&this._tags.push([t,v,w(b,f)]):this._regularVertices&&this._tags.push([t,v,w(b,f)]):(this._endPoints||this._controlPoints&&y)&&this._tags.push([t,v,b]));p=t;c=v;d=y}}this._tagIterator=0}}g.PlacementOnVertices=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(g,q,x,w,C,r){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(f,e,l,b,p){return new k(f,e,l)}}m.instance=null;class k{constructor(f,e,l){this._geometryCursor=f;this._offsetX=void 0!==e.offsetX?e.offsetX*l:0;this._offsetY=void 0!==e.offsetY?e.offsetY*l:0;this._method=void 0!==e.method?e.method:r.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new C.Placement}next(){const f=this._geometryCursor;this._geometryCursor=null;return f?this._polygonCenter(f):
null}_polygonCenter(f){let e=!1;switch(this._method){case r.PlacementPolygonCenterMethod.CenterOfMass:if(f=x.weightedAreaCentroid(f))this._internalPlacement.setTranslate(f[0]+this._offsetX,f[1]+this._offsetY),e=!0;break;case r.PlacementPolygonCenterMethod.BoundingBoxCenter:if(f=q.getCursorBoundsXY(f))this._internalPlacement.setTranslate((f[2]+f[0])/2+this._offsetX,(f[3]+f[1])/2+this._offsetY),e=!0;break;default:f=w.getLabelPoint(f),null!==f&&(this._internalPlacement.setTranslate(f[0]+this._offsetX,
f[1]+this._offsetY),e=!0)}return e?this._internalPlacement:null}}g.PlacementPolygonCenter=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),function(g,q,
x,w,C,r,m,k,f,e){function l(a,n){a.forEach(t=>C.transformMat2d(t,t,n));return{upperLeft:k.i1616to32(8*a[0][0],8*a[0][1]),upperRight:k.i1616to32(8*a[1][0],8*a[1][1]),lowerLeft:k.i1616to32(8*a[2][0],8*a[2][1]),lowerRight:k.i1616to32(8*a[3][0],8*a[3][1])}}const b=Math.PI/180;class p{constructor(a,n,t,v){this._rotationT=w.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const y=t.rect,h=new Float32Array(8);a*=v;n*=v;const A=t.code?y.width*v:t.metrics.width,E=t.code?
y.height*v:t.metrics.height;this.width=A;this.height=E;h[0]=a;h[1]=n;h[2]=a+A;h[3]=n;h[4]=a;h[5]=n+E;h[6]=a+A;h[7]=n+E;this._data=h;this._setTextureCoords(y);this._scale=v;this._mosaic=t;this.x=a;this.y=n;this.maxOffset=Math.max(a+A,n+E)}get mosaic(){return this._mosaic}set angle(a){this._angle=a;x.fromRotation(this._rotationT,-a);this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets(this._data);return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:y,width:h}=this._mosaic.metrics;var a=h*this._scale,n=Math.abs(y)*this._scale,t=new Float32Array(8);t[0]=this.x;t[1]=this.y;t[2]=this.x+a;t[3]=this.y;t[4]=this.x;t[5]=this.y+n;t[6]=this.x+a;t[7]=this.y+n;a=x.multiply(w.create(),this._rotationT,this._transform);w.transformMany(t,t,a);n=a=Infinity;let A=0;var v=0;
for(let E=0;4>E;E++){const z=t[2*E],F=t[2*E+1];a=Math.min(a,z);n=Math.min(n,F);A=Math.max(A,z);v=Math.max(v,F)}t=A-a;v-=n;this._bounds=new e(a+t/2,n+v/2,t,v)}return this._bounds}setTransform(a){this._transform=a;this._offsets=null}_setOffsets(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const n=this._offsets,t=new Float32Array(8),v=x.multiply(w.create(),this._rotationT,this._transform);w.transformMany(t,a,v);n.upperLeft=k.i1616to32(8*t[0],8*t[1]);n.upperRight=
k.i1616to32(8*t[2],8*t[3]);n.lowerLeft=k.i1616to32(8*t[4],8*t[5]);n.lowerRight=k.i1616to32(8*t[6],8*t[7])}_setTextureCoords({x:a,y:n,width:t,height:v}){this._texcoords={upperLeft:k.i1616to32(a,n),upperRight:k.i1616to32(a+t,n),lowerLeft:k.i1616to32(a,n+v),lowerRight:k.i1616to32(a+t,n+v)}}}class c{constructor(a,n,t){this._rotation=0;this._decorate(a,n,t);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<n.length;this._hasRotation=0!==t.angle;this._transform=this._createGlyphTransform(this.bounds,
t);if((this._borderLineSize=t.borderLineSize)||t.hasBackground)[this.bounds,this.background]=this.shapeBackground(this._transform);for(const v of a)v.setTransform(this._transform)}setRotation(a){if(0!==a||0!==this._rotation){this._rotation=a;var n=this._transform;a=x.fromRotation(w.create(),a);x.multiply(n,a,n);for(const t of this.glyphs)t.setTransform(this._transform)}}_decorate(a,n,t){if(t.decoration&&"none"!==t.decoration&&a.length){var v=t.scale;t="underline"===t.decoration?30:20;var y=a[0].textureBinding;
for(const z of n){const F=z.startX*v,D=z.startY*v;n=a;var h=n.push;var A=(z.width+z.glyphWidthEnd)*v;var E=y;A={code:0,page:0,sdf:!0,rect:new f(0,0,11,8),textureBinding:E,metrics:{advance:0,height:4,width:A,left:0,top:0}};h.call(n,new p(F,D+t*v,A,1))}}}shapeBackground(a){const {xmin:n,ymin:t,xmax:v,ymax:y,x:h,y:A,width:E,height:z}=this.bounds;var F=Math.min(E,z)+16-1.5;F=(1.5+Math.min(q.pt2px(this._borderLineSize||0),F))/2;var D=this._borderLineSize?F:0;const B=[n-8,t-8],u=[v+8,t-8],H=[n-8,y+8],G=
[v+8,y+8],I=l([[B[0]-F,B[1]-F],[u[0]+F,u[1]-F],[B[0]+D,B[1]+D],[u[0]-D,u[1]+D]],a),J=l([[H[0]+D,H[1]-D],[G[0]-D,G[1]-D],[H[0]-F,H[1]+F],[G[0]+F,G[1]+F]],a),M=l([[B[0]-F,B[1]-F],[B[0]+D,B[1]+D],[H[0]-F,H[1]+F],[H[0]+D,H[1]-D]],a);D=l([[u[0]-D,u[1]+D],[u[0]+F,u[1]-F],[G[0]-D,G[1]-D],[G[0]+F,G[1]+F]],a);a={main:l([B,u,H,G],a),top:I,bot:J,left:M,right:D};return[new e(h,A,E+2*F,z+2*F),a]}get boundsT(){var a=this.bounds;const n=C.set(r.create(),a.x,a.y);C.transformMat2d(n,n,this._transform);return this._hasRotation?
(a=Math.max(a.width,a.height),new e(n[0],n[1],a,a)):new e(n[0],n[1],a.width,a.height)}_createBounds(a){let n=Infinity,t=Infinity,v=0;var y=0;for(const h of a)n=Math.min(n,h.xTopLeft),t=Math.min(t,h.yTopLeft),v=Math.max(v,h.xBottomRight),y=Math.max(y,h.yBottomRight);a=v-n;y-=t;return new e(n+a/2,t+y/2,a,y)}_createGlyphTransform(a,n){const t=b*n.angle,v=w.create(),y=r.create();x.translate(v,v,C.set(y,n.xOffset,-n.yOffset));n.isCIM?x.rotate(v,v,t):(x.translate(v,v,C.set(y,a.x,a.y)),x.rotate(v,v,t),x.translate(v,
v,C.set(y,-a.x,-a.y)));return v}}class d{constructor(a,n,t,v,y,h){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(n,t));this.end=Math.max(0,Math.max(n,t));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=v;this.yMin=y;this.yMax=h}}g.ShapedGlyph=p;g.ShapingInfo=c;g.shapeGlyphs=function(a,n,t){const v=t.scale,y=[],h=[];var A=1/t.scale*t.maxLineWidth;var E=n?a.length-1:0,z=n?-1:a.length;n=n?-1:1;var F=E,D=0,B=0;let u=F,H=u,G=0,I=Infinity,J=0;for(;F!==
z;){const {code:fa,metrics:O}=a[F];var M=Math.abs(O.top);10!==fa&&32!==fa&&(I=Math.min(I,M),J=Math.max(J,M+O.height));10===fa?(F!==E&&(h.push(new d(a,u,F-n,D,I,J)),I=Infinity,J=0),D=0,u=F+n,H=F+n,B=0):32===fa?(H=F+n,B=0,G=O.advance,D+=O.advance):(D>A&&(H!==u?(M=H-2*n,D-=G,h.push(new d(a,u,M,D-B,I,J)),I=Infinity,J=0,u=H,D=B):(h.push(new d(a,u,F-n,D,I,J)),I=Infinity,J=0,H=u=F,D=0)),D+=O.advance,B+=O.advance);F+=n}A=new d(a,u,F-n,D,I,J);0<=A.start&&A.end<a.length&&h.push(A);for(A=0;A<h.length;A++);E=
h[0].yMin;A=h[h.length-1].yMax+t.lineHeight*(h.length-1)+("underline"===t.decoration?4:0)-E;const {vAlign:R,hAlign:Y}=t;z=R===m.VAlign.Baseline?1:0;A=(1-z)*-E+A/2*(z?0:R-1)+-26*(z?1:0);for(E=0;E<h.length;E++){const {start:fa,end:O,width:Q}=h[E];z=Q/2*(Y+1)*-1-3;n=E*t.lineHeight+A-3;h[E].startX=z;h[E].startY=n;for(F=fa;F<=O;F++)D=a[F],10!==D.code&&(B=new p(z+D.metrics.left,n-D.metrics.top,D,v),z+=D.metrics.advance,y.push(B))}return new c(y,h,t)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/vec2f32":function(){define(["exports"],function(g){function q(){return new Float32Array(2)}function x(d){const a=new Float32Array(2);a[0]=d[0];a[1]=d[1];return a}function w(d,a){const n=new Float32Array(2);n[0]=d;n[1]=a;return n}function C(d,a){return new Float32Array(d,a,2)}function r(){return q()}function m(){return w(1,1)}function k(){return w(1,0)}function f(){return w(0,1)}const e=q(),l=m(),b=k(),p=f(),c=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:b,UNIT_Y:p,
ZEROS:e,clone:x,create:q,createView:C,fromValues:w,ones:m,unitX:k,unitY:f,zeros:r},Symbol.toStringTag,{value:"Module"}));g.ONES=l;g.UNIT_X=b;g.UNIT_Y=p;g.ZEROS=e;g.clone=x;g.create=q;g.createView=C;g.fromValues=w;g.ones=m;g.unitX=k;g.unitY=f;g.vec2f32=c;g.zeros=r})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../chunks/vec2f32"],function(g){class q{constructor(x,w,C,r){this.center=g.fromValues(x,w);this.centerT=g.create();this.halfWidth=C/2;this.halfHeight=
r/2;this.width=C;this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(x){this.center[0]=x}set y(x){this.center[1]=x}clone(){return new q(this.x,
this.y,this.width,this.height)}serialize(x){x.writeF32(this.center[0]);x.writeF32(this.center[1]);x.push(this.width);x.push(this.height);return x}findCollisionDelta(x,w=4){return Math.log2(Math.min((x.halfWidth+this.halfWidth+w)/Math.abs(x.centerT[0]-this.centerT[0]),(x.halfHeight+this.halfHeight+w)/Math.abs(x.centerT[1]-this.centerT[1])))}extend(x){const w=Math.min(this.xmin,x.xmin),C=Math.min(this.ymin,x.ymin),r=Math.max(this.xmax,x.xmax)-w;x=Math.max(this.ymax,x.ymax)-C;this.width=r;this.height=
x;this.halfWidth=r/2;this.halfHeight=x/2;this.x=w+r/2;this.y=C+x/2}static deserialize(x){const w=x.readF32(),C=x.readF32(),r=x.readInt32();x=x.readInt32();return new q(w,C,r,x)}}return q})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["../../../../../../geometry/GeometryCursor","../../../../../../symbols/cim/effects/CIMEffectHelper"],function(g,q){class x{constructor(){this._materialKey=null}bindFeature(w,C,r){}write(w,C,r,m){if(this._effects&&0<this._effects.length){if(r=
g.GeometryCursor.fromFeatureSetReaderCIM(C)){r.invertY();const k=q.CIMEffectHelper.executeEffects(this._effects,r,w.tileKey,m.geometryEngine);for(;r=k.next();)r.invertY(),this._write(w,C,m,r)}}else this._write(w,C,m)}_write(w,C,r,m){}}return x})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),function(g,q,x,w,C,r){const m=96/72;class k{static executeEffects(f,
e,l,b){const p=r.getEffectsInflateSize(f);e=new w.SimpleEffectCursor(e);for(const c of f)(f=C.getEffectOperator(c))&&(e=f.execute(e,c,m,l,b,p));return e}static applyEffects(f,e,l){if(!f)return e;var b=r.getEffectsInflateSize(f);e=new w.SimpleEffectCursor(q.GeometryCursor.fromJSONCIM(e));for(var p of f)(f=C.getEffectOperator(p))&&(e=f.execute(e,p,1,null,l,b));b=[];for(p=null;l=e.next();)b.push(...x.collectMultipath(l)),p=l.geometryType;return 0===b.length||null===p?null:"esriGeometryPolygon"===p?{rings:b}:
{paths:b}}}g.CIMEffectHelper=k;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../Color ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../support/arcadeOnDemand ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./enums ./utils ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y){function h(P,U,ca){switch(U.type){case "CIMSymbolReference":return h(P,U.symbol,ca);case "CIMPointSymbol":null==ca&&(ca={x:0,y:0});P.drawSymbol(U,ca);break;case "CIMLineSymbol":null==ca&&(ca={paths:[[[0,0],[10,0]]]});P.drawSymbol(U,ca);break;case "CIMPolygonSymbol":null==ca&&(ca={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});P.drawSymbol(U,ca);break;case "CIMTextSymbol":P.drawSymbol(U,{x:0,y:0});break;case "CIMVectorMarker":ca=new p.Placement,P.drawMarker(U,
ca)}return P.envelope()}function A(P){if(!P)return 0;switch(P.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(P.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(P.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(P.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(P.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(P.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(P.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(P.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function E(P){if(!P)return 0;switch(P.type){case "CIMGeometricEffectArrow":return Math.abs(.5*P.width);case "CIMGeometricEffectBuffer":return Math.abs(P.size);case "CIMGeometricEffectExtension":return Math.abs(P.length);case "CIMGeometricEffectJog":return Math.abs(.5*P.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(a.getValue(P.offsetX)),Math.abs(a.getValue(P.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(P.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(P.offset);case "CIMGeometricEffectRadial":return Math.abs(P.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(P.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(P.fromWidth),Math.abs(P.toWidth));case "CIMGeometricEffectWave":return Math.abs(P.amplitude);case "CIMGeometricEffectDonut":return Math.abs(P.width);
default:return 0}}function z(P){if(!P)return 0;let U=0;for(const ca of P)U+=E(ca);return U}function F(P,U,ca){P.effects&&null==U.geometryEngine&&(U.geometryEnginePromise?ca.push(U.geometryEnginePromise):a.isGeometryEngineRequired(P.effects)&&(U.geometryEnginePromise=a.importGeometryEngine(),ca.push(U.geometryEnginePromise),U.geometryEnginePromise.then(la=>U.geometryEngine=la)))}function D(P){if(!P)return null;let U=null;const {cap:ca,color:la,join:pa,miterLimit:na,style:ra,width:ua}=P;"solid"!==ra&&
"none"!==ra&&"esriSLSSolid"!==ra&&"esriSLSNull"!==ra&&(U=[{type:"CIMGeometricEffectDashes",dashTemplate:ba(ra,ca),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==ra&&"none"!==ra?Z(la):[0,0,0,0],capStyle:Y(ca),joinStyle:fa(pa),miterLimit:na,width:ua,effects:U}}const B=Math.PI,u=B/2,H=Math.PI/180,G=96/72,I=r.getLogger("esri.symbols.cim.CIMSymbolHelper");class J{getSymbolInflateSize(P,U,ca,la,pa){P||(P=[0,0,0,0]);return U?this._getInflateSize(P,
U,ca,la,pa):P}static safeSize(P){const U=Math.max(Math.abs(P[0]),Math.abs(P[2]));P=Math.max(Math.abs(P[1]),Math.abs(P[3]));return Math.sqrt(U*U+P*P)}_vectorMarkerBounds(P,U,ca,la){let pa=!0;const na=f.create();if(U?.markerGraphics)for(const ra of U.markerGraphics)U=[0,0,0,0],ra.geometry&&(e.getBoundsXY(na,ra.geometry),U[0]=0,U[1]=0,U[2]=0,U[3]=0,this.getSymbolInflateSize(U,ra.symbol,ca,0,la),na[0]+=U[0],na[1]+=U[1],na[2]+=U[2],na[3]+=U[3],pa?(P[0]=na[0],P[1]=na[1],P[2]=na[2],P[3]=na[3],pa=!1):(P[0]=
Math.min(P[0],na[0]),P[1]=Math.min(P[1],na[1]),P[2]=Math.max(P[2],na[2]),P[3]=Math.max(P[3],na[3])));return P}_getInflateSize(P,U,ca,la,pa){return void 0!==U.symbolLayers?(P=this._getLayersInflateSize(P,U.symbolLayers,ca,la,pa),U=z(U.effects),0<U&&(P[0]-=U,P[1]-=U,P[2]+=U,P[3]+=U),P):this._getTextInflatedSize(P,U,pa)}_getLayersInflateSize(P,U,ca,la,pa){let na=!0;if(!U)return P;for(const ka of U)if(ka){U=[0,0,0,0];switch(ka.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var ra=
ka,ua=ra.width;null!=ua&&(ua=ra.capStyle===d.LineCapStyle.Square||ra.joinStyle===d.LineJoinStyle.Miter?ua/1.4142135623730951:ua/2,U[0]=-ua,U[1]=-ua,U[2]=ua,U[3]=ua);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":ra=ka;if("CIMVectorMarker"===ka.type){if(ua=ka,U=this._vectorMarkerBounds(U,ua,ca,pa),ua.frame){var L=(ua.frame.xmin+ua.frame.xmax)/2,T=(ua.frame.ymin+ua.frame.ymax)/2;U[0]-=L;U[1]-=T;U[2]-=L;U[3]-=T;null!=ua.size&&(ua=ua.size/(ua.frame.ymax-ua.frame.ymin),
U[0]*=ua,U[1]*=ua,U[2]*=ua,U[3]*=ua)}}else"CIMPictureMarker"===ka.type?(ua=ka,T=ca.getResource(ua.url),L=1,null!=T&&T.height&&(L=T.width/T.height),null!=ra.size&&(U=ra.size/2,ua=ra.size*L*ua.scaleX/2,U=[-ua,-U,ua,U])):null!=ra.size&&(U=ra.size/2,U=[-U,-U,U,U]);ra.anchorPoint&&("Absolute"===ra.anchorPointUnits?(ua=ra.anchorPoint.x,L=ra.anchorPoint.y):(ua=ra.anchorPoint.x*(U[2]-U[0]),L=ra.anchorPoint.y*(U[3]-U[1])),U[0]-=ua,U[1]-=L,U[2]-=ua,U[3]-=L);ua=a.getValue(ra.rotation);ra.rotateClockwise&&(ua=
-ua);la&&(ua-=la);ua&&(L=H*ua,ua=Math.cos(L),L=Math.sin(L),T=f.create([t.cInfinity,t.cInfinity,-t.cInfinity,-t.cInfinity]),f.expandPointInPlace(T,[U[0]*ua-U[1]*L,U[0]*L+U[1]*ua]),f.expandPointInPlace(T,[U[0]*ua-U[3]*L,U[0]*L+U[3]*ua]),f.expandPointInPlace(T,[U[2]*ua-U[1]*L,U[2]*L+U[1]*ua]),f.expandPointInPlace(T,[U[2]*ua-U[3]*L,U[2]*L+U[3]*ua]),U=T);ua=a.getValue(ra.offsetX);L=a.getValue(ra.offsetY);if(la){var ia=H*la;T=Math.cos(ia);ia=Math.sin(ia);const qa=ua*ia+L*T;ua=ua*T-L*ia;L=qa}U[0]+=ua;U[1]+=
L;U[2]+=ua;U[3]+=L;ra=A(ra.markerPlacement);0<ra&&(U[0]-=ra,U[1]-=ra,U[2]+=ra,U[3]+=ra)}ra=z(ka.effects);0<ra&&(U[0]-=ra,U[1]-=ra,U[2]+=ra,U[3]+=ra);na?(P[0]=U[0],P[1]=U[1],P[2]=U[2],P[3]=U[3],na=!1):(P[0]=Math.min(P[0],U[0]),P[1]=Math.min(P[1],U[1]),P[2]=Math.max(P[2],U[2]),P[3]=Math.max(P[3],U[3]))}return P}_getTextInflatedSize(P,U,ca){const la=U.height??c.defaultTextHeight;P[0]=-la/2;P[1]=-la/2;P[2]=la/2;P[3]=la/2;if(!ca)return P;ca=ca.get(U);if(!ca)return P;const {text:pa,mosaicItem:na}=ca;if(!na?.glyphMosaicItems?.length)return P;
const {lineGapType:ra,lineGap:ua}=U;ca=ra?c.lineGapType2LineHeight(ra,ua??0,la):0;const L=x.bidiText(pa)[1],T="CIMBackgroundCallout"===U.callout?.type;U=y.shapeGlyphs(na.glyphMosaicItems,L,{scale:la/v.glyphSize,angle:a.getValue(U.angle),xOffset:a.getValue(U.offsetX),yOffset:a.getValue(U.offsetY),hAlign:c.horizontalAlignment2HAlign(U.horizontalAlignment),vAlign:c.verticalAlignment2VAlign(U.verticalAlignment),maxLineWidth:512,lineHeight:v.magicLabelLineHeight*Math.max(.25,Math.min(ca||1,4)),decoration:U.font.decoration||
"none",isCIM:!0,hasBackground:T}).boundsT;P[0]=U.x-U.halfWidth;P[1]=-U.y-U.halfHeight;P[2]=U.x+U.halfWidth;P[3]=-U.y+U.halfHeight;return P}}class M{static getEnvelope(P,U,ca){if(!P)return null;ca=new c.EnvDrawHelper(ca);if(Array.isArray(P)){let la;for(const pa of P)la?la.union(h(ca,pa,U)):la=h(ca,pa,U);return la}return h(ca,P,U)}static getTextureAnchor(P,U){P=this.getEnvelope(P,null,U);if(!P)return[0,0,0];U=P.height*G+2;return[-((P.x+.5*P.width)*G)/(P.width*G+2),-((P.y+.5*P.height)*G)/U,U]}static rasterize(P,
U,ca,la,pa=!0){var na=ca||this.getEnvelope(U,null,la);if(!na)return[null,0,0,0,0];const ra=(na.x+.5*na.width)*G,ua=(na.y+.5*na.height)*G;P.width=na.width*G;P.height=na.height*G;ca||(P.width+=2,P.height+=2);ca=P.getContext("2d");na=c.Transformation.createScale(G,-G);na.translate(.5*P.width-ra,.5*P.height+ua);la=new c.CanvasDrawHelper(ca,la,na);switch(U.type){case "CIMPointSymbol":la.drawSymbol(U,{type:"point",x:0,y:0});break;case "CIMVectorMarker":na=new p.Placement,la.drawMarker(U,na)}U=ca.getImageData(0,
0,P.width,P.height);U=new Uint8Array(U.data);if(pa)for(la=0;la<U.length;la+=4)pa=U[la+3]/255,U[la]*=pa,U[la+1]*=pa,U[la+2]*=pa;return[U,P.width,P.height,-ra/P.width,-ua/P.height]}static fromTextSymbol(P){const {angle:U,color:ca,font:la,haloColor:pa,haloSize:na,horizontalAlignment:ra,kerning:ua,text:L,verticalAlignment:T,xoffset:ia,yoffset:ka,backgroundColor:qa,borderLineColor:S,borderLineSize:V}=P;let X,ha,ja;if(la){var ma=la.family;var oa=la.style;var va=la.weight;X=la.size;ha=la.decoration}P=!1;
L&&(P=x.bidiText(L)[1]);if(qa||V)ja={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Z(qa)},{type:"CIMSolidStroke",color:Z(S),width:V}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var xa=d.BlockProgression.BTT,za=d.FontEffects.Normal,Aa=d.FontEncoding.Unicode;ma=ma||"Arial";b:{if(va)switch(va.toLowerCase()){case "bold":case "bolder":va="bold";break b}va=""}b:{if(oa)switch(oa.toLowerCase()){case "italic":case "oblique":oa=
"italic";break b}oa=""}va=va&&oa?`${va}-${oa}`:`${va}${oa}`;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:U,blockProgression:xa,depth3D:1,extrapolateBaselines:!0,fontEffects:za,fontEncoding:Aa,fontFamilyName:ma,fontStyleName:va,fontType:d.FontType.Unspecified,
haloSize:na,height:X,hinting:d.GlyphHinting.Default,horizontalAlignment:O(ra??"center"),kerning:ua,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:a.getValue(ia),offsetY:a.getValue(ka),strikethrough:"line-through"===ha,underline:"underline"===ha,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Z(ca)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Z(pa)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,
textCase:"Normal",textDirection:P?d.TextReadingDirection.RTL:d.TextReadingDirection.LTR,verticalAlignment:Q(T??"baseline"),verticalGlyphOrientation:d.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:d.BillBoardMode.FaceNearPlane,callout:ja},textString:L}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(P){const {height:U,outline:ca,width:la,xoffset:pa,xscale:na,yoffset:ra,yscale:ua}=P,L=[],T={type:"CIMPolygonSymbol",symbolLayers:L};
if(ca){var ia=D(ca);ia&&L.push(ia)}ia=P.url;"esriPFS"===P.type&&P.imageData&&(ia=P.imageData);P="angle"in P?P.angle??0:0;L.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:d.TextureFilter.Picture,tintColor:null,url:ia,height:(U??0)*(ua||1),width:(la??0)*(na||1),offsetX:a.getValue(pa),offsetY:a.getValue(ra),rotation:a.getValue(-P),colorSubstitutions:null});return T}static fromSimpleFillSymbol(P){const {color:U,style:ca,outline:la}=P;P=[];const pa={type:"CIMPolygonSymbol",
symbolLayers:P};if(la){var na=D(la);na&&P.push(na)}if(ca&&"solid"!==ca&&"none"!==ca&&"esriSFSSolid"!==ca&&"esriSFSNull"!==ca){na={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Z(U),capStyle:d.LineCapStyle.Butt,joinStyle:d.LineJoinStyle.Miter,width:.75}]};let ra=0;const ua=k.px2pt("vertical"===ca||"horizontal"===ca||"cross"===ca||"esriSFSCross"===ca||"esriSFSVertical"===ca||"esriSFSHorizontal"===ca?8:10);switch(ca){case "vertical":case "esriSFSVertical":ra=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":ra=
-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":ra=45;break;case "cross":case "esriSFSCross":ra=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":ra=-45}P.push({type:"CIMHatchFill",lineSymbol:na,offsetX:0,offsetY:0,rotation:ra,separation:ua});"cross"===ca||"esriSFSCross"===ca?P.push({type:"CIMHatchFill",lineSymbol:C.clone(na),offsetX:0,offsetY:0,rotation:90,separation:ua}):("diagonal-cross"===ca||"esriSFSDiagonalCross"===ca)&&P.push({type:"CIMHatchFill",lineSymbol:C.clone(na),
offsetX:0,offsetY:0,rotation:45,separation:ua})}else!ca||"solid"!==ca&&"esriSFSSolid"!==ca||P.push({type:"CIMSolidFill",enable:!0,color:Z(U)});return pa}static fromSimpleLineSymbol(P){const {cap:U,color:ca,join:la,marker:pa,miterLimit:na,style:ra,width:ua}=P;P=null;"solid"!==ra&&"none"!==ra&&"esriSLSSolid"!==ra&&"esriSLSNull"!==ra&&(P=[{type:"CIMGeometricEffectDashes",dashTemplate:ba(ra,U),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const L=[];if(pa){let T;switch(pa.placement){case "begin-end":T=
d.ExtremityPlacement.Both;break;case "begin":T=d.ExtremityPlacement.JustBegin;break;case "end":T=d.ExtremityPlacement.JustEnd;break;default:T=d.ExtremityPlacement.None}const ia=M.fromSimpleMarker(pa,ua,ca).symbolLayers[0];ia.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:T,offsetAlongLine:0};L.push(ia)}L.push({type:"CIMSolidStroke",color:"none"!==ra&&"esriSLSNull"!==ra?Z(ca):[0,0,0,0],capStyle:Y(U),joinStyle:fa(la),miterLimit:na,width:ua,effects:P});
return{type:"CIMLineSymbol",symbolLayers:L}}static fromPictureMarker(P){const {angle:U,height:ca,width:la,xoffset:pa,yoffset:na}=P;let ra=P.url;"esriPMS"===P.type&&P.imageData&&(ra=P.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:d.TextureFilter.Picture,tintColor:null,url:ra,size:ca,width:la,offsetX:a.getValue(pa),offsetY:a.getValue(na),rotation:a.getValue(-U)}]}}static fromSimpleMarker(P,U,ca){var {style:la}=P;ca=P.color??
ca;if("path"===la){U=[];if("outline"in P&&P.outline){var pa=P.outline;U.push({type:"CIMSolidStroke",enable:!0,width:k.pt2px(Math.round(k.px2pt(pa.width))),color:Z(pa.color),path:P.path})}U.push({type:"CIMSolidFill",enable:!0,color:Z(ca),path:P.path});const [ua,L]=da("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.getValue(-P.angle),size:a.getValue(P.size||6),offsetX:a.getValue(P.xoffset),offsetY:a.getValue(P.yoffset),frame:ua,markerGraphics:[{type:"CIMMarkerGraphic",
geometry:L,symbol:{type:"CIMPolygonSymbol",symbolLayers:U}}]}]}}pa=[];let na;if("outline"in P&&P.outline&&"none"!==P.outline.style&&"esriSLSNull"!==P.outline.style){const ua=P.outline,L="solid"!==ua.style&&"esriSLSSolid"!==ua.style;[la,na]=L?da(la,P.size):da(la);var ra="cross"!==P.style&&"x"!==P.style||"dot"===P?.outline.style||"short-dot"===P?.outline.style?d.LineDashEnding.HalfGap:d.LineDashEnding.FullPattern;ra=L?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:ba(ua.style,
null).map(T=>ua.width&&0<ua.width?T*ua.width:T),lineDashEnding:ra,controlPointEnding:d.LineDashEnding.FullPattern}]:void 0;pa.push({type:"CIMSolidStroke",capStyle:L?d.LineCapStyle.Round:d.LineCapStyle.Butt,enable:!0,width:null!=ua.width&&.667<ua.width?k.pt2px(Math.round(k.px2pt(ua.width))):ua.width,color:Z(ua.color),effects:ra})}else!U||"line-marker"!==P.type||"cross"!==P.style&&"x"!==P.style?[la,na]=da(la):([la,na]=da(la),pa.push({type:"CIMSolidStroke",enable:!0,width:U,color:Z(ca)}));pa.push({type:"CIMSolidFill",
enable:!0,color:Z(ca)});ca={type:"CIMPolygonSymbol",symbolLayers:pa};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.getValue(-P.angle),size:a.getValue(P.size||6*U),offsetX:a.getValue(P.xoffset),offsetY:a.getValue(P.yoffset),frame:la,markerGraphics:[{type:"CIMMarkerGraphic",geometry:na,symbol:ca}]}]}}static fromCIMHatchFill(P,U){const ca=U*(P.separation??c.defaultHatchFillSeparation),la=ca/2;P=C.clone(P.lineSymbol);P.symbolLayers?.forEach(na=>{switch(na.type){case "CIMSolidStroke":null!=
na.width&&(na.width*=U);na.effects?.forEach(ra=>{"CIMGeometricEffectDashes"===ra.type&&(ra.dashTemplate=ra.dashTemplate.map(ua=>ua*U))});break;case "CIMVectorMarker":null!=na.size&&(na.size*=U),na=na.markerPlacement,null!=na&&"placementTemplate"in na&&(na.placementTemplate=na.placementTemplate.map(ra=>ra*U))}});for(var pa=this._getLineSymbolPeriod(P)||4;4>pa;)pa*=2;pa/=2;return{type:"CIMVectorMarker",frame:{xmin:-pa,xmax:pa,ymin:-la,ymax:la},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-pa,
0],[pa,0]]]},symbol:P}],size:ca}}static fetchResources(P,U,ca){if(P&&U)switch(P.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(P=P.symbolLayers)for(const la of P)switch(F(la,U,ca),la.type){case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMCharacterMarker":case "CIMPictureMarker":"url"in la&&la.url&&ca.push(U.fetchResource(la.url,null));break;case "CIMVectorMarker":if(P=la.markerGraphics)for(const pa of P)pa&&
(P=pa.symbol)&&M.fetchResources(P,U,ca)}}}static fetchFonts(P,U,ca){if(P&&U)if("symbolLayers"in P&&P.symbolLayers)for(const na of P.symbolLayers){if("CIMVectorMarker"===na.type&&na.markerGraphics)for(const ra of na.markerGraphics)ra?.symbol&&M.fetchFonts(ra.symbol,U,ca)}else if("CIMTextSymbol"===P.type){const {fontFamilyName:na,fontStyleName:ra}=P;if(na&&"calcitewebcoreicons"!==na.toLowerCase()){var {style:la,weight:pa}=a.fromCIMFontStyle(ra);P=a.fromCIMFontDecoration(P);P=new b({family:na,style:la,
weight:pa,decoration:P});ca.push(U.loadFont(P).catch(()=>{I.error(`Unsupported font ${na} in CIM symbol`)}))}}}static _getLineSymbolPeriod(P){if(P){const U=this._getEffectsRepeat(P.effects);if(U)return U;if(P.symbolLayers)for(const ca of P.symbolLayers)if(ca){if(P=this._getEffectsRepeat(ca.effects))return P;switch(ca.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(P=this._getPlacementRepeat(ca.markerPlacement))return P}}}return 0}static _getEffectsRepeat(P){if(P)for(var U of P)if(U)switch(U.type){case "CIMGeometricEffectDashes":if((P=
U.dashTemplate)&&P.length){U=0;for(const ca of P)U+=ca;P.length&1&&(U*=2);return U}break;case "CIMGeometricEffectWave":return U.period;default:I.error(`unsupported geometric effect type ${U.type}`)}return 0}static _getPlacementRepeat(P){if(P)switch(P.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((P=P.placementTemplate)&&P.length){let U=0;for(const ca of P)U+=+ca;P.length&1&&(U*=2);return U}}return 0}static fromCIMInsidePolygon(P){var U=
P.markerPlacement;const ca={...P,markerPlacement:null,anchorPoint:null};P=Math.abs(U.stepX);const la=Math.abs(U.stepY);var pa=(U.randomness??100)/100;let na,ra;if("Random"===U.gridType){var ua=k.px2pt(v.randomInsidePolygonTextureSize);const L=Math.max(Math.floor(ua/P),1),T=Math.max(Math.floor(ua/la),1);ua=L*P/2;na=T*la/2;ra=2*na;U=new m(U.seed);const ia=pa*P/1.5,ka=pa*la/1.5;pa=[];for(let qa=0;qa<L;qa++)for(let S=0;S<T;S++){const V=qa*P-ua+ia*(.5-U.getFloat()),X=S*la-na+ka*(.5-U.getFloat());pa.push({x:V,
y:X});0===qa&&pa.push({x:V+2*ua,y:X});0===S&&pa.push({x:V,y:X+2*na})}}else!0===U.shiftOddRows?(ua=P/2,na=la,ra=2*la,pa=[{x:-ua,y:0},{x:ua,y:0},{x:0,y:na},{x:0,y:-na}]):(ua=P/2,na=la/2,ra=la,pa=[{x:-P,y:0},{x:0,y:-la},{x:-P,y:-la},{x:0,y:0},{x:P,y:0},{x:0,y:la},{x:P,y:la},{x:-P,y:la},{x:P,y:-la}]);P=pa.map(L=>({type:"CIMMarkerGraphic",geometry:L,symbol:{type:"CIMPointSymbol",symbolLayers:[ca]}}));return{type:"CIMVectorMarker",frame:{xmin:-ua,xmax:ua,ymin:-na,ymax:na},markerGraphics:P,size:ra}}static getSize(P){if(P)switch(P.type){case "CIMTextSymbol":return P.height;
case "CIMPointSymbol":var U=0;if(P.symbolLayers)for(var ca of P.symbolLayers)if(ca)switch(ca.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":P=ca.size,null!=P&&P>U&&(U=P)}return U;case "CIMLineSymbol":case "CIMPolygonSymbol":ca=0;if(P.symbolLayers)for(U of P.symbolLayers)if(U)switch(U.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":P=U.width;null!=P&&P>ca&&(ca=P);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":U.markerPlacement&&
a.isCIMMarkerStrokePlacement(U.markerPlacement)&&(P=U.size,null!=P&&P>ca&&(ca=P))}return ca}}static getMarkerScaleRatio(P){if(P)switch(P.type){case "CIMVectorMarker":if(!1!==P.scaleSymbolsProportionally&&P.frame&&null!=P.size)return P.size/(P.frame.ymax-P.frame.ymin)}return 1}}class R{static findApplicableOverrides(P,U,ca){if(P&&U){if(P.primitiveName){let la=!1;for(const pa of ca)if(pa.primitiveName===P.primitiveName){la=!0;break}if(!la)for(const pa of U)pa.primitiveName===P.primitiveName&&ca.push(pa)}switch(P.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(P.effects)for(const la of P.effects)R.findApplicableOverrides(la,
U,ca);if(P.symbolLayers)for(const la of P.symbolLayers)R.findApplicableOverrides(la,U,ca);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(P.effects)for(const la of P.effects)R.findApplicableOverrides(la,U,ca);P.markerPlacement&&R.findApplicableOverrides(P.markerPlacement,U,ca);if("CIMVectorMarker"===P.type){if(P.markerGraphics)for(const la of P.markerGraphics)R.findApplicableOverrides(la,
U,ca),R.findApplicableOverrides(la.symbol,U,ca)}else"CIMCharacterMarker"===P.type?R.findApplicableOverrides(P.symbol,U,ca):"CIMHatchFill"===P.type?R.findApplicableOverrides(P.lineSymbol,U,ca):"CIMPictureMarker"===P.type&&R.findApplicableOverrides(P.animatedSymbolProperties,U,ca)}}}static findEffectOverrides(P,U,ca){if(U&&P){var la=P.length;for(let pa=0;pa<la;pa++){const na=P[pa]?.primitiveName;if(na){let ra=!1;for(const ua of ca)if(ua.primitiveName===na){ra=!0;break}if(!ra)for(const ua of U)ua.primitiveName===
na&&ca.push(ua)}}}}static async resolveSymbolOverrides(P,U,ca,la,pa,na,ra){if(!P?.symbol)return null;let {symbol:ua,primitiveOverrides:L}=P;P=!!L;if(!P&&!la)return ua;ua=C.clone(ua);let T=!0;U||(U={attributes:{}},T=!1);P&&(T||(L=L.filter(ia=>!ia.valueExpressionInfo?.expression.includes("$feature"))),ra||(L=L.filter(ia=>!ia.valueExpressionInfo?.expression.includes("$view"))),0<L.length&&(P=a.attributesToFields(U.attributes),await R.evaluateOverrides(L,U,{spatialReference:ca,fields:P,geometryType:pa},
na,ra)),R.applyOverrides(ua,L));la&&R.applyDictionaryTextOverrides(ua,U,la);return ua}static async evaluateOverrides(P,U,ca,la,pa){if(U){var na;for(const ra of P)(P=ra.valueExpressionInfo)&&ca?.geometryType&&(na||(na=[]),ra.value=void 0,P=l.createRendererExpression(P.expression,ca.spatialReference,ca.fields).then(ua=>{ra.value=n(ua,U,{$view:pa},ca.geometryType,la)}),na.push(P));void 0!==na&&0<na.length&&await Promise.all(na)}}static applyDictionaryTextOverrides(P,U,ca,la="Normal"){if(P?.type)switch(P.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":case "CIMTextSymbol":var pa=
P.symbolLayers;if(!pa)break;for(var na of pa)na&&"CIMVectorMarker"===na.type&&R.applyDictionaryTextOverrides(na,U,ca,"CIMTextSymbol"===P.type?P.textCase:la);break;case "CIMVectorMarker":P=P.markerGraphics;if(!P)break;for(pa of P)pa&&R.applyDictionaryTextOverrides(pa,U,ca);break;case "CIMMarkerGraphic":(na=P.textString)&&na.includes("[")&&(ca=a.analyzeTextParts(na,ca),P.textString=a.assignTextValuesFromFeature(U,ca,la))}}static applyOverrides(P,U,ca,la){if(P.primitiveName)for(const na of U)if(na.primitiveName===
P.primitiveName){var pa=(pa=na.propertyName)?pa.charAt(0).toLowerCase()+pa.substr(1):pa;la&&la.push({cim:P,nocapPropertyName:pa,value:P[pa]});na.expression&&(na.value=R.toValue(na.propertyName,na.expression));if(ca){let ra=!1;for(const ua of ca)ua.primitiveName===P.primitiveName&&(ra=!0);ra||ca.push(na)}null!=na.value&&(P[pa]=na.value)}switch(P.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(P.effects)for(const na of P.effects)R.applyOverrides(na,U,ca,la);if(P.symbolLayers)for(const na of P.symbolLayers)R.applyOverrides(na,
U,ca,la);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(P.effects)for(const na of P.effects)R.applyOverrides(na,U,ca,la);if("CIMVectorMarker"===P.type&&P.markerGraphics)for(const na of P.markerGraphics)R.applyOverrides(na,U,ca,la),R.applyOverrides(na.symbol,U,ca,la)}}static restoreOverrides(P){for(const U of P)U.cim[U.nocapPropertyName]=U.value}static buildOverrideKey(P){let U="";for(const ca of P)void 0!==ca.value&&(U+=`${ca.primitiveName}${ca.propertyName}${JSON.stringify(ca.value)}`);
return U}static toValue(P,U){return"DashTemplate"===P?U.split(" ").map(ca=>Number(ca)):"Color"===P?(P=(new q(U)).toRgba(),P[3]*=255,P):U}}const Y=P=>{if(!P)return d.LineCapStyle.Butt;switch(P){case "butt":return d.LineCapStyle.Butt;case "square":return d.LineCapStyle.Square;case "round":return d.LineCapStyle.Round}},fa=P=>{if(!P)return d.LineJoinStyle.Miter;switch(P){case "miter":return d.LineJoinStyle.Miter;case "round":return d.LineJoinStyle.Round;case "bevel":return d.LineJoinStyle.Bevel}},O=P=>
{if(null==P)return"Center";switch(P){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},Q=P=>{if(null==P)return"Center";switch(P){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},Z=P=>{if(!P)return[0,0,0,0];const {r:U,g:ca,b:la,a:pa}=P;return[U,ca,la,255*pa]},ba=(P,U)=>{const ca=w("safari")?.001:0;U="butt"===U;switch(P){case "dash":case "esriSLSDash":return U?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return U?
[4,3,1,3]:[3,4,ca,4];case "dot":case "esriSLSDot":return U?[1,3]:[ca,4];case "long-dash":case "esriSLSLongDash":return U?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return U?[8,3,1,3]:[7,4,ca,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return U?[8,3,1,3,1,3]:[7,4,ca,4,ca,4];case "short-dash":case "esriSLSShortDash":return U?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return U?[4,1,1,1]:[3,2,ca,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return U?
[4,1,1,1,1,1]:[3,2,ca,2,ca,2];case "short-dot":case "esriSLSShortDot":return U?[1,1]:[ca,2];case "solid":case "esriSLSSolid":case "none":return I.error("Unexpected: style does not require rasterization"),[0,0];default:return I.error(`Tried to rasterize SLS, but found an unexpected style: ${P}!`),[0,0]}},da=(P,U=100)=>{var ca=U/2,la;if("circle"===P||"esriSMSCircle"===P){var pa=Math.acos(1-.25/ca);U=Math.ceil(B/pa/4);0===U&&(U=1);pa=u/U;U*=4;P=[];P.push([ca,0]);for(la=1;la<U;la++)P.push([ca*Math.cos(la*
pa),-ca*Math.sin(la*pa)]);P.push([ca,0]);pa={rings:[P]};la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca}}else"cross"===P||"esriSMSCross"===P?(pa={paths:[[[0,ca],[0,-ca]],[[ca,0],[-ca,0]]]},la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca}):"diamond"===P||"esriSMSDiamond"===P?(pa={rings:[[[-ca,0],[0,ca],[ca,0],[0,-ca],[-ca,0]]]},la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca}):"square"===P||"esriSMSSquare"===P?(pa={rings:[[[-ca,-ca],[-ca,ca],[ca,ca],[ca,-ca],[-ca,-ca]]]},la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca}):"x"===P||"esriSMSX"===
P?(pa={paths:[[[ca,ca],[-ca,-ca]],[[ca,-ca],[-ca,ca]]]},la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca}):"triangle"===P||"esriSMSTriangle"===P?(ca=.5773502691896257*U,P=-ca,la=2/3*U,U=la-U,pa={rings:[[[P,U],[0,la],[ca,U],[P,U]]]},la={xmin:P,ymin:U,xmax:ca,ymax:la}):"arrow"===P&&(pa={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},la={xmin:-ca,ymin:-ca,xmax:ca,ymax:ca});return[la,pa]};g.CIMSymbolHelper=M;g.CIMSymbolInflatedSizeHelper=J;g.OverrideHelper=R;g.getEffectsInflateSize=z;g.slsDashToTemplateArray=
ba;g.symbolToCIM=function(P){if(!P?.type)return null;let U;switch(P.type){case "cim":return P.data;case "web-style":return P;case "simple-marker":P=M.fromSimpleMarker(P);if(!P)return null;U=P;break;case "picture-marker":U=M.fromPictureMarker(P);break;case "simple-line":U=M.fromSimpleLineSymbol(P);break;case "simple-fill":U=M.fromSimpleFillSymbol(P);break;case "picture-fill":U=M.fromPictureFillSymbol(P);break;case "text":U=M.fromTextSymbol(P)}return{type:"CIMSymbolReference",symbol:U}};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/Font":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./support/textUtils".split(" "),function(g,q,x,w,C,r,m,k,f){var e;q=e=class extends q.JSONSupport{constructor(l){super(l);this.decoration="none";this.family="sans-serif";this.size=9;this.weight=this.style=
"normal"}castSize(l){return x.toPt(l)}clone(){return new e({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};g.__decorate([w.property({type:f.fontDecorations,json:{default:"none",write:!0}})],q.prototype,"decoration",void 0);g.__decorate([w.property({type:String,json:{write:!0}})],q.prototype,"family",void 0);g.__decorate([w.property({type:Number,json:{write:{overridePolicy(l,
b,p){return{enabled:!p||!p.textSymbol3D}}}}})],q.prototype,"size",void 0);g.__decorate([C.cast("size")],q.prototype,"castSize",null);g.__decorate([w.property({type:f.fontStyles,json:{default:"normal",write:!0}})],q.prototype,"style",void 0);g.__decorate([w.property({type:f.fontWeights,json:{default:"normal",write:!0}})],q.prototype,"weight",void 0);return q=e=g.__decorate([k.subclass("esri.symbols.Font")],q)})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],
function(g,q,x){const w={type:Number,cast:f=>{f=x.ensureNumber(f);return 0===f?1:q.clamp(f,.1,4)},nonNullable:!0},C=["left","right","center"],r=["baseline","top","middle","bottom"],m={type:C,nonNullable:!0},k={type:r,nonNullable:!0};g.backgroundPadding=8;g.fontDecorations=["none","underline","line-through"];g.fontStyles=["normal","italic","oblique"];g.fontWeights=["normal","lighter","bold","bolder"];g.horizontalAlignmentProperty=m;g.horizontalAlignments=C;g.lineHeightProperty=w;g.verticalAlignmentProperty=
k;g.verticalAlignments=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/BidiText ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/alignmentUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v,y,h,A,E,z){function F(O,Q=1){const Z=h.fromCIMFontDecoration(O);var ba=h.fromCIMFontStyle(O.fontStyleName);const da=O.fontFamilyName??x.defaultFontFamily,{weight:P,style:U}=ba;ba=Q*(O.height||5);const ca=h.fromCIMHorizontalAlignment(O.horizontalAlignment),la=h.fromCIMVerticalAlignment(O.verticalAlignment),pa=h.getFillColor(O),na=h.getFillColor(O.haloSymbol);Q=na?Q*(O.haloSize|0):0;var ra="CIMBackgroundCallout"===O.callout?.type?O.callout.backgroundSymbol:
null;O=h.getFillColor(ra);const ua=h.getStrokeWidth(ra);ra=h.getStrokeColor(ra);return{color:pa,size:ba,horizontalAlignment:ca,verticalAlignment:la,font:{family:da,style:h.getFontStyle(U),weight:h.getFontWeight(P),decoration:Z},halo:{size:Q||0,color:na,style:U},backgroundColor:O,borderLine:null!=ua&&null!=ra?{size:ua,color:ra}:null,pixelRatio:1,premultiplyColors:!0}}const D=Math.PI/180,B=C.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class u{constructor(O){this._t=O}static createIdentity(){return new u([1,
0,0,0,1,0])}clone(){return new u(this._t.slice())}transform(O){const Q=this._t;return[Q[0]*O[0]+Q[1]*O[1]+Q[2],Q[3]*O[0]+Q[4]*O[1]+Q[5]]}static createScale(O,Q){return new u([O,0,0,0,Q,0])}scale(O,Q){const Z=this._t;Z[0]*=O;Z[1]*=O;Z[2]*=O;Z[3]*=Q;Z[4]*=Q;Z[5]*=Q;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(O,Q){return new u([0,0,O,0,0,Q])}translate(O,Q){const Z=this._t;Z[2]+=O;Z[5]+=Q;return this}static createRotate(O){const Q=Math.cos(O);
O=Math.sin(O);return new u([Q,-O,0,O,Q,0])}rotate(O){return u.multiply(this,u.createRotate(O),this)}angle(){const O=this._t[0],Q=this._t[3],Z=Math.sqrt(O*O+Q*Q);return[O/Z,Q/Z]}static multiply(O,Q,Z){O=O._t;Q=Q._t;const ba=O[1]*Q[0]+O[4]*Q[1],da=O[2]*Q[0]+O[5]*Q[1]+Q[2],P=O[0]*Q[3]+O[3]*Q[4],U=O[1]*Q[3]+O[4]*Q[4],ca=O[2]*Q[3]+O[5]*Q[4]+Q[5],la=Z._t;la[0]=O[0]*Q[0]+O[3]*Q[1];la[1]=ba;la[2]=da;la[3]=P;la[4]=U;la[5]=ca;return Z}invert(){const O=this._t;let Q=O[0]*O[4]-O[1]*O[3];if(0===Q)return new u([0,
0,0,0,0,0]);Q=1/Q;return new u([O[4]*Q,-O[1]*Q,(O[1]*O[5]-O[2]*O[4])*Q,-O[3]*Q,O[0]*Q,(O[2]*O[3]-O[0]*O[5])*Q])}}class H{constructor(O,Q){this._resourceManager=O;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new r(a.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(Q||u.createIdentity());this._sizeTransfos.push(Q?Q.scaleRatio():1)}setTransform(O,Q){this._transfos=[O||u.createIdentity()];this._sizeTransfos=[Q||(O?O.scaleRatio():
1)]}setGeomUnitsPerPoint(O){this._geomUnitsPerPoint=O}transformPt(O){return this._transfos[this._transfos.length-1].transform(O)}transformSize(O){return O*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(O){return this._transfos[this._transfos.length-1].invert().transform(O)}reverseTransformSize(O){return O/this._sizeTransfos[this._sizeTransfos.length-1]}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}isEmbedded(){return 1<
this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(O,Q){Q=Q?O.scaleRatio():1;u.multiply(O,this.back(),O);this._transfos.push(O);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*Q)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(O,Q,Z){if(O)switch(O.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(O,Q);break;case "CIMTextSymbol":this.drawTextSymbol(O,Q,Z)}}drawMultiLayerSymbol(O,
Q){if(O&&Q){var Z=O.symbolLayers;if(Z)if((O=O.effects)&&0<O.length){if(Q=this.executeEffects(O,Q))for(O=Q.next();O;)this.drawSymbolLayers(Z,O.asJSON()),O=Q.next()}else this.drawSymbolLayers(Z,Q)}}executeEffects(O,Q){const Z=this._resourceManager.geometryEngine;Q=new p.SimpleEffectCursor(k.GeometryCursor.fromJSONCIM(Q));for(const ba of O)(O=d.getEffectOperator(ba))&&(Q=O.execute(Q,ba,this.geomUnitsPerPoint(),null,Z));return Q}drawSymbolLayers(O,Q){let Z=O.length;for(;Z--;){const da=O[Z];if(da&&!1!==
da.enable){var ba=da.effects;if(ba&&0<ba.length){if(ba=this.executeEffects(ba,Q)){let P=null;for(;(P=ba.next())&&(this.drawSymbolLayer(da,P.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(da,Q);if(this._earlyReturn)break}}}drawSymbolLayer(O,Q){switch(O.type){case "CIMSolidFill":this.drawSolidFill(Q,O.color);break;case "CIMHatchFill":this.drawHatchFill(Q,O);break;case "CIMPictureFill":this.drawPictureFill(Q,O);break;case "CIMGradientFill":this.drawGradientFill(Q,O);break;case "CIMSolidStroke":this.drawSolidStroke(Q,
O.color,O.width,O.capStyle,O.joinStyle,O.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(Q,O);break;case "CIMGradientStroke":this.drawGradientStroke(Q,O);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(O,Q)}}drawHatchFill(O,Q){const Z=this._buildHatchPolyline(Q,O,this.geomUnitsPerPoint());Z&&(this.pushClipPath(O),this.drawMultiLayerSymbol(Q.lineSymbol,Z),this.popClipPath())}drawPictureFill(O,Q){}drawGradientFill(O,Q){}drawPictureStroke(O,
Q){}drawGradientStroke(O,Q){}drawMarkerLayer(O,Q){var Z=O.markerPlacement;if(Z){var ba=d.getPlacementOperator(Z);if(ba){var da="CIMMarkerPlacementInsidePolygon"===Z.type||"CIMMarkerPlacementPolygonCenter"===Z.type&&Z.clipAtBoundary;da&&this.pushClipPath(Q);if(Q=ba.execute(k.GeometryCursor.fromJSONCIM(Q),Z,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(Z=null;(Z=Q.next())&&(this.drawMarker(O,Z),!this._earlyReturn););da&&this.popClipPath()}}else{da=this._placementPool.acquire();
if(b.isPoint(Q))da.tx=Q.x,da.ty=Q.y,this.drawMarker(O,da);else if(b.isPolygon(Q)){if(Q=l.polygonCentroid(Q))[da.tx,da.ty]=Q,this.drawMarker(O,da)}else for(ba of Q.points)if(da.tx=ba[0],da.ty=ba[1],this.drawMarker(O,da),this._earlyReturn)break;this._placementPool.release(da)}}drawMarker(O,Q){switch(O.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(O,Q);break;case "CIMVectorMarker":this.drawVectorMarker(O,Q)}}drawPictureMarker(O,Q){if(O){var Z=this._resourceManager.getResource(O.url),
ba=h.getValue(O.size,10);if(!(null==Z||0>=ba)){var da=Z.width;Z=Z.height;if(da&&Z){Z=da/Z;var P=h.getValue(O.scaleX,1);da=u.createIdentity();var U=O.anchorPoint;if(U){var ca=U.x;U=U.y;"Absolute"!==O.anchorPointUnits&&(ca*=ba*Z*P,U*=ba);da.translate(-ca,-U)}Z=h.getValue(O.rotation);O.rotateClockwise&&(Z=-Z);this._mapRotation&&(Z+=this._mapRotation);Z&&da.rotate(Z*D);Z=h.getValue(O.offsetX);P=h.getValue(O.offsetY);if(Z||P){if(this._mapRotation){U=D*this._mapRotation;ca=Math.cos(U);U=Math.sin(U);const la=
Z*U+P*ca;Z=Z*ca-P*U;P=la}da.translate(Z,P)}Z=this.geomUnitsPerPoint();1!==Z&&da.scale(Z,Z);(Z=Q.getAngle())&&da.rotate(Z);da.translate(Q.tx,Q.ty);this.push(da,!1);this.drawImage(O,ba);this.pop()}}}}drawVectorMarker(O,Q){if(O){var Z=O.markerGraphics;if(Z){var ba=h.getValue(O.size,10),da=O.frame,P=da?da.ymax-da.ymin:0;P=ba&&P?ba/P:1;ba=u.createIdentity();da&&ba.translate(.5*-(da.xmax+da.xmin),.5*-(da.ymax+da.ymin));var U=O.anchorPoint;if(U){var ca=U.x;U=U.y;"Absolute"!==O.anchorPointUnits?da&&(ca*=
da.xmax-da.xmin,U*=da.ymax-da.ymin):(ca/=P,U/=P);ba.translate(-ca,-U)}1!==P&&ba.scale(P,P);da=h.getValue(O.rotation);O.rotateClockwise&&(da=-da);this._mapRotation&&(da+=this._mapRotation);da&&ba.rotate(da*D);da=h.getValue(O.offsetX);P=h.getValue(O.offsetY);if(da||P){if(this._mapRotation){U=D*this._mapRotation;ca=Math.cos(U);U=Math.sin(U);const la=da*U+P*ca;da=da*ca-P*U;P=la}ba.translate(da,P)}da=this.geomUnitsPerPoint();1!==da&&ba.scale(da,da);(da=Q.getAngle())&&ba.rotate(da);ba.translate(Q.tx,Q.ty);
this.push(ba,O.scaleSymbolsProportionally);for(const la of Z)if(la?.symbol&&la.geometry||B.error("Invalid marker graphic",la),this.drawSymbol(la.symbol,la.geometry,la.textString),this._earlyReturn)break;this.pop()}}}drawTextSymbol(O,Q,Z){if(O&&b.isPoint(Q)&&!(0>=h.getValue(O.height,10))){var ba=u.createIdentity(),da=h.getValue(O.angle);(da=-da)&&ba.rotate(da*D);da=h.getValue(O.offsetX);var P=h.getValue(O.offsetY);(da||P)&&ba.translate(da,P);da=this.geomUnitsPerPoint();1!==da&&ba.scale(da,da);ba.translate(Q.x,
Q.y);this.push(ba,!1);this.drawText(O,Z);this.pop()}}_buildHatchPolyline(O,Q,Z){var ba=h.getValue(O.separation,4)*Z,da=h.getValue(O.rotation);if(0===ba)return null;0>ba&&(ba=-ba);for(var P=0,U=.5*ba;P>U;)P-=ba;for(;P<-U;)P+=ba;P=f.create();e.getBoundsXY(P,Q);P[0]-=U;P[1]-=U;P[2]+=U;P[3]+=U;for(var ca=[[P[0],P[1]],[P[0],P[3]],[P[2],P[3]],[P[2],P[1]]];180<da;)da-=180;for(;0>da;)da+=180;U=Math.cos(da*D);var la=Math.sin(da*D);da=-ba*la;Q=ba*U;P=h.getValue(O.offsetX)*Z;O=h.getValue(O.offsetY)*Z;P=P*la-
O*U;let pa;var na=O=Number.MAX_VALUE;pa=Z=-Number.MAX_VALUE;for(var ra of ca){var ua=ra[0];const L=ra[1];ca=U*ua+la*L;ua=-la*ua+U*L;na=Math.min(na,ca);O=Math.min(O,ua);pa=Math.max(pa,ca);Z=Math.max(Z,ua)}O=Math.floor(O/ba)*ba;ra=U*na-la*O-da*P/ba;ca=la*na+U*O-Q*P/ba;na=U*pa-la*O-da*P/ba;P=la*pa+U*O-Q*P/ba;ba=1+Math.round((Z-O)/ba);U=[];for(la=0;la<ba;la++)ra+=da,ca+=Q,na+=da,P+=Q,U.push([[ra,ca],[na,P]]);return{paths:U}}}class G extends H{constructor(O,Q){super(O,Q);this.reset()}reset(){this._xmin=
this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new v(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return f.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(O){!O||0<this._clipCount||(b.isPolygon(O)?this._processPath(O.rings,0):b.isPolyline(O)?this._processPath(O.paths,0):b.isExtent(O)?(O=M(O))&&this._processPath(O.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(O,Q,Z){!O||
0<this._clipCount||(Q=.5*this.transformSize(h.getValue(Z,4)),b.isPolygon(O)?this._processPath(O.rings,Q):b.isPolyline(O)?this._processPath(O.paths,Q):b.isExtent(O)?(O=M(O))&&this._processPath(O.rings,Q):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(O,Q){b.isPolygon(Q)&&O.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===O.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===O.markerPlacement.type&&O.markerPlacement.clipAtBoundary)?this._processPath(Q.rings,0):
super.drawMarkerLayer(O,Q)}drawHatchFill(O,Q){this.drawSolidFill(O)}drawPictureFill(O,Q){this.drawSolidFill(O)}drawGradientFill(O,Q){this.drawSolidFill(O)}drawPictureStroke(O,Q){this.drawSolidStroke(O,null,Q.width)}drawGradientStroke(O,Q){this.drawSolidStroke(O,null,Q.width)}pushClipPath(O){this.drawSolidFill(O);this._clipCount++}popClipPath(){this._clipCount--}drawImage(O,Q){var {url:Z}=O;O=h.getValue(O.scaleX,1);let ba=O*Q,da=Q;Z=this._resourceManager.getResource(Z);Q||null==Z||(ba=O*Z.width,da=
Z.height);this._merge(this.transformPt([-ba/2,-da/2]),0);this._merge(this.transformPt([-ba/2,da/2]),0);this._merge(this.transformPt([ba/2,-da/2]),0);this._merge(this.transformPt([ba/2,da/2]),0)}drawText(O,Q){if(Q&&0!==Q.length){this._textRasterizer||(this._textRasterizer=new y);var Z=F(O),[ba,da]=this._textRasterizer.computeTextSize(Q,Z);Q=0;switch(O.horizontalAlignment){case "Left":Q=ba/2;break;case "Right":Q=-ba/2}Z=0;switch(O.verticalAlignment){case "Bottom":Z=da/2;break;case "Top":Z=-da/2;break;
case "Baseline":Z=da/6}this._merge(this.transformPt([-ba/2+Q,-da/2+Z]),0);this._merge(this.transformPt([-ba/2+Q,da/2+Z]),0);this._merge(this.transformPt([ba/2+Q,-da/2+Z]),0);this._merge(this.transformPt([ba/2+Q,da/2+Z]),0)}}_processPath(O,Q){if(O)for(const Z of O)if(O=Z?Z.length:0,1<O){this._merge(this.transformPt(Z[0]),Q);for(let ba=1;ba<O;ba++)this._merge(this.transformPt(Z[ba]),Q)}}_merge(O,Q){O[0]-Q<this._xmin&&(this._xmin=O[0]-Q);O[0]+Q>this._xmax&&(this._xmax=O[0]+Q);O[1]-Q<this._ymin&&(this._ymin=
O[1]-Q);O[1]+Q>this._ymax&&(this._ymax=O[1]+Q)}}class I extends H{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(O,Q,Z,ba,da,P){P*=m.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(P);this._searchPoint=[(O[0]+O[2])/2,(O[1]+O[3])/2];this._searchDistPoint=(O[2]-O[0])/2/P;this._textInfo=ba;this._mapRotation=Q&&("CIMPointSymbol"===Q.type&&"Map"!==Q.angleAlignment||"CIMTextSymbol"===Q.type)?da:0;this._earlyReturn=!1;this.drawSymbol(Q,
Z);return this._earlyReturn}drawSolidFill(O,Q){this._hitTestFill(O)}drawHatchFill(O,Q){this._hitTestFill(O)}drawPictureFill(O,Q){this._hitTestFill(O)}drawGradientFill(O,Q){this._hitTestFill(O)}drawSolidStroke(O,Q,Z,ba,da,P){this._hitTestStroke(O,Z)}drawPictureStroke(O,Q){this._hitTestStroke(O,Q.width)}drawGradientStroke(O,Q){this._hitTestStroke(O,Q.width)}drawMarkerLayer(O,Q){O.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===O.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===O.markerPlacement.type&&
O.markerPlacement.clipAtBoundary)?this._hitTestFill(Q):super.drawMarkerLayer(O,Q)}pushClipPath(O){}popClipPath(){}drawImage(O,Q){var {url:Z}=O;O=h.getValue(O.scaleX,1);Z=this._resourceManager.getResource(Z);if(null!=Z&&0!==Z.height&&0!==Q){Q*=this.geomUnitsPerPoint();O=Z.width/Z.height*O*Q;Z=this.reverseTransformPt(this._searchPoint);var ba=this._searchDistPoint;Math.abs(Z[0])<O/2+ba&&Math.abs(Z[1])<Q/2+ba&&(this._earlyReturn=!0)}}drawText(O,Q){if(Q=this._textInfo)if(Q=Q.get(O)){var {text:Z,mosaicItem:ba}=
Q;if(ba?.glyphMosaicItems?.length){Q=h.getValue(O.height,10);var {lineGapType:da,lineGap:P}=O,U=da?fa(da,h.getValue(P),Q):0,ca=q.bidiText(Z)[1],la="CIMBackgroundCallout"===O.callout?.type;O=z.shapeGlyphs(ba.glyphMosaicItems,ca,{scale:Q/E.glyphSize,angle:0,xOffset:0,yOffset:0,hAlign:R(O.horizontalAlignment),vAlign:Y(O.verticalAlignment),maxLineWidth:512,lineHeight:E.magicLabelLineHeight*Math.max(.25,Math.min(U||1,4)),decoration:O.font.decoration||"none",isCIM:!0,hasBackground:la});U=this.reverseTransformPt(this._searchPoint);
Q=U[0];U=U[1];for(const pa of O.glyphs)if(Q>pa.xTopLeft&&Q<pa.xBottomRight&&U>-pa.yBottomRight&&U<-pa.yTopLeft){this._earlyReturn=!0;break}}}}_hitTestFill(O){let Q=null;if(b.isExtent(O))Q=[[[O.xmin,O.ymin],[O.xmin,O.ymax],[O.xmax,O.ymax],[O.xmax,O.ymin],[O.xmin,O.ymin]]];else if(b.isPolygon(O))Q=O.rings;else if(b.isPolyline(O))Q=O.paths;else return;O=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(O,Q)&&(this._earlyReturn=!0);if(!this._earlyReturn){const Z=this.reverseTransformSize(this._searchDistPoint)*
this.geomUnitsPerPoint();this._nearLine(O,Q,Z)&&(this._earlyReturn=!0)}}_hitTestStroke(O,Q){let Z=null;if(b.isExtent(O))Z=[[[O.xmin,O.ymin],[O.xmin,O.ymax],[O.xmax,O.ymax],[O.xmax,O.ymin],[O.xmin,O.ymin]]];else if(b.isPolygon(O))Z=O.rings;else if(b.isPolyline(O))Z=O.paths;else return;O=this.reverseTransformPt(this._searchPoint);Q=h.getValue(Q,4)*this.geomUnitsPerPoint();const ba=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(O,Z,Q/2+ba)&&(this._earlyReturn=
!0)}_pointInPolygon(O,Q){let Z=0;for(const ba of Q){Q=ba.length;for(let da=1;da<Q;da++){const P=ba[da-1],U=ba[da];P[1]>O[1]!==U[1]>O[1]&&(0<(U[0]-P[0])*(O[1]-P[1])-(U[1]-P[1])*(O[0]-P[0])?Z++:Z--)}}return 0!==Z}_nearLine(O,Q,Z){for(const da of Q){Q=da.length;for(let P=1;P<Q;P++){var ba=da[P-1];const U=da[P];let ca=(U[0]-ba[0])*(U[0]-ba[0])+(U[1]-ba[1])*(U[1]-ba[1]);if(0!==ca&&(ca=Math.sqrt(ca),Math.abs(((U[0]-ba[0])*(O[1]-ba[1])-(U[1]-ba[1])*(O[0]-ba[0]))/ca)<Z&&(ba=((U[0]-ba[0])*(O[0]-ba[0])+(U[1]-
ba[1])*(O[1]-ba[1]))/ca,ba>-Z&&ba<ca+Z)))return!0}}return!1}}class J extends H{constructor(O,Q,Z,ba){super(Q,Z);this._applyAdditionalRenderProps=ba;this._colorSubstitutionHelper=new c;this._ctx=O}drawSolidFill(O,Q){if(O){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(M(O).rings,!0);else if(b.isMultipoint(O))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;O=this._ctx;O.fillStyle=
"string"===typeof Q?Q:"rgba("+Math.round(Q[0])+","+Math.round(Q[1])+","+Math.round(Q[2])+","+(Q[3]??255)/255+")";O.fill("evenodd")}}drawSolidStroke(O,Q,Z,ba,da,P){if(O&&Q&&0!==Z){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!1);else if(b.isExtent(O))this._buildPath(M(O).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}O=this._ctx;O.strokeStyle="string"===typeof Q?Q:"rgba("+Math.round(Q[0])+","+Math.round(Q[1])+
","+Math.round(Q[2])+","+(Q[3]??255)/255+")";O.lineWidth=Math.max(this.transformSize(Z),.5);this._setCapStyle(ba);this._setJoinStyle(da);O.miterLimit=P;O.stroke()}}pushClipPath(O){this._ctx.save();if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(M(O).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(O,Q){const {colorSubstitutions:Z,url:ba,tintColor:da}=O;O=h.getValue(O.scaleX,
1);var P=this._resourceManager.getResource(ba);if(null!=P){var U=P.width/P.height*Q,ca=Q;Q||(U=P.width,ca=P.height);var la=h.isSVGImage(ba)||"src"in P&&h.isSVGImage(P.src);Q="getFrame"in P?t.getFirstFrame(P):P;Z&&(Q=this._colorSubstitutionHelper.applyColorSubstituition(Q,Z));this._applyAdditionalRenderProps&&!la&&da&&(Q=this._colorSubstitutionHelper.tintImageData(Q,da));P=this.transformPt([0,0]);var [pa,na]=this.getTransformAngle();la=this.transformSize(1);var ra=this._ctx;ra.save();ra.setTransform({m11:O*
la*pa,m12:O*la*na,m21:-la*na,m22:la*pa,m41:P[0],m42:P[1]});ra.drawImage(Q,-U/2,-ca/2,U,ca);ra.restore()}}drawText(O,Q){if(Q&&0!==Q.length&&(this._textRasterizer||(this._textRasterizer=new y),O=F(O),O.size*=this.transformSize(m.px2pt(1)),Q=this._textRasterizer.rasterizeText(Q,O))){var {size:Z,anchorX:ba,anchorY:da,canvas:P}=Q;Q=Z[0]*(ba+.5);O=Z[1]*(da-.5);var U=this._ctx,ca=this.transformPt([0,0]),[la,pa]=this.getTransformAngle();U.save();U.setTransform({m11:1*la,m12:1*pa,m21:-1*pa,m22:1*la,m41:ca[0]-
1*Q,m42:ca[1]+1*O});U.drawImage(P,0,0);U.restore()}}drawPictureFill(O,Q){if(O){var {colorSubstitutions:Z,height:ba,offsetX:da,offsetY:P,rotation:U,scaleX:ca,tintColor:la,url:pa}=Q;Q=this._resourceManager.getResource(pa);if(null!=Q){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(M(O).rings,!0);else if(b.isMultipoint(O))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;O=this._ctx;
var na=h.isSVGImage(pa)||"src"in Q&&h.isSVGImage(Q.src),ra="getFrame"in Q?t.getFirstFrame(Q):Q;Z&&(ra=this._colorSubstitutionHelper.applyColorSubstituition(ra,Z));if(this._applyAdditionalRenderProps){if(na||la&&(ra=this._colorSubstitutionHelper.tintImageData(ra,la)),na=O.createPattern(ra,"repeat"),ra=this.transformSize(1),U||(U=0),da=da?ra*da:0,P=P?ra*P:0,ba&&(ba*=ra),ra=ba?ba/Q.height:1,Q=ca&&ba?ca*ba/Q.width:1,0!==U||1!==ra||1!==Q||0!==da||0!==P){const ua=new DOMMatrix;ua.rotateSelf(0,0,-U).translateSelf(da,
P).scaleSelf(Q,ra,1);na.setTransform(ua)}}else na=O.createPattern(ra,"repeat");O.save();O.fillStyle=na;O.fill("evenodd");O.restore()}}}drawPictureStroke(O,Q){if(O){var {colorSubstitutions:Z,capStyle:ba,joinStyle:da,miterLimit:P,tintColor:U,url:ca,width:la}=Q;Q=this._resourceManager.getResource(ca);if(null!=Q){if(b.isPolygon(O))var pa=O.rings;else if(b.isPolyline(O))pa=O.paths;else if(b.isExtent(O))pa=M(O).rings;else{b.isMultipoint(O)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");
return}la||(la=Q.width);O=h.isSVGImage(ca)||"src"in Q&&h.isSVGImage(Q.src);var na="getFrame"in Q?t.getFirstFrame(Q):Q;Z&&(na=this._colorSubstitutionHelper.applyColorSubstituition(na,Z));this._applyAdditionalRenderProps&&(O||U&&(na=this._colorSubstitutionHelper.tintImageData(na,U)));Q=Math.max(this.transformSize(m.pt2px(la)),.5);O=Q/na.width;var ra=this._ctx;na=ra.createPattern(na,"repeat-y");ra.save();this._setCapStyle(ba);this._setJoinStyle(da);void 0!==P&&(ra.miterLimit=P);ra.lineWidth=Q;var ua;
for(let qa of pa){qa=w.clone(qa);var L=ua=void 0,T=void 0;let S=L=void 0;pa=qa;for(var ia=pa[0],ka=1;ka<pa.length;)S=pa[ka][0]-ia[0],L=pa[ka][1]-ia[1],L=0!==S?L/S:Math.PI/2,void 0!==T&&1E-4>=L-T?(pa.splice(ka-1,1),ia=ua):(ua=ia,ia=pa[ka],ka++),T=L;if(qa&&!(1>=qa.length))for(pa=this.transformPt(qa[0]),T=1;T<qa.length;T++)ua=this.transformPt(qa[T]),ia=180/Math.PI*Math.atan2(ua[1]-pa[1],ua[0]-pa[0]),ka=new DOMMatrix,ka.translateSelf(0,pa[1]-Q/2).scaleSelf(O,O,1).rotateSelf(0,0,90-ia),na.setTransform(ka),
ra.strokeStyle=na,ra.beginPath(),ra.moveTo(pa[0],pa[1]),ra.lineTo(ua[0],ua[1]),ra.stroke(),pa=ua}ra.restore()}}}_buildPath(O,Q){const Z=this._ctx;Z.beginPath();if(O)for(const ba of O)if(O=ba?ba.length:0,1<O){let da=this.transformPt(ba[0]);Z.moveTo(da[0],da[1]);for(let P=1;P<O;P++)da=this.transformPt(ba[P]),Z.lineTo(da[0],da[1]);Q&&Z.closePath()}}_setCapStyle(O){switch(O){case n.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case n.LineCapStyle.Round:this._ctx.lineCap="round";break;case n.LineCapStyle.Square:this._ctx.lineCap=
"square"}}_setJoinStyle(O){switch(O){case n.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case n.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case n.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const M=O=>O?{spatialReference:O.spatialReference,rings:[[[O.xmin,O.ymin],[O.xmin,O.ymax],[O.xmax,O.ymax],[O.xmax,O.ymin],[O.xmin,O.ymin]]]}:null,R=O=>{switch(O){case "Left":return A.HAlign.Left;case "Right":return A.HAlign.Right;case "Center":return A.HAlign.Center;case "Justify":return B.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
A.HAlign.Center}},Y=O=>{switch(O){case "Top":return A.VAlign.Top;case "Center":return A.VAlign.Center;case "Bottom":return A.VAlign.Bottom;case "Baseline":return A.VAlign.Baseline}},fa=(O,Q,Z)=>{switch(O){case "ExtraLeading":return 1+Q/Z;case "Multiple":return Q;case "Exact":return Q/Z}};g.CIMSymbolDrawHelper=H;g.CanvasDrawHelper=J;g.EnvDrawHelper=G;g.HittestDrawHelper=I;g.Transformation=u;g.cDegToRad=D;g.defaultHatchFillSeparation=4;g.defaultMarkerSize=10;g.defaultPictureFillHeight=10;g.defaultStrokeWidth=
4;g.defaultTextHaloSize=1;g.defaultTextHeight=10;g.horizontalAlignment2HAlign=R;g.lineGapType2LineHeight=fa;g.verticalAlignment2VAlign=Y;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(g,q){function x(k){if(!k)return"arial-unicode-ms";k=k.toLowerCase().split(" ").join("-");switch(k){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";
case "cursive":return"redressed";default:return k}}function w(k){a:{if(k.weight)switch(k.weight.toLowerCase()){case "bold":case "bolder":var f="-bold";break a}f=""}a:{if(k.style)switch(k.style.toLowerCase()){case "italic":case "oblique":var e="-italic";break a}e=""}f+=e;return x(k.family)+(0<f.length?f:"-regular")}const C=new Map,r=new Set;class m{constructor(k,f){this.fontFace=k;this.promise=f}}g.clearFonts=function(){const k=document.fonts;C.forEach(f=>{k.delete(f.fontFace)});C.clear();r.clear()};
g.defaultFontFamily="arial-unicode-ms";g.getFontFamily=x;g.getFullyQualifiedFontName=w;g.isCachedFontFace=function(k){return r.has(k)};g.loadFont=async function(k){const f=w(k),e=C.get(f);if(e)return e.promise;const l=new FontFace(k.family,`url('${q.fontsUrl}/woff2/${f}.${"woff2"}') format('${"woff2"}')`,{style:k.style,weight:k.weight}),b=document.fonts;if(b.has(l)&&"loading"===l.status)return l.loaded;k=l.load().then(()=>{b.add(l);return l});C.set(f,new m(l,k));r.add(l);return k};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class g{applyColorSubstituition(q,x){if(!x)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:w,height:C}=q,r=this._rasterizationCanvas,m=r.getContext("2d",{willReadFrequently:!0});q!==r&&(r.width=w,r.height=C,m.drawImage(q,0,0,w,C));q=m.getImageData(0,0,w,C).data;if(x)for(var k of x)if(k&&k.oldColor&&4===k.oldColor.length&&
k.newColor&&4===k.newColor.length){const [f,e,l,b]=k.oldColor,[p,c,d,a]=k.newColor;if(f!==p||e!==c||l!==d||b!==a)for(x=0;x<q.length;x+=4)f===q[x]&&e===q[x+1]&&l===q[x+2]&&b===q[x+3]&&(q[x]=p,q[x+1]=c,q[x+2]=d,q[x+3]=a)}k=new ImageData(q,w,C);m.putImageData(k,0,0);return r}tintImageData(q,x){if(!x||4>x.length)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:w,height:C}=q,r=this._rasterizationCanvas,m=r.getContext("2d",{willReadFrequently:!0});
q!==r&&(r.width=w,r.height=C,m.drawImage(q,0,0,w,C));q=m.getImageData(0,0,w,C);q=new Uint8Array(q.data);x=[x[0]/255,x[1]/255,x[2]/255,x[3]/255];for(let k=0;k<q.length;k+=4)q[k]*=x[0],q[k+1]*=x[1],q[k+2]*=x[2],q[k+3]*=x[3];x=new ImageData(new Uint8ClampedArray(q.buffer),w,C);m.putImageData(x,0,0);return r}}return g})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(g){g.getFirstFrame=function(q){const x=q.getFrame(0);if(x instanceof HTMLImageElement||x instanceof HTMLCanvasElement)return x;
const w=document.createElement("canvas");w.width=q.width;w.height=q.height;q=w.getContext("2d");x instanceof ImageData?q.putImageData(x,0,0):q.drawImage(x,0,0);return w};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class g{constructor(q=0,x=0,w=0,C=0){this.x=q;this.y=x;this.width=w;this.height=C}get isEmpty(){return 0>=this.width||0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=Math.min(this.y,q.y);this.width=Math.max(this.width,
q.width);this.height=Math.max(this.height,q.height)}}return g})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(g,q){function x(C){return`rgba(${C.slice(0,3).toString()},${C[3]})`}class w{constructor(C){C&&(this._textRasterizationCanvas=C)}rasterizeText(C,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const m=this._textRasterizationCanvas;var k=m.getContext("2d");this._setFontProperties(k,
r);this._parameters=r;this._textLines=C.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:f,weight:e}=r.font;this._lineThroughWidthOffset=f&&"line-through"===f?.1*this._lineHeight:0;var l=(C=null!=r.backgroundColor||null!=r.borderLine)?q.backgroundPadding:0,b=this._computeTextWidth(k,r)+2*l,p=this._lineHeight*this._textLines.length+2*l;m.width=b+2*this._lineThroughWidthOffset;m.height=p;if(0===m.width||0===m.height)return m.width=m.height=1,{size:[0,0],image:new Uint32Array(0),
sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:m};this._renderedLineHeight=Math.round(this._lineHeight*r.pixelRatio);this._renderedHaloSize=g.pt2px(r.halo.size)*r.pixelRatio;this._renderedWidth=b*r.pixelRatio;this._renderedHeight=p*r.pixelRatio;this._lineThroughWidthOffset*=r.pixelRatio;b=r.halo&&r.halo.color?r.halo.color:[0,0,0,0];this._fillStyle=x(r.color??[0,0,0,0]);this._haloStyle=`rgb(${b.slice(0,3).toString()})`;b=this._renderedLineHeight;var c=this._renderedHaloSize;k.save();k.clearRect(0,
0,m.width,m.height);this._setFontProperties(k,r);p=l*r.pixelRatio;l=k.textAlign;var d=this._renderedWidth-2*p;l=("center"===l?.5*d:"right"===l?d:0)+c+p;p=c+p;c=0<c;d=this._lineThroughWidthOffset;let a=0;if(C){k.save();C=r.backgroundColor??[0,0,0,0];const t=r.borderLine?.color??[0,0,0,0],v=2*g.pt2px(r.borderLine?.size??0);k.fillStyle=x(C);k.strokeStyle=x(t);k.lineWidth=v;k.fillRect(0,0,m.width,m.height);k.strokeRect(0,0,m.width,m.height);k.restore()}c&&this._renderHalo(k,l,p,d,a,r);a+=p;d+=l;for(var n of this._textLines)c&&
(k.globalCompositeOperation="destination-out",k.fillStyle="rgb(0, 0, 0)",k.fillText(n,d,a),k.globalCompositeOperation="source-over"),k.fillStyle=this._fillStyle,k.fillText(n,d,a),f&&"none"!==f&&this._renderDecoration(k,d,a,f,e),a+=b;k.restore();n=this._renderedWidth+2*this._lineThroughWidthOffset;C=this._renderedHeight;k=k.getImageData(0,0,n,C);k=new Uint8Array(k.data);if(r.premultiplyColors)for(l=0;l<k.length;l+=4)b=k[l+3]/255,k[l]*=b,k[l+1]*=b,k[l+2]*=b;switch(r.horizontalAlignment){case "left":b=
-.5;break;case "right":b=.5;break;default:b=0}switch(r.verticalAlignment){case "bottom":r=-.5;break;case "top":r=.5;break;default:r=0}return{size:[n,C],image:new Uint32Array(k.buffer),sdf:!1,simplePattern:!1,anchorX:b,anchorY:r,canvas:m}}_renderHalo(C,r,m,k,f,e){const l=this._renderedWidth,b=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=l;this._haloRasterizationCanvas.height=b;const p=this._haloRasterizationCanvas,
c=p.getContext("2d");c.clearRect(0,0,l,b);this._setFontProperties(c,e);const {decoration:d,weight:a}=e.font;c.fillStyle=this._haloStyle;c.strokeStyle=this._haloStyle;c.lineJoin="round";this._renderHaloNative(c,r,m,d,a);C.globalAlpha=this._parameters.halo.color[3];C.drawImage(p,0,0,l,b,k,f,l,b);C.globalAlpha=1}_renderHaloNative(C,r,m,k,f){const e=this._renderedLineHeight,l=this._renderedHaloSize;for(const b of this._textLines){const p=2*l;for(let c=0;5>c;c++){const d=(.6+.1*c)*p;C.lineWidth=d;C.strokeText(b,
r,m);k&&"none"!==k&&this._renderDecoration(C,r,m,k,f,d)}m+=e}}_setFontProperties(C,r){var m=r.font;m=`${m.style} ${m.weight} ${g.pt2px(Math.max(r.size,.5)*r.pixelRatio).toFixed(1)}px ${m.family}, sans-serif`;C.font=m;C.textBaseline="top";switch(r.horizontalAlignment){case "left":r="left";break;case "right":r="right";break;case "center":r="center";break;default:r="left"}C.textAlign=r}computeTextSize(C,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));
const m=this._textRasterizationCanvas;var k=m.getContext("2d");this._setFontProperties(k,r);this._parameters=r;this._textLines=C.split(/\r?\n/);this._lineHeight=this._computeLineHeight();C=this._computeTextWidth(k,r);k=this._lineHeight*this._textLines.length;m.width=C;m.height=k;return[C*r.pixelRatio,k*r.pixelRatio]}_computeTextWidth(C,r){let m=0;for(const k of this._textLines)m=Math.max(m,C.measureText(k).width);r=r.font;if("italic"===r.style||"oblique"===r.style||"string"===typeof r.weight&&("bold"===
r.weight||"bolder"===r.weight)||"number"===typeof r.weight&&600<r.weight)m+=.3*C.measureText("w").width;m+=2*g.pt2px(this._parameters.halo.size);return Math.round(m)}_computeLineHeight(){let C=1.275*this._parameters.size;const r=this._parameters.font.decoration;r&&"underline"===r&&(C*=1.3);return Math.round(C+2*g.pt2px(this._parameters.halo.size))}_renderDecoration(C,r,m,k,f,e){const l=.9*this._lineHeight;switch(C.textAlign){case "center":r-=this._renderedWidth/2;break;case "right":r-=this._renderedWidth}const b=
C.textBaseline;if("underline"===k)switch(b){case "top":m+=l;break;case "middle":m+=l/2}else if("line-through"===k)switch(b){case "top":m+=l/1.5;break;case "middle":m+=l/3}k=e?1.5*e:Math.ceil(l*("bold"===f?.06:"bolder"===f?.09:.04));C.save();C.beginPath();C.strokeStyle=C.fillStyle;C.lineWidth=k;C.moveTo(r-this._lineThroughWidthOffset,m);C.lineTo(r+this._renderedWidth+2*this._lineThroughWidthOffset,m);C.stroke();C.restore()}}return w})},"esri/symbols/cim/utils":function(){define(["require","exports"],
function(g,q){function x(b){return"function"===typeof b}function w(b){let p=b.length;for(;p--;)if(!" /-,\n".includes(b.charAt(p)))return!1;return!0}function C(b,p){const c=[];var d=0;let a=-1;do a=b.indexOf("[",d),a>=d&&(a>d&&(d=b.substr(d,a-d),c.push([d,null,w(d)])),d=a+1,a=b.indexOf("]",d),a>=d&&(a>d&&(d=b.substr(d,a-d),(d=p[d])&&c.push([null,d,!1])),d=a+1));while(-1!==a);d<b.length-1&&(b=b.substr(d),c.push([b,null,w(b)]));return c}function r(b,p,c){let d="",a=null;for(const n of p){const [t,v,
y]=n;if(t)y?a=t:(a&&(d+=a,a=null),d+=t);else if(p=b.attributes[v])a&&(d+=a,a=null),d+=p}return m(d,c)}function m(b,p){"string"!==typeof b&&(b=String(b));switch(p){case "LowerCase":return b.toLowerCase();case "Allcaps":return b.toUpperCase();default:return b}}function k(b){return b?{r:b[0],g:b[1],b:b[2],a:b[3]/255}:{r:0,g:0,b:0,a:0}}function f(b){if(!b)return null;switch(b.type){case "CIMPolygonSymbol":if(b.symbolLayers)for(const p of b.symbolLayers)if(b=f(p),null!=b)return b;break;case "CIMTextSymbol":return f(b.symbol);
case "CIMSolidFill":return b.color}}function e(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b=b.symbolLayers)for(const p of b)if(b=e(p),null!=b)return b;break;case "CIMTextSymbol":return e(b.symbol);case "CIMSolidStroke":return b.color}}function l(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b.symbolLayers)for(const p of b.symbolLayers)if(b=l(p),void 0!==b)return b;break;case "CIMTextSymbol":return l(b.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return b.width}}
q.adjustTextCase=m;q.analyzeTextParts=C;q.assignTextValuesFromFeature=r;q.attributesToFields=function(b){return(b?Object.keys(b):[]).map(p=>({name:p,alias:p,type:"string"===typeof b[p]?"esriFieldTypeString":"esriFieldTypeDouble"}))};q.colorToArray=function(b){return[b.r,b.g,b.b,b.a]};q.createLabelOverrideFunction=function(b,p,c){const d=C(p,b);return a=>r(a,d,c)};q.evaluateValueOrFunction=function(b,p,c,d){return x(b)?b(p,c,d):b};q.fromCIMColor=k;q.fromCIMFontDecoration=function(b){return b.underline?
"underline":b.strikethrough?"line-through":"none"};q.fromCIMFontStyle=function(b){let p="normal",c="normal";b&&(b=b.toLowerCase(),b.includes("italic")?p="italic":b.includes("oblique")&&(p="oblique"),b.includes("bold")?c="bold":b.includes("light")&&(c="lighter"));return{style:p,weight:c}};q.fromCIMHorizontalAlignment=function(b){switch(b){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};q.fromCIMVerticalAlignment=function(b){switch(b){default:return"top";
case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};q.getFillColor=f;q.getFontStyle=function(b){if(!b)return"normal";switch(b.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};q.getFontWeight=function(b){if(!b)return"normal";switch(b.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};q.getStrokeColor=e;q.getStrokeWidth=l;q.getTintColor=
b=>b.tintColor?k(b.tintColor):{r:255,g:255,b:255,a:1};q.getValue=(b,p=0)=>null==b||isNaN(b)?p:b;q.importGeometryEngine=function(){return new Promise((b,p)=>g(["../../geometry/geometryEngineJSON"],b,p))};q.isCIMFill=function(b){return null!=b&&("CIMGradientFill"===b.type||"CIMHatchFill"===b.type||"CIMPictureFill"===b.type||"CIMSolidFill"===b.type||"CIMWaterFill"===b.type)};q.isCIMMarker=function(b){return"CIMVectorMarker"===b.type||"CIMPictureMarker"===b.type||"CIMBarChartMarker"===b.type||"CIMCharacterMarker"===
b.type||"CIMPieChartMarker"===b.type||"CIMStackedBarChartMarker"===b.type};q.isCIMMarkerStrokePlacement=function(b){return null!=b&&("CIMMarkerPlacementAlongLineRandomSize"===b.type||"CIMMarkerPlacementAlongLineSameSize"===b.type||"CIMMarkerPlacementAlongLineVariableSize"===b.type||"CIMMarkerPlacementAtExtremities"===b.type||"CIMMarkerPlacementAtMeasuredUnits"===b.type||"CIMMarkerPlacementAtRatioPositions"===b.type||"CIMMarkerPlacementOnLine"===b.type||"CIMMarkerPlacementOnVertices"===b.type)};q.isCIMStroke=
function(b){return"CIMGradientStroke"===b.type||"CIMPictureStroke"===b.type||"CIMSolidStroke"===b.type};q.isFeatureValueFn=x;q.isGeometryEngineRequired=b=>{if(!b)return!1;for(const p of b)switch(p.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};q.isSVGImage=b=>b.includes("data:image/svg+xml");q.mapCIMSymbolToGeometryType=function(b){if(!b)return null;switch(b.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";
case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};q.resampleHermite=function(b,p,c,d,a,n,t=!0){const v=p/a;c/=n;const y=Math.ceil(v/2),h=Math.ceil(c/2);for(let z=0;z<n;z++)for(let F=0;F<a;F++){const D=4*(F+(t?n-z-1:z)*a);var A=0;let B=0,u=0,H=0,G=0,I=0,J=0;const M=(z+.5)*c;for(let R=Math.floor(z*c);R<(z+1)*c;R++){var E=Math.abs(M-(R+.5))/h;const Y=(F+.5)*v;E*=E;for(let fa=Math.floor(F*v);fa<(F+1)*v;fa++){let O=Math.abs(Y-(fa+
.5))/y;A=Math.sqrt(E+O*O);-1<=A&&1>=A&&(A=2*A*A*A-3*A*A+1,0<A&&(O=4*(fa+R*p),J+=A*b[O+3],u+=A,255>b[O+3]&&(A=A*b[O+3]/250),H+=A*b[O],G+=A*b[O+1],I+=A*b[O+2],B+=A))}}d[D]=H/B;d[D+1]=G/B;d[D+2]=I/B;d[D+3]=J/u}};q.toCIMSymbolJSON=function(b){return b.data?.symbol??null};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(g,
q,x){function w(r){const m={};switch(r){case "esriGeometryPoint":return(k,f,e,l)=>x.unquantizePoint(f,m,k,e,l);case "esriGeometryPolygon":return(k,f,e,l)=>x.unquantizePolygon(f,m,k,e,l);case "esriGeometryPolyline":return(k,f,e,l)=>x.unquantizePolyline(f,m,k,e,l);case "esriGeometryMultipoint":return(k,f,e,l)=>x.unquantizeMultipoint(f,m,k,e,l);default:return q.getLogger("esri.views.2d.support.arcadeOnDemand").error(new g("mapview-arcade",`Unable to handle geometryType: ${r}`)),k=>k}}const C=new Map;
return function(r,m,k,f,e){if(null==r)return null;if(r.referencesGeometry()&&e){const {transform:l,hasZ:b,hasM:p}=e;C.has(f)||C.set(f,w(f));f=C.get(f)(m.geometry,l,b,p);m={...m,geometry:f}}m=r.repurposeFeature(m);try{return r.evaluate({...k,$feature:m},r.services)}catch(l){return q.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b){class p extends l(b){constructor(c,d,a,n,t,v,y,h,A,E,z,F,D,B,u,H,G,I,J,M,R,Y,fa,O){super();this.angle=n;this.height=y;this.width=v;this.xOffset=d*J;this.yOffset=a*J;this._markerPlacement=M||void 0;this._effects=R||void 0;this._anchorX=H;this._anchorY=G;this._minMaxZoom=k.i1616to32(Math.round(Y*r.minMaxZoomPrecisionFactor),Math.round(fa*r.minMaxZoomPrecisionFactor));d=(B===w.Alignment.MAP?r.bitsetMarkerAlignmentMap:r.bitsetMarkerAlignmentScreen)|(z?r.bitsetGenericLockColor:
0)|(D?r.bitsetMarkerOutlineAllowColorOverride:0)|(F?r.bitsetMarkerScaleSymbolsProportionally:0);a=u&&u.sdf;c=f.MarkerMaterialKey.load(c);c.sdf=a;c.pattern=!0;c.textureBinding=u.textureBinding;this._materialKey=c.data;this._fillColor=t;this._outlineColor=A;this._sizeOutlineWidth=k.i8888to32(Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*E),255)),Math.round(Math.min(Math.sqrt(128*h),255)));c.symbologyType===m.WGLSymbologyType.PIE_CHART?
(this._computedWidth=v*I*J,this._computedHeight=y*I*J,this._texUpperLeft=k.i1616to32(0,1),this._texUpperRight=k.i1616to32(1,1),this._texBottomLeft=k.i1616to32(0,0),this._texBottomRight=k.i1616to32(1,0)):this._computeSize(v,y,I,E,J,u,c.hasSizeVV(),O);this._bitestAndDistRatio=k.i1616to32(d,Math.round(64*I));t=x.create();v=q.create();this._applyTransformation(v,t)}static fromCIMMarker(c,d,a){const n=c.size,t=(d&&d.width||1)/(d&&d.height||1)*c.scaleX;var v=c.scaleSymbolsProportionally&&c.frameHeight?
n/c.frameHeight:1;const y=C.premultiplyAlphaRGBA(c.color),h=C.premultiplyAlphaRGBA(c.outlineColor),A=g.pt2px(n),E=A*t,z=g.pt2px(c.offsetX||0),F=g.pt2px(c.offsetY||0);v*=g.pt2px(c.outlineWidth||0);const D=c.alignment||w.Alignment.SCREEN,B=g.pt2px(c.referenceSize),[u,H]=e.getMinMaxZoom(c.scaleInfo,a);a=c.rotation||0;c.rotateClockwise||(a=-a);let G=0,I=0;const J=c.anchorPoint;J&&(c.isAbsoluteAnchorPoint?n&&(G=J.x/(n*t),I=J.y/n):(G=J.x,I=J.y));d=new p(c.materialKey,z,F,a,y,E,A,B,h,v,c.colorLocked,c.scaleSymbolsProportionally,
!1,D,d,G,I,c.sizeRatio,c.scaleFactor??1,c.markerPlacement,c.effects,u,H,!0);d._vertexBoundsScaleX=c.maxVVSize?c.maxVVSize/E:1;d._vertexBoundsScaleY=c.maxVVSize?c.maxVVSize/A:1;return d}static fromPictureMarker(c,d){const a=Math.round(g.pt2px(c.width)),n=Math.round(g.pt2px(c.height)),t=r.pictureFillColor,v=Math.round(g.pt2px(c.xoffset||0)),y=Math.round(g.pt2px(c.yoffset||0));d=new p(c.materialKey,v,y,c.angle,t,a,n,n,0,0,!1,!1,!1,w.Alignment.SCREEN,d,0,0,1,1,null,null,e.defaultMinZoom,e.defaultMaxZoom,
!1);d._vertexBoundsScaleX=c.maxVVSize?c.maxVVSize/c.width:1;d._vertexBoundsScaleY=c.maxVVSize?c.maxVVSize/c.height:1;return d}static fromSimpleMarker(c,d){const a=c.style,n=C.premultiplyAlphaRGBAArray(c.color),t=Math.round(g.pt2px(c.size));let v=t;"esriSMSTriangle"===a&&(v*=d.height/d.width);const y=Math.round(g.pt2px(c.xoffset||0)),h=Math.round(g.pt2px(c.yoffset||0));var A=c.outline;const E=(A?.color&&C.premultiplyAlphaRGBAArray(A.color))|0;A=(A?.width&&Math.round(g.pt2px(A.width)))|0;d=new p(c.materialKey,
y,h,c.angle??0,n,t,v,v,E,A,!1,!1,"esriSMSCross"===a||"esriSMSX"===a,w.Alignment.SCREEN,d,0,0,2,1,null,null,e.defaultMinZoom,e.defaultMaxZoom,!1);d.boundsType="esriSMSCircle"===a?"circle":"square";d._vertexBoundsScaleX=c.maxVVSize?c.maxVVSize/c.size:1;d._vertexBoundsScaleY=c.maxVVSize?c.maxVVSize/c.size:1;return d}static fromLineSymbolMarker(c,d){const a=C.premultiplyAlphaRGBAArray(c.color),n=Math.round(g.pt2px(6*c.lineWidth)),t="cross"===c.style||"x"===c.style;switch(c.placement){case "begin-end":var v=
w.ExtremityPlacement.Both;break;case "begin":v=w.ExtremityPlacement.JustBegin;break;case "end":v=w.ExtremityPlacement.JustEnd;break;default:v=w.ExtremityPlacement.None}v={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:v,offsetAlongLine:0};d=new p(c.materialKey,0,0,0,a,n,n,n/6,a,t?Math.round(g.pt2px(c.lineWidth)):0,!1,!1,t,w.Alignment.MAP,d,0,0,2,1,v,null,e.defaultMinZoom,e.defaultMaxZoom,!1);d.boundsType="circle"===c.style?"circle":"square";return d}}return p})},
"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey".split(" "),function(g,q,x,w,C,r,m,k,f,e,l){const b=3.14159265359/180;return p=>
class extends p{constructor(...c){super(...c);this.height=this.width=this.yOffset=this.xOffset=this.angle=0;this.boundsType="square";this._computedHeight=this._computedWidth=this._anchorY=this._anchorX=0;this._allowBorrowing=!0;this._vertexBoundsScaleY=this._vertexBoundsScaleX=1;this.geometryType=f.WGLGeometryType.MARKER}_write(c,d,a,n){const t=d.getDisplayId();c.recordStart(t,this._materialKey,this.geometryType,!0);this._writeGeometry(c,d,t,a,n);c.recordEnd()}_writeGeometry(c,d,a,n,t){if(null!=this._markerPlacement)return this._writePlacedMarkers(c,
d,n,t);this._allowBorrowing=!0;if(!t&&"esriGeometryPoint"===d.geometryType)return n=d.getX(),d=d.getY(),!c.hasAggregates&&c.hasPixelBufferEnabled&&(0>n||513<=n||0>d||513<=d)?void 0:this._writeVertices(c,a,this._getPos(n,d),n,d);d=t?t.asOptimized():"esriGeometryPolygon"===d.geometryType?d.readCentroid():d.readGeometryForDisplay();if(null!=d){if(d.isPoint){const [v,y]=d.coords;return!c.hasAggregates&&c.hasPixelBufferEnabled&&(0>v||512<=v||0>y||512<=y)?void 0:this._writeVertices(c,a,this._getPos(v,y),
v,y)}d.forEachVertex((v,y)=>{const h=2*k.tileSize;v<-h||v>=h||y<-h||y>=h||this._writeVertices(c,a,this._getPos(v,y),v,y)})}}_writePlacedMarkers(c,d,a,n){if(n=n||r.GeometryCursor.fromFeatureSetReaderCIM(d))if(a=m.CIMMarkerPlacementHelper.getPlacement(n,-1,this._markerPlacement,g.pt2px(1),c.tileKey,a.geometryEngine)){this._allowBorrowing="esriGeometryPolygon"!==d.geometryType;d=d.getDisplayId();n=C.create();for(var t=x.create(),v=a.next();null!=v;){const y=v.tx,h=-v.ty;-128<=y&&640>=y&&-128<=h&&640>=
h&&(this._applyTransformation(t,n,-v.getAngle()/b),this._writeVertices(c,d,this._getPos(y,h),y,h));v=a.next()}}}_writeVertices(c,d,a,n,t){const v=l.MarkerMaterialKey.load(this._materialKey);switch(v.symbologyType){case f.WGLSymbologyType.HEATMAP:return this._writeHeatmapVertices(c,d,a);default:return this._writeMarkerVertices(c,d,v,a,n,t)}}_writeMarkerVertices(c,d,a,n,t,v){var y=a.vvRotation;a=c.vertexCount();let h=this._computedWidth*this._vertexBoundsScaleX;var A=this._computedHeight*this._vertexBoundsScaleY;
this.angle&&(h=A=Math.max(h,A));y&&(y=Math.max(this.xOffset,this.yOffset),h+=y,A+=y);this._allowBorrowing&&c.vertexBounds(t+this.xOffset,v-this.yOffset,h,A);c.vertexWrite(n);c.vertexWrite(this._offsetUpperLeft);c.vertexWrite(this._texUpperLeft);c.vertexWrite(this._bitestAndDistRatio);c.vertexWrite(d);c.vertexWrite(this._fillColor);c.vertexWrite(this._outlineColor);c.vertexWrite(this._sizeOutlineWidth);c.vertexWrite(this._minMaxZoom);c.vertexEnd();c.vertexWrite(n);c.vertexWrite(this._offsetUpperRight);
c.vertexWrite(this._texUpperRight);c.vertexWrite(this._bitestAndDistRatio);c.vertexWrite(d);c.vertexWrite(this._fillColor);c.vertexWrite(this._outlineColor);c.vertexWrite(this._sizeOutlineWidth);c.vertexWrite(this._minMaxZoom);c.vertexEnd();c.vertexWrite(n);c.vertexWrite(this._offsetBottomLeft);c.vertexWrite(this._texBottomLeft);c.vertexWrite(this._bitestAndDistRatio);c.vertexWrite(d);c.vertexWrite(this._fillColor);c.vertexWrite(this._outlineColor);c.vertexWrite(this._sizeOutlineWidth);c.vertexWrite(this._minMaxZoom);
c.vertexEnd();c.vertexWrite(n);c.vertexWrite(this._offsetBottomRight);c.vertexWrite(this._texBottomRight);c.vertexWrite(this._bitestAndDistRatio);c.vertexWrite(d);c.vertexWrite(this._fillColor);c.vertexWrite(this._outlineColor);c.vertexWrite(this._sizeOutlineWidth);c.vertexWrite(this._minMaxZoom);c.vertexEnd();this._writeIndices(c,a)}_writeHeatmapVertices(c,d,a){const n=c.vertexCount();c.vertexWrite(a);c.vertexWrite(this._offsetUpperLeft);c.vertexWrite(d);c.vertexEnd();c.vertexWrite(a);c.vertexWrite(this._offsetUpperRight);
c.vertexWrite(d);c.vertexEnd();c.vertexWrite(a);c.vertexWrite(this._offsetBottomLeft);c.vertexWrite(d);c.vertexEnd();c.vertexWrite(a);c.vertexWrite(this._offsetBottomRight);c.vertexWrite(d);c.vertexEnd();this._writeIndices(c,n)}_writeIndices(c,d){c.indexWrite(d+0);c.indexWrite(d+1);c.indexWrite(d+2);c.indexWrite(d+1);c.indexWrite(d+3);c.indexWrite(d+2)}_applyTransformation(c,d,a=0){a?q.fromRotation(c,b*a):q.identity(c);q.translate(c,c,C.fromValues(this.xOffset,-this.yOffset));this.angle&&q.rotate(c,
c,b*this.angle);a=this._computedWidth;const n=this._computedHeight,t=-(.5+this._anchorX)*a,v=-(.5-this._anchorY)*n;w.set(d,t,v);w.transformMat2d(d,d,c);this._offsetUpperLeft=e.i1616to32(16*d[0],16*d[1]);w.set(d,t+a,v);w.transformMat2d(d,d,c);this._offsetUpperRight=e.i1616to32(16*d[0],16*d[1]);w.set(d,t,v+n);w.transformMat2d(d,d,c);this._offsetBottomLeft=e.i1616to32(16*d[0],16*d[1]);w.set(d,t+a,v+n);w.transformMat2d(d,d,c);this._offsetBottomRight=e.i1616to32(16*d[0],16*d[1])}_computeSize(c,d,a,n,t,
v,y,h){const A=c*a;a*=d;v.sdf&&!y?(n+=2,c=Math.min((h&&c>d?A:c)+n,A),d=Math.min(d+n,a)):(c=A,d=a);h=k.sdfTextureSize/Math.max(A,a);y=.5*(A-c)*h;var E=.5*(a-d)*h;h=v.rect.x+k.spritePadding+y;n=v.rect.y+k.spritePadding+E;y=h+v.width-2*y;v=n+v.height-2*E;E=Math.floor(h);const z=Math.floor(n),F=Math.ceil(y),D=Math.ceil(v);c*=(F-E)/(y-h);d*=(D-z)/(v-n);this._texUpperLeft=e.i1616to32(E,z);this._texUpperRight=e.i1616to32(F,z);this._texBottomLeft=e.i1616to32(E,D);this._texBottomRight=e.i1616to32(F,D);this._anchorX*=
A/c;this._anchorY*=a/d;this._computedWidth=c*t;this._computedHeight=d*t}_getPos(c,d){return e.i1616to32(Math.round(8*c),Math.round(8*d))}}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaultsJSON ../../enums ../../materialKey/MaterialKey ./WGLDynamicFillTemplate ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/Lock ../../util/Result ../../../../layers/features/textUtils ../../../../layers/support/cimSymbolUtils".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t,v){function y(u,H){const G=u.length;u.push(null);H.then(I=>u[G]=I);return u}function h(u){return null!=u&&!!(u&1)}const A=x.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),E={sortKey:null,templates:[]};x={isOutline:!1,placement:null,symbologyType:r.WGLSymbologyType.DEFAULT,vvFlags:0};const z={...C.errorPointSymbolJSON,hash:JSON.stringify(C.errorPointSymbolJSON),materialKey:m.createMaterialKey(r.WGLGeometryType.MARKER,x)},F={...C.errorPolylineSymbolJSON,
hash:JSON.stringify(C.errorPolylineSymbolJSON),materialKey:m.createMaterialKey(r.WGLGeometryType.LINE,x)},D={...C.errorPolygonSymbolJSON,hash:JSON.stringify(C.errorPolygonSymbolJSON),materialKey:m.createMaterialKey(r.WGLGeometryType.FILL,x)};class B{constructor(u,H){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=new Map;this._cimAnalyses=[];this._lock=new a.Lock;this._fetchResource=
u;this._tileInfo=H}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(u,H,G=null){this._initErrorTemplates();const I=u.hash;var J=this._symbolToTemplate.get(I);if(null!=J)return J;J=[];G={sortKey:G,templates:J};H&&this._createMeshTemplates(J,H,!0);this._createMeshTemplates(J,u,!1);H=this._createGroupId;if(J="expanded-cim"===
u.type)a:{if(u.layers)for(const M of u.layers)if("function"===typeof M.materialHash){J=!0;break a}J=!1}u=H.call(this,J);this._idToTemplateGroup.set(u,G);this._symbolToTemplate.set(I,u);return u}getTemplateGroup(u){return this._idToTemplateGroup.get(u)??E}getDynamicTemplateGroup(u){if(!this._idToTemplateGroup.has(u))return E;h(u)||A.error("mapview-template-store",`Id ${u} does not refer to a dynamic template`);return this._idToTemplateGroup.get(u)}getMosaicItem(u,H){const G=this._createTemplateId(),
I=new Promise(J=>this._idToResolver.set(G,J));this._fetchQueue.push({symbol:u,id:G,glyphIds:H});return I}finalize(u){return this._fetchQueue.length||this._lock.isHeld()?a.withLock(this._lock,this._fetchAllQueuedResources.bind(this),u):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],D,!1),marker:this._createMeshTemplates([],z,!1),line:this._createMeshTemplates([],F,!1)})}_fetchAllQueuedResources(u){if(!this._fetchQueue.length)return Promise.resolve();
const H=this._fetchQueue,G=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return Promise.all(G).then(()=>this._fetchResource(H,u).then(I=>{for(const {id:J,mosaicItem:M}of I)this._idToResolver.get(J)(M),this._idToResolver.delete(J)})).catch(I=>{w.isAbortError(I)?this._fetchQueue=this._fetchQueue.concat(H):"worker:port-closed"!==I.name&&A.error(new q("mapview-template-store","Unable to fetch requested texture resources",I))})}_createGroupId(u){return this._idCounter++<<1|(u?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(u){const {spriteMosaicItem:H}=
await this.getMosaicItem(u);return n.ok(H,A)?c.fromSimpleMarker(u,H):this._markerError}async _createPMS(u){const {spriteMosaicItem:H}=await this.getMosaicItem(u);return n.ok(H,A)?c.fromPictureMarker(u,H):this._markerError}async _createSFS(u,H){const {spriteMosaicItem:G}=await this.getMosaicItem(u);return n.ok(G,A)?b.fromSimpleFill(u,G,H):this._fillError}async _createPFS(u,H){const {spriteMosaicItem:G}=await this.getMosaicItem(u);return n.ok(G,A)?b.fromPictureFill(u,G,H):this._fillError}async _createSLS(u,
H){({spriteMosaicItem:H}=await this.getMosaicItem(u));return n.ok(H,A)?p.fromSimpleLine(u,H):this._lineError}async _createLMS(u){const {spriteMosaicItem:H}=await this.getMosaicItem(u);return n.ok(H,A)?c.fromLineSymbolMarker(u,H):this._markerError}async _createTS(u){const {glyphMosaicItems:H}=await this.getMosaicItem(u);return d.fromText(u,H??[])}async _createCIMText(u){const {glyphMosaicItems:H}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(u),t.codepoints(u.text));return n.ok(H,A)?d.fromCIMText(u,
H,this._tileInfo):this._textError}async _createCIMFill(u){const {spriteMosaicItem:H}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(u));return n.ok(H,A)?b.fromCIMFill(u,H,this._tileInfo):this._fillError}async _createCIMLine(u){const {spriteMosaicItem:H}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(u));return n.ok(H,A)?p.fromCIMLine(u,H,this._tileInfo):this._lineError}async _createCIMMarker(u){const {spriteMosaicItem:H}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(u));return n.ok(H,
A)?c.fromCIMMarker(u,H,this._tileInfo):this._markerError}async _createCIM(u){const H=u.templateHash;let G=this._cimTemplateCache.get(H);if(null!=G)return G;switch(u.type){case "marker":G=await this._createCIMMarker(u);break;case "line":G=await this._createCIMLine(u);break;case "fill":G=await this._createCIMFill(u);break;case "text":G=await this._createCIMText(u)}this._cimTemplateCache.set(H,G);return G}async _createDynamicCIM(u){const H=u.templateHash;let G=this._cimTemplateCache.get(H);if(null!=
G)return G;switch(u.type){case "marker":G=e.fromCIMMarker(u,this._tileInfo);break;case "line":G=f.fromCIMLine(u,this._tileInfo);break;case "fill":G=k.fromCIMFill(u,this._tileInfo);break;case "text":G=l.fromCIMText(u,this._tileInfo)}this._cimTemplateCache.set(H,G);return G}_createPrimitiveMeshTemplates(u,H,G){switch(H.type){case "esriSMS":return y(u,this._createSMS(H));case "esriPMS":return y(u,this._createPMS(H));case "esriSFS":return y(u,this._createSFS(H,G));case "line-marker":return y(u,this._createLMS(H));
case "esriPFS":return y(u,this._createPFS(H,G));case "esriSLS":return y(u,this._createSLS(H,!1));case "esriTS":return y(u,this._createTS(H));default:return A.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),u}}_createMeshTemplates(u,H,G){if(H.type.includes("3d"))return A.error("3D symbols are not supported with MapView"),u;if("expanded-cim"===H.type){for(const I of H.layers)"function"===typeof I.materialHash?y(u,this._createDynamicCIM(I)):y(u,this._createCIM(I));
return u}if("composite-symbol"===H.type){for(const I of H.layers)this._createPrimitiveMeshTemplates(u,I,G);return u}return"cim"===H.type||"label"===H.type||"web-style"===H.type?u:this._createPrimitiveMeshTemplates(u,H,G)}}g.WGLTemplateStore=B;g.errorPointSchema2D=z;g.errorPolygonSchema2D=D;g.errorPolylineSchema2D=F;g.isDynamicId=h;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicFillTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){class b extends f(e){constructor(p,c,d){super(p);this._minMaxZoom=r.i1616to32(Math.round(c*w.minMaxZoomPrecisionFactor),Math.round(d*w.minMaxZoomPrecisionFactor));q.isFeatureValueFn(p.color)?this._dynamicPropertyMap.set("fillColor",(h,A,E)=>(h=p.color(h,A,E))&&x.premultiplyAlphaRGBA(h)||0):this.fillColor=(c=p.color)&&x.premultiplyAlphaRGBA(c)||0;const a="CIMMarkerPlacementInsidePolygon"===p.cim.placement?.type&&p.cim.placement.shiftOddRows?2:1,n=p.height;q.isFeatureValueFn(n)?
this._dynamicPropertyMap.set("_height",(h,A,E)=>n(h,A,E)*a):this._height=(n||0)*a;const t=p.offsetX;q.isFeatureValueFn(t)?this._dynamicPropertyMap.set("_offsetX",(h,A,E)=>g.pt2px(t(h,A,E))):this._offsetX=g.pt2px(t||0);const v=p.offsetY;q.isFeatureValueFn(v)?this._dynamicPropertyMap.set("_offsetY",(h,A,E)=>g.pt2px(-v(h,A,E))):this._offsetY=g.pt2px(-v||0);c=p.scaleX;q.isFeatureValueFn(c)?this._dynamicPropertyMap.set("_scaleX",c):this._scaleX=c||1;const y=p.angle;q.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_angle",
(h,A,E)=>C.degToByte(y(h,A,E))):this._angle=C.degToByte(y)||0;null!=p.effects&&(c=p.effects,q.isFeatureValueFn(c)?this._dynamicPropertyMap.set("_effects",c):this._effects=c);this._cimFillLayer=p;this._bitset=(p.colorLocked?w.bitsetGenericLockColor:0)|(p.applyRandomOffset?w.bitsetFillRandomPatternOffset:0)|(p.sampleAlphaOnly?w.bitsetGenericConsiderAlphaOnly:0)|(p.hasUnresolvedReplacementColor?w.bitsetFillHasUnresolvedReplacementColor:0);this._fillMaterialKey=p.materialKey}static fromCIMFill(p,c){const [d,
a]=k.getMinMaxZoom(p.scaleInfo,c);return new b(p,d,a)}bindFeature(p,c,d){const a=p.readLegacyFeature();this._dynamicPropertyMap.forEach((v,y)=>{this[y]=v(a,c,d)});p=m.FillMaterialKey.load(this._fillMaterialKey);var n=this._materialCache,t=this._cimFillLayer.materialHash;t=t(a,c,d);t=n.get(t);n=null;t&&l.ok(t.spriteMosaicItem)&&(n=t.spriteMosaicItem);if(n){const {rect:v,width:y,height:h}=n;t=v.x+w.spritePadding;const A=v.y+w.spritePadding,E=t+y,z=A+h;let F=g.pt2px(this._height);0>=F&&(F=z-A);F<w.maxSizeForU16Compression&&
(F*=w.compressionFactorForU16,this._bitset|=w.bitsetFillHasPatternHeightPrecisionFactor);F=Math.round(F);let D=g.pt2px(this._height/h*y);0>=D&&(D=E-t);D<w.maxSizeForU16Compression&&(D*=w.compressionFactorForU16,this._bitset|=w.bitsetFillHasPatternWidthPrecisionFactor);D=Math.round(D);const B=this._scaleX;this.tl=r.i1616to32(t,A);this.br=r.i1616to32(E,z);this.aux21=r.i1616to32(D,F);this.aux22=r.i1616to32(this._offsetX,this._offsetY);this.aux3=r.i8888to32(B*w.compressionFactorForU16,1*w.compressionFactorForU16,
this._angle,0);p.sdf=n.sdf;p.pattern=!0;p.textureBinding=n.textureBinding}else this.aux3=this.aux22=this.aux21=this.br=this.tl=0,p.sdf=!1,p.pattern=!1,p.textureBinding=0;this._materialKey=p.data}}return b})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(g){function q(r,m){r%=m;return 0<=r?r:r+m}const x=128/Math.PI,w=256/360,C=1/Math.LN2;g.between=function(r,m,k){return r>=m&&r<=k||r>=k&&r<=m};g.degToByte=function(r){return q(r*w,256)};g.interpolate=function(r,m,
k){return r*(1-k)+m*k};g.log2=function(r){return Math.log(r)*C};g.positiveMod=q;g.radToByte=function(r){return q(r*x,256)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseFillTemplate":function(){define("../../enums ../../number ../../Utils ../../materialKey/MaterialKey ./templateUtils ./WGLLineTemplate".split(" "),function(g,q,x,w,C,r){return m=>class extends m{constructor(...k){super(...k);this.forceLibtess=!1;this._bitset=0;this._lineTemplate=
null;this.geometryType=g.WGLGeometryType.FILL}_maybeAddLineTemplate(k){this._lineTemplate=r.fromFillOutline(k)}_write(k,f,e,l){e="esriGeometryPoint"===f.geometryType;const b=w.FillMaterialKey.load(this._materialKey);k.recordStart(f.getDisplayId(),this._materialKey,this.geometryType,e);this._writeGeometry(k,f,b,l,e);w.hasOutlineFillSymbology(b)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(k,f,l,e);k.recordEnd()}_writeGeometry(k,f,e,l,b){l=this._getGeometry(f,l,b);null!=l&&(b=[],100<
l.maxLength||this.forceLibtess||!C.triangulate(b,l)?(l=C.triangulateLibtess(l),this._writeVertices(k,f,l,[l.length/2],e)):b.length&&this._writeVertices(k,f,l.coords,l.lengths,e,b))}_writeVertex(k,f,e,l,b,p){const c=q.i1616to32(1*l,1*b);k.vertexBounds(l,b,0,0);k.vertexWrite(c);k.vertexWrite(f);e.symbologyType===g.WGLSymbologyType.DOT_DENSITY?k.vertexWriteF32(1/Math.abs(p.readGeometryArea())):(k.vertexWrite(this.fillColor),f=w.hasSimpleSymbology(e),f||(k.vertexWrite(this.tl),k.vertexWrite(this.br)),
k.vertexWrite(this.aux21),k.vertexWrite(this.aux22),k.vertexWrite(this.aux3),f||k.vertexWrite(this._minMaxZoom))}_writeVertices(k,f,e,l,b,p){var c=f.getDisplayId();c|=this._bitset<<24;var d=l.reduce((n,t)=>n+t);const a=x.getStrides(b.geometryType,b.symbologyType).geometry/4;l=k.vertexCount();k.vertexEnsureSize(a*d);d=0;if(p)for(const n of p)this._writeVertex(k,c,b,e[2*n],e[2*n+1],f),d++;else for(p=0;p<e.length;p+=2)this._writeVertex(k,c,b,Math.round(e[p]),Math.round(e[p+1]),f),d++;k.indexEnsureSize(d);
for(f=0;f<d;f++)k.indexWrite(f+l)}_getGeometry(k,f,e){return(k=f?.asOptimized()||k.readGeometryForDisplay())?C.clipMarshall(k,e?256:8):null}}})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),function(g,q,x,w,C,r,m){function k(b,p,c){let d=0;for(let a=1;a<c;a++)d+=
(b[2*(p+a)]-b[2*(p+a-1)])*(b[2*(p+a)+1]+b[2*(p+a-1)+1]);return d}function f(b,p,c,d,a){let n=0;for(;c<d;c+=3){const t=2*(b[c]-a),v=2*(b[c+1]-a),y=2*(b[c+2]-a);n+=Math.abs((p[t]-p[y])*(p[v+1]-p[t+1])-(p[t]-p[v])*(p[y+1]-p[t+1]))}return n}const e=new w.TileClipper(0,0,0,1,0),l=new w.TileClipper(0,0,0,1,0);e.setExtent(r.tileSize);l.setExtent(r.tileSize);g.area=k;g.clipLinesMarshall=function(b,p){l.setPixelMargin(p);const c=-p;p=r.tileSize+p;let d=[];var a=!1;if(!b.nextPath())return null;let n=!0;for(;n;){b.seekPathStart();
const t=[];if(!b.pathSize)return null;l.reset(w.GeometryType.LineString);b.nextPoint();let v=b.x,y=b.y;if(a)l.moveTo(v,y);else{if(v<c||v>p||y<c||y>p){a=!0;continue}t.push({x:v,y})}let h=!1;for(;b.nextPoint();)if(v=b.x,y=b.y,a)l.lineTo(v,y);else{if(v<c||v>p||y<c||y>p){h=!0;break}t.push({x:v,y})}if(h)a=!0;else{if(a){if(a=l.resultWithStarts())for(const A of a)d.push(A)}else d.push({line:t,start:0});n=b.nextPath();a=!1}}d=d.filter(t=>1<t.line.length);return 0===d.length?null:d};g.clipMarshall=function(b,
p){if(null==b)return null;a:{var c=r.tileSize+128;var d=0;for(var a=0;a<b.lengths.length;a++){var n=b.lengths[a];for(var t=0;t<n;t++){const v=b.coords[2*(t+d)],y=b.coords[2*(t+d)+1];if(-128>v||v>c||-128>y||y>c){c=!0;break a}}d+=n}c=!1}if(!c)return b;e.setPixelMargin(p);e.reset(w.GeometryType.Polygon);p=0;for(c=0;c<b.lengths.length;c++){d=b.lengths[c];a=b.coords[2*(0+p)];n=b.coords[2*(0+p)+1];e.moveTo(a,n);for(t=1;t<d;t++)a=b.coords[2*(t+p)],n=b.coords[2*(t+p)+1],e.lineTo(a,n);e.close();p+=d}c=e.result(!1);
if(!c)return null;b=[];p=[];for(const v of c){c=0;for(const y of v)p.push(y.x),p.push(y.y),c++;b.push(c)}return new C(b,p)};g.triangleAreaArray=f;g.triangulate=function(b,p){const {coords:c,lengths:d,hasIndeterminateRingOrder:a}=p;if(a)return!1;p=0;for(var n=0;n<d.length;){let y=n,h=d[n];n=k(c,p,h);for(var t=[];++y<d.length;){var v=d[y];const A=k(c,p+h,v);if(!(0<A))break;n+=A;t.push(p+h);h+=v}v=b.length;m.bufcut(b,c,p,p+h,t,2,0);t=f(b,c,v,b.length,0);n=Math.abs(n);if(1E-5<Math.abs((t-n)/Math.max(1E-7,
n)))return b.length=0,!1;n=y;p+=h}return!0};g.triangulateEarcut=function(b,p,c){const {coords:d,lengths:a,hasIndeterminateRingOrder:n}=p;if(n)return!1;let t=0;for(var v=0;v<a.length;){let h=v,A=a[v];for(v=[];++h<a.length;){var y=a[h];if(!(0<k(d,t+A,y)))break;v.push(t+A-t);A+=y}y=p.coords.slice(2*t,2*(t+A));v=q.earcut(y,v,2);for(const E of v)b.push(E+c+t);v=h;t+=A}return!0};g.triangulateLibtess=function(b){const {coords:p,lengths:c}=b;({buffer:b}=x.triangulate(p,c));return b};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports"],function(g){function q(h,A,E,z,F,D,B){let u;E=0;for(let H=z,G=F-D;H<F;H+=D)E+=(h[G+A*D]-h[H+A*D])*(h[H+1+A*D]+h[G+1+A*D]),G=H;if(B===0<E)for(;z<F;z+=D)u=r(z+A*D,h[z+A*D],h[z+1+A*D],u);else for(F-=D;F>=z;F-=D)u=r(F+A*D,h[F+A*D],h[F+1+A*D],u);u&&d(u,u.next)&&(m(u),u=u.next);return u}function x(h,A=h){if(!h)return h;let E;do if(E=!1,h.steiner||!d(h,h.next)&&0!==e(h.prev,h,h.next))h=h.next;else{m(h);
h=A=h.prev;if(h===h.next)break;E=!0}while(E||h!==A);return A}function w(h,A,E,z,F,D,B,u){if(h){!u&&D&&(h=f(h,z,F,D));for(var H=h;h.prev!==h.next;){var G=h.prev,I=h.next;if(D)var J=C(h,z,F,D);else a:{J=h;var M=J.prev,R=J;const Y=J.next;if(0<=e(M,R,Y)){J=!1;break a}let fa=J.next.next;const O=fa;let Q=0;for(;fa!==J.prev&&(0===Q||fa!==O);){Q++;if(b(M.x,M.y,R.x,R.y,Y.x,Y.y,fa.x,fa.y)&&0<=e(fa.prev,fa,fa.next)){J=!1;break a}fa=fa.next}J=!0}if(J)A.push(G.index/E+B),A.push(h.index/E+B),A.push(I.index/E+B),
m(h),H=h=I.next;else if(h=I,h===H){if(!u)w(x(h),A,E,z,F,D,B,1);else if(1===u){u=A;H=E;G=B;I=h;do J=I.prev,M=I.next.next,!d(J,M)&&l(J,I,I.next,M)&&p(J,M)&&p(M,J)&&(u.push(J.index/H+G),u.push(I.index/H+G),u.push(M.index/H+G),m(I),m(I.next),I=h=M),I=I.next;while(I!==h);h=I;w(h,A,E,z,F,D,B,2)}else if(2===u)a:{u=h;do{for(H=u.next.next;H!==u.prev;){if(G=u.index!==H.index){J=J=J=void 0;G=u;I=H;if(J=G.next.index!==I.index&&G.prev.index!==I.index){b:{J=G;do{if(J.index!==G.index&&J.next.index!==G.index&&J.index!==
I.index&&J.next.index!==I.index&&l(J,J.next,G,I)){J=!0;break b}J=J.next}while(J!==G);J=!1}J=!J}if(J=J&&p(G,I)&&p(I,G)){J=G;M=!1;R=(G.x+I.x)/2;I=(G.y+I.y)/2;do J.y>I!==J.next.y>I&&J.next.y!==J.y&&R<(J.next.x-J.x)*(I-J.y)/(J.next.y-J.y)+J.x&&(M=!M),J=J.next;while(J!==G);J=M}G=J}if(G){h=n(u,H);u=x(u,u.next);h=x(h,h.next);w(u,A,E,z,F,D,B,0);w(h,A,E,z,F,D,B,0);break a}H=H.next}u=u.next}while(u!==h)}break}}}}function C(h,A,E,z){const F=h.prev,D=h.next;if(0<=e(F,h,D))return!1;const B=F.x>h.x?F.x>D.x?F.x:
D.x:h.x>D.x?h.x:D.x,u=F.y>h.y?F.y>D.y?F.y:D.y:h.y>D.y?h.y:D.y,H=c(F.x<h.x?F.x<D.x?F.x:D.x:h.x<D.x?h.x:D.x,F.y<h.y?F.y<D.y?F.y:D.y:h.y<D.y?h.y:D.y,A,E,z);A=c(B,u,A,E,z);E=h.prevZ;for(z=h.nextZ;E&&E.z>=H&&z&&z.z<=A;){if(E!==h.prev&&E!==h.next&&b(F.x,F.y,h.x,h.y,D.x,D.y,E.x,E.y)&&0<=e(E.prev,E,E.next))return!1;E=E.prevZ;if(z!==h.prev&&z!==h.next&&b(F.x,F.y,h.x,h.y,D.x,D.y,z.x,z.y)&&0<=e(z.prev,z,z.next))return!1;z=z.nextZ}for(;E&&E.z>=H;){if(E!==h.prev&&E!==h.next&&b(F.x,F.y,h.x,h.y,D.x,D.y,E.x,E.y)&&
0<=e(E.prev,E,E.next))return!1;E=E.prevZ}for(;z&&z.z<=A;){if(z!==h.prev&&z!==h.next&&b(F.x,F.y,h.x,h.y,D.x,D.y,z.x,z.y)&&0<=e(z.prev,z,z.next))return!1;z=z.nextZ}return!0}function r(h,A,E,z){h=t.create(h,A,E);z?(h.next=z.next,h.prev=z,z.next.prev=h,z.next=h):(h.prev=h,h.next=h);return h}function m(h){h.next.prev=h.prev;h.prev.next=h.next;h.prevZ&&(h.prevZ.nextZ=h.nextZ);h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function k(h,A){let E=A;const z=h.x,F=h.y;let D=-Infinity,B;do{if(F<=E.y&&F>=E.next.y&&E.next.y!==
E.y){var u=E.x+(F-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(u<=z&&u>D){D=u;if(u===z){if(F===E.y)return E;if(F===E.next.y)return E.next}B=E.x<E.next.x?E:E.next}}E=E.next}while(E!==A);if(!B)return null;if(z===D)return B.prev;A=B;u=B.x;const H=B.y;let G=Infinity,I;for(E=B.next;E!==A;)z>=E.x&&E.x>=u&&z!==E.x&&b(F<H?z:D,F,u,H,F<H?D:z,F,E.x,E.y)&&(I=Math.abs(F-E.y)/(z-E.x),(I<G||I===G&&E.x>B.x)&&p(E,h)&&(B=E,G=I)),E=E.next;return B}function f(h,A,E,z){for(var F;F!==h;F=F.next){F=F||h;null===F.z&&(F.z=c(F.x,
F.y,A,E,z));if(F.prev.next!==F||F.next.prev!==F)return F.prev.next=F,F.next.prev=F,f(h,A,E,z);F.prevZ=F.prev;F.nextZ=F.next}h.prevZ.nextZ=null;h.prevZ=null;a:for(E=1;;){z=h;A=h=null;let D=0;for(;z;){D++;F=z;let B=0;for(;B<E&&F;B++)F=F.nextZ;let u=E;for(;0<B||0<u&&F;){let H;0===B?(H=F,F=F.nextZ,u--):0!==u&&F?z.z<=F.z?(H=z,z=z.nextZ,B--):(H=F,F=F.nextZ,u--):(H=z,z=z.nextZ,B--);A?A.nextZ=H:h=H;H.prevZ=A;A=H}z=F}A.nextZ=null;E*=2;if(2>D)break a}return h}function e(h,A,E){return(A.y-h.y)*(E.x-A.x)-(A.x-
h.x)*(E.y-A.y)}function l(h,A,E,z){return d(h,A)&&d(E,z)||d(h,z)&&d(E,A)?!0:0<e(h,A,E)!==0<e(h,A,z)&&0<e(E,z,h)!==0<e(E,z,A)}function b(h,A,E,z,F,D,B,u){return 0<=(F-B)*(A-u)-(h-B)*(D-u)&&0<=(h-B)*(z-u)-(E-B)*(A-u)&&0<=(E-B)*(D-u)-(F-B)*(z-u)}function p(h,A){return 0>e(h.prev,h,h.next)?0<=e(h,A,h.next)&&0<=e(h,h.prev,A):0>e(h,A,h.prev)||0>e(h,h.next,A)}function c(h,A,E,z,F){h=32767*(h-E)*F;A=32767*(A-z)*F;h=(h|h<<8)&16711935;h=(h|h<<4)&252645135;h=(h|h<<2)&858993459;A=(A|A<<8)&16711935;A=(A|A<<4)&
252645135;A=(A|A<<2)&858993459;return(h|h<<1)&1431655765|((A|A<<1)&1431655765)<<1}function d(h,A){return h.x===A.x&&h.y===A.y}function a(h,A){return h.x-A.x}function n(h,A){const E=t.create(h.index,h.x,h.y),z=t.create(A.index,A.x,A.y),F=h.next,D=A.prev;h.next=A;A.prev=h;E.next=F;F.prev=E;z.next=E;E.prev=z;D.next=z;z.prev=D;return z}class t{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(h,A,E){const z=y<v.length?v[y++]:new t;
z.index=h;z.x=A;z.y=E;z.prev=null;z.next=null;z.z=null;z.prevZ=null;z.nextZ=null;z.steiner=!1;return z}}const v=[];let y=0;for(let h=0;8096>h;h++)v.push(new t);g.bufcut=function(h,A,E,z,F,D,B){y=0;var u=(z-E)*D,H=F&&F.length;const G=H?(F[0]-E)*D:u;var I=q(A,E,z,0,G,D,!0);if(I&&I.next!==I.prev){var J;if(H){const O=[];for(let Q=0,Z=F.length;Q<Z;Q++){const ba=q(A,E,z,F[Q]*D,Q<Z-1?F[Q+1]*D:z*D,D,!1);ba===ba.next&&(ba.steiner=!0);H=O;var M=H.push;let da=ba,P=ba;do{if(da.x<P.x||da.x===P.x&&da.y<P.y)P=da;
da=da.next}while(da!==ba);M.call(H,P)}O.sort(a);for(var R of O)if(z=R,F=k(z,I))z=n(F,z),x(z,z.next),I=x(F,F.next)}if(u>80*D){var Y=u=A[E*D];var fa=J=A[1+E*D];for(R=D;R<G;R+=D)z=A[R+E*D],F=A[R+1+E*D],Y=Math.min(Y,z),fa=Math.min(fa,F),u=Math.max(u,z),J=Math.max(J,F);J=Math.max(u-Y,J-fa);J=0!==J?1/J:0}w(I,h,D,Y,fa,J,B,0)}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l){class b extends e(l){constructor(p,c,d,a,n,t,v,y,h,A,E,z,F,D,B,u,H,G,I,J){super();p=k.LineMaterialKey.load(p);c&&(p.sdf=c.sdf,p.pattern=!0,p.textureBinding=c.textureBinding);this._capType=a;this._joinType=n;this._miterLimitCosine=f.getLimitCosine(t);this.tessellationProperties._fillColor=v;this.tessellationProperties._tl=y;this.tessellationProperties._br=h;this._hasPattern=A;this._isDashed=E;this._zOrder=H;this._effects=G||null;this._minMaxZoom=r.i1616to32(Math.round(I*
C.minMaxZoomPrecisionFactor),Math.round(J*C.minMaxZoomPrecisionFactor));this._materialKey=p.data;this.tessellationProperties._bitset=(F?C.bitsetGenericLockColor:0)|(D?C.bitsetTypeFillOutline:0)|(z?C.bitsetLineScaleDash:0)|(B?C.bitsetGenericConsiderAlphaOnly:0);this.tessellationProperties._halfWidth=.5*d;this.tessellationProperties._halfReferenceWidth=.5*u;this.tessellationProperties.offset=0;this._initializeTessellator(!1)}static fromCIMLine(p,c,d){var a=p.color,n=p.scaleFactor||1;const t=!!p.dashTemplate;
let v=p.cap;t&&v===x.CapType.ROUND&&(v=x.CapType.SQUARE);const y=p.join;n*=q.pt2px(p.width);const h=q.pt2px(p.referenceWidth),A=q.pt2px(p.miterLimit);a=a&&w.premultiplyAlphaRGBA(a)||0;const [E,z]=f.getMinMaxZoom(p.scaleInfo,d);if(!c)return new b(p.materialKey,c,n,v,y,A,a,0,0,!1,t,p.scaleDash??!1,p.colorLocked??!1,!1,p.sampleAlphaOnly,h,p.zOrder,p.effects,E,z);const {rect:F,width:D,height:B}=c;var u=F.x+C.spritePadding;const H=F.y+C.spritePadding;d=u+D;const G=H+B;u=r.i1616to32(u,H);d=r.i1616to32(d,
G);return new b(p.materialKey,c,n,v,y,A,a,u,d,!0,t,p.scaleDash??!1,p.colorLocked??!1,!1,p.sampleAlphaOnly,h,p.zOrder,p.effects,E,z)}static fromFillOutline(p){const c=k.FillMaterialKey.load(p.materialKey);return k.hasOutlineFillSymbology(c)&&p.outline&&"esriSLSSolid"===p.outline?.style?b.fromSimpleLine({hash:"",materialKey:p.materialKey,...p.outline},null,!0):null}static fromSimpleLine(p,c,d=!1){var {color:a}=p;const n="esriSLSSolid"!==p.style&&"esriSLSNull"!==p.style,t=m.getCapType(p.cap||"round"),
v=m.getJoinType(p.join||"round");a=a&&"esriSLSNull"!==p.style&&w.premultiplyAlphaRGBAArray(a)||0;"esriSLSNull"===p.style&&(a=0);const y=q.pt2px(p.width),h=p.miterLimit;if(!c)return new b(p.materialKey,c,y,t,v,h,a,0,0,!1,n,!0,!1,d,!1,y,0,null,f.defaultMinZoom,f.defaultMaxZoom);const {rect:A,width:E,height:z}=c;var F=A.x+C.spritePadding;const D=A.y+C.spritePadding;var B=F+E;const u=D+z;F=r.i1616to32(F,D);B=r.i1616to32(B,u);return new b(p.materialKey,c,y,t,v,h,a,F,B,!0,n,!0,!1,d,!1,y,0,null,f.defaultMinZoom,
f.defaultMaxZoom)}static fromPictureLineSymbol(p,c,d,a){g.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!");return null}}return b})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("../../../../../../geometry/GeometryCursor ../../definitions ../../enums ../../number ../../TurboLine ../../materialKey/MaterialKey ./templateUtils".split(" "),function(g,q,x,w,C,r,m){const k=(l,b,p)=>(c,d,a,n,t,v,y,h,A,E,z)=>{a=
w.i1616to32(z,Math.ceil(16*l._halfWidth));y=w.i8888to32(Math.round(16*y),Math.round(16*h),Math.round(16*A),Math.round(16*E));t=w.i8888to32(16*t,16*v,0,l._bitset);v=l.out;v.vertexBounds(c,d,b,p);v.vertexWrite(w.i1616to32(8*c,8*d));v.vertexWrite(l.id);v.vertexWrite(l._fillColor);v.vertexWrite(y);v.vertexWrite(a);v.vertexWrite(l._tl);v.vertexWrite(l._br);v.vertexWrite(t);v.vertexWrite(w.i1616to32(Math.ceil(16*l._halfReferenceWidth),0));v.vertexWrite(l.minMaxZoom);v.vertexEnd();return l.offset+l.vertexCount++},
f=(l,b,p)=>(c,d,a,n,t,v,y,h,A,E,z)=>{a=w.i1616to32(16*l._halfWidth,16*l._halfReferenceWidth);y=w.i8888to32(16*y+128,16*h+128,16*A+128,16*E+128);h=l.out;A=l._bitset<<24|l.id;h.vertexBounds(c,d,b,p);h.vertexWrite(w.i1616to32(8*c,8*d));h.vertexWrite(A);h.vertexWrite(l._fillColor);c=r.hasSimpleSymbology(l.key);c||(h.vertexWrite(0),h.vertexWrite(0));h.vertexWrite(0);h.vertexWrite(a);h.vertexWrite(y);c||h.vertexWrite(l.minMaxZoom);h.vertexEnd();return l.offset+l.vertexCount++},e=l=>(b,p,c)=>{const d=l.out;
d.indexWrite(b);d.indexWrite(p);d.indexWrite(c);l.indexCount+=3};return l=>class extends l{constructor(...b){super(...b);this.tessellationProperties={};this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0};this.geometryType=x.WGLGeometryType.LINE}writeGeometry(b,p,c,d){this._writeGeometry(b,p,c,d)}_initializeTessellator(b){var p=r.LineMaterialKey.load(this._materialKey),c=r.FillMaterialKey.load(this._materialKey),d=this._tessellationOptions;p=p.vvSizeFieldStops||p.vvSizeMinMaxValue||
p.vvSizeScaleStops||p.vvSizeUnitValue;b=this.tessellationProperties._halfWidth<q.thinLineHalfWidthThreshold&&!b&&!p;this.tessellationProperties.minMaxZoom=this._minMaxZoom;d.wrapDistance=65535;d.textured=this._isDashed||this._hasPattern;d.offset=this.tessellationProperties.offset;d.halfWidth=this.tessellationProperties._halfWidth;d=b?0:1;c=r.hasOutlineFillSymbology(c)?f:k;this._lineTessellator=new C.LineTessellation(c(this.tessellationProperties,d,d),e(this.tessellationProperties),b)}_write(b,p,c,
d){c="esriGeometryPoint"===p.geometryType;b.recordStart(p.getDisplayId(),this._materialKey,this.geometryType,c);this._writeGeometry(b,p,d,c);b.recordEnd()}_writeGeometry(b,p,c,d){if(c=c||g.GeometryCursor.fromFeatureSetReaderCIM(p))d=this._getLines(c,d),null!=d&&this._writeVertices(b,p,d)}_getLines(b,p){return m.clipLinesMarshall(b,p?256:16)}_writeVertices(b,p,c){const d=p.getDisplayId(),a=b.vertexCount(),n=this.tessellationProperties;p=this._tessellationOptions;n.out=b;n.id=d;n.indexCount=0;n.vertexCount=
0;n.offset=a;p.capType=this._capType;p.joinType=this._joinType;b=r.FillMaterialKey.load(this._materialKey);this.tessellationProperties.key=r.hasOutlineFillSymbology(b)?b:r.LineMaterialKey.load(this._materialKey);for(const {line:t,start:v}of c)p.initialDistance=v%65535,this._lineTessellator.tessellate(t,p)}}})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define(["../../../../../../core/Logger","../../../../../../symbols/cim/cimAnalyzer","../../../../../../symbols/cim/utils",
"./WGLMeshTemplate"],function(g,q,x,w){const C=g.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class r extends w{constructor(m){super();this._ongoingMaterialRequestMap=new Map;this._materialCache=new Map;this._dynamicPropertyMap=new Map;this._cimLayer=m}async analyze(m,k,f,e,l){if(l&&0===l.length)return null;const b=l&&0<l.length,p=k.readLegacyFeature();k=k.getObjectId();const c=this._materialCache;var d=this._cimLayer.materialHash;if(!d)return C.error("A Dynamic mesh template must have a material hash value or function!"),
null;const a="function"===typeof d?d(p,f,e,k):d;d=c.get(a);if(null!=d||(d=this._ongoingMaterialRequestMap.get(a)))return d;d=this._cimLayer;const n=q.analyzeCIMResource(d.cim,this._cimLayer.materialOverrides);n.mosaicHash=a;const {type:t,url:v}=d;k={cim:n,type:t,mosaicHash:a,url:v,size:null,dashTemplate:null,text:null,fontName:null,objectId:k,animatedSymbolProperties:null};switch(t){case "marker":k.size=x.evaluateValueOrFunction(d.size,p,f,e);k.animatedSymbolProperties=x.evaluateValueOrFunction(d.animatedSymbolProperties,
p,f,e);break;case "line":k.dashTemplate=d.dashTemplate;break;case "text":k.text=x.evaluateValueOrFunction(d.text,p,f,e),k.fontName=x.evaluateValueOrFunction(d.fontName,p,f,e)}m=m.getMosaicItem(k,l).then(y=>{b||(this._ongoingMaterialRequestMap.delete(a),c.set(a,y));return y}).catch(y=>{this._ongoingMaterialRequestMap.delete(a);C.error(".analyze()",y.message);return null});b||this._ongoingMaterialRequestMap.set(a,m);return m}}return r})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../Color ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolDrawHelper ./CIMSymbolHelper ./enums ./quantizeTime ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/grouping".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d,a,n,t){function v(B){switch(B){case "Butt":return l.CapType.BUTT;case "Square":return l.CapType.SQUARE;default:return l.CapType.ROUND}}function y(B){switch(B){case "Bevel":return l.JoinType.BEVEL;case "Miter":return l.JoinType.MITER;default:return l.JoinType.ROUND}}function h(B){return B&&0===B.indexOf("Level_")&&(B=parseInt(B.substr(6),10),!isNaN(B))?B:0}function A(B){if(!B||0===B.length)return null;B=(new q(B)).toRgba();return{r:B[0],g:B[1],b:B[2],a:B[3]}}
function E(B){return B?B.charAt(0).toLowerCase()+B.substr(1):B}function z(B){var u=B.symbolLayers;if(!u||2!==u.length)return!1;B=u.find(H=>H.effects?.find(G=>"CIMGeometricEffectDashes"===G.type));u=u.find(H=>H.effects?.find(G=>"CIMGeometricEffectAddControlPoints"===G.type));return!!B&&!!u}const F=C.getLogger("esri.symbols.cim.cimAnalyzer");class D{constructor(B,u){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];this._resourceManager=B;this._info=u}async analyzeSymbolReference(B,u,H){this._cimLayers=
H??[];if(!B)return this._cimLayers;if(B.primitiveOverrides){this._primitiveOverrides=B.primitiveOverrides;this._poMap={};H=[];const I=this._info;for(const J of this._primitiveOverrides){var G=J.valueExpressionInfo;G&&I?(G=k.createRendererExpression(G.expression,I.spatialReference,I.fields).then(M=>{null!=M&&this._setPoMap(J.primitiveName,J.propertyName,M)}),H.push(G)):null!=J.value&&this._setPoMap(J.primitiveName,J.propertyName,J.value);0<H.length&&await Promise.all(H)}}B=B.symbol;H=[];e.CIMSymbolHelper.fetchResources(B,
this._resourceManager,H);0<H.length&&await Promise.all(H);this._analyzeSymbol(B,u);return this._cimLayers}_analyzeSymbol(B,u){switch(B?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(B,u,1,0,0,0)}}_analyzeMultiLayerSymbol(B,u,H,G,I,J){const M=B?.symbolLayers;if(M){var R=B.effects,Y=l.Alignment.SCREEN,fa=e.CIMSymbolHelper.getSize(B)??0;"CIMPointSymbol"===B.type&&"Map"===B.angleAlignment&&(Y=l.Alignment.MAP);for(var O="CIMPolygonSymbol"===B.type,
Q=M.length;Q--;){const ba=M[Q];if(!ba||!1===ba.enable)continue;let da;R?.length&&(da=[...R]);var Z=ba.effects;Z?.length&&(R?da.push(...Z):da=[...Z]);Z=[];e.OverrideHelper.findEffectOverrides(da,this._primitiveOverrides,Z);Z=0<Z.length?this._createEffectsOverrideFunction(da,Z):da;e.OverrideHelper.findApplicableOverrides(ba,this._primitiveOverrides,[]);switch(ba.type){case "CIMSolidFill":this._analyzeSolidFill(ba,Z);break;case "CIMPictureFill":this._analyzePictureFill(ba,Z);break;case "CIMHatchFill":this._analyzeHatchFill(ba,
Z);break;case "CIMGradientFill":this._analyzeGradientFill(ba,Z);break;case "CIMSolidStroke":this._analyzeSolidStroke(ba,Z,O,fa);break;case "CIMPictureStroke":this._analyzePictureStroke(ba,Z,O,fa);break;case "CIMGradientStroke":this._analyzeGradientStroke(ba,Z,O,fa);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":"CIMLineSymbol"===B.type&&(Y=(Y=ba.markerPlacement)&&Y.angleToLine?l.Alignment.MAP:l.Alignment.SCREEN);const P=[],U=ba.primitiveName;U&&P.push(U);this._analyzeMarker(ba,
Z,null,P,Y,fa,1,u,H,G,I,J);break;default:F.error("Cannot analyze CIM layer",ba.type)}}}}_analyzeSolidFill(B,u){const H=B.primitiveName,G=c.fromCIMColor(B.color),[I,J]=this._analyzePrimitiveOverrides(H,u,null,null),M=m.numericHash(JSON.stringify(B)+J).toString();this._cimLayers.push({type:"fill",templateHash:M,materialHash:I?()=>M:M,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,color:this._createOverrideFunction(H,"Color",G,A),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:u,applyRandomOffset:!1,
sampleAlphaOnly:!0})}_analyzePictureFill(B,u){const H=B.primitiveName,G=c.getTintColor(B),[I,J]=this._analyzePrimitiveOverrides(H,u,null,null),M=m.numericHash(JSON.stringify(B)+J).toString(),R=m.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}`).toString(),Y=c.getValue(B.height,f.defaultPictureFillHeight);let fa=c.getValue(B.scaleX,1);if("width"in B&&"number"===typeof B.width){const O=B.width;let Q=1;const Z=this._resourceManager.getResource(B.url);null!=Z&&(Q=Z.width/Z.height);fa/=Y/
O*Q}this._cimLayers.push({type:"fill",templateHash:M,materialHash:I?()=>R:R,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,effects:u,color:this._createOverrideFunction(H,"TintColor",G,A),height:this._createOverrideFunction(H,"Height",Y),scaleX:this._createOverrideFunction(H,"ScaleX",fa),angle:this._createOverrideFunction(H,"Rotation",c.getValue(B.rotation)),offsetX:this._createOverrideFunction(H,"OffsetX",c.getValue(B.offsetX)),offsetY:this._createOverrideFunction(H,"OffsetY",c.getValue(B.offsetY)),
url:B.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeHatchFill(B,u){const H=B.primitiveName,G=this._analyzeMaterialOverrides(H,["Rotation","OffsetX","OffsetY"]);let [I,J]=this._analyzePrimitiveOverrides(H,u,null,null);const M=m.numericHash(JSON.stringify(B)+J).toString(),R=m.numericHash(`${B.separation}${JSON.stringify(B.lineSymbol)}`).toString();let Y={r:255,g:255,b:255,a:1};var fa=!1;const O=B.lineSymbol?.symbolLayers?.find(Q=>"CIMSolidStroke"===Q.type&&null!=this._poMap[Q.primitiveName]?.Color);
O&&(Y=c.fromCIMColor(O.color),Y=this._createOverrideFunction(O.primitiveName,"Color",Y,A),fa="function"===typeof Y,I=I||fa,fa=null!=O.color||fa);this._cimLayers.push({type:"fill",templateHash:M,materialHash:I&&G?this._createMaterialHashFunction(R,G):R,cim:B,materialOverrides:G,colorLocked:!!B.colorLocked,effects:u,color:Y,height:this._createOverrideFunction(H,"Separation",c.getValue(B.separation,f.defaultHatchFillSeparation)),scaleX:1,angle:this._createOverrideFunction(H,"Rotation",c.getValue(B.rotation)),
offsetX:this._createOverrideFunction(H,"OffsetX",c.getValue(B.offsetX)),offsetY:this._createOverrideFunction(H,"OffsetY",c.getValue(B.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!fa})}_analyzeGradientFill(B,u){const [H,G]=this._analyzePrimitiveOverrides(B.primitiveName,u,null,null),I=m.numericHash(JSON.stringify(B)+G).toString();this._cimLayers.push({type:"fill",templateHash:I,materialHash:H?()=>I:I,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,effects:u,
color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}_analyzeSolidStroke(B,u,H,G){const I=B.primitiveName,J=c.fromCIMColor(B.color),M=c.getValue(B.width,f.defaultStrokeWidth),R=v(B.capStyle),Y=y(B.joinStyle),fa=B.miterLimit,[O,Q]=this._analyzePrimitiveOverrides(I,u,null,null),Z=m.numericHash(JSON.stringify(B)+Q).toString();let ba;if(u&&u instanceof Array&&0<u.length){const P=u[u.length-1];if("CIMGeometricEffectDashes"===P.type&&"NoConstraint"===
P.lineDashEnding&&null===P.offsetAlongLine){u=[...u];var da=u.pop();ba=da.dashTemplate;da=da.scaleDash}}this._cimLayers.push({type:"line",templateHash:Z,materialHash:O?()=>Z:Z,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,effects:u,color:this._createOverrideFunction(I,"Color",J,A),width:this._createOverrideFunction(I,"Width",M),cap:this._createOverrideFunction(I,"CapStyle",R),join:this._createOverrideFunction(I,"JoinStyle",Y),miterLimit:fa&&this._createOverrideFunction(I,"MiterLimit",
fa),referenceWidth:G,zOrder:h(B.name),dashTemplate:ba,scaleDash:da,sampleAlphaOnly:!0})}_analyzePictureStroke(B,u,H,G){const I=m.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}`).toString(),J=B.primitiveName,M=c.getTintColor(B),R=c.getValue(B.width,f.defaultStrokeWidth),Y=v(B.capStyle),fa=y(B.joinStyle),O=B.miterLimit,[Q,Z]=this._analyzePrimitiveOverrides(J,u,null,null),ba=m.numericHash(JSON.stringify(B)+Z).toString();this._cimLayers.push({type:"line",templateHash:ba,materialHash:Q?()=>
I:I,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,effects:u,color:this._createOverrideFunction(J,"TintColor",M,A),width:this._createOverrideFunction(J,"Width",R),cap:this._createOverrideFunction(J,"CapStyle",Y),join:this._createOverrideFunction(J,"JoinStyle",fa),miterLimit:O&&this._createOverrideFunction(J,"MiterLimit",O),referenceWidth:G,zOrder:h(B.name),dashTemplate:null,scaleDash:!1,url:B.url,sampleAlphaOnly:!1})}_analyzeGradientStroke(B,u,H,G){const I=B.primitiveName,J=
c.getValue(B.width,f.defaultStrokeWidth),M=v(B.capStyle),R=y(B.joinStyle),Y=B.miterLimit,[fa,O]=this._analyzePrimitiveOverrides(I,u,null,null),Q=m.numericHash(JSON.stringify(B)+O).toString();this._cimLayers.push({type:"line",templateHash:Q,materialHash:fa?()=>Q:Q,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,effects:u,color:{r:128,g:128,b:128,a:1},width:this._createOverrideFunction(I,"Width",J),cap:this._createOverrideFunction(I,"CapStyle",M),join:this._createOverrideFunction(I,
"JoinStyle",R),miterLimit:Y&&this._createOverrideFunction(I,"MiterLimit",Y),referenceWidth:G,zOrder:h(B.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(B,u,H,G,I,J,M,R,Y,fa,O,Q,Z=!1){if(!this._analyzeMarkerInsidePolygon(B,u)){Y=c.getValue(B.size,f.defaultMarkerSize);var ba=c.getValue(B.rotation),da=c.getValue(B.offsetX),P=c.getValue(B.offsetY);Y=this._createOverrideFunction(B.primitiveName,"Size",Y);ba=this._createOverrideFunction(B.primitiveName,"Rotation",ba);da=this._createOverrideFunction(B.primitiveName,
"OffsetX",da);P=this._createOverrideFunction(B.primitiveName,"OffsetY",P);Y=this._transformSize(Y,M);ba=this._transformRotation(ba,!!B.rotateClockwise,fa);O=this._transformOffsetX(da,P,fa,M,O);fa=this._transformOffsetY(da,P,fa,M,Q);da=O;P=fa;switch(B.type){case "CIMPictureMarker":this._analyzePictureMarker(B,u,H,G,I,J,Y,ba,da,P,B.colorLocked||Z);break;case "CIMVectorMarker":this._analyzeVectorMarker(B,u,H,G,I,J,M,R,Y,ba,da,P,B.colorLocked||Z)}}}_analyzeMarkerInsidePolygon(B,u){const {markerPlacement:H,
type:G}=B;if(!H||"CIMMarkerPlacementInsidePolygon"!==H.type)return!1;if("CIMVectorMarker"===G||"CIMPictureMarker"===G){var I=B.primitiveName;if(I&&([I]=this._analyzePrimitiveOverrides([I],u,null,null),I))return!1;if(I=H.primitiveName)if([I]=this._analyzePrimitiveOverrides([I],u,null,null),I)return!1;if("CIMVectorMarker"===G){if({markerGraphics:I}=B,I)for(var J of I)if({symbol:I}=J,"CIMPolygonSymbol"===I?.type&&I.symbolLayers){({symbolLayers:I}=I);for(var M of I)if("CIMSolidStroke"===M.type)return!1}}else if({animatedSymbolProperties:J}=
B,J)return!1}var R=Math.abs(H.stepX),Y=Math.abs(H.stepY);if(0===R||0===Y)return!0;const fa=new Set(["Rotation","OffsetX","OffsetY"]);J=this._primitiveOverrides.filter(Z=>Z.primitiveName!==B.primitiveName||!fa.has(Z.propertyName));M="url"in B&&"string"===typeof B.url?B.url:void 0;I=m.numericHash(JSON.stringify(B)).toString();let O=null;if("Random"===H.gridType){var Q=r.px2pt(n.randomInsidePolygonTextureSize);const Z=Math.max(Math.floor(Q/R),1),ba=Math.max(Math.floor(Q/Y),1);Q=Y*ba;O=da=>da?da*ba:0;
R=Z*R/Q}else H.shiftOddRows?(Q=2*Y,O=Z=>Z?2*Z:0,R=R/Y*.5):(Q=Y,O=null,R/=Y);Y=c.getTintColor(B);this._cimLayers.push({type:"fill",templateHash:I,materialHash:I,cim:B,materialOverrides:J,colorLocked:!!B.colorLocked,effects:u,color:Y,height:this._createOverrideFunction(H.primitiveName,"StepY",Q,O),scaleX:R,angle:H.gridAngle,offsetX:c.getValue(H.offsetX),offsetY:c.getValue(H.offsetY),url:M,applyRandomOffset:"Random"===H.gridType,sampleAlphaOnly:!M,hasUnresolvedReplacementColor:!0});return!0}_analyzePictureMarker(B,
u,H,G,I,J,M,R,Y,fa,O){let Q=c.getValue(B.scaleX,1);const Z=c.getTintColor(B),ba=m.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}${JSON.stringify(B.animatedSymbolProperties)}`).toString();H||(H=this._createMarkerPlacementOverrideFunction(B.markerPlacement));const da=this._createAnimatedSymbolPropertiesOverrideFunction(B.animatedSymbolProperties),[P,U]=this._analyzePrimitiveOverrides(G,u,H,da);G=m.numericHash(JSON.stringify(B)+U).toString();const ca=B.anchorPoint??{x:0,y:0};if("width"in
B&&"number"===typeof B.width){const pa=B.width;let na=1;var la=this._resourceManager.getResource(B.url);null!=la&&(na=la.width/la.height);la=c.getValue(B.size);Q/=la/pa*na}this._cimLayers.push({type:"marker",templateHash:G,materialHash:B.animatedSymbolProperties&&!0===B.animatedSymbolProperties.randomizeStartTime?(pa,na,ra,ua)=>{ra=t.getMaterialGroup(ua??0);pa=null!=da?c.evaluateValueOrFunction(da,pa,na):null;return ba+`-MATERIALGROUP(${ra})`+`-ASP(${JSON.stringify(pa)})`}:P?(pa,na)=>{pa=null!=da?
c.evaluateValueOrFunction(da,pa,na):null;return ba+`-ASP(${JSON.stringify(pa)})`}:ba,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked||!!O,effects:u,scaleSymbolsProportionally:!1,alignment:I,size:M,scaleX:this._createOverrideFunction(B.primitiveName,"ScaleX",Q),rotation:R,offsetX:Y,offsetY:fa,color:this._createOverrideFunction(B.primitiveName,"TintColor",Z,A),anchorPoint:{x:ca.x,y:ca.y},isAbsoluteAnchorPoint:"Relative"!==B.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,
rotateClockwise:!1,referenceSize:J,sizeRatio:1,markerPlacement:H,url:B.url,animatedSymbolProperties:da})}_analyzeVectorMarker(B,u,H,G,I,J,M,R,Y,fa,O,Q,Z){var ba=B.markerGraphics;if(ba){var da=B.frame,P=0,U=1;B.scaleSymbolsProportionally&&da&&(P=da.ymax-da.ymin,U=this._transformSize(Y,1/P));U=this._transformSize(U,M);H||(H=this._createMarkerPlacementOverrideFunction(B.markerPlacement));for(const pa of ba)if(pa&&(M=pa.symbol)){(ba=pa.primitiveName)&&G.push(ba);var ca=O,la=Q;if(("CIMPointSymbol"===M.type||
"CIMTextSymbol"===M.type)&&da){let na=la=0;ca=pa.geometry;"x"in ca&&"y"in ca&&(la+=ca.x-.5*(da.xmin+da.xmax),na+=ca.y-.5*(da.ymin+da.ymax));if(ca=B.anchorPoint)"Absolute"===B.anchorPointUnits?(la-=ca.x,na-=ca.y):da&&(la-=(da.xmax-da.xmin)*ca.x,na-=(da.ymax-da.ymin)*ca.y);ca=this._transformOffsetX(la,na,fa,U,O);la=this._transformOffsetY(la,na,fa,U,Q)}switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":R||z(M)?this._analyzeMultiLayerGraphicNonSDF(B,u,H,null,pa,G,I,J,P,
!!Z||!!B.colorLocked):this._analyzeMultiLayerGraphic(B,u,H,null,pa,G,I,J,P,U,Y,fa,ca,la,!!Z||!!B.colorLocked);break;case "CIMTextSymbol":this._analyzeTextGraphic(B,u,H,pa,G,I,J,P,U,Y,fa,ca,la,!!Z||!!B.colorLocked)}ba&&G.pop()}}}_analyzeMultiLayerGraphic(B,u,H,G,I,J,M,R,Y,fa,O,Q,Z,ba,da){var P=I.symbol;const U=P.symbolLayers;if(U){var ca=U.length;if(U&&2===U.length&&U[0].enable&&U[1].enable&&"CIMSolidStroke"===U[0].type&&"CIMSolidFill"===U[1].type&&null==U[0].path&&null==U[1].path&&!U[0].effects&&
!U[1].effects)this._analyzeCompositeMarkerGraphic(B,u,H,G,I,U,J,M,R,Y,O,Q,Z,ba,!!da||!!B.colorLocked);else{var la=this._resourceManager.geometryEngine;if(P=d.CIMEffectHelper.applyEffects(P.effects,I.geometry,la))for(;ca--;){const T=U[ca];if(!T||!1===T.enable)continue;const ia=T.primitiveName;ia&&J.push(ia);switch(T.type){case "CIMSolidFill":case "CIMSolidStroke":var pa=d.CIMEffectHelper.applyEffects(T.effects,P,la),na=p.getExtent(pa);if(!na)continue;const ka="Relative"!==B.anchorPointUnits,[qa,S,
V]=p.getSDFMetrics(na,B.frame,B.size,B.anchorPoint,ka);var ra="CIMSolidFill"===T.type;pa={type:"sdf",geom:pa,asFill:ra};na=T.path;const X=ra?c.fromCIMColor(c.getFillColor(T)):null==na?c.fromCIMColor(c.getStrokeColor(T)):{r:0,g:0,b:0,a:0},ha=ra?{r:0,g:0,b:0,a:0}:c.fromCIMColor(c.getStrokeColor(T)),ja=c.getStrokeWidth(T)??0;if(!ra&&!ja)break;var ua=I.primitiveName;let ma=null;ra&&!T.colorLocked&&(ma=this._createOverrideFunction(ua,"FillColor",X,A));let oa=null;ra||T.colorLocked||(oa=this._createOverrideFunction(ua,
"StrokeColor",ha,A));ra=this._createOverrideFunction(ua,"StrokeWidth",ja);ua=!1;var L="";for(const za of this._primitiveOverrides)J.includes(za.primitiveName)&&(null!=za.value?L+=`-${za.primitiveName}-${za.propertyName}-${JSON.stringify(za.value)}`:za.valueExpressionInfo&&(ua=!0));if(null!=u&&"function"===typeof u||null!=H&&"function"===typeof H)ua=!0;if(c.isFeatureValueFn(O)||c.isFeatureValueFn(Q)||c.isFeatureValueFn(Z)||c.isFeatureValueFn(ba))ua=!0;const va=JSON.stringify({...B,markerGraphics:null}),
xa=m.numericHash(JSON.stringify(pa)+na).toString();L=m.numericHash(JSON.stringify(I)+JSON.stringify(T)+va+L).toString();this._cimLayers.push({type:"marker",templateHash:L,materialHash:ua?()=>xa:xa,cim:pa,materialOverrides:null,colorLocked:!!T.colorLocked||!!da,effects:u,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:M,anchorPoint:{x:S,y:V},isAbsoluteAnchorPoint:ka,size:O,rotation:Q,offsetX:Z,offsetY:ba,scaleX:1,frameHeight:Y,rotateClockwise:!1,referenceSize:R,sizeRatio:qa,color:c.isFeatureValueFn(ma)?
ma:this._createOverrideFunction(ia,"Color",X,A),outlineColor:c.isFeatureValueFn(oa)?oa:this._createOverrideFunction(ia,"Color",ha,A),outlineWidth:c.isFeatureValueFn(ra)?ra:this._createOverrideFunction(ia,"Width",ja),markerPlacement:H,animatedSymbolProperties:G,path:na});break;case "CIMVectorMarker":T.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(B,u,H,G,I,J,M,R,Y,!!da||!!T.colorLocked):this._analyzeMarker(T,u,H,J,M,R,fa,!1,O,Q,Z,ba,!!da||!!B.colorLocked);break;default:this._analyzeMultiLayerGraphicNonSDF(B,
u,H,G,I,J,M,R,Y,!!da||!!B.colorLocked)}ia&&J.pop()}}}}_analyzeTextGraphic(B,u,H,G,I,J,M,R,Y,fa,O,Q,Z,ba){e.OverrideHelper.findApplicableOverrides(G,this._primitiveOverrides,[]);R=G.geometry;if("x"in R&&"y"in R){R=G.symbol;fa=c.fromCIMFontDecoration(R);var da=c.fromCIMFontStyle(R.fontStyleName),P=x.getFontFamily(R.fontFamilyName);R.font={family:P,decoration:fa,...da};var U=c.getValue(R.height,f.defaultTextHeight),ca=c.getValue(R.angle),la=c.getValue(R.offsetX),pa=c.getValue(R.offsetY);U=this._transformSize(U,
Y);ca=this._transformRotation(ca,!1,O);Q=this._transformOffsetX(la,pa,O,Y,Q);pa=this._transformOffsetY(la,pa,O,Y,Z);la=Q;O=c.fromCIMColor(c.getFillColor(R));Z=c.fromCIMColor(c.getStrokeColor(R));Q=c.getStrokeWidth(R)??0;Q||(Z=c.fromCIMColor(c.getFillColor(R.haloSymbol)),Q=c.getValue(R.haloSize));Q=this._transformSize(Q,Y);Y=!1;if(R.symbol?.symbolLayers)for(var na of R.symbol.symbolLayers)null!=c.getFillColor(na)&&(Y=!!na.colorLocked);var ra=G.primitiveName;na=null;Y||(na=this._createOverrideFunction(ra,
"Color",O,A));var ua=ra=null,L=0;if(R.callout&&"CIMBackgroundCallout"===R.callout.type){var T=R.callout;if(T.backgroundSymbol&&(T=T.backgroundSymbol.symbolLayers))for(const V of T)"CIMSolidFill"===V.type?ra=c.fromCIMColor(V.color):"CIMSolidStroke"===V.type&&(ua=c.fromCIMColor(V.color),L=c.getValue(V.width,f.defaultStrokeWidth))}var [ia,ka]=this._analyzePrimitiveOverrides(I,u,H,null);I=JSON.stringify(B.effects)+Number(B.colorLocked||ba).toString()+JSON.stringify(B.anchorPoint)+B.anchorPointUnits+JSON.stringify(B.markerPlacement)+
B.size.toString();I=m.numericHash(JSON.stringify(G)+I+ka).toString();var qa=this._createOverrideFunction(G.primitiveName,"TextString",G.textString??"",c.adjustTextCase,R.textCase);if(null!=qa){({fontStyleName:G}=R);var S=P+(G?"-"+G.toLowerCase():"-regular");"string"===typeof qa&&qa.includes("[")&&R.fieldMap&&(qa=c.createLabelOverrideFunction(R.fieldMap,qa,R.textCase));this._cimLayers.push({type:"text",templateHash:I,materialHash:ia||"function"===typeof qa||/\[(.*?)\]/.test(qa)?(V,X,ha)=>S+"-"+c.evaluateValueOrFunction(qa,
V,X,ha):S+"-"+m.numericHash(qa),cim:R,materialOverrides:null,colorLocked:!!ba||!!Y,effects:u,alignment:J,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:"Relative"!==B.anchorPointUnits,fontName:S,decoration:fa,weight:da.weight,style:da.style,size:U,angle:ca,offsetX:la,offsetY:pa,horizontalAlignment:c.fromCIMHorizontalAlignment(R.horizontalAlignment),verticalAlignment:c.fromCIMVerticalAlignment(R.verticalAlignment),text:qa,color:c.isFeatureValueFn(na)?na:O,outlineColor:Z,outlineSize:Q,backgroundColor:ra,
borderLineColor:ua,borderLineWidth:L,lineWidth:null,referenceSize:M,sizeRatio:1,markerPlacement:H})}}}_analyzeMultiLayerGraphicNonSDF(B,u,H,G,I,J,M,R,Y,fa){I=this._buildSimpleMarker(B,I);const O=B.primitiveName,Q=this._analyzeMaterialOverrides(O,["Rotation","OffsetX","OffsetY"]);var [,Z]=this._analyzePrimitiveOverrides(J,null,null,null);const [ba,da,P]=e.CIMSymbolHelper.getTextureAnchor(I,this._resourceManager);J=c.getValue(B.rotation);const U=c.getValue(B.offsetX),ca=c.getValue(B.offsetY);Z=m.numericHash(JSON.stringify(I)+
Z).toString();this._cimLayers.push({type:"marker",templateHash:Z,materialHash:(Q&&0<Q.length||null!=u&&"function"===typeof u)&&Q?this._createMaterialHashFunction(Z,Q):Z,cim:I,materialOverrides:Q,colorLocked:!!B.colorLocked||!!fa,effects:u,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:M,anchorPoint:{x:ba,y:da},isAbsoluteAnchorPoint:!1,size:c.getValue(B.size,f.defaultMarkerSize),rotation:this._createOverrideFunction(O,"Rotation",J),offsetX:this._createOverrideFunction(O,"OffsetX",
U),offsetY:this._createOverrideFunction(O,"OffsetY",ca),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:Y,rotateClockwise:!!B.rotateClockwise,referenceSize:R,sizeRatio:P/r.pt2px(B.size),markerPlacement:H,animatedSymbolProperties:G,avoidSDFRasterization:!0})}_buildSimpleMarker(B,u){return{type:B.type,enable:!0,name:B.name,colorLocked:B.colorLocked,primitiveName:B.primitiveName,anchorPoint:B.anchorPoint,anchorPointUnits:B.anchorPointUnits,offsetX:0,offsetY:0,
rotateClockwise:B.rotateClockwise,rotation:0,size:B.size,billboardMode3D:B.billboardMode3D,depth3D:B.depth3D,frame:B.frame,markerGraphics:[u],scaleSymbolsProportionally:B.scaleSymbolsProportionally,respectFrame:B.respectFrame,clippingPath:B.clippingPath}}_analyzeCompositeMarkerGraphic(B,u,H,G,I,J,M,R,Y,fa,O,Q,Z,ba,da){var P=I.geometry;const U=J[0],ca=J[1];var la=p.getExtent(P);if(la){J="Relative"!==B.anchorPointUnits;var [pa,na,ra]=p.getSDFMetrics(la,B.frame,B.size,B.anchorPoint,J);P={type:"sdf",
geom:P,asFill:!0};la=ca.path;var ua=ca.primitiveName,L=U.primitiveName,T=c.fromCIMColor(ca.color),ia=c.fromCIMColor(U.color),ka=c.getValue(U.width,f.defaultStrokeWidth),qa=I.primitiveName,S=null;ca.colorLocked||da||(S=this._createOverrideFunction(qa,"FillColor",T,A));var V=null;U.colorLocked||da||(V=this._createOverrideFunction(qa,"StrokeColor",ia,A));qa=this._createOverrideFunction(qa,"StrokeWidth",ka);var X=!1,ha="";for(const ma of this._primitiveOverrides)if(ma.primitiveName===ua||ma.primitiveName===
L||M.includes(ma.primitiveName))null!=ma.value?ha+=`-${ma.primitiveName}-${ma.propertyName}-${JSON.stringify(ma.value)}`:ma.valueExpressionInfo&&(X=!0);null!=H&&"function"===typeof H&&(X=!0);if(c.isFeatureValueFn(O)||c.isFeatureValueFn(Q)||c.isFeatureValueFn(Z)||c.isFeatureValueFn(ba))X=!0;M=JSON.stringify({...B,markerGraphics:null});var ja=m.numericHash(JSON.stringify(P)+la).toString();I=m.numericHash(JSON.stringify(I)+JSON.stringify(ca)+JSON.stringify(U)+M+ha).toString();this._cimLayers.push({type:"marker",
templateHash:I,materialHash:X?()=>ja:ja,cim:P,materialOverrides:null,colorLocked:!!da,effects:u,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:R,anchorPoint:{x:na,y:ra},isAbsoluteAnchorPoint:J,size:O,rotation:Q,offsetX:Z,offsetY:ba,scaleX:1,frameHeight:fa,rotateClockwise:!1,referenceSize:Y,sizeRatio:pa,color:c.isFeatureValueFn(S)?S:this._createOverrideFunction(ua,"Color",T,A),outlineColor:c.isFeatureValueFn(V)?V:this._createOverrideFunction(L,"Color",ia,A),outlineWidth:c.isFeatureValueFn(qa)?
qa:this._createOverrideFunction(L,"Width",ka),markerPlacement:H,path:la,animatedSymbolProperties:G})}}_createMaterialHashFunction(B,u){const H=this._info?.geometryType;if(H){const G=this._poMap;for(const I of u)if(I.valueExpressionInfo){const J=G[I.primitiveName]&&G[I.primitiveName][I.propertyName];J instanceof k.ArcadeExpression&&(I.fn=(M,R,Y)=>a(J,M,{$view:Y},H,R))}}return(G,I,J)=>{for(const M of u)M.fn&&(M.value=M.fn(G,I,J));return m.numericHash(B+e.OverrideHelper.buildOverrideKey(u)).toString()}}_setPoMap(B,
u,H){let G;this._poMap[B]?G=this._poMap[B]:(G={},this._poMap[B]=G);G[u]=H}_createOverrideFunction(B,u,H,G,I){if(null==B)return H;B=this._poMap[B];if(null==B)return H;const J=B[u];if("string"===typeof J||"number"===typeof J||J instanceof Array)return G?G.call(null,J,I):J;const M=this._info?.geometryType;return null!=J&&J instanceof k.ArcadeExpression&&null!=M?(R,Y,fa)=>{R=a(J,R,{$view:fa},M,Y);null!==R&&G&&(R=G.call(null,R,I));return null!==R?R:H}:H}_createEffectsOverrideFunction(B,u){const H=this._poMap,
G=this._info?.geometryType;for(const I of u)if(I.valueExpressionInfo&&G){const J=H[I.primitiveName]&&H[I.primitiveName][I.propertyName];J instanceof k.ArcadeExpression&&(I.fn=(M,R,Y)=>a(J,M,{$view:Y},G,R))}return(I,J,M)=>{for(var R of u)R.fn&&(R.value=R.fn(I,J,M));I=[];for(let Y of B){if(J=Y?.primitiveName){M=!1;for(const fa of u)fa.primitiveName===J&&(R=E(fa.propertyName),null!=fa.value&&fa.value!==Y[R]&&(M||(Y=w.clone(Y),M=!0),Y[R]=fa.value))}I.push(Y)}return I}}_createMarkerPlacementOverrideFunction(B){const u=
[];e.OverrideHelper.findApplicableOverrides(B,this._primitiveOverrides,u);if(null==B||0===u.length)return B;const H=this._poMap,G=this._info?.geometryType;for(const I of u)if(I.valueExpressionInfo&&G){const J=H[I.primitiveName]&&H[I.primitiveName][I.propertyName];J instanceof k.ArcadeExpression&&(I.fn=(M,R,Y)=>a(J,M,{$view:Y},G,R))}return(I,J,M)=>{for(const R of u)R.fn&&(R.value=R.fn(I,J,M));I=w.clone(B);J=B.primitiveName;for(const R of u)R.primitiveName===J&&(M=E(R.propertyName),null!=R.value&&R.value!==
I[M]&&(I[M]=R.value));return I}}_createAnimatedSymbolPropertiesOverrideFunction(B){const u=[];e.OverrideHelper.findApplicableOverrides(B,this._primitiveOverrides,u);if(null==B||0===u.length)return B;const H=this._info?.geometryType;if(H){const G=this._poMap;for(const I of u)if(I.valueExpressionInfo){const J=G[I.primitiveName]&&G[I.primitiveName][I.propertyName];J instanceof k.ArcadeExpression&&(I.fn=(M,R,Y)=>a(J,M,{$view:Y},H,R))}}return(G,I,J)=>{for(var M of u)M.fn&&(M.value=M.fn(G,I,J));G=w.clone(B);
I=B.primitiveName;for(const R of u)R.primitiveName===I&&(J=E(R.propertyName),null!=R.value&&(M=b.quantizeIfNeeded(R.value,R.propertyName),M!==G[J]&&(G[J]=M)));return G}}_analyzePrimitiveOverrides(B,u,H,G){let I=!1,J="";"string"===typeof B&&(B=[B]);for(const M of this._primitiveOverrides)B?.includes(M.primitiveName)&&(null!=M.value?J+=`-${M.primitiveName}-${M.propertyName}-${JSON.stringify(M.value)}`:M.valueExpressionInfo&&(I=!0));null!=u&&"function"===typeof u&&(I=!0);null!=H&&"function"===typeof H&&
(I=!0);null!=G&&"function"===typeof G&&(I=!0);return[I,J]}_analyzeMaterialOverrides(B,u){return this._primitiveOverrides.filter(H=>H.primitiveName!==B||!u.includes(H.propertyName))}_transformSize(B,u){return c.isFeatureValueFn(B)||c.isFeatureValueFn(u)?(H,G,I)=>{const J=c.isFeatureValueFn(B)?B(H,G,I):B;H=c.isFeatureValueFn(u)?u(H,G,I):u;return J*H}:B*u}_transformRotation(B,u,H){return c.isFeatureValueFn(B)||c.isFeatureValueFn(H)?(G,I,J)=>{const M=c.isFeatureValueFn(B)?B(G,I,J):B;G=c.isFeatureValueFn(H)?
H(G,I,J):H;return u?G-M:G+M}:u?H-B:H+B}_transformOffsetX(B,u,H,G,I){if(!(c.isFeatureValueFn(B)||c.isFeatureValueFn(u)||c.isFeatureValueFn(H)||c.isFeatureValueFn(G)||c.isFeatureValueFn(I))){const J=H*Math.PI/180;return J?(Math.cos(J)*B-Math.sin(J)*u)*G+I:B*G+I}return(J,M,R)=>{var Y=c.isFeatureValueFn(H)?H(J,M,R):H;const fa=c.isFeatureValueFn(G)?G(J,M,R):G,O=c.isFeatureValueFn(B)?B(J,M,R):B,Q=c.isFeatureValueFn(I)?I(J,M,R):I;if(Y){Y*=Math.PI/180;const Z=Math.cos(Y);Y=Math.sin(Y);J=c.isFeatureValueFn(u)?
u(J,M,R):u;return(Z*O-Y*J)*fa+Q}return O*fa+Q}}_transformOffsetY(B,u,H,G,I){if(!(c.isFeatureValueFn(B)||c.isFeatureValueFn(u)||c.isFeatureValueFn(H)||c.isFeatureValueFn(G)||c.isFeatureValueFn(I))){const J=H*Math.PI/180;return J?(Math.sin(J)*B+Math.cos(J)*u)*G+I:u*G+I}return(J,M,R)=>{var Y=c.isFeatureValueFn(H)?H(J,M,R):H;const fa=c.isFeatureValueFn(G)?G(J,M,R):G,O=c.isFeatureValueFn(u)?u(J,M,R):u,Q=c.isFeatureValueFn(I)?I(J,M,R):I;if(Y){Y*=Math.PI/180;const Z=Math.cos(Y);Y=Math.sin(Y);J=c.isFeatureValueFn(B)?
B(J,M,R):B;return(Y*J+Z*O)*fa+Q}return O*fa+Q}}}g.CIMAnalyzer=D;g.analyzeCIMResource=function(B,u){if(!u||0===u.length)return B;B=w.clone(B);e.OverrideHelper.applyOverrides(B,u);return B};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/quantizeTime":function(){define(["exports"],function(g){const q=new Set(["StartTimeOffset","Duration","RepeatDelay"]);g.quantizeIfNeeded=function(x,w){return q.has(w)?.05*Math.max(Math.round(x/.05),1):x};Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(g,q,x,w,C){function r(k){if(!k)return null;switch(k.type){case "CIMPointSymbol":k=k.symbolLayers;if(!k||1!==k.length)break;return r(k[0]);case "CIMVectorMarker":k=k.markerGraphics;if(!k||1!==k.length)break;var f=k[0];if(!f)break;k=f.geometry;if(!k)break;f=f.symbol;if(!f||"CIMPolygonSymbol"!==f.type&&"CIMLineSymbol"!==
f.type||f.symbolLayers?.some(e=>!!e.effects))break;return{geom:k,asFill:"CIMPolygonSymbol"===f.type};case "sdf":return{geom:k.geom,asFill:k.asFill}}return null}function m(k){let f=Infinity,e=-Infinity,l=Infinity,b=-Infinity;for(const p of k)for(const c of p)c[0]<f&&(f=c[0]),c[0]>e&&(e=c[0]),c[1]<l&&(l=c[1]),c[1]>b&&(b=c[1]);return[f,l,e,b]}g.buildSDF=function(k){var f=k.geom;var e=f?f.rings?f.rings:f.paths?f.paths:void 0!==f.xmin&&void 0!==f.ymin&&void 0!==f.xmax&&void 0!==f.ymax?[[[f.xmin,f.ymin],
[f.xmin,f.ymax],[f.xmax,f.ymax],[f.xmax,f.ymin],[f.xmin,f.ymin]]]:null:null;f=Infinity;var l=-Infinity;var b=Infinity;var p=-Infinity;for(var c of e)for(var d of c)d[0]<f&&(f=d[0]),d[0]>l&&(l=d[0]),d[1]<b&&(b=d[1]),d[1]>p&&(p=d[1]);b=new w(f,b,l-f,p-b);c=C.spritePadding;f=Math.floor(.5*(64-c));p=(128-2*(f+c))/Math.max(b.width,b.height);c=Math.round(b.width*p)+2*f;d=Math.round(b.height*p)+2*f;l=[];for(var a of e)if(a&&1<a.length){e=[];for(var n of a){let [u,H]=n;u-=b.x;H-=b.y;u*=p;H*=p;u+=f-.5;H+=
f-.5;k.asFill?e.push([u,H]):e.push([Math.round(u),Math.round(H)])}if(k.asFill){var t=e.length-1;e[0][0]===e[t][0]&&e[0][1]===e[t][1]||e.push(e[0])}l.push(e)}n=c*d;a=Array(n);e=f*f+1;for(b=0;b<n;++b)a[b]=e;for(var v of l)for(e=v.length,b=1;b<e;++b){p=v[b-1];t=v[b];var y=void 0,h=void 0;p[0]<t[0]?(y=p[0],h=t[0]):(y=t[0],h=p[0]);var A=void 0,E=void 0;p[1]<t[1]?(A=p[1],E=t[1]):(A=t[1],E=p[1]);var z=Math.floor(y)-f;h=Math.floor(h)+f;A=Math.floor(A)-f;E=Math.floor(E)+f;0>z&&(z=0);h>c&&(h=c);0>A&&(A=0);
E>d&&(E=d);y=t[0]-p[0];const u=t[1]-p[1],H=y*y+u*u;for(;z<h;z++)for(let G=A;G<E;G++){var F=(z-p[0])*y+(G-p[1])*u,D=void 0;0>F?(D=p[0],F=p[1]):F>H?(D=t[0],F=t[1]):(F/=H,D=p[0]+F*y,F=p[1]+F*u);D=(z-D)*(z-D)+(G-F)*(G-F);F=(d-G-1)*c+z;D<a[F]&&(a[F]=D)}}for(v=0;v<n;++v)a[v]=Math.sqrt(a[v]);if(k.asFill)for(var B of l)for(k=B.length,v=1;v<k;++v)for(l=B[v-1],n=B[v],l[0]<n[0]?(e=l[0],b=n[0]):(e=n[0],b=l[0]),l[1]<n[1]?(t=l[1],p=n[1]):(t=n[1],p=l[1]),e=Math.floor(e),b=Math.floor(b)+1,t=Math.floor(t),p=Math.floor(p)+
1,e<f&&(e=f),b>c-f&&(b=c-f),t<f&&(t=f),p>d-f&&(p=d-f);t<p;++t)if(l[1]>t!==n[1]>t){h=(d-t-1)*c;for(A=e;A<b;++A)A<(n[0]-l[0])*(t-l[1])/(n[1]-l[1])+l[0]&&(a[h+A]=-a[h+A]);for(A=f;A<e;++A)a[h+A]=-a[h+A]}B=2*f;f=a.length;k=new Uint8Array(4*f);for(v=0;v<f;++v)q.packFloatRGBA(.5-a[v]/B,k,4*v);return[k,c,d]};g.getExtent=function(k){return k?k.rings?m(k.rings):k.paths?m(k.paths):x.isExtent(k)?[k.xmin,k.ymin,k.xmax,k.ymax]:null:null};g.getSDFInfo=r;g.getSDFMetrics=function(k,f,e,l,b){const [p,c,d,a]=k;if(d<
p||a<c)return[0,0,0];var n=d-p,t=a-c,v=C.spritePadding;k=Math.floor(.5*(64-v));v=(128-2*(k+v))/Math.max(n,t);const y=Math.round(n*v),h=Math.round(t*v)+2*k;t=1;f&&(t=h/v/(f.ymax-f.ymin));let A=0,E=0;n=1;l&&(b?f&&e&&0<f.ymax-f.ymin&&(n=(f.xmax-f.xmin)/(f.ymax-f.ymin),A=l.x/(e*n),E=l.y/e):(A=l.x,E=l.y));f&&(A=.5*(f.xmax+f.xmin)+A*(f.xmax-f.xmin),E=.5*(f.ymax+f.ymin)+E*(f.ymax-f.ymin));A=(A-p)*v+k;E=(E-c)*v+k;f=A/(y+2*k)-.5;l=E/h-.5;b&&e&&(f*=e*n,l*=e);return[t,f,l]};Object.defineProperty(g,Symbol.toStringTag,
{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(g,q){function x(m,k=0){let f=0;for(let e=0;4>e;e++)f+=m[k+e]*C[e];return f}const w=[1,256,65536,16777216],C=[1/256,1/65536,1/16777216,1/4294967296],r=x(new Uint8ClampedArray([255,255,255,255]));g.packFloatRGBA=function(m,k,f=0){m=q.clamp(m,0,r);for(let b=0;4>b;b++){var e=Math,l=m*w[b];k[f+b]=e.floor.call(e,256*(l-Math.floor(l)))}};g.unpackFloatRGBA=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(g,q){function x(w,C){if("string"===typeof w)w=q.numericHash(w+`-seed(${C})`);else{let r=12;w^=C;do w=107*(w>>8^w)+r|0;while(0!==--r)}return(1+w/-2147483648)/2}g.getMaterialGroup=function(w){return Math.floor(10*x(w,53290320))};g.getRandomValue=x;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Result":function(){define(["exports","../../../../../core/Error"],
function(g,q){g.ok=function(x,w){return x&&"name"in x?(w&&w.error(new q(x.name,x.message,x.details)),!1):!0};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(g,q,x,
w,C,r,m,k,f,e){class l extends k(f){constructor(b,p,c){super(b);this._minMaxZoom=C.i1616to32(Math.round(p*w.minMaxZoomPrecisionFactor),Math.round(c*w.minMaxZoomPrecisionFactor));this._cimLineLayer=b;let d=0;q.isFeatureValueFn(b.width)||(d=.5*g.pt2px(b.width));this._dynamicPropertyMap.set("_halfWidth",(t,v,y)=>q.isFeatureValueFn(b.width)?.5*g.pt2px(b.width(t,v,y)):d);q.isFeatureValueFn(b.cap)?this._dynamicPropertyMap.set("_capType",b.cap):this._capType=b.cap;q.isFeatureValueFn(b.join)?this._dynamicPropertyMap.set("_joinType",
b.join):this._joinType=b.join;const a=b.color;q.isFeatureValueFn(a)?this._dynamicPropertyMap.set("_fillColor",(t,v,y)=>x.premultiplyAlphaRGBA(a(t,v,y))):this._fillColor=a&&x.premultiplyAlphaRGBA(a)||0;const n=b.miterLimit;q.isFeatureValueFn(n)?this._dynamicPropertyMap.set("_miterLimitCosine",(t,v,y)=>m.getLimitCosine(n(t,v,y))):this._miterLimitCosine=m.getLimitCosine(n);null!=b.effects&&(p=b.effects,q.isFeatureValueFn(p)?this._dynamicPropertyMap.set("_effects",p):this._effects=p);this._scaleFactor=
b.scaleFactor||1;this._isDashed=null!=b.dashTemplate;this.tessellationProperties._bitset=(b.colorLocked?w.bitsetGenericLockColor:0)|(b.scaleDash?w.bitsetLineScaleDash:0)|(b.sampleAlphaOnly?w.bitsetGenericConsiderAlphaOnly:0);this._materialKey=b.materialKey;this._initializeTessellator(!0)}static fromCIMLine(b,p){const [c,d]=m.getMinMaxZoom(b.scaleInfo,p);return new l(b,c,d)}bindFeature(b,p,c){const d=b.readLegacyFeature();this._dynamicPropertyMap.forEach((n,t)=>{this[t]=n(d,p,c)});this._halfWidth*=
this._scaleFactor;b=this._materialCache;var a=this._cimLineLayer.materialHash;a=a(d,p,c);a=b.get(a);b=null;a&&e.ok(a.spriteMosaicItem)&&(b=a.spriteMosaicItem);if(b){this._hasPattern=!0;const {rect:n,width:t,height:v}=b;a=n.x+w.spritePadding;const y=n.y+w.spritePadding,h=a+t,A=y+v;this.tessellationProperties._tl=C.i1616to32(a,y);this.tessellationProperties._br=C.i1616to32(h,A)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=
this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties.offset=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;a=r.LineMaterialKey.load(this._materialKey);b&&(a.sdf=b.sdf,a.pattern=!0,a.textureBinding=b.textureBinding);this._materialKey=a.data}}return l})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(g,q,x,w,C,r,m,k,f,e,l,b,p,c,d){const a=C.create(),n=w.create();class t extends p(c){constructor(v,y,h){super(v);this._cimMarkerLayer=v;this._minMaxZoom=e.i1616to32(Math.round(y*f.minMaxZoomPrecisionFactor),Math.round(h*f.minMaxZoomPrecisionFactor));const A=v.color;m.isFeatureValueFn(A)?this._dynamicPropertyMap.set("_fillColor",(u,H,G)=>k.premultiplyAlphaRGBA(A(u,H,G))):this._fillColor=k.premultiplyAlphaRGBA(A);const E=v.outlineColor;m.isFeatureValueFn(E)?this._dynamicPropertyMap.set("_outlineColor",
(u,H,G)=>k.premultiplyAlphaRGBA(E(u,H,G))):this._outlineColor=k.premultiplyAlphaRGBA(E);const z=v.size;m.isFeatureValueFn(z)?this._dynamicPropertyMap.set("_size",(u,H,G)=>x.pt2px(z(u,H,G))):this._size=x.pt2px(z)||0;y=v.scaleX;m.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_scaleX",y):this._scaleX=y;const F=v.offsetX;m.isFeatureValueFn(F)?this._dynamicPropertyMap.set("xOffset",(u,H,G)=>x.pt2px(F(u,H,G))):this.xOffset=x.pt2px(F)||0;const D=v.offsetY;m.isFeatureValueFn(D)?this._dynamicPropertyMap.set("yOffset",
(u,H,G)=>x.pt2px(D(u,H,G))):this.yOffset=x.pt2px(D)||0;const B=v.outlineWidth;m.isFeatureValueFn(B)?this._dynamicPropertyMap.set("_outlineWidth",(u,H,G)=>x.pt2px(B(u,H,G))):this._outlineWidth=x.pt2px(B)||0;y=v.rotation;m.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_angle",y):this._angle=y||0;null!=v.effects&&(y=v.effects,m.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_effects",y):this._effects=y);null!=v.markerPlacement&&(y=v.markerPlacement,m.isFeatureValueFn(y)?this._dynamicPropertyMap.set("_markerPlacement",
y):this._markerPlacement=y);this._scaleFactor=v.scaleFactor??1;this._bitSet=(v.alignment===r.Alignment.MAP?f.bitsetMarkerAlignmentMap:f.bitsetMarkerAlignmentScreen)|(v.colorLocked?f.bitsetGenericLockColor:0)|(v.scaleSymbolsProportionally?f.bitsetMarkerScaleSymbolsProportionally:0);this._materialKey=v.materialKey}static fromCIMMarker(v,y){const [h,A]=b.getMinMaxZoom(v.scaleInfo,y);return new t(v,h,A)}bindFeature(v,y,h){const A=v.readLegacyFeature();v=v.getObjectId();this._dynamicPropertyMap.forEach((fa,
O)=>{this[O]=fa(A,y,h)});var E=this._cimMarkerLayer.materialHash;v="function"===typeof E?E(A,y,h,v):E;if((v=this._materialCache.get(v))&&d.ok(v.spriteMosaicItem)&&v.spriteMosaicItem){v=v.spriteMosaicItem;E=this._cimMarkerLayer.sizeRatio;var z=v.width/v.height*this._scaleX,F=l.MarkerMaterialKey.load(this._materialKey);F.sdf=v.sdf;F.pattern=!0;F.textureBinding=v.textureBinding;this._materialKey=F.data;var D=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,B=this._size,u=B*z,H=this.xOffset,
G=this.yOffset;this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var I=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/x.pt2px(this._cimMarkerLayer.frameHeight):1;I*=this._outlineWidth;var J=x.pt2px(this._cimMarkerLayer.referenceSize),M=0,R=0,Y=this._cimMarkerLayer.anchorPoint;Y&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(M=x.pt2px(Y.x)/(this._size*z),R=x.pt2px(Y.y)/this._size):(M=Y.x,R=Y.y));this._anchorX=M;this._anchorY=R;
this._sizeOutlineWidth=e.i8888to32(Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*B),255)),Math.round(Math.min(Math.sqrt(128*I),255)),Math.round(Math.min(Math.sqrt(128*J),255)));this.angle=D;this._bitestAndDistRatio=e.i1616to32(this._bitSet,Math.round(64*E));this._computeSize(u,B,E,I,this._scaleFactor,v,F.hasSizeVV(),!0);this._applyTransformation(n,a);this.xOffset=H;this.yOffset=G}else q.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new g("mapview-cim",
"Encountered an error when binding feature"))}}return t})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(g,q,x,w,C,r,m,k,f,e,l,b){class p extends e(l){constructor(c,
d,a){super(c);this._horizontalAlignment="center";this._verticalAlignment="middle";this._textToGlyphs=new Map;this._minMaxZoom=m.i1616to32(Math.round(d*r.minMaxZoomPrecisionFactor),Math.round(a*r.minMaxZoomPrecisionFactor));d=c.scaleFactor||1;this._cimTextLayer=c;const n=c.color;x.isFeatureValueFn(n)?this._dynamicPropertyMap.set("_color",(A,E,z)=>C.premultiplyAlphaRGBA(n(A,E,z))):this._color=C.premultiplyAlphaRGBA(n);const t=c.outlineColor;x.isFeatureValueFn(t)?this._dynamicPropertyMap.set("_haloColor",
(A,E,z)=>C.premultiplyAlphaRGBA(t(A,E,z))):this._haloColor=C.premultiplyAlphaRGBA(t);let v;x.isFeatureValueFn(c.size)||(v=Math.min(Math.round(g.pt2px(c.size*c.sizeRatio)),127));this._dynamicPropertyMap.set("_size",(A,E,z)=>x.isFeatureValueFn(c.size)?Math.min(Math.round(g.pt2px(c.size(A,E,z)*c.sizeRatio)),127):v);x.isFeatureValueFn(c.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(A,E,z)=>Math.min(Math.floor(5*g.pt2px(c.outlineSize(A,E,z)*c.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*
g.pt2px(c.outlineSize*c.sizeRatio)),127);let y;x.isFeatureValueFn(c.offsetX)||(y=Math.round(g.pt2px(c.offsetX*c.sizeRatio)));this._dynamicPropertyMap.set("_xOffset",(A,E,z)=>x.isFeatureValueFn(c.offsetX)?Math.round(g.pt2px(c.offsetX(A,E,z)*c.sizeRatio)):y);let h;x.isFeatureValueFn(c.offsetY)||(h=Math.round(g.pt2px(c.offsetY*c.sizeRatio)));this._dynamicPropertyMap.set("_yOffset",(A,E,z)=>x.isFeatureValueFn(c.offsetY)?Math.round(g.pt2px(c.offsetY(A,E,z)*c.sizeRatio)):h);x.isFeatureValueFn(c.angle)?
this._dynamicPropertyMap.set("_angle",c.angle):this._angle=c.angle;x.isFeatureValueFn(c.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",c.horizontalAlignment):this._horizontalAlignment=c.horizontalAlignment;x.isFeatureValueFn(c.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",c.verticalAlignment):this._verticalAlignment=c.verticalAlignment;null!=c.effects&&(a=c.effects,x.isFeatureValueFn(a)?this._dynamicPropertyMap.set("_effects",a):this._effects=a);null!=
c.markerPlacement&&(a=c.markerPlacement,x.isFeatureValueFn(a)?this._dynamicPropertyMap.set("_markerPlacement",a):this._textPlacement=a);x.isFeatureValueFn(c.text)?this._dynamicPropertyMap.set("_text",c.text):this._text=c.text;this._backgroundColor=c.backgroundColor&&C.premultiplyAlphaRGBA(c.backgroundColor);this._borderLineColor=c.borderLineColor&&C.premultiplyAlphaRGBA(c.borderLineColor);this._borderLineSize=c.borderLineWidth;this._scaleFactor=d;d=Math.min(Math.round(g.pt2px(c.referenceSize*c.sizeRatio)),
127);this._referenceSize=Math.round(Math.sqrt(256*d));this._materialKey=c.materialKey;d=k.TextMaterialKey.load(this._materialKey);d.sdf=!0;this._bitset=(c.alignment===q.Alignment.MAP?1:0)|(c.colorLocked?1:0)<<1;this._materialKey=d.data;this._decoration="none";this._lineHeight=1;this._lineWidth=512;this._isCIM=!0}static fromCIMText(c,d){const [a,n]=f.getMinMaxZoom(c.scaleInfo,d);return new p(c,a,n)}async analyze(c,d,a,n){var t=d.readLegacyFeature();var v=this._cimTextLayer;t="string"===typeof v.text?
v.text:"function"===typeof v.text?v.text(t,a,n)??"":"";c=await super.analyze(c,d,a,n,b.codepoints(t));c?.glyphMosaicItems&&this._textToGlyphs.set(t,c.glyphMosaicItems);return c}bindFeature(c,d,a){const n=c.readLegacyFeature();this._dynamicPropertyMap.forEach((t,v)=>{this[v]=t(n,d,a)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/r.glyphSize,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=w.getXAnchorDirection(this._horizontalAlignment??
"center"),this._yAlignD=w.getYAnchorDirection(this._verticalAlignment??"baseline"),c=this._textToGlyphs.get(this._text)??[],this.bindTextInfo(c,!1)):this._shapingInfo=null}}return p})},"esri/views/2d/layers/features/textUtils":function(){define(["exports"],function(g){g.codepoints=function(q){if(null==q)return[];const x=Array(q.length);for(let w=0;w<q.length;w++)x[w]=q.charCodeAt(w);return x};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLMeshTemplate".split(" "),
function(g,q,x,w,C,r,m,k,f){class e extends k(f){constructor(l,b,p,c,d,a,n,t,v,y,h,A,E,z,F,D){super();this._effects=z||void 0;l=r.FillMaterialKey.load(l);b&&(l.sdf=b.sdf,l.pattern=!0,l.textureBinding=b.textureBinding);this.fillColor=p;this.tl=c;this.br=d;this.aux21=C.i1616to32(a,n);this.aux22=C.i1616to32(t,v);this.aux3=C.i8888to32(y,h,A,0);this._bitset=E;this._minMaxZoom=C.i1616to32(Math.round(F*x.minMaxZoomPrecisionFactor),Math.round(D*x.minMaxZoomPrecisionFactor));this._materialKey=l.data}static fromCIMFill(l,
b,p){var c=l.color;c=c&&q.premultiplyAlphaRGBA(c)||0;const d=l.materialKey,[a,n]=m.getMinMaxZoom(l.scaleInfo,p);p=(l.colorLocked?x.bitsetGenericLockColor:0)|(l.applyRandomOffset?x.bitsetFillRandomPatternOffset:0)|(l.sampleAlphaOnly?x.bitsetGenericConsiderAlphaOnly:0)|(l.hasUnresolvedReplacementColor?x.bitsetFillHasUnresolvedReplacementColor:0);if(!b)return new e(d,null,c,0,0,0,0,0,0,0,0,0,p,l.effects,a,n);const {rect:t,width:v,height:y}=b;var h=l.scaleX||1,A=t.x+x.spritePadding;const E=t.y+x.spritePadding;
var z=A+v;const F=E+y;var D=g.pt2px(l.height);h*=D;"CIMHatchFill"===l.cim.type&&(h*=v/y);0>=D&&(D=F-E);D<x.maxSizeForU16Compression&&(D*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternHeightPrecisionFactor);D=Math.round(D);0>=h&&(h=z-A);h<x.maxSizeForU16Compression&&(h*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternWidthPrecisionFactor);h=Math.round(h);const B=g.pt2px(l.offsetX||0),u=g.pt2px(-l.offsetY||0);A=C.i1616to32(A,E);z=C.i1616to32(z,F);return new e(d,b,c,A,z,h,D,B,u,x.compressionFactorForU16,
x.compressionFactorForU16,w.degToByte(l.angle),p,l.effects,a,n)}static fromSimpleFill(l,b,p=!1){var {color:c}=l;c=c&&"esriSFSNull"!==l.style&&q.premultiplyAlphaRGBAArray(c)||0;p=p?x.bitsetGenericLockColor:0;const d=l.materialKey;if(b){const {rect:y,width:h,height:A,pixelRatio:E}=b;var a=y.x+x.spritePadding,n=y.y+x.spritePadding,t=a+h,v=n+A;a=C.i1616to32(a,n);t=C.i1616to32(t,v);v=h/E;v<x.maxSizeForU16Compression&&(v*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternWidthPrecisionFactor);v=Math.round(v);
n=A/E;n<x.maxSizeForU16Compression&&(n*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternHeightPrecisionFactor);n=Math.round(n);b=new e(d,b,c,a,t,v,n,0,0,x.compressionFactorForU16,x.compressionFactorForU16,0,p,null,m.defaultMinZoom,m.defaultMaxZoom)}else b=new e(d,null,c,0,0,0,0,0,0,0,0,0,p,null,m.defaultMinZoom,m.defaultMaxZoom);b._maybeAddLineTemplate(l);return b}static fromPictureFill(l,b,p=!1){const c=x.pictureFillColor,{rect:d,width:a,height:n}=b;var t=d.x+x.spritePadding,v=d.y+x.spritePadding,
y=t+a,h=v+n;t=C.i1616to32(t,v);y=C.i1616to32(y,h);p=p?x.bitsetGenericLockColor:0;h=g.pt2px(l.width);h<x.maxSizeForU16Compression&&(h*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternWidthPrecisionFactor);h=Math.round(h);v=g.pt2px(l.height);v<x.maxSizeForU16Compression&&(v*=x.compressionFactorForU16,p|=x.bitsetFillHasPatternHeightPrecisionFactor);v=Math.round(v);const A=g.pt2px(l.xoffset),E=g.pt2px(-l.yoffset);b=new e(l.materialKey,b,c,t,y,h,v,A,E,x.compressionFactorForU16*l.xscale,x.compressionFactorForU16*
l.yscale,0,p,null,m.defaultMinZoom,m.defaultMaxZoom);b._maybeAddLineTemplate(l);return b}}return e})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["exports","../../../../../core/promiseUtils"],function(g,q){class x{constructor(){this._resolver=null}isHeld(){return!!this._resolver}async acquire(){this._resolver?(await this._resolver.promise,await this.acquire()):this._resolver=q.createResolver()}release(){const w=this._resolver;this._resolver=null;w?.resolve()}}g.Lock=x;g.withLock=async function(w,
C,r){try{await w.acquire(),await C(r),w.release()}catch(m){throw w.release(),m;}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/cimSymbolUtils":function(){define(["require","exports","../../../../symbols/cim/cimAnalyzer","../../../../symbols/cim/ExpandedCIM"],function(g,q,x,w){const C=async(r,m,k)=>{m=new x.CIMAnalyzer(k,m);return new w.ExpandedCIM(await m.analyzeSymbolReference(r.data,!1),r.data,r.rendererKey,r.maxVVSize)};q.cimLayerToRasterizationInfo=
function(r){if(!r)return null;const {avoidSDFRasterization:m,type:k,cim:f,url:e,materialHash:l,maxVVSize:b}=r,p={cim:f,type:k,mosaicHash:l,url:e,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:m};switch(k){case "marker":b&&"size"in f&&(f.size=Math.max(b,f.size));p.size=r.size;p.path=r.path;p.animatedSymbolProperties=r.animatedSymbolProperties;break;case "line":p.dashTemplate=r.dashTemplate;break;case "text":p.text=r.text,p.fontName=
r.fontName}return p};q.expandSymbol=async function(r,m,k,f){if(!r)return null;if("cim"===r.type)return C(r,m,k);if("web-style"===r.type){const {fetchCIMSymbolReference:e}=await new Promise((l,b)=>g(["./webStyleUtils"],l,b));r={type:"cim",data:await e(r,null,f)??void 0,rendererKey:r.rendererKey,maxVVSize:r.maxVVSize};return C(r,m,k)}return r};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/ExpandedCIM":function(){define(["exports","../../views/2d/engine/webgl/enums",
"../../views/2d/engine/webgl/materialKey/MaterialKey"],function(g,q,x){const w={marker:q.WGLGeometryType.MARKER,fill:q.WGLGeometryType.FILL,line:q.WGLGeometryType.LINE,text:q.WGLGeometryType.TEXT};class C{constructor(r,m,k,f){const e={minScale:m?.minScale,maxScale:m?.maxScale};var l=e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:"";this.layers=r;this.data=m;this.hash=this._createHash()+l;this.rendererKey=k;m={isOutline:!1,placement:null,symbologyType:q.WGLSymbologyType.DEFAULT,vvFlags:k};for(const b of r)r=
w[b.type],m.isOutline="line"===b.type&&b.isOutline,b.materialKey=x.createMaterialKey(r,m),b.maxVVSize=f,b.scaleInfo=e,b.templateHash+=l}get type(){return"expanded-cim"}_createHash(){let r="";for(const m of this.layers)r+=m.templateHash;return r}}g.ExpandedCIM=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/Logger ../../../../../core/LRUCache ../../../../../support/arcadeOnDemand ../../../arcade/callExpressionWithFeature ../../../layers/support/cimSymbolUtils".split(" "),
function(g,q,x,w,C,r,m,k,f){async function e(y,h,A,E){switch(y.type){case "simple":case "heatmap":return c.fromBasicRenderer(y,h,A,E);case "map":return n.fromUVRenderer(y,h,A,E);case "interval":return a.fromCBRenderer(y,h,A,E);case "dictionary":return v.fromDictionaryRenderer(y,h,A,E);case "pie-chart":return d.fromPieChartRenderer(y,h,A,E);case "subtype":return d.fromSubtypes(y,h,A,E)}}async function l(y,h){const A=y||1;if("number"===typeof A)return(z,F,D)=>A;const E=await m.createRendererExpression(A,
h.spatialReference,h.fields);return(z,F,D)=>k(E,z,{$view:D},h.geometryType,F)||1}async function b(){t||(t=new Promise((y,h)=>g(["../../../layers/features/createSymbolSchema"],y,h)));return t}const p=C.getLogger("esri/views/2d/engine/webgl/util/Matcher");class c{constructor(){this.type="feature";this._defaultResult=null}static async fromBasicRenderer(y,h,A,E){const z=new c;y.symbol&&(y=await f.expandSymbol(y.symbol,A,E),h=h.createTemplateGroup(y,null),z.setDefault(h));return z}static async fromPieChartRenderer(y,
h,A,E){const z=new c;if(y.markerSymbol){const F=await f.expandSymbol(y.markerSymbol,A,E);let D;y.fillSymbol&&(D=await f.expandSymbol(y.fillSymbol,A,E));y=h.createTemplateGroup(F,D);z.setDefault(y)}return z}size(){return 1}getDefault(){return this._defaultResult}setDefault(y){this._defaultResult=y}match(y,h,A,E,z){return this.getDefault()}async analyze(y,h,A,E,z,F){return null}}class d extends c{constructor(y,h){super();this._subMatchers=y;this._subtypeField=h}static async fromSubtypes(y,h,A,E){const z=
new Map,F=[];for(const D in y.renderers){const B=parseInt(D,10),u=e(y.renderers[D],h,A,E).then(H=>z.set(B,H));F.push(u)}await Promise.all(F);return new d(z,y.subtypeField)}match(y,h,A,E,z){var F=h.readAttribute(this._subtypeField);return(F=this._subMatchers.get(F))?F.match(y,h,A,E,z):null}}class a extends c{constructor(y,h,A,E){super();this.type="interval";this._intervals=[];this._isMaxInclusive=h;this._fieldIndex=E;this._field=y;this._normalizationInfo=A}static async fromCBRenderer(y,h,A,E){const {isMaxInclusive:z,
normalizationField:F,normalizationTotal:D,normalizationType:B}=y,u=new a(y.field,z,{normalizationField:F,normalizationTotal:D,normalizationType:B},y.fieldIndex),H=await f.expandSymbol(y.backgroundFillSymbol,A,E);await Promise.all(y.intervals.map(async G=>{var I=await f.expandSymbol(G.symbol,A,E);I=h.createTemplateGroup(I,H);u.add({min:G.min,max:G.max},I)}));if(y=await f.expandSymbol(y.defaultSymbol,A,E))y=h.createTemplateGroup(y,H),u.setDefault(y);return u}add(y,h){this._intervals.push({interval:y,
result:h});this._intervals.sort((A,E)=>A.interval.min-E.interval.min)}size(){return super.size()+this._intervals.length}match(y,h,A,E,z){if(null==this._fieldIndex&&!this._field)return this.getDefault();y=null!=this._fieldIndex?h.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(h);if(null===y||void 0===y||isNaN(y)||Infinity===y||-Infinity===y)return this.getDefault();for(h=0;h<this._intervals.length;h++){const {interval:F,result:D}=this._intervals[h];A=this._isMaxInclusive?y<=F.max:
y<F.max;if(y>=F.min&&A)return D}return this.getDefault()}_needsNormalization(){const y=this._normalizationInfo;return y&&(y.normalizationField||y.normalizationTotal||y.normalizationType)}_getValueFromField(y){const h=y.readAttribute(this._field);if(!this._needsNormalization()||null==h)return h;const {normalizationField:A,normalizationTotal:E,normalizationType:z}=this._normalizationInfo;y=y.readAttribute(A)??1;if(z)switch(z){case "esriNormalizeByField":return(y||void 0)&&h/y;case "esriNormalizeByLog":return Math.log(h)*
Math.LOG10E;case "esriNormalizeByPercentOfTotal":return h/E*100;default:p.error(`Found unknown normalization type: ${z}`)}else p.error("Normalization is required, but no type was set!")}}class n extends c{constructor(y,h,A){super();this.type="map";this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fieldsIndex=A;this._fields=y;this._seperator=h||""}static async fromUVRenderer(y,h,A,E){const z=y.fieldDelimiter,F=[y.field];y.field2&&F.push(y.field2);y.field3&&F.push(y.field3);const D=
await f.expandSymbol(y.backgroundFillSymbol,A,E),B=new n(F,z,y.fieldIndex);await Promise.all(y.map.map(async(u,H)=>{const G=await f.expandSymbol(u.symbol,A,E);H=h.createTemplateGroup(G,D,H+1);"\x3cNull\x3e"===u.value?B.setNullResult(H):B.add(u.value,H)}));if(y=await f.expandSymbol(y.defaultSymbol,A,E))y=h.createTemplateGroup(y,D,Number.MAX_SAFE_INTEGER),B.setDefault(y);return B}setNullResult(y){this._nullResult=y}add(y,h){this._resultsMap.set(y.toString(),h)}size(){return super.size()+this._resultsMap.size}match(y,
h,A,E,z){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();y=null!=this._fieldsIndex?h.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(h);if(null!==this._nullResult&&(null==y||""===y||"\x3cNull\x3e"===y))return this._nullResult;if(null==y)return this.getDefault();y=y.toString();return this._resultsMap.has(y)?this._resultsMap.get(y):this.getDefault()}_getValueFromFields(y){const h=[];for(const A of this._fields){const E=y.readAttribute(A);null==E||""===E?h.push("\x3cNull\x3e"):
h.push(E)}return h.join(this._seperator)}}let t;class v extends c{constructor(y,h,A,E,z,F){super();this.type="dictionary";this._groupIdCache=new r.LRUCache(100);this._loader=y;this._fieldMap=y.fieldMap;this._symbolFields=y.getSymbolFields();this._templates=h;this._info=A;this._scaleFn=E;this._schemaUtilsModule=z;this._symbolOptions=F}static async fromDictionaryRenderer(y,h,A,E){const [{DictionaryLoader:z},F]=await Promise.all([new Promise((B,u)=>g(["../../../../../renderers/support/DictionaryLoader"],
B,u)),b()]);E=new z(y.url,y.config,y.fieldMap);await E.fetchResources({spatialReference:A.spatialReference,fields:A.fields});const D=await l(y.scaleExpression,A);return new v(E,h,A,D,F,y.symbolOptions)}async _analyzeFeature(y,h,A,E,z){y=y.readLegacyFeature();const F=this._scaleFn(y,A,E);A=this._attributeHash(y)+"-"+F;const D=this._groupIdCache.get(A);if(D)return D;E=await this._loader.getSymbolAsync(y,{...E,spatialReference:this._info.spatialReference,abortOptions:z,fields:this._info.fields});E=this._schemaUtilsModule.createSymbolSchema(E,
this._symbolOptions);h=f.expandSymbol(E,this._info,h,z).then(B=>{if("expanded-cim"!==B?.type)return p.error(new w("mapview-bad-type",`Found unexpected type ${B?.type} in dictionary response`)),null;B.hash+="-"+F;for(const u of B.layers)u.scaleFactor=F,u.templateHash+="-"+F;return this._templates.createTemplateGroup(B,null)});this._groupIdCache.put(A,h,1);return h}async analyze(y,h,A,E,z,F){y=h.getCursor();for(h=[];y.next();)h.push(this._analyzeFeature(y,A,E,z,F));return Promise.all(h).then(D=>D.filter(x.isSome))}match(y,
h,A,E,z){return null}_attributeHash(y){let h="";for(const A of this._symbolFields){const E=this._fieldMap?.[A];E&&(h+=y.attributes[E]+"-")}return h}}q.DictionaryMatcher=v;q.FeatureMatcher=c;q.IntervalMatcher=a;q.MapMatcher=n;q.SubtypeMatcher=d;q.createMatcher=e;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processors/BaseProcessor":function(){define("../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,q,x,w,C,r,m){q=class extends q{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const k=this.tileStore.tileScheme.spatialReference;return k&&k.toJSON()||null}};g.__decorate([x.property({readOnly:!0})],q.prototype,"supportsTileUpdates",null);g.__decorate([x.property({constructOnly:!0})],q.prototype,"remoteClient",void 0);g.__decorate([x.property({constructOnly:!0})],q.prototype,"service",void 0);g.__decorate([x.property()],q.prototype,"spatialReference",
null);g.__decorate([x.property({constructOnly:!0})],q.prototype,"tileInfo",void 0);g.__decorate([x.property({constructOnly:!0})],q.prototype,"tileStore",void 0);return q=g.__decorate([m.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],q)})},"esri/views/2d/layers/features/support/ResourceManagerProxy":function(){define(["../../../../../core/promiseUtils"],function(g){class q{constructor(x){this._remoteClient=x;this._resourceMap=new Map;this._inFlightResourceMap=new Map;this.geometryEnginePromise=
this.geometryEngine=null}destroy(){}async fetchResource(x,w){const C=this._resourceMap;var r=C.get(x);if(r||(r=this._inFlightResourceMap.get(x)))return r;try{r=this._remoteClient.invoke("tileRenderer.fetchResource",{url:x},{...w}),this._inFlightResourceMap.set(x,r),r.then(m=>{this._inFlightResourceMap.delete(x);C.set(x,m);return m})}catch(m){return g.isAbortError(m)?null:{width:0,height:0}}return r}getResource(x){return this._resourceMap.get(x)??null}loadFont(x){return Promise.resolve(null)}}return q})},
"*noref":1}});
define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ./processors ./controllers/FeatureController2D ./support/TileStore ./support/UpdateToken ../../tiling/TileInfoView".split(" "),function(g,
q,x,w,C,r,m,k,f,e,l,b,p,c,d){q=class extends q{constructor(){super(...arguments);this.viewState=this.service=this.tileStore=this.remoteClient=this.processor=this.controller=null;this._paused=!1;this._pendingTileUpdates=[]}initialize(){this.addHandles([w.watch(()=>this.updating,a=>{this.remoteClient.invoke("setUpdating",a).catch(n=>{})})])}destroy(){this.stop();this.controller?.destroy();this.processor?.destroy();this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||
this.controller.updating}stop(){this._paused=!0;Array.isArray(this.service?.source)&&(this.service.source.forEach(a=>a.close()),this.service.source.length=0);this.tileStore?.updateTiles({added:[],removed:this.tileStore.tiles.map(a=>a.id)});this.tileStore?.destroy();this.tileStore=null;this._pendingTileUpdates.length=0}async startup({service:a,config:n,tileInfo:t,tiles:v}){this._paused=!0;Array.isArray(this.service?.source)&&(this.service.source.forEach(y=>y.close()),this.service.source.length=0);
this.service=a;this.tileStore&&f.equals(this.tileStore.tileScheme.spatialReference,t.spatialReference)||(a=new d(e.fromJSON(t)),v.added.length=v.removed.length=0,this.tileStore?.updateTiles({added:[],removed:this.tileStore.tiles.map(y=>y.id)}),this.tileStore?.destroy(),this.tileStore=new p(a),this._pendingTileUpdates.length=0);await this._createProcessorAndController(n);await this.update({config:n});this.controller.resume();this.tileStore.clear();this.tileStore.updateTiles(v);for(this._paused=!1;this._pendingTileUpdates.length;)this.tileStore.updateTiles(this._pendingTileUpdates.pop())}async updateTiles(a){this._paused?
this._pendingTileUpdates.push(a):this.tileStore?.updateTiles(a)}async update({config:a}){const n=c.UpdateToken.empty();await Promise.all([this.processor.update(n,a),this.controller.update(n,a)]);return n.toJSON()}async applyUpdate(a){return this.controller.applyUpdate(c.UpdateToken.create(a))}async _createProcessorAndController(a){await Promise.all([this._handleControllerConfig(a),this._handleProcessorConfig(a)]);this.controller.processor=this.processor}async _handleControllerConfig(a){return this._createController(this.service,
a)}async _handleProcessorConfig(a){return this._createProcessor(this.service,a)}async _createController(a,n){this.controller&&(this.controller.destroy(),this.removeHandles("controller"));const {tileStore:t,remoteClient:v}=this,y=new b({service:a,tileStore:t,remoteClient:v});a=w.watch(()=>y.dataUpdating,h=>{this.remoteClient.invoke("setDataUpdating",h).catch(A=>{})});this.addHandles(a,"controller");return this.controller=y}async _createProcessor(a,n){const t=(await l.loadProcessorModule(n.schema.processors[0].type)).default,
{remoteClient:v,tileStore:y}=this;a=new t({service:a,config:n,tileStore:y,remoteClient:v});this.processor&&this.processor.destroy();return this.processor=a}};g.__decorate([C.property()],q.prototype,"controller",void 0);g.__decorate([C.property()],q.prototype,"processor",void 0);g.__decorate([C.property()],q.prototype,"updating",null);g.__decorate([C.property()],q.prototype,"viewState",void 0);return q=g.__decorate([k.subclass("esri.views.2d.layers.features.Pipeline")],q)});