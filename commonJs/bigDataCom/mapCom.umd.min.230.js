"use strict";(("undefined"!==typeof self?self:this)["webpackChunkmapCom"]=("undefined"!==typeof self?self:this)["webpackChunkmapCom"]||[]).push([[230],{61230:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("a-spin",{staticStyle:{width:"100%"},attrs:{spinning:!e.treeIsShow,tip:e.languageObj.tip}},[e.treeIsShow?t("a-tree",{ref:"treeNode",staticClass:"seaClass",attrs:{"tree-data":e.treeData,"load-data":e.onLoadData,"selected-keys":e.selectedKeys,"expanded-keys":e.expandedKeys},on:{"update:expandedKeys":function(t){e.expandedKeys=t},"update:expanded-keys":function(t){e.expandedKeys=t},select:e.onSelect},scopedSlots:e._u([{key:"titleSlot",fn:function({dataRef:s}){return[t("a-tooltip",{attrs:{id:s.key,placement:"right"}},[t("template",{slot:"title"},[e._v(" "+e._s(s.title)+" ")]),e._v(" "+e._s(s.title)+" ")],2)]}}],null,!1,31147123)}):e._e()],1)},n=[],i=s(6616),r=i.A,l=s(81656),o=(0,l.A)(r,a,n,!1,null,"34f08a46",null),d=o.exports},6616:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(44114),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_api_request__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12988);__webpack_exports__.A={name:"SeaTree",props:{options:{type:Object,default:()=>({})},isExpandTree:{type:Boolean,default:!0}},data(){return{treeIsShow:!0,treeData:[],record:{entityId:0},selectedKeys:[],expandedKeys:[]}},computed:{testNames(){return{"19478/1067903/1320976":this.options.isEng?"Yangjiang Qingzhou 5 Offshore Wind Farm Project":"阳江青洲五期风电场","19478/1067903/1320981":this.options.isEng?"Yangjiang Qingzhou 6 Offshore Wind Farm Project":"阳江青洲六期风电场","19478/1067903/1320982":this.options.isEng?"Yangjiang Qingzhou 7 Offshore Wind Farm Project":"阳江青洲七期风电场","19478/1067903/1094756":this.options.isEng?"Yangjiang Shaba Wind Farm Project":"阳江沙扒风电场","19478/1067903/1094756/1321007":this.options.isEng?"Yangjiang Shaba Offshore Wind Farm Project - Phase 3":"沙扒三期","19478/1067903/1094756/1321009":this.options.isEng?"Yangjiang Shaba Offshore Wind Farm Project - Phase 5":"沙扒五期","19478/1067903/1094756/1321602":this.options.isEng?"Yangjiang Shaba Offshore Wind Farm Project - Phase 2":"沙扒二期","19478/1067903/1094756/1321604":this.options.isEng?"Yangjiang Shaba Offshore Wind Farm Project - Phase 4":"沙扒四期","19478/1067903/1094756/1094757":this.options.isEng?"Yangjiang Shaba Offshore Wind Farm Project - Phase 1":"沙扒一期"}},languageObj(){return this.options.isEng?{tip:"loading..."}:{tip:"加载中..."}}},watch:{options:{handler(e,t){JSON.stringify(e)!==JSON.stringify(t)&&this.loadTree()},deep:!0,immediate:!0},isExpandTree:{immediate:!0,handler(e){e&&this.toLeftTree()}},expandedKeys(){this.toLeftTree()}},inject:["getOptions"],mounted(){window.eventBus.$on("changeSubcenter",this.loadTree)},beforeDestroy(){window.eventBus.$off("changeSubcenter",this.loadTree)},methods:{treeThis(){return this.$refs.treeNode},getTree(e){let{entityId:t,classId:s,parentId:a,projectId:n,hasChild:i,entityType:r,classType:l,document:o,topicName:d,desc:c,code:p,keyword:h}=e,_={key:d,entityId:t,parentId:a,projectId:n,title:c||p||h,entityType:r,classId:s,classType:l,classCode:e.cdclass?e.cdclass.code:void 0,classKeyword:e.cdclass?e.cdclass.keyword:void 0,document:o,topicName:d,scopedSlots:{title:"titleSlot"},isLeaf:!(3!==r||!s)||!i};return this.options.isEng&&(_.title=h),_},resetData(){this.treeData=[],this.treeIsShow=!1,this.selectedKeys=[],this.expandedKeys=[],this.record={}},async loadTree(){this.resetData();let e=[];if(this.options.isSelectChild){let{result:t}=await(0,_api_request__WEBPACK_IMPORTED_MODULE_1__.uu)({entityId:this.options.entityIds[0]||0,entityType:1,simple:!1,needAttr:!0,needDoc:!0});e=t}else{let t=await Promise.all(this.options.entityIds.map((e=>(0,_api_request__WEBPACK_IMPORTED_MODULE_1__.k3)({id:e,simple:!1,needAttr:!0,needDoc:!0}))));e=t.map((e=>e.result))}e.forEach((e=>{if(!this.options.needFilter||e.sho){let t=this.getTree(e);this.treeData.push(t),this.options.isExpandRoot&&!this.expandedKeys.includes(t.key)&&this.expandedKeys.push(t.key)}})),this.treeIsShow=!0;let t=this.expandedKeys;this.$nextTick((()=>{this.autoExpand(t)}))},async onLoadData(e){if(e.dataRef.children)return;const t=this.getOptions().options;let s={entityId:e.dataRef.entityId,needAttr:!0,needDoc:!0,simple:!1,windfarmStatus:this.generateSql(e)?t.windfarmStatus:void 0},{result:a}=await(0,_api_request__WEBPACK_IMPORTED_MODULE_1__.uu)(s);e.dataRef.children=[],a.forEach((t=>{if(!this.options.needFilter||t.sho){let s=this.getTree(t);e.dataRef.children.push(s)}})),0==a.length&&(e.dataRef.isLeaf=!0),this.treeData=[...this.treeData],this.toLeftTree()},async onSelect(e,t){0!==e.length&&(this.selectedKeys=e,this.record={...this.record,...t.node.dataRef},this.$emit("onSelected",this.record))},generateSql(treeNode){let{sql:originSql,sqlParams:sqlParams}=this.options;function initSqlParams(){if(originSql)return{isSql:!0,sql:originSql};let e=Object.keys(sqlParams).map((e=>`${e}='${sqlParams[e]}'`));return{isSql:!1,sql:e.join(" AND ")}}function checkParentIsHasPropANDMode(e,t,s){if(e.dataRef){let a=0;return s.map((s=>{e.dataRef.document&&e.dataRef.document[s]&&e.dataRef.document[s]==t[s]&&a++})),a!==s.length&&(!e.$parent||checkParentIsHasPropANDMode(e.$parent,t,s))}return!0}function checkParentIsHasPropORMode(node,data,sql){if(node.dataRef){if(node.dataRef.document){let doc=node.dataRef.document,tempSql=sql;return Object.keys(data.keys).map((e=>{let t=doc[e]||null;"string"==typeof t&&(t="'"+t+"'"),tempSql=tempSql.replaceAll(e,t)})),tempSql=tempSql.replaceAll(">=","大于等于").replaceAll("<=","小于等于").replaceAll("!=","不等于").replaceAll("=","==").replaceAll("不等于","!=").replaceAll("小于等于","<=").replaceAll("大于等于",">=").replaceAll(" OR "," || ").replaceAll(" or "," || ").replaceAll(" AND "," && ").replaceAll(" and "," && "),!eval(tempSql)&&checkParentIsHasPropORMode(node.$parent,data,sql)}return checkParentIsHasPropORMode(node.$parent,data,sql)}return!0}function splitSQL(e){let t={},s={},a=e.replaceAll(" OR ","|").replaceAll(" AND ","|").replaceAll(" or ","|").replaceAll(" and ","|").replaceAll("(","").replaceAll(")","").split("|");return a.map((e=>{let a=e.split("=");t[a[0]]=!0,s[e]=a[0]})),{keys:t,result:s}}let{isSql:isSql,sql:sql}=initSqlParams(),isNeedSql=!1;if(isNeedSql=isSql?checkParentIsHasPropORMode(treeNode,splitSQL(sql),sql):checkParentIsHasPropANDMode(treeNode,sqlParams,Object.keys(sqlParams)),sql&&isNeedSql)return sql},autoExpand(e){this.expandedKeys=[],e.forEach(((t,s)=>{this.expandedKeys.push(t),s===e.length-1&&setTimeout((()=>{document.getElementsByClassName("ant-tree-treenode-checkbox-checked").length>0&&document.getElementsByClassName("ant-tree-treenode-checkbox-checked")[0].scrollIntoView(),document.getElementsByClassName("ant-tree-treenode-selected").length>0&&document.getElementsByClassName("ant-tree-treenode-selected")[0].scrollIntoView()}),1e3)}))},handleLoadLoopNode(e){let t=e.filter((e=>!!e)),s=-1;for(let i=0;i<t.length;i++){let e=t[i];for(let t=0;t<this.treeData.length;t++){let a=this.treeData[t];if(a.entityId==e){s=i;break}}}let a=[],n="";t.map(((e,i)=>{if(i>=s){let e="";for(let s=0;s<=i;s++)0!=s&&(e+="/"),e+=t[s];if(i==t.length-1)return n=e,!1;a.push(e)}})),this.autoExpand(a),this.selectedKeys=[n]},toLeftTree(){this.$nextTick((()=>{if(this.$refs.treeNode){let e=this.$refs.treeNode.$el.parentNode.parentNode.parentNode.parentNode,t=e.scrollWidth,s=e.scrollLeft;t&&s!==t&&(e.scrollLeft=t)}}))}}}}}]);