"use strict";(("undefined"!==typeof self?self:this)["webpackChunkmapCom"]=("undefined"!==typeof self?self:this)["webpackChunkmapCom"]||[]).push([[749],{3749:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return e.value?t("div",{staticClass:"powerModalMask"},[t("div",{staticClass:"powerModal"},[t("div",{staticClass:"power-title"},[e._v("广东省电源规划")]),t("div",{staticClass:"power-close",on:{click:e.close}}),t("div",{ref:"powerList",staticClass:"power-content-parent",on:{scroll:function(t){e.scrollTop=t.target.scrollTop}}},[t("div",{staticClass:"power-content"},[e._m(0),t("div",{staticClass:"power-line"},[t("ChartByComm",{attrs:{"c-name":"LineChart","com-props":e.chartOpts}})],1),t("SeaProTable",{attrs:{title:"广东省电源规划趋势",columns:e.columns,data:e.currTableData,"has-expand":!1,"table-class":"power-table"}})],1),t("div",{staticClass:"power-content"},e._l(e.years,(function(a){return t("div",{key:a,staticClass:"power-content-block"},[t("div",{staticClass:"power-title-container"},[t("span",{staticClass:"power-title-text"},[e._v("广东省"+e._s(a)+"电源规划占比分析")])]),t("div",{staticClass:"power-pie",attrs:{id:"pie"+a}})])})),0)])])]):e._e()},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"power-title-container"},[t("span",{staticClass:"power-title-text"},[e._v("广东省电源规划趋势")])])}],r=(a(44114),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698),a(12988)),l=a(26522);let o=(0,l.sg)(((e,t,a)=>{let s=a.$refs.powerList;e>t?s.scrollTo({top:s.scrollHeight,behavior:"smooth"}):e<t&&s.scrollTo({top:0,behavior:"smooth"})}),200);var n={components:{ChartByComm:()=>a.e(879).then(a.bind(a,90879))},props:["value"],data(){return{colors:{"煤电":"#FF7200","气电":"#EBF005","生物质及其他":"#0099AF","常规水电":"#FFFFFF","抽水蓄能":"#EEAF0A","核电":"#00FF00","风电":"#1800FF","光伏":"#6F6F6F","新能源":"#2C9EFF","储能":"#8A8AFF","水电及抽水蓄能":"#16EFCF"},tableData:[],clientHeight:0,scrollTop:0}},computed:{years(){return[...new Set(this.tableData.map((e=>e.year)))].sort(((e,t)=>+e-+t))},xVal(){return this.years.map((e=>this.formatYear(e)))},yVal(){return[...new Set(this.tableData.map((e=>e.classified)))]},lines(){let e={};return this.yVal.forEach((t=>{let a=this.tableData.filter((e=>e.classified===t)),s={};a.forEach((e=>{s[e.year]?s[e.year]+=e.generation:s[e.year]=e.generation}));let i=Object.keys(s).map((e=>({value:[this.formatYear(e),s[e]]})));e[t]=i})),e},columns(){let e=[{label:"电源名称",key:"classified"}];this.years.forEach((t=>{e.push({label:this.formatYear(t)+" (MW)",key:t})}));let t=(100/e.length).toFixed(2);return e.forEach((e=>e.style={width:t+"%"})),e},currTableData(){let e=[];this.yVal.forEach((t=>{let a={};this.years.forEach((e=>{let s=this.tableData.filter((a=>a.classified===t&&a.year===e)),i="/";s.length&&!a.classified&&(a.classified=s[0].classified),s.length>1?i=s.reduce(((e,t)=>(e.generation||0)+(t.generation||0)))||"/":s.length&&(i=s[0].generation),a[e]=i})),e.push(a)}));let t={classified:"统调"};return this.years.forEach((a=>{t[a]=e.map((e=>e[a])).reduce(((e,t)=>("/"===e?0:e)+("/"===t?0:t)))||"/"})),[t,...e]},chartOpts(){return{chartData:{unit:"MW",xAxisData:[],series:[]},beforeSetOptions:e=>{let t=[];return e.xAxis.data=this.xVal,e.dataZoom=[],Object.keys(this.lines).forEach((e=>{t.push({name:e,color:this.colors[e],connectNulls:!0,type:"line",data:this.lines[e]})})),e.series=t,e.legend={data:this.yVal,top:10,textStyle:{color:"#ffffff"}},e.yAxis[0].name="装机规模 (MW)",e}}}},watch:{value:"renderPie",scrollTop(e,t){o(e,t,this)}},created(){this.loadData()},methods:{async loadData(){let{result:e}=await(0,r.lf)({classCode:"powerSupply"});if(e&&e.records&&e.records.length){let{entityId:t}=e.records[0],{result:a}=await(0,r.tu)({entityId:t,pageNo:1,pageSize:1e3,query:"",queryType:"sql"});a&&a.records&&(this.tableData=a.records||[])}this.renderPie()},renderPie(){this.value&&this.$nextTick((()=>{this.years.forEach(this.getPie);let e=this.$refs.powerList;this.clientHeight=e?e.clientHeight:0}))},formatYear(e){let t=+e||0,a=(new Date).getFullYear();return e+(t>a?"年预计装机容量":"年已建")},getPie(e){let t=this.tableData.filter((t=>t.year===e)),a={},s=[];t.forEach((e=>{a[e.classified]?(a[e.classified].total+=e.generation,a[e.classified].list.push(e)):a[e.classified]={total:e.generation,list:[e]}})),Object.keys(a).forEach((e=>{s.push({name:e,list:a[e].list,value:a[e].total,itemStyle:{color:this.colors[e]}})}));let i=document.getElementById(`pie${e}`);if(!i)return;let r=this.$echarts.init(i);r.setOption((0,l.fA)(s),{notMerge:!0})},close(){this.$emit("input",!1)}}},c=n,h=a(81656),p=(0,h.A)(c,s,i,!1,null,"2c2e76f6",null),d=p.exports}}]);